(function(){var t,S,e,n,r,b;this.taiga=b={},b.emojis=window.emojis,this.taigaContribPlugins=this.taigaContribPlugins||window.taigaContribPlugins||[],b.generateHash=function(t){return null==t&&(t=[]),t=_.map(t,function(t){return JSON.stringify(t)}),hex_sha1(t.join(":"))},b.generateUniqueSessionIdentifier=function(){var t=(new Date).getTime(),e=Math.floor(150994944*Math.random());return b.generateHash([t,e])},b.sessionId=b.generateUniqueSessionIdentifier(),n=window.open,window.open=function(t,e,r){return t.startsWith("/")&&(t=document.baseURI+t),n(t)},t=function(r,t,e,n,i,o,s,a,c,u){var l,p;if(c.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/),l=r.when,r.when=function(t,e){return e.resolve||(e.resolve={}),angular.extend(e.resolve,{languageLoad:["$q","$translate",function(t,e){var r=t.defer();return e("COMMON.YES").then(function(){return r.resolve()}),r.promise}],projectLoaded:["$q","tgProjectService","$route",function(t,e,r){var n=t.defer();return e.setSection(null!=(t=r.current.$$route)?t.section:void 0),r.current.params.pslug?e.setProjectBySlug(r.current.params.pslug).then(n.resolve):(e.cleanProject(),n.resolve()),n.promise}]}),l.call(r,t,e)},r.when("/",{templateUrl:"home/home.html",controller:"Home",controllerAs:"vm",loader:!0,title:"HOME.PAGE_TITLE",description:"HOME.PAGE_DESCRIPTION",joyride:"dashboard"}),r.when("/discover",{templateUrl:"discover/discover-home/discover-home.html",controller:"DiscoverHome",controllerAs:"vm",title:"PROJECT.NAVIGATION.DISCOVER",loader:!0}),r.when("/discover/search",{templateUrl:"discover/discover-search/discover-search.html",title:"PROJECT.NAVIGATION.DISCOVER",loader:!0,controller:"DiscoverSearch",controllerAs:"vm",reloadOnSearch:!1}),r.when("/projects/",{templateUrl:"projects/listing/projects-listing.html",access:{requiresLogin:!0},title:"PROJECTS.PAGE_TITLE",description:"PROJECTS.PAGE_DESCRIPTION",loader:!0,controller:"ProjectsListing",controllerAs:"vm"}),r.when("/project/new",{title:"PROJECT.CREATE.TITLE",templateUrl:"projects/create/create-project.html",loader:!0,controller:"CreateProjectCtrl",controllerAs:"vm"}),r.when("/project/new/scrum",{title:"PROJECT.CREATE.TITLE",template:'<tg-create-project-form type="scrum"></tg-create-project-form>',loader:!0}),r.when("/project/new/kanban",{title:"PROJECT.CREATE.TITLE",template:'<tg-create-project-form type="kanban"></tg-create-project-form>',loader:!0}),r.when("/project/new/duplicate",{title:"PROJECT.CREATE.TITLE",template:"<tg-duplicate-project></tg-duplicate-project>",loader:!0}),r.when("/project/new/import/:platform?",{title:"PROJECT.CREATE.TITLE",template:"<tg-import-project></tg-import-project>",loader:!0}),r.when("/project/:pslug/",{template:"",loader:!0,controller:"ProjectRouter"}),r.when("/project/:pslug/timeline",{templateUrl:"projects/project/project.html",loader:!0,controller:"Project",controllerAs:"vm",section:"project-timeline"}),r.when("/project/:pslug/t/:ref",{loader:!0,controller:"DetailController",template:""}),r.when("/project/:pslug/search",{templateUrl:"search/search.html",reloadOnSearch:!1,section:"search",loader:!0}),r.when("/project/:pslug/epics",{section:"epics",templateUrl:"epics/dashboard/epics-dashboard.html",loader:!0,controller:"EpicsDashboardCtrl",controllerAs:"vm"}),r.when("/project/:pslug/epic/:epicref",{templateUrl:"epic/epic-detail.html",loader:!0,section:"epics"}),r.when("/project/:pslug/backlog",{templateUrl:"backlog/backlog.html",loader:!0,section:"backlog",joyride:"backlog"}),r.when("/project/:pslug/kanban",{templateUrl:"kanban/kanban.html",loader:!0,section:"kanban",joyride:"kanban"}),r.when("/project/:pslug/taskboard/:sslug",{templateUrl:"taskboard/taskboard.html",loader:!0,section:"backlog"}),r.when("/project/:pslug/us/:usref",{templateUrl:"us/us-detail.html",loader:!0,section:"backlog-kanban"}),r.when("/project/:pslug/task/:taskref",{templateUrl:"task/task-detail.html",loader:!0,section:"backlog-kanban"}),r.when("/project/:pslug/wiki",{redirectTo:function(t){return"/project/"+t.pslug+"/wiki/home"}}),r.when("/project/:pslug/wiki-list",{templateUrl:"wiki/wiki-list.html",loader:!0,section:"wiki"}),r.when("/project/:pslug/wiki/:slug",{templateUrl:"wiki/wiki.html",loader:!0,section:"wiki"}),r.when("/project/:pslug/team",{templateUrl:"team/team.html",loader:!0,section:"team"}),r.when("/project/:pslug/issues",{templateUrl:"issue/issues.html",loader:!0,section:"issues"}),r.when("/project/:pslug/issue/:issueref",{templateUrl:"issue/issues-detail.html",loader:!0,section:"issues"}),r.when("/project/:pslug/admin/project-profile/details",{templateUrl:"admin/admin-project-profile.html",section:"admin"}),r.when("/project/:pslug/admin/project-profile/default-values",{templateUrl:"admin/admin-project-default-values.html",section:"admin"}),r.when("/project/:pslug/admin/project-profile/modules",{templateUrl:"admin/admin-project-modules.html",section:"admin"}),r.when("/project/:pslug/admin/project-profile/export",{templateUrl:"admin/admin-project-export.html",section:"admin"}),r.when("/project/:pslug/admin/project-profile/reports",{templateUrl:"admin/admin-project-reports.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/status",{templateUrl:"admin/admin-project-values-status.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/points",{templateUrl:"admin/admin-project-values-points.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/priorities",{templateUrl:"admin/admin-project-values-priorities.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/severities",{templateUrl:"admin/admin-project-values-severities.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/types",{templateUrl:"admin/admin-project-values-types.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/custom-fields",{templateUrl:"admin/admin-project-values-custom-fields.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/tags",{templateUrl:"admin/admin-project-values-tags.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/due-dates",{templateUrl:"admin/admin-project-values-due-dates.html",section:"admin"}),r.when("/project/:pslug/admin/project-values/kanban-power-ups",{templateUrl:"admin/admin-project-values-kanban-power-ups.html",section:"admin"}),r.when("/project/:pslug/admin/memberships",{templateUrl:"admin/admin-memberships.html",section:"admin"}),r.when("/project/:pslug/admin/roles",{templateUrl:"admin/admin-roles.html",section:"admin"}),r.when("/project/:pslug/admin/third-parties/webhooks",{templateUrl:"admin/admin-third-parties-webhooks.html",section:"admin"}),r.when("/project/:pslug/admin/third-parties/github",{templateUrl:"admin/admin-third-parties-github.html",section:"admin"}),r.when("/project/:pslug/admin/third-parties/gitlab",{templateUrl:"admin/admin-third-parties-gitlab.html",section:"admin"}),r.when("/project/:pslug/admin/third-parties/bitbucket",{templateUrl:"admin/admin-third-parties-bitbucket.html",section:"admin"}),r.when("/project/:pslug/admin/third-parties/gogs",{templateUrl:"admin/admin-third-parties-gogs.html",section:"admin"}),r.when("/project/:pslug/admin/contrib/:plugin",{templateUrl:"contrib/main.html"}),r.when("/project/:pslug/transfer/:token",{templateUrl:"projects/transfer/transfer-page.html",loader:!0,controller:"Project",controllerAs:"vm"}),r.when("/user-settings/user-profile",{templateUrl:"user/user-profile.html"}),r.when("/user-settings/user-change-password",{templateUrl:"user/user-change-password.html"}),r.when("/user-settings/user-project-settings",{templateUrl:"user/user-project-settings.html"}),r.when("/user-settings/mail-notifications",{templateUrl:"user/mail-notifications.html"}),r.when("/user-settings/live-notifications",{templateUrl:"user/live-notifications.html"}),r.when("/user-settings/web-notifications",{templateUrl:"user/web-notifications.html"}),r.when("/change-email/:email_token",{templateUrl:"user/change-email.html"}),r.when("/verify-email/:email_token",{templateUrl:"user/verify-email.html"}),r.when("/cancel-account/:cancel_token",{templateUrl:"user/cancel-account.html"}),r.when("/user-settings/contrib/:plugin",{templateUrl:"contrib/user-settings.html"}),r.when("/profile",{templateUrl:"profile/profile.html",loader:!0,access:{requiresLogin:!0},controller:"Profile",controllerAs:"vm"}),r.when("/notifications",{templateUrl:"notifications/notifications.html",loader:!0,access:{requiresLogin:!0},controller:"Notifications",controllerAs:"vm"}),r.when("/profile/:slug",{templateUrl:"profile/profile.html",loader:!0,controller:"Profile",controllerAs:"vm"}),r.when("/login",{templateUrl:"auth/login.html",title:"LOGIN.PAGE_TITLE",description:"LOGIN.PAGE_DESCRIPTION",disableHeader:!0,controller:"LoginPage"}),window.taigaConfig.publicRegisterEnabled&&r.when("/register",{templateUrl:"auth/register.html",title:"REGISTER.PAGE_TITLE",description:"REGISTER.PAGE_DESCRIPTION",disableHeader:!0}),r.when("/forgot-password",{templateUrl:"auth/forgot-password.html",title:"FORGOT_PASSWORD.PAGE_TITLE",description:"FORGOT_PASSWORD.PAGE_DESCRIPTION",disableHeader:!0}),r.when("/change-password/:token",{templateUrl:"auth/change-password-from-recovery.html",title:"CHANGE_PASSWORD.PAGE_TITLE",description:"CHANGE_PASSWORD.PAGE_TITLE",disableHeader:!0}),r.when("/invitation/:token",{templateUrl:"auth/invitation.html",title:"INVITATION.PAGE_TITLE",description:"INVITATION.PAGE_DESCRIPTION",disableHeader:!0}),r.when("/external-apps",{templateUrl:"external-apps/external-app.html",title:"EXTERNAL_APP.PAGE_TITLE",description:"EXTERNAL_APP.PAGE_DESCRIPTION",controller:"ExternalApp",controllerAs:"vm",disableHeader:!0,mobileViewport:!0}),r.when("/blocked-project/:pslug/",{templateUrl:"projects/project/blocked-project.html",loader:!0}),r.when("/error",{templateUrl:"error/error.html"}),r.when("/not-found",{templateUrl:"error/not-found.html"}),r.when("/permission-denied",{templateUrl:"error/permission-denied.html"}),r.otherwise({templateUrl:"error/not-found.html"}),t.html5Mode({enabled:!0,requireBase:!0}),t={"Content-Type":"application/json","Accept-Language":window.taigaConfig.defaultLanguage||"en","X-Session-Id":b.sessionId},e.defaults.headers.delete=t,e.defaults.headers.patch=t,e.defaults.headers.post=t,e.defaults.headers.put=t,e.defaults.headers.get={"X-Session-Id":b.sessionId},e.useApplyAsync(!0),i.setSessionId(b.sessionId),i=function(t,l,p,e,r,d,h,f){var m={inProgress:!1,promise:null};return{responseError:function(u){if(u.config.url.includes("/auth/refresh"))return t.reject(u);if(0===u.status||-1===u.status&&!u.config.cancelable)e.closeAll(),r.error();else if(401===u.status&&-1===l.url().indexOf("/login"))return new Promise(function(e,r){var t,n,i,o=d.get("$http"),s=function(){return f.remove("token"),f.remove("userInfo")},a=function(t){return f.set("token",t.data.auth_token),f.set("refresh",t.data.refresh),u.config.headers.Authorization="Bearer "+t.data.auth_token,o(u.config).then(function(t){return e(t)})},c=function(){var t=l.url(),e=l.search();return f.remove("refresh"),s(),e.force_next?window.location.href=p.resolve("login")+"?force_next="+e.force_next:window.location.href=p.resolve("login")+"?unauthorized=true&next="+t};return m.inProgress?m.promise.then(function(t){return a(t).catch(function(t){return r(t)})}).catch(function(t){return c(),r(t)}):(m.inProgress=!0,t=h.resolve("refresh"),(n=f.get("refresh"))?(i=o.post(t,{refresh:n}),(m.promise=i).then(function(t){return m.inProgress=!1,a(t).catch(function(t){return r(t)})}),i.catch(function(t){return m.inProgress=!1,c(),r(t)})):(window.location.href=p.resolve("login")+"?force_login",n=l.url(),i=l.search(),s(),i.force_next?window.location.href=p.resolve("login")+"?force_next="+i.force_next:window.location.href=p.resolve("login")+"?unauthorized=true&next="+n,void r(u)))});return t.reject(u)}}},n.factory("authHttpIntercept",["$q","$location","$tgNavUrls","lightboxService","tgErrorHandlingService","$injector","$tgUrls","$tgStorage",i]),e.interceptors.push("authHttpIntercept"),i=function(e,r){return{request:function(t){return r.logRequest(),t},requestError:function(t){return r.logResponse(),e.reject(t)},responseError:function(t){return r.logResponse(),e.reject(t)},response:function(t){return r.logResponse(),t}}},n.factory("loaderIntercept",["$q","tgLoader",i]),e.interceptors.push("loaderIntercept"),i=function(e){return{responseError:function(t){return 400===t.status&&t.data.version&&angular.element("body").injector().invoke(["$tgConfirm","$translate",function(t,e){e=e.instant("ERROR.VERSION_ERROR");return t.notify("error",e,null,1e4)}]),e.reject(t)}}},n.factory("versionCheckHttpIntercept",["$q",i]),e.interceptors.push("versionCheckHttpIntercept"),i=function(e,t){var r=function(){return t.block()};return{response:function(t){return t.data.blocked_code&&r(),t},responseError:function(t){return 451===t.status&&r(),e.reject(t)}}},n.factory("blockingIntercept",["$q","tgErrorHandlingService",i]),e.interceptors.push("blockingIntercept"),o.debugInfoEnabled(window.taigaConfig.debugInfo||!1),localStorage.userInfo&&(p=JSON.parse(localStorage.userInfo)),p=(null!=p?p.lang:void 0)||window.taigaConfig.defaultLanguage||"en",a.addPart("taiga"),s.useLoader("$translatePartialLoader",{urlTemplate:window._version+"/locales/{part}/locale-{lang}.json"}).useSanitizeValueStrategy("escapeParameters").addInterpolation("$translateMessageFormatInterpolation").preferredLanguage(p).useMissingTranslationHandlerLog(),s.fallbackLanguage("en"),s=window.getDecorators(),_.each(s,function(t){return n.decorator(t.provider,t.decorator)}),u.debugEnabled(window.taigaConfig.debug),window.taigaConfig.debug)return console.info("Debug mode is enable")},S=function(t,e){return moment.locale(t),document.querySelector("html").setAttribute("lang",t),"en"!==t&&ljs.load("/"+window._version+"/locales/moment-locales/"+t+".js"),e={defaultMessage:e.instant("COMMON.FORM_ERRORS.DEFAULT_MESSAGE"),type:{email:e.instant("COMMON.FORM_ERRORS.TYPE_EMAIL"),url:e.instant("COMMON.FORM_ERRORS.TYPE_URL"),urlstrict:e.instant("COMMON.FORM_ERRORS.TYPE_URLSTRICT"),number:e.instant("COMMON.FORM_ERRORS.TYPE_NUMBER"),digits:e.instant("COMMON.FORM_ERRORS.TYPE_DIGITS"),dateIso:e.instant("COMMON.FORM_ERRORS.TYPE_DATEISO"),alphanum:e.instant("COMMON.FORM_ERRORS.TYPE_ALPHANUM"),phone:e.instant("COMMON.FORM_ERRORS.TYPE_PHONE")},notnull:e.instant("COMMON.FORM_ERRORS.NOTNULL"),notblank:e.instant("COMMON.FORM_ERRORS.NOT_BLANK"),required:e.instant("COMMON.FORM_ERRORS.REQUIRED"),regexp:e.instant("COMMON.FORM_ERRORS.REGEXP"),min:e.instant("COMMON.FORM_ERRORS.MIN"),max:e.instant("COMMON.FORM_ERRORS.MAX"),range:e.instant("COMMON.FORM_ERRORS.RANGE"),minlength:e.instant("COMMON.FORM_ERRORS.MIN_LENGTH"),maxlength:e.instant("COMMON.FORM_ERRORS.MAX_LENGTH"),rangelength:e.instant("COMMON.FORM_ERRORS.RANGE_LENGTH"),mincheck:e.instant("COMMON.FORM_ERRORS.MIN_CHECK"),maxcheck:e.instant("COMMON.FORM_ERRORS.MAX_CHECK"),rangecheck:e.instant("COMMON.FORM_ERRORS.RANGE_CHECK"),equalto:e.instant("COMMON.FORM_ERRORS.EQUAL_TO"),linewidth:e.instant("COMMON.FORM_ERRORS.LINEWIDTH"),pikaday:e.instant("COMMON.FORM_ERRORS.PIKADAY")},checksley.updateMessages("default",e)},e=function(t,r,i,e,n,o,s,a,c,u,l,p,d,h,f,m,g){var v,y;return t.debug("Initialize application"),r.$on("$translatePartialLoaderStructureChanged",function(){return a.refresh()}),t={linewidth:function(t,e){t=b.nl2br(t).split("<br />");return _.every(t,function(t){return t.length<e})},pikaday:function(t){var e=a.instant("COMMON.PICKERDATE.FORMAT");return moment(t,e).isValid()},url:function(t){return new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i").test(t)}},checksley.updateValidators(t),r.contribPlugins=this.taigaContribPlugins,r.adminPlugins=_.filter(this.taigaContribPlugins,{type:"admin"}),r.authPlugins=_.filter(this.taigaContribPlugins,{type:"auth"}),r.userSettingsPlugins=_.filter(this.taigaContribPlugins,{type:"userSettings"}),v=null,r.$on("$translateChangeEnd",function(t,e){if(v!==e.language)return v=e.language,S(v,a),e=m.get("rtlLanguages",[]),r.isRTL=-1<e.indexOf(v),document.querySelector("tg-legacy").translations={translationTable:a.getTranslationTable(v),lan:v}}),e.setupConnection(),i.isAuthenticated()&&i.getUser(),n.initialize(),o.initialize(),s.initialize(),s.identify(),r.$on("$locationChangeStart",function(t){if(h.init(),f.getLightboxOpen().length)return t.preventDefault(),f.closeAll()}),y=r.$on("$routeChangeStart",function(t,e){return e.loader&&p.start(!0),y()}),r.$on("$routeChangeSuccess",function(t,e){var r,n;return null!=(r=g.project)&&r.get("blocked_code")&&h.block(),e.loader&&p.start(!0),e.access&&e.access.requiresLogin&&(i.isAuthenticated()||c.path(u.resolve("login"))),(e.title||e.description)&&(n=a.instant(e.title||""),r=a.instant(e.description||""),l.setAll(n,r)),e.mobileViewport?l.addMobileViewport():l.removeMobileViewport(),e.disableHeader?d.disableHeader():d.enableHeader()})},angular.module("infinite-scroll").value("THROTTLE_MILLISECONDS",500),r=_.filter(this.taigaContribPlugins,function(t){return t.module}),r=_.map(r,function(t){return t.module}),r=["taigaBase","taigaCommon","taigaResources","taigaResources2","taigaAuth","taigaEvents","taigaHome","taigaNavigationBar","taigaProjects","taigaRelatedTasks","taigaBacklog","taigaTaskboard","taigaKanban","taigaIssues","taigaUserStories","taigaTasks","taigaTeam","taigaWiki","taigaSearch","taigaAdmin","taigaProject","taigaUserSettings","taigaFeedback","taigaPlugins","taigaIntegrations","taigaComponents","taigaProfile","taigaHome","taigaUserTimeline","taigaExternalApps","taigaDiscover","taigaHistory","taigaNotifications","taigaWikiHistory","taigaEpics","taigaUtils","templates","ngSanitize","ngRoute","ngAnimate","ngAria","pascalprecht.translate","infinite-scroll","tgRepeat"].concat(r),(r=angular.module("taiga",r)).config(["$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider","$logProvider",t]),r.run(["$log","$rootScope","$tgAuth","$tgEvents","$tgAnalytics","$tgTagManager","$tgUserPilot","$translate","$tgLocation","$tgNavUrls","tgAppMetaService","tgLoader","tgNavigationBarService","tgErrorHandlingService","lightboxService","$tgConfig","tgProjectService",e])}).call(this),function(){var t,e,r=function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty,n=function(t,e){return function(){return t.apply(e,arguments)}};function o(){return o.__super__.constructor.apply(this,arguments)}function s(){return this.onInitialDataError=n(this.onInitialDataError,this),s.__super__.constructor.apply(this,arguments)}r(o,t=function(){}),e=o,r(s,t),s.prototype.onInitialDataError=function(t){return t&&(404===t.status?this.errorHandlingService.notfound():403===t.status&&this.errorHandlingService.permissionDenied()),this.q.reject(t)},r=s,this.taiga.Base=t,this.taiga.Service=e,this.taiga.Controller=r}.call(this),function(){var t,n,e,r,i,o,s,a,c,u,l,p,d=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},h=[].slice,f={}.hasOwnProperty,m=function(t,e){return t.classList?t.classList.add(e):t.className+=" "+e},g=function(t){return(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},v=function(t){var r=_.keys(t),n=[];return _.forIn(t,function(t,e){if(d.call(r,e)<0&&_.isFunction(t))return n.push(e)}),_.bindAll(t,n)},y=function(t,e,r){var n,i=t.$eval(e);return void 0!==i?r(i):(n=null,n=t.$watch(e,function(t){if(void 0!==t)return r(t),n?n():void 0}))},S=function(){var t,e,r,n,i,o,s;function a(){return a.__super__.constructor.apply(this,arguments)}for(e=arguments[0],i=2<=arguments.length?h.call(arguments,1):[],function(t,e){for(var r in e)f.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(a,e),t=a,r=i.length-1;0<=r;r+=-1)for(o in s=i[r].prototype)n=s[o],t.prototype[o]=n;return t},b=function(t,e){return _.trim(t,e)},j=function(t){return t.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")},k=function(t){return t&&_.capitalize(t.replace(/-/g," "))},I=function(t,e){var r=t.data("nextTextPosition");return(null==r||r>=e.length)&&(r=0),e=e[r],t.data("nextTextPosition",r+1),t.text(e)},$=function(t,e){for(var r,n={},i=0,o=t.length;i<o;i++)n[e(r=t[i])]=r;return n},E=function(t,e){return window.setTimeout(e,t)},T=function(t){return window.clearTimeout(t)},C=function(t,e){return _.defer(function(){return t.$apply(e)})},w=function(t){return _.isNumber(t)?t+"":_.isString(t)?t:_.isPlainObject(t)?JSON.stringify(t):_.isUndefined(t)?"":t.toString()},P=function(t,e){return e.join(t)},A=function(t,e){return _.debounce(e,t,{leading:!0,trailing:!1})},O=function(t,e){return _.debounce(e,t,{leading:!1,trailing:!0})},R=function(t,e){return _.startsWith(t,e)},U=function(t,e,r){var n;return null==r&&(r="..."),"string"==typeof t||t instanceof String?((n=t.slice(0)).length>e&&(n=(n=n.substring(0,e+1)).substring(0,Math.min(n.length,n.lastIndexOf(" "))),n+=r),n):t},M=function(t,e){var r,n;return null==e&&(e=1),isNaN(parseFloat(t))||!isFinite(t)?"-":0===t?"0 bytes":(n=["bytes","KB","MB","GB","TB","PB"],5<(r=Math.floor(Math.log(t)/Math.log(1024)))&&(r=5),(t/Math.pow(1024,r)).toFixed(e)+" "+n[r])},D=function(t,e){return e?(e=new RegExp("<(?!"+e+"s*/?)[^>]+>","gi"),String(t).replace(e,"")):String(t).replace(/<\/?[^>]+>/g,"")},N=function(t,e,r){var n=new RegExp("<("+e+")>","gi");return t=t.replace(n,"<"+r+">"),n=new RegExp("</("+e+")>","gi"),t=t.replace(n,"</"+r+">")},x=function(t,e,r){return Object.defineProperty(t,e,{get:function(){var t;if(!_.isFunction(r))throw"defineImmutableProperty third param must be a function";if(t=r(),t&&_.isObject(t)&&void 0===t.size)throw"defineImmutableProperty must return immutable data";return t}})};_.mixin({removeKeys:function(t,e){return _.chain([e]).flatten().reduce(function(t,e){return delete t[e],t},t).value()},cartesianProduct:function(){return _.reduceRight(arguments,function(t,r){return _.flatten(_.map(t,function(e){return _.map(r,function(t){return[t].concat(e)})}),!0)},[[]])}}),s=function(t){return null!==t.match(/\.(jpe?g|png|gif|gifv|svg|psd|webp)/i)},o=function(t){return null!=t&&null!==t.match(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)},a=function(t){return null!==t.match(/\.(pdf)/i)},u=function(r,t){var n={};return t.forEach(function(t,e){if(t!==r.get(e))return t.toJS?n[e]=t.toJS():n[e]=t}),n},t=["#D35163","#D351CF","#AC51D3","#8151D3","#5551D3","#5178D3","#78D351","#51D355","#51D381","#51D3AC","#51CFD3","#51A3D3","#A3D350","#CFD350","#D3AC50","#D38050","#D35450","#E44057","#4C566A","#70728F","#A9AABC"],i=function(){return _.sample(t)},e=function(){return _.clone(t)},r=function(t,e,r){var n,i;for(r=r||1,i=[],0;n=e.exec(t);)-1===r?i.push(n):i.push(n[r]);return i},l=function(t,e){e-=t;return t+Math.floor(Math.random()*(1+e))},c=function(t){return t=(t=(t=(t=(t=t.replace("Á","A").replace("Ä","A").replace("À","A")).replace("É","E").replace("Ë","E").replace("È","E")).replace("Í","I").replace("Ï","I").replace("Ì","I")).replace("Ó","O").replace("Ö","O").replace("Ò","O")).replace("Ú","U").replace("Ü","U").replace("Ù","U")},n=function(t,e){var r=e(t);return r||(t?n(t.$parent,e):null)},(p=this.taiga).addClass=m,p.nl2br=g,p.bindMethods=v,p.bindOnce=y,p.mixOf=S,p.trim=b,p.slugify=j,p.unslugify=k,p.toggleText=I,p.groupBy=$,p.timeout=E,p.cancelTimeout=T,p.scopeDefer=C,p.toString=w,p.joinStr=P,p.truncate=U,p.debounce=A,p.debounceLeading=O,p.startswith=R,p.sizeFormat=M,p.stripTags=D,p.replaceTags=N,p.defineImmutableProperty=x,p.isImage=s,p.isEmail=o,p.isPdf=a,p.patch=u,p.getRandomDefaultColor=i,p.getDefaulColorList=e,p.getMatches=r,p.randomInt=l,p.normalizeString=c,p.findScope=n}.call(this),function(){var i,o,s,a;function t(){}function e(){}function r(){}s=this.taiga,i=this.taiga.groupBy,o=this.taiga.joinStr,a=this.taiga.trim,this.taiga.toString,t.prototype.fillUsersAndRoles=function(t,e){var r,n=_.filter(t,function(t){return t.is_active});return this.scope.activeUsers=_.sortBy(n,"full_name_display"),this.scope.activeUsersById=i(this.scope.activeUsers,function(t){return t.id}),this.scope.users=_.sortBy(t,"full_name_display"),this.scope.usersById=i(t,function(t){return t.id}),this.scope.roles=_.sortBy(e,"order"),r=_(this.scope.project.members).map("role").uniq().value(),this.scope.computableRoles=_(e).filter("computable").filter(function(t){return _.includes(r,t.id)}).value()},t.prototype.loadUsersAndRoles=function(){var n;return this.q.all([this.rs.projects.usersList(this.scope.projectId),this.rs.projects.rolesList(this.scope.projectId)]).then((n=this,function(t){var e=t[0],r=t[1];return n.fillUsersAndRoles(e,r),t}))},s.PageMixin=t,e.prototype.excludePrefix="exclude_",e.prototype.selectFilter=function(t,e,r,n){var i;if(null==r&&(r=!1),null==n&&(n="include"),i=this.location.search(),"exclude"===n&&(t=this.excludePrefix.concat(t)),void 0!==i[t]&&"page"!==t&&((i=_.map(s.toString(i[t]).split(","),function(t){return a(t)})).push(s.toString(e)),i=_.compact(i),e=o(",",_.uniq(i))),!this.location.isInCurrentRouteParams(t,e))return(r?this.location:this.location.noreload(this.scope)).search(t,e)},e.prototype.replaceFilter=function(t,e,r){if(null==r&&(r=!1),!this.location.isInCurrentRouteParams(t,e))return(r?this.location:this.location.noreload(this.scope)).search(t,e)},e.prototype.replaceAllFilters=function(t,e){return null==e&&(e=!1),(e?this.location:this.location.noreload(this.scope)).search(t)},e.prototype.unselectFilter=function(t,e,r,n){var i;if(null==r&&(r=!1),null==n&&(n="include"),i=this.location.search(),"exclude"===n&&(t=this.excludePrefix.concat(t)),void 0!==i[t])return null==e&&delete i[t],i=_.map(s.toString(i[t]).split(","),function(t){return a(t)}),i=_.reject(i,function(t){return t===s.toString(e)}),i=_.compact(i),e=_.isEmpty(i)?null:o(",",_.uniq(i)),(r?this.location:this.location.noreload(this.scope)).search(t,e)},e.prototype.applyStoredFilters=function(t,e,r){var n;return!(!_.isEmpty(this.location.search())||(n=this.getFilters(t,e),r&&(n=_.pick(n,r)),!Object.keys(n).length))&&(this.location.search(n),this.location.replace(),!0)},e.prototype.storeFilters=function(t,e,r){var r=t+":"+r,r=s.generateHash([t,r]);return this.storage.set(r,e)},e.prototype.getFilters=function(t,e){var e=t+":"+e,e=s.generateHash([t,e]),e=this.storage.get(e)||{};return delete e.q,e},e.prototype.formatSelectedFilters=function(e,t,r,n){var i,o;return null==n&&(n="include"),o=r.split(","),i=_.filter(t,function(t){return-1!==o.indexOf(_.toString(t.id))}),r=_.filter(o,function(e){return!_.find(i,function(t){return _.toString(t.id)===e})}),t=_.map(r,function(t){return{id:t,key:e+":"+t,dataType:e,name:t,mode:n}}),r=_.map(i,function(t){return{id:t.id,key:e+":"+t.id,dataType:e,name:t.name,color:t.color,mode:n}}),t.concat(r)},s.FiltersMixin=e,r.prototype.excludePrefix="exclude_",r.prototype.filterCategories=["tags","status","assigned_users","assigned_to","owner","epic","role"],r.prototype.excludeFilters=[],r.prototype.changeQ=function(t){return this.filterQ=t,this.filtersReloadContent()},r.prototype.removeFilter=function(t){return this.unselectFilter(t.dataType,t.id,!1,t.mode),this.filtersReloadContent(),this.generateFilters()},r.prototype.addFilter=function(t){return this.selectFilter(t.category.dataType,t.filter.id,!1,t.mode),this.filtersReloadContent(),this.generateFilters()},r.prototype.selectCustomFilter=function(t){return this.replaceAllFilters(t.filter),this.filtersReloadContent(),this.generateFilters()},r.prototype.saveCustomFilter=function(e){for(var t,r,n,i={},o=this.location.search(),s=this.filterCategories,a=0,c=s.length;a<c;a++)r=s[a],t=this.excludePrefix.concat(r),i[r]=o[r],i[t]=o[t];return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.storeCustomFiltersName).then((n=this,function(t){return t[e]=i,n.filterRemoteStorageService.storeFilters(n.scope.projectId,t,n.storeCustomFiltersName).then(n.generateFilters)}))},r.prototype.removeCustomFilter=function(e){return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.storeCustomFiltersName).then((r=this,function(t){return delete t[e.id],r.filterRemoteStorageService.storeFilters(r.scope.projectId,t,r.storeCustomFiltersName).then(r.generateFilters),r.generateFilters()}));var r},r.prototype.isFilterDataTypeSelected=function(t){for(var e=this.selectedFilters,r=0,n=e.length;r<n;r++)if(e[r].dataType===t)return!0;return!1},r.prototype.generateFilters=function(t){var c,e,u,r,l,n,i,p;for(this.storeFilters(this.params.pslug,this.location.search(),this.storeFiltersName),i=this.location.search(),(l={}).project=this.scope.projectId,e=0,r=(n=this.filterCategories).length;e<r;e++)u=n[e],c=this.excludePrefix.concat(u),l[u]=i[u],l[c]=i[c];return t&&(l.milestone=t),this.q.all([this.rs.userstories.filtersData(l),this.filterRemoteStorageService.getFilters(this.scope.projectId,this.storeCustomFiltersName)]).then((p=this,function(t){var e,r,n,i,o=t[0],s=t[1],a={};for(a.status=_.map(o.statuses,function(t){return t.id=t.id.toString(),t}),a.tags=_.map(o.tags,function(t){return t.id=t.name,t}),t=_.filter(a.tags,function(t){return 0<t.count}),a.assigned_users=_.map(o.assigned_users,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),a.assigned_to=_.map(o.assigned_to,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),a.role=_.map(o.roles,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.name||"Unassigned",t}),a.owner=_.map(o.owners,function(t){return t.id=t.id.toString(),t.name=t.full_name,t}),a.epic=_.map(o.epics,function(t){return t.id?(t.id=t.id.toString(),t.name="#"+t.ref+" "+t.subject):(t.id="null",t.name="Not in an epic"),t}),p.selectedFilters=[],e=0,r=(n=p.filterCategories).length;e<r;e++)u=n[e],c=p.excludePrefix.concat(u),l[u]&&(i=p.formatSelectedFilters(u,a[u],l[u]),p.selectedFilters=p.selectedFilters.concat(i)),l[c]&&(i=p.formatSelectedFilters(u,a[u],l[c],"exclude"),p.selectedFilters=p.selectedFilters.concat(i));return p.filters=[],p.excludeFilters.includes("status")||p.filters.push({title:p.translate.instant("COMMON.FILTERS.CATEGORIES.STATUS"),dataType:"status",content:a.status}),p.excludeFilters.includes("tags")||p.filters.push({title:p.translate.instant("COMMON.FILTERS.CATEGORIES.TAGS"),dataType:"tags",content:a.tags,hideEmpty:!0,totalTaggedElements:t.length}),p.excludeFilters.includes("assigned_to")||p.filters.push({title:p.translate.instant("COMMON.FILTERS.CATEGORIES.ASSIGNED_TO"),dataType:"assigned_users",content:a.assigned_users}),p.excludeFilters.includes("role")||p.filters.push({title:p.translate.instant("COMMON.FILTERS.CATEGORIES.ROLE"),dataType:"role",content:a.role}),p.excludeFilters.includes("created_by")||p.filters.push({title:p.translate.instant("COMMON.FILTERS.CATEGORIES.CREATED_BY"),dataType:"owner",content:a.owner}),p.excludeFilters.includes("epic")||p.filters.push({title:p.translate.instant("COMMON.FILTERS.CATEGORIES.EPIC"),dataType:"epic",content:a.epic}),p.customFilters=[],_.forOwn(s,function(t,e){return p.customFilters.push({id:e,name:e,filter:t})})}))},s.UsFiltersMixin=r}.call(this),function(){angular.module("taigaAdmin",[])}.call(this),function(){var t=function(t){return function(t){}};t.$inject=["$log"],angular.module("pascalprecht.translate").factory("$translateMissingTranslationHandlerLog",t),t.displayName="$translateMissingTranslationHandlerLog"}.call(this),function(){var b,t,e,i={}.hasOwnProperty;function r(t,e,r,n,i){t.isAuthenticated()&&(n.force_login||(r=r.resolve("home"),n.next&&(r=decodeURIComponent(n.next),e.search("next",null)),n.unauthorized?(i.clear(),i.removeToken()):e.url(r)))}function d(t,e,r,n,i,o,s,a,c,u,l,p){this.rootscope=t,this.storage=e,this.model=r,this.rs=n,this.http=i,this.urls=o,this.config=s,this.userpilot=a,this.translate=c,this.currentUserService=u,this.themeService=l,this.analytics=p,d.__super__.constructor.call(this),p=this.getUser(),this._currentTheme=this._getUserTheme(),this.setUserdata(p)}e=this.taiga,b=this.taiga.debounce,t=angular.module("taigaAuth",["taigaResources"]),r.$inject=["tgCurrentUserService","$location","$tgNavUrls","$routeParams","$tgAuth"],t.controller("LoginPage",r),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(d,e.Service),d.$inject=["$rootScope","$tgStorage","$tgModel","$tgResources","$tgHttp","$tgUrls","$tgConfig","$tgUserPilot","$translate","tgCurrentUserService","tgThemeService","$tgAnalytics"],d.prototype.setUserdata=function(t){return t?(this.userData=Immutable.fromJS(t.getAttrs()),this.currentUserService.setUser(this.userData)):this.userData=null,this.analytics.setUserId()},d.prototype._getUserTheme=function(){var t,e,r=window._taigaAvailableThemes,n=this.config.get("defaultTheme")||"taiga";return _.includes(this.config.get("themes"),null!=(t=this.rootscope.user)?t.theme:void 0)&&r.includes(null!=(e=this.rootscope.user)?e.theme:void 0)?null!=(e=this.rootscope.user)?e.theme:void 0:n},d.prototype._setTheme=function(){var t=this._getUserTheme();if(this._currentTheme!==t)return this._currentTheme=t,this.themeService.use(this._currentTheme)},d.prototype._setLocales=function(){var t=(null!=(t=this.rootscope.user)?t.lang:void 0)||this.config.get("defaultLanguage")||"en";return this.translate.preferredLanguage(t),this.translate.use(t)},d.prototype.getUser=function(){var t;return this.rootscope.user||((t=this.storage.get("userInfo"))?(t=this.model.make_model("users",t),this.rootscope.user=t,this._setLocales(),this._setTheme(),t):(this._setTheme(),null))},d.prototype.setUser=function(t){return this.rootscope.auth=t,this.storage.set("userInfo",t.getAttrs()),this.rootscope.user=t,this.setUserdata(t),this._setLocales(),this._setTheme()},d.prototype.clear=function(){return this.rootscope.auth=null,this.rootscope.user=null,this.storage.remove("userInfo")},d.prototype.setRefreshToken=function(t){return this.storage.set("refresh",t)},d.prototype.getRefreshToken=function(){return this.storage.get("refresh")},d.prototype.setToken=function(t){return this.storage.set("token",t)},d.prototype.getToken=function(){return this.storage.get("token")},d.prototype.removeToken=function(){return this.storage.remove("token"),this.storage.remove("refresh")},d.prototype.isAuthenticated=function(){return null!==this.getUser()},d.prototype.refresh=function(){var r,t=this.urls.resolve("user-me");return this.http.get(t).then((r=this,function(t,e){t=t.data;return t.token=r.getUser().auth_token,t=r.model.make_model("users",t),r.setUser(t),r.rootscope.$broadcast("auth:refresh",t),t}))},d.prototype.login=function(t,e){var r,n=this.urls.resolve("auth");return(t=_.clone(t,!1)).type=e||"normal",this.removeToken(),this.http.post(n,t).then((r=this,function(t,e){t=r.model.make_model("users",t.data);return r.setToken(t.auth_token),r.setRefreshToken(t.refresh),r.setUser(t),r.rootscope.$broadcast("auth:login",t),t}))},d.prototype.logout=function(){return this.removeToken(),this.clear(),this.currentUserService.removeUser(),this._setTheme(),this._setLocales(),this.rootscope.$broadcast("auth:logout"),this.analytics.setUserId()},d.prototype.register=function(t,e,r){var n,i=this.urls.resolve("auth-register");return(t=_.clone(t,!1)).type=e||"public","private"===e&&(t.existing=r||!1),this.removeToken(),this.http.post(i,t).then((n=this,function(t){t=n.model.make_model("users",t.data);return n.setToken(t.auth_token),n.setUser(t),n.rootscope.$broadcast("auth:register",t),t}))},d.prototype.getInvitation=function(t){return this.rs.invitations.get(t)},d.prototype.acceptInvitiationWithNewUser=function(t){return this.register(t,"private",!1)},d.prototype.forgotPassword=function(t){var e=this.urls.resolve("users-password-recovery");return t=_.clone(t,!1),this.removeToken(),this.http.post(e,t)},d.prototype.changePasswordFromRecovery=function(t){var e=this.urls.resolve("users-change-password-from-recovery");return t=_.clone(t,!1),this.removeToken(),this.http.post(e,t)},d.prototype.changeEmail=function(t){var e=this.urls.resolve("users-change-email");return t=_.clone(t,!1),this.http.post(e,t)},d.prototype.cancelAccount=function(t){var e=this.urls.resolve("users-cancel-account");return t=_.clone(t,!1),this.http.post(e,t)},d.prototype.exportProfile=function(){var t=this.urls.resolve("users-export");return this.http.post(t)},d.prototype.sendVerificationEmail=function(){var t=this.urls.resolve("user-send-verification-email");return this.http.post(t)},t.service("$tgAuth",d),e=function(e,r,n,t){var i=t.get("auth/login-text.html",!0);return{restrict:"AE",scope:{},template:function(){var t;return e.get("publicRegisterEnabled")?(t=r.resolve("register"),n.force_next&&(t+="?next="+encodeURIComponent(n.force_next)),i({url:t})):""}}},t.directive("tgPublicRegisterMessage",["$tgConfig","$tgNavUrls","$routeParams","$tgTemplate",e]),e=function(a,c,u,l,p,d,h,f,m,g){return{link:function(e,r,t){var n,i,o,s=new checksley.Form(r.find("form.login-form"));return e.defaultLoginEnabled=l.get("defaultLoginEnabled",!0),p.next&&p.next!==d.resolve("login")&&!p.next.startsWith("%2Fdiscover")?e.nextUrl=decodeURIComponent(p.next):e.nextUrl=d.resolve("home"),p.force_next&&(e.nextUrl=decodeURIComponent(p.force_next)),i=function(t){return h.setupConnection(),g.trackEvent("auth","login","user login",1),0===e.nextUrl.indexOf("http")?m.location.href=e.nextUrl:u.url(e.nextUrl)},n=function(t){return c.notify("light-error",f.instant("LOGIN_FORM.ERROR_AUTH_INCORRECT"))},e.onKeyUp=function(t){t=angular.element(t.currentTarget).val();if(e.iscapsLockActivated=!1,t!==t.toLowerCase())return e.iscapsLockActivated=!0},o=b(2e3,function(t){var e;if(t.preventDefault(),s.validate())return e={username:r.find("form.login-form input[name=username]").val(),password:r.find("form.login-form input[name=password]").val()},t=l.get("loginFormType","normal"),a.login(e,t).then(i,n)}),r.on("submit","form",o),window.prerenderReady=!0,e.$on("$destroy",function(){return r.off()})}}},t.directive("tgLogin",["$tgAuth","$tgConfirm","$tgLocation","$tgConfig","$routeParams","$tgNavUrls","$tgEvents","$translate","$window","$tgAnalytics",e]),e=function(a,c,u,l,p,d,h,f,m){return{link:function(e,t,r){var n,i,o,s;return p.get("publicRegisterEnabled")||(u.path(l.resolve("not-found")),u.replace()),e.data={},n=t.find("form").checksley({onlyOneErrorElement:!0}),d.next&&d.next!==l.resolve("login")?e.nextUrl=decodeURIComponent(d.next):e.nextUrl=l.resolve("home"),o=function(t){return h.trackEvent("auth","register","user registration",1),0===e.nextUrl.indexOf("http")?m.location.href=e.nextUrl:u.url(e.nextUrl)},i=function(t){var e;return t.data._error_message&&(e=f.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),c.notify("light-error",e)),n.setErrors(t.data)},s=b(2e3,function(t){if(t.preventDefault(),n.validate())return a.register(e.data).then(o,i)}),t.on("submit","form",s),e.$on("$destroy",function(){return t.off()}),window.prerenderReady=!0}}},t.directive("tgRegister",["$tgAuth","$tgConfirm","$tgLocation","$tgNavUrls","$tgConfig","$routeParams","$tgAnalytics","$translate","$window",e]),e=function(){return{}},t.directive("tgRegisterOptions",[e]),e=function(a,c,u,l,p){return{link:function(e,t,r){var n,i,o,s;return e.data={},n=t.find("form").checksley(),o=function(t){var e,r;return u.path(l.resolve("login")),r=p.instant("FORGOT_PASSWORD_FORM.SUCCESS_TITLE"),e=p.instant("FORGOT_PASSWORD_FORM.SUCCESS_TEXT"),c.success(r,e)},i=function(t){var e=p.instant("FORGOT_PASSWORD_FORM.ERROR");return c.notify("light-error",e)},s=b(2e3,function(t){if(t.preventDefault(),n.validate())return a.forgotPassword(e.data).then(o,i)}),t.on("submit","form",s),e.$on("$destroy",function(){return t.off()}),window.prerenderReady=!0}}},t.directive("tgForgotPassword",["$tgAuth","$tgConfirm","$tgLocation","$tgNavUrls","$translate",e]),e=function(c,u,l,p,d,h){return{link:function(e,t,r){var n,i,o,s,a;return e.data={},null!=p.token?(e.tokenInParams=!0,e.data.token=p.token):(l.path(d.resolve("login")),a="",a=response.data.token.map(function(t){return a+" "+t}),u.notify("light-error",a)),n=t.find("form").checksley(),o=function(t){return l.path(d.resolve("login")),a=h.instant("CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS"),u.success(a)},i=function(t){return a="",a=t.data.password.map(function(t){return a+" "+t}),u.notify("light-error",a)},s=b(2e3,function(t){if(t.preventDefault(),n.validate())return c.changePasswordFromRecovery(e.data).then(o,i)}),t.on("submit","form",s),e.$on("$destroy",function(){return t.off()})}}},t.directive("tgChangePasswordFromRecovery",["$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",e]),e=function(d,h,f,m,g,v,y,_,S){return{link:function(r,t,e){var n,i,o,s,a,c,u,l=g.token,p=d.getInvitation(l);return p.then(function(t){return r.invitation=t,r.publicRegisterEnabled=S.get("publicRegisterEnabled")}),p.then(null,function(t){var e;return f.path(v.resolve("login")),e=_.instant("INVITATION_LOGIN_FORM.NOT_FOUND"),h.notify("light-error",e)}),r.dataLogin={token:l},n=t.find("form.login-form").checksley({onlyOneErrorElement:!0}),s=function(t){var e;return y.trackEvent("auth","invitationAccept","invitation accept with existing user",1),f.path(v.resolve("project",{project:r.invitation.project_slug})),e=_.instant("INVITATION_LOGIN_FORM.SUCCESS",{project_name:r.invitation.project_name}),h.notify("success",e)},i=function(t){return h.notify("light-error",t.data._error_message)},u=b(2e3,function(t){var e;if(t.preventDefault(),n.validate())return e=m.get("loginFormType","normal"),t=r.dataLogin,(p=d.login({username:t.username,password:t.password,invitation_token:t.token},e)).then(s,i)}),t.on("submit","form.login-form",u),t.on("click",".button-login",u),r.dataRegister={token:l},c=t.find("form.register-form").checksley({onlyOneErrorElement:!0}),a=function(t){var e;return y.trackEvent("auth","invitationAccept","invitation accept with new user",1),f.path(v.resolve("project",{project:r.invitation.project_slug})),e=_.instant("INVITATION_LOGIN_FORM.SUCCESS",{project_name:r.invitation.project_name}),h.notify("success",e)},o=function(t){var e;return t.data._error_message&&(e=_.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),h.notify("light-error",e)),c.setErrors(t.data)},l=b(2e3,function(t){if(t.preventDefault(),c.validate())return(p=d.acceptInvitiationWithNewUser(r.dataRegister)).then(a,o)}),t.on("submit","form.register-form",l),t.on("click",".button-register",l),r.$on("$destroy",function(){return t.off()})}}},t.directive("tgInvitation",["$tgAuth","$tgConfirm","$tgLocation","$tgConfig","$routeParams","$tgNavUrls","$tgAnalytics","$translate","$tgConfig",e]),e=function(a,t,c,u,l,p,d,h){return{link:function(t,e,r){var n,i,o,s;return t.data={},t.data.email_token=p.email_token,n=e.find("form").checksley(),o=function(t){var e;return c.isAuthenticated()?(a.queryOne("users",c.getUser().id).then(function(t){return c.setUser(t)}),l.url(d.resolve("home"))):l.url(d.resolve("login")),e=h.instant("VERIFY_EMAIL_FORM.SUCCESS"),u.success(e)},i=function(t){t=h.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message});return u.notify("light-error",t)},s=function(){if(n.validate())return c.changeEmail(t.data).then(o,i)},e.on("submit",function(t){return t.preventDefault(),s()}),e.on("click","a.ng-submit-form",function(t){return t.preventDefault(),s()}),t.$on("$destroy",function(){return e.off()})}}},t.directive("tgVerifyEmail",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",e]),e=function(a,t,c,u,l,p,d,h){return{link:function(t,e,r){var n,i,o,s;return t.data={},t.data.email_token=p.email_token,n=e.find("form").checksley(),o=function(t){var e;return c.isAuthenticated()?(a.queryOne("users",c.getUser().id).then(function(t){return c.setUser(t)}),l.url(d.resolve("home"))):l.url(d.resolve("login")),e=h.instant("CHANGE_EMAIL_FORM.SUCCESS"),u.success(e)},i=function(t){t=h.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message});return u.notify("light-error",t)},s=function(){if(n.validate())return c.changeEmail(t.data).then(o,i)},e.on("submit",function(t){return t.preventDefault(),s()}),e.on("click","a.ng-submit-form",function(t){return t.preventDefault(),s()}),t.$on("$destroy",function(){return e.off()})}}},t.directive("tgChangeEmail",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",e]),e=function(t,e,a,c,u,l,p){return{link:function(e,t,r){var n,i,o,s;return e.data={},e.data.cancel_token=l.cancel_token,n=t.find("form").checksley(),o=function(t){var e;return a.logout(),u.path(p.resolve("home")),e=$translate.instant("CANCEL_ACCOUNT.SUCCESS"),c.success(e)},i=function(t){t=$translate.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message});return c.notify("error",t)},s=b(2e3,function(t){if(t.preventDefault(),n.validate())return a.cancelAccount(e.data).then(o,i)}),t.on("submit","form",s),e.$on("$destroy",function(){return t.off()})}}},t.directive("tgCancelAccount",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls",e])}.call(this),function(){angular.module("taigaBacklog",[])}.call(this),function(){this.taiga,this.taiga.groupBy,this.taiga.bindOnce;var r,t=angular.module("taigaBase",[]),e=function(n,i){return{link:function(t,e,r){return i.onresize=function(){return n.$broadcast("resize")}}}};t.directive("tgMain",["$rootScope","$window",e]),r={home:"/",projects:"/projects",error:"/error","not-found":"/not-found","permission-denied":"/permission-denied",discover:"/discover","discover-search":"/discover/search",login:"/login","forgot-password":"/forgot-password","change-password":"/change-password/:token","change-email":"/change-email/:token","verified-email":"/change-email/:token","cancel-account":"/cancel-account/:token",register:"/register",invitation:"/invitation/:token","create-project":"/project/new","create-project-scrum":"/project/new/scrum","create-project-kanban":"/project/new/kanban","create-project-duplicate":"/project/new/duplicate","create-project-import":"/project/new/import","create-project-import-platform":"/project/new/import/:platform",profile:"/profile","user-profile":"/profile/:username","blocked-project":"/blocked-project/:project",project:"/project/:project","project-detail-ref":"/project/:project/t/:ref","project-backlog":"/project/:project/backlog","project-taskboard":"/project/:project/taskboard/:sprint","project-kanban":"/project/:project/kanban","project-issues":"/project/:project/issues","project-epics":"/project/:project/epics","project-search":"/project/:project/search","project-timeline":"/project/:project/timeline","project-epics-detail":"/project/:project/epic/:ref","project-userstories-detail":"/project/:project/us/:ref","project-tasks-detail":"/project/:project/task/:ref","project-issues-detail":"/project/:project/issue/:ref","project-wiki":"/project/:project/wiki","project-wiki-list":"/project/:project/wiki-list","project-wiki-page":"/project/:project/wiki/:slug","project-team":"/project/:project/team","project-admin-home":"/project/:project/admin/project-profile/details","project-admin-project-profile-details":"/project/:project/admin/project-profile/details","project-admin-project-profile-default-values":"/project/:project/admin/project-profile/default-values","project-admin-project-profile-modules":"/project/:project/admin/project-profile/modules","project-admin-project-profile-export":"/project/:project/admin/project-profile/export","project-admin-project-profile-reports":"/project/:project/admin/project-profile/reports","project-admin-project-values-status":"/project/:project/admin/project-values/status","project-admin-project-values-points":"/project/:project/admin/project-values/points","project-admin-project-values-priorities":"/project/:project/admin/project-values/priorities","project-admin-project-values-severities":"/project/:project/admin/project-values/severities","project-admin-project-values-types":"/project/:project/admin/project-values/types","project-admin-project-values-custom-fields":"/project/:project/admin/project-values/custom-fields","project-admin-project-values-tags":"/project/:project/admin/project-values/tags","project-admin-project-values-due-dates":"/project/:project/admin/project-values/due-dates","project-admin-project-values-kanban-power-ups":"/project/:project/admin/project-values/kanban-power-ups","project-admin-memberships":"/project/:project/admin/memberships","project-admin-roles":"/project/:project/admin/roles","project-admin-third-parties-webhooks":"/project/:project/admin/third-parties/webhooks","project-admin-third-parties-github":"/project/:project/admin/third-parties/github","project-admin-third-parties-gitlab":"/project/:project/admin/third-parties/gitlab","project-admin-third-parties-bitbucket":"/project/:project/admin/third-parties/bitbucket","project-admin-third-parties-gogs":"/project/:project/admin/third-parties/gogs","project-admin-contrib":"/project/:project/admin/contrib/:plugin","user-settings-user-profile":"/user-settings/user-profile","user-settings-user-change-password":"/user-settings/user-change-password","user-settings-user-avatar":"/user-settings/user-avatar","user-settings-user-project-settings":"/user-settings/user-project-settings","user-settings-mail-notifications":"/user-settings/mail-notifications","user-settings-live-notifications":"/user-settings/live-notifications","user-settings-web-notifications":"/user-settings/web-notifications","user-settings-contrib":"/user-settings/contrib/:plugin",notifications:"/notifications"},e=function(t,e){return t.debug("Initialize navigation urls"),e.update(r)},t.run(["$log","$tgNavUrls",e])}.call(this),function(){var t,e,r,i=[].slice,o={}.hasOwnProperty;function n(t,e,r,n){this.qqueue=t,this.repo=e,this.q=r,this.model=n}r=this.taiga,t=function(e,r,n){return{get:function(){var t=n.getUser(),t=(null!=t?t.lang:void 0)||e.preferredLanguage(),t=-1<r.get("rtlLanguages",[]).indexOf(t);return{i18n:{previousMonth:e.instant("COMMON.PICKERDATE.PREV_MONTH"),nextMonth:e.instant("COMMON.PICKERDATE.NEXT_MONTH"),months:[e.instant("COMMON.PICKERDATE.MONTHS.JAN"),e.instant("COMMON.PICKERDATE.MONTHS.FEB"),e.instant("COMMON.PICKERDATE.MONTHS.MAR"),e.instant("COMMON.PICKERDATE.MONTHS.APR"),e.instant("COMMON.PICKERDATE.MONTHS.MAY"),e.instant("COMMON.PICKERDATE.MONTHS.JUN"),e.instant("COMMON.PICKERDATE.MONTHS.JUL"),e.instant("COMMON.PICKERDATE.MONTHS.AUG"),e.instant("COMMON.PICKERDATE.MONTHS.SEP"),e.instant("COMMON.PICKERDATE.MONTHS.OCT"),e.instant("COMMON.PICKERDATE.MONTHS.NOV"),e.instant("COMMON.PICKERDATE.MONTHS.DEC")],weekdays:[e.instant("COMMON.PICKERDATE.WEEK_DAYS.SUN"),e.instant("COMMON.PICKERDATE.WEEK_DAYS.MON"),e.instant("COMMON.PICKERDATE.WEEK_DAYS.TUE"),e.instant("COMMON.PICKERDATE.WEEK_DAYS.WED"),e.instant("COMMON.PICKERDATE.WEEK_DAYS.THU"),e.instant("COMMON.PICKERDATE.WEEK_DAYS.FRI"),e.instant("COMMON.PICKERDATE.WEEK_DAYS.SAT")],weekdaysShort:[e.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN"),e.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON"),e.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE"),e.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED"),e.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU"),e.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI"),e.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT")]},isRTL:t,firstDay:parseInt(e.instant("COMMON.PICKERDATE.FIRST_DAY_OF_WEEK"),10),format:e.instant("COMMON.PICKERDATE.FORMAT")}}}},(e=angular.module("taigaCommon",[])).factory("tgDatePickerConfigService",["$translate","$tgConfig","$tgAuth",t]),t=function(t,e){return{get:function(){return t.getSelection?t.getSelection().toString():e.selection?e.selection.createRange().text:""}}},e.factory("$selectedText",["$window","$document",t]),(t=function(s){var a=function(t,e,r){if(e&&r&&-1<e.get("my_permissions").indexOf(r))return t.removeClass("hidden")};return{link:function(t,e,r){var n,i,o;return e.addClass("hidden"),n=r.tgCheckPermission,o=t.$watch(function(){return s.project},function(){if(s.project)return a(e,s.project,n),o()}),i=r.$observe("tgCheckPermission",function(t){if(t)return a(e,s.project,t),i()}),t.$on("$destroy",function(){return e.off()})}}}).$inject=["tgProjectService"],e.directive("tgCheckPermission",t),t=function(){return{link:function(o,i,s){var a,c=function(t,e,r){var n="!"===r[0];return n&&(r=r.slice(1)),!(n&&-1===t.my_permissions.indexOf(r)||!n&&-1!==t.my_permissions.indexOf(r))?i.removeClass(e):i.addClass(e)},t=function(t){var e,r,n,i;if(t){for(e in a(),i=[],r=o.$eval(s.tgClassPermission))n=r[e],i.push(c(t,e,n));return i}};return a=o.$watch("project",t)}}},e.directive("tgClassPermission",t),t=function(){var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,o=function(t){if(s.shift()(),s.length)return i(o)},s=[];return{add:function(){for(var t,e=[],r=0,n=arguments.length;r<n;r++)t=arguments[r],s.push(t),1===s.length?e.push(i(o)):e.push(void 0);return e}}},e.factory("animationFrame",t),t=function(){return{link:function(t,e,r){return e.find("textarea").on("focus",function(){return e.addClass("active")})}}},e.directive("tgToggleComment",t),t=function(r){return{get:function(t){var e;return t.toJS&&(t=t.toJS()),e={project:t.slug},t.is_backlog_activated&&-1<t.my_permissions.indexOf("view_us")?r.resolve("project-backlog",e):t.is_kanban_activated&&-1<t.my_permissions.indexOf("view_us")?r.resolve("project-kanban",e):t.is_wiki_activated&&-1<t.my_permissions.indexOf("view_wiki_pages")?r.resolve("project-wiki",e):t.is_issues_activated&&-1<t.my_permissions.indexOf("view_issues")?r.resolve("project-issues",e):r.resolve("project",e)}}},e.factory("$projectUrl",["$tgNavUrls",t]),t=function(t){var r,e,n,t=t.defer();return t.resolve(),r=t.promise,e={bindAdd:(n=this,function(e){return function(){var t=1<=arguments.length?i.call(arguments,0):[];return r=r.then(function(){return e.apply(n,t)})}}),add:function(t){return r=r?r.then(t):t(),e}}},e.factory("$tgQqueue",["$q",t]),function(t,e){for(var r in e)o.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,r.Service),n.$inject=["$tgQqueue","$tgRepo","$q","$tgModel"],n.prototype.setObject=function(t,e){this.scope=t,this.prop=e},n.prototype.clone=function(){var t=_.cloneDeep(this.scope[this.prop]._attrs);return this.model.make_model(this.scope[this.prop]._name,t)},n.prototype.getObj=function(){return this.scope[this.prop]},n.prototype.save=function(n){var i,o=this.q.defer();return this.qqueue.add((i=this,function(){var t,e=i.getObj(),r=e.comment;return e.comment="",t=i.clone(),e=_.omit(e._modifiedAttrs,["version"]),t=_.assign(t,e),n(t),r.length&&(t.comment=r),r=function(){return i.scope[i.prop]=t,o.resolve.apply(null,arguments)},i.repo.save(t).then(r,o.reject)})),o.promise},e.service("$tgQueueModelTransformation",n),r=function(r){return{get:function(t,e){return null==e&&(e=!1),t=r.get(t),e&&(t=_.template(t)),t}}},e.factory("$tgTemplate",["$templateCache",r]),r=function(){return{template:"<tg-svg class=\"capslock\" ng-if=\"capslockIcon && iscapsLockActivated\" svg-icon='icon-capslock' svg-title='COMMON.CAPSLOCK_WARNING'></tg-svg>"}},e.directive("tgCapslock",[r]),r=function(){return{scope:{svgIcon:"@",svgTitle:"@",svgTitleTranslate:"@",svgTitleTranslateValues:"=",svgFill:"="},template:'<svg class="{{ \'icon \' + svgIcon }}" style="fill: {{ svgFill }}">\n    <use xlink:href="" ng-attr-xlink:href="{{ \'#\' + svgIcon }}" ng-attr-href="{{ \'#\' + svgIcon }}">\n        <title ng-if="svgTitle">{{svgTitle}}</title>\n        <title ng-if="svgTitleTranslate">{{svgTitleTranslate | translate: svgTitleTranslateValues}}</title>\n    </use>\n</svg>'}},e.directive("tgSvg",[r]),r=function(n,i,t){return{restrict:"A",link:function(t,e,r){return r.ngShow?(r=i(r.ngShow),t.$watch(r,function(t){if(!0===t)return n(function(){return e[0].focus()})})):n(function(){return e[0].focus()})}}},e.directive("tgAutofocus",["$timeout","$parse","animationFrame",r]),e.directive("tgPreloadImage",function(){var s="<img class='loading-spinner' src='"+window._version+"/svg/spinner-circle.svg' alt='loading...' />",a=function(t,e){var r=new Image;return r.onload=e,r.src=t,r};return{template:"<div>\n    <ng-transclude></ng-transclude>\n</div>",transclude:!0,replace:!0,link:function(t,e,r){var n=e.find("img:last"),i=null,o=function(){if(e.find(".loading-spinner").remove(),n.show(),i)return clearTimeout(i),i=null};return r.$observe("preloadSrc",function(t){return i&&clearTimeout(i),e.find(".loading-spinner").remove(),i=setTimeout(function(){return e.prepend(s)},200),n.hide(),a(t,o)})}}})}.call(this),function(){var t;function e(t,e,r,n,i){var o;this.params=t,this.repo=e,this.projectService=r,this.navurls=n,this.location=i,this.repo.resolve({pslug:this.params.pslug,ref:this.params.ref}).then((o=this,function(t){var e;return t.issue?e=o.navurls.resolve("project-issues-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.task?e=o.navurls.resolve("project-tasks-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.us?e=o.navurls.resolve("project-userstories-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.epic?e=o.navurls.resolve("project-epics-detail",{project:o.projectService.project.get("slug"),ref:o.params.ref}):t.wikipage&&(e=o.navurls.resolve("project-wiki-page",{project:o.projectService.project.get("slug"),slug:o.params.ref})),o.location.path(e)}))}this.taiga,this.taiga.mixOf,this.taiga.toString,this.taiga.joinStr,this.taiga.groupBy,this.taiga.bindOnce,this.taiga.bindMethods,t=angular.module("taigaCommon"),e.$inject=["$routeParams","$tgRepo","tgProjectService","$tgNavUrls","$location"],t.controller("DetailController",e)}.call(this),function(){angular.module("taigaEpics",[])}.call(this),function(){var s,c,t,i,r;function e(t,e,r,n,i,o){var s,a;this.win=t,this.log=e,this.config=r,this.auth=n,this.liveAnnouncementService=i,this.rootScope=o,this.processMessage=(s=this.processMessage,a=this,function(){return s.apply(a,arguments)}),c(this)}function n(){}r=this.taiga,i=this.taiga.startswith,c=this.taiga.bindMethods,t=angular.module("taigaEvents",[]),e.prototype.initialize=function(t){if(this.sessionId=t,this.subscriptions={},this.connected=!1,this.error=!1,this.pendingMessages=[],this.reconnectTryInterval=this.config.get("eventsReconnectTryInterval",1e4),this.maxConnectionErrors=this.config.get("eventsMaxConnectionErrors",5),this.errors=0,this.missedHeartbeats=0,this.heartbeatInterval=null,void 0===this.win.WebSocket)return this.log.info("WebSockets not supported on your browser")},e.prototype.setupConnection=function(){var t,e,r,n;if(this.stopExistingConnection(),n=this.config.get("eventsUrl"))return i(n,"ws:")||i(n,"wss:")||(r="https:"===(t=this.win.location).protocol?"wss:":"ws:",e=_.trimStart(n,"/"),n=r+"//"+t.host+"/"+e),this.error=!1,this.ws=new this.win.WebSocket(n),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("error",this.onError),this.ws.addEventListener("close",this.onClose)},e.prototype.stopExistingConnection=function(){if(void 0!==this.ws)return this.ws.removeEventListener("open",this.onOpen),this.ws.removeEventListener("close",this.onClose),this.ws.removeEventListener("error",this.onError),this.ws.removeEventListener("message",this.onMessage),this.stopHeartBeatMessages(),this.ws.close(),delete this.ws},e.prototype.notifications=function(){return this.subscribe(null,"notifications",(e=this,function(t){return e.liveAnnouncementService.show(t.title,t.desc),e.rootScope.$digest()}));var e},e.prototype.liveNotifications=function(){var e;if(null!=this.auth.userData){var t,r=this.auth.userData.get("id");return t=this,e=function(){return t.subscribe(null,"live_notifications."+r,function(t){var e=new Notification(t.title,{icon:"/"+window._version+"/images/favicon.png",body:t.body,tag:t.id});if(e.onshow=function(){if(t.timeout&&0<t.timeout)return setTimeout(function(){return e.close()},t.timeout)},t.url)return e.onclick=function(){return window.open(t.url)}})},window.Notification?"granted"===Notification.permission?e():"denied"!==Notification.permission?Notification.requestPermission(function(t){if("granted"===t)return e()}):void 0:this.log.info("This browser does not support desktop notification")}},e.prototype.webNotifications=function(){var t,e;if(null!=this.auth.userData)return t="web_notifications."+this.auth.userData.get("id"),r.randomInt(700,1e3),this.subscribe(null,t,(e=this,function(t){return e.rootScope.$broadcast("notifications:new")}))},e.prototype.startHeartBeatMessages=function(){if(!this.heartbeatInterval){var e,t=this.config.get("eventsMaxMissedHeartbeats",5),r=this.config.get("eventsHeartbeatIntervalTime",6e4);return this.missedHeartbeats=0,this.heartbeatInterval=setInterval((e=this,function(){try{if(e.missedHeartbeats>=t)throw new Error("Too many missed heartbeats PINGs.");return e.missedHeartbeats++,e.sendMessage({cmd:"ping"}),e.log.debug("HeartBeat send PING")}catch(t){return e.log.error("HeartBeat error: "+t.message),e.setupConnection()}}),r),this.log.debug("HeartBeat enabled")}},e.prototype.stopHeartBeatMessages=function(){if(this.heartbeatInterval)return clearInterval(this.heartbeatInterval),this.heartbeatInterval=null,this.log.debug("HeartBeat disabled")},e.prototype.processHeartBeatPongMessage=function(t){return this.missedHeartbeats=0,this.log.debug("HeartBeat received PONG")},e.prototype.serialize=function(t){return _.isObject(t)?JSON.stringify(t):t},e.prototype.sendMessage=function(t){var e,r,n,i,o;if(this.pendingMessages.push(t),this.connected){for(n=_.map(this.pendingMessages,this.serialize),this.pendingMessages=[],o=[],e=0,r=n.length;e<r;e++)i=n[e],o.push(this.ws.send(i));return o}},e.prototype.processMessage=function(t){var e,r=t.routing_key;if(null!=this.subscriptions[r])return(e=this.subscriptions[r]).scope?e.scope.$apply(function(){return e.callback(t.data)}):e.callback(t.data)},e.prototype.subscribe=function(t,e,r,n){var i,o;if(!this.error)return this.log.debug("Subscribe to: "+e),i={scope:t,routingKey:e,callback:r},r={cmd:"subscribe",routing_key:e},n&&(r.options=n),this.subscriptions[e]=i,this.sendMessage(r),t?t.$on("$destroy",(o=this,function(){return o.unsubscribe(e)})):void 0},e.prototype.unsubscribe=function(t){if(!this.error)return this.log.debug("Unsubscribe from: "+t),t={cmd:"unsubscribe",routing_key:t},this.sendMessage(t)},e.prototype.onOpen=function(){var t;return this.connected=!0,this.log.debug("WebSocket connection opened"),t={cmd:"auth",data:{token:this.auth.getToken(),sessionId:this.sessionId}},this.sendMessage(t),this.startHeartBeatMessages(),this.notifications(),this.liveNotifications(),this.webNotifications()},e.prototype.onMessage=function(t){return this.log.debug("WebSocket message received: "+t.data),"pong"===(t=JSON.parse(t.data)).cmd?this.processHeartBeatPongMessage(t):this.processMessage(t)},e.prototype.onError=function(t){return this.log.error("WebSocket error: "+t),this.error=!0,this.errors++,this.errors<this.maxConnectionErrors?setTimeout(this.setupConnection,this.randomTryInterval()):this.log.error("Events are disabled: the maximum number of connection errors has been reached.")},e.prototype.onClose=function(){if(this.log.debug("WebSocket closed."),this.connected=!1,this.stopHeartBeatMessages(),!this.error)return setTimeout(this.setupConnection,this.randomTryInterval())},e.prototype.randomTryInterval=function(){var t=this.reconnectTryInterval/2,e=this.reconnectTryInterval;return Math.floor(Math.random()*(e-t+1))+t},s=e,n.prototype.setSessionId=function(t){return this.sessionId=t},(n.prototype.$get=function(t,e,r,n,i,o){o=new s(t,e,r,n,i,o);return o.initialize(this.sessionId),o}).$inject=["$window","$log","$tgConfig","$tgAuth","tgLiveAnnouncementService","$rootScope"],t.provider("$tgEvents",n)}.call(this),function(){this.taiga,this.taiga.groupBy,this.taiga.bindOnce,this.taiga.mixOf;var l=this.taiga.debounce,t=(this.taiga.trim,function(s,a,c,u,t){return{link:function(r,n,t){var i=n.find("form").checksley(),e=l(2e3,function(t){var e;if(t.preventDefault(),i.validate())return e=u().target(o).start(),(t=a.create("feedback",r.feedback)).then(function(t){return e.finish(),s.close(n),c.notify("success","\\o/ we'll be happy to read your")}),t.then(null,function(){return e.finish(),c.notify("error")})}),o=n.find(".submit-button");return n.on("submit","form",e),e=function(){return r.feedback={},s.open(n),n.find("textarea").focus()},r.$on("$destroy",function(){return n.off()}),e()},templateUrl:"common/lightbox-feedback.html",scope:{}}});angular.module("taigaFeedback",[]).directive("tgLbFeedback",["lightboxService","$tgRepo","$tgConfirm","$tgLoading","tgFeedbackService",t])}.call(this),function(){angular.module("taigaIntegrations",[])}.call(this),function(){angular.module("taigaIssues",[])}.call(this),function(){angular.module("taigaKanban",[])}.call(this),function(){angular.module("taigaPlugins",["ngRoute"])}.call(this),function(){angular.module("taigaProject",[])}.call(this),function(){var h=this.taiga,g=(this.taiga.trim,this.taiga.debounce),t=angular.module("taigaRelatedTasks",[]),e=function(a,c,u,l,p,t,d,h){var f=t.get("task/related-task-row.html",!0),m=t.get("task/related-task-row-edit.html",!0);return{link:function(i,o,t,s){var e=g(2e3,function(t){var e,r;return t.subject=o.find("input").val(),e=p().target(o.find(".task-name")).start(),(r=a.save(t)).then(function(){return e.finish(),l.$broadcast("related-tasks:update")}),r.then(null,function(){return e.finish(),o.find("input").val(t.subject),u.notify("error")}),r}),r=function(t){return this.childScope&&this.childScope.$destroy(),this.childScope=i.$new(),o.off(),o.html(c(m({task:t}))(childScope)),o.find(".task-name input").val(t.subject),o.on("keyup","input",function(t){return 13===t.keyCode?e(s.$modelValue).then(function(){return n(s.$modelValue)}):27===t.keyCode?n(s.$modelValue):void 0}),o.on("click",".save-task",function(t){return e(s.$modelValue).then(function(){return n(s.$modelValue)})}),o.on("click",".cancel-edit",function(t){return n(s.$modelValue)})},n=function(n){var t={modify_task:-1!==i.project.my_permissions.indexOf("modify_task"),delete_task:-1!==i.project.my_permissions.indexOf("delete_task")};return o.html(c(f({task:n,perms:t,emojify:function(t){return h.replaceEmojiNameByHtmlImgs(_.escape(t))}}))(i)),o.on("click",".edit-task",function(){return r(s.$modelValue),o.find("input").focus().select()}),o.on("click",".delete-task",function(t){var e=d.instant("TASK.TITLE_DELETE_ACTION"),r=(n=s.$modelValue).subject;return u.askOnDelete(e,r).then(function(t){var e=a.remove(n);return e.then(function(){return t.finish(),i.$emit("related-tasks:delete")}),e.then(null,function(){return t.finish(!1),u.notify("error")})})})};return i.$watch(t.ngModel,function(t){if(t)return n(t)}),i.$on("related-tasks:assigned-to-changed",function(){return l.$broadcast("related-tasks:update")}),i.$on("related-tasks:status-changed",function(){return l.$broadcast("related-tasks:update")}),i.$on("$destroy",function(){return o.off()})},require:"ngModel"}};t.directive("tgRelatedTaskRow",["$tgRepo","$compile","$tgConfirm","$rootScope","$tgLoading","$tgTemplate","$translate","$tgEmojis",e]),e=function(a,t,c,u,l,p){var d={subject:"",assigned_to:null};return{scope:!0,link:function(n,i,t){var e=function(t){var e,r;return t.subject=i.find("input").val(),t.assigned_to=n.newTask.assigned_to,t.status=n.newTask.status,n.newTask.status=n.project.default_task_status,n.newTask.assigned_to=null,e=l().target(i.find(".task-name")).start(),(r=a.create("tasks",t)).then(function(){return p.trackEvent("task","create","create task on userstory",1),e.finish(),n.$emit("related-tasks:add")}),r.then(null,function(){return i.find("input").val(t.subject),e.finish(),c.notify("error")}),r},r=function(){return i.off(),n.openNewRelatedTask=!1},o=function(){return(d={subject:"",assigned_to:null}).status=n.project.default_task_status,d.project=n.project.id,d.user_story=n.us.id,n.newTask=u.make_model("tasks",d)},s=function(){if(!n.openNewRelatedTask)return n.openNewRelatedTask=!0,i.on("submit","form",function(t){return t.preventDefault(),e(d).then(function(){return o(),i.find("input").focus()})}),i.on("keyup","input",function(t){if(27===t.keyCode)return n.$apply(r)})};return n.save=function(){return e(d).then(r)},h.bindOnce(n,"us",o),n.$on("related-tasks:show-form",function(){return n.$apply(s)}),n.$on("$destroy",function(){return i.off()})},templateUrl:"task/related-task-create-form.html"}},t.directive("tgRelatedTaskCreateForm",["$tgRepo","$compile","$tgConfirm","$tgModel","$tgLoading","$tgAnalytics",e]),e=function(t,n,e,r,i){var o=i.get("common/components/add-button.html",!0);return{link:function(e,r,t){return e.$watch("project",function(t){if(t)return r.off(),-1!==e.project.my_permissions.indexOf("add_task")?r.html(n(o())(e)):r.html(""),r.on("click",".add-button",function(t){return e.$emit("related-tasks:add-new-clicked")})}),e.$on("$destroy",function(){return r.off()})}}},t.directive("tgRelatedTaskCreateButton",["$tgRepo","$compile","$tgConfirm","$tgModel","$tgTemplate",e]),e=function(t,o,s){return{link:function(t,e,r){var n=function(){return o.tasks.list(t.projectId,null,t.usId).then(function(t){return Immutable.fromJS(t.data)})},i=function(){return!!t.project&&-1!==t.project.my_permissions.indexOf("view_tasks")};return t.reorderTask=function(t,e){return s.$broadcast("task:reorder",t,e)},t.showAddTaks=function(){return!!t.project&&-1!==t.project.my_permissions.indexOf("add_task")},t.showRelatedTasks=i,t.$on("related-tasks:add",function(){return n().then(function(){return s.$broadcast("related-tasks:update")})}),t.$on("related-tasks:reordered",n),t.$on("related-tasks:delete",function(){return n().then(function(){return s.$broadcast("related-tasks:update")})}),t.$on("related-tasks:add-new-clicked",function(){return t.$broadcast("related-tasks:show-form")}),h.bindOnce(t,"us",function(t){return n()}),t.$on("$destroy",function(){return e.off()})}}},t.directive("tgRelatedTasks",["$tgRepo","$tgResources","$rootScope",e]),e=function(s,t,a,c,u){var l=_.template('<img style="background-color: <%- bg %>" src="<%- imgurl %>" alt="<%- name %>"/>\n<figcaption><%- name %></figcaption>');return{link:function(n,i,t){var e=function(t){var e={name:a.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED")},r=n.usersById[t.assigned_to],t=c.getAvatar(r);return e.imgurl=t.url,e.bg=t.bg,r&&(e.name=r.full_name_display),i.find(".avatar").html(l(e)),i.find(".task-assignedto").attr("title",e.name)},r=(i.controller(),n.$eval(t.tgRelatedTaskAssignedToInlineEdition)),o=!n.$eval(t.notAutoSave);return n.$watch(t.tgRelatedTaskAssignedToInlineEdition,function(){return r=n.$eval(t.tgRelatedTaskAssignedToInlineEdition),e(r)}),e(r),i.on("click",".task-assignedto",function(t){return t.preventDefault(),t.stopPropagation(),t=function(t){if(r.assigned_to=t.pop()||null,o)return s.save(r).then(function(){return n.$emit("related-tasks:assigned-to-changed"),e(r)})},u.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:[r.assigned_to],activeUsers:n.activeUsers,onClose:t,single:!0,lbTitle:a.instant("COMMON.ASSIGNED_USERS.ADD")})}),h.bindOnce(n,"project",function(t){if(-1===t.my_permissions.indexOf("modify_task"))return i.unbind("click"),i.find("a").addClass("not-clickable")}),n.$on("$destroy",function(){return i.off()})}}},t.directive("tgRelatedTaskAssignedToInlineEdition",["$tgRepo","$rootScope","$translate","tgAvatarService","tgLightboxFactory",e])}.call(this),function(){var t,e,r,n,i,o={}.hasOwnProperty;function s(){return s.__super__.constructor.apply(this,arguments)}(function(t,e){for(var r in e)o.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(s,this.taiga.Service),t=s,i={auth:"/auth","auth-register":"/auth/register",invitations:"/invitations",refresh:"/auth/refresh",users:"/users",by_username:"/users/by_username","users-password-recovery":"/users/password_recovery","users-change-password-from-recovery":"/users/change_password_from_recovery","users-change-password":"/users/change_password","users-change-email":"/users/change_email","users-cancel-account":"/users/cancel","users-export":"/users/export","user-stats":"/users/%s/stats","user-liked":"/users/%s/liked","user-voted":"/users/%s/voted","user-watched":"/users/%s/watched","user-contacts":"/users/%s/contacts","user-me":"/users/me","user-send-verification-email":"/users/send_verification_email",permissions:"/permissions","notify-policies":"/notify-policies",notifications:"/web-notifications","user-project-settings":"/user-project-settings","user-storage":"/user-storage",memberships:"/memberships","bulk-create-memberships":"/memberships/bulk_create",roles:"/roles",resolver:"/resolver",projects:"/projects","project-templates":"/project-templates","project-modules":"/projects/%s/modules","bulk-update-projects-order":"/projects/bulk_update_order","project-like":"/projects/%s/like","project-unlike":"/projects/%s/unlike","project-watch":"/projects/%s/watch","project-unwatch":"/projects/%s/unwatch","project-contact":"contact","project-transfer-validate-token":"/projects/%s/transfer_validate_token","project-transfer-accept":"/projects/%s/transfer_accept","project-transfer-reject":"/projects/%s/transfer_reject","project-transfer-request":"/projects/%s/transfer_request","project-transfer-start":"/projects/%s/transfer_start","epic-statuses":"/epic-statuses","userstory-statuses":"/userstory-statuses","userstory-due-dates":"/userstory-due-dates","userstory-due-dates-create-default":"/userstory-due-dates/create_default",points:"/points","task-statuses":"/task-statuses","task-due-dates":"/task-due-dates","task-due-dates-create-default":"/task-due-dates/create_default","issue-statuses":"/issue-statuses","issue-due-dates":"/issue-due-dates","issue-due-dates-create-default":"/issue-due-dates/create_default","issue-types":"/issue-types",priorities:"/priorities",severities:"/severities",milestones:"/milestones","move-userstories-to-milestone":"/milestones/%s/move_userstories_to_sprint","move-tasks-to-milestone":"/milestones/%s/move_tasks_to_sprint","move-issues-to-milestone":"/milestones/%s/move_issues_to_sprint",epics:"/epics","epic-upvote":"/epics/%s/upvote","epic-downvote":"/epics/%s/downvote","epic-watch":"/epics/%s/watch","epic-unwatch":"/epics/%s/unwatch","epic-related-userstories":"/epics/%s/related_userstories","epic-related-userstories-bulk-create":"/epics/%s/related_userstories/bulk_create",userstories:"/userstories","bulk-create-us":"/userstories/bulk_create","bulk-update-us-backlog-order":"/userstories/bulk_update_backlog_order","bulk-update-us-milestone":"/userstories/bulk_update_milestone","bulk-update-us-miles-order":"/userstories/bulk_update_sprint_order","bulk-update-us-kanban-order":"/userstories/bulk_update_kanban_order","userstories-filters":"/userstories/filters_data","userstory-upvote":"/userstories/%s/upvote","userstory-downvote":"/userstories/%s/downvote","userstory-watch":"/userstories/%s/watch","userstory-unwatch":"/userstories/%s/unwatch",tasks:"/tasks","bulk-create-tasks":"/tasks/bulk_create","bulk-update-task-taskboard-order":"/tasks/bulk_update_taskboard_order","bulk-update-task-milestone":"/tasks/bulk_update_milestone","task-upvote":"/tasks/%s/upvote","task-downvote":"/tasks/%s/downvote","task-watch":"/tasks/%s/watch","task-unwatch":"/tasks/%s/unwatch","task-filters":"/tasks/filters_data","promote-task-to-us":"/tasks/%s/promote_to_user_story",issues:"/issues","bulk-create-issues":"/issues/bulk_create","bulk-update-issue-milestone":"/issues/bulk_update_milestone","issues-filters":"/issues/filters_data","issue-upvote":"/issues/%s/upvote","issue-downvote":"/issues/%s/downvote","issue-watch":"/issues/%s/watch","issue-unwatch":"/issues/%s/unwatch","promote-issue-to-us":"/issues/%s/promote_to_user_story",swimlanes:"/swimlanes","swimlane-userstory-statuses":"/swimlane-userstory-statuses",wiki:"/wiki","wiki-restore":"/wiki/%s/restore","wiki-links":"/wiki-links","history/epic":"/history/epic","history/us":"/history/userstory","history/issue":"/history/issue","history/task":"/history/task","history/wiki":"/history/wiki","attachments/epic":"/epics/attachments","attachments/us":"/userstories/attachments","attachments/issue":"/issues/attachments","attachments/task":"/tasks/attachments","attachments/wiki_page":"/wiki/attachments","attachments/wikipage":"/wiki/attachments","attachments/wiki":"/wiki/attachments","custom-attributes/epic":"/epic-custom-attributes","custom-attributes/userstory":"/userstory-custom-attributes","custom-attributes/task":"/task-custom-attributes","custom-attributes/issue":"/issue-custom-attributes","custom-attributes-values/epic":"/epics/custom-attributes-values","custom-attributes-values/userstory":"/userstories/custom-attributes-values","custom-attributes-values/task":"/tasks/custom-attributes-values","custom-attributes-values/issue":"/issues/custom-attributes-values",webhooks:"/webhooks","webhooks-test":"/webhooks/%s/test",webhooklogs:"/webhooklogs","webhooklogs-resend":"/webhooklogs/%s/resend","epics-csv":"/epics/csv?uuid=%s","userstories-csv":"/userstories/csv?uuid=%s","tasks-csv":"/tasks/csv?uuid=%s","issues-csv":"/issues/csv?uuid=%s","timeline-profile":"/timeline/profile","timeline-user":"/timeline/user","timeline-project":"/timeline/project",search:"/search",exporter:"/exporter",importer:"/importer/load_dump",feedback:"/feedback",locales:"/locales",applications:"/applications","application-tokens":"/application-tokens","stats-discover":"/stats/discover","importers-trello-auth-url":"/importers/trello/auth_url","importers-trello-authorize":"/importers/trello/authorize","importers-trello-list-projects":"/importers/trello/list_projects","importers-trello-list-users":"/importers/trello/list_users","importers-trello-import-project":"/importers/trello/import_project","importers-jira-auth-url":"/importers/jira/auth_url","importers-jira-authorize":"/importers/jira/authorize","importers-jira-list-projects":"/importers/jira/list_projects","importers-jira-list-users":"/importers/jira/list_users","importers-jira-import-project":"/importers/jira/import_project","importers-github-auth-url":"/importers/github/auth_url","importers-github-authorize":"/importers/github/authorize","importers-github-list-projects":"/importers/github/list_projects","importers-github-list-users":"/importers/github/list_users","importers-github-import-project":"/importers/github/import_project","importers-asana-auth-url":"/importers/asana/auth_url","importers-asana-authorize":"/importers/asana/authorize","importers-asana-list-projects":"/importers/asana/list_projects","importers-asana-list-users":"/importers/asana/list_users","importers-asana-import-project":"/importers/asana/import_project"},r=function(t,e){return t.debug("Initialize api urls"),e.update(i)},e=function(t,e){var r,n,i,o,s;for(t.debug("Initialize resources"),s=[],r=0,n=(o=_.toArray(arguments).slice(2)).length;r<n;r++)i=o[r],s.push(i(e));return s},(n=angular.module("taigaResources",["taigaBase"])).service("$tgResources",t),n.run(["$log","$tgUrls",r]),n.run(["$log","$tgResources","$tgProjectsResourcesProvider","$tgCustomAttributesResourcesProvider","$tgCustomAttributesValuesResourcesProvider","$tgMembershipsResourcesProvider","$tgNotifyPoliciesResourcesProvider","$tgInvitationsResourcesProvider","$tgRolesResourcesProvider","$tgUserProjectSettingsResourcesProvider","$tgUserSettingsResourcesProvider","$tgSprintsResourcesProvider","$tgEpicsResourcesProvider","$tgUserstoriesResourcesProvider","$tgTasksResourcesProvider","$tgIssuesResourcesProvider","$tgSwimlanesResourcesProvider","$tgWikiResourcesProvider","$tgSearchResourcesProvider","$tgMdRenderResourcesProvider","$tgHistoryResourcesProvider","$tgKanbanResourcesProvider","$tgModulesResourcesProvider","$tgWebhooksResourcesProvider","$tgWebhookLogsResourcesProvider","$tgLocalesResourcesProvider","$tgUsersResourcesProvider",e])}.call(this),function(){var f,p,m,e,t,r,n,v,i={}.hasOwnProperty;function o(t,e,r,n,i,o,s,a,c,u,l){var p,d,h;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.q=i,this.location=o,this.appMetaService=s,this.navUrls=a,this.translate=c,this.errorHandlingService=u,this.projectService=l,this.scope.sectionName="Search",this.loadInitialData(),u=this.translate.instant("SEARCH.PAGE_TITLE",{projectName:this.scope.project.name}),l=this.translate.instant("SEARCH.PAGE_DESCRIPTION",{projectName:this.scope.project.name,projectDescription:this.scope.project.description}),this.appMetaService.setAll(u,l),this.scope.searchTerm=null,m(100,(p=this,function(t){return p.loadSearchData(t)})),f(this.scope,"projectId",(d=this,function(t){if(!d.scope.searchResults&&d.scope.searchTerm)return d.loadSearchData()})),this.scope.$watch("searchTerm",(h=this,function(t){if(void 0!==t&&h.scope.projectId)return h.loadSearchData(t)}))}n=this.taiga,e=this.taiga.groupBy,f=this.taiga.bindOnce,t=this.taiga.mixOf,m=this.taiga.debounceLeading,v=this.taiga.trim,p=this.taiga.debounce,r=angular.module("taigaSearch",[]),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,t(n.Controller,n.PageMixin)),o.$inject=["$scope","$tgRepo","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$translate","tgErrorHandlingService","tgProjectService"],o.prototype.loadFilters=function(){var t=this.q.defer();return t.resolve(),t.promise},o.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.epicStatusById=e(t.epic_statuses,function(t){return t.id}),this.scope.issueStatusById=e(t.issue_statuses,function(t){return t.id}),this.scope.taskStatusById=e(t.task_statuses,function(t){return t.id}),this.scope.severityById=e(t.severities,function(t){return t.id}),this.scope.priorityById=e(t.priorities,function(t){return t.id}),this.scope.usStatusById=e(t.us_statuses,function(t){return t.id}),t},o.prototype.loadSearchData=function(t){return null==t&&(t=""),this.scope.loading=!0,this._loadSearchData(t).then((e=this,function(t){return e.scope.searchResults=t,e.scope.loading=!1}));var e},o.prototype._loadSearchData=function(t){return null==t&&(t=""),this._promise&&this._promise.abort(),this._promise=this.rs.search.do(this.scope.projectId,t),this._promise},o.prototype.loadInitialData=function(){var t=this.loadProject();return this.scope.projectId=t.id,this.fillUsersAndRoles(t.members,t.roles)},r.controller("SearchController",o),(n=function(s,a,c,u,l){return{templateUrl:"search/lightbox-search.html",link:function(n,i,t){var o=null,e=p(2e3,function(t){var e,r;if(t.preventDefault(),i.find("form").checksley().validate())return e=i.find("#search-text").val(),r=c.resolve("project-search",{project:o.get("slug")}),n.$apply(function(){return a.close(i),u.path(r),u.search("text",e).path(r),l.reload()})}),r=function(){return o=s.project,a.open(i).then(function(){return i.find("#search-text").focus()})};return i.on("submit","form",e),r()}}}).$inject=["tgProjectService","lightboxService","$tgNavUrls","$tgLocation","$route"],r.directive("tgSearchBox",n),n=function(t,h,f,i,m,g){var o=function(n,i,t,e){var c=!0,u="userstories",o=i.find(".search-filter"),s=null,r=function(t){var e,r,n,i,o,s=0,a={name:"userstories",value:[]};if(!c)return a.name=u,a.value=t[u],a;if(t)for(e=0,r=(i=["userstories","epics","issues","tasks","wikipages"]).length;e<r;e++)if((o=t[n=i[e]]).length>s){s=o.length,a.name=n,a.value=o;break}return a},a=function(t){var e,r,n=[];for(e in t)r=t[e],o.find("li."+e).show(),n.push(o.find("li."+e+" .num").html(r.length));return n},l=function(t){return o.find("a.active").removeClass("active"),o.find("li."+t.name+" a").addClass("active"),c=!1,u=t.name},p={epics:f.get("search-epics"),issues:f.get("search-issues"),tasks:f.get("search-tasks"),userstories:f.get("search-userstories"),wikipages:f.get("search-wikipages")},d=function(t){var e=i.find(".search-result-table").children(),r=e.scope();return r&&(r.$destroy(),e.remove()),(e=n.$new())[t.name]=t.value,t=angular.element.parseHTML(v(p[t.name])),e=h(t)(e),i.find(".search-result-table").html(e)};return n.$watch("searchResults",function(t){var e;if(s=t)return e=r(t),a(t),d(e),l(e)}),n.$watch("searchTerm",function(t){return void 0!==t&&m.search("text",t),g.trackPage(m.url(),"Search")}),i.on("click",".search-filter li > a",function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget).parent().data("name"),t=s?s[r]:[],e={name:r,value:t},n.$apply(function(){return d(e),l(e)})})};return{link:function(e,t,r){var n;t.controller();return o(e,t),n=i.text,e.$watch("projectId",function(t){if(null!=t)return e.searchTerm=n})}}},r.directive("tgSearch",["$log","$compile","$templateCache","$routeParams","$tgLocation","$tgAnalytics",n])}.call(this),function(){angular.module("taigaTaskboard",[])}.call(this),function(){angular.module("taigaTasks",[])}.call(this),function(){angular.module("taigaTeam",[])}.call(this),function(){angular.module("taigaUserSettings",[])}.call(this),function(){angular.module("taigaUserStories",[])}.call(this),function(){angular.module("taigaWiki",[])}.call(this),function(){var t,e,i={}.hasOwnProperty;function r(t,e,r,n,i,o){this.rootscope=t,this.log=e,this.config=r,this.win=n,this.doc=i,this.location=o,this.initialized=!1,o=this.config.get("analytics",{}),this.accountId=o.accountId,this.pageEvent=o.pageEvent||"$routeChangeSuccess",this.trackRoutes=o.trackRoutes||!0,this.ignoreFirstPageLoad=o.ignoreFirstPageLoad||!1}e=this.taiga,t=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e.Service),r.$inject=["$rootScope","$log","$tgConfig","$window","$document","$location"],r.prototype.initialize=function(){var t;if(this.accountId)return this.injectAnalytics(),this.win.ga("create",this.accountId,"auto"),this.win.ga("require","ec"),this.win.ga("require","displayfeatures"),this.trackRoutes&&!this.ignoreFirstPageLoad&&this.win.ga("send","pageview",this.getUrl()),this.trackRoutes&&this.rootscope.$on(this.pageEvent,(t=this,function(){return t.trackPage(t.getUrl(),"Taiga")})),this.initialized=!0,this.setUserId();this.log.debug("Analytics: no account id provided. Disabling.")},r.prototype.setUserId=function(){var t,e;if(this.initialized&&this.win.ga)return this.win.ga("set","userId",null!=(t=this.rootscope)&&null!=(e=t.user)?e.uuid:void 0)},r.prototype.getUrl=function(){return this.location.path()},r.prototype.injectAnalytics=function(){return function(t,e,r,n,i,o,s){t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=+new Date,o=e.createElement(r),s=e.getElementsByTagName(r)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga")},r.prototype.trackPage=function(t,e){if(this.initialized&&this.win.ga)return e=e||this.doc[0].title,this.win.ga("send","pageview",{page:t,title:e})},r.prototype.trackEvent=function(t,e,r,n){if(this.initialized&&this.win.ga)return this.win.ga("send","event",t,e,r,n)},r.prototype.ecViewPlan=function(t){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t.plan_id,name:t.name,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","detail"),this.trackEvent("ecommerce","view-product-detail",t.name,t.plan_id)},r.prototype.ecClickPlan=function(t){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t.plan_id,name:t.name,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","click"),this.trackEvent("ecommerce","click-product",t.name,t.plan_id)},r.prototype.ecListPlans=function(t,e){var r,n,i,o,s=t[0];if(this.initialized&&this.win.ga){for(o=1,r=0,n=s.length;r<n;r++)i=s[r],this.win.ga("ec:addImpression",{id:i.plan_id,name:i.name,list:e,position:o}),o++;return this.trackEvent("ecommerce","list-plans")}},r.prototype.ecAddToCart=function(t,e,r){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","add"),this.trackEvent("ecommerce","add-to-cart","Collect Payment Info",null)},r.prototype.ecConfirmChange=function(t,e,r){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","checkout",{step:1}),this.trackEvent("ecommerce","start-checkout","start",1)},r.prototype.ecPurchase=function(t,e,r){if(this.initialized&&this.win.ga)return this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","checkout",{step:2}),this.trackEvent("ecommerce","end-checkout","end",2),this.win.ga("ec:addProduct",{id:t,name:e,price:r,category:"plans",quantity:1,position:1}),this.win.ga("ec:setAction","purchase",{id:t,revenue:r}),this.trackEvent("ecommerce","checkout","Plan checkout",null)},t.service("$tgAnalytics",r)}.call(this),function(){var t=function(r){return r.debugInfo||(jQuery.fn.scope=function(){return this.data("scope")}),{link:function(t,e){if(!r.debugInfo)return e.data("scope",t).addClass("tg-scope")}}};angular.module("taigaCommon").directive("tgBindScope",["$tgConfig",t])}.call(this),function(){var t=function(i){return{link:function(r,n,t){return r.$watch(t.tgCompileHtml,function(t,e){return n.html(t),i(n.contents())(r)})}}};t.$inject=["$compile"],angular.module("taigaCommon").directive("tgCompileHtml",t)}.call(this),function(){this.taiga;var u=this.taiga.bindOnce,t=angular.module("taigaCommon"),e=function(i){var o=function(t,e,r){var n=i.instant("BACKLOG.SPRINTS.DATE"),e=moment(e).format(n),n=moment(r).format(n);return t.html(i.instant("TASKBOARD.TITLE_DATE_RANGE",{startDate:e,endDate:n}))};return{link:function(t,r,e){var n=e.tgDateRange.split(","),e=n[0],i=n[1];return u(t,e,function(e){return u(t,i,function(t){return o(r,e,t)})})}}};t.directive("tgDateRange",["$translate",e]),e=function(s,a){return{link:function(t,e,r,n){var i=function(){var t=a.get();return _.merge(t,{field:e[0]}),e.picker=new Pikaday(t)},o=s.$on("$translateChangeEnd",function(t){return e.picker&&e.picker.destroy(),i()});return r.$observe("pickerValue",function(t){return e.val(t),null!=t&&(e.picker&&e.picker.destroy(),i()),e.picker.setDate(t)}),t.$on("$destroy",function(){return e.off(),o(),e.picker.destroy()})}}},t.directive("tgDateSelector",["$rootScope","tgDatePickerConfigService",e]),e=function(){var o=function(t,e,r){return t.hasClass(".current-progress")?t.css("width",e+"%"):(t.find(".current-progress").css("width",r+"%"),t.find(".number").html(e+" %"))};return{link:function(t,i,e){return u(t,e.tgSprintProgressbar,function(t){var e=t.closed_points,r=t.total_points,n=0;return 0!==r&&(n=Math.round(e/r*100)),(t=0)!==r&&(t=Math.round(e/r*98)),o(i,n,t)}),t.$on("$destroy",function(){return i.off()})}}},t.directive("tgSprintProgressbar",e),e=function(t,e,n,i,o){return{link:function(r,t,e){return u(r,e.ngModel,function(t){var e;if(null!=t)return e=o.getAvatar(t.owner_extra_info),r.owner=t.owner_extra_info||{full_name_display:n.instant("COMMON.EXTERNAL_USER")},r.owner.avatar=e.url,r.owner.bg=e.bg,r.url=null!=(e=r.owner)&&e.is_active?i.resolve("user-profile",{username:r.owner.username}):"",r.date=moment(t.created_date).format(n.instant("COMMON.DATETIME"))}),r.$on("$destroy",function(){return t.off()})},restrict:"EA",require:"ngModel",scope:!0,templateUrl:"common/components/created-by.html"}},t.directive("tgCreatedByDisplay",["$tgTemplate","$compile","$translate","$tgNavUrls","tgAvatarService",e]),e=function(t,e,n,i,o){return{link:function(t,e,r){var r=r.tgUserId;return t.user=t.usersById[r]||{full_name_display:n.instant("COMMON.EXTERNAL_USER")},r=o.getAvatar(t.usersById[r]||null),t.user.avatar=r.url,t.user.bg=r.bg,t.url=t.user.is_active?i.resolve("user-profile",{username:t.user.username}):"",t.$on("$destroy",function(){return e.off()})},restrict:"EA",scope:!0,templateUrl:"common/components/user-display.html"}},t.directive("tgUserDisplay",["$tgTemplate","$compile","$translate","$tgNavUrls","tgAvatarService",e]),e=function(o,s,t){return{link:function(e,r,t,n){var i=function(){return-1!==e.project.my_permissions.indexOf("modify_us")};return e.$watch(t.ngModel,function(t){if(t)return e.item=t,i()?r.find(".button-lock").addClass("editable"):void 0}),r.on("click",".item-block",function(t){return t.preventDefault(),o.$broadcast("block",n.$modelValue)}),r.on("click",".item-unblock",function(t){var e;return t.preventDefault(),e=s().target(r.find(".item-unblock")).start(),t=function(){return e.finish()},o.$broadcast("unblock",n.$modelValue,t)}),e.$on("$destroy",function(){return r.off()})},restrict:"EA",require:"ngModel",template:t.get("common/components/block-button.html")}},t.directive("tgBlockButton",["$rootScope","$tgLoading","$tgTemplate",e]),e=function(e,s,a,c,t){return{link:function(n,t,i,o){return i.onDeleteGoToUrl?i.onDeleteTitle?(t.on("click",".button-delete",function(t){var e=i.onDeleteTitle,r=o.$modelValue.subject;return a.askOnDelete(e,r).then(function(e){var t=s.remove(o.$modelValue);return t.then(function(){var t;return e.finish(),t=n.$eval(i.onDeleteGoToUrl),c.path(t)}),t.then(null,function(){return e.finish(!1),a.notify("error")})})}),n.$on("$destroy",function(){return t.off()})):e.error("DeleteButtonDirective requires on-delete-title set in scope."):e.error("DeleteButtonDirective requires on-delete-go-to-url set in scope.")},restrict:"EA",require:"ngModel",template:t.get("common/components/delete-button.html")}},t.directive("tgDeleteButton",["$log","$tgRepo","$tgConfirm","$tgLocation","$tgTemplate",e]),e=function(){return{link:function(t,e,r){var n=t.$eval(r.tgListitemEpicStatus);return u(t,"epicStatusById",function(t){return e.text(t[n.status].name)})}}},t.directive("tgListitemEpicStatus",e),e=function(){return{link:function(t,e,r){var n=t.$eval(r.tgListitemUsStatus);return u(t,"usStatusById",function(t){return e.text(t[n.status].name)})}}},t.directive("tgListitemUsStatus",e),e=function(){return{link:function(t,e,r){var n=t.$eval(r.tgListitemTaskStatus);return u(t,"taskStatusById",function(t){return e.text(t[n.status].name)})}}},t.directive("tgListitemTaskStatus",e),e=function(t,s,a){var c=t.get("common/components/list-item-assigned-to-avatar.html",!0);return{link:function(n,i,o){return u(n,"usersById",function(t){var e=n.$eval(o.tgListitemAssignedto),r={name:s.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED")},t=t[e.assigned_to],e=a.getAvatar(t);return r.imgurl=e.url,r.bg=e.bg,t&&(r.name=t.full_name_display),i.html(c(r))})}}},t.directive("tgListitemAssignedto",["$tgTemplate","$translate","tgAvatarService",e]),e=function(){return{link:function(t,e,r){var n=t.$eval(r.tgListitemIssueStatus);return u(t,"issueStatusById",function(t){return e.text(t[n.status].name)})}}},t.directive("tgListitemIssueStatus",e),e=function(){return{link:function(r,n,i){var o=function(t,e){t=t[e.type],e=n.find(".level");return e.css("background-color",t.color),e.attr("title",t.name)};return u(r,"issueTypeById",function(t){var e=r.$eval(i.tgListitemType);return o(t,e)}),r.$watch(i.tgListitemType,function(t){return o(r.issueTypeById,t)})},templateUrl:"common/components/level.html"}},t.directive("tgListitemType",e),e=function(){return{link:function(r,n,i){var o=function(t,e){t=t[e.priority],e=n.find(".level");return e.css("background-color",t.color),e.attr("title",t.name)};return u(r,"priorityById",function(t){var e=r.$eval(i.tgListitemPriority);return o(t,e)}),r.$watch(i.tgListitemPriority,function(t){return o(r.priorityById,t)})},templateUrl:"common/components/level.html"}},t.directive("tgListitemPriority",e),e=function(){return{link:function(r,n,i){var o=function(t,e){t=t[e.severity],e=n.find(".level");return e.css("background-color",t.color),e.attr("title",t.name)};return u(r,"severityById",function(t){var e=r.$eval(i.tgListitemSeverity);return o(t,e)}),r.$watch(i.tgListitemSeverity,function(t){return o(r.severityById,t)})},templateUrl:"common/components/level.html"}},t.directive("tgListitemSeverity",e),e=function(t){var r=t.get("common/components/progress-bar.html",!0),n=function(t,e){return t.html(r({percentage:e}))};return{link:function(t,e,r){angular.element(e);return t.$watch(r.tgProgressBar,function(t){return t=_.max([0,t]),t=_.min([100,t]),n(e,t)}),t.$on("$destroy",function(){return e.off()})}}},t.directive("tgProgressBar",["$tgTemplate",e]),e=function(t){return{link:function(e,t,r){return r.$observe("i18nSectionName",function(t){return e.sectionName=t}),e.$on("$destroy",function(){return t.off()})},templateUrl:"common/components/main-title.html"}},t.directive("tgMainTitle",["$translate",e])}.call(this),function(){var t,c,o,u,p,d,l,i={}.hasOwnProperty;function e(t,e,r,n,i){this.q=t,this.lightboxService=e,this.loading=r,this.translate=n,this.filter=i,o(this)}d=this.taiga,l=this.taiga.timeout,u=this.taiga.cancelTimeout,p=this.taiga.debounce,o=this.taiga.bindMethods,c={success:{title:"NOTIFICATION.OK",message:"NOTIFICATION.SAVED"},error:{title:"NOTIFICATION.WARNING",message:"NOTIFICATION.WARNING_TEXT"},"light-error":{title:"NOTIFICATION.WARNING",message:"NOTIFICATION.WARNING_TEXT"}},function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,d.Service),e.$inject=["$q","lightboxService","$tgLoading","$translate","$filter"],e.prototype.hide=function(t){if(t)return this.lightboxService.close(t),t.off(".confirm-dialog")},e.prototype.ask=function(t,e,r,n){var i,o,s,a,c;return null==n&&(n=".lightbox-generic-ask"),i=this.q.defer(),(o=angular.element(n)).find(".title").text(t||""),o.find(".subtitle").text(e||""),r=r&&this.filter("textToHTML")(r),o.find(".message").html(r||""),o.on("click.confirm-dialog",".js-confirm",p(2e3,(s=this,function(t){var e,r;return t.preventDefault(),t=(r=angular.element(t.currentTarget)).width(),r.width(t),e=s.loading().target(r).start(),i.resolve({finish:function(t){if(null==t&&(t=!0),r.css("width",""),e.finish(),t)return s.hide(o)}})}))),o.on("click.confirm-dialog",".js-cancel",(a=this,function(t){return t.preventDefault(),i.reject(),a.hide(o)})),r=function(){return c.hide(o)},(c=this).lightboxService.open(o,null,r),i.promise},e.prototype.askDelete=function(t,e,r,n){var i,o,s,a,c;return null==n&&(n=".lightbox-generic-delete"),i=this.q.defer(),(o=angular.element(n)).find(".title").text(t||""),o.find(".subtitle").text(e||""),r=r&&this.filter("textToHTML")(r),o.find(".message").html(r||""),o.on("click.confirm-dialog",".js-confirm",p(2e3,(s=this,function(t){var e,r;return t.preventDefault(),t=(r=angular.element(t.currentTarget)).width(),r.width(t),e=s.loading().target(r).start(),i.resolve({finish:function(t){if(null==t&&(t=!0),r.css("width",""),e.finish(),t)return s.hide(o)}})}))),o.on("click.confirm-dialog",".js-cancel",(a=this,function(t){return t.preventDefault(),i.reject(),a.hide(o)})),r=function(){return c.hide(o)},(c=this).lightboxService.open(o,null,r),i.promise},e.prototype.askOnDelete=function(t,e,r){return null==r&&(r=this.translate.instant("NOTIFICATION.ASK_DELETE")),this.askDelete(t,r,e)},e.prototype.askChoice=function(t,e,r,n,i,o){var s,a,c,u,l;return null==o&&(o=".lightbox-ask-choice"),a=this.q.defer(),(c=angular.element(o)).find(".title").text(t),c.find(".subtitle").text(e),n?c.find(".replacement").text(n):c.find(".replacement").remove(),i?c.find(".warning").text(i):c.find(".warning").remove(),(s=c.find(".choices")).html(""),_.each(r,function(t,e){return t=_.escape(t),s.append(angular.element("<option value='"+e+"'>"+t+"</option>"))}),c.on("click.confirm-dialog",".js-confirm-ask",p(2e3,(u=this,function(t){var e;return t.preventDefault(),t=angular.element(t.currentTarget),e=u.loading().target(t).start(),a.resolve({selected:s.val(),finish:function(t){if(null==t&&(t=!0),e.finish(),t)return u.hide(c)}})}))),c.on("click.confirm-dialog",".js-cancel-ask",(l=this,function(t){return t.preventDefault(),a.reject(),l.hide(c)})),this.lightboxService.open(c),a.promise},e.prototype.error=function(t){var e,r,n=this.q.defer(),i=angular.element(".lightbox-generic-error");return i.find(".title").html(t),i.on("click.confirm-dialog",".button-green",(e=this,function(t){return t.preventDefault(),n.resolve(),e.hide(i)})),i.on("click.confirm-dialog",".close",(r=this,function(t){return t.preventDefault(),n.resolve(),r.hide(i)})),this.lightboxService.open(i),n.promise},e.prototype.success=function(t,e,r,n){var i,o,s,a,c,u=this.q.defer(),l=angular.element(".lightbox-generic-success");return l.find("img").remove(),l.find("svg").remove(),r&&("img"===r.type?i=$("<img>").addClass("lb-icon").attr("src",r.name):"svg"===r.type&&(i=document.createElement("div"),d.addClass(i,"icon"),d.addClass(i,r.name),d.addClass(i,"lb-icon"),o=document.createElementNS("http://www.w3.org/2000/svg","svg"),(s=document.createElementNS("http://www.w3.org/2000/svg","use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+r.name),i.appendChild(o).appendChild(s)),i&&l.find("section").prepend(i)),t&&l.find(".title").html(t),e&&l.find(".message").html(e),n&&(l.find(".js-confirm").html(n),l.find(".js-confirm").attr("title",n)),l.on("click.confirm-dialog",".js-confirm",(a=this,function(t){return t.preventDefault(),u.resolve(),a.hide(l)})),l.on("click.confirm-dialog",".close",(c=this,function(t){return t.preventDefault(),u.resolve(),c.hide(l)})),this.lightboxService.open(l),u.promise},e.prototype.loader=function(t,e,r){var i,n,o;return null==r&&(r=!1),i=angular.element(".lightbox-generic-loading"),t&&i.find(".title").html(t),e&&i.find(".message").html(e),r&&i.find(".spin").removeClass("hidden"),{start:function(){return o.lightboxService.open(i)},stop:(n=o=this,function(){return n.lightboxService.close(i)}),update:function(t,e,r,n){return e&&i.find(".title").html(e),r&&i.find(".message").html(r),n?(i.find(".spin").addClass("hidden"),i.find(".progress-bar-wrapper").removeClass("hidden"),i.find(".progress-bar-wrapper > .bar").width(n+"%"),i.find(".progress-bar-wrapper > span").html(n+"%").css("left",n-9+"%")):(i.find(".spin").removeClass("hidden"),i.find(".progress-bar-wrapper").addClass("hidden"))}}},e.prototype.notify=function(t,e,r,n){var i,o,s=".notification-message-"+t,a=angular.element(s);if(!a.hasClass("active"))return r?a.find("h4").html(r):a.find("h4").html(this.translate.instant(c[t].title)),e?a.find("p").html(e):a.find("p").html(this.translate.instant(c[t].message)),(i=angular.element("body")).find(".notification-message .notification-light").removeClass("active").addClass("inactive"),i.find(s).removeClass("inactive").addClass("active"),this.tsem&&u(this.tsem),n=n||("error"===t||"light-error"===t?3500:1500),this.tsem=l(n,(o=this,function(){return i.find(s).removeClass("active").addClass("inactive").one("animationend",function(){return $(this).removeClass("inactive")}),delete o.tsem})),a.on("click",".icon-close, .close",function(t){return i.find(s).removeClass("active").addClass("inactive")})},t=e,angular.module("taigaCommon").service("$tgConfirm",t)}.call(this),function(){var y,e,S,b,j,s,c,k,n,t,r,i={}.hasOwnProperty;function o(t,e,r,n,i,o){this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.confirm=i,this.q=o,s(this),this.type=null,this.objectId=null,this.projectId=null,this.customAttributes=[],this.customAttributesValues=null}r=this.taiga,s=this.taiga.bindMethods,c=this.taiga.bindOnce,k=this.taiga.debounce,n=r.generateHash,t=angular.module("taigaCommon"),S="date",b="dropdown",y="checkbox",j="number",function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,r.Controller),o.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$tgConfirm","$q"],o.prototype.initialize=function(t,e){return this.project=this.scope.project,this.type=t,this.objectId=e,this.projectId=this.scope.projectId},o.prototype.loadCustomAttributesValues=function(){return this.objectId?this.rs.customAttributesValues[this.type].get(this.objectId).then((e=this,function(t){return e.customAttributes=e.project[e.type+"_custom_attributes"],e.customAttributesValues=t})):this.customAttributesValues;var e},o.prototype.getAttributeValue=function(t){var e=_.clone(t,!1);return e.value=this.customAttributesValues.attributes_values[t.id],e},o.prototype.updateAttributeValue=function(t){var e,r,n,i,o=function(){return n.rootscope.$broadcast("custom-attributes-values:edit")};return i=n=this,r=function(t){return i.confirm.notify("error"),i.q.reject()},(e=_.clone(this.customAttributesValues.attributes_values,!0))[t.id]=t.value,this.customAttributesValues.attributes_values=e,this.customAttributesValues.id=this.objectId,this.repo.save(this.customAttributesValues).then(o,r)},e=o,r=function(t,s){var r=t.get("custom-attributes/custom-attributes-values.html",!0),a=function(t){return n(["custom-attributes-collapsed",t])};return{require:["tgCustomAttributesValues","ngModel"],controller:e,controllerAs:"ctrl",restrict:"AE",scope:!0,link:function(t,e,r,n){var i=n[0],o=(n[1],a(r.type));return t.collapsed=s.get(o)||!1,c(t,r.ngModel,function(t){return i.initialize(r.type,t.id),i.loadCustomAttributesValues()}),t.toggleCollapse=function(){return t.collapsed=!t.collapsed,s.set(o,t.collapsed)},t.$on("$destroy",function(){return e.off()})},template:function(t,e){return r({requiredEditionPerm:e.requiredEditionPerm})}}},t.directive("tgCustomAttributesValues",["$tgTemplate","$tgStorage","$translate",r]),r=function(t,p,d,h,f,m){var g=t.get("custom-attributes/custom-attribute-value.html",!0),v=t.get("custom-attributes/custom-attribute-value-edit.html",!0);return{link:function(a,c,r,n){var i,e,o,u=h.instant("COMMON.PICKERDATE.FORMAT"),s=function(t,e){var r,n,i,o,s;return null==e&&(e=!1),t.type===S&&t.value&&(s=moment(t.value,"YYYY-MM-DD").format(u)),s=t.type===j&&t.value?parseFloat(t.value):t.value,n=l(),r={id:t.id,name:t.name,description:t.description,value:s,type:t.type,isEditable:n},(o=a.$new()).attributeHtml=m.getHTML(""+s),o.extra=t.extra,o.model=s,o.project=a.project,!n||!e&&s?(i=g(r),i=d(i)(o),c.html(i)):(i=v(r),i=d(i)(o),c.html(i),t.type===S?(t=f.get(),_.merge(t,{field:c.find("input[name=value]")[0],onSelect:function(t){return t},onOpen:function(){if("undefined"!=typeof selectedDate&&null!==selectedDate)return c.picker.setDate(selectedDate)}}),c.picker=new Pikaday(t)):void 0)},l=function(){var t=a.project.my_permissions,e=r.requiredEditionPerm;return-1<t.indexOf(e)};return a.saveCustomRichText=function(t,e){return i.value=t,n.updateAttributeValue(i).then(function(){return e(),s(i,!1)})},a.cancelCustomRichText=function(){return s(i,!1),null},o=k(2e3,function(t){var e;if(t.preventDefault(),c.find("form").checksley().validate())return i.type===b?(e=c.find("select[name='value']"),i.value=e.val()):i.type===y?(e=c.find("input[name=value]"),i.value=e[0].checked):(e=c.find("input[name=value], textarea[name='value']"),i.value=e.val(),i.type===S&&moment(i.value,u).isValid()&&(i.value=moment(i.value,u).format("YYYY-MM-DD")),i.type===j&&(i.value=parseFloat(i.value))),a.$apply(function(){return n.updateAttributeValue(i).then(function(){return s(i,!1)})})}),e=function(){return c.find("input[name='value'], textarea[name='value']").focus().select()},null!==(i=a.$eval(r.tgCustomAttributeValue)).value&&void 0!==i.value||(i.value=""),a.customAttributeValue=i,s(i),c.on("click",".js-value-view-mode span a",function(t){return t.stopPropagation()}),c.on("click",".js-value-view-mode",function(){if(l()&&!p.get().length)return s(i,!0),e()}),c.on("click",".js-edit-description",function(t){return t.preventDefault(),s(i,!0),e()}),c.on("keyup","input[name=value], textarea[name='value']",function(t){return 13===t.keyCode&&"textarea"!==t.currentTarget.type?o(t):27===t.keyCode?s(i,!1):void 0}),c.on("submit","form",o),c.on("click",".js-save-description",o),a.$on("$destroy",function(){return c.off()})},require:"^tgCustomAttributesValues",restrict:"AE"}},t.directive("tgCustomAttributeValue",["$tgTemplate","$selectedText","$compile","$translate","tgDatePickerConfigService","tgWysiwygService",r])}.call(this),function(){function t(t,e){return function(){return t.apply(e,arguments)}}var e,s,i={}.hasOwnProperty;function r(){this.replaceEmojiNameByHtmlImgs=t(this.replaceEmojiNameByHtmlImgs,this),this.replaceEmojiNameByImgs=t(this.replaceEmojiNameByImgs,this),this.replaceImgsByEmojiName=t(this.replaceImgsByEmojiName,this),this.getEmojiByName=t(this.getEmojiByName,this),this.getEmojiById=t(this.getEmojiById,this),this.searchByName=t(this.searchByName,this),this.emojis=_.map(s.emojis,function(t){return t.image="/"+window._version+"/emojis/"+t.image,t}),this.emojisById=_.keyBy(this.emojis,"id"),this.emojisByName=_.keyBy(this.emojis,"name")}s=this.taiga,e=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,s.Service),r.$inject=[],r.prototype.searchByName=function(e){return _.filter(this.emojis,function(t){return-1!==t.name.indexOf(e)})},r.prototype.getEmojiById=function(t){return this.emojisById[t]},r.prototype.getEmojiByName=function(t){return this.emojisByName[t]},r.prototype.replaceImgsByEmojiName=function(t){for(var e,r,n=s.getMatches(t,/emojis\/([^"]+).png"/gi),i=0,o=n.length;i<o;i++)e=n[i],r=new RegExp("<img(.*)"+e+"[^>]+>","g"),e=this.getEmojiById(e),t=t.replace(r,":"+e.name+":");return t},r.prototype.replaceEmojiNameByImgs=function(t){for(var e,r,n=s.getMatches(t,/:([\w +-]*):/g),i=0,o=n.length;i<o;i++)e=n[i],r=new RegExp(":"+e+":","g"),(e=this.getEmojiByName(e))&&(t=t.replace(r,"![alt]("+e.image+")"));return t},r.prototype.replaceEmojiNameByHtmlImgs=function(t){for(var e,r,n=s.getMatches(t,/:([\w +-]*):/g),i=0,o=n.length;i<o;i++)e=n[i],r=new RegExp(":"+_.escapeRegExp(e)+":","g"),(e=this.getEmojiByName(e))&&(t=t.replace(r,'<img src="'+e.image+'" />'));return t},e.service("$tgEmojis",r)}.call(this),function(){this.taiga;var u=this.taiga.groupBy,t=angular.module("taigaCommon"),e=function(r,t,e,a,c){return{link:function(o,t,e,s){return o.$watch(e.ngModel,function(n){var i;if(n)return(i=r.create(t,n,o.project)).onSelectedPointForRole=function(t,e,r){return n.points=r,i.render(),o.$apply(function(){return s.$setViewValue(n)})},i.render=function(){var t={totalPoints:this.calculateTotalPoints(),roles:this.calculateRoles(),editable:this.isEditable,loading:!1},t=a.get("common/estimation/us-estimation-points-per-role.html",!0)(t);return t=c(t)(o),this.$el.html(t)},i.render()}),o.$on("$destroy",function(){return t.off()})},restrict:"EA",require:"ngModel"}};t.directive("tgLbUsEstimation",["$tgEstimationsService","$rootScope","$tgRepo","$tgTemplate","$compile",e]),e=function(s,a,t,c,u,n,l){return{link:function(e,r,t,i){var o=function(e){var t=function(){return l.notify("error")};return n.save(function(t){return t.points=e,t}).then(null,t)};return e.$watchCollection(function(){return i.$modelValue&&i.$modelValue.points},function(){var n,t=i.$modelValue;if(t)return(n=s.create(r,t,e.project)).onSelectedPointForRole=function(t,e,r){return n.loading=t,n.render(),o(r).then(function(){return n.loading=!1,a.$broadcast("object:updated"),n.render()})},n.render=function(){var t={totalPoints:this.calculateTotalPoints(),roles:this.calculateRoles(),editable:this.isEditable,loading:n.loading},t=c.get("common/estimation/us-estimation-points-per-role.html",!0)(t);return t=u(t)(e),this.$el.html(t)},n.render()}),e.$on("$destroy",function(){return r.off()})},restrict:"EA",require:"ngModel"}},t.directive("tgUsEstimation",["$tgEstimationsService","$rootScope","$tgRepo","$tgTemplate","$compile","$tgQueueModelTransformation","$tgConfirm",e]),e=function(t,i,o,s,a){var n,c;function e(t,e,r){var n,i;this.$el=t,this.us=e,this.project=r,this.bindClickEvents=(n=this.bindClickEvents,i=this,function(){return n.apply(i,arguments)}),this.isEditable=-1!==this.project.my_permissions.indexOf("modify_us"),this.roles=this.project.roles,this.points=this.project.points,this.loading=!1,this.pointsById=u(this.points,function(t){return t.id}),this.onSelectedPointForRole=function(t,e){},this.render=function(){}}return c=t.get("common/estimation/us-estimation-points.html",!0),e.prototype.save=function(t,e){var r,n=s.defer();return a.add((r=this,function(){var t=function(){return n.resolve(),r.render()},e=function(){return o.notify("error"),r.us.revert(),r.render(),n.reject()};return i.save(r.us).then(t,e)})),n.promise},e.prototype.calculateTotalPoints=function(){var r,t=_.map(this.us.points,(r=this,function(t,e){return null!=(t=r.pointsById[t])?t.value:void 0}));return 0===t.length||0===(t=_.filter(t,function(t){return null!=t})).length?"?":_.reduce(t,function(t,e){return t+e})},e.prototype.calculateRoles=function(){var r,t=_.filter(this.project.roles,"computable");return _.map(t,(r=this,function(t){var e=r.us.points[t.id],e=r.pointsById[e];return(t=_.clone(t,!0)).points=null!=e&&null!=e.name?e.name:"?",t}))},e.prototype.bindClickEvents=function(){var r,n;return this.$el.on("click",".total.clickable",(r=this,function(t){var e;return t.preventDefault(),t.stopPropagation(),t=(e=angular.element(t.currentTarget)).data("role-id"),r.renderPointsSelector(t,e),e.siblings().removeClass("active"),e.addClass("active")})),this.$el.on("click",".point",(n=this,function(t){var e,r;return t.preventDefault(),t.stopPropagation(),e=(r=angular.element(t.currentTarget)).data("role-id"),t=r.data("point-id"),n.$el.find(".popover").popover().close(),(r=_.clone(n.us.points,!0))[e]=t,n.onSelectedPointForRole(e,t,r)}))},e.prototype.renderPointsSelector=function(e,t){var r,n=_.map(this.points,(r=this,function(t){return(t=_.clone(t,!0)).selected=r.us.points[e]!==t.id,t})),i=_.some(n,function(t){return 5<t.name.length}),i=c({points:n,roleId:e,horizontal:i});if(this.$el.find(".popover").popover().close(),this.$el.find(".pop-points-open").remove(),(null!=t?this.$el.find(t):this.$el).append(i),this.$el.find(".pop-points-open").popover().open(function(){return $(this).removeClass("active").closest("li").removeClass("active")}),this.$el.find(".pop-points-open").show(),(i=this.$el.find(".pop-points-open")).offset().top+i.height()>document.body.clientHeight)return i.addClass("pop-bottom")},n=e,{create:function(t,e,r){return t.unbind("click"),(r=new n(t,e,r)).isEditable&&r.bindClickEvents(),r}}},t.factory("$tgEstimationsService",["$tgTemplate","$tgRepo","$tgConfirm","$q","$tgQqueue",e])}.call(this),function(){var t,e=this.taiga,r=angular.module("taigaCommon"),n=function(){return function(t,e){return t===[null,void 0]?e:t}};r.filter("default",n),n=function(e){return function(t){return t?e.instant("COMMON.YES"):e.instant("COMMON.NO")}},r.filter("yesNo",["$translate",n]),n=function(){return e.unslugify},r.filter("unslugify",n),n=function(){return function(t,e){return t?moment(t).format(e):""}},r.filter("momentFormat",n),n=function(){return function(t,e){return t?moment(t).fromNow(e||!1):""}},r.filter("momentFromNow",n),t=this,n=function(){return t.taiga.sizeFormat},r.filter("sizeFormat",n),n=function(){var t=function(t){return t.toJS()},e=_.memoize(t);return function(t){return t instanceof Immutable.List?e(t):t}},r.filter("toMutable",n),n=function(n){return function(t,e){var r;return null!=e&&e.startsWith("#")?(r=e.substr(1),_.filter(t,function(t){return String(t.ref).startsWith(r)})):n(t,e)}},r.filter("byRef",["filterFilter",n]),n=function(){return function(t,e){var r,n,i,o,s,a;if(!t)return"transparent";for((t=new String(t).replace(/[^0-9a-f]/gi,"")).length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0,s="#",o=(a=[i=0,1,2]).length;i<o;i++)n=a[i],r=parseInt(t.substr(2*n,2),16),s+=("00"+(r=Math.round(Math.min(Math.max(0,r+255*e),255)).toString(16))).substr(r.length);return s}},r.filter("darker",n),n=function(e){return function(t){return t?e.getHTML(t):""}},r.filter("markdownToHTML",["tgWysiwygService",n]),n=function(n){return function(t,e,r){if(e)return n("filter")(t,function(t){return-1!==e.indexOf(t[r])})}},r.filter("inArray",["$filter",n]),n=function(e){return function(t){return t?_.unescape(e.replaceEmojiNameByHtmlImgs(_.escape(t))):""}},r.filter("emojify",["$tgEmojis",n]),n=function(t){return function(t){return t?t.replace(/\<(?!(\/?)(strong|br)(\/?)).*?\>/g,""):""}},r.filter("textToHTML",["$filter",n])}.call(this),function(){function t(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var M,g,D,e,N,r,i={}.hasOwnProperty,x=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};function n(t,e,r){this.animationFrame=t,this.q=e,this.rootScope=r}function o(){return o.__super__.constructor.apply(this,arguments)}e=angular.module("taigaCommon"),this.taiga.bindOnce,this.taiga.timeout,M=this.taiga.debounce,this.taiga.sizeFormat,N=this.taiga.trim,this.taiga.normalizeString,r=taiga.Service,t(n,r),n.prototype.open=function(e,t,r,n){var i,o,s;return this.onClose=t,_.isString(e)&&(e=$(e)),i=this.q.defer(),(o=e.children().not(".close")).hide(),this.animationFrame.add(function(){return e.css("display","flex")}),this.animationFrame.add(function(){return e.addClass("open"),e.one("transitionend",function(){var t=e.find("input:not(.no-focus),textarea:not(.no-focus)").first();return t.length?t.focus():document.activeElement?$(document.activeElement).blur():void 0})}),this.animationFrame.add(function(){return o.show(),i.resolve()}),n||angular.element(document).on("keydown.lightbox",(s=this,function(t){if(27===(t.keyCode||t.which))return r?s.rootScope.$applyAsync(r):s.close(e)})),this.rootScope.$broadcast("lightbox:opened"),i.promise},n.prototype.close=function(r){return this.q((n=this,function(t){var e;return _.isString(r)&&(r=$(r)),(e=angular.element(document)).off(".lightbox"),e.off(".keyboard-navigation"),r.addClass("close-started"),n.animationFrame.add(function(){return r.addClass("close"),r.one("transitionend",function(){return r.removeAttr("style"),r.removeClass("open").removeClass("close").removeClass("close-started"),n.onClose&&n.rootScope.$apply(n.onClose),t()})}),r.hasClass("remove-on-close")&&((e=r.data("scope"))&&e.$destroy(),r.remove()),n.rootScope.$broadcast("lightbox:closed")}));var n},n.prototype.getLightboxOpen=function(){return $(".lightbox.open:not(.close-started)")},n.prototype.closeAll=function(){for(var t,e=angular.element(document).find(".lightbox.open"),r=[],n=0,i=e.length;n<i;n++)t=e[n],r.push(this.close($(t)));return r},e.service("lightboxService",["animationFrame","$q","$rootScope",n]),r=taiga.Service,t(o,r),o.prototype.stop=function(){return angular.element(document).off(".keyboard-navigation")},o.prototype.dispatch=function(t,e){var r,n=t.find(".selected");return 13===e?(1===t.find(".user-list-single").length?t.find(".user-list-single:first"):n).trigger("click"):40===e?n.length?(r=n.next(".user-list-single")).length?(n.removeClass("selected"),r.addClass("selected")):void 0:t.find('.user-list-single:not(".is-active"):first').addClass("selected"):38===e?n.length?(e=n.prev('.user-list-single:not(".is-active")')).length?(n.removeClass("selected"),e.addClass("selected")):void 0:t.find(".user-list-single:last").addClass("selected"):void 0},o.prototype.init=function(r){var n;return this.stop(),angular.element(document).on("keydown.keyboard-navigation",(n=this,function(t){var e=t.keyCode||t.which;if(40===e||38===e||13===e)return t.preventDefault(),n.dispatch(r,e)}))},e.service("lightboxKeyboardNavigationService",o),r=function(n){return{restrict:"C",link:function(t,e,r){if(!r.$attr.visible)return e.on("click",".close",function(t){return t.preventDefault(),n.close(e)})}}},e.directive("lightbox",["lightboxService",r]),r=function(){return{scope:{onClose:"&"},link:function(t,e,r){},template:'<a class="close" ng-click="onClose()" href="" title="{{\'COMMON.CLOSE\' | translate}}">\n    <tg-svg svg-icon="icon-close"></tg-svg>\n</a>'}},e.directive("tgLightboxClose",[r]),r=function(s,t,a,c,u,l,p){return{templateUrl:"common/lightbox/lightbox-block.html",link:function(t,r,e,n){var i,o,e=p.instant(e.title);return r.find("h2.title").text(e),o=function(t){var e=l.save(function(t){return t.is_blocked=!1,t.blocked_note="",t});return e.then(function(){return a.notify("success"),s.$broadcast("object:updated"),t()}),e.then(null,function(){return a.notify("error"),item.revert()}),e.finally(function(){return t()}),e},i=function(){var t=u().target(r.find(".js-block-item")).start(),e=l.save(function(t){return t.is_blocked=!0,t.blocked_note=r.find(".reason").val(),t});return e.then(function(){return a.notify("success"),s.$broadcast("object:updated")}),e.then(null,function(){return a.notify("error")}),e.finally(function(){return t.finish(),c.close(r)})},t.$on("block",function(){return r.find(".reason").val(n.$modelValue.blocked_note),c.open(r)}),t.$on("unblock",function(t,e,r){return o(r)}),t.$on("$destroy",function(){return r.off()}),r.on("click",".js-block-item",function(t){return t.preventDefault(),i()})},require:"ngModel"}},e.directive("tgLbBlock",["$rootScope","$tgRepo","$tgConfirm","lightboxService","$tgLoading","$tgQueueModelTransformation","$translate",r]),r=function(i,t,e){var r=t.get("common/lightbox/lightbox-blocking-message-input.html",!0);return{template:function(t,e){return r({ngmodel:e.ngModel})},link:function(t,e,r,n){return r.watch?t.$watch(r.watch,function(t){return!0===t&&!0===t?e.find(".blocked-note").removeClass("hidden"):e.find(".blocked-note").addClass("hidden")}):i.error("No watch attribute on tg-blocking-message-input directive")},require:"ngModel",restrict:"EA"}},e.directive("tgBlockingMessageInput",["$log","$tgTemplate","$compile",r]),r=function(t,c,u,l,p,d,e,h,f){return{link:function(i,o,t){var s,e,n,a=null;return i.displayStatusSelector=!1,s=function(){return i.currentStatus=i.project.us_statuses.filter(function(t){return t.id===i.new.statusId}).pop()},i.toggleStatus=function(){return i.displayStatusSelector=!i.displayStatusSelector},i.displayStatus=function(){return i.displayStatusSelector=!0},i.hideStatus=function(){return i.displayStatusSelector=!1,i.$apply()},i.setStatus=function(t){return i.new.statusId=t.id,s(),i.displayStatusSelector=!1},i.$on("usform:bulk",function(t,e,r,n){return a&&a.reset(),i.new={projectId:e,statusId:r,bulk:"",swimlaneId:n,us_position:"bottom"},s(),l.open(o)}),e=M(2e3,function(t){var r;if(t.preventDefault(),(a=o.find("form").checksley({onlyOneErrorElement:!0})).validate())return t=null,i.project.is_kanban_activated&&void 0===(t=i.new.swimlane)&&(t=i.project.default_swimlane),r=p().target(n).start(),(t=c.userstories.bulkCreate(i.new.projectId,i.new.statusId,i.new.bulk,t)).then(function(t){return t=_.map(t.data,function(t){return d.make_model("userstories",t)}),r.finish(),u.$broadcast("usform:bulk:success",t,i.new.us_position),l.close(o)}),t.then(null,function(t){var e;if(r.finish(),a.setErrors(t),t.data.status&&(e=f.instant("LIGHTBOX.CREATE_EDIT.ERROR_STATUS"),h.notify("error",e)),t.data.swimlane_id&&(e=f.instant("LIGHTBOX.CREATE_EDIT.ERROR_SWIMLANE"),h.notify("error",e)),t._error_message)return h.notify("error",t._error_message)})}),n=o.find(".js-submit-button"),o.on("submit","form",e),o.on("click",function(t){t=angular.element(t.target);if(!_.filter(t.parents(),function(t){return"bulk-status-selector-wrapper"===t.className}).length)return i.hideStatus()}),i.$on("$destroy",function(){return o.off()})}}},e.directive("tgLbCreateBulkUserstories",["$tgRepo","$tgResources","$rootScope","lightboxService","$tgLoading","$tgModel","$timeout","$tgConfirm","$translate",r]),r=function(n,t,e){return{templateUrl:"common/lightbox/lightbox-leave-project-warning.html",link:function(t,e,r){return n.open(e)},scope:!0}},e.directive("tgLightboxLeaveProjectWarning",["lightboxService",r]),r=function(a,c,u,l,p,d){return{templateUrl:"common/lightbox/lightbox-due-date.html",link:function(n,i,t){var e,o,s=l.instant("COMMON.PICKERDATE.FORMAT");return c.open(i),n.object.due_date&&(n.new_due_date=moment(n.object.due_date).format(s)),i.on("click",".suggestion",function(t){var e=angular.element(t.currentTarget),t=e.data("quantity"),e=e.data("unit"),e=moment().add(t,e).format(s);return i.find(".due-date").val(e)}),o=function(){var e,t,r=u().target(i.find(".submit-button")).start();return n.notAutoSave?(e=$(".due-date").val(),n.object.due_date=e?moment(e,s).format("YYYY-MM-DD"):null,n.$apply(),r.finish(),void c.close(i)):((t=d.save(function(t){return e=$(".due-date").val(),t.due_date=e?moment(e,s).format("YYYY-MM-DD"):null,t})).then(function(){return p.notify("success")}),t.then(null,function(){return p.notify("error")}),t.finally(function(){return r.finish(),c.close(i),a.$broadcast("object:updated")}))},i.on("click",".submit-button",function(t){return t.preventDefault(),o()}),e=function(){var t=l.instant("LIGHTBOX.DELETE_DUE_DATE.TITLE"),e=l.instant("LIGHTBOX.DELETE_DUE_DATE.SUBTITLE"),r=moment(n.object.due_date).format(s);return p.askOnDelete(t,r,e).then(function(t){return t.finish(),$(".due-date").val(null),n.object.due_date_reason=null,n.notAutoSave?(n.object.due_date=null,c.close(i)):o()})},i.on("click",".delete-due-date",function(t){return t.preventDefault(),e()})},scope:!0}},e.directive("tgLbSetDueDate",["$rootScope","lightboxService","$tgLoading","$translate","$tgConfirm","$tgQueueModelTransformation",r]),D=this.taiga.groupBy,r=function(j,k,I,$,E,T,C,w,P,A,O,R,U){return{link:function(o,s,t){var e,a,c,u,r,n,i,l,p,d,h,f,m,g=null,v=null,y=Immutable.List(),S=Immutable.List(),b={us:{objName:"User Story",model:"userstories",params:{include_attachments:!0,include_tasks:!0},data:function(t){return{translationID:"US",translationIDPlural:"US",statusList:_.sortBy(t.us_statuses,"order")}},initialData:function(t){return{project:t.project.id,subject:"",description:"",tags:[],points:{},swimlane:t.project.is_kanban_activated?t.project.default_swimlane:null,status:t.statusId||t.project.default_us_status,is_archived:!1}}},task:{objName:"Task",model:"tasks",params:{include_attachments:!0},data:function(t){return{translationID:"TASK",translationIDPlural:"TASKS",statusList:_.sortBy(t.task_statuses,"order")}},initialData:function(t){return{project:t.project.id,subject:"",description:"",assigned_to:null,tags:[],milestone:t.sprintId,status:t.project.default_task_status,user_story:t.usId,is_archived:!1}}},issue:{objName:"Issue",model:"issues",params:{include_attachments:!0},data:function(t){return{translationID:"ISSUE",translationIDPlural:"ISSUES",project:t,statusList:_.sortBy(t.issue_statuses,"order"),typeById:D(t.issue_types,function(t){return t.id}),typeList:_.sortBy(t.issue_types,"order"),severityById:D(t.severities,function(t){return t.id}),severityList:_.sortBy(t.severities,"order"),priorityById:D(t.priorities,function(t){return t.id}),priorityList:_.sortBy(t.priorities,"order"),milestonesById:D(t.milestones,function(t){return t.id})}},initialData:function(t){return{assigned_to:null,milestone:t.sprintId,priority:t.project.default_priority,project:t.project.id,severity:t.project.default_severity,status:t.project.default_issue_status,subject:"",tags:[],type:t.project.default_issue_type}}}};return o.setMode=function(t){return o.mode=t},o.$on("genericform:new",function(t,e){return r(e),o.mode="new",o.getOrCreate=!1,i(e)}),o.$on("genericform:new-or-existing",function(t,e){return r(e),o.mode="add-existing",o.getOrCreate=!0,o.existingFilterText="",$[g.model].listInAllProjects({project:o.project.id},!0).then(function(t){return o.existingItems=angular.copy(t)}),i(e)}),o.$on("genericform:edit",function(t,e){return r(e),o.mode="edit",o.getOrCreate=!1,i(e)}),r=function(t){return _.map(t,function(t,e){return o[e]=t}),o.objType&&b[o.objType]?g=b[o.objType]:j.error("Invalid objType `"+o.objType+"` for `genericform` event")},i=function(t){return o.objName=g.objName,"edit"===o.mode?(o.obj=t.obj,o.attachments=Immutable.fromJS(t.attachments)):(o.obj=I.make_model(g.model,g.initialData(t)),o.attachments=Immutable.List()),_.map(g.data(o.project),function(t,e){return o[e]=t}),"us"===t.objType&&(o.obj.us_position="bottom"),v&&v.reset(),p(),h(o.obj.status),l(),o.lightboxOpen=!0,T.open(s,null,null,!0)},p=function(){return y=Immutable.List(),S=Immutable.List()},o.addAttachment=function(t){return y=y.push(t)},o.deleteAttachment=function(e){if(y=y.filter(function(t){return t.get("name")!==e.get("name")}),e.get("id"))return S=S.push(e)},o.addTag=function(t,e){var r=N(t.toLowerCase()),n=o.project.tags,i=o.project.tags_colors;if(null==n&&(n=[]),null==i&&(i={}),x.call(n,r)<0&&n.push(r),i[t]=e||null,o.project.tags=n,n=_.clone(o.obj.tags),!_.find(n,function(t){return t[0]===r}))return n.push([r,e]),o.obj.tags=n},o.deleteTag=function(t){var e=N(t[0].toLowerCase()),t=(o.project.tags,_.clone(o.obj.tags));return _.remove(t,function(t){return t[0]===e}),o.obj.tags=t,_.pull(o.obj.tags,e)},c=function(e){var t=_.map(y.toJS(),function(t){return O.upload(t.file,e.id,o.obj.project,o.objType)});return A.all(t)},u=function(t){var e=_.map(S.toJS(),function(t){return O.delete(o.objType,t.id)});return A.all(e)},m=function(t){C().target(s.find(".add-existing-button")).start();return t.milestone?f(t):d(t,function(){return a(),E.$broadcast(o.objType+"form:add:success",t)},function(){return a()})},f=function(e){var t=o.milestonesById[e.milestone].name,r=o.milestonesById[o.relatedObjectId].name,n=w.instant("ISSUES.CONFIRM_CHANGE_FROM_SPRINT.TITLE"),r=w.instant("ISSUES.CONFIRM_CHANGE_FROM_SPRINT.MESSAGE",{issue:e.subject,oldSprintName:t,newSprintName:r});return P.ask(n,null,r).then(function(t){return d(e,function(){return t.finish(),T.closeAll(),o.lightboxOpen=!1,E.$broadcast(o.objType+"form:add:success",e)},function(){return t.finish(!1),P.notify("error")})})},d=function(t,e,r){return t.setAttr(o.relatedField,o.relatedObjectId),k.save(t,!0).then(e,r)},n=function(t){return t&&t[o.relatedField]===o.relatedObjectId},o.isDisabledExisting=n,o.addExistingToSprint=m,m=M(2e3,function(t){var e,r,n,i;if(v=s.find("form").checksley(),i=null,v.validate()&&!(r=C().target(s.find("#submitButton")).start()).isLoading())return e="new"===o.mode?(i=o.obj.us_position,delete o.obj.us_position,n=k.create(g.model,o.obj),o.objType+"form:new:success"):(o.obj.due_date instanceof moment&&(w.instant("COMMON.PICKERDATE.FORMAT"),o.obj.due_date=o.obj.due_date.format("YYYY-MM-DD")),n=k.save(o.obj,!0),o.objType+"form:edit:success"),n.then(function(t){return u().then(function(){return c(t).then(function(){if(r.finish(),P.notify("success"),a(),t.ref)return $[g.model].getByRef(t.project,t.ref,g.params).then(function(t){return E.$broadcast(e,t,i)})})})}),n.then(null,function(t){var e;if(r.finish(),v.setErrors(t),t.status&&(e=w.instant("LIGHTBOX.CREATE_EDIT.ERROR_STATUS"),P.notify("error",e)),t.swimlane&&(e=w.instant("LIGHTBOX.CREATE_EDIT.ERROR_SWIMLANE"),P.notify("error",e)),t._error_message)return P.notify("error",t._error_message)})}),e=function(){return o.obj.isModified()?P.ask(w.instant("LIGHTBOX.CREATE_EDIT.CONFIRM_CLOSE")).then(function(t){return t.finish(),a()}):(a(),o.$apply(function(){return o.obj.revert()}))},a=function(){return T.closeAll(),o.lightboxOpen=!1},angular.element(document).on("keydown.lightbox-create-edit",function(t){if(o.lightboxOpen&&(t.stopPropagation(),27===(t.keyCode||t.which)))return e()}),s.on("submit","form",m),s.find(".close").on("click",function(t){return t.preventDefault(),t.stopPropagation(),e()}),s.on("click",".status-dropdown",function(t){return t.preventDefault(),t.stopPropagation(),s.find(".pop-status").popover().open()}),s.on("click",".status",function(t){return t.preventDefault(),t.stopPropagation(),h(angular.element(t.currentTarget).data("status-id")),o.$apply(),o.$broadcast("status:changed",o.obj.status),s.find(".pop-status").popover().close()}),s.on("click",".team-requirement",function(t){return o.obj.team_requirement=!o.obj.team_requirement,o.$apply()}),s.on("click",".client-requirement",function(t){return o.obj.client_requirement=!o.obj.client_requirement,o.$apply()}),s.on("click",".is-blocked",function(t){return o.obj.is_blocked=!o.obj.is_blocked,o.$apply()}),s.on("click",".iocaine",function(t){return o.obj.is_iocaine=!o.obj.is_iocaine,o.$apply(),o.$broadcast("isiocaine:changed",o.obj)}),o.isTeamRequirement=function(){var t;return null!=(t=o.obj)?t.team_requirement:void 0},o.isClientRequirement=function(){var t;return null!=(t=o.obj)?t.client_requirement:void 0},h=function(e){return o.obj.status=e,o.selectedStatus=_.find(o.statusList,function(t){return t.id===e}),o.obj.is_closed=o.selectedStatus.is_closed},l=function(t){var e=R.get("common/lightbox/lightbox-create-edit/lb-create-edit.html"),r=o.$new(),r=U(e)(r);return s.html(r)}}}},e.directive("tgLbCreateEdit",["$log","$tgRepo","$tgModel","$tgResources","$rootScope","lightboxService","$tgLoading","$translate","$tgConfirm","$q","tgAttachmentsService","$tgTemplate","$compile",r]),g=this.taiga.debounceLeading,r=function(l,p,d,i,h,t,f,m){return{templateUrl:"common/lightbox/lightbox-relate-to-epic.html",link:function(o,s,t){var a,r,n,c,e,u=null;return o.projects=null,o.projectEpics=Immutable.List(),o.loading=!1,o.selectedProject=o.project.id,c=s.find(".new-epic-form").checksley(),a=s.find(".existing-epic-form").checksley(),n=function(){if(null===o.projects)return o.projects=i.projects.get("unblocked")},r=function(t,e){return h.epics.listInAllProjects({is_epics_activated:!0,project__blocked_code:"null",project:t,q:e},!0).then(function(t){var e=[];return u.epics&&(e=u.epics.map(function(t){return t.id})),t=t.filter(function(t){return-1===e.indexOf(t.get("id"))}),o.projectEpics=t})},e=function(t){return o.selectedEpic=null,o.searchEpic="",r(t,o.searchEpic)},s.on("click",".close",function(t){return t.preventDefault(),d.close(s)}),o.$on("relate-to-epic:add",function(t,e){return u=e,o.selectedEpic=null,o.searchEpic="",n(),r(o.selectedProject,o.searchEpic).then(function(){return d.open(s).then(function(){return s.find("input").focus})})}),o.$on("$destroy",function(){return s.off()}),o.selectProject=e,o.onUpdateSearchEpic=g(300,function(){return o.selectedEpic=null,r(o.selectedProject,o.searchEpic)}),o.saveRelatedEpic=function(t,e){var r,n,i;if(a.validate())return o.loading=!0,r=function(t){return o.loading=!1,p.notify("error"),a.setErrors(t)},n=function(t){return m.trackEvent("user story related epic","create","create related epic on user story",1),o.loading=!1,l.$broadcast("related-epics:changed",u),d.close(s)},i=u.id,h.epics.addRelatedUserstory(t,i).then(n,r)},o.createEpic=function(t,e){var r,n,i;if(c.validate())return this.loading=!0,n=function(t){return o.loading=!1,p.notify("error"),c.setErrors(errors)},i=function(){return m.trackEvent("user story related epic","create","create related epic on user story",1),o.loading=!1,l.$broadcast("related-epics:changed",u),d.close(s)},r=function(t){var e=t.get("id"),t=u.id;return h.epics.addRelatedUserstory(e,t).then(i,n)},f.createEpic({subject:e},null,t).then(r,n)}}}},e.directive("tgLbRelatetoepic",["$rootScope","$tgConfirm","lightboxService","tgCurrentUserService","tgResources","$tgResources","tgEpicsService","$tgAnalytics",r])}.call(this),function(){var t=function(n,i){return{restrict:"A",compile:function(t,e){var r=n(e.tgLoaded);return function(t,e){return i(function(){return r(t,{$event:{target:e}})}),null}}}};angular.module("taigaCommon").directive("tgLoaded",["$parse","$timeout",t])}.call(this),function(){this.taiga,this.taiga.sizeFormat;var l=this.taiga.timeout,t=angular.module("taigaCommon"),e=function(n,t){return{link:function(t,e,r){return n.onStart(function(){return $(document.body).addClass("loader-active"),e.addClass("active")}),n.onEnd(function(){return $(document.body).removeClass("loader-active"),e.removeClass("active")})}}};t.directive("tgLoader",["tgLoader","$rootScope",e]),(e=function(r){var n={minTime:300},i=!1,o=0,s=0,a=0,e=function(t){var e;return null==t&&(t=!1),o&&(e=0,t||(t=(new Date).getTime()-o)<n.minTime&&(e=n.minTime-t),l(e,function(){return r.$broadcast("loader:end"),i=!1,window.prerenderReady=!0})),a=s=o=0},c=function(){var t;return t=setInterval(function(){if(a&&0===s)return e(),clearInterval(t)},50)},u=function(){return o=(new Date).getTime(),r.$broadcast("loader:start"),i=!0};return{pageLoaded:e,open:function(){return i},start:function(t){if(null==t&&(t=!1),!i&&(u(),t))return c()},onStart:function(t){return r.$on("loader:start",t)},onEnd:function(t){return r.$on("loader:end",t)},logRequest:function(){return s++},logResponse:function(){return 0<s&&s--,a=(new Date).getTime()}}}).$inject=["$rootScope"],t.factory("tgLoader",e)}.call(this),function(){var e=[].slice,t=angular.module("taigaCommon"),r=function(n){var i="<img class='loading-spinner' src='"+window._version+"/svg/spinner-circle.svg' alt='loading...' />";return function(){var r={settings:{target:null,scope:null,classes:[],timeout:0,template:null},target:function(t){return r.settings.target=t,r},scope:function(t){return r.settings.scope=t,r},template:function(t){return r.settings.template=t,r},removeClasses:function(){var t=1<=arguments.length?e.call(arguments,0):[];return r.settings.classes=t,r},timeout:function(t){return r.settings.timeout=t,r},isLoading:function(){return r.settings.target.hasClass("loading")},start:function(){var t,e=r.settings.target;return r.settings.classes.map(function(t){return e.removeClass(t)}),e.hasClass("loading")||r.settings.template||(r.settings.template=e.html()),t=setTimeout(function(){if(!e.hasClass("loading"))return e.addClass("loading"),e.html(i)},r.settings.timeout),r.settings.timeoutId=t,r},finish:function(){var t=r.settings.target,e=r.settings.timeoutId;return e&&(clearTimeout(e),r.settings.classes.map(function(t){return r.settings.target.addClass(t)}),t.html(r.settings.template),t.removeClass("loading"),r.settings.scope&&n(t.contents())(r.settings.scope)),r}};return r}};r.$inject=["$compile"],t.factory("$tgLoading",r),r=function(o){return{priority:99999,link:function(e,r,t){var n=null,i=r.html();return e.$watch(t.tgLoading,function(t){return t?n=o().target(r).timeout(100).template(i).scope(e).start():n?n.finish():void 0})}}},t.directive("tgLoading",["$tgLoading",r])}.call(this),function(){var u=this.taiga,c=this.taiga.bindOnce,l=this.taiga.debounce,t=angular.module("taigaCommon"),e=function(s,t){var a=t.get("common/popover/popover-us-status.html",!0);return{link:function(i,o,r){o.controller();var e,n=function(t){var e=o.find(".us-status"),r=o.find(".us-status .us-status-bind"),n=i.usStatusById;if(n[t.status])return r.text(n[t.status].name),e.css("color",n[t.status].color)};return o.on("click",".us-status",function(t){return t.preventDefault(),t.stopPropagation(),o.find(".pop-status").popover().open()}),o.on("click",".popover-status",l(2e3,function(t){var e;return t.preventDefault(),t.stopPropagation(),t=$(t.currentTarget).find("#js-status-btn"),t=angular.element(t),(e=i.$eval(r.tgUsStatus)).status=t.data("status-id"),n(e),o.find(".pop-status").popover().close(),i.$apply(function(){return s.save(e).then(function(){return i.$eval(r.onUpdate)})})})),i.$on("userstories:loaded",function(){return n(i.$eval(r.tgUsStatus))}),i.$on("$destroy",function(){return o.off()}),e=i.$eval(r.tgUsStatus),n(e),c(i,"project",function(t){t=a({statuses:t.us_statuses,currentStatus:e.status});if(o.append(t),-1===i.project.my_permissions.indexOf("modify_us"))return o.unbind("click"),o.find("a").addClass("not-clickable")})}}};t.directive("tgUsStatus",["$tgRepo","$tgTemplate",e]),e=function(s,t){var a=t.get("common/popover/popover-related-task-status.html",!0),c=function(t,e,r){var n=t.find(".us-status"),t=t.find(".task-status .task-status-bind");if(r[e.status])return t.text(r[e.status].name),n.css("color",r[e.status].color)};return{link:function(e,r,n){r.controller();var i=e.$eval(n.tgRelatedTaskStatus),o=!e.$eval(n.notAutoSave);return r.on("click",".task-status",function(t){return t.preventDefault(),t.stopPropagation(),r.find(".pop-status").popover().open()}),r.on("click",".status",l(2e3,function(t){if(t.preventDefault(),t.stopPropagation(),t=angular.element(t.currentTarget),i.status=t.data("status-id"),r.find(".pop-status").popover().close(),c(r,i,e.taskStatusById),o)return e.$apply(function(){return s.save(i).then(function(){return e.$eval(n.onUpdate),e.$emit("related-tasks:status-changed")})})})),e.$watch(n.tgRelatedTaskStatus,function(){return i=e.$eval(n.tgRelatedTaskStatus),c(r,i,e.taskStatusById)}),u.bindOnce(e,"project",function(t){if(r.append(a({statuses:t.task_statuses})),c(r,i,e.taskStatusById),-1===t.my_permissions.indexOf("modify_task"))return r.unbind("click"),r.find("a").addClass("not-clickable")}),e.$on("$destroy",function(){return r.off()})}}},t.directive("tgRelatedTaskStatus",["$tgRepo","$tgTemplate",e]),$.fn.popover=function(){var a=this,t=function(){var t,e,r,n,i,o,s;return a.css({display:"block",visibility:"hidden"}),t=(r=$(window).scrollTop())+$(window).height(),e=$(window).width(),n=(o=a.offset().top)+a.height(),s=a.width(),i=a.offset().left,s=a.offset().left+s,a.css({display:"none",visibility:"visible"}),n<=t&&r<=o&&0<=i&&s<=e},r=function(t){return t&&t.call(a),a.fadeOut(function(){return a.removeClass("active").removeClass("fix")}),a.off("popup:close")},n=function(){return $(".popover.active").each(function(){return $(this).trigger("popup:close")})},e=function(e){return a.hasClass("active")?i():(n(),t()||a.addClass("fix"),a.fadeIn(function(){return a.addClass("active"),$(document.body).off("popover"),$(document.body).one("click.popover",function(){return n()})}),a.on("popup:close",function(t){return r(e)}))},i=function(){return a.trigger("popup:close")};return{open:e,close:i,closeAll:n}},u.globalPopover=function(n,t,i,e){var r,o,s,a,c,u;return null==i&&(i={}),(u=document.createElement("div")).classList.add("popover","global-popover"),c=document.createElement("ul"),o=function(t){var e,r=document.createElement("tg-svg"),n=document.createElement("svg"),i=document.createElement("use"),o=document.createAttribute("xlink:href");return o.value="#"+t,(e=document.createAttribute("attr-href")).value="#"+t,i.setAttributeNode(o),i.setAttributeNode(e),n.classList.add("icon"),n.appendChild(i),r.appendChild(n),r},r=function(){return $(u).popover().close(),$(u).remove()},a=function(){return s(),requestAnimationFrame(a)},(s=function(){var t=n.getBoundingClientRect(),e=t.top+t.height,r=i.width||170,t=t.right-r;return i.paddingTop&&(e+=i.paddingTop),i.paddingLeft&&(t+=i.paddingLeft),u.style.top=e+"px",u.style.left=t+"px",u.style.width=r+"px"})(),a(),document.addEventListener("scroll",r,!0),t.forEach(function(t){var e=document.createElement("li"),r=document.createElement("button");return r.addEventListener("click",t.event),t.icon&&(r.innerHTML=o(t.icon).innerHTML),r.appendChild(document.createTextNode(t.text)),e.appendChild(r),c.appendChild(e)}),u.appendChild(c),document.body.appendChild(u),$(u).popover().open(function(){if(document.removeEventListener("scroll",r),e(),u)return setTimeout(function(){return $(u).remove()},2e3)}),function(){return $(u).popover().close()}}}.call(this),function(){this.taiga;var t=function(r,t){return this.config=t,(t=this.config.get("ravenConfig",null))?(r.debug("Using the RavenJS exception handler."),Raven.config(t).install(),function(t,e){return r.error.apply(r,arguments),Raven.captureException(t)}):(r.debug("Using the default logging exception handler."),function(t,e){return r.error.apply(r,arguments)})};angular.module("taigaCommon").factory("$exceptionHandler",["$log","$tgConfig",t])}.call(this),function(){var t,i,o={}.hasOwnProperty;function n(t,e){var r;this.translate=t,this.currentUserService=e,n.__super__.constructor.call(this),_.map(i,(r=this,function(t){return t.title=r.translate.instant("PROJECT.SECTION."+t.title)}))}t=angular.module("taigaCommon"),function(t,e){for(var r in e)o.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,taiga.Service),n.$inject=["$translate","tgCurrentUserService"],i={1:{id:1,title:"TIMELINE",path:"timeline",enabled:""},2:{id:2,title:"EPICS",path:"epics",enabled:"is_epics_activated"},3:{id:3,title:"BACKLOG",path:"backlog",enabled:"is_backlog_activated"},4:{id:4,title:"KANBAN",path:"kanban",enabled:"is_kanban_activated"},5:{id:5,title:"ISSUES",path:"issues",enabled:"is_issues_activated"},6:{id:6,title:"WIKI",path:"wiki",enabled:"is_wiki_activated"}},n.prototype.list=function(){return i},n.prototype.getPath=function(e,t){var r="timeline",n=null!=(n=this.currentUserService.projects)?n.get("all"):void 0;return(n=n&&n.find(function(t){return t.get("slug")===e}))?(t=t||n.get("my_homepage"),(t=_.find(i,{id:t}))&&!1!==(null!=n?n.get(t.enabled):void 0)?t.path:r):r},t.service("$tgSections",n)}.call(this),function(){var t,e,i={}.hasOwnProperty;function r(t,e,r,n,i,o){this.rootscope=t,this.log=e,this.config=r,this.win=n,this.doc=i,this.location=o,this.initialized=!1,o=this.config.get("tagManager",{}),this.accountId=o.accountId}e=this.taiga,t=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e.Service),r.$inject=["$rootScope","$log","$tgConfig","$window","$document","$location"],r.prototype.initialize=function(){if(this.accountId)return this.injectTagManager(),this.initialized=!0;this.log.debug("Tag Manager: no account id provided. Disabling.")},r.prototype.injectTagManager=function(){return function(t,e,r,n,i){t[n]=t[n]||[],t[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});t=e.getElementsByTagName(r)[0],r=e.createElement(r),n="dataLayer"!=n?"&l="+n:"";r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id="+i+n,t.parentNode.insertBefore(r,t)}(window,document,"script","dataLayer",this.accountId)},t.service("$tgTagManager",r)}.call(this),function(){var g=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},v=(this.taiga,this.taiga.trim),y=this.taiga.bindOnce,e=angular.module("taigaCommon"),r=function(){var i=function(t){return _.isArray(t)?t.join(", "):""},o=function(t){return t?_(t.split(",")).map(function(t){return _.trim(t)}).value():[]};return{require:"ngModel",link:function(t,e,r,n){return n.$formatters.push(i),n.$parsers.push(o),t.$on("$destroy",function(){return e.off()})}}};e.directive("tgTags",r),r=function(o){var s=_.template('<% _.each(tags, function(tag) { %>\n    <% if (tag[1] !== null) { %>\n    <div class="tag" style="background: <%- tag[1] %>">\n        <%= emojify(tag[0]) %>\n    </div>\n    <% } %>\n<% }) %>\n<% _.each(tags, function(tag) { %>\n    <% if (tag[1] === null) { %>\n    <div class="tag">\n        <%= emojify(tag[0]) %>\n    </div>\n    <% } %>\n<% }) %>');return{link:function(t,e,r,n){var i=function(t){t=s({tags:t,emojify:function(t){return o.replaceEmojiNameByHtmlImgs(_.escape(t))}});return e.html(t)};return t.$watch(r.tgColorizeBacklogTags,function(t){if(null!=t)return i(t)}),t.$on("$destroy",function(){return e.off()})}}},e.directive("tgColorizeBacklogTags",["$tgEmojis",r]),r=function(e,r,h){var f=r.get("common/tag/lb-tag-line-tags.html",!0),m=null;return{link:function(i,o,e,r){var s=_.has(e,"withoutColors"),n=function(e,r){var n;return null==r&&(r=[]),n=s?null:r[t],e={tags:_.map(e,function(t){return{name:t,style:n?"border-left: 5px solid "+n:""}})},e=h(f(e))(i),o.find(".tags-container").html(e)},a=function(){return o.find(".save").removeClass("hidden")},c=function(){return o.find(".save").addClass("hidden")},u=function(){return o.find("input").val(""),m.close()},l=function(t){var e;if(0!==(t=v(t.toLowerCase())).length)return null==(e=_.clone(r.$modelValue,!1))&&(e=[]),g.call(e,t)<0&&e.push(t),i.$apply(function(){return r.$setViewValue(e)}),c()},p=function(t){var e;if(0!==(t=v(t.toLowerCase())).length)return e=_.clone(r.$modelValue,!1),e=_.pull(e,t),i.$apply(function(){return r.$setViewValue(e)})},d=function(){var t=o.find("input").val();return l(t),u()};return o.on("keypress","input",function(t){var e=angular.element(t.currentTarget);return 13===t.keyCode||","===String.fromCharCode(t.keyCode)?(t.preventDefault(),d()):(e.val().length?a:c)()}),o.on("click",".save",function(t){return t.preventDefault(),d()}),o.on("click",".remove-tag",function(t){return t.preventDefault(),t=angular.element(t.currentTarget).siblings(".tag-name").text(),p(t)}),y(i,"project",function(t){var e=o.find("input");return m=new Awesomplete(e[0],{list:_.keys(t.tags_colors)}),e.on("awesomplete-selectcomplete",function(){return l(e.val()),e.val("")})}),i.$watch(e.ngModel,function(t){var e=(null!=(e=i.project)?e.tags_colors:void 0)||[];return n(t,e)}),i.$on("$destroy",function(){return o.off()})},require:"ngModel",templateUrl:"common/tag/lb-tag-line.html"}},e.directive("tgLbTagLine",["$tgResources","$tgTemplate","$compile",r])}.call(this),function(){var t,e,i={}.hasOwnProperty;function r(t,e){this.rootScope=t,this.win=e,this.initialized=!1}e=this.taiga,t=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e.Service),r.$inject=["$rootScope","$window"],r.prototype.initialize=function(){var t,r,n,i,o;if(!this.initialized)return this.rootScope.$on("$locationChangeSuccess",(t=this,function(){if(t.win.userpilot)return t.win.userpilot.reload()})),this.rootScope.$on("auth:refresh",(r=this,function(t,e){return r.identify()})),this.rootScope.$on("auth:register",(n=this,function(t,e){return n.identify()})),this.rootScope.$on("auth:login",(i=this,function(t,e){return i.identify()})),this.rootScope.$on("auth:logout",(o=this,function(t,e){return o.identify()})),this.initialized=!0},r.prototype.checkZendeskConditions=function(t){var e=this.hasPaidPlan(t),t=new Date(t.date_joined)>this.getJoinedLimit();return e&&t},r.prototype.identify=function(){var t,e=this.win.localStorage.getItem("userInfo")||"{}",r=JSON.parse(e);if(this.win.userpilot&&(t=this.calculateUserPilotId(r),e=this.prepareUserPilotCustomer(r),this.win.userpilot.identify(t,e)),this.win.zE)return this.checkZendeskConditions(r)?this.setZendeskWidgetStatus({enabled:!0}):this.setZendeskWidgetStatus({enabled:!1})},r.prototype.prepareUserPilotCustomer=function(t){return t.id?{name:t.full_name_display,email:t.email,created_at:Date.now(),taiga_id:t.id,taiga_username:t.username,taiga_date_joined:t.date_joined,taiga_lang:t.lang,taiga_max_private_projects:t.max_private_projects,taiga_max_memberships_private_projects:t.max_memberships_private_projects,taiga_verified_email:t.verified_email,taiga_total_private_projects:t.total_private_projects,taiga_total_public_projects:t.total_public_projects,taiga_roles:t.roles&&t.roles.toString()}:{created_at:Date.now()}},r.prototype.hasPaidPlan=function(t){t=t.max_private_projects;return void 0!==t&&1!==t},r.prototype.calculateUserPilotId=function(t){return t.id?new Date(t.date_joined)>this.getJoinedLimit()||this.hasPaidPlan(t)?t.id:1:2},r.prototype.getJoinedLimit=function(){var t=new Date;return t.setDate(t.getDate()-42),t},r.prototype.setZendeskWidgetStatus=function(t){return null==t&&(t={enabled:!1}),t=!t.enabled,this.win.zE("webWidget","updateSettings",{webWidget:{chat:{suppress:t},contactForm:{suppress:t},helpCenter:{suppress:t},talk:{suppress:t},answerBot:{suppress:t}}})},t.service("$tgUserPilot",r)}.call(this),function(){this.taiga,this.taiga.bindOnce;var b=this.taiga.debounce,t=function(f,m,t,g,v,y,S,i,o){return{link:function(c,u,t){var s,e,r,a,n,l,p=!1,d=!0,h=null;return c.newSprint={},l=null,c.createEditOpen=!1,a=function(){return h&&h.reset(),c.newSprint={project:null,name:null,estimated_start:null,estimated_finish:null}},n=b(2e3,function(t){var r,n,e,i,o,s,a;return t.preventDefault(),angular.element(t.currentTarget),o=S.instant("COMMON.PICKERDATE.FORMAT"),a=u.find(".submit-button"),(h=u.find("form").checksley()).validate()?(p=!1,r=null,e=$(".date-start").val(),t=$(".date-end").val(),r=d?((i=angular.copy(c.newSprint)).estimated_start=moment(e,o).format("YYYY-MM-DD"),i.estimated_finish=moment(t,o).format("YYYY-MM-DD"),s=f.create("milestones",i),"sprintform:create:success"):((i=c.newSprint.realClone()).estimated_start=moment(e,o).format("YYYY-MM-DD"),i.estimated_finish=moment(t,o).format("YYYY-MM-DD"),s=f.save(i),"sprintform:edit:success"),n=y().target(a).start(),s.then(function(e){return n.finish(),d&&(c.sprintsCounter+=1),c.sprints=_.map(c.sprints,function(t){return t.id===e.id?e:t}),"sprintform:create:success"===r&&l?g.$broadcast(r,e,l):g.$broadcast(r,e),v.close(u),c.createEditOpen=!1}),s.then(null,function(t){return n.finish(),h.setErrors(t),t._error_message?m.notify("light-error",t._error_message):t.__all__?m.notify("light-error",t.__all__[0]):void 0})):(p=!0,void u.find(".last-sprint-name").addClass("disappear"))}),r=function(){var t=S.instant("LIGHTBOX.DELETE_SPRINT.TITLE"),e=c.newSprint.name;return m.askOnDelete(t,e).then(function(t){var e=function(){return t.finish(),--c.milestonesCounter,v.close(u),c.createEditOpen=!1,g.$broadcast("sprintform:remove:success",c.newSprint)},r=function(){return t.finish(!1),m.notify("error")};return f.remove(c.newSprint).then(e,r)})},s=function(){var t=_.filter(c.sprints,function(t){return!t.closed}),t=_.sortBy(t,function(t){return moment(t.estimated_finish,"YYYY-MM-DD").format("X")});return t[t.length-1]},e=function(t){return c.$applyAsync(function(){return o(function(){return t()},0)})},c.$on("sprintform:create",function(t,i,o){return c.createEditOpen=!0,e(function(){var t,e,r,n;return l=o,a(),(h=u.find("form").checksley()).reset(),d=!0,r=S.instant("COMMON.PICKERDATE.FORMAT"),c.newSprint.project=i,c.newSprint.name=null,c.newSprint.slug=null,e=s(),t=moment(),e?t=moment(e.estimated_finish):c.newSprint.estimated_start&&(t=moment(c.newSprint.estimated_start)),c.newSprint.estimated_start=t.format(r),t=moment().add(2,"weeks"),e?t=moment(e.estimated_finish).add(2,"weeks"):c.newSprint.estimated_finish&&(t=moment(c.newSprint.estimated_finish)),c.newSprint.estimated_finish=t.format(r),r=u.find(".last-sprint-name"),null!=(null!=e?e.name:void 0)&&(n=S.instant("LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME",{lastSprint:e.name}),r.html(n)),u.find(".delete-sprint").addClass("hidden"),n=S.instant("LIGHTBOX.ADD_EDIT_SPRINT.TITLE"),u.find(".title").text(n),n=S.instant("COMMON.CREATE"),u.find(".button-green").text(n),v.open(u),u.find(".sprint-name").focus(),u.find(".last-sprint-name").removeClass("disappear")})}),c.$on("sprintform:edit",function(t,r){return c.createEditOpen=!0,e(function(){var t,e;return a(),d=!1,t=S.instant("COMMON.PICKERDATE.FORMAT"),c.$apply(function(){return c.newSprint=r.realClone(),c.newSprint.estimated_start=moment(c.newSprint.estimated_start).format(t),c.newSprint.estimated_finish=moment(c.newSprint.estimated_finish).format(t)}),-1<i.project.get("my_permissions").indexOf("delete_milestone")&&u.find(".delete-sprint").removeClass("hidden"),e=S.instant("BACKLOG.EDIT_SPRINT"),u.find(".title").text(e),e=S.instant("COMMON.SAVE"),u.find(".button-green").text(e),v.open(u),u.find(".sprint-name").focus().select(),u.find(".last-sprint-name").addClass("disappear")})}),u.on("keyup",".sprint-name",function(t){return 0<u.find(".sprint-name").val().length||p?u.find(".last-sprint-name").addClass("disappear"):u.find(".last-sprint-name").removeClass("disappear")}),u.on("submit","form",n),u.on("click",".delete-sprint",function(t){return t.preventDefault(),r()}),c.$on("$destroy",function(){return u.off()}),a()}}};angular.module("taigaBacklog").directive("tgLbCreateEditSprint",["$tgRepo","$tgConfirm","$tgResources","$rootScope","lightboxService","$tgLoading","$translate","tgProjectService","$timeout",t])}.call(this),function(){var j,c,u,s,t,e,a,r,i={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m,g,v,y,_,S){var b;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.appMetaService=c,this.navUrls=u,this.events=l,this.analytics=p,this.translate=d,this.loading=h,this.rs2=f,this.modelTransform=m,this.errorHandlingService=g,this.storage=v,this.filterRemoteStorageService=y,this.projectService=_,this.tgLoader=S,j(this),this.backlogOrder={},this.milestonesOrder={},this.page=1,this.disablePagination=!1,this.firstLoadComplete=!1,this.translationData={q:this.filterQ},this.scope.userstories=[],this.totalUserStories=0,this.pendingDrag=[],this.scope.noSwimlaneUserStories=!1,this.scope.swimlanesList=Immutable.List(),this.applyStoredFilters(this.params.pslug,"backlog-filters",this.validQueryParams)||(this.scope.sectionName=this.translate.instant("BACKLOG.SECTION_NAME"),this.showTags=!0,this.activeFilters=!1,this.scope.showGraphPlaceholder=null,this.displayVelocity=!1,this.initializeEventHandlers(),(S=this.loadInitialData()).then((b=this,function(){var t,e;if(b.loadSwimlanes(),b.firstLoadComplete=!0,e=b.translate.instant("BACKLOG.PAGE_TITLE",{projectName:b.scope.project.name}),t=b.translate.instant("BACKLOG.PAGE_DESCRIPTION",{projectName:b.scope.project.name,projectDescription:b.scope.project.description}),b.appMetaService.setAll(e,t),b.rs.userstories.getShowTags(b.scope.projectId))return b.showTags=!0,b.scope.$broadcast("showTags",b.showTags)})),S.then(null,this.onInitialDataError.bind(this)))}r=this.taiga,t=this.taiga.mixOf,a=this.taiga.scopeDefer,c=this.taiga.bindOnce,s=this.taiga.groupBy,this.taiga.timeout,j=this.taiga.bindMethods,u=this.taiga.generateHash,e=angular.module("taigaBacklog"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(r.Controller,r.PageMixin,r.FiltersMixin,r.UsFiltersMixin)),n.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","$tgLoading","tgResources","$tgQueueModelTransformation","tgErrorHandlingService","$tgStorage","tgFilterRemoteStorageService","tgProjectService","tgLoader"],n.prototype.storeCustomFiltersName="backlog-custom-filters",n.prototype.storeFiltersName="backlog-filters",n.prototype.backlogOrder={},n.prototype.milestonesOrder={},n.prototype.newUs=[],n.prototype.validQueryParams=["exclude_status","status","exclude_tags","tags","exclude_assigned_users","assigned_users","exclude_role","role","exclude_epic","epic","exclude_owner","owner"],n.prototype.preloadUsIds=function(){var r,n=1,i=[],o=function(){var t=Object.assign({},r.lastLoadUserstoriesParams),t=Object.assign(t,{page:n,only_ref:!0});return r.rs.userstories.listUnassigned(r.scope.projectId,t,100,!1).then(function(t){var e=t[0],t=t[1];if(i=i.concat(e.map(function(t){return t.ref})),r.rs.userstories.storeBacklog(r.scope.projectId,i),t("x-pagination-next"))return n++,o()})};return(r=this).disablePagination?(i=this.scope.userstories.map(function(t){return t.ref}),this.rs.userstories.storeBacklog(this.scope.projectId,i)):o()},n.prototype.filtersReloadContent=function(){return this.loadUserstories(!0)},n.prototype.initializeEventHandlers=function(){var t,n,i,o,e,r,s,a,c,u=function(){return t.loadUserstories(!0),t.loadProjectStats(),t.rootscope.$broadcast("filters:update")};return(t=this).scope.$on("usform:bulk:success",(n=this,function(t,e,r){return null==r&&(r="bottom"),n.newUs=_.map(e,function(t){return t.id}),"top"===r?n.moveUsToTopOfBacklog(e).then(function(){return u()}):u(),n.analytics.trackEvent("userstory","create","bulk create userstory on backlog",1)})),this.scope.$on("sprintform:create:success",(i=this,function(t,e,r){return i.loadSprints().then(function(){return i.scope.$broadcast("sprintform:create:success:callback",r)}),i.loadProjectStats(),i.confirm.notify("success"),i.analytics.trackEvent("sprint","create","create sprint on backlog",1)})),this.scope.$on("usform:new:success",(o=this,function(t,e,r){return null==r&&(r="bottom"),o.newUs=[e.id],"top"===r?o.moveUsToTopOfBacklog(e).then(function(){return u()}):u(),o.analytics.trackEvent("userstory","create","create userstory on backlog",1)})),this.scope.$on("sprintform:edit:success",(e=this,function(){return e.loadProjectStats()})),this.scope.$on("sprintform:remove:success",(r=this,function(t,e){return r.displayVelocity&&r.toggleVelocityForecasting(),r.loadSprints(),r.loadProjectStats(),r.loadUserstories(!0),e.closed&&r.loadClosedSprints(),r.rootscope.$broadcast("filters:update")})),this.scope.$on("usform:edit:success",(s=this,function(t,e){var r=_.findIndex(s.scope.userstories,function(t){return t.id===e.id});return s.scope.userstories[r]=e,s.rootscope.$broadcast("filters:update")})),this.scope.$on("filters:update",(a=this,function(){return a.generateFilters("null")})),this.scope.$on("sprint:us:move",this.moveUs),this.scope.$on("sprint:us:moved",(c=this,function(){return c.resetFirstStoryIndicator(),c.rootscope.$broadcast("filters:update")})),this.scope.$on("backlog:load-closed-sprints",this.loadClosedSprints),this.scope.$on("backlog:unload-closed-sprints",this.unloadClosedSprints)},n.prototype.initializeSubscription=function(){var e,r,t="changes.project."+this.scope.projectId+".userstories";return this.events.subscribe(this.scope,t,(e=this,function(t){return e.loadAllPaginatedUserstories(),e.loadSprints()})),t="changes.project."+this.scope.projectId+".milestones",this.events.subscribe(this.scope,t,(r=this,function(t){return r.loadSprints(),r.loadClosedSprints(),r.loadProjectStats()}),{selfNotification:!0})},n.prototype.toggleShowTags=function(){return this.scope.$apply((t=this,function(){return t.showTags=!t.showTags,t.rs.userstories.storeShowTags(t.scope.projectId,t.showTags)}));var t},n.prototype.toggleActiveFilters=function(){return this.activeFilters=!this.activeFilters},n.prototype.toggleVelocityForecasting=function(){return this.displayVelocity=!this.displayVelocity,this.displayVelocity?(this.calculateForecasting(),this.scope.visibleUserStories=_.map(this.forecastedStories,function(t){return t.ref})):this.scope.visibleUserStories=_.map(this.scope.userstories,function(t){return t.ref}),a(this.scope,(t=this,function(){return t.scope.$broadcast("userstories:loaded")}));var t},n.prototype.loadProjectStats=function(){return this.rs.projects.stats(this.scope.projectId).then((r=this,function(t){var e=(r.scope.stats=t).total_points||t.defined_points;return r.scope.stats.completedPercentage=e?Math.round(100*t.closed_points/e):0,r.scope.showGraphPlaceholder=!(null!=t.total_points&&null!=t.total_milestones),r.calculateForecasting(),t}));var r},n.prototype.setMilestonesOrder=function(t){for(var i,o,e=[],r=0,n=t.length;r<n;r++)o=t[r],this.milestonesOrder[o.id]={},e.push(function(){for(var t=o.user_stories,e=[],r=0,n=t.length;r<n;r++)i=t[r],e.push(this.milestonesOrder[o.id][i.id]=i.sprint_order);return e}.call(this));return e},n.prototype.unloadClosedSprints=function(){return this.scope.$apply((t=this,function(){return t.scope.closedSprints=[],t.rootscope.$broadcast("closed-sprints:reloaded",[])}));var t},n.prototype.loadClosedSprints=function(){var o,t={closed:!0};return this.rs.sprints.list(this.scope.projectId,t).then((o=this,function(t){var e,r,n,i=t.milestones;for(o.setMilestonesOrder(i),o.scope.totalClosedMilestones=t.closed,e=0,r=i.length;e<r;e++)(n=i[e]).user_stories=_.sortBy(n.user_stories,"sprint_order");return o.scope.closedSprints=i,o.scope.closedSprintsById=s(i,function(t){return t.id}),o.rootscope.$broadcast("closed-sprints:reloaded",i),i}))},n.prototype.loadSwimlanes=function(){if(this.scope.project.swimlanes)return this.scope.project.swimlanes.forEach((e=this,function(t){if(!e.scope.swimlanesList.includes(t))return e.scope.swimlanesList=e.scope.swimlanesList.push(t)}));var e},n.prototype.loadSprints=function(){var o,t={closed:!1};return this.rs.sprints.list(this.scope.projectId,t).then((o=this,function(t){var e,r,n,i=t.milestones;for(o.setMilestonesOrder(i),o.scope.totalMilestones=i,o.scope.totalClosedMilestones=t.closed,o.scope.totalOpenMilestones=t.open,o.scope.totalMilestones=o.scope.totalOpenMilestones+o.scope.totalClosedMilestones,e=0,r=i.length;e<r;e++)(n=i[e]).user_stories=_.sortBy(n.user_stories,"sprint_order");return o.scope.sprints=i,o.scope.closedSprints||(o.scope.closedSprints=[]),o.scope.sprintsCounter=i.length,o.scope.sprintsById=s(i,function(t){return t.id}),o.rootscope.$broadcast("sprints:loaded",i),o.scope.currentSprint=o.findCurrentSprint(),i}))},n.prototype.openSprints=function(){return _.filter(this.scope.sprints,function(t){return!t.closed})},n.prototype.loadAllPaginatedUserstories=function(){var t,e=this.page;return this.loadUserstories(!0,this.scope.userstories.length).then((t=this,function(){return t.page=e}))},n.prototype.loadUserstories=function(r,t){var e,n;return null==r&&(r=!1),this.scope.projectId?(this.loadingUserstories=!0,this.disablePagination=!0,e=_.pick(_.clone(this.location.search()),this.validQueryParams),this.rs.userstories.storeQueryParams(this.scope.projectId,e),r&&(this.page=1),e.page=this.page,e.q=this.filterQ,this.lastLoadUserstoriesParams=e,this.translationData.q=e.q,this.rs.userstories.listUnassigned(this.scope.projectId,e,t).then((n=this,function(t){var e=t[0],t=t[1];return r&&(n.scope.userstories=[]),t=n.parseLoadUserstoriesResponse(e,t),n.page<=2&&n.preloadUsIds(),t}))):null},n.prototype.parseLoadUserstoriesResponse=function(t,e){var r,n,i,o,s;for(this.scope.userstories=this.scope.userstories.concat(_.sortBy(t,"backlog_order")),this.resetFirstStoryIndicator(),this.scope.visibleUserStories=_.map(this.scope.userstories,function(t){return t.ref}),n=0,i=(o=this.scope.userstories).length;n<i;n++)r=o[n],this.newUs.includes(r.id)&&(r.new=!0),this.backlogOrder[r.id]=r.backlog_order;return this.loadingUserstories=!1,e("x-pagination-next")&&(this.disablePagination=!1,this.page++),e("Taiga-Info-Backlog-Total-Userstories")&&(this.totalUserStories=e("Taiga-Info-Backlog-Total-Userstories")),e("Taiga-Info-Userstories-Without-Swimlane")&&(this.scope.noSwimlaneUserStories=e("Taiga-Info-Userstories-Without-Swimlane")),this.rootscope.$broadcast("backlog:userstories:loaded"),a(this.scope,(s=this,function(){return s.scope.$broadcast("userstories:loaded"),s.tgLoader.pageLoaded()})),t},n.prototype.loadBacklog=function(){return this.q.all([this.loadProjectStats(),this.loadSprints(),this.loadUserstories()]).then(this.calculateForecasting)},n.prototype.getLinkParams=function(){var e,r=this.lastLoadUserstoriesParams;return r?(delete r.page,r=_.pickBy(r,_.identity),e={},Object.keys(r).forEach(function(t){return e["backlog-"+t]=r[t]}),e["no-milestone"]=1,e):{}},n.prototype.sprintTotalPoints=function(t){for(var e,r=0,n=t.user_stories,i=0,o=n.length;i<o;i++)(e=n[i]).milestone===t.id&&(r+=e.total_points);return r},n.prototype.calculateForecasting=function(){var t,e,r,n,i,o=this.scope.stats,s=(o.total_points,o.assigned_points,0);for(this.forecastedStories=[],this.scope.forecastNewSprint=!0,this.scope.sprints&&this.scope.sprints.length&&(s=this.sprintTotalPoints(this.scope.sprints[0]),0<o.speed&&s>o.speed?s=0:this.scope.forecastNewSprint=!1),n=[],t=0,e=(r=this.scope.userstories).length;t<e&&((i=r[t]).total_points,s+=i.total_points,this.forecastedStories.push(i),!(0<o.speed&&s>o.speed));t++)n.push(void 0);return n},n.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.is_backlog_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.closedMilestones=!!t.total_closed_milestones,this.scope.$emit("project:loaded",t),this.scope.points=_.sortBy(t.points,"order"),this.scope.pointsById=s(t.points,function(t){return t.id}),this.scope.usStatusById=s(t.us_statuses,function(t){return t.id}),this.scope.usStatusList=_.sortBy(t.us_statuses,"id"),this.resetFirstStoryIndicator(),t},n.prototype.loadInitialData=function(){var t,e,r=this.loadProject();return this.fillUsersAndRoles(r.members,r.roles),this.initializeSubscription(),!1===this.rs.userstories.getShowTags(this.scope.projectId)&&(this.showTags=!1),this.loadBacklog().then((e=this,function(){return e.generateFilters("null")})).then((t=this,function(){return t.scope.$emit("backlog:loaded")}))},n.prototype.toggleTags=function(){return this.rs.userstories.storeShowTags(this.scope.projectId,this.showTags)},n.prototype.prepareBulkUpdateData=function(t,e){return null==e&&(e="backlog_order"),_.map(t,function(t){return{us_id:t.id,order:t[e]}})},n.prototype.resetFirstStoryIndicator=function(){if(0<this.scope.userstories.length)return this.scope.first_us_in_backlog=this.scope.userstories[0].id},n.prototype.moveUsToTopOfBacklog=function(t){var e;return Array.isArray(t)||(t=[t]),t[0],this.scope.userstories.length?(e=this.scope.userstories[0].id,this.moveUs("sprint:us:move",t,0,null,null,e)):Promise.resolve()},n.prototype.moveUs=function(t,o,r,n,e,i){var s,a,c,u,l,p,d,h,f,m,g,v,y,S,b,j,k,I=o[0].milestone,$=o[0].project;if(I&&(g=this.scope.sprintsById[I]||this.scope.closedSprintsById[I]),n&&(f=this.scope.sprintsById[n]||this.scope.closedSprintsById[n]),s=n!==I?n:I,k=_.map(o,function(t){return t.id}),t){if(this.pendingDrag.push({usList:o,newUsIndex:r,newSprintId:n,previousUs:e,nextUs:i}),n!==I)if(g&&o.forEach(function(e,t){return _.remove(g.user_stories,function(t){return t.id===e.id})}),null===n){for(c=a=0,l=o.length;a<l;c=++a)y=o[c],_.remove(g.user_stories,function(t){return t.id===y.id});o.forEach((b=this,function(t,e){return b.scope.userstories.splice(r+e,0,t)}))}else{for(u=0,p=o.length;u<p;u++)y=o[u],_.remove(this.scope.userstories,function(t){return t.id===y.id});o.forEach((S=this,function(t,e){return t.milestone=n,f.user_stories.splice(r,0,t),f=Object.assign(f,{user_stories:f.user_stories.slice()}),S.scope.sprints=S.scope.sprints.map(function(t){return Object.assign(t)})}))}else{for(v=n?f.user_stories:this.scope.userstories,h=0,d=o.length;h<d;h++)y=o[h],_.remove(v,function(t){return t.id===y.id});m=0,e?m=v.findIndex(function(t){return t.id===e}):i&&(m=v.findIndex(function(t){return t.id===e})),m++,o.forEach(function(t,e){return v.splice(m+e,0,t)})}this.scope.visibleUserStories=_.map(this.scope.userstories,function(t){return t.ref})}if(!(t&&1<this.pendingDrag.length))return(k=this.rs.userstories.bulkUpdateBacklogOrder($,s,e,i,k)).then((j=this,function(t){for(var r,e=t.data,n=0,i=e.length;n<i;n++)r=e[n],o.forEach(function(t,e){if(t.id===r.id)return t.milestone=r.milestone,t.backlog_order=r.backlog_order});return j.pendingDrag.shift(),j.pendingDrag.length?j.scope.$applyAsync(function(){return j.moveUs(null,j.pendingDrag[0].usList,j.pendingDrag[0].newUsIndex,j.pendingDrag[0].newSprintId,j.pendingDrag[0].previousUs,j.pendingDrag[0].nextUs)}):(j.rootscope.$broadcast("sprint:us:moved"),j.events.connected||(j.loadSprints(),j.loadClosedSprints(),j.loadProjectStats()),j.scope.closedSprintsById&&j.scope.closedSprintsById[I]?j.rootscope.$broadcast("backlog:load-closed-sprints"):void 0)})),k},n.prototype.updateUserStoryStatus=function(){return this.generateFilters().then((t=this,function(){if(t.rootscope.$broadcast("filters:update"),t.loadProjectStats(),t.isFilterDataTypeSelected("status"))return t.filtersReloadContent()}));var t},n.prototype.editUserStory=function(t,e,r){return this.rs.userstories.getByRef(t,e).then((n=this,function(e){return n.rs2.attachments.list("us",e.id,t).then(function(t){return n.rootscope.$broadcast("genericform:edit",{objType:"us",obj:e,attachments:t.toJS()})})}));var n},n.prototype.deleteUserStory=function(r){var n,t=this.translate.instant("US.TITLE_DELETE_ACTION",{projectName:this.scope.project.name}),e=this.translate.instant("US.TITLE_DELETE_MESSAGE",{subject:r.subject});return this.confirm.askOnDelete(t,e,"").then((n=this,function(t){var e;return n.scope.userstories=_.without(n.scope.userstories,r),(e=n.repo.remove(r)).then(function(){return t.finish(),n.q.all([n.loadProjectStats(),n.loadSprints(),n.resetFirstStoryIndicator()])}),e.then(null,function(){return t.finish(!1),n.confirm.notify("error")})}))},n.prototype.addNewUs=function(t){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new",{objType:"us",project:this.scope.project});case"bulk":return this.rootscope.$broadcast("usform:bulk",this.scope.projectId,this.scope.project.default_us_status)}},n.prototype.addNewSprint=function(){return this.rootscope.$broadcast("sprintform:create",this.scope.projectId)},n.prototype.findCurrentSprint=function(){var r=(new Date).getTime();return _.find(this.scope.sprints,function(t){var e=moment(t.estimated_start,"YYYY-MM-DD").format("x"),t=moment(t.estimated_finish,"YYYY-MM-DD").format("x");return e<=r&&r<=t})},n.prototype.addFilterBacklog=function(t){return this.selectFilter(t.category.dataType,t.filter.id,!1,t.mode),this.filtersReloadContent(),this.generateFilters("null")},n.prototype.removeFilterBacklog=function(t){return this.unselectFilter(t.dataType,t.id,!1,t.mode),this.filtersReloadContent(),this.generateFilters("null")},e.controller("BacklogController",n),r=function(t,d,n,h){var i=_.template('<div class="doom-line"><span><%- text %></span></div>'),s=function(u,l,t,e){var r=function(){var t,e,r,n,i,o,s,a,c;if(u.displayVelocity&&p(),null!=u.stats&&null!=u.stats.total_points&&0!==u.stats.total_points&&null==u.displayVelocity&&(p(),c=(a=u.stats).total_points,t=a.assigned_points,u.userstories)){for(s=[],r=n=0,i=(o=u.userstories).length;n<i;r=++n){if(c<(t+=o[r].total_points)){e=l.find(".backlog-table-body .us-item-row")[r],d(e);break}s.push(void 0)}return s}},p=function(){return l.find(".doom-line").remove()},d=function(t){var e=n.instant("BACKLOG.DOOMLINE");return $(t).before(i({text:e}))};return u.$on("userstories:loaded",r),u.$on("userstories:forecast",p),u.$on("sprint:us:moved",r),u.$watch("stats",r)},a=function(n,i,t,o){var s,a,c,r=function(){var t=i.find(".backlog-table-body input:checkbox:checked");return _.map(t,function(t){return(t=(t=$(t).closest(".tg-scope")).scope()).us.milestone=n.sprints[0].id,t.us})},u=function(t,e){var r=_(n.userstories);return n.userstories=r.without.apply(r,t).value(),r=_.map(t,function(t,e){return t.total_points}),r=_.reduce(r,function(t,e){return t+e}),e.user_stories=_.union(e.user_stories,t),e.total_points+=r,t=_.map(t,function(t){return{us_id:t.id,order:t.sprint_order}}),h.userstories.bulkUpdateMilestone(n.project.id,n.sprints[0].id,t).then(function(){return o.loadSprints(),o.loadProjectStats(),o.toggleVelocityForecasting(),o.calculateForecasting()}),i.find(".move-to-sprint").hide()},l=function(t){var e=n.currentSprint||n.sprints[0];return u(t,e)},p=function(t){return u(t,n.sprints[0])};return n.$on("sprintform:create:success:callback",function(t,e){if(e)return _.partial(l,e)()}),c=!1,a=null,s=function(t){return a=t.closest(".us-item-row"),t.closest(".us-item-row").toggleClass("ui-multisortable-multiple"),t=i.find(".move-to-sprint"),0<i.find(".backlog-table-body input:checkbox:checked").length&&0<n.sprints.length?t.css("display","flex"):t.hide()},$(window).on("keydown.shift-pressed keyup.shift-pressed",function(t){return c=!!t.shiftKey,!0}),i.on("change",".backlog-table-body input:checkbox",function(t){var e,r,n,i;return a&&c&&(r=[],e=$(t.currentTarget).closest(".us-item-row"),n=a.nextAll(),i=a.prevAll(),_.some(n,function(t){return t===e[0]})?r=a.nextUntil(e):_.some(i,function(t){return t===e[0]})&&(r=a.prevUntil(e)),_.map(r,function(t){t=$(t).find("input:checkbox");return t.prop("checked",!0),s(t)})),(t=angular.element(t.currentTarget)).closest(".us-item-row").toggleClass("is-checked"),s(t)}),i.on("click","#move-to-latest-sprint",function(t){var e=r();return n.$apply(_.partial(p,e))}),i.on("click","#move-to-current-sprint",function(t){var e=r();return n.$apply(_.partial(l,e))}),i.on("change","#show-tags > input",function(t){return t.preventDefault(),o.toggleShowTags(),f(o)}),i.on("click",".forecasting-add-sprint",function(t){var e,r=o.forecastedStories;return n.forecastNewSprint?(e=_.map(r,function(t,e){return t.order=e,t}),d.$broadcast("sprintform:create",n.projectId,e)):(e=_.map(r,function(t,e){return t.milestone=n.sprints[0].id,t.order=e,t}),n.$apply(_.partial(l,e)))})},f=function(t){var e=angular.element("#show-tags");return t.showTags?e.addClass("active"):e.removeClass("active")},c=function(t,e,r){return e.find(".backlog-filter").addClass("active"),r.activeFilters=!0},o=function(t,e,r){var n=e.find(".backlog-filter"),e=angular.element("#show-filters-button");return n.toggleClass("active"),e.toggleClass("active"),r.toggleActiveFilters()},u=function(e,r,t,n){return e.filtersSearch={},r.on("click","#show-filters-button",function(t){return t.preventDefault(),e.$apply(function(){return o(0,r,n)})})};return{link:function(t,e,r,n){var i,o=e.controller();return a(t,e,0,o),u(t,e,0,o),s(t,e),((i=o.location.search()).status||i.tags||i.assigned_to||i.owner)&&c(0,e,o),t.$on("showTags",function(){return f(o)}),t.$on("$destroy",function(){return e.off(),$(window).off(".shift-pressed")})}}},e.directive("tgBacklog",["$tgRepo","$rootScope","$translate","$tgResources",r]),r=function(t,e,o,r){var s=e.get("backlog/us-edit-popover.html",!0);return{link:function(r,n,t){n.controller();var i=function(){return n.find(".js-popup-button").removeClass("popover-open"),$(this).remove()};return n.on("click",function(t){var e=o(s())(r);if(n.find(".js-popup-button").addClass("popover-open"),n.append(e),n.find(".us-option-popup").popover().open(function(){return i()}),t.target.parentNode.classList.contains("first"))return n.find(".us-option-popup").addClass("first")}),r.$on("$destroy",function(){return n.off()})}}},e.directive("tgUsEditSelector",["$rootScope","$tgTemplate","$compile","$translate",r]),r=function(i,t,o,s){var a=t.get("backlog/us-role-points-popover.html",!0);return{link:function(e,n,t){var r=function(){return n.removeClass("popover-open")};return c(e,"project",function(t){t=_.filter(t.roles,"computable");return 1<_.size(t)?n.append(o(a({roles:t}))(e)):(n.find(".icon-arrow-down").remove(),n.find(".header-points").addClass("not-clickable"))}),e.$on("uspoints:select",function(t,e,r){return n.find(".popover").popover().close(),n.find(".header-points").html(""+r)}),e.$on("uspoints:clear-selection",function(t,e){var r;return n.find(".popover").popover().close(),r=s.instant("COMMON.FIELDS.POINTS"),n.find(".header-points").text(r)}),n.on("click",function(t){var e=angular.element(t.target);return(e.is("span")||e.is("div"))&&t.stopPropagation(),n.addClass("popover-open"),n.find(".popover").popover().open(r)}),n.on("click",".clear-selection",function(t){return t.preventDefault(),t.stopPropagation(),i.$broadcast("uspoints:clear-selection"),n.find(".active-popover").removeClass("active-popover"),target.addClass("active-popover")}),n.on("click",".role",function(t){return t.preventDefault(),t.stopPropagation(),t=angular.element(t.currentTarget),n.find(".active-popover").removeClass("active-popover"),t.addClass("active-popover"),t.scope(),i.$broadcast("uspoints:select",t.data("role-id"),t.text())}),e.$on("$destroy",function(){return n.off()})}}},e.directive("tgUsRolePointsSelector",["$rootScope","$tgTemplate","$compile","$translate",r]),r=function(u,t,l){var p=l.get("common/estimation/us-points-roles-popover.html",!0);return{link:function(o,e,n){var t,r,s=e.controller(),i=null,a=null,c=null;return o.$on("uspoints:select",function(t,e,r){o.$eval(n.tgBacklogUsPoints);return a=e,c.render()}),o.$on("uspoints:clear-selection",function(t){o.$eval(n.tgBacklogUsPoints);return a=null,c.render()}),o.$watch(n.tgBacklogUsPoints,function(n){var i;if(n)return c=u.create(e,n,o.project),0===(i=c.calculateRoles()).length?(e.find(".icon-arrow-bottom").remove(),e.find("a.us-points").addClass("not-clickable")):1===i.length&&(a=_.keys(n.points)[0]),c.isEditable&&t(),c.onSelectedPointForRole=function(t,e,r){return n.points=r,c.render(),this.save(t,e).then(function(){return s.loadProjectStats()})},c.render=function(){var t,e=this.calculateTotalPoints(),r=null==a||1===i.length?t=e:(r=this.us.points[a],t=(r=this.pointsById[r]).name+" / <span>"+e+"</span>",r.name+" / "+e),r={totalPoints:e,roles:this.calculateRoles(),editable:this.isEditable,text:t,title:r},r=l.get("common/estimation/us-estimation-total.html",!0)(r);return this.$el.html(r)},c.render()}),r=function(){var t=c.calculateRoles(),t=p({roles:t});return e.append(t),e.find(".pop-role").popover().open(function(){return $(this).remove()})},t=function(){return e.on("click",".us-points",function(t){return t.preventDefault(),t.stopPropagation(),o.$eval(n.tgBacklogUsPoints),null!=(i=a)?c.renderPointsSelector(a):r()}),e.on("click",".role",function(t){return t.preventDefault(),t.stopPropagation(),t=angular.element(t.currentTarget),o.$eval(n.tgBacklogUsPoints),i=t.data("role-id"),(t=e.find(".pop-role")).find("a").removeClass("active"),t.find("a[data-role-id='"+i+"']").addClass("active"),c.renderPointsSelector(i)})},o.$on("$destroy",function(){return e.off()})}}},e.directive("tgBacklogUsPoints",["$tgEstimationsService","$tgRepo","$tgTemplate",r]),r=function(s){var a=function(){return $(".js-burndown-graph").removeClass("shown"),$(".js-toggle-burndown-visibility-button").removeClass("active"),$(".js-burndown-graph").removeClass("open")},c=function(t){return $(".js-toggle-burndown-visibility-button").addClass("active"),t?$(".js-burndown-graph").addClass("shown"):$(".js-burndown-graph").addClass("open")};return{link:function(t,e,r){var n,i=!0,o=u(["is-burndown-grpahs-collapsed"]);return t.isBurndownGraphCollapsed=s.get(o)||!1,n=function(){return t.isBurndownGraphCollapsed?a():c(i),i=!1},t.$watch("showGraphPlaceholder",function(){if(null!=t.showGraphPlaceholder)return t.isBurndownGraphCollapsed=t.isBurndownGraphCollapsed||t.showGraphPlaceholder,n()}),e.on("click",".js-toggle-burndown-visibility-button",function(){return t.isBurndownGraphCollapsed=!t.isBurndownGraphCollapsed,s.set(o,t.isBurndownGraphCollapsed),n()}),t.$on("$destroy",function(){return e.off()})}}},e.directive("tgToggleBurndownVisibility",["$tgStorage",r]),r=function(s){var i=function(t,o){var e,r,n,i=t.width();return t.height(i/6),r=function(){n=[];for(var t=0,e=o.milestones.length-1;0<=e?t<=e:e<=t;0<=e?t++:t--)n.push(t);return n}.apply(this),e=[],i=_.map(o.milestones,function(t){return 0}),e.push({data:_.zip(r,i),lines:{fillColor:"rgba(0,0,0,0)"},points:{show:!1}}),i=_.map(o.milestones,function(t){return t.optimal}),e.push({data:_.zip(r,i),lines:{fillColor:"rgba(200,201,196,0.2)"}}),i=_.filter(_.map(o.milestones,function(t){return t.evolution}),function(t){return null!=t}),e.push({data:_.zip(r,i),lines:{fillColor:"rgba(147,196,0,0.2)"}}),i=_.map(o.milestones,function(t){return-t["team-increment"]-t["client-increment"]}),e.push({data:_.zip(r,i),lines:{fillColor:"rgba(200,201,196,0.2)"}}),i=_.map(o.milestones,function(t){return-t["team-increment"]}),e.push({data:_.zip(r,i),lines:{fillColor:"rgba(255,160,160,0.2)"}}),i=["rgba(200,201,196,0.2)","rgba(216,222,233,1)","rgba(168,228,64,1)","rgba(216,222,233,1)","rgba(255,160,160,1)"],i={grid:{borderWidth:{top:0,right:1,left:0,bottom:0},borderColor:"#D8DEE9",color:"#D8DEE9",hoverable:!0,margin:{top:0,right:20,left:5,bottom:0}},xaxis:{ticks:o.milestones.length,axisLabel:s.instant("BACKLOG.CHART.XAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5,tickFormatter:function(t,e){return""}},yaxis:{axisLabel:s.instant("BACKLOG.CHART.YAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},series:{shadowSize:0,lines:{show:!0,fill:!0},points:{show:!0,fill:!0,radius:4,lineWidth:2}},colors:i,tooltip:!0,tooltipOpts:{content:function(t,e,r,n){var i;return 1===n.seriesIndex?(i={sprintName:o.milestones[e].name,value:Math.abs(10*r)/10},s.instant("BACKLOG.CHART.OPTIMAL",i)):2===n.seriesIndex?(i={sprintName:o.milestones[e].name,value:Math.abs(10*r)/10},s.instant("BACKLOG.CHART.REAL",i)):3===n.seriesIndex?(i={sprintName:o.milestones[e].name,value:Math.abs(10*r)/10},s.instant("BACKLOG.CHART.INCREMENT_CLIENT",i)):(i={sprintName:o.milestones[e].name,value:Math.abs(10*r)/10},s.instant("BACKLOG.CHART.INCREMENT_TEAM",i))}}},t.empty(),t.plot(e,i).data("plot")};return{link:function(e,t,r){var n=angular.element(t);return e.$watch("stats",function(t){if(null!=e.stats)return i(n,e.stats),e.$on("resize",function(){return i(n,e.stats)})}),e.$on("$destroy",function(){return t.off()})}}},e.directive("tgBurndownBacklogGraph",["$translate",r]),r=function(t,i){var o=t.get("backlog/progress-bar.html",!0),s=function(t,e,r,n){n=o({projectPointsPercentaje:r,closedPointsPercentaje:n});return n=i(n)(t),e.html(n)},a=function(t){t=_.max([0,t]);return t=_.min([100,t]),Math.round(t)};return{link:function(i,o,t){angular.element(o);return i.$watch(t.tgBacklogProgressBar,function(t){var e,r,n;if(null!=t)return n=t.total_points||t.defined_points,e=t.defined_points,t=t.closed_points,n=n<e?(r=100*n/e,100*t/e):(r=100)*t/n,r=a(r-3),n=a(n-3),s(i,o,r,n)}),i.$on("$destroy",function(){return o.off()})}}},e.directive("tgBacklogProgressBar",["$tgTemplate","$compile",r])}.call(this),function(){this.taiga;var e=this.taiga.bindOnce,t=angular.module("taigaBacklog"),f=function(t){return $(t).scope().$destroy(),$(t).off(),$(t).remove()},r=function(){return{link:function(h,r,t){return h.ctrl||console.error("BacklogSortableDirective must have access to to BacklogCtrl"),e(h,"project",function(t){var e,u,l,p,d;if(-1<t.my_permissions.indexOf("modify_us"))return u=!1,t=$(".js-empty-backlog"),p=l=d=null,(e=dragula([r[0],t[0],t[1]],{copySortSource:!1,copy:!1,isContainer:function(t){return t.classList.contains("sprint-table")},moves:function(t){return!!$(t).hasClass("row")}})).on("drop",function(t,e,r,n){var i;if(l=d=null,i=$(t).prevAll(".row:not(.gu-transit)"),t=$(t).nextAll(".row:not(.gu-transit)"),d=null,i.length&&i[0].dataset.id&&(d=Number(i[0].dataset.id)),l=null,!d&&t.length&&t[0].dataset.id)return l=Number(t[0].dataset.id)}),e.on("drag",function(t,e){var r;return h.ctrl.displayVelocity&&h.ctrl.toggleVelocityForecasting(),r=$(t).parent(),u=r.hasClass("backlog-table-body"),$(document.body).addClass("drag-active"),$(t).find("input[type='checkbox']").is(":checked"),window.dragMultiple.start(t,e),e=(e=window.dragMultiple.getElements()).length?e[0]:t,t=t.parentNode,p=$(t).find("tg-card").index(e),p=u?$(e).index(".backlog-table-body .row"):$(e).index()}),e.on("cloned",function(t){return $(t).addClass("multiple-drag-mirror")}),e.on("dragend",function(t){var e,r,n,i,o,s,a,c;if($(".doom-line").remove(),i=(o=$(t).parent()).hasClass("backlog-table-body")||o.hasClass("js-empty-backlog"),s=u||i?u===i:o&&$(t).scope().sprint.id===o.scope().sprint.id,e=window.dragMultiple.stop(),$(document.body).removeClass("drag-active"),a=null,r=e.length?e[0]:t,i?n=$(r).index(".backlog-table-body .row"):(n=$(r).index(),a=null!=(o=o.scope())?o.sprint.id:void 0),n!==p||!s)return s?e.length?c=_.map(e,function(t){return $(t).scope().us}):$(t).scope()&&(c=[$(t).scope().us]):(e.length?c=_.map(e,function(t){return $(t).scope().us}):$(t).scope()&&(c=[$(t).scope().us]),e.length?_.each(e,f):f(t)),h.$applyAsync(function(){return h.ctrl.moveUs("sprint:us:move",c,n,a,d,l)})}),autoScroll([window],{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&e.dragging}}),h.$on("$destroy",function(){return r.off(),e.destroy()})})}}};t.directive("tgBacklogSortable",r)}.call(this),function(){this.taiga;var t=angular.module("taigaBacklog"),e=function(t,i){var o={duration:500,easing:"linear"},s=function(t){var e=t.find(".sprint-table");return t.find(".compact-sprint").toggleClass("active"),e.toggleClass("open")};return{link:function(e,r,n){return e.$watch(n.tgBacklogSprint,function(t){return e.$eval(n.tgBacklogSprint).closed?r.addClass("sprint-closed"):s(r)}),r.on("click",".sprint-name > .compact-sprint",function(t){return t.preventDefault(),s(r),r.find(".sprint-table").slideToggle(o)}),r.on("click",".edit-sprint",function(t){return t.preventDefault(),t=e.$eval(n.tgBacklogSprint),i.$broadcast("sprintform:edit",t)}),e.$on("$destroy",function(){return r.off()})}}};t.directive("tgBacklogSprint",["$tgRepo","$rootScope",e]),e=function(c,t,u,l){var p=t.get("backlog/sprint-header.html");return{link:function(n,i,t,e){var o=l.instant("BACKLOG.SPRINTS.DATE"),s=function(){return-1!==n.project.my_permissions.indexOf("modify_milestone")},a=function(){return-1!==n.project.my_permissions.indexOf("view_milestones")},r=function(t){var e=c.resolve("project-taskboard",{project:n.project.slug,sprint:t.slug}),r=moment(t.estimated_start).format(o)+"-"+moment(t.estimated_finish).format(o),r={name:t.name,taskboardUrl:e,estimatedDateRange:r,closedPoints:t.closed_points||0,totalPoints:t.total_points||0,isVisible:a(),isEditable:s()},t=n.$new();return _.assign(t,r),t=u(p)(t),i.html(t)};return n.$watch("sprint",r),n.$on("$destroy",function(){return i.off()})},restrict:"EA"}},t.directive("tgBacklogSprintHeader",["$tgNavUrls","$tgTemplate","$compile","$translate",e]),e=function(o,s,a){var c=!0;return{link:function(t,r,e){var n,i=$("<div>");return r.after(i),n=null,r.on("click",function(t){return t.preventDefault(),c=!c,n=s().target(i).start(),c?o.$broadcast("backlog:unload-closed-sprints"):o.$broadcast("backlog:load-closed-sprints")}),t.$on("$destroy",function(){return r.off()}),t.$on("closed-sprints:reloaded",function(t,e){return n&&n.finish(),e=0<e.length?"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS":"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS",e=a.instant(e),r.find(".text").text(e)})}}},t.directive("tgBacklogToggleClosedSprintsVisualization",["$rootScope","$tgLoading","$translate",e]),(e=function(t){return{templateUrl:"backlog/sprint.html",scope:{sprint:"=",project:"="}}}).$inject=[],t.directive("tgSprint",e)}.call(this),function(){this.taiga,this.taiga.mixOf,this.taiga.toggleText,this.taiga.scopeDefer,this.taiga.bindOnce,this.taiga.groupBy;var s=this.taiga.timeout,t=function(i){var o=function(t,e){var r,n;t.width();return t.height(240),n=_.map(e,function(t){return moment.utc(t.day)}),(r=[]).unshift({data:_.zip(n,_.map(e,function(t){return t.open_points})),lines:{fillColor:"rgba(147,196,0,0.2)"}}),r.unshift({data:_.zip(n,_.map(e,function(t){return t.optimal_points})),lines:{fillColor:"rgba(200,201,196,0.2)"}}),n={grid:{borderWidth:{top:0,right:1,left:0,bottom:0},borderColor:"#D8DEE9",color:"#D8DEE9",hoverable:!0,margin:{top:0,right:30,left:5,bottom:5}},xaxis:{tickSize:[1,"day"],min:n[0],max:_.last(n),mode:"time",daysNames:n,axisLabel:i.instant("TASKBOARD.CHARTS.XAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},yaxis:{min:0,axisLabel:i.instant("TASKBOARD.CHARTS.YAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},series:{shadowSize:0,lines:{show:!0,fill:!0},points:{show:!0,fill:!0,radius:4,lineWidth:2}},colors:["rgba(216,222,233,1)","rgba(168,228,64,1)"],tooltip:!0,tooltipOpts:{content:function(t,e,r,n){e=moment(e).format(i.instant("TASKBOARD.CHARTS.DATE")),r=Math.round(10*r)/10;return 1===n.seriesIndex?i.instant("TASKBOARD.CHARTS.REAL",{formattedDate:e,roundedValue:r}):i.instant("TASKBOARD.CHARTS.OPTIMAL",{formattedDate:e,roundedValue:r})}}},t.empty(),t.plot(r,n).data("plot")};return{link:function(e,t,r){var n=angular.element(t);return e.$on("resize",function(){if(e.stats)return o(n,e.stats.days)}),e.$on("taskboard:graph:toggle-visibility",function(){return t.parent().toggleClass("open"),s(100,function(){if(e.stats)return o(n,e.stats.days)})}),e.$watch("stats",function(t){if(null!=e.stats)return o(n,e.stats.days)}),e.$on("$destroy",function(){return t.off()})}}};angular.module("taigaTaskboard").directive("tgSprintChart",["$translate",t])}.call(this),function(){this.taiga,this.taiga.bindOnce;var r=this.taiga.debounce,t=(this.taiga.trim,function(t,c,u,l,p,d){return{link:function(o,s,t){var e,a;return o.form={data:"",usId:null},e=r(2e3,function(t){var e,r,n,i;if(t.preventDefault(),s.find("form").checksley().validate())return e=l().target(a).start(),n=o.form.data,r=o.projectId,i=o.form.sprintId,t=o.form.usId,(n=c.tasks.bulkCreate(r,i,t,n)).then(function(t){return t=_.map(t,function(t){return d.make_model("tasks",t)}),e.finish(),u.$broadcast("taskform:bulk:success",t),p.close(s)}),n.then(null,function(){return e.finish()})}),o.$on("taskform:bulk",function(t,e,r){return p.open(s),o.form={data:"",sprintId:e,usId:r}}),a=s.find(".submit-button"),s.on("submit","form",e),o.$on("$destroy",function(){return s.off()})}}});angular.module("taigaTaskboard").directive("tgLbCreateBulkTasks",["$tgRepo","$tgResources","$rootScope","$tgLoading","lightboxService","$tgModel",t])}.call(this),function(){var T,i,r,t,e,C,o={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m,g,v,y,_,S,b){var j,k,I,$,E;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.rs2=o,this.params=s,this.q=a,this.appMetaService=c,this.location=u,this.navUrls=l,this.events=p,this.analytics=d,this.translate=h,this.errorHandlingService=f,this.taskboardTasksService=m,this.taskboardIssuesService=g,this.storage=v,this.filterRemoteStorageService=y,this.lightboxFactory=_,this.timeout=S,this.projectService=b,T(this),this.taskboardTasksService.reset(),this.scope.userstories=[],this.openFilter=!1,this.filterQ="",this.backToBacklogUrl=this.navUrls.resolve("project-backlog",{project:this.projectService.project.get("slug"),ref:this.params.ref}),this.applyStoredFilters(this.params.pslug,"tasks-filters",this.validQueryParams)||(this.scope.sectionName=this.translate.instant("TASKBOARD.SECTION_NAME"),this.initializeEventHandlers(),C.defineImmutableProperty(this.scope,"usTasks",(j=this,function(){return j.taskboardTasksService.usTasks})),C.defineImmutableProperty(this.scope,"taskMap",(k=this,function(){return k.taskboardTasksService.taskMap})),C.defineImmutableProperty(this.scope,"milestoneIssues",(I=this,function(){return I.taskboardIssuesService.milestoneIssues})),C.defineImmutableProperty(this.scope,"tasksByUs",($=this,function(){return $.taskboardTasksService.tasksByUs})),this.scope.issues=[],this.scope.showTags=!0,this.scope.$watch("milestoneIssues",(E=this,function(){return E.scope.milestoneIssues?E.scope.issues=E.scope.milestoneIssues.toJS().map(function(e){return E.taskboardIssuesService.issuesRaw.find(function(t){return e.model.id===t.id})}):E.scope.issues=[]})))}C=this.taiga,this.taiga.toggleText,t=this.taiga.mixOf,r=this.taiga.groupBy,this.taiga.bindOnce,this.taiga.scopeDefer,this.taiga.timeout,T=this.taiga.bindMethods,i=this.taiga.debounceLeading,e=angular.module("taigaTaskboard"),function(t,e){for(var r in e)o.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(C.Controller,C.PageMixin,C.FiltersMixin)),n.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","tgResources","$routeParams","$q","tgAppMetaService","$tgLocation","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","tgErrorHandlingService","tgTaskboardTasks","tgTaskboardIssues","$tgStorage","tgFilterRemoteStorageService","tgLightboxFactory","$timeout","tgProjectService"],n.prototype.excludePrefix="exclude_",n.prototype.filterCategories=["status","assigned_to","owner","role","tags"],n.prototype.validQueryParams=["exclude_status","status","exclude_assigned_to","assigned_to","exclude_role","role","exclude_owner","owner","order_by","tags"],n.prototype.getQueryParams=function(){return _.pick(_.clone(this.location.search()),this.validQueryParams)},n.prototype.firstLoad=function(){var t,e=this.loadInitialData();return e.then((t=this,function(){return t._setMeta()})),e.then(null,this.onInitialDataError.bind(this))},n.prototype.setZoom=function(t,e){var r,n,i;return this.zoomLevel===Number(t)?null:(this.isFirstLoad=!this.zoomLevel,r=this.zoomLevel,this.zoomLevel=t,this.zoom=e,this.isFirstLoad?this.firstLoad().then((i=this,function(){return i.isFirstLoad=!1,i.taskboardTasksService.resetFolds()})):1<this.zoomLevel&&r<=1?(this.zoomLoading=!0,this.q.all([this.loadTasks(),this.loadIssues()]).then((n=this,function(){return n.zoomLoading=!1,n.taskboardTasksService.resetFolds()}))):void 0)},n.prototype.changeQ=function(t){return this.filterQ=t,this.loadTasks(),this.generateFilters()},n.prototype.removeFilter=function(t){return this.unselectFilter(t.dataType,t.id,!1,t.mode),this.loadTasks(),this.generateFilters()},n.prototype.addFilter=function(t){return this.selectFilter(t.category.dataType,t.filter.id,!1,t.mode),this.loadTasks(),this.generateFilters()},n.prototype.selectCustomFilter=function(t){return this.replaceAllFilters(t.filter),this.loadTasks(),this.generateFilters()},n.prototype.removeCustomFilter=function(e){return this.filterRemoteStorageService.getFilters(this.scope.projectId,"tasks-custom-filters").then((r=this,function(t){return delete t[e.id],r.filterRemoteStorageService.storeFilters(r.scope.projectId,t,"tasks-custom-filters").then(r.generateFilters)}));var r},n.prototype.isFilterDataTypeSelected=function(t){for(var e=this.selectedFilters,r=0,n=e.length;r<n;r++)if(e[r].dataType===t)return!0;return!1},n.prototype.saveCustomFilter=function(e){for(var t,r,n,i={},o=this.getQueryParams(),s=this.filterCategories,a=0,c=s.length;a<c;a++)r=s[a],t=this.excludePrefix.concat(r),i[r]=o[r],i[t]=o[t];return this.filterRemoteStorageService.getFilters(this.scope.projectId,"tasks-custom-filters").then((n=this,function(t){return t[e]=i,n.filterRemoteStorageService.storeFilters(n.scope.projectId,t,"tasks-custom-filters").then(n.generateFilters)}))},n.prototype.generateFilters=function(){var c,t,u,e,l,r,p,n=this.getQueryParams();for(this.storeFilters(this.params.pslug,n,"tasks-filters"),(l={}).project=this.scope.projectId,l.milestone=this.scope.sprintId,t=0,e=(r=this.filterCategories).length;t<e;t++)u=r[t],c=this.excludePrefix.concat(u),l[u]=n[u],l[c]=n[c];return this.q.all([this.rs.tasks.filtersData(l),this.filterRemoteStorageService.getFilters(this.scope.projectId,"tasks-custom-filters")]).then((p=this,function(t){var e,r,n,i,o=t[0],s=t[1],a={};for(a.status=_.map(o.statuses,function(t){return t.id=t.id.toString(),t}),a.tags=_.map(o.tags,function(t){return t.id=t.name,t}),t=_.filter(a.tags,function(t){return 0<t.count}),a.assigned_to=_.map(o.assigned_to,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),a.role=_.map(o.roles,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.name||"Unassigned",t}),a.owner=_.map(o.owners,function(t){return t.id=t.id.toString(),t.name=t.full_name,t}),p.selectedFilters=[],e=0,r=(n=p.filterCategories).length;e<r;e++)u=n[e],c=p.excludePrefix.concat(u),l[u]&&(i=p.formatSelectedFilters(u,a[u],l[u]),p.selectedFilters=p.selectedFilters.concat(i)),l[c]&&(i=p.formatSelectedFilters(u,a[u],l[c],"exclude"),p.selectedFilters=p.selectedFilters.concat(i));return p.filters=[{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.STATUS"),dataType:"status",content:a.status},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.TAGS"),dataType:"tags",content:a.tags,hideEmpty:!0,totalTaggedElements:t.length},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.ASSIGNED_TO"),dataType:"assigned_to",content:a.assigned_to},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.ROLE"),dataType:"role",content:a.role},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.CREATED_BY"),dataType:"owner",content:a.owner}],p.customFilters=[],_.forOwn(s,function(t,e){return p.customFilters.push({id:e,name:e,filter:t})})}))},n.prototype._setMeta=function(){var t=this.translate.instant("BACKLOG.SPRINTS.DATE"),e=this.translate.instant("TASKBOARD.PAGE_TITLE",{projectName:this.scope.project.name,sprintName:this.scope.sprint.name}),t=this.translate.instant("TASKBOARD.PAGE_DESCRIPTION",{projectName:this.scope.project.name,sprintName:this.scope.sprint.name,startDate:moment(this.scope.sprint.estimated_start).format(t),endDate:moment(this.scope.sprint.estimated_finish).format(t),completedPercentage:this.scope.stats.completedPercentage||"0",completedPoints:this.scope.stats.completedPointsSum||"--",totalPoints:this.scope.stats.totalPointsSum||"--",openTasks:this.scope.stats.openTasks||"--",totalTasks:this.scope.stats.total_tasks||"--"});return this.appMetaService.setAll(e,t)},n.prototype.initializeEventHandlers=function(){var r,n,i,o,s,a,c,u,l;return this.scope.$on("taskform:bulk:success",(r=this,function(t,e){return r.refreshTagsColors().then(function(){return r.taskboardTasksService.add(e)}),r.analytics.trackEvent("task","create","bulk create task on taskboard",1)})),this.scope.$on("taskform:new:success",(n=this,function(t,e){return n.refreshTagsColors().then(function(){return n.taskboardTasksService.add(e)}),n.analytics.trackEvent("task","create","create task on taskboard",1)})),this.scope.$on("taskform:edit:success",(i=this,function(t,e){return i.refreshTagsColors().then(function(){return i.taskboardTasksService.replaceModel(e)})})),this.scope.$on("issueform:new:success",(o=this,function(t,e){return o.refreshTagsColors().then(function(){return o.taskboardIssuesService.add(e)}),o.analytics.trackEvent("issue","create","create issue on taskboard",1)})),this.scope.$on("issueform:add:success",(s=this,function(t,e){return s.refreshTagsColors().then(function(){return s.taskboardIssuesService.add(e)})})),this.scope.$on("issueform:edit:success",(a=this,function(t,e){return a.refreshTagsColors().then(function(){return a.taskboardIssuesService.replaceModel(e)})})),this.scope.$on("taskboard:task:deleted",(c=this,function(t,e){return c.loadTasks()})),this.scope.$on("taskboard:issue:deleted",(u=this,function(t,e){return u.loadIssues()})),this.scope.$on("taskboard:task:move",this.taskMove),this.scope.$on("assigned-to:added",this.onAssignedToChanged),this.scope.$on("taskboard:items:move",(l=this,function(t,e){return e.uss?l.firstLoad():(e.tasks&&l.loadTasks(),e.issues?l.loadIssues():void 0)}))},n.prototype.onAssignedToChanged=function(t,e,r){var n,i;if("tasks"===r.getName()&&(r.assigned_to=e,this.taskboardTasksService.replaceModel(r),this.repo.save(r).then((n=this,function(){if(n.generateFilters(),n.isFilterDataTypeSelected("assigned_to")||n.isFilterDataTypeSelected("role"))return n.loadTasks()}))),"issues"===r.getName())return r.assigned_to=e,this.taskboardIssuesService.replaceModel(r),this.repo.save(r).then((i=this,function(){if(i.generateFilters(),i.isFilterDataTypeSelected("assigned_to")||i.isFilterDataTypeSelected("role"))return i.loadIssues()}))},n.prototype.initializeSubscription=function(){var e,r,n,t="changes.project."+this.scope.projectId+".tasks";return this.events.subscribe(this.scope,t,i(500,(e=this,function(t){return e.loadTaskboard()}))),t="changes.project."+this.scope.projectId+".issues",this.events.subscribe(this.scope,t,i(500,(r=this,function(t){return r.loadIssues()}))),t="changes.project."+this.scope.projectId+".userstories",this.events.subscribe(this.scope,t,(n=this,function(t){return n.refreshTagsColors(),n.loadSprintStats(),n.loadSprint()}))},n.prototype.loadProject=function(){return this.rs.projects.get(this.scope.projectId).then((e=this,function(t){return t.is_backlog_activated||e.errorHandlingService.permissionDenied(),e.scope.project=t,e.scope.pointsList=_.sortBy(t.points,"order"),e.scope.pointsById=r(t.points,function(t){return t.id}),e.scope.roleById=r(t.roles,function(t){return t.id}),e.scope.taskStatusList=_.sortBy(t.task_statuses,"order"),e.scope.usStatusList=_.sortBy(t.us_statuses,"order"),e.scope.usStatusById=r(t.us_statuses,function(t){return t.id}),e.scope.issueStatusById=r(t.issue_statuses,function(t){return t.id}),e.scope.$emit("project:loaded",t),e.fillUsersAndRoles(t.members,t.roles),t}));var e},n.prototype.loadSprintStats=function(){return this.rs.sprints.stats(this.scope.projectId,this.scope.sprintId).then((o=this,function(t){var e=_.reduce(_.values(t.total_points),function(t,e){return t+e},0),r=_.reduce(_.values(t.completed_points),function(t,e){return t+e},0),n=e-r,i=t.total_tasks-t.completed_tasks;return o.scope.stats=t,o.scope.stats.totalPointsSum=e,o.scope.stats.completedPointsSum=r,o.scope.stats.remainingPointsSum=n,o.scope.stats.remainingTasks=i,t.totalPointsSum?o.scope.stats.completedPercentage=Math.round(100*t.completedPointsSum/t.totalPointsSum):o.scope.stats.completedPercentage=0,o.scope.stats.openTasks=t.total_tasks-t.completed_tasks,t}));var o},n.prototype.refreshTagsColors=function(){return this.rs.projects.tagsColors(this.scope.projectId).then((e=this,function(t){return e.scope.project.tags_colors=t._attrs}));var e},n.prototype.loadSprint=function(){return this.rs.sprints.get(this.scope.projectId,this.scope.sprintId).then((e=this,function(t){return e.scope.sprint=t,e.scope.userstories=_.sortBy(t.user_stories,"sprint_order"),e.taskboardTasksService.setUserstories(e.scope.userstories),e.rootscope.$broadcast("taskboard:userstories:loaded",e.scope.userstories),t}));var e},n.prototype.loadIssues=function(){var t,e,r={};return 1<this.zoomLevel&&(r.include_attachments=1),t=this.getQueryParams(),r=_.merge(r,t),this.rs.issues.listInProject(this.scope.projectId,this.scope.sprintId,r).then((e=this,function(t){return e.taskboardIssuesService.init(e.scope.project,e.scope.usersById,e.scope.issueStatusById),e.taskboardIssuesService.set(t),e.initIssues=!0}))},n.prototype.loadTasks=function(){var e,r,t={};return 1<this.zoomLevel&&(t.include_attachments=1),e=this.getQueryParams(),(t=_.merge(t,e)).q=this.filterQ,this.rs.tasks.list(this.scope.projectId,this.scope.sprintId,null,t).then((r=this,function(t){return r.notFoundTasks=!1,!t.length&&(r.filterQ&&r.filterQ.length||Object.keys(e).length)&&(r.notFoundTasks=!0),r.taskboardTasksService.init(r.scope.project,r.scope.usersById),r.taskboardTasksService.set(t)}))},n.prototype.loadTaskboard=function(){return this.q.all([this.refreshTagsColors(),this.loadSprintStats(),this.loadSprint().then((t=this,function(){return t.loadTasks(),t.loadIssues()}))]);var t},n.prototype.loadInitialData=function(){var t,e,r,n;return this.initialLoad=!1,this.initIssues=!1,t={pslug:this.params.pslug,sslug:this.params.sslug},this.repo.resolve(t).then((e=this,function(t){return e.scope.projectId=t.project,e.scope.sprintId=t.milestone,e.initializeSubscription(),t})).then((n=this,function(){return n.loadProject()})).then((r=this,function(){return r.generateFilters(),!1===r.rs.issues.getSprintShowTags(r.scope.projectId)&&(r.scope.showTags=!1),r.loadTaskboard().then(function(){return r.timeout(function(){return r.initialLoad=!0},0,!1),r.setRolePoints()})}))},n.prototype.toggleTags=function(t){return this.rs.issues.storeSprintShowTags(this.scope.projectId,t)},n.prototype.showPlaceHolder=function(t,e){return!(this.taskboardTasksService.tasksRaw.length||this.scope.taskStatusList[0].id!==t||this.scope.userstories.length&&this.scope.userstories[0].id!==e)},n.prototype.editTask=function(t){var r,n=this.taskboardTasksService.getTask(t);return n=n.set("loading-edit",!0),this.taskboardTasksService.replace(n),this.rs.tasks.getByRef(n.getIn(["model","project"]),n.getIn(["model","ref"])).then((r=this,function(e){return r.rs2.attachments.list("task",n.get("id"),n.getIn(["model","project"])).then(function(t){return r.rootscope.$broadcast("genericform:edit",{objType:"task",obj:e,project:r.scope.project,sprintId:r.scope.sprintId,attachments:t.toJS()}),n=n.set("loading-edit",!1),r.taskboardTasksService.replace(n)})}))},n.prototype.editIssue=function(t){var r,n=this.taskboardIssuesService.getIssue(t);return n=n.set("loading-edit",!0),this.rs.issues.getByRef(n.getIn(["model","project"]),n.getIn(["model","ref"])).then((r=this,function(e){return r.rs2.attachments.list("issue",n.get("id"),n.getIn(["model","project"])).then(function(t){return r.rootscope.$broadcast("genericform:edit",{objType:"issue",obj:e,project:r.scope.project,sprintId:r.scope.sprintId,attachments:t.toJS()}),n=n.set("loading-edit",!1)})}))},n.prototype.deleteTask=function(t){var n,i=this.taskboardTasksService.getTask(t);return i=i.set("loading-delete",!0),this.rs.tasks.getByRef(i.getIn(["model","project"]),i.getIn(["model","ref"])).then((n=this,function(r){var t,e;return i=i.set("loading-delete",!1),e=n.translate.instant("TASK.TITLE_DELETE_ACTION"),t=r.subject,n.confirm.askOnDelete(e,t).then(function(t){var e=n.repo.remove(r);return e.then(function(){return n.scope.$broadcast("taskboard:task:deleted"),t.finish()}),e.then(null,function(){return t.finish(!1),this.confirm.notify("error")})})}))},n.prototype.deleteIssue=function(t){var n,i=this.taskboardIssuesService.getIssue(t);return i=i.set("loading-delete",!0),this.rs.issues.getByRef(i.getIn(["model","project"]),i.getIn(["model","ref"])).then((n=this,function(r){var t,e;return i=i.set("loading-delete",!1),e=n.translate.instant("ISSUES.ACTION_DELETE"),t=r.subject,n.confirm.askOnDelete(e,t).then(function(t){var e=n.repo.remove(r);return e.then(function(){return n.scope.$broadcast("taskboard:issue:deleted"),t.finish()}),e.then(null,function(){return t.finish(!1),this.confirm.notify("error")})})}))},n.prototype.removeIssueFromSprint=function(t){var n,i=this.taskboardIssuesService.getIssue(t);return i=i.set("loading-delete",!0),this.rs.issues.getByRef(i.getIn(["model","project"]),i.getIn(["model","ref"])).then((n=this,function(r){var t,e;return i=i.set("loading-delete",!1),e=n.translate.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.TITLE"),n.translate.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.MESSAGE"),t=n.translate.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.MESSAGE",{sprintName:n.scope.sprint.name}),n.confirm.ask(e,null,t).then(function(t){var e;return r.milestone=null,(e=n.repo.save(r)).then(function(){return n.taskboardIssuesService.remove(r),t.finish()}),e.then(null,function(){return t.finish(!1),this.confirm.notify("error")})})}))},n.prototype.taskMove=function(t,e,r,n,i,o){var s;return this.scope.movingTask=!0,e=this.taskboardTasksService.getTaskModel(e.get("id")),n=this.taskboardTasksService.move(e.id,n,i,o),i={status__is_archived:!1,include_attachments:!0},n={headers:{"set-orders":JSON.stringify(n.set_orders)}},this.repo.save(e,!0,i,n,!0).then((s=this,function(t){if(t[0]&&t[0].user_story&&s.reloadUserStory(t[0].user_story),s.scope.movingTask=!1,(t=t[1])&&t["taiga-info-order-updated"]&&(o=JSON.parse(t["taiga-info-order-updated"]),s.taskboardTasksService.assignOrders(o)),s.loadSprintStats(),s.generateFilters(),s.isFilterDataTypeSelected("status"))return s.loadTasks()}))},n.prototype.reloadUserStory=function(t){return this.rs.userstories.get(this.scope.project.id,t).then((r=this,function(e){return r.scope.userstories=_.map(r.scope.userstories,function(t){return t.id===e.id?e:t})}));var r},n.prototype.addNewTask=function(t,e){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new",{objType:"task",project:this.scope.project,sprintId:this.scope.sprintId,usId:null!=e?e.id:void 0});case"bulk":return this.rootscope.$broadcast("taskform:bulk",this.scope.sprintId,null!=e?e.id:void 0)}},n.prototype.addNewIssue=function(t,e){switch(t){case"standard":return this.rootscope.$broadcast("genericform:new-or-existing",{objType:"issue",project:this.scope.project,sprintId:this.scope.sprintId,relatedField:"milestone",relatedObjectId:this.scope.sprintId,targetName:this.scope.sprint.name});case"standard":return this.rootscope.$broadcast("taskform:new",this.scope.sprintId,null!=e?e.id:void 0);case"bulk":return this.rootscope.$broadcast("issueform:bulk",this.scope.projectId,this.scope.sprintId)}},n.prototype.toggleFold=function(t,e){return"issues"===e?this.taskboardIssuesService.toggleFold(t):"tasks"===e?this.taskboardTasksService.toggleFold(t):void 0},n.prototype.openUsersSelection=function(e){var r,t=function(t){t=t.pop()||null;if("tasks"===e.getName()&&(e.assigned_to=t,r.taskboardTasksService.replaceModel(e),r.repo.save(e).then(function(){if(r.generateFilters(),r.isFilterDataTypeSelected("assigned_to")||r.isFilterDataTypeSelected("role"))return r.loadTasks()})),"issues"===e.getName())return e.assigned_to=t,r.taskboardIssuesService.replaceModel(e),r.repo.save(e).then(function(){if(r.generateFilters(),r.isFilterDataTypeSelected("assigned_to")||r.isFilterDataTypeSelected("role"))return r.loadIssues()})};return(r=this).lightboxFactory.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:[e.assigned_to],activeUsers:this.scope.activeUsers,onClose:t,single:!0,lbTitle:this.translate.instant("COMMON.ASSIGNED_USERS.ADD")})},n.prototype.changeTaskAssignedTo=function(t){t=this.taskboardTasksService.getTaskModel(t);return this.openUsersSelection(t)},n.prototype.changeIssueAssignedTo=function(t){t=this.taskboardIssuesService.getIssueModel(t);return this.openUsersSelection(t)},n.prototype.setRolePoints=function(){var n,e,t,r=_.filter(this.scope.project.roles,"computable"),i=function(e){return e=parseInt(e,10),_.find(r,function(t){return t.id===e})};return t=this,n=function(e){parseInt(e,10);return _.find(t.scope.project.points,function(t){return t.id===e})},e=_.reduce(this.scope.userstories,function(r,t,e){return _.forOwn(t.points,function(t,e){e=i(e),t=n(t)||{value:0};if(e)return r[e.id]||(r[e.id]=e,r[e.id].points=0),r[e.id].points+=t.value}),r},{}),this.scope.pointsByRole=Object.keys(e).map(function(t){return e[t]})},n.prototype.getIssuesOrderBy=function(){return _.isString(this.location.search().order_by)?this.location.search().order_by:"created_date"},e.controller("TaskboardController",n),t=function(n){return{link:function(t,e,r){e.controller();return e.on("click",".toggle-analytics-visibility",function(t){return t.preventDefault(),angular.element(t.currentTarget).toggleClass("active"),n.$broadcast("taskboard:graph:toggle-visibility")}),e.find('[data-js="taskboard-table-hscroll"]').on("scroll",function(t){t=angular.element(t.currentTarget);return e.find(".taskboard-table-inner").css("left",-1*t.scrollLeft())}),t.$on("$destroy",function(){return e.off()})}}},e.directive("tgTaskboard",["$rootScope",t]),t=function(a){var c=!1;return{link:function(o,r,t){var n,i,e,s;return o.$watch("ctrl.zoom",function(){if(c)return e()}),o.$on("sprint:task:moved",function(){return e()}),o.$watch("usTasks",function(){if(o.project)return o.statusesFolded=a.tasks.getStatusColumnModes(o.project.id),o.usFolded=a.tasks.getUsRowModes(o.project.id,o.sprintId),e()}),o.foldStatus=function(t){return o.statusesFolded[t.id]=!o.statusesFolded[t.id],a.tasks.storeStatusColumnModes(o.projectId,o.statusesFolded),e()},o.foldUs=function(t){return o.usFolded[t]=!o.usFolded[t],a.tasks.storeUsRowModes(o.projectId,o.sprintId,o.usFolded),e()},n=function(t,e){var r,n=!!o.statusesFolded[e],i=!!o.usFolded[t],e=(t?o.usTasks.getIn([t.toString(),e.toString()]):o.usTasks.getIn(["null",e.toString()])).size;return e&&(i||n)?i?r=30*(r=Math.ceil(e/3))+5*(r-1)+32:n&&(r=30):r=0,r},s=function(t,e){return e<62&&(e=62),r.find(".squish-status-"+t).css("max-width",e),e},i=function(e){var r,t=0;return!!o.statusesFolded[e]?t=30:(t=292,0===Number(o.ctrl.zoomLevel)&&(t=182)),o.statusesFolded[e],(r=n(null,e))<t&&(r=t),_.forEach(o.userstories,function(t){o.usFolded[t.id];t=n(t.id,e);if(r<t)return r=t}),s(e,r)},e=function(){var t=_.reduce(o.taskStatusList,function(t,e){return t+i(e.id)+5},0);r.find(".taskboard-table-inner").css("width",292+t),c||requestAnimationFrame(function(){return r.addClass("animations")}),c=!0}}}},e.directive("tgTaskboardSquishColumn",["$tgResources",t])}.call(this),function(){this.taiga,this.taiga.mixOf,this.taiga.toggleText,this.taiga.scopeDefer,this.taiga.bindOnce,this.taiga.groupBy;var t=function(t,e,h,o){return{link:function(d,n,t){var i;return i=d.$watch("usTasks",function(t){var a,e,r,c,u,l,p;if(t&&t.size&&(i(),-1<d.project.my_permissions.indexOf("modify_task")))return u=p=null,r=function(){var t=o.instant("BACKLOG.SORTABLE_FILTER_ERROR");return $tgConfirm.notify("error",t)},a=function(t){return t.off(),t.remove()},t=_.map(n.find(".taskboard-column"),function(t){return t}),e=dragula(t,{copySortSource:!1,copy:!1,accepts:function(t,e){return!$(e).hasClass("taskboard-row-title-box")},moves:function(t){return $(t).is("tg-card")}}),c=null,e.on("shadow",function(t){return $(t).removeClass("folded-dragging")}),e.on("over",function(t,e){return c?e!==c?$(e).addClass("target-drop"):void 0:c=e}),e.on("out",function(t,e){if(e!==c)return $(e).removeClass("target-drop")}),e.on("drag",function(t){if(p=$(t).parent().scope(),30===$(t).width()&&$(t).addClass("folded-dragging"),n.hasClass("active-filters"))return r(),setTimeout(function(){return e.cancel(!0)},0),!1}),e.on("dragend",function(t){var e,r,n,i,o,s=$(t).parent();return u=$(t),r=d.taskMap.get(Number(t.dataset.id)),e=u.index(),l=s.scope(),o=p.us?p.us.id:null,t=p.st.id,i=l.us?l.us.id:null,n=l.st.id,c!==s&&($(s).addClass("new"),$(s).one("animationend",function(){return $(s).removeClass("new")})),n===t&&i===o||a(u),d.$apply(function(){var t=$(".taskboard-table-body");return t.addClass("moving"),setTimeout(function(){return t.removeClass("moving")},1e3),h.$broadcast("taskboard:task:move",r,r.getIn(["model","status"]),i,n,e)})}),autoScroll([$(".taskboard-table-body")[0]],{margin:100,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&e.dragging}}),d.$on("$destroy",function(){return n.off(),e.destroy()})})}}};angular.module("taigaBacklog").directive("tgTaskboardSortable",["$tgRepo","$tgResources","$rootScope","$translate",t])}.call(this),function(){var t,i={}.hasOwnProperty;function e(){this.reset()}this.taiga.groupBy,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=[],e.prototype.reset=function(){return this.foldStatusChanged={},this.issuesRaw=[]},e.prototype.init=function(t,e,r){return this.issueStatusById=r,this.project=t,this.usersById=e},e.prototype.resetFolds=function(){return this.foldStatusChanged={},this.refresh()},e.prototype.toggleFold=function(t){return this.foldStatusChanged[t]=!this.foldStatusChanged[t],this.refresh()},e.prototype.add=function(t){return this.issuesRaw=this.issuesRaw.concat(t),this.refresh()},e.prototype.remove=function(t){var e,r,n=this.issuesRaw;for(r in n)if(e=n[r],t.id===e.id)return this.issuesRaw.splice(r,1),void this.refresh()},e.prototype.set=function(t){return this.issuesRaw=t,this.refresh()},e.prototype.getIssue=function(e){return this.milestoneIssues.find(function(t){return t.get("id")===e})},e.prototype.getIssueModel=function(e){return _.find(this.issuesRaw,function(t){return t.id===e})},e.prototype.replaceModel=function(e){return this.issuesRaw=_.map(this.issuesRaw,function(t){return e.id===t.id?e:t}),this.refresh()},e.prototype.refresh=function(){for(var t,e,r=[],n=this.issuesRaw,i=0,o=n.length;i<o;i++)e=n[i],(t={}).foldStatusChanged=this.foldStatusChanged[e.id],t.model=e.getAttrs(),t.modelName=e.getName(),t.id=e.id,t.status=this.issueStatusById[e.status],t.images=_.filter(t.model.attachments,function(t){return!!t.thumbnail_card_url}),t.assigned_to=this.usersById[e.assigned_to],t.colorized_tags=_.map(t.model.tags,function(t){return{name:t[0],color:t[1]}}),r.push(t);return this.milestoneIssues=Immutable.fromJS(r)},t=e,angular.module("taigaKanban").service("tgTaskboardIssues",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){this.reset()}this.taiga.groupBy,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=[],e.prototype.reset=function(){return this.tasksRaw=[],this.foldStatusChanged={},this.usTasks=Immutable.Map(),this.tasksByUs=Immutable.Map(),this.taskMap=Immutable.Map()},e.prototype.init=function(t,e){return this.project=t,this.usersById=e},e.prototype.resetFolds=function(){return this.foldStatusChanged={},this.refresh()},e.prototype.toggleFold=function(t){return this.foldStatusChanged[t]=!this.foldStatusChanged[t],this.refresh()},e.prototype.add=function(t){return this.tasksRaw=this.tasksRaw.concat(t),this.refresh()},e.prototype.set=function(t){return this.tasksRaw=t,this.refreshRawOrder(),this.refresh()},e.prototype.setUserstories=function(t){return this.userstories=t},e.prototype.refreshRawOrder=function(){var t,e,r,n,i;for(this.order={},n=[],t=0,e=(r=this.tasksRaw).length;t<e;t++)i=r[t],n.push(this.order[i.id]=i.taskboard_order);return n},e.prototype.assignOrders=function(t){return t=_.invert(t),this.order=_.assign(this.order,t),this.refresh()},e.prototype.getTask=function(t){return this.taskMap.get(t)},e.prototype.replace=function(t){return this.taskMap=this.taskMap.set(t.get("id"),t)},e.prototype.getTaskModel=function(e){return _.find(this.tasksRaw,function(t){return t.id===e})},e.prototype.replaceModel=function(e){return this.tasksRaw=_.map(this.tasksRaw,function(t){return e.id===t.id?e:t}),this.refresh()},e.prototype.move=function(e,r,n,t){var i,o,s,a,c,u,l,p,d,h,f,m,g,v=this.getTaskModel(e),y=_.filter(this.tasksRaw,function(t){return t.status===n&&t.user_story===r});if(y=_.sortBy(y,(m=this,function(t){return m.order[t.id]})),f=_.filter(y,function(t){return t.id!==e}),y=_.slice(f,0,t),i=_.slice(f,t),h={},p=y[y.length-1],1<(d=_.filter(y,(g=this,function(t){return g.order[t.id]===g.order[p.id]}))).length)for(o=0,u=d.length;o<u;o++)h[(s=d[o]).id]=this.order[s.id];for(p?p&&(this.order[v.id]=this.order[p.id]+1):this.order[v.id]=0,c=a=0,l=i.length;a<l;c=++a)s=i[c],this.order[s.id]=this.order[v.id]+c+1;return v.status=n,v.user_story=r,v.taskboard_order=this.order[v.id],this.refresh(),{task_id:v.id,order:this.order[v.id],set_orders:h}},e.prototype.refresh=function(){var t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m;if(this.project){for(this.tasksRaw=_.sortBy(this.tasksRaw,(m=this,function(t){return m.order[t.id]})),d=this.tasksRaw,p=_.sortBy(this.project.task_statuses,"order"),f={},t=0,n=(a=_.union(this.userstories,[{id:null}])).length;t<n;t++)for(f[(h=a[t]).id]={},e=0,i=p.length;e<i;e++)c=p[e],f[h.id][c.id]=[];for(r=0,o=d.length;r<o;r++)null!=f[(l=d[r]).user_story]&&null!=f[l.user_story][l.status]&&(u={},this.tasksByUs.get(l.user_story)?this.tasksByUs=this.tasksByUs.set(l.user_story,this.tasksByUs.get(l.user_story).push(l.id)):this.tasksByUs=this.tasksByUs.set(l.user_story,Immutable.fromJS([l.id])),s=l.getAttrs(),u.foldStatusChanged=this.foldStatusChanged[l.id],u.model=s,u.images=_.filter(s.attachments,function(t){return!!t.thumbnail_card_url}),u.id=l.id,u.assigned_to=this.usersById[l.assigned_to],u.colorized_tags=_.map(u.model.tags,function(t){return{name:t[0],color:t[1]}}),this.taskMap=this.taskMap.set(u.id,Immutable.fromJS(u)),f[l.user_story][l.status].push(u.id));return this.usTasks=Immutable.fromJS(f)}},t=e,angular.module("taigaKanban").service("tgTaskboardTasks",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t){this.translate=t,this.reset()}this.taiga.groupBy,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=["$translate"],e.prototype.reset=function(t,e,r){if(null==t&&(t=!0),null==e&&(e=!0),null==r&&(r=!0),this.userstoriesRaw=[],this.swimlanes=[],this.foldStatusChanged={},this.usByStatus=Immutable.Map(),this.usMap=Immutable.Map(),this.usByStatusSwimlanes=Immutable.Map(),r&&(this.statusHide=[]),e&&(this.archivedStatus=[]),t)return this.swimlanesList=Immutable.List()},e.prototype.init=function(t,e,r){return this.project=t,this.swimlanes=e,this.usersById=r},e.prototype.resetFolds=function(){return this.foldStatusChanged={}},e.prototype.toggleFold=function(t){return this.foldStatusChanged[t]=!this.foldStatusChanged[t],this.refreshUserStory(t)},e.prototype.set=function(t){return this.userstoriesRaw=t,this.refreshRawOrder(),this.refresh()},e.prototype.initUsByStatusList=function(t){var e,r,n=[];for(e in t)r=t[e],r=String(r.status),this.usByStatus.has(r)?n.push(void 0):n.push(this.usByStatus=this.usByStatus.set(r,Immutable.List()));return n},e.prototype.remove=function(e){var t;return this.userstoriesRaw=this.userstoriesRaw.filter(function(t){return t.id!==e.id}),delete this.order[e.id],t=String(e.status),this.usMap=this.usMap.delete(e.id),this.usByStatus=this.usByStatus.set(t,this.usByStatus.get(t).filter(function(t){return t!==e.id})),this.refreshSwimlanes()},e.prototype.add=function(t){var e,r,n,i,o;for(e in Array.isArray(t)||(t=[t]),t=_.sortBy(t,["kanban_order"]),this.userstoriesRaw=this.userstoriesRaw.filter(function(e){return!t.find(function(t){return t.id===e.id})}),this.userstoriesRaw=this.userstoriesRaw.concat(t),this.userstoriesRaw=this.userstoriesRaw.map(function(t){return t}),this.refreshRawOrder(),this.userstoriesRaw=_.sortBy(this.userstoriesRaw,[(o=this,function(t){return o.order[t.id]})]),t)i=t[e],n=this.retrieveUserStoryData(i),r=String(i.status),this.usByStatus.has(r)||(this.usByStatus=this.usByStatus.set(r,Immutable.List())),this.usMap.get(i.id)||(this.usMap=this.usMap.set(i.id,Immutable.fromJS(n)),this.usByStatus=this.usByStatus.set(r,this.usByStatus.get(r).filter(function(t){return t!==i.id}).push(i.id)));return this.refreshSwimlanes()},e.prototype.addArchivedStatus=function(t){return this.archivedStatus.push(t)},e.prototype.isUsInArchivedHiddenStatus=function(t){var t=this.usMap.get(t),t=null!=t?t.getIn(["model","status"]):void 0;return-1!==this.archivedStatus.indexOf(t)&&-1!==this.statusHide.indexOf(t)},e.prototype.hideStatus=function(t){return this.deleteStatus(t),this.statusHide.push(t)},e.prototype.showStatus=function(e){return _.remove(this.statusHide,function(t){return t===e})},e.prototype.getStatus=function(e,r){return _.filter(this.userstoriesRaw,function(t){return t.status===e&&(!r||t.swimlane===r)})},e.prototype.deleteStatus=function(e){var t=_.filter(this.userstoriesRaw,function(t){return t.status===e});return t=_.map(function(t){return t.id}),this.archived=_.difference(this.archived,t)},e.prototype.refreshRawOrder=function(){var t,e,r,n,i;if(this.order={},this.userstoriesRaw){for(i=[],t=0,r=(n=this.userstoriesRaw).length;t<r;t++)e=n[t],i.push(this.order[e.id]=e.kanban_order);return i}},e.prototype.assignOrders=function(t){return this.order=_.assign(this.order,t),this.refresh(!1)},e.prototype.move=function(t,e,r,n,i,o){var s,a,c,u,l,p,d,h,f,m,g,v,y=this.getStatus(e,r);for(y=_.sortBy(y,[(v=this,function(t){return v.order[t.id]})]),h=i?(f=this.order[i]+1,y.findIndex(function(t){return t.id===i})+1):f=0,y=_.filter(y,function(e){return!_.find(t,function(t){return e.id===t})}),s=_.slice(y,h),c=t.length+1,l=a=0,p=s.length;a<p;l=++a)g=s[l],this.order[g.id]=f+c+l;for(l=u=0,d=t.length;u<d;l=++u)m=t[l],(g=this.getUsModel(m)).status=e,g.swimlane=r,this.order[g.id]=f+l,m=this.retrieveUserStoryData(g),this.usMap=this.usMap.set(m.id,Immutable.fromJS(m));return this.refresh(!1),{statusId:e,swimlaneId:r,afterUserstoryId:i,beforeUserstoryId:o,bulkUserstories:t}},e.prototype.moveToEnd=function(t,e){t=this.getUsModel(t);return this.order[t.id]=-1,t.status=e,t.kanban_order=this.order[t.id],this.refresh(!1),{us_id:t.id,order:-1}},e.prototype.replace=function(t){return this.usMap=this.usMap.set(t.get("id"),t)},e.prototype.replaceModel=function(e){var t;return this.userstoriesRaw=_.map(this.userstoriesRaw,function(t){return e.id===t.id?e:t}),t=this.retrieveUserStoryData(e),this.usMap=this.usMap.set(e.id,Immutable.fromJS(t))},e.prototype.getUs=function(t){return this.usMap.get(t)},e.prototype.getUsModel=function(e){return _.find(this.userstoriesRaw,function(t){return t.id===e})},e.prototype.refreshUserStory=function(t){var e=this.getUsModel(t),e=this.retrieveUserStoryData(e);return this.usMap=this.usMap.set(t,Immutable.fromJS(e))},e.prototype.retrieveUserStoryData=function(t){var e,r={},n=t.getAttrs();return r.foldStatusChanged=this.foldStatusChanged[t.id],r.model=n,r.images=_.filter(n.attachments,function(t){return!!t.thumbnail_card_url}),r.id=t.id,r.swimlane=t.swimlane,r.assigned_to=this.usersById[t.assigned_to],r.assigned_users=[],t.assigned_users.forEach((e=this,function(t){t=e.usersById[t];if(t)return r.assigned_users.push(t)})),r.assigned_users_preview=r.assigned_users.slice(0,3),r.colorized_tags=_.map(r.model.tags,function(t){return{name:t[0],color:t[1]}}),r},e.prototype.refresh=function(t,e){var r,n,i,o,s,a;for(n in null==t&&(t=!0),null==e&&(e=!0),this.userstoriesRaw=_.sortBy(this.userstoriesRaw,[(a=this,function(t){return a.order[t.id]})]),r={},i=this.userstoriesRaw)s=i[n],o=this.retrieveUserStoryData(s),r[s.status]||(r[s.status]=[]),r[s.status]=r[s.status].filter(function(t){return t!==s.id}),r[s.status].push(s.id),t&&(this.usMap=this.usMap.set(s.id,Immutable.fromJS(o)));if(this.usByStatus=Immutable.fromJS(r),e)return this.refreshSwimlanes()},e.prototype.refreshSwimlanes=function(){var t,e,r,n,i;if(this.swimlanes&&this.swimlanes.length)return this.swimlanesList=Immutable.List(),this.usByStatusSwimlanes=Immutable.Map(),e=this.userstoriesRaw.filter(function(t){return null===t.swimlane}),t=this.swimlanesList.filter(function(t){return null===t.id}),e.length&&!t.size?(this.swimlanes.forEach((n=this,function(t){if(!n.swimlanesList.includes(t))return n.swimlanesList=n.swimlanesList.push(t)})),t={id:-1,kanban_order:1,name:this.translate.instant("KANBAN.UNCLASSIFIED_USER_STORIES")},this.swimlanesList=this.swimlanesList.insert(0,t)):this.swimlanes.forEach((r=this,function(t){if(!r.swimlanesList.includes(t))return r.swimlanesList=r.swimlanesList.push(t)})),this.swimlanesList.forEach((i=this,function(r){var n=Immutable.Map();return i.usByStatus.forEach(function(t,e){t=t.filter(function(t){var e=i.usMap.get(t),t=-1===r.id?null:r.id;return e.getIn(["model","swimlane"])===t});return n=n.set(Number(e),t)}),i.usByStatusSwimlanes=i.usByStatusSwimlanes.set(r.id,n)}))},t=e,angular.module("taigaKanban").service("tgKanbanUserstories",t)}.call(this),function(){function T(t,e){return function(){return t.apply(e,arguments)}}var u,C,i,e,t,r,n,w,o,s={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};function c(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m,g,v,y,_,S,b,j){var k,I,$,E;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.rs2=o,this.params=s,this.q=a,this.location=c,this.appMetaService=u,this.navUrls=l,this.events=p,this.analytics=d,this.translate=h,this.errorHandlingService=f,this.model=m,this.kanbanUserstoriesService=g,this.storage=v,this.filterRemoteStorageService=y,this.projectService=_,this.lightboxFactory=S,this.tgLoader=b,this.timeout=j,this.renderUserStories=T(this.renderUserStories,this),this.changeUsAssignedUsers=T(this.changeUsAssignedUsers,this),C(this),this.kanbanUserstoriesService.reset(),this.openFilter=!1,this.selectedUss={},this.movedUs=[],this.foldedSwimlane=Immutable.Map(),this.isFirstLoad=!0,this.renderBatching=!0,this.isLightboxOpened=!1,this.isRefreshNeeded=!1,this.applyStoredFilters(this.params.pslug,"kanban-filters",this.validQueryParams)||(this.scope.sectionName=this.translate.instant("KANBAN.SECTION_NAME"),this.initializeEventHandlers(),w.defineImmutableProperty(this.scope,"usByStatus",(k=this,function(){return k.kanbanUserstoriesService.usByStatus})),w.defineImmutableProperty(this.scope,"usMap",(I=this,function(){return I.kanbanUserstoriesService.usMap})),w.defineImmutableProperty(this.scope,"usByStatusSwimlanes",($=this,function(){return $.kanbanUserstoriesService.usByStatusSwimlanes})),w.defineImmutableProperty(this.scope,"swimlanesList",(E=this,function(){return E.kanbanUserstoriesService.swimlanesList})))}w=this.taiga,t=this.taiga.mixOf,this.taiga.toggleText,n=this.taiga.scopeDefer,this.taiga.bindOnce,e=this.taiga.groupBy,this.taiga.timeout,C=this.taiga.bindMethods,i=this.taiga.debounceLeading,r=angular.module("taigaKanban"),function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(c,t(w.Controller,w.PageMixin,w.FiltersMixin,w.UsFiltersMixin)),c.prototype.excludeFilters=["status"],c.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","tgErrorHandlingService","$tgModel","tgKanbanUserstories","$tgStorage","tgFilterRemoteStorageService","tgProjectService","tgLightboxFactory","tgLoader","$timeout"],c.prototype.storeCustomFiltersName="kanban-custom-filters",c.prototype.storeFiltersName="kanban-filters",c.prototype.validQueryParams=["exclude_tags","tags","exclude_assigned_users","assigned_users","exclude_role","role","exclude_epic","epic","exclude_owner","owner"],c.prototype.cleanSelectedUss=function(){var t,e=[];for(t in this.selectedUss)e.push(this.selectedUss[t]=!1);return e},c.prototype.toggleSelectedUs=function(t){return this.selectedUss[t]=!this.selectedUss[t]},c.prototype.firstLoad=function(){var r,t=this.loadInitialData();return t.then((r=this,function(){var t=r.translate.instant("KANBAN.PAGE_TITLE",{projectName:r.scope.project.name}),e=r.translate.instant("KANBAN.PAGE_DESCRIPTION",{projectName:r.scope.project.name,projectDescription:r.scope.project.description});return r.appMetaService.setAll(t,e)})),t.then(null,this.onInitialDataError.bind(this))},c.prototype.setZoom=function(t,e){var r,n,i;return t=Number(t),this.zoomLevel===t?null:(r=this.zoomLevel,this.zoomLevel=t,this.zoom=e,this.isFirstLoad?this.firstLoad().then((i=this,function(){return i.isFirstLoad=!1,i.kanbanUserstoriesService.resetFolds()})):2<this.zoomLevel&&r<=2?(this.zoomLoading=!0,this.loadUserstories().then((n=this,function(){return n.zoomLoading=!1,n.kanbanUserstoriesService.resetFolds()}))):void 0)},c.prototype.filtersReloadContent=i(100,function(){return this.loadUserstories().then((e=this,function(t){if(t)return e.scope.swimlanesList.size&&!t.length?e.foldedSwimlane=e.foldedSwimlane.set(e.scope.swimlanesList.first().id.toString(),!1):void 0}));var e}),c.prototype.moveToTopDropdown=function(t){return this.moveUsToTop(t.toJS().model)},c.prototype.moveUsToTop=function(t){var e,r,n,i;if(Array.isArray(t)||(t=[t]),r=t[0],e=null,n=[],this.movedUs.push(r.id),this.timeout((i=this,function(){return i.movedUs=[]}),1e3,!1),(n=r.swimlane?this.scope.usByStatusSwimlanes.getIn([r.swimlane,r.status]):this.scope.usByStatus.get(r.status.toString()))&&n.size&&(e=n.get(0)),e)return this.moveUs(null,t,r.status,r.swimlane,0,null,e)},c.prototype.initializeEventHandlers=function(){var n,i,r,o,t,e;return this.scope.$on("usform:new:success",(n=this,function(t,e,r){return null==r&&(r="bottom"),n.refreshTagsColors().then(function(){if(n.kanbanUserstoriesService.add(e),n.scope.$broadcast("redraw:wip"),"top"===r)return n.moveUsToTop(e)}),n.analytics.trackEvent("userstory","create","create userstory on kanban",1)})),this.scope.$on("usform:bulk:success",(i=this,function(t,e,r){return null==r&&(r="bottom"),i.confirm.notify("success"),i.refreshTagsColors().then(function(){if(i.kanbanUserstoriesService.add(e),i.scope.$broadcast("redraw:wip"),"top"===r)return i.moveUsToTop(e)}),i.analytics.trackEvent("userstory","create","bulk create userstory on kanban",1)})),this.scope.$on("usform:edit:success",(r=this,function(t,e){return r.refreshTagsColors().then(function(){var t;return r.kanbanUserstoriesService.getUsModel(e.id).status!==e.status&&(t=r.scope.usByStatus.get(e.status.toString()))&&(t=t.last(),t=r.scope.usMap.get(t).getIn(["model","kanban_order"])+1,e.kanban_order=t),r.kanbanUserstoriesService.replaceModel(e),r.kanbanUserstoriesService.refreshRawOrder(),r.kanbanUserstoriesService.refresh(!1)})})),this.scope.$on("kanban:us:deleted",(o=this,function(t,e){return o.kanbanUserstoriesService.remove(e)})),this.scope.$on("kanban:us:move",this.moveUs),this.scope.$on("kanban:show-userstories-for-status",this.loadUserStoriesForStatus),this.scope.$on("kanban:hide-userstories-for-status",this.hideUserStoriesForStatus),this.scope.$on("lightbox:opened",(t=this,function(){return t.isLightboxOpened=!0})),this.scope.$on("lightbox:closed",(e=this,function(){if(e.isLightboxOpened=!1,e.isRefreshNeeded)return e.refreshAfterSwimlanesOrUserstoryStatusesHaveChanged(),e.isRefreshNeeded=!1}))},c.prototype.refreshAfterSwimlanesOrUserstoryStatusesHaveChanged=function(){return this.tgLoader.start(),this.projectService.fetchProject().then((t=this,function(){return t.loadInitialData()}));var t},c.prototype.initializeSubscription=function(){var e,r,t=w.randomInt(700,1e3),n="changes.project."+this.scope.projectId+".userstories";return this.events.subscribe(this.scope,n,i(t,(e=this,function(t){return e.eventsLoadUserstories(t)}))),n="changes.project."+this.scope.projectId+".projects",this.events.subscribe(this.scope,n,i(t,(r=this,function(t){if("projects.swimlane"===(t=t.matches)||"projects.swimlaneuserstorystatus"===t||"projects.userstorystatus"===t)return r.isLightboxOpened?r.isRefreshNeeded=!0:r.refreshAfterSwimlanesOrUserstoryStatusesHaveChanged()})))},c.prototype.addNewUs=function(t,e){var r=null;switch(t){case"standard":return this.rootscope.$broadcast("genericform:new",{objType:"us",project:this.scope.project,statusId:e,swimlane:r});case"bulk":return this.rootscope.$broadcast("usform:bulk",this.scope.projectId,e,r)}},c.prototype.editUs=function(t){var r,n=this.kanbanUserstoriesService.getUs(t);return n=n.set("loading-edit",!0),this.kanbanUserstoriesService.replace(n),this.rs.userstories.getByRef(n.getIn(["model","project"]),n.getIn(["model","ref"])).then((r=this,function(e){return r.rs2.attachments.list("us",n.get("id"),n.getIn(["model","project"])).then(function(t){return r.rootscope.$broadcast("genericform:edit",{objType:"us",obj:e,statusList:r.scope.usStatusList,attachments:t.toJS()})}),n=n.set("loading-edit",!1),r.kanbanUserstoriesService.replace(n)}))},c.prototype.deleteUs=function(t){var n,i=this.kanbanUserstoriesService.getUs(t);return i=i.set("loading-delete",!0),this.rs.userstories.getByRef(i.getIn(["model","project"]),i.getIn(["model","ref"])).then((n=this,function(r){var t,e;return i=i.set("loading-delete",!1),e=n.translate.instant("US.TITLE_DELETE_ACTION"),t=r.subject,n.confirm.askOnDelete(e,t).then(function(e){var t=n.repo.remove(r);return t.then(function(){var t=i.toJS().model;return n.scope.$broadcast("kanban:us:deleted",t),e.finish()}),t.then(null,function(){return e.finish(!1),this.confirm.notify("error")})})}))},c.prototype.showPlaceHolder=function(t,e){t=this.scope.usStatusList[0].id===t&&!this.kanbanUserstoriesService.userstoriesRaw.length;return e?(e=this.scope.swimlanesList.first().id===e,t&&e):t},c.prototype.toggleFold=function(t){return this.kanbanUserstoriesService.toggleFold(t)},c.prototype.toggleSwimlane=function(t){return this.foldedSwimlane=this.foldedSwimlane.set(t.toString(),!this.foldedSwimlane.get(t.toString())),this.rs.kanban.storeSwimlanesModes(this.scope.projectId,this.foldedSwimlane.toJS()),this.timeout((e=this,function(){return e.scope.$broadcast("redraw:wip")}),100,!1);var e},c.prototype.isUsInArchivedHiddenStatus=function(t){return this.kanbanUserstoriesService.isUsInArchivedHiddenStatus(t)},c.prototype.changeUsAssignedUsers=function(t){var r,n=this.kanbanUserstoriesService.getUsModel(t),t=function(t){var e;return n.assigned_users=t,e=n.assigned_to,a.call(t,e)<0&&0<t.length&&(n.assigned_to=t[0]),0===t.length&&(n.assigned_to=null),r.kanbanUserstoriesService.replaceModel(n),r.repo.save(n).then(function(){if(r.generateFilters(),r.isFilterDataTypeSelected("assigned_users")||r.isFilterDataTypeSelected("role"))return r.filtersReloadContent()})};return(r=this).lightboxFactory.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:_.compact(_.union(n.assigned_users,[n.assigned_to])),activeUsers:this.scope.activeUsers,onClose:t,lbTitle:this.translate.instant("COMMON.ASSIGNED_USERS.ADD")})},c.prototype.refreshTagsColors=function(){return this.rs.projects.tagsColors(this.scope.projectId).then((e=this,function(t){return e.scope.project.tags_colors=t._attrs}));var e},c.prototype.renderBatch=function(t){var e,r;return null==t&&(t=!1),this.renderInProgress=!0,e=_.take(this.queue,this.batchSize),this.rendered=_.concat(this.rendered,e),this.queue=_.drop(this.queue,this.batchSize),t?(this.kanbanUserstoriesService.set(e),this.batchTimings=[200,100,50]):this.kanbanUserstoriesService.add(e),0<this.queue.length?(o=this.batchTimings.shift()||20,this.timeout(this.renderBatch,o)):n(this.scope,(r=this,function(){return r.rootscope.$broadcast("kanban:userstories:loaded",r.rendered),r.scope.$broadcast("userstories:loaded",r.rendered),r.renderInProgress=!1,r.timeout(function(){return r.scope.$broadcast("redraw:wip")},100,!1)}))},c.prototype.renderUserStories=function(t){var n;if(t=_.sortBy(t,"kanban_order"),this.kanbanUserstoriesService.initUsByStatusList(t),this.renderBatching){for(n=_.groupBy(t,"status"),this.rendered=[],this.queue=[],this.batchSize=0;this.queue.length<t.length;)_.each(this.scope.project.us_statuses,function(r){return function(t){var e;if(0<(null!=(e=n[t.id])?e.length:void 0))return r.queue=_.concat(r.queue,_.take(n[t.id],10)),n[t.id]=_.drop(n[t.id],10)}}(this)),this.batchSize||(this.batchSize=100);return this.renderBatch(!0)}return this.kanbanUserstoriesService.set(t)},c.prototype.loadUserstoriesParams=function(){var t,e={status__is_archived:!1};return 2<=this.zoomLevel&&(e.include_attachments=1,e.include_tasks=1),t=_.pick(_.clone(this.location.search()),this.validQueryParams),(e=_.merge(e,t)).q=this.filterQ,e},c.prototype.eventsLoadUserstories=function(t){var r,n,i,e=[];return e=Array.isArray(t.pk)?t.pk:[t.pk],r=e.filter((n=this,function(e){return!!n.kanbanUserstoriesService.userstoriesRaw.find(function(t){return t.id===e})})),e=this.loadUserstoriesParams(),this.rs.userstories.listAll(this.scope.projectId,e).then((i=this,function(t){var e=t.filter(function(e){return!i.kanbanUserstoriesService.userstoriesRaw.find(function(t){return t.id===e.id})});return t.filter(function(t){return r.includes(t.id)}).forEach(function(t){return i.kanbanUserstoriesService.replaceModel(t),i.kanbanUserstoriesService.refreshRawOrder()}),e.length&&i.kanbanUserstoriesService.add(e),i.kanbanUserstoriesService.refresh(!1)}))},c.prototype.loadUserstories=function(){var t,n,e,r,i,o=this.loadUserstoriesParams();return this.lastSearch=this.filterQ,n=this.filterQ,this.lastLoadUserstoriesParams=o,e=[this.rs.userstories.listAll(this.scope.projectId,o),this.loadSwimlanes()],t=[],(o=_.difference(this.kanbanUserstoriesService.archivedStatus,this.kanbanUserstoriesService.statusHide)).length&&(t=o.map((r=this,function(t){return r.loadUserStoriesForStatus({},t)}))),e=e.concat(t),this.q.all(e).then((i=this,function(t){var e,r;if(n===i.lastSearch)return i.kanbanUserstoriesService.reset(!1,!1,!1),r=t[0],e=t[1],2<t.length&&t.slice(2).forEach(function(t){return r=r.concat(t)}),i.notFoundUserstories=!1,!r.length&&(i.filterQ&&i.filterQ.length||Object.keys(i.location.search()).length)&&(i.notFoundUserstories=!0),i.kanbanUserstoriesService.init(i.scope.project,e,i.scope.usersById),i.tgLoader.pageLoaded(),i.renderUserStories(r),r}))},c.prototype.loadUserStoriesForStatus=function(t,e){var r,n=this.location.search().status;if(!n||-1!==(n=n.split(",").map(function(t){return parseInt(t,10)})).indexOf(e))return n={status:e,include_attachments:!0,include_tasks:!0},this.filterQ&&(n.q=this.filterQ),n=_.merge(n,this.location.search()),this.rs.userstories.listAll(this.scope.projectId,n).then((r=this,function(t){return r.waitEmptyQuote(function(){return r.scope.$broadcast("kanban:shown-userstories-for-status",e,t)}),t}))},c.prototype.waitEmptyQuote=function(t){return 0<this.queue.length?requestAnimationFrame((e=this,function(){return e.waitEmptyQuote(t)})):n(this.scope,function(){return t()});var e},c.prototype.hideUserStoriesForStatus=function(t,e){return this.scope.$broadcast("kanban:hidden-userstories-for-status",e)},c.prototype.loadKanban=function(){return this.q.all([this.refreshTagsColors(),this.loadUserstories()])},c.prototype.loadSwimlanes=function(){return this.rs.swimlanes.list(this.scope.projectId).then((e=this,function(t){return e.scope.swimlanes=t,e.scope.swimlanesStatuses={},e.scope.swimlanes.forEach(function(t){return e.scope.swimlanesStatuses[t.id]=t.statuses}),e.scope.swimlanesStatuses[-1]=e.scope.project.us_statuses,e.scope.swimlanes}));var e},c.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.is_kanban_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.projectId=t.id,this.scope.points=_.sortBy(t.points,"order"),this.scope.pointsById=e(t.points,function(t){return t.id}),this.scope.usStatusById=e(t.us_statuses,function(t){return t.id}),this.scope.usStatusList=_.sortBy(t.us_statuses,"order"),this.scope.usCardVisibility={},this.scope.$emit("project:loaded",t),t},c.prototype.loadInitialData=function(){var t,e=this.loadProject();return this.foldedSwimlane=Immutable.fromJS(this.rs.kanban.getSwimlanesModes(e.id)),this.initialLoad=!1,this.fillUsersAndRoles(e.members,e.roles),this.initializeSubscription(),this.loadKanban().then((t=this,function(){return t.timeout(function(){return t.initialLoad=!0},0,!0)})),this.generateFilters()},c.prototype.moveUs=function(t,e,r,n,i,o,s){var a,c;return this.cleanSelectedUss(),e=_.map(e,(a=this,function(t){return a.kanbanUserstoriesService.getUsModel(t.id)})),this.rootscope.$broadcast("kanban:userstories:loaded",e,r,n,i),n=-1===n?null:n,s=this.kanbanUserstoriesService.move(e.map(function(t){return t.id}),r,n,i,o,s),this.rs.userstories.bulkUpdateKanbanOrder(this.scope.projectId,r,n,s.afterUserstoryId,s.beforeUserstoryId,s.bulkUserstories).then((c=this,function(){if(c.scope.$broadcast("redraw:wip"),c.generateFilters(),c.isFilterDataTypeSelected("status"))return c.filtersReloadContent()}))},r.controller("KanbanController",c),t=function(t,e){return{link:function(n,o,t){var i,s=function(){var r=o.find(".task-colum-name"),t=getComputedStyle(o[0]),n=Number(t.getPropertyValue("--kanban-column-margin").trim().replace("px","").split(" ")[1]),i=new ResizeObserver(function(t){var e=r.toArray().reduce(function(t,e){return document.body.contains(e)?t+e.offsetWidth+n:(i.unobserve(e),t)},0);if(0<e)return document.body.style.setProperty("--kanban-width",e-n+"px")});return r.each(function(t,e){return i.observe(e)})},a=initBoard();return a.events(function(t,e){var r;"SHOW_CARD"===t&&(r=e.filter(function(t){return t.visible&&!n.usCardVisibility[t.id]})).length&&n.$evalAsync(function(){return r.forEach(function(t){return n.usCardVisibility[t.id]=!0})})}),n.taskColumnLoaded=function(t,e,r){t=t.target[0];return a.addSwimlane(t,e,r)},n.cardLoaded=function(t,e,r){return a.addCard(t.target[0],e,r)},i=null,n.isTableLoaded=!1,n.kanbanTableLoaded=function(t,e){var r;n.$evalAsync(function(){return e&&n.openSwimlane(e),n.isTableLoaded=!0}),t=t.target,i=t,r=o.find(".kanban-table-header .kanban-table-inner"),t.on("scroll",function(t){t=-1*t.currentTarget.scrollLeft;return r.css("transform","translateX("+t+"px)")}),s()},n.$on("$destroy",function(){if(o.off(),i)return i.off()})}}},r.directive("tgKanban",["$tgRepo","$rootScope",t]),t=function(s,t,a){t.instant("KANBAN.ACTION_SHOW_ARCHIVED");return{link:function(r,n,i){var o=r.$watch("ctrl.initialLoad",function(t){var e;if(t)return o(),e=r.$eval(i.tgKanbanArchivedShowStatusHeader),a.addArchivedStatus(e.id),a.hideStatus(e.id),n.on("click",function(t){return r.$apply(function(){if(a.statusHide.includes(e.id))return s.$broadcast("kanban:show-userstories-for-status",e.id),a.showStatus(e.id)})})});return r.$on("$destroy",function(){return n.off()})}}},r.directive("tgKanbanArchivedShowStatusHeader",["$rootScope","$translate","tgKanbanUserstories",t]),t=function(t,i){return{link:function(t,e,r){var n=t.$eval(r.tgKanbanArchivedStatusIntro);return t.$on("kanban:shown-userstories-for-status",function(t,e,r){if(e===n.id)return i.deleteStatus(e),i.add(r)}),t.$on("$destroy",function(){return e.off()})}}},r.directive("tgKanbanArchivedStatusIntro",["$translate","tgKanbanUserstories",t]),t=function(c,u,r){return{link:function(s,t,e){var a;return s.foldStatus=function(t){s.folds||(s.folds=c.kanban.getStatusColumnModes(u.project.get("id"))),s.unfold=null,s.folds[t.id]=!s.folds[t.id],s.folds[t.id]||(s.unfold=t.id),c.kanban.storeStatusColumnModes(s.projectId,s.folds),r.archivedStatus.includes(t.id)&&!r.statusHide.includes(t.id)&&r.hideStatus(t.id)},a=s.$watch("ctrl.initialLoad",function(t){var e,r,n,i,o;if(t&&null!=(i=s.usByStatus)&&i.size){for(s.folds=c.kanban.getStatusColumnModes(u.project.get("id")),r=0,n=(e=s.usStatusList.filter(function(t){return t.is_archived})).length;r<n;r++)o=e[r],s.folds[o.id]=!0;return a()}})}}},r.directive("tgKanbanSquishColumn",["$tgResources","tgProjectService","tgKanbanUserstories",t]),t=function(r){return{link:function(t,n,e){var i=t.$eval(e.tgKanbanWipLimit),e=function(){return r(function(){var t=n.find("tg-card"),e="",r=null;if(t.length+1===i.wip_limit?(e="one-left",r=t[t.length-1]):t.length===i.wip_limit?(e="reached",r=t[t.length-1]):t.length>i.wip_limit&&(e="exceeded",r=t[i.wip_limit-1]),n.find(".kanban-wip-limit").remove(),r)return angular.element(r).after("<div class='kanban-wip-limit "+e+"'><span>WIP Limit</span></div>")},0,!1)};return i&&!i.is_archived&&(t.$on("redraw:wip",e),t.$on("kanban:us:move",e),t.$on("usform:new:success",e),t.$on("usform:bulk:success",e)),t.$on("$destroy",function(){return n.off()})}}},r.directive("tgKanbanWipLimit",["$timeout",t]),u='<tg-svg>\n    <svg class="icon <%- svgIcon %>" style="fill: <%- svgFill %>">\n        <use xlink:href="#<%- svgIcon %>" attr-href="#<%- svgIcon %>">\n            <% if(svgTitle) { %>\n            <title><%- svgTitle %></title>\n            <% } %>\n        </use>\n    </svg>\n</tg-svg>',t=function(t,r,n,i){var o=t.get("components/card/card-templates/card-assigned-to.html",!0),s=_.template(u),a=function(t){var e={};return(t.item.get("assigned_users")||[t.item.get("assigned_to")]).forEach(function(t){if(t)return e[t.get("id")]=n.getAvatar(t,"avatar")}),o({vm:t,avatars:e,translate:function(t,e){return r.instant(t,e)},checkPermission:function(t){return-1<i.project.get("my_permissions").indexOf(t)},svg:function(t){return s(Object.assign({svgTitle:"",svgFill:""},t))},loading:"<img\n    class='loading-spinner'\n    src='"+window._version+"/svg/spinner-circle.svg'\n    alt='loading...'\n/>"})};return{scope:{zoomLevel:"<",item:"<",vm:"<"},link:function(e,r){var t=!1,n=function(){var t=a(e.vm);return r.off(),r.html(t),r.find(".card-user-avatar").on("click",function(t){if(!t.ctrlKey&&!t.metaKey)return e.vm.onClickAssignedTo({id:e.vm.item.get("id")})})};return e.$watch("item",n),e.$watch("zoomLevel",function(){return t?n():t=!0}),e.$on("$destroy",function(){return r.off()})}}},r.directive("tgCardAssignedTo",["$tgTemplate","$translate","tgAvatarService","tgProjectService",t]),t=function(t,n,i,e,o){var s=t.get("components/card/card-templates/card-data.html",!0),a=_.template(u),c=function(e){var r={};return(e.item.get("assigned_users")||[]).forEach(function(t){return t?r[t.get("id")]=i.getAvatar(t,"avatar"):console.error("invalid assigned_users",e.item.get("assigned_users").toJS())}),s({vm:e,avatars:r,emptyTask:function(){var t=e.item.getIn(["model","tasks"]);return!t||!t.size},dueDateColor:function(){return o.color({dueDate:e.item.getIn(["model","due_date"]),isClosed:e.item.getIn(["model","is_closed"]),objType:e.type})},dueDateTitle:function(){return o.title({dueDate:e.item.getIn(["model","due_date"]),isClosed:e.item.getIn(["model","is_closed"]),objType:e.type})},totalAttachments:function(){return"task"===e.type?e.item.getIn(["model","attachments"]).size:e.item.getIn(["model","total_attachments"])},translate:function(t,e){return n.instant(t,e)},svg:function(t){return a(Object.assign({svgTitle:"",svgFill:""},t))}})};return{scope:{zoomLevel:"<",item:"<",vm:"<"},link:function(e,r){var t=!1,n=function(){var t=c(e.vm);return r.off(),r.html(t)};return e.$watch("item",n),e.$watch("zoomLevel",function(){return t?n():t=!0}),e.$on("$destroy",function(){return r.off()})}}},r.directive("tgCardData",["$tgTemplate","$translate","tgAvatarService","tgProjectService","tgDueDateService",t]),t=function(t,s,a){var e=t.get("components/card/card-templates/card-actions.html",!0),r=_.template(u),c=function(t){return e({vm:t,translate:function(t,e){return s.instant(t,e)},checkPermission:function(t){return-1<a.project.get("my_permissions").indexOf(t)},svg:function(t){return r(Object.assign({svgTitle:"",svgFill:""},t))}})};return{scope:{zoomLevel:"<",item:"<",vm:"<"},link:function(r,e){var t=!1,n=!1,i=function(){return n=!1,e.find(".js-popup-button").removeClass("popover-open")},o=function(){var t=c(r.vm);return e.off(),e.html(t),n=!1,e.find(".js-popup-button").on("click",function(t){var e;if(!n)return n=!0,$(t.currentTarget).addClass("popover-open"),e=[],a.project.get("my_permissions").includes(r.vm.getModifyPermisionKey())&&e.push({text:s.instant("COMMON.CARD.EDIT"),icon:"icon-edit",event:function(){return r.vm.onClickEdit({id:r.vm.item.get("id")})}},{text:s.instant("COMMON.CARD.ASSIGN_TO"),icon:"icon-assign-to",event:function(){return r.vm.onClickAssignedTo({id:r.vm.item.get("id")})}}),a.project.get("my_permissions").includes(r.vm.getDeletePermisionKey())&&e.push({text:s.instant("COMMON.CARD.DELETE"),icon:"icon-trash",event:function(){return r.vm.onClickDelete({id:r.vm.item.get("id")})}}),a.project.get("my_permissions").includes(r.vm.getModifyPermisionKey())&&!r.vm.isFirst&&e.push({text:s.instant("COMMON.CARD.MOVE_TO_TOP"),icon:"icon-move-to-top",event:function(){return r.vm.onClickMoveToTop(r.vm.item)}}),w.globalPopover(t.currentTarget,e,{},i)})};return r.$watch("item",o),r.$watch("zoomLevel",function(){return t?o():t=!0}),r.$on("$destroy",function(){return e.off()})}}},r.directive("tgCardActions",["$tgTemplate","$translate","tgProjectService",t]),t=function(c){return{link:function(t,e,r){var n,i,o=[],s=null,a=t.$parent.ctrl;if(!a)throw new Error("KanbanSwimlaneDirective ctrl not found");return e.on("scroll",function(t){return o.length||(o=e.find(".kanban-swimlane-title")),s=s||e.find(".kanban-swimlane-add"),t=t.currentTarget.scrollLeft,o.css("transform","translateX("+t+"px)"),s.css("transform","translateX("+t+"px)")}),i=null,n="pending-to-open",t.mouseleaveSwimlane=function(t){if(i)return c.cancel(i.timeoutId),i.el.classList.remove(n),i=null},t.mouseoverSwimlane=function(t,e){var r;if(!i||i.id!==e)return i&&(c.cancel(i.timeoutId),i.el.classList.remove(n)),(r=t.currentTarget).classList.contains("folded")&&!!document.querySelectorAll("tg-card.gu-mirror").length?(r.classList.add(n),t=c(function(){return r.classList.remove(n),a.toggleSwimlane(e)},1e3),i={id:e,timeoutId:t,el:r}):void 0},t.$on("$destroy",function(){return e.off()})}}},r.directive("tgKanbanSwimlane",["$timeout",t]),t=function(){return{link:function(t,e,r){return e.on("scroll",function(t){t=t.currentTarget.scrollTop;return e.find(".kanban-task-counter").css("transform","translateY("+t+"px)")}),t.$on("$destroy",function(){return e.off()})}}},r.directive("tgKanbanTaskboardColumn",[t])}.call(this),function(){this.taiga,this.taiga.mixOf,this.taiga.toggleText,this.taiga.scopeDefer,this.taiga.bindOnce,this.taiga.groupBy,this.taiga.timeout;var t=function(t,e,y,S){return{link:function(g,e,t){var r,n,i=null,v=null;return g.openSwimlane=function(t){t=_.map($('.kanban-swimlane[data-swimlane="'+t+'"] .taskboard-column'),function(t){return t});return r(t)},r=function(n){var p,d,h,f,m;if(-1<g.project.my_permissions.indexOf("modify_us")){if(!i)return 0,p=function(t){return t.off(),t.remove()},i=dragula(n,{copySortSource:!1,copy:!1,moves:function(t){return $(t).is("tg-card")}}),d=null,i.on("over",function(t,e){return d?e!==d?$(e).addClass("target-drop"):void 0:d=e}),i.on("out",function(t,e){if(e!==d)return $(e).removeClass("target-drop")}),i.on("drag",function(t){var e,r=window.dragMultiple.getElements();return r.length||(r=[t]),e=r[0],r=t.parentNode,v=$(r).find("tg-card").index(e),d=null,window.dragMultiple.start(t,n)}),i.on("cloned",function(t,e){return $(t).addClass("multiple-drag-mirror")}),f=m=null,i.on("drop",function(t,e,r,n){var i;if(f=m=null,i=$(t).prevAll("tg-card:not(.gu-transit)"),t=$(t).nextAll("tg-card:not(.gu-transit)"),m=null,i.length&&i[0].dataset.id&&(m=Number(i[0].dataset.id)),f=null,!m&&t.length&&t[0].dataset.id)return f=Number(t[0].dataset.id)}),i.on("dragend",function(t,e,r,n){var i,o,s,a,c,u=t.parentNode,l=window.dragMultiple.stop();if(l.length||(l=[t]),l[0].dataset.id,t=l[0],o=$(u).find("tg-card").index(t),s=Number(u.dataset.status),a=Number(u.dataset.swimlane),o!==v||d!==u)return d!==u&&($(u).addClass("new"),$(u).one("animationend",function(){return $(u).removeClass("new")})),c=_.map(l,function(t){return S.usMap.get(Number(t.dataset.id))}),i=_.map(c,function(t){return{id:t.get("id"),oldStatusId:t.getIn(["model","status"]),oldSwimlaneId:t.getIn(["model","swimlane"])}}),g.$apply(function(){return _.each(c,function(t,e){var r=t.getIn(["model","status"]),t=t.getIn(["model","swimlane"])||-1;if(!(s===r&&a===t))return h=$(l[e]),p(h)}),y.$broadcast("kanban:us:move",i,s,a,o,m,f)})}),autoScroll(n,{margin:100,scrollWhenOutside:!0,autoScroll:function(){return this.down&&i.dragging}});n.forEach(function(t){return i.containers.push(t)})}},n=g.$watch("isTableLoaded",function(t){if(t&&!$(".swimlane").length)return n(),t=_.map(e.find(".taskboard-column"),function(t){return t}),r(t)}),g.$on("$destroy",function(){if(e.off(),i)return i.destroy()})}}};angular.module("taigaKanban").directive("tgKanbanSortable",["$tgRepo","$tgResources","$rootScope","tgKanbanUserstories",t])}.call(this),function(){var S,e,t,r,n,i={}.hasOwnProperty;function o(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m,g,v){var y,_;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.rs2=o,this.params=s,this.q=a,this.location=c,this.log=u,this.appMetaService=l,this.analytics=p,this.navUrls=d,this.translate=h,this.modelTransform=f,this.errorHandlingService=m,this.projectService=g,this.attachmentsFullService=v,S(this),this.scope.epicRef=this.params.epicref,this.scope.sectionName=this.translate.instant("EPIC.SECTION_NAME"),this.scope.attachmentsReady=!1,this.scope.$on("attachments:loaded",(y=this,function(){return y.scope.attachmentsReady=!0})),this.initializeEventHandlers(),(v=this.loadInitialData()).then((_=this,function(){return _._setMeta(),_.initializeOnDeleteGoToUrl()})),v.then(null,this.onInitialDataError.bind(this))}n=this.taiga,t=this.taiga.mixOf,this.taiga.toString,this.taiga.joinStr,e=this.taiga.groupBy,this.taiga.bindOnce,S=this.taiga.bindMethods,r=angular.module("taigaEpics"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,t(n.Controller,n.PageMixin)),o.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgAnalytics","$tgNavUrls","$translate","$tgQueueModelTransformation","tgErrorHandlingService","tgProjectService","tgAttachmentsFullService"],o.prototype._setMeta=function(){var t=this.translate.instant("EPIC.PAGE_TITLE",{epicRef:"#"+this.scope.epic.ref,epicSubject:this.scope.epic.subject,projectName:this.scope.project.name}),e=this.translate.instant("EPIC.PAGE_DESCRIPTION",{epicStatus:(null!=(e=this.scope.statusById[this.scope.epic.status])?e.name:void 0)||"--",epicDescription:angular.element(this.scope.epic.description_html||"").text()});return this.appMetaService.setAll(t,e)},o.prototype.loadAttachments=function(){return this.attachmentsFullService.loadAttachments("epic",this.scope.epicId,this.scope.projectId)},o.prototype.initializeEventHandlers=function(){var t,e,r;return this.scope.$on("attachment:create",(t=this,function(){return t.analytics.trackEvent("attachment","create","create attachment on epic",1)})),this.scope.$on("comment:new",(e=this,function(){return e.loadEpic()})),this.scope.$on("custom-attributes-values:edit",(r=this,function(){return r.rootscope.$broadcast("object:updated")}))},o.prototype.initializeOnDeleteGoToUrl=function(){var t={project:this.scope.project.slug};return this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-epics",t)},o.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.immutableProject=this.projectService.project,this.scope.$emit("project:loaded",t),this.scope.statusList=t.epic_statuses,this.scope.statusById=e(t.epic_statuses,function(t){return t.id}),t},o.prototype.loadEpic=function(){return this.rs.epics.getByRef(this.scope.projectId,this.params.epicref).then((r=this,function(t){var e;if(r.scope.epic=t,r.scope.immutableEpic=Immutable.fromJS(t._attrs),r.scope.epicId=t.id,r.scope.commentModel=t,r.loadAttachments(),r.modelTransform.setObject(r.scope,"epic"),null!=(null!=(t=r.scope.epic.neighbors.previous)?t.ref:void 0)&&(e={project:r.scope.project.slug,ref:r.scope.epic.neighbors.previous.ref},r.scope.previousUrl=r.navUrls.resolve("project-epics-detail",e)),null!=(null!=(t=r.scope.epic.neighbors.next)?t.ref:void 0))return e={project:r.scope.project.slug,ref:r.scope.epic.neighbors.next.ref},r.scope.nextUrl=r.navUrls.resolve("project-epics-detail",e)}));var r},o.prototype.loadUserstories=function(){return this.rs2.userstories.listInEpic(this.scope.epicId).then((e=this,function(t){return e.scope.userstories=t}));var e},o.prototype.loadInitialData=function(){var t,e=this.loadProject();return this.fillUsersAndRoles(e.members,e.roles),this.loadEpic().then((t=this,function(){return t.loadUserstories()}))},o.prototype.onUpvote=function(){var t,e,r=function(){return t.loadEpic(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.epics.upvote(this.scope.epicId).then(r,n)},o.prototype.onDownvote=function(){var t,e,r=function(){return t.loadEpic(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.epics.downvote(this.scope.epicId).then(r,n)},o.prototype.onWatch=function(){var t,e,r=function(){return t.loadEpic(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.epics.watch(this.scope.epicId).then(r,n)},o.prototype.onUnwatch=function(){var t,e,r=function(){return t.loadEpic(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.epics.unwatch(this.scope.epicId).then(r,n)},o.prototype.onSelectColor=function(e){var t,r,n=function(){return t.rootscope.$broadcast("object:updated"),t.confirm.notify("success")},i=function(){return r.confirm.notify("error")};return(r=t=this).modelTransform.save(function(t){return t.color=e,t}).then(n,i)},r.controller("EpicDetailController",o),n=function(t,i){var o=t.get("common/components/status-display.html",!0);return{link:function(e,r,t){var n=function(t){var t=e.statusById[t.status],t=o({is_closed:t.is_closed,status:t});return t=i(t)(e),r.html(t)};return e.$watch(t.ngModel,function(t){if(null!=t)return n(t)}),e.$on("$destroy",function(){return r.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgEpicStatusDisplay",["$tgTemplate","$compile",n]),n=function(a,t,c,u,l,p,e,r){var d=r.get("common/components/status-button.html",!0);return{link:function(e,i,t,r){var n=function(){return-1!==e.project.my_permissions.indexOf("modify_epic")},o=function(t){var t=e.statusById[t.status],t=p(d({status:t,statuses:e.statusList,editable:n()}))(e);return i.html(t)},s=function(e){var t=u().target(i).start(),r=function(){return a.$broadcast("object:updated"),t.finish()},n=function(){return c.notify("error"),t.finish()};return l.save(function(t){return t.status=e,t}).then(r,n)};return i.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),n())return i.find(".pop-status").popover().open()}),i.on("click",".status",function(t){if(t.preventDefault(),t.stopPropagation(),n())return t=angular.element(t.currentTarget),$.fn.popover().closeAll(),s(t.data("status-id"))}),e.$watch(function(){var t;return null!=(t=r.$modelValue)?t.status:void 0},function(){var t=r.$modelValue;if(t)return o(t)}),e.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgEpicStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$translate","$tgTemplate",n])}.call(this),function(){var S,e,t,r,f,n,i={}.hasOwnProperty;function o(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m,g){var v,y;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.log=c,this.appMetaService=u,this.analytics=l,this.navUrls=p,this.translate=d,this.modelTransform=h,this.errorHandlingService=f,this.projectService=m,this.attachmentsFullService=g,S(this),this.scope.issueRef=this.params.issueref,this.scope.sectionName=this.translate.instant("ISSUES.SECTION_NAME"),this.scope.attachmentsReady=!1,this.scope.$on("attachments:loaded",(v=this,function(){return v.scope.attachmentsReady=!0})),this.initializeEventHandlers(),(g=this.loadInitialData()).then((y=this,function(){return y._setMeta(),y.initializeOnDeleteGoToUrl()})),g.then(null,this.onInitialDataError.bind(this))}n=this.taiga,t=this.taiga.mixOf,this.taiga.toString,this.taiga.joinStr,e=this.taiga.groupBy,this.taiga.bindOnce,S=this.taiga.bindMethods,f=this.taiga.normalizeString,r=angular.module("taigaIssues"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,t(n.Controller,n.PageMixin)),o.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgAnalytics","$tgNavUrls","$translate","$tgQueueModelTransformation","tgErrorHandlingService","tgProjectService","tgAttachmentsFullService"],o.prototype._setMeta=function(){var t=this.translate.instant("ISSUE.PAGE_TITLE",{issueRef:"#"+this.scope.issue.ref,issueSubject:this.scope.issue.subject,projectName:this.scope.project.name}),e=this.translate.instant("ISSUE.PAGE_DESCRIPTION",{issueStatus:(null!=(e=this.scope.statusById[this.scope.issue.status])?e.name:void 0)||"--",issueType:(null!=(e=this.scope.typeById[this.scope.issue.type])?e.name:void 0)||"--",issueSeverity:(null!=(e=this.scope.severityById[this.scope.issue.severity])?e.name:void 0)||"--",issuePriority:(null!=(e=this.scope.priorityById[this.scope.issue.priority])?e.name:void 0)||"--",issueDescription:angular.element(this.scope.issue.description_html||"").text()});return this.appMetaService.setAll(t,e)},o.prototype.loadAttachments=function(){return this.attachmentsFullService.loadAttachments("issue",this.scope.issueId,this.scope.projectId)},o.prototype.initializeEventHandlers=function(){var t,e,r,n,i;return this.scope.$on("attachment:create",(t=this,function(){return t.analytics.trackEvent("attachment","create","create attachment on issue",1)})),this.scope.$on("promote-issue-to-us:success",(e=this,function(){return e.analytics.trackEvent("issue","promoteToUserstory","promote issue to userstory",1),e.rootscope.$broadcast("object:updated"),e.loadIssue()})),this.scope.$on("comment:new",(r=this,function(){return r.loadIssue()})),this.scope.$on("custom-attributes-values:edit",(n=this,function(){return n.rootscope.$broadcast("object:updated")})),this.scope.$on("assign-sprint-to-issue:success",(i=this,function(t,e){return i.scope.issue.milestone=e,i.rootscope.$broadcast("object:updated"),e?i.loadSprint():i.scope.sprint=null}))},o.prototype.initializeOnDeleteGoToUrl=function(){var t={project:this.scope.project.slug};return this.scope.project.is_issues_activated?this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-issues",t):this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t)},o.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.statusList=t.issue_statuses,this.scope.statusById=e(t.issue_statuses,function(t){return t.id}),this.scope.typeById=e(t.issue_types,function(t){return t.id}),this.scope.typeList=_.sortBy(t.issue_types,"order"),this.scope.severityList=t.severities,this.scope.severityById=e(t.severities,function(t){return t.id}),this.scope.priorityList=t.priorities,this.scope.priorityById=e(t.priorities,function(t){return t.id}),t},o.prototype.loadIssue=function(){return this.rs.issues.getByRef(this.scope.projectId,this.params.issueref).then((r=this,function(t){var e;if(r.scope.issue=t,r.scope.issueId=t.id,r.scope.commentModel=t,r.loadAttachments(),r.modelTransform.setObject(r.scope,"issue"),null!=(null!=(t=r.scope.issue.neighbors.previous)?t.ref:void 0)&&(e={project:r.scope.project.slug,ref:r.scope.issue.neighbors.previous.ref},r.scope.previousUrl=r.navUrls.resolve("project-issues-detail",e)),null!=(null!=(t=r.scope.issue.neighbors.next)?t.ref:void 0))return e={project:r.scope.project.slug,ref:r.scope.issue.neighbors.next.ref},r.scope.nextUrl=r.navUrls.resolve("project-issues-detail",e)}));var r},o.prototype.loadSprint=function(){if(this.scope.issue.milestone)return this.rs.sprints.get(this.scope.issue.project,this.scope.issue.milestone).then((e=this,function(t){return e.scope.sprint=t}));var e},o.prototype.loadInitialData=function(){var t,e=this.loadProject();return this.fillUsersAndRoles(e.members,e.roles),this.loadIssue().then((t=this,function(){if(-1!==t.scope.project.my_permissions.indexOf("view_milestones"))return t.loadSprint()}))},o.prototype.onUpvote=function(){var t,e,r=function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.issues.upvote(this.scope.issueId).then(r,n)},o.prototype.onDownvote=function(){var t,e,r=function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.issues.downvote(this.scope.issueId).then(r,n)},o.prototype.onWatch=function(){var t,e,r=function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.issues.watch(this.scope.issueId).then(r,n)},o.prototype.onUnwatch=function(){var t,e,r=function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.issues.unwatch(this.scope.issueId).then(r,n)},r.controller("IssueDetailController",o),n=function(t,i){var o=t.get("common/components/status-display.html",!0);return{link:function(e,r,t){var n=function(t){var t=e.statusById[t.status],t=o({is_closed:t.is_closed,status:t});return t=i(t)(e),r.html(t)};return e.$watch(t.ngModel,function(t){if(null!=t)return n(t)}),e.$on("$destroy",function(){return r.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgIssueStatusDisplay",["$tgTemplate","$compile",n]),n=function(a,t,c,u,l,e,p){var d=e.get("common/components/status-button.html",!0);return{link:function(e,i,t,r){var n=function(){return-1!==e.project.my_permissions.indexOf("modify_issue")},o=function(t){var t=e.statusById[t.status],t=d({status:t,statuses:e.statusList,editable:n()});return t=p(t)(e),i.html(t)},s=function(e){var t,r,n;return $.fn.popover().closeAll(),t=u().target(i).start(),n=function(){return a.$broadcast("object:updated"),t.finish()},r=function(){return c.notify("error"),t.finish()},l.save(function(t){return t.status=e,t}).then(n,r)};return i.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),n())return i.find(".pop-status").popover().open()}),i.on("click",".status",function(t){if(t.preventDefault(),t.stopPropagation(),n())return t=angular.element(t.currentTarget),s(t.data("status-id"))}),e.$watch(function(){var t;return null!=(t=r.$modelValue)?t.status:void 0},function(){var t=r.$modelValue;if(t)return o(t)}),e.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgIssueStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),n=function(c,t,u,l,p,e,d){var h=e.get("issue/issue-type-button.html",!0);return{link:function(i,o,t,s){var a=i.$eval(t.notAutoSave),e=function(){return-1!==i.project.my_permissions.indexOf("modify_issue")},r=function(t){var t=i.typeById[t.type],t=h({type:t,typees:i.typeList,editable:e()});return t=d(t)(i),o.html(t)},n=function(e){var t,r,n;return $.fn.popover().closeAll(),a?(s.$modelValue.type=e,void i.$apply()):(t=l().target(o.find(".level-name")).start(),n=function(){return c.$broadcast("object:updated"),t.finish()},r=function(){return u.notify("error"),t.finish()},p.save(function(t){return t.type=e,t}).then(n,r))};return o.on("click",".type-data",function(t){if(t.preventDefault(),t.stopPropagation(),e())return o.find(".pop-type").popover().open()}),o.on("click",".type",function(t){if(t.preventDefault(),t.stopPropagation(),e())return t=angular.element(t.currentTarget).data("type-id"),n(t)}),i.$watch(function(){var t;return null!=(t=s.$modelValue)?t.type:void 0},function(){var t=s.$modelValue;if(t)return r(t)}),i.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgIssueTypeButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),n=function(c,t,u,l,p,e,d){var h=e.get("issue/issue-severity-button.html",!0);return{link:function(i,o,t,s){var a=i.$eval(t.notAutoSave),e=function(){return-1!==i.project.my_permissions.indexOf("modify_issue")},r=function(t){var t=i.severityById[t.severity],t=h({severity:t,severityes:i.severityList,editable:e()});return t=d(t)(i),o.html(t)},n=function(e){var t,r,n;return $.fn.popover().closeAll(),a?(s.$modelValue.severity=e,void i.$apply()):(t=l().target(o.find(".level-name")).start(),n=function(){return c.$broadcast("object:updated"),t.finish()},r=function(){return u.notify("error"),t.finish()},p.save(function(t){return t.severity=e,t}).then(n,r))};return o.on("click",".severity-data",function(t){if(t.preventDefault(),t.stopPropagation(),e())return o.find(".pop-severity").popover().open()}),o.on("click",".severity",function(t){if(t.preventDefault(),t.stopPropagation(),e())return t=angular.element(t.currentTarget).data("severity-id"),n(t)}),i.$watch(function(){var t;return null!=(t=s.$modelValue)?t.severity:void 0},function(){var t=s.$modelValue;if(t)return r(t)}),i.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgIssueSeverityButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),n=function(c,t,u,l,p,e,d){var h=e.get("issue/issue-priority-button.html",!0);return{link:function(i,o,t,s){var a=i.$eval(t.notAutoSave),e=function(){return-1!==i.project.my_permissions.indexOf("modify_issue")},r=function(t){var t=i.priorityById[t.priority],t=h({priority:t,priorityes:i.priorityList,editable:e()});return t=d(t)(i),o.html(t)},n=function(e){var t,r,n;return $.fn.popover().closeAll(),a?(s.$modelValue.priority=e,void i.$apply()):(t=l().target(o.find(".level-name")).start(),n=function(){return c.$broadcast("object:updated"),t.finish()},r=function(){return u.notify("error"),t.finish()},p.save(function(t){return t.priority=e,t}).then(n,r))};return o.on("click",".priority-data",function(t){if(t.preventDefault(),t.stopPropagation(),e())return o.find(".pop-priority").popover().open()}),o.on("click",".priority",function(t){if(t.preventDefault(),t.stopPropagation(),e())return t=angular.element(t.currentTarget).data("priority-id"),n(t)}),i.$watch(function(){var t;return null!=(t=s.$modelValue)?t.priority:void 0},function(){var t=s.$modelValue;if(t)return r(t)}),i.$on("$destroy",function(){return o.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgIssuePriorityButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),n=function(a,c,t,u,l,p,d,h){return{link:function(r,n,t,e){var i,o=[],s=null;return r.$watch(t.ngModel,function(t){if(t)return t.milestone?(n.find(".assign-issue-button.button-unset").removeClass("is-active"),n.find(".assign-issue-button.button-set").addClass("is-active")):(n.find(".assign-issue-button.button-set").removeClass("is-active"),n.find(".assign-issue-button.button-unset").addClass("is-active"))}),n.on("click",".assign-issue-button.button-unset",function(t){return t.preventDefault(),t.stopPropagation(),l.instant("ISSUES.ACTION_ATTACH_SPRINT"),s=e.$modelValue,c.sprints.list(r.projectId,null).then(function(t){return r.milestones=t.milestones,r.selectedSprint=s.milestone,o=angular.copy(r.milestones),p.open(n.find(".lightbox-assign-sprint-to-issue"))})}),n.on("click",".assign-issue-button.button-set",function(t){return t.preventDefault(),t.stopPropagation(),s=e.$modelValue,c.sprints.list(r.projectId,null).then(function(t){var e=_.find(t.milestones,{id:s.milestone}),t=l.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.TITLE"),e=l.instant("ISSUES.CONFIRM_DETACH_FROM_SPRINT.MESSAGE",{sprintName:e.name});return h.ask(t,null,e).then(function(t){var e=function(){return a.$broadcast("assign-sprint-to-issue:success",null),t.finish(),p.close(n)},r=function(){return t.finish(!1),h.notify("error")};return d.save(function(t){return t.setAttr("milestone",null),t}).then(e,r)})})}),r.$on("$destroy",function(){return n.off()}),i=function(t,e){return e=f(e.toUpperCase()),t=f(t.toUpperCase()),_.includes(e,t)},r.filterMilestones=function(e){return r.milestones=o.filter(function(t){return i(e,t.name)})},r.saveIssueToSprint=function(e,t){var r=u().target($(t.currentTarget)).start();return s.setAttr("milestone",e.id),d.save(function(t){return s.setAttr("milestone",e.id),t}).then(function(){return r.finish(),p.close(n.find(".lightbox-assign-sprint-to-issue")),a.$broadcast("assign-sprint-to-issue:success",e.id)})}},restrict:"EA",require:"ngModel",templateUrl:"issue/assign-sprint-to-issue-button.html"}},r.directive("tgAssignSprintToIssueButton",["$rootScope","$tgResources","$tgRepo","$tgLoading","$translate","lightboxService","$tgQueueModelTransformation","$tgConfirm",n])}.call(this),function(){this.taiga,this.taiga.bindOnce;var r=this.taiga.debounce,t=(this.taiga.trim,function(t,c,u,l,p,d,h){return{link:function(i,o,t){var e,s,a=null;return i.$on("issueform:bulk",function(t,e,r,n){return a&&a.reset(),d.open(o),i.new={projectId:e,milestoneId:r,bulk:""}}),e=r(2e3,function(t){var e,r,n;if(t.preventDefault(),a=o.find("form").checksley(),a.validate()&&!(e=p().target(s).start()).isLoading())return n=i.new.bulk,r=i.new.projectId,t=i.new.milestoneId,(n=c.issues.bulkCreate(r,t,n)).then(function(t){return t=_.map(t.data,function(t){return h.make_model("issues",t)}),e.finish(),l.$broadcast("issueform:new:success",t),d.close(o),u.notify("success")}),n.then(null,function(){return e.finish(),u.notify("error")})}),s=o.find("button[type='submit']"),o.on("submit","form",e),i.$on("$destroy",function(){return o.off()})}}});angular.module("taigaIssues").directive("tgLbCreateBulkIssues",["$tgRepo","$tgResources","$tgConfirm","$rootScope","$tgLoading","lightboxService","$tgModel",t])}.call(this),function(){var I,r,e,t,n,l,d,p,i={}.hasOwnProperty;function o(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m,g,v){var y,_,S,b,j,k;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.urls=o,this.params=s,this.q=a,this.location=c,this.appMetaService=u,this.navUrls=l,this.events=p,this.analytics=d,this.translate=h,this.errorHandlingService=f,this.storage=m,this.filterRemoteStorageService=g,this.projectService=v,this.loadIssues=(y=this.loadIssues,_=this,function(){return y.apply(_,arguments)}),I(this),this.showTags=!0,this.scope.sectionName=this.translate.instant("PROJECT.SECTION.ISSUES"),this.voting=!1,this.openFilter=!1,this.applyStoredFilters(this.params.pslug,this.filtersHashSuffix,this.validQueryParams)||((v=this.loadInitialData()).then((S=this,function(){var t=S.translate.instant("ISSUES.PAGE_TITLE",{projectName:S.scope.project.name}),e=S.translate.instant("ISSUES.PAGE_DESCRIPTION",{projectName:S.scope.project.name,projectDescription:S.scope.project.description});return S.appMetaService.setAll(t,e)})),v.then(null,this.onInitialDataError.bind(this)),this.scope.$on("issueform:new:success",(b=this,function(){return b.analytics.trackEvent("issue","create","create issue on issues list",1),b.loadIssues()})),this.scope.$on("assigned-to:changed",(j=this,function(){if(j.generateFilters(),j.isFilterDataTypeSelected("assigned_to")||j.isFilterDataTypeSelected("role")||j.isOrderedBy("assigned_to")||j.isOrderedBy("modified"))return j.loadIssues()})),this.scope.$on("status:changed",(k=this,function(){if(k.generateFilters(),k.isFilterDataTypeSelected("status")||k.isOrderedBy("status")||k.isOrderedBy("modified"))return k.loadIssues()})))}d=this.taiga,t=this.taiga.mixOf,p=this.taiga.trim,this.taiga.toString,this.taiga.joinStr,e=this.taiga.groupBy,this.taiga.bindOnce,r=this.taiga.debounceLeading,l=this.taiga.startswith,I=this.taiga.bindMethods,r=this.taiga.debounceLeading,n=angular.module("taigaIssues"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,t(d.Controller,d.PageMixin,d.FiltersMixin)),o.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$tgUrls","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","tgErrorHandlingService","$tgStorage","tgFilterRemoteStorageService","tgProjectService","tgUserActivityService"],o.prototype.filtersHashSuffix="issues-filters",o.prototype.myFiltersHashSuffix="issues-my-filters",o.prototype.excludePrefix="exclude_",o.prototype.filterCategories=["tags","status","type","severity","priority","assigned_to","owner","role"],o.prototype.validQueryParams=["exclude_tags","tags","exclude_status","status","exclude_type","type","exclude_severity","severity","exclude_priority","priority","exclude_assigned_to","assigned_to","exclude_role","role","exclude_owner","owner","order_by"],o.prototype.toggleShowTags=function(){return this.rs.issues.storeIssuesShowTags(this.scope.projectId,this.showTags)},o.prototype.isOrderedBy=function(t){return new RegExp("-*"+t).test(this.location.search().order_by)},o.prototype.changeQ=function(t){return this.unselectFilter("page"),this.replaceFilter("q",t),this.loadIssues(),this.generateFilters()},o.prototype.removeFilter=function(t){return this.unselectFilter("page"),this.unselectFilter(t.dataType,t.id,!1,t.mode),this.loadIssues(),this.generateFilters()},o.prototype.addFilter=function(t){return this.unselectFilter("page"),this.selectFilter(t.category.dataType,t.filter.id,!1,t.mode),this.loadIssues(),this.generateFilters()},o.prototype.selectCustomFilter=function(t){var e=this.location.search().order_by;return e&&(t.filter.order_by=e),this.unselectFilter("page"),this.replaceAllFilters(t.filter),this.loadIssues(),this.generateFilters()},o.prototype.removeCustomFilter=function(e){return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.myFiltersHashSuffix).then((r=this,function(t){return delete t[e.id],r.filterRemoteStorageService.storeFilters(r.scope.projectId,t,r.myFiltersHashSuffix).then(r.generateFilters)}));var r},o.prototype.isFilterDataTypeSelected=function(t){for(var e=this.selectedFilters,r=0,n=e.length;r<n;r++)if(e[r].dataType===t)return!0;return!1},o.prototype.saveCustomFilter=function(e){for(var t,r,n,i={},o=this.location.search(),s=this.filterCategories,a=0,c=s.length;a<c;a++)r=s[a],t=this.excludePrefix.concat(r),i[r]=o[r],i[t]=o[t];return this.filterRemoteStorageService.getFilters(this.scope.projectId,this.myFiltersHashSuffix).then((n=this,function(t){return t[e]=i,n.filterRemoteStorageService.storeFilters(n.scope.projectId,t,n.myFiltersHashSuffix).then(n.generateFilters)}))},o.prototype.getQueryParams=function(){return _.pick(_.clone(this.location.search()),this.validQueryParams)},o.prototype.generateFilters=function(){var c,t,u,e,l,r,p,n=this.getQueryParams();for(this.storeFilters(this.params.pslug,n,this.filtersHashSuffix),(l={}).project=this.scope.projectId,l.q=n.q,t=0,e=(r=this.filterCategories).length;t<e;t++)u=r[t],c=this.excludePrefix.concat(u),l[u]=n[u],l[c]=n[c];return this.q.all([this.rs.issues.filtersData(l),this.filterRemoteStorageService.getFilters(this.scope.projectId,this.myFiltersHashSuffix)]).then((p=this,function(t){var e,r,n,i,o=t[0],s=t[1],a={};for(a.status=_.map(o.statuses,function(t){return t.id=t.id.toString(),t}),a.type=_.map(o.types,function(t){return t.id=t.id.toString(),t}),a.severity=_.map(o.severities,function(t){return t.id=t.id.toString(),t}),a.priority=_.map(o.priorities,function(t){return t.id=t.id.toString(),t}),a.tags=_.map(o.tags,function(t){return t.id=t.name,t}),t=_.filter(a.tags,function(t){return 0<t.count}),a.assigned_to=_.map(o.assigned_to,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.full_name||"Unassigned",t}),a.owner=_.map(o.owners,function(t){return t.id=t.id.toString(),t.name=t.full_name,t}),a.role=_.map(o.roles,function(t){return t.id?t.id=t.id.toString():t.id="null",t.name=t.name||"Unassigned",t}),p.selectedFilters=[],e=0,r=(n=p.filterCategories).length;e<r;e++)u=n[e],c=p.excludePrefix.concat(u),l[u]&&(i=p.formatSelectedFilters(u,a[u],l[u]),p.selectedFilters=p.selectedFilters.concat(i)),l[c]&&(i=p.formatSelectedFilters(u,a[u],l[c],"exclude"),p.selectedFilters=p.selectedFilters.concat(i));return p.filterQ=l.q,p.filters=[{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.TYPE"),dataType:"type",content:a.type},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.SEVERITY"),dataType:"severity",content:a.severity},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.PRIORITIES"),dataType:"priority",content:a.priority},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.STATUS"),dataType:"status",content:a.status},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.TAGS"),dataType:"tags",content:a.tags,hideEmpty:!0,totalTaggedElements:t.length},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.ASSIGNED_TO"),dataType:"assigned_to",content:a.assigned_to},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.ROLE"),dataType:"role",content:a.role},{title:p.translate.instant("COMMON.FILTERS.CATEGORIES.CREATED_BY"),dataType:"owner",content:a.owner}],p.customFilters=[],_.forOwn(s,function(t,e){return p.customFilters.push({id:e,name:e,filter:t})})}))},o.prototype.initializeSubscription=function(){var e,t="changes.project."+this.scope.projectId+".issues";return this.events.subscribe(this.scope,t,r(500,(e=this,function(t){return e.loadIssues()})))},o.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.is_issues_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.issueStatusById=e(t.issue_statuses,function(t){return t.id}),this.scope.issueStatusList=_.sortBy(t.issue_statuses,"order"),this.scope.severityById=e(t.severities,function(t){return t.id}),this.scope.severityList=_.sortBy(t.severities,"order"),this.scope.priorityById=e(t.priorities,function(t){return t.id}),this.scope.priorityList=_.sortBy(t.priorities,"order"),this.scope.issueTypes=_.sortBy(t.issue_types,"order"),this.scope.issueTypeById=e(t.issue_types,function(t){return t.id}),t},o.prototype.loadIssuesRequests=0,o.prototype.loadIssues=function(){var e,t=this.location.search(),r=this.rs.issues.list(this.scope.projectId,t);return this.loadIssuesRequests+=1,r.index=this.loadIssuesRequests,r.then((e=this,function(t){return r.index===e.loadIssuesRequests&&(e.scope.issues=t.models,e.scope.page=t.current,e.scope.count=t.count,e.scope.paginatedBy=t.paginatedBy),t})),r},o.prototype.loadInitialData=function(){var t=this.loadProject();return this.fillUsersAndRoles(t.members,t.roles),this.initializeSubscription(),this.generateFilters(),!1===this.rs.issues.getIssuesShowTags(this.scope.projectId)&&(this.showTags=!1),this.loadIssues()},o.prototype.addNewIssue=function(){var t=this.projectService.project.toJS();return this.rootscope.$broadcast("genericform:new",{objType:"issue",project:t})},o.prototype.addIssuesInBulk=function(){var t=this.projectService.project.toJS();return this.rootscope.$broadcast("issueform:bulk",t.id)},o.prototype.getIssuesOrderBy=function(){return _.isString(this.location.search().order_by)?this.location.search().order_by:"created_date"},n.controller("IssuesController",o),t=function(t,e,r,l){var p=r.get("issue/issue-paginator.html",!0),i=function(a,t,e,r){var c=t.find(".issues-paginator"),u=function(){var t=a.count/a.paginatedBy;return t=parseInt(t,10)<t?parseInt(t,10)+1:parseInt(t,10)},n=function(){var t,e,r,n,i,o,s=u();if(!(s<=1)){for(c.show(),(n={}).pages=i=[],n.showPrevious=1<a.page,n.showNext=!(a.page===s),t=a.page,e=r=1,o=s;1<=o?r<=o:o<=r;e=1<=o?++r:--r)e===t+2&&t+2+2<s||e===t-4&&6<t?i.push({classes:"dots",type:"dots"}):t+2<e&&e<=s-2||e<t-4&&2<e||(e===t?i.push({classes:"active",num:e,type:"page-active"}):i.push({classes:"page",num:e,type:"page"}));return n=p(n),n=l(n)(a),c.html(n)}c.hide()};return a.$watch("issues",function(t){if(t)return n()}),t.on("click",".issues-paginator a.next",function(t){return t.preventDefault(),a.$apply(function(){return r.selectFilter("page",a.page+1),r.loadIssues()})}),t.on("click",".issues-paginator a.previous",function(t){return t.preventDefault(),a.$apply(function(){return r.selectFilter("page",a.page-1),r.loadIssues()})}),t.on("click",".issues-paginator li.page > a",function(t){var e;return t.preventDefault(),t=angular.element(t.currentTarget),e=t.data("pagenum"),a.$apply(function(){return r.selectFilter("page",e),r.loadIssues()})})};return{link:function(t,e,r){var n=e.controller();return i(t,e,0,n),t.$on("$destroy",function(){return e.off()})}}},n.directive("tgIssuesPagination",["$log","$tgLocation","$tgTemplate","$compile",t]),t=function(t,e,r,u){var i=function(n,i,t,o){var s,a,c=o.getIssuesOrderBy();return c&&(a=l(c,"-")?"icon-arrow-up":"icon-arrow-down",(s=i.find(".row.title > div[data-fieldname='"+p(c,"-")+"']")).find("svg").addClass(a),u(s.contents())(n)),i.on("click",".row.title > div:not(.skip-order)",function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),c=o.getIssuesOrderBy(),"total_voters"===(t=r.data("fieldname"))&&"-total_voters"!==c&&(c="total_voters"),e=c===t?"-"+t:t,n.$apply(function(){var t;return o.replaceFilter("order_by",e),o.filtersHashSuffix&&(t=o.getQueryParams(),o.storeFilters(o.params.pslug,t,o.filtersHashSuffix)),o.loadIssues().then(function(){return i.find(".row.title svg").removeClass(),s=i.find(".row.title > div[data-fieldname='"+p(e,"-")+"']"),a=l(e,"-")?"icon-arrow-up":"icon-arrow-down",s.find("svg").addClass(a),u(r.contents())(n)})})})};return{link:function(t,e,r){var n=e.controller();return i(t,e,0,n),t.$on("$destroy",function(){return e.off()})}}},n.directive("tgIssuesOrdering",["$log","$tgLocation","$tgTemplate","$compile",t]),t=function(o,t,s){var e=t.get("issue/issue-status-inline-edition-selection.html",!0),a=function(t,e,r){var n=t.find(".issue-status"),t=t.find(".issue-status .issue-status-bind"),e=r[e.status];if(e)return t.text(e.name),t.prop("title",e.name),n.css("color",e.color)};return{link:function(r,n,t){n.controller();var i=r.$eval(t.tgIssueStatusInlineEdition);return n.on("click",".issue-status",function(t){return t.preventDefault(),t.stopPropagation(),n.find(".pop-status").popover().open()}),n.on("click",".status",function(t){var e;return t.preventDefault(),t.stopPropagation(),t=angular.element(t.currentTarget),i.status=t.data("status-id"),n.find(".pop-status").popover().close(),a(n,i,r.issueStatusById),e=i.attachments,r.$apply(function(){return o.save(i).then(function(t){return i.attachments=e,i._isModified=!1,i._attrs=_.extend(i.getAttrs(),i),i._modifiedAttrs={},s.$broadcast("status:changed",t)})})}),d.bindOnce(r,"project",function(t){if(n.append(e({statuses:t.issue_statuses})),a(n,i,r.issueStatusById),-1===t.my_permissions.indexOf("modify_issue"))return n.unbind("click"),n.find("a").addClass("not-clickable")}),r.$watch(t.tgIssueStatusInlineEdition,function(t){return a(n,t,r.issueStatusById)}),r.$on("$destroy",function(){return n.off()})}}},n.directive("tgIssueStatusInlineEdition",["$tgRepo","$tgTemplate","$rootScope",t]),t=function(s,a,c,u,l){var p=_.template('<img style="background-color: <%- bg %>" src="<%- imgurl %>" alt="<%- name %>"/>');return{link:function(n,i,t){var r=function(t){var e={name:c.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png"},r=n.usersById[t.assigned_to],t=u.getAvatar(r);return e.imgurl=t.url,e.bg=null,r&&(e.name=r.full_name_display,e.bg=t.bg),i.find(".avatar").html(p(e)),i.find(".issue-assignedto").attr("title",e.name)},o=(i.controller(),n.$eval(t.tgIssueAssignedToInlineEdition));return r(o),i.on("click",".issue-assignedto",function(t){var e=function(t){var e;return o.assigned_to=t.pop()||null,e=o.attachments,s.save(o).then(function(){return o.attachments=e,o._isModified=!1,o._attrs=_.extend(o.getAttrs(),o),o._modifiedAttrs={},r(o),a.$broadcast("assigned-to:changed",o)})};return l.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:[o.assigned_to],activeUsers:n.activeUsers,onClose:e,single:!0,lbTitle:c.instant("COMMON.ASSIGNED_USERS.ADD")})}),d.bindOnce(n,"project",function(t){if(-1===t.my_permissions.indexOf("modify_issue"))return i.unbind("click"),i.find("a").addClass("not-clickable")}),n.$watch(t.tgIssueAssignedToInlineEdition,r),n.$on("$destroy",function(){return i.off()})}}},n.directive("tgIssueAssignedToInlineEdition",["$tgRepo","$rootScope","$translate","tgAvatarService","tgLightboxFactory",t])}.call(this),function(){var k,e,t,r,n,i={}.hasOwnProperty;function o(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m,g,v,y,_,S){var b,j;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.log=c,this.appMetaService=u,this.navUrls=l,this.analytics=p,this.translate=d,this.modelTransform=h,this.errorHandlingService=f,this.configService=m,this.projectService=g,this.wysiwigService=v,this.attachmentsFullService=y,this.tgmodel=_,this.sce=S,k(this),this.scope.usRef=this.params.usref,this.scope.sectionName=this.translate.instant("US.SECTION_NAME"),this.scope.tribeEnabled=this.configService.config.tribeHost,this.scope.attachmentsReady=!1,this.scope.$on("attachments:loaded",(b=this,function(){return b.scope.attachmentsReady=!0})),this.initializeEventHandlers(),(S=this.loadInitialData()).then((j=this,function(){return j._setMeta(),j.initializeOnDeleteGoToUrl()})),S.then(null,this.onInitialDataError.bind(this))}n=this.taiga,t=this.taiga.mixOf,e=this.taiga.groupBy,this.taiga.bindOnce,k=this.taiga.bindMethods,r=angular.module("taigaUserStories"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,t(n.Controller,n.PageMixin)),o.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","$tgQueueModelTransformation","tgErrorHandlingService","$tgConfig","tgProjectService","tgWysiwygService","tgAttachmentsFullService","$tgModel","$sce"],o.prototype._setMeta=function(){var t,e,r=this.scope.tasks.length,n=_.filter(this.scope.tasks,(e=this,function(t){return e.scope.taskStatusById[t.status].is_closed})).length,i=0<r?Math.round(100*n/r):0,o=this.translate.instant("US.PAGE_TITLE",{userStoryRef:"#"+this.scope.us.ref,userStorySubject:this.scope.us.subject,projectName:this.scope.project.name}),s=this.sce.getTrustedHtml(this.wysiwigService.getHTML(this.scope.us.description)||""),i=this.translate.instant("US.PAGE_DESCRIPTION",{userStoryStatus:(null!=(t=this.scope.statusById[this.scope.us.status])?t.name:void 0)||"--",userStoryPoints:this.scope.us.total_points,userStoryDescription:angular.element(s).text(),userStoryClosedTasks:n,userStoryTotalTasks:r,userStoryProgressPercentage:i});return this.appMetaService.setAll(o,i)},o.prototype.loadAttachments=function(){return this.attachmentsFullService.loadAttachments("us",this.scope.usId,this.scope.projectId)},o.prototype.initializeEventHandlers=function(){var e,r,t,n,i;return this.scope.relateToEpic=(e=this,function(t){return e.scope.$broadcast("relate-to-epic:add",t)}),this.scope.$on("related-tasks:update",(r=this,function(){var t;if(r.loadTasks(),r.scope.tasks=_.clone(r.scope.tasks,!1),t=_.every(r.scope.tasks,function(t){return t.is_closed}),r.scope.us.is_closed!==t)return r.loadUs()})),this.scope.$on("attachment:create",(t=this,function(){return t.analytics.trackEvent("attachment","create","create attachment on userstory",1)})),this.scope.$on("task:reorder",(n=this,function(t,e,r){return n.reorderTask(e,r)})),this.scope.$on("comment:new",(i=this,function(){return i.loadUs()}))},o.prototype.initializeOnDeleteGoToUrl=function(){var t={project:this.scope.project.slug};return this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t),this.params["kanban-status"]&&this.scope.project.is_kanban_activated?this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-kanban",t):this.scope.project.is_backlog_activated?this.scope.us.milestone?(t.sprint=this.scope.sprint.slug,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-taskboard",t)):this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-backlog",t):void 0},o.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.statusList=t.us_statuses,this.scope.statusById=e(t.us_statuses,function(t){return t.id}),this.scope.taskStatusById=e(t.task_statuses,function(t){return t.id}),this.scope.pointsList=_.sortBy(t.points,"order"),this.scope.pointsById=e(this.scope.pointsList,function(t){return t.id}),t},o.prototype.loadUs=function(){var t,e,r={},n=this.location.search(),i=_.pick(n,"milestone","no-milestone");return Object.keys(n).forEach(function(t){if(t.startsWith("kanban-"))return r[t.replace("kanban-","")]=n[t]}),Object.keys(n).forEach(function(t){if(t.startsWith("backlog-"))return i[t.replace("backlog-","")]=n[t]}),(t=i.milestone)&&this.rs.userstories.storeQueryParams(this.scope.projectId,_.merge(i,{milestone:t,order_by:"sprint_order"})),i["no-milestone"]&&this.rs.userstories.storeQueryParams(this.scope.projectId,_.merge(i,{milestone:"null",order_by:"backlog_order"})),r.status&&this.rs.userstories.storeQueryParams(this.scope.projectId,_.merge(r,{order_by:"kanban_order"})),this.rs.userstories.getByRef(this.scope.projectId,this.params.usref).then((e=this,function(t){return e.rootscope.$broadcast("userstory:loaded",t),e.scope.us=t,e.scope.usId=t.id,e.scope.commentModel=t,e.loadAttachments(),window.legacyChannel.next({type:"SET_DETAIL_OBJ",value:t._attrs}),e.modelTransform.setObject(e.scope,"us"),t}))},o.prototype.loadSprint=function(){if(this.scope.us.milestone)return this.rs.sprints.get(this.scope.us.project,this.scope.us.milestone).then((e=this,function(t){return e.scope.sprint=t}));var e},o.prototype.loadTasks=function(){return this.rs.tasks.list(this.scope.projectId,null,this.scope.usId).then((e=this,function(t){return e.scope.tasks=t}));var e},o.prototype.loadInitialData=function(){var t,e=this.loadProject();return this.fillUsersAndRoles(e.members,e.roles),this.loadUs().then((t=this,function(){return t.q.all([t.loadSprint(),t.loadTasks()])}))},o.prototype.onUpvote=function(){var t,e,r=function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.userstories.upvote(this.scope.usId).then(r,n)},o.prototype.onDownvote=function(){var t,e,r=function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.userstories.downvote(this.scope.usId).then(r,n)},o.prototype.onWatch=function(){var t,e,r=function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.userstories.watch(this.scope.usId).then(r,n)},o.prototype.onUnwatch=function(){var t,e,r=function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.userstories.unwatch(this.scope.usId).then(r,n)},o.prototype.onTribeInfo=function(){var t=this.translate.instant("US.TRIBE.PUBLISH_MORE_INFO_TITLE"),e=$("<img />").attr({src:"/"+window._version+"/images/monster-fight.png",alt:this.translate.instant("US.TRIBE.PUBLISH_MORE_INFO_TITLE")}),r=this.translate.instant("US.TRIBE.PUBLISH_MORE_INFO_TEXT"),r=$("<div></div>").append(e).append(r);return this.confirm.success(t,r)},o.prototype.reorderTask=function(e,t){var r,n,i,o,s={};return this.scope.tasks.forEach(function(t){return s[t.id]=t.us_order}),n=(i=this.scope.tasks.filter(function(t){return t.id!==e.id})).slice(0,t),i=i.slice(t),t=(r=n[n.length-1])?r.us_order+1:0,s[e.id]=t,n=n.filter(function(t){return t.us_order===r.us_order}),n=_.fromPairs(n.map(function(t){return[t.id,t.us_order]})),i.forEach(function(t){return s[t.id]=t.us_order+1}),this.scope.tasks=_.map(this.scope.tasks,function(t){return t.us_order=s[t.id],t}),this.scope.tasks=_.sortBy(this.scope.tasks,"us_order"),t={us_order:t,version:e.version},this.rs.tasks.reorder(e.id,t,n).then((o=this,function(e){return e=o.tgmodel.make_model("tasks",e),o.scope.tasks=_.map(o.scope.tasks,function(t){return t.id===e.id?e:t}),o.rootscope.$broadcast("related-tasks:reordered")}))},r.controller("UserStoryDetailController",o),n=function(t,i){var o=t.get("common/components/status-display.html",!0);return{link:function(r,n,t){var e=function(t){var e=r.statusById[t.status],e=o({is_closed:t.is_closed,status:e});return e=i(e)(r),n.html(e)};return r.$watch(t.ngModel,function(t){if(null!=t)return e(t)}),r.$on("$destroy",function(){return n.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgUsStatusDisplay",["$tgTemplate","$compile",n]),n=function(a,t,c,u,l,e,p){var d=e.get("common/components/status-button.html",!0);return{link:function(e,i,t,r){var n=function(){return-1!==e.project.my_permissions.indexOf("modify_us")},o=function(t){var t=e.statusById[t.status],t=d({status:t,statuses:e.statusList,editable:n()});return i.html(t),p(i.contents())(e)},s=function(e){var t,r,n;return i.find(".pop-status").popover().close(),t=u().target(i.find(".js-edit-status")).start(),n=function(){return a.$broadcast("object:updated"),t.finish()},r=function(){return c.notify("error"),t.finish()},l.save(function(t){return t.status=e,t}).then(n,r)};return i.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),n())return i.find(".pop-status").popover().open()}),i.on("click",".status",function(t){if(t.preventDefault(),t.stopPropagation(),n())return t=angular.element(t.currentTarget).data("status-id"),s(t)}),e.$watch(function(){var t;return null!=(t=r.$modelValue)?t.status:void 0},function(){var t=r.$modelValue;if(t)return o(t)}),e.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgUsStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),n=function(a,t,c,u,l,e,p){var d=e.get("us/us-team-requirement-button.html",!0);return{link:function(e,n,t,r){var i=function(){return-1!==e.project.my_permissions.indexOf("modify_us")},o=function(t){var t={canEdit:i(),isRequired:t.team_requirement},t=d(t);return t=p(t)(e),n.html(t)},s=function(e){var t=u().target(n.find("label")).start(),r=l.save(function(t){return t.team_requirement=e,t});return r.then(function(){return t.finish(),a.$broadcast("object:updated")}),r.then(null,function(){return t.finish(),c.notify("error")})};return n.on("click",".team-requirement",function(t){var e;if(i())return e=!r.$modelValue.team_requirement,s(e)}),e.$watch(function(){var t;return null!=(t=r.$modelValue)?t.team_requirement:void 0},function(){var t=r.$modelValue;if(t)return o(t)}),e.$on("$destroy",function(){return n.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgUsTeamRequirementButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),n=function(a,t,c,u,l,e,p){var d=e.get("us/us-client-requirement-button.html",!0);return{link:function(e,n,t,r){var i=function(){return-1!==e.project.my_permissions.indexOf("modify_us")},o=function(t){var t={canEdit:i(),isRequired:t.client_requirement},t=p(d(t))(e);return n.html(t)},s=function(e){var t=u().target(n.find("label")).start(),r=l.save(function(t){return t.client_requirement=e,t});return r.then(function(){return t.finish(),a.$broadcast("object:updated")}),r.then(null,function(){return c.notify("error")})};return n.on("click",".client-requirement",function(t){var e;if(i())return e=!r.$modelValue.client_requirement,s(e)}),e.$watch(function(){var t;return null!=(t=r.$modelValue)?t.client_requirement:void 0},function(){var t=r.$modelValue;if(t)return o(t)}),e.$on("$destroy",function(){return n.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgUsClientRequirementButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n])}.call(this),function(){var _,e,t,r,n,i={}.hasOwnProperty;function o(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m,g){var v,y;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.log=c,this.appMetaService=u,this.navUrls=l,this.analytics=p,this.translate=d,this.modelTransform=h,this.errorHandlingService=f,this.projectService=m,this.attachmentsFullService=g,_(this),this.scope.taskRef=this.params.taskref,this.scope.sectionName=this.translate.instant("TASK.SECTION_NAME"),this.scope.attachmentsReady=!1,this.scope.$on("attachments:loaded",(v=this,function(){return v.scope.attachmentsReady=!0})),this.initializeEventHandlers(),(g=this.loadInitialData()).then((y=this,function(){return y._setMeta(),y.initializeOnDeleteGoToUrl()})),g.then(null,this.onInitialDataError.bind(this))}n=this.taiga,t=this.taiga.mixOf,e=this.taiga.groupBy,_=this.taiga.bindMethods,r=angular.module("taigaTasks"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,t(n.Controller,n.PageMixin)),o.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","$tgQueueModelTransformation","tgErrorHandlingService","tgProjectService","tgAttachmentsFullService"],o.prototype._setMeta=function(){var t=this.translate.instant("TASK.PAGE_TITLE",{taskRef:"#"+this.scope.task.ref,taskSubject:this.scope.task.subject,projectName:this.scope.project.name}),e=this.translate.instant("TASK.PAGE_DESCRIPTION",{taskStatus:(null!=(e=this.scope.statusById[this.scope.task.status])?e.name:void 0)||"--",taskDescription:angular.element(this.scope.task.description_html||"").text()});return this.appMetaService.setAll(t,e)},o.prototype.loadAttachments=function(){return this.attachmentsFullService.loadAttachments("task",this.scope.taskId,this.scope.projectId)},o.prototype.initializeEventHandlers=function(){var r,t,e,n;return this.scope.$on("promote-task-to-us:success",(r=this,function(t,e){return r.analytics.trackEvent("task","promoteToUserstory","promote task to userstory",1),e={project:r.scope.project.slug,ref:e},r.location.path(r.navUrls.resolve("project-userstories-detail",e))})),this.scope.$on("attachment:create",(t=this,function(){return t.analytics.trackEvent("attachment","create","create attachment on task",1)})),this.scope.$on("custom-attributes-values:edit",(e=this,function(){return e.rootscope.$broadcast("object:updated")})),this.scope.$on("comment:new",(n=this,function(){return n.loadTask()}))},o.prototype.initializeOnDeleteGoToUrl=function(){var t={project:this.scope.project.slug};return this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t),this.scope.project.is_backlog_activated?this.scope.task.milestone?(t.sprint=this.scope.sprint.slug,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-taskboard",t)):this.scope.task.us?(t.ref=this.scope.us.ref,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-userstories-detail",t)):void 0:this.scope.project.is_kanban_activated&&this.scope.us?(t.ref=this.scope.us.ref,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-userstories-detail",t)):void 0},o.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.statusList=t.task_statuses,this.scope.statusById=e(t.task_statuses,function(t){return t.id}),t},o.prototype.loadTask=function(){return this.rs.tasks.getByRef(this.scope.projectId,this.params.taskref).then((n=this,function(t){var e,r;return n.scope.task=t,n.scope.taskId=t.id,n.scope.commentModel=t,n.loadAttachments(),window.legacyChannel.next({type:"SET_DETAIL_OBJ",value:t._attrs}),n.modelTransform.setObject(n.scope,"task"),null!=(null!=(r=n.scope.task.neighbors.previous)?r.ref:void 0)&&(e={project:n.scope.project.slug,ref:n.scope.task.neighbors.previous.ref},n.scope.previousUrl=n.navUrls.resolve("project-tasks-detail",e)),null!=(null!=(r=n.scope.task.neighbors.next)?r.ref:void 0)&&(e={project:n.scope.project.slug,ref:n.scope.task.neighbors.next.ref},n.scope.nextUrl=n.navUrls.resolve("project-tasks-detail",e)),t}));var n},o.prototype.loadSprint=function(){if(this.scope.task.milestone)return this.rs.sprints.get(this.scope.task.project,this.scope.task.milestone).then((e=this,function(t){return e.scope.sprint=t}));var e},o.prototype.loadUserStory=function(){if(this.scope.task.user_story)return this.rs.userstories.get(this.scope.task.project,this.scope.task.user_story).then((e=this,function(t){return e.scope.us=t}));var e},o.prototype.loadInitialData=function(){var t,e=this.loadProject();return this.fillUsersAndRoles(e.members,e.roles),this.loadTask().then((t=this,function(){return t.q.all([t.loadSprint(),t.loadUserStory()])}))},o.prototype.onUpvote=function(){var t,e,r=function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.tasks.upvote(this.scope.taskId).then(r,n)},o.prototype.onDownvote=function(){var t,e,r=function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.tasks.downvote(this.scope.taskId).then(r,n)},o.prototype.onWatch=function(){var t,e,r=function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.tasks.watch(this.scope.taskId).then(r,n)},o.prototype.onUnwatch=function(){var t,e,r=function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")},n=function(){return e.confirm.notify("error")};return(e=t=this).rs.tasks.unwatch(this.scope.taskId).then(r,n)},r.controller("TaskDetailController",o),n=function(t,i){var o=t.get("common/components/status-display.html",!0);return{link:function(e,r,t){var n=function(t){var t=e.statusById[t.status],t=o({is_closed:t.is_closed,status:t});return t=i(t)(e),r.html(t)};return e.$watch(t.ngModel,function(t){if(null!=t)return n(t)}),e.$on("$destroy",function(){return r.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgTaskStatusDisplay",["$tgTemplate","$compile",n]),n=function(a,t,c,u,l,p,e,r){var d=r.get("common/components/status-button.html",!0);return{link:function(e,i,t,r){var n=function(){return-1!==e.project.my_permissions.indexOf("modify_task")},o=function(t){var t=e.statusById[t.status],t=p(d({status:t,statuses:e.statusList,editable:n()}))(e);return i.html(t)},s=function(e){var t=u().target(i).start(),r=function(){return a.$broadcast("object:updated"),t.finish()},n=function(){return c.notify("error"),t.finish()};return l.save(function(t){return t.status=e,t}).then(r,n)};return i.on("click",".js-edit-status",function(t){if(t.preventDefault(),t.stopPropagation(),n())return i.find(".pop-status").popover().open()}),i.on("click",".status",function(t){if(t.preventDefault(),t.stopPropagation(),n())return t=angular.element(t.currentTarget),$.fn.popover().closeAll(),s(t.data("status-id"))}),e.$watch(function(){var t;return null!=(t=r.$modelValue)?t.status:void 0},function(){var t=r.$modelValue;if(t)return o(t)}),e.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgTaskStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$translate","$tgTemplate",n]),n=function(a,t,c,u,l,p,e){var d=e.get("issue/iocaine-button.html",!0);return{link:function(e,n,t,r){var i=function(){return-1!==e.project.my_permissions.indexOf("modify_task")},o=function(t){if(i()||t.is_iocaine)return t={isIocaine:t.is_iocaine,isEditable:i()},t=p(d(t))(e),n.html(t);n.html("")},s=function(e){var t=u().target(n.find("label")).start(),r=l.save(function(t){return t.is_iocaine=e,t});return r.then(function(){return a.$broadcast("object:updated")}),r.then(null,function(){return c.notify("error")}),r.finally(function(){return t.finish()})};return n.on("click",".is-iocaine",function(t){var e;if(i())return e=!r.$modelValue.is_iocaine,s(e)}),e.$watch(function(){var t;return null!=(t=r.$modelValue)?t.is_iocaine:void 0},function(){var t=r.$modelValue;if(t)return o(t)}),e.$on("$destroy",function(){return n.off()})},restrict:"EA",require:"ngModel"}},r.directive("tgTaskIsIocaineButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$tgTemplate",n])}.call(this),function(){var t,e,r,s={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a,c,u,l,p,d){var h;this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.params=i,this.q=o,this.location=s,this.navUrls=a,this.appMetaService=c,this.auth=u,this.translate=l,this.projectService=p,this.errorHandlingService=d,this.scope.sectionName="TEAM.SECTION_NAME",(d=this.loadInitialData()).then((h=this,function(){var t=h.translate.instant("TEAM.PAGE_TITLE",{projectName:h.scope.project.name}),e=h.translate.instant("TEAM.PAGE_DESCRIPTION",{projectName:h.scope.project.name,projectDescription:h.scope.project.description});return h.appMetaService.setAll(t,e)})),d.then(null,this.onInitialDataError.bind(this))}r=this.taiga,t=this.taiga.mixOf,e=angular.module("taigaTeam"),function(t,e){for(var r in e)s.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(r.Controller,r.PageMixin)),n.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$routeParams","$q","$location","$tgNavUrls","tgAppMetaService","$tgAuth","$translate","tgProjectService","tgErrorHandlingService"],n.prototype.setRole=function(t){return this.scope.filtersRole=t||null},n.prototype.loadMembers=function(){var t,e,r,n,i=this.auth.getUser();for(this.scope.totals={},t=0,e=(n=this.scope.activeUsers).length;t<e;t++)r=n[t],this.scope.totals[r.id]=0;return this.scope.currentUser=_.find(this.scope.activeUsers,{id:null!=i?i.id:void 0}),this.scope.memberships=_.reject(this.scope.activeUsers,{id:null!=i?i.id:void 0})},n.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.issuesEnabled=t.is_issues_activated,this.scope.tasksEnabled=t.is_kanban_activated||t.is_backlog_activated,this.scope.wikiEnabled=t.is_wiki_activated,this.scope.owner=t.owner.id,t},n.prototype.loadMemberStats=function(){return this.rs.projects.memberStats(this.scope.projectId).then((i=this,function(n){return _.forEach(i.scope.totals,function(t,r){var e=_.map(n,function(t,e){return t[r]});return t=_.reduce(e,function(t,e){return t+e}),i.scope.totals[r]=t}),i.scope.stats=i._processStats(n),i.scope.stats.totals=i.scope.totals}));var i},n.prototype._processStat=function(t){var e,r,n=_.max(_.toArray(t)),i=_.min(_.toArray(t)),o=Object();for(e in t)s.call(t,e)&&(r=t[e],o[e]=r===i?.1:r===n?1:.5*r/n);return o},n.prototype._processStats=function(t){var e,r;for(e in t)r=t[e],t[e]=this._processStat(r);return t},n.prototype.loadInitialData=function(){var e,t=this.loadProject();return this.fillUsersAndRoles(t.members,t.roles),this.loadMembers(),e=_.map(this.scope.users,function(t){return t.role}),this.scope.roles=_.filter(this.scope.roles,function(t){return-1!==e.indexOf(t.id)}),this.loadMemberStats()},e.controller("TeamController",n),r=function(){return{templateUrl:"team/team-filter.html"}},e.directive("tgTeamFilters",[r]),r=function(){return{templateUrl:"team/team-member-stats.html",scope:{stats:"=",userId:"=user",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled"}}},e.directive("tgTeamMemberStats",r),r=function(){return{templateUrl:"team/team-member-current-user.html",scope:{project:"=project",currentUser:"=currentuser",stats:"=",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled",owner:"=owner"}}},e.directive("tgTeamCurrentUser",r),r=function(){return{templateUrl:"team/team-members.html",scope:{memberships:"=",filtersQ:"=filtersq",filtersRole:"=filtersrole",stats:"=",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled",owner:"=owner"}}},e.directive("tgTeamMembers",r),r=function(t,i,o,s,a,c,u,l){return{scope:{user:"=",project:"="},templateUrl:"team/leave-project.html",link:function(r,t,e){var n=function(){var t=c.instant("TEAM.ACTION_LEAVE_PROJECT"),e=c.instant("TEAM.CONFIRM_LEAVE_PROJECT");return i.ask(t,e).then(function(t){var e=s.projects.leave(r.project.id);return e.then(function(){return l.loadProjects().then(function(){return t.finish(),i.notify("success"),o.path(a.resolve("home"))})}),e.then(null,function(t){return t.finish(),i.notify("error",t.data._error_message)})})};return r.leave=function(){return r.project.owner.id===r.user.id?u.create("tg-lightbox-leave-project-warning",{class:"lightbox lightbox-leave-project-warning"},{isCurrentUser:!0,project:r.project}):n()}}}},e.directive("tgLeaveProject",["$tgRepo","$tgConfirm","$tgLocation","$tgResources","$tgNavUrls","$translate","tgLightboxFactory","tgCurrentUserService",r]),r=function(){return function(t,e,r){return _.filter(t,function(t){return(!r||t.role===r.id)&&(!e||0<=t.full_name.search(new RegExp(e,"i")))})}},e.filter("membersFilter",r)}.call(this),function(){function S(t,e){return function(){return t.apply(e,arguments)}}var t,e,r,i={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m,g,v){var y,_;this.scope=t,this.rootscope=e,this.repo=r,this.model=n,this.confirm=i,this.rs=o,this.params=s,this.q=a,this.location=c,this.filter=u,this.log=l,this.appMetaService=p,this.navUrls=d,this.analytics=h,this.translate=f,this.errorHandlingService=m,this.projectService=g,this.attachmentsFullService=v,this.moveLink=S(this.moveLink,this),this.loadWiki=S(this.loadWiki,this),this.scope.$on("wiki:links:move",this.moveLink),this.scope.$on("wikipage:add",this.loadWiki),this.scope.projectSlug=this.params.pslug,this.scope.wikiSlug=this.params.slug,this.scope.sectionName="Wiki",this.scope.linksVisible=!1,this.scope.attachmentsReady=!1,this.scope.$on("attachments:loaded",(y=this,function(){return y.scope.attachmentsReady=!0})),(v=this.loadInitialData()).then((_=this,function(){return _._setMeta()})),v.then(null,this.onInitialDataError.bind(this))}r=this.taiga,t=this.taiga.mixOf,this.taiga.groupBy,this.taiga.bindOnce,this.taiga.debounce,e=angular.module("taigaWiki"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(r.Controller,r.PageMixin)),n.$inject=["$scope","$rootScope","$tgRepo","$tgModel","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$filter","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","tgErrorHandlingService","tgProjectService","tgAttachmentsFullService"],n.prototype._setMeta=function(){var t=this.translate.instant("WIKI.PAGE_TITLE",{wikiPageName:this.scope.wikiSlug,projectName:this.scope.project.name}),e=this.translate.instant("WIKI.PAGE_DESCRIPTION",{wikiPageContent:angular.element((null!=(e=this.scope.wiki)?e.html:void 0)||"").text(),totalEditions:(null!=(e=this.scope.wiki)?e.editions:void 0)||0,lastModifiedDate:moment(null!=(e=this.scope.wiki)?e.modified_date:void 0).format(this.translate.instant("WIKI.DATETIME"))});return this.appMetaService.setAll(t,e)},n.prototype.loadAttachments=function(){return this.attachmentsFullService.loadAttachments("wikipage",this.scope.wikiId,this.scope.projectId)},n.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.is_wiki_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},n.prototype.loadWiki=function(){var e,r,t=this.rs.wiki.getBySlug(this.scope.projectId,this.params.slug);return t.then((e=this,function(t){return e.scope.wiki=t,e.scope.wikiId=t.id,e.loadAttachments(),e.scope.wiki})),t.then(null,(r=this,function(t){var e;return r.scope.wikiId=null,r.scope.attachmentsReady=!0,-1===r.scope.project.my_permissions.indexOf("add_wiki_page")?null:(e={project:r.scope.projectId,slug:r.scope.wikiSlug,content:""},r.scope.wiki=r.model.make_model("wiki",e),r.scope.wiki)}))},n.prototype.loadWikiLinks=function(){return this.rs.wiki.listLinks(this.scope.projectId).then((o=this,function(t){var e,r,n,i;for(o.scope.wikiLinks=t,e=0,r=(i=o.scope.wikiLinks).length;e<r;e++)(n=i[e]).url=o.navUrls.resolve("project-wiki-page",{project:o.scope.projectSlug,slug:n.href});return _.find(t,{href:o.scope.wikiSlug})}));var o},n.prototype.loadInitialData=function(){var t=this.loadProject();return this.fillUsersAndRoles(t.members,t.roles),this.q.all([this.loadWikiLinks(),this.loadWiki()]).then(this.checkLinksPerms.bind(this))},n.prototype.checkLinksPerms=function(){if(-1!==this.scope.project.my_permissions.indexOf("add_wiki_link")||-1!==this.scope.project.my_permissions.indexOf("view_wiki_links")&&this.scope.wikiLinks.length)return this.scope.linksVisible=!0},n.prototype.delete=function(){var n,t=this.translate.instant("WIKI.DELETE_LIGHTBOX_TITLE"),e=this.scope.wikiSlug;return this.confirm.askOnDelete(t,e).then((n=this,function(e){var t=function(){var t;return e.finish(),t={project:n.scope.projectSlug},n.location.path(n.navUrls.resolve("project-wiki",t)),n.confirm.notify("success"),n.loadWiki()},r=function(){return e.finish(!1),n.confirm.notify("error")};return n.repo.remove(n.scope.wiki).then(t,r)}))},n.prototype.moveLink=function(t,e,r){var n=this.scope.wikiLinks,i=n.indexOf(e);return n.splice(i,1),n.splice(r,0,e),_.each(n,function(t,e){return t.order=e}),this.repo.saveAll(n)},e.controller("WikiDetailController",n),r=function(o,t,s,a,c){var u=t.get("wiki/wiki-summary.html",!0);return{link:function(n,i,t,e){var r=function(t){var e,r;return null==n.usersById?o.error("WikiSummaryDirective requires userById set in scope."):r=n.usersById[t.last_modifier],e=c.getAvatar(r),r=void 0===r?{name:"unknown",avatar:e}:{name:r.full_name_display,avatar:e},r={totalEditions:t.editions,lastModifiedDate:moment(t.modified_date).format(a.instant("WIKI.DATETIME")),user:r},r=u(r),r=s(r)(n),i.html(r)};return n.$watch(t.ngModel,function(t){if(t)return r(t)}),n.$on("$destroy",function(){return i.off()})},restrict:"EA",require:"ngModel"}},e.directive("tgWikiSummary",["$log","$tgTemplate","$compile","$translate","tgAvatarService",r]),r=function(t,e,o,r,n,s,a,c){return{scope:!0,link:function(i,t,e){return i.editableDescription=!1,i.saveDescription=n.bindAdd(function(t,e){var r=function(t){return null==i.item.id&&(a.trackEvent("wikipage","create","create wiki page",1),i.$emit("wikipage:add"),i.editableDescription=-1!==i.project.my_permissions.indexOf("modify_wiki_page")),c.fetchEntries(!0),o.notify("success")},n=function(){return o.notify("error")};return i.item.content=t,(null!=i.item.id?s.save(i.item):s.create("wiki",i.item)).then(r,n).finally(e)}),i.uploadFiles=function(t,e){r.addAttachment(i.project.id,i.item.id,"wiki_page",t).then(function(t){return e({default:t.getIn(["file","url"])})})},i.$watch(e.model,function(t){if(t)return i.item=t,i.version=t.version,i.storageKey=i.project.id+"-"+t.id+"-wiki"}),i.$watch("project",function(t){if(t)return null!=i.item.id?i.editableDescription=-1!==t.my_permissions.indexOf("modify_wiki_page"):i.editableDescription=-1!==t.my_permissions.indexOf("add_wiki_page")})},template:'<div>\n    <tg-wysiwyg\n        ng-if="editableDescription"\n        html-read-mode="true"\n        placeholder="\'COMMON.DESCRIPTION.EMPTY \'| translate"\n        version=\'version\'\n        project="project"\n        storage-key=\'storageKey\'\n        content=\'item.content\'\n        on-save=\'saveDescription(text, cb)\'\n        on-upload-file=\'uploadFiles\'>\n    </tg-wysiwyg>\n\n    <div\n        class="wysiwyg"\n        ng-if="!editableDescription && item.content.length"\n        tg-bind-wysiwyg-html="item.content"></div>\n    <div\n        class="wysiwyg"\n        ng-if="!editableDescription && !item.content.length">\n        {{\'COMMON.DESCRIPTION.NO_DESCRIPTION\' | translate}}\n    </div>\n</div>'}},e.directive("tgWikiWysiwyg",["$tgQueueModelTransformation","$rootScope","$tgConfirm","tgAttachmentsFullService","$tgQqueue","$tgRepo","$tgAnalytics","tgActivityService",r])}.call(this),function(){this.taiga,this.taiga.mixOf,this.taiga.groupBy;var g=this.taiga.bindOnce,t=function(u,e,t,l,p,d,r,h,f){var m=r.get("wiki/wiki-nav.html",!0),n=function(o,s,t){var n,i,a,c=s.controller();return null==t.ngModel?e.error("WikiNavDirective: no ng-model attr is defined"):(o.project.my_permissions.indexOf("add_wiki_link"),i=null,a=function(t){var r,e;return n=-1<o.project.my_permissions.indexOf("add_wiki_link"),e=-1<o.project.my_permissions.indexOf("delete_wiki_link"),e=m({wikiLinks:t,projectSlug:o.projectSlug,addWikiLinkPermission:n,deleteWikiLinkPermission:e}),e=h(e)(o),s.off(),n&&i&&i.destroy(),s.html(e),n&&(r=null,e=s.find(".sortable"),(i=dragula([e[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:e[0],moves:function(t){return $(t).is("li")}})).on("dragend",function(t){var e;return t=(r=$(t)).scope().link,e=r.index(),o.$emit("wiki:links:move",t,e)}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&i.dragging}})),s.on("click",".add-button",function(t){return t.preventDefault(),s.find(".new").removeClass("hidden"),s.find(".new input").focus(),s.find(".add-button").hide()}),s.on("click",".js-delete-link",function(t){var r,e;return t.preventDefault(),t.stopPropagation(),e=angular.element(t.currentTarget),r=e.parents(".wiki-link").data("id"),t=f.instant("WIKI.DELETE_LINK_TITLE"),e=o.wikiLinks[r].title,l.askOnDelete(t,e).then(function(t){var e=u.remove(o.wikiLinks[r]);return e.then(function(){return(e=c.loadWikiLinks()).then(function(){return t.finish(),a(o.wikiLinks)}),e.then(null,function(){return t.finish()})}),e.then(null,function(){return t.finish(!1),l.notify("error")})})}),s.on("keyup",".new input",function(t){var r,n,e,i;return t.preventDefault(),13===t.keyCode?(i=angular.element(t.currentTarget),n=i.val(),r=d().target(s.find(".new")).start(),(e=u.create("wiki-links",{project:o.projectId,title:n})).then(function(){var t;return p.trackEvent("wikilink","create","create wiki link",1),(t=c.loadWikiLinks()).then(function(){return r.finish(),s.find(".new").addClass("hidden"),s.find(".new input").val(""),s.find(".add-button").show(),a(o.wikiLinks)}),t.then(null,function(){return r.finish(),s.find(".new").addClass("hidden"),s.find(".new input").val(""),s.find(".add-button").show(),l.notify("error","Error loading wiki links")})}),e.then(null,function(t){var e;return r.finish(),s.find(".new input").val(n),s.find(".new input").focus().select(),null!=(null!=t&&null!=(e=t.__all__)?e[0]:void 0)?l.notify("error","The link already exists"):l.notify("error")})):27===t.keyCode?(i=angular.element(t.currentTarget),s.find(".new").addClass("hidden"),s.find(".new input").val(""),s.find(".add-button").show()):void 0})},g(o,t.ngModel,a))};return{link:function(t,e,r){return n(t,e,r),t.$on("$destroy",function(){return e.off()})}}};angular.module("taigaWiki").directive("tgWikiNav",["$tgRepo","$log","$tgLocation","$tgConfirm","$tgAnalytics","$tgLoading","$tgTemplate","$compile","$translate",t])}.call(this),function(){var t,e,r,i={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.model=n,this.confirm=i,this.rs=o,this.params=s,this.q=a,this.navUrls=c,this.errorHandlingService=u,this.projectService=l,this.scope.projectSlug=this.params.pslug,this.scope.wikiSlug=this.params.slug,this.scope.sectionName="Wiki",this.scope.linksVisible=!1,this.loadInitialData().then(null,this.onInitialDataError.bind(this))}r=this.taiga,t=this.taiga.mixOf,e=angular.module("taigaWiki"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(r.Controller,r.PageMixin)),n.$inject=["$scope","$rootScope","$tgRepo","$tgModel","$tgConfirm","$tgResources","$routeParams","$q","$tgNavUrls","tgErrorHandlingService","tgProjectService"],n.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.is_wiki_activated||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},n.prototype.loadWikiPages=function(){var e;return this.rs.wiki.list(this.scope.projectId).then((e=this,function(t){return e.scope.wikipages=t}))},n.prototype.loadWikiLinks=function(){return this.rs.wiki.listLinks(this.scope.projectId).then((o=this,function(t){var e,r,n,i;for(o.scope.wikiLinks=t,e=0,r=(i=o.scope.wikiLinks).length;e<r;e++)(n=i[e]).url=o.navUrls.resolve("project-wiki-page",{project:o.scope.projectSlug,slug:n.href});return _.find(t,{href:o.scope.wikiSlug})}));var o},n.prototype.loadInitialData=function(){var t=this.loadProject();return this.fillUsersAndRoles(t.members,t.roles),this.q.all([this.loadWikiLinks(),this.loadWikiPages()]).then(this.checkLinksPerms.bind(this))},n.prototype.checkLinksPerms=function(){if(-1!==this.scope.project.my_permissions.indexOf("add_wiki_link")||-1!==this.scope.project.my_permissions.indexOf("view_wiki_links")&&this.scope.wikiLinks.length)return this.scope.linksVisible=!0},e.controller("WikiPagesListController",n)}.call(this),function(){var t,e,r;function n(t,e,r,n){this.rs=t,this.lightboxService=e,this.confirm=r,this.translate=n,this.users=[],this.q="",this.commentOpen=!1}this.taiga,this.taiga.debounce,r=this.taiga.normalizeString,t=function(){return{templateUrl:"admin/memberships-warning-message.html",scope:{project:"="}}},(e=angular.module("taigaKanban")).directive("tgLightboxAddMembersWarningMessage",[t]),t=function(r,n,i,o){return{link:function(t,e){return r.open(e),t.request=function(){return t.loading=!0,n.projects.transferRequest(t.projectId).then(function(){return t.loading=!1,r.close(e),i.notify("success",o.instant("ADMIN.PROJECT_PROFILE.REQUEST_OWNERSHIP_SUCCESS"))})}},templateUrl:"common/lightbox/lightbox-request-ownership.html"}},e.directive("tgLbRequestOwnership",["lightboxService","tgResources","$tgConfirm","$translate",t]),n.prototype.limit=3,n.prototype.filterUsers=function(t){var e=t.full_name_display.toUpperCase();return e=r(e),t=this.q.toUpperCase(),t=r(t),_.includes(e,t)},n.prototype.getUsers=function(){var t=this.users.length||this.q.length?this.users:this.activeUsers;return t=_.reject(t,{id:this.currentOwnerId}),t=_.reject(t,{selected:!0}),this.totalUsers=_.size(t),t.slice(0,this.limit)},n.prototype.userSearch=function(){if(this.users=this.activeUsers,this.selected=_.find(this.users,{selected:!0}),this.q)return this.users=_.filter(this.users,this.filterUsers.bind(this))},n.prototype.selectUser=function(t){return this.activeUsers=_.map(this.activeUsers,function(t){return t.selected=!1,t}),t.selected=!0,this.userSearch()},n.prototype.submit=function(){return this.loading=!0,this.rs.projects.transferStart(this.projectId,this.selected.id,this.comment).then((r=this,function(){var t,e;return r.loading=!1,r.lightboxService.closeAll(),e=r.translate.instant("ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_TITLE"),t=r.translate.instant("ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_DESC"),r.confirm.success(e,t,{type:"svg",name:"icon-speak-up"})}));var r},(t=n).$inject=["tgResources","lightboxService","$tgConfirm","$translate"],e.controller("ChangeOwnerLightbox",t),t=function(r,t,e,n){return{scope:!0,controller:"ChangeOwnerLightbox",controllerAs:"vm",bindToController:{currentOwnerId:"=",projectId:"=",activeUsers:"="},templateUrl:"common/lightbox/lightbox-change-owner.html",link:function(t,e){return r.open(e)}}},e.directive("tgLbChangeOwner",["lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile",t]),t=function(r){return{templateUrl:"common/lightbox/lightbox-transfer-project-start-success.html",link:function(t,e){return t.close=function(){return r.close(e)},r.open(e)}}},e.directive("tgLbTransferProjectStartSuccess",["lightboxService",t])}.call(this),function(){var y,t,e,r,i={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m){var g,v;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.analytics=u,this.appMetaService=l,this.translate=p,this.auth=d,this.lightboxFactory=h,this.errorHandlingService=f,this.projectService=m,y(this),this.scope.project={},this.scope.filters={},(m=this.loadInitialData()).then((g=this,function(){var t=g.translate.instant("ADMIN.MEMBERSHIPS.PAGE_TITLE",{projectName:g.scope.project.name}),e=g.scope.project.description;return g.appMetaService.setAll(t,e)})),m.then(null,this.onInitialDataError.bind(this)),this.scope.$on("membersform:new:success",(v=this,function(){return v.loadInitialData(),v.analytics.trackEvent("membership","create","create memberships on admin",1)}))}r=this.taiga,t=this.taiga.mixOf,y=this.taiga.bindMethods,e=angular.module("taigaAdmin"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(r.Controller,r.PageMixin,r.FiltersMixin)),n.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAnalytics","tgAppMetaService","$translate","$tgAuth","tgLightboxFactory","tgErrorHandlingService","tgProjectService"],n.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.canAddUsers=null===t.max_memberships||t.max_memberships>t.total_memberships,this.scope.$emit("project:loaded",t),t},n.prototype.loadMembers=function(){var e,t=this.getUrlFilters();return this.rs.memberships.list(this.scope.projectId,t).then((e=this,function(t){return e.scope.memberships=_.filter(t.models,function(t){return null===t.user||t.is_user_active}),_.map(e.scope.memberships,function(t){if(t.is_owner)return e.scope.projectOwnerEmail=t.user_email}),e.scope.page=t.current,e.scope.count=t.count,e.scope.paginatedBy=t.paginatedBy,t}))},n.prototype.loadInitialData=function(){return this.loadProject(),this.q.all([this.loadMembers(),this.auth.refresh()])},n.prototype.getUrlFilters=function(){var t=_.pick(this.location.search(),"page");return t.page||(t.page=1),t},n.prototype.addNewMembers=function(){return this.lightboxFactory.create("tg-lb-add-members",{class:"lightbox lightbox-add-member",project:"project"},{project:this.scope.project})},n.prototype.showLimitUsersWarningMessage=function(){var t=this.translate.instant("ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING"),e=this.translate.instant("ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING_MESSAGE",{members:this.scope.project.max_memberships}),r="/"+window._version+"/svg/icons/team-question.svg";return this.confirm.success(t,e,{name:r,type:"img"})},e.controller("MembershipsController",n),r=function(t,l){var p=t.get("admin/admin-membership-paginator.html",!0),i=function(a,t,e,r){var c=t.find(".memberships-paginator"),u=function(){var t=a.count/a.paginatedBy;return t=parseInt(t,10)<t?parseInt(t,10)+1:parseInt(t,10)},n=function(){var t,e,r,n,i,o,s=u();if(!(s<=1)){for((n={}).pages=i=[],n.showPrevious=1<a.page,n.showNext=!(a.page===s),t=a.page,e=r=1,o=s;1<=o?r<=o:o<=r;e=1<=o?++r:--r)e===t+2&&t+2+2<s||e===t-4&&6<t?i.push({classes:"dots",type:"dots"}):t+2<e&&e<=s-2||e<t-4&&2<e||(e===t?i.push({classes:"active",num:e,type:"page-active"}):i.push({classes:"page",num:e,type:"page"}));return n=p(n),n=l(n)(a),c.html(n),c.show()}c.hide()};return a.$watch("memberships",function(t){if(t)return n()}),t.on("click",".memberships-paginator a.next",function(t){return t.preventDefault(),a.$apply(function(){return r.selectFilter("page",a.page+1),r.loadMembers()})}),t.on("click",".memberships-paginator a.previous",function(t){return t.preventDefault(),a.$apply(function(){return r.selectFilter("page",a.page-1),r.loadMembers()})}),t.on("click",".memberships-paginator li.page > a",function(t){var e;return t.preventDefault(),t=angular.element(t.currentTarget),e=t.data("pagenum"),a.$apply(function(){return r.selectFilter("page",e),r.loadMembers()})})};return{link:function(t,e,r){var n=e.controller();return i(t,e,0,n),t.$on("$destroy",function(){return e.off()})}}},e.directive("tgMemberships",["$tgTemplate","$compile",r]),r=function(o,t,s,a,c){var u=t.get("admin/memberships-row-avatar.html",!0);return{link:function(r,n,t){var i=s.instant("ADMIN.MEMBERSHIP.STATUS_PENDING"),e=function(t){var e=c.getAvatar(t),t={full_name:t.full_name||"",email:t.user_email||t.email,imgurl:e.url,bg:e.bg,pending:t.is_user_active?"":i,isOwner:t.is_owner},t=u(t);return t=a(t)(r),n.html(t)};return null==t.tgMembershipsRowAvatar?o.error("MembershipsRowAvatarDirective: the directive need a member"):(e(r.$eval(t.tgMembershipsRowAvatar)),r.$on("$destroy",function(){return n.off()}))}}},e.directive("tgMembershipsRowAvatar",["$log","$tgTemplate","$translate","$compile","tgAvatarService",r]),r=function(r,o,s,t,a){var c=t.get("admin/admin-memberships-row-checkbox.html",!0);return{link:function(e,n,t){var i;return e.$on("$destroy",function(){return n.off()}),null==t.tgMembershipsRowAdminCheckbox?r.error("MembershipsRowAdminCheckboxDirective: the directive need a member"):(i=e.$eval(t.tgMembershipsRowAdminCheckbox)).is_owner?void n.find(".js-check").remove():(t=function(t){var t={inputId:"is-admin-"+t.id},t=c(t);return t=a(t)(e),n.html(t)},n.on("click",":checkbox",function(t){var e=function(){return s.notify("success")},r=function(t){return i.revert(),n.find(":checkbox").prop("checked",i.is_admin),s.notify("error",t.is_admin[0])},t=angular.element(t.currentTarget);return i.is_admin=t.prop("checked"),o.save(i).then(e,r)}),t(i),i.is_admin?n.find(":checkbox").prop("checked",!0):void 0)}}},e.directive("tgMembershipsRowAdminCheckbox",["$log","$tgRepo","$tgConfirm","$tgTemplate","$compile",r]),r=function(o,s,a){var c=_.template('<select>\n    <% _.each(roleList, function(role) { %>\n    <option value="<%- role.id %>" <% if(selectedRole === role.id){ %>selected="selected"<% } %>>\n        <%- role.name %>\n    </option>\n    <% }); %>\n</select>');return{link:function(e,r,t){var n,i=function(t){var t={roleList:e.project.roles,selectedRole:t.role},t=c(t);return r.html(t)};return null==t.tgMembershipsRowRoleSelector?o.error("MembershipsRowRoleSelectorDirective: the directive need a member"):(r.controller(),i(n=e.$eval(t.tgMembershipsRowRoleSelector)),r.on("change","select",function(t){var e=function(){return a.notify("success")},r=function(){return a.notify("error")},t=angular.element(t.currentTarget),t=parseInt(t.val(),10);if(n.role!==t)return n.role=t,s.save(n).then(e,r)}),e.$on("$destroy",function(){return r.off()}))}}},e.directive("tgMembershipsRowRoleSelector",["$log","$tgRepo","$tgConfirm",r]),r=function(a,c,u,l,p,d,h,f,m,g){return{link:function(i,e,t){var o,r,s,n=function(t){t=(t.user?p('<div class="active"\n     translate="ADMIN.MEMBERSHIP.STATUS_ACTIVE">\n</div>\n<a class="delete" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.DELETE_MEMBER\' | translate }}">\n    <tg-svg svg-icon="icon-trash"></tg-svg>\n</a>'):p('<a class="resend js-resend" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.RESEND\' | translate }}"\n   translate="ADMIN.MEMBERSHIP.RESEND">\n</a>\n<a class="delete" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.DELETE_MEMBER\' | translate }}">\n    <tg-svg svg-icon="icon-trash"></tg-svg>\n</a>'))(i);return e.html(t)};return null==t.tgMembershipsRowActions?a.error("MembershipsRowActionsDirective: the directive need a member"):(o=e.controller(),n(s=i.$eval(t.tgMembershipsRowActions)),e.on("click",".js-resend",function(t){var e;return t.preventDefault(),e=function(){var t=d.instant("ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION",{email:i.member.email});return l.notify("success",t)},t=function(){var t=d.instant("ADMIN.MEMBERSHIP.ERROR_SEND_INVITATION");return l.notify("error",t)},u.memberships.resendInvitation(i.member.id).then(e,t)}),r=function(){var t=d.instant("ADMIN.MEMBERSHIP.DELETE_MEMBER"),e=d.instant("ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE",{email:s.email}),n=s.user?s.full_name:e;return l.askOnDelete(t,n).then(function(e){var t=function(){var t;return e.finish(),s.user!==i.user.id?(1<i.page&&i.count-1<=i.paginatedBy&&o.selectFilter("page",i.page-1),g.fetchProject().then(function(){return o.loadInitialData()})):h.path(f.resolve("home")),t=d.instant("ADMIN.MEMBERSHIP.SUCCESS_DELETE",{message:n}),l.notify("success",t,null,5e3)},r=function(){var t;return e.finish(!1),t=d.instant("ADMIN.MEMBERSHIP.ERROR_DELETE",{message:n}),l.notify("error",t)};return c.remove(s).then(t,r)})},e.on("click",".delete",function(t){return t.preventDefault(),i.project.owner.id===s.user?(t=i.user.id===s.user,m.create("tg-lightbox-leave-project-warning",{class:"lightbox lightbox-leave-project-warning"},{isCurrentUser:t,project:i.project})):r()}),i.$on("$destroy",function(){return e.off()}))}}},e.directive("tgMembershipsRowActions",["$log","$tgRepo","$tgResources","$tgConfirm","$compile","$translate","$tgLocation","$tgNavUrls","tgLightboxFactory","tgProjectService",r]),r=function(){return{templateUrl:"admin/no-more-memberships-explanation.html",scope:{project:"=",ownerEmail:"="}}},e.directive("tgNoMoreMembershipsExplanation",[r])}.call(this),function(){var t=function(){return{link:function(t,e,r){r=r.tgAdminNavigation;return e.find(".active").removeClass("active"),e.find("#adminmenu-"+r).addClass("active"),t.$on("$destroy",function(){return e.off()})}}};angular.module("taigaAdmin").directive("tgAdminNavigation",t)}.call(this),function(){function t(t,e){for(var r in e)c.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}function a(t,e){return function(){return t.apply(e,arguments)}}var e,U,r,n,i,o,s,c={}.hasOwnProperty;function u(t,e,r,n,i,o,s,a,c,u,l,p,d,h,f,m){var g,v;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.appMetaService=u,this.translate=l,this.tgAuth=p,this.currentUserService=d,this.errorHandlingService=h,this.projectService=f,this.model=m,this.scope.project={},this.scope.projectTags=[],(m=this.loadInitialData()).then((g=this,function(){var t=g.translate.instant(g.scope.sectionName),e=g.translate.instant("ADMIN.PROJECT_PROFILE.PAGE_TITLE",{sectionName:t,projectName:g.scope.project.name}),t=g.scope.project.description;return g.appMetaService.setAll(e,t),g.fillUsersAndRoles(g.scope.project.members,g.scope.project.roles)})),m.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:loaded",(v=this,function(){var t=v.translate.instant(v.scope.sectionName),e=v.translate.instant("ADMIN.PROJECT_PROFILE.PAGE_TITLE",{sectionName:t,projectName:v.scope.project.name}),t=v.scope.project.description;return v.appMetaService.setAll(e,t)}))}function l(t,e,r,n,i,o){var s;this.scope=t,this.rootscope=e,this.urls=r,this.confirm=n,this.rs=i,this.translate=o,this._deleteUuid=a(this._deleteUuid,this),this._generateUuid=a(this._generateUuid,this),this.setCsvUuid=a(this.setCsvUuid,this),this.rootscope.$on("project:loaded",this.setCsvUuid),this.scope.$watch("csvUuid",(s=this,function(t){return s.scope.csvUrl=t?s.urls.resolveAbsolute(s.type+"-csv",t):""}))}function p(){return p.__super__.constructor.apply(this,arguments)}function d(){return d.__super__.constructor.apply(this,arguments)}function h(){return h.__super__.constructor.apply(this,arguments)}function f(){return f.__super__.constructor.apply(this,arguments)}i=this.taiga,s=this.taiga.mixOf,n=this.taiga.scopeDefer,this.taiga.trim,this.taiga.toString,this.taiga.joinStr,this.taiga.groupBy,this.taiga.bindOnce,U=this.taiga.debounce,r=angular.module("taigaAdmin"),o=s(i.Controller,i.PageMixin),t(u,o),u.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","$tgAuth","tgCurrentUserService","tgErrorHandlingService","tgProjectService","$tgModel"],u.prototype.loadProject=function(){var t,e,r=this.projectService.project.toJS();return(r=this.model.make_model("projects",r)).i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=r.id,this.scope.project=r,this.scope.epicStatusList=_.sortBy(r.epic_statuses,"order"),this.scope.usStatusList=_.sortBy(r.us_statuses,"order"),this.scope.pointsList=_.sortBy(r.points,"order"),this.scope.taskStatusList=_.sortBy(r.task_statuses,"order"),this.scope.issueTypesList=_.sortBy(r.issue_types,"order"),this.scope.issueStatusList=_.sortBy(r.issue_statuses,"order"),this.scope.prioritiesList=_.sortBy(r.priorities,"order"),this.scope.severitiesList=_.sortBy(r.severities,"order"),n(this.scope,(t=this,function(){return t.scope.$emit("project:loaded",r)})),this.scope.projectTags=_.map(this.scope.project.tags,(e=this,function(t){return[t,e.scope.project.tags_colors[t]]})),r},u.prototype.loadInitialData=function(){return this.loadProject(),this.scope.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects().valid,this.tgAuth.refresh()},u.prototype.openDeleteLightbox=function(){return this.rootscope.$broadcast("deletelightbox:new",this.scope.project)},u.prototype.addTag=function(t,e){var r=_.clone(this.scope.project.tags);return r.push(t),this.scope.projectTags.push([t,null]),this.scope.project.tags=r},u.prototype.deleteTag=function(e){var t=_.clone(this.scope.project.tags);return _.pull(t,e[0]),_.remove(this.scope.projectTags,function(t){return t[0]===e[0]}),this.scope.project.tags=t},r.controller("ProjectProfileController",u),e=function(a,c,u,l,p,d,h,f){return{link:function(n,t,e){var i=t.controller(),o=t.find("form").checksley({onlyOneErrorElement:!0}),r=U(2e3,function(t){var e,r;if(t.preventDefault(),o.validate())return e=u().target(s).start(),r=n.project.isAttributeModified("is_private"),(t=a.save(n.project)).then(function(){var t;return e.finish(),r&&n.project.is_private?f.trackEvent("project-privacy-changed","from-public-to-private","Change project privacy from public to private",1):r&&!n.project.is_private&&f.trackEvent("project-privacy-changed","from-private-to-public","Change project privacy from private to public",1),c.notify("success"),t=l.resolve("project-admin-project-profile-details",{project:n.project.slug}),p.path(t),d.fetchProject().then(function(){return i.loadInitialData()}),h.loadProjects()}),t.then(null,function(t){if(e.finish(),o.setErrors(t),t._error_message)return c.notify("error",t._error_message)})}),s=t.find(".submit-button");return t.on("submit","form",r)}}},r.directive("tgProjectProfile",["$tgRepo","$tgConfirm","$tgLoading","$tgNavUrls","$tgLocation","tgProjectService","tgCurrentUserService","$tgAnalytics",e]),s=function(s,a,c,u){return{link:function(r,t,e){var n=t.find("form").checksley({onlyOneErrorElement:!0}),i=U(2e3,function(t){var e;if(t.preventDefault(),n.validate())return e=u().target(o).start(),(t=a.save(r.project)).then(function(){return e.finish(),c.notify("success"),s.$broadcast("admin:project-default-values:updated")}),t.then(null,function(t){if(e.finish(),n.setErrors(t),t._error_message)return c.notify("error",t._error_message)})}),o=t.find(".submit-button");return t.on("submit","form",i),r.$on("$destroy",function(){return t.off()})}}},r.directive("tgProjectDefaultValues",["$rootScope","$tgRepo","$tgConfirm","$tgLoading",s]),o=function(o,s,a,t){return{link:function(r,n,t){var i=function(){var t,e=n.find("form").checksley();if(e.initializeFields(),e.reset(),e.validate())return(t=s.save(r.project)).then(function(){return r.$emit("project:loaded",r.project),o.$broadcast("admin:project-modules:updated"),a.notify("success")}),t.then(null,function(t){if(e.setErrors(t),t._error_message)return a.notify("error",t._error_message)})};return n.on("change",".module-activation.module-direct-active input",function(t){return t.preventDefault(),r.$applyAsync(i)}),n.on("submit","form",function(t){return t.preventDefault(),i()}),n.on("click",".save",function(t){return t.preventDefault(),i()}),n.on("keydown",".videoconference-attributes input",function(t){return 32!==t.which}),r.$watch("project.videoconferences",function(t,e){if(null!=t&&null!=e&&t!==e)return r.project.videoconferences_extra_data=""}),r.$watch("isVideoconferenceActivated",function(t,e){if(!1===t&&(r.project.videoconferences=null,!(r.project.videoconferences_extra_data="")===e))return i()}),r.$watch("project",function(t){return null!=t.videoconferences?r.isVideoconferenceActivated=!0:r.isVideoconferenceActivated=!1})}}},r.directive("tgProjectModules",["$rootScope","$tgRepo","$tgConfirm","$tgLoading",o]),e=function(w,P,A,O,R){return{link:function(r,t,e){var n=t.find(".admin-project-export-buttons"),i=function(){return n.removeClass("hidden")},o=function(){return n.addClass("hidden")},s=t.find(".admin-project-export-result"),a=function(){return s.removeClass("hidden")},c=function(){return s.addClass("hidden")},u=t.find(".spin"),l=function(){return u.removeClass("hidden")},p=function(){return u.addClass("hidden")},d=t.find(".result-title"),h=O.instant("ADMIN.PROJECT_EXPORT.LOADING_TITLE"),f=O.instant("ADMIN.PROJECT_EXPORT.LOADING_MESSAGE"),m=function(){return d.html(O.instant("ADMIN.PROJECT_EXPORT.DUMP_READY"))},g=function(){return d.html(O.instant("ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE"))},v=function(t){return d.html(O.instant("ADMIN.PROJECT_EXPORT.SYNC_MESSAGE",{url:t}))},y=function(){return d.html(h)},_=function(){return d.html(f)},S=function(){return d.html(m)},b=t.find(".result-message "),j=function(){return b.html(f)},k=function(){return b.html(g)},I=function(t){return b.html(v(t))},$=function(){return l(),y(),j(),o(),a()},E=function(){return p(),_(),k()},T=function(t){return p(),S(),I(t)},C=function(){return p(),c(),i()};return t.on("click",".button-export",U(2e3,function(t){var e;return t.preventDefault(),e=function(t){return R.trackEvent("exporter","export-project","Exported project",1),202===t.status?E():(t=t.data.url,T(t),w.open(t,"_blank"))},t=function(t){var e,r;return C(),e=O.instant("ADMIN.PROJECT_EXPORT.ERROR"),429===t.status?e=O.instant("ADMIN.PROJECT_EXPORT.ERROR_BUSY"):null!=(r=t.data)&&r._error_message&&(e=O.instant("ADMIN.PROJECT_EXPORT.ERROR_BUSY",{message:t.data._error_message})),A.notify("error",e)},$(),P.projects.export(r.projectId).then(e,t)}))}}},r.directive("tgProjectExport",["$window","$tgResources","$tgConfirm","$translate","$tgAnalytics",e]),s=i.Controller,t(l,s),l.$inject=["$scope","$rootScope","$tgUrls","$tgConfirm","$tgResources","$translate"],l.prototype.setCsvUuid=function(){return this.scope.csvUuid=this.scope.project[this.type+"_csv_uuid"]},l.prototype._generateUuid=function(t){var e,r,n;return null==t&&(t=null),(e=this.rs.projects["regenerate_"+this.type+"_csv_uuid"](this.scope.projectId)).then((r=this,function(t){return r.scope.csvUuid=null!=(t=t.data)?t.uuid:void 0})),e.then(null,(n=this,function(){return n.confirm.notify("error")})),e.finally(function(){if(t)return t.finish()}),e},l.prototype._deleteUuid=function(t){var e,r,n;return null==t&&(t=null),(e=this.rs.projects["delete_"+this.type+"_csv_uuid"](this.scope.projectId)).then((r=this,function(t){return r.scope.csvUuid=null!=(t=t.data)?t.uuid:void 0})),e.then(null,(n=this,function(){return n.confirm.notify("error")})),e.finally(function(){if(t)return t.finish()}),e},l.prototype.regenerateUuid=function(){var t,e;return this.scope.csvUuid?(e=this.translate.instant("ADMIN.REPORTS.REGENERATE_TITLE"),t=this.translate.instant("ADMIN.REPORTS.REGENERATE_SUBTITLE"),this.confirm.ask(e,t).then(this._generateUuid)):this._generateUuid()},l.prototype.deleteUuid=function(){var t,e;return this.scope.csvUuid?(e=this.translate.instant("ADMIN.REPORTS.DELETE_TITLE"),t=this.translate.instant("ADMIN.REPORTS.DELETE_SUBTITLE"),this.confirm.ask(e,t).then(this._deleteUuid)):this._deleteUuid()},t(p,o=l),p.prototype.type="epics",e=p,t(d,o),d.prototype.type="userstories",i=d,t(h,o),h.prototype.type="tasks",s=h,t(f,o),f.prototype.type="issues",o=f,r.controller("CsvExporterEpicsController",e),r.controller("CsvExporterUserstoriesController",i),r.controller("CsvExporterTasksController",s),r.controller("CsvExporterIssuesController",o),o=function(t){return{controller:"CsvExporterEpicsController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_EPIC"},scope:!0}},r.directive("tgCsvEpic",["$translate",o]),o=function(t){return{controller:"CsvExporterUserstoriesController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_US"},scope:!0}},r.directive("tgCsvUs",["$translate",o]),o=function(t){return{controller:"CsvExporterTasksController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_TASK"},scope:!0}},r.directive("tgCsvTask",["$translate",o]),o=function(t){return{controller:"CsvExporterIssuesController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_ISSUE"},scope:!0}},r.directive("tgCsvIssue",["$translate",o]),o=function(t,s,a,c){return{link:function(e,r,t){var n=function(){return r.find(".size-info").addClass("active")},i=function(t){t=s.make_model("projects",t.data);return e.project=t,r.find(".loading-overlay").removeClass("active"),c.notify("success")},o=function(t){return 413===t.status&&n(),r.find(".loading-overlay").removeClass("active"),c.notify("error",t.data._error_message)};return r.on("click",".js-change-logo",function(){return r.find("#logo-field").click()}),r.on("change","#logo-field",function(t){if(e.logoAttachment)return r.find(".loading-overlay").addClass("active"),a.projects.changeLogo(e.project.id,e.logoAttachment).then(i,o)}),r.on("click","a.js-use-default-logo",function(t){return r.find(".loading-overlay").addClass("active"),a.projects.removeLogo(e.project.id).then(i,o)}),e.$on("$destroy",function(){return r.off()})}}},r.directive("tgProjectLogo",["$tgAuth","$tgModel","$tgResources","$tgConfirm",o]),o=function(i){return{link:function(t,e,r){var n=i(r.tgProjectLogoModel).assign;return e.bind("change",function(){return t.$apply(function(){return n(t,e[0].files[0])})})}}},r.directive("tgProjectLogoModel",["$parse",o]),o=function(){return{scope:{project:"="},templateUrl:"admin/admin-project-restrictions.html"}},r.directive("tgAdminProjectRestrictions",[o]),o=function(e){return{link:function(t){return t.requestOwnership=function(){if(t.canRequest)return e.create("tg-lb-request-ownership",{class:"lightbox lightbox-request-ownership"},{projectId:t.projectId})}},scope:{canRequest:"=",projectId:"=",owner:"="},templateUrl:"admin/admin-project-request-ownership.html"}},r.directive("tgAdminProjectRequestOwnership",["tgLightboxFactory",o]),o=function(e){return{link:function(t){return t.changeOwner=function(){return e.create("tg-lb-change-owner",{class:"lightbox lightbox-select-user","project-id":"projectId","active-users":"activeUsers","current-owner-id":"currentOwnerId"},{projectId:t.projectId,activeUsers:t.activeUsers,currentOwnerId:t.owner.id,members:t.members})}},scope:{activeUsers:"=",projectId:"=",owner:"=",members:"="},templateUrl:"admin/admin-project-change-owner.html"}},r.directive("tgAdminProjectChangeOwner",["tgLightboxFactory",o])}.call(this),function(){function t(t,e){for(var r in e)a.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var s,d,P,e,r,n,i,o,a={}.hasOwnProperty,h=function(t,e){return function(){return t.apply(e,arguments)}};function c(t,e,r,n,i,o,s,a,c,u,l,p,d){var h;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.appMetaService=u,this.translate=l,this.errorHandlingService=p,this.projectService=d,this.scope.project={},this.scope.$on("project:load",(h=this,function(){return h.projectService.fetchProject().then(function(){return h.loadProject()})})),this.loadInitialData(),p=this.translate.instant(this.scope.sectionName),d=this.translate.instant("ADMIN.PROJECT_VALUES.PAGE_TITLE",{sectionName:p,projectName:this.scope.project.name}),p=this.scope.project.description,this.appMetaService.setAll(d,p)}function u(t,e,r,n,i){var o,s;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.moveValue=h(this.moveValue,this),this.loadValues=h(this.loadValues,this),this.scope.$on("admin:project-values:move",this.moveValue),o=this.scope.$watch("resource",(s=this,function(t){if(t)return s.loadValues(),o()}))}function l(t,e,r,n,i,o,s){var a,c,u;this.scope=t,this.rootscope=e,this.repo=r,this.translate=n,this.confirm=i,this.rs=o,this.projectService=s,this.removeSwimlane=h(this.removeSwimlane,this),this.loadSwimlanes=h(this.loadSwimlanes,this),this.filterArchivedSwimlaneStatus=h(this.filterArchivedSwimlaneStatus,this),this.filterArchivedProjectStatuses=h(this.filterArchivedProjectStatuses,this),this.updatedSwimlanePosition=h(this.updatedSwimlanePosition,this),this.setDefaultSwimlane=h(this.setDefaultSwimlane,this),this.updateSwimlane=h(this.updateSwimlane,this),this.addSwimlane=h(this.addSwimlane,this),this.scope.$on("swimlane:load",(c=this,function(){return c.loadSwimlanes()})),a=this.scope.$watch("resource",(u=this,function(t){if(t)return u.loadSwimlanes(),a()}))}function p(){return this.displayValues=h(this.displayValues,this),this.createDefaultValues=h(this.createDefaultValues,this),this.loadValues=h(this.loadValues,this),p.__super__.constructor.apply(this,arguments)}function f(t,e,r,n,i,o,s,a,c,u,l){var p;this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.params=i,this.q=o,this.location=s,this.navUrls=a,this.appMetaService=c,this.translate=u,this.projectService=l,this.moveCustomAttributes=h(this.moveCustomAttributes,this),this.deleteCustomAttribute=h(this.deleteCustomAttribute,this),this.saveCustomAttribute=h(this.saveCustomAttribute,this),this.createCustomAttribute=h(this.createCustomAttribute,this),this.loadCustomAttributes=h(this.loadCustomAttributes,this),this._onCustomAttributesModified=h(this._onCustomAttributesModified,this),this.scope.TYPE_CHOICES=d,this.scope.project=this.projectService.project.toJS(),this.scope.projectId=this.scope.project.id,u=this.translate.instant(this.scope.sectionName),l=this.translate.instant("ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE",{sectionName:u,projectName:this.scope.project.name}),u=this.scope.project.description,this.appMetaService.setAll(l,u),this.scope.init=(p=this,function(t){return p.scope.type=t,p.loadCustomAttributes()})}function m(t,e,r,n,i,o,s){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.model=o,this.projectService=s,this.mixingClass=h(this.mixingClass,this),this.cancelMixingTags=h(this.cancelMixingTags,this),this.confirmMixingTags=h(this.confirmMixingTags,this),this.toggleMixingFromTags=h(this.toggleMixingFromTags,this),this.startMixingTags=h(this.startMixingTags,this),this.deleteTag=h(this.deleteTag,this),this.editTag=h(this.editTag,this),this.createTag=h(this.createTag,this),this.filterAndSortTags=h(this.filterAndSortTags,this),this.loadTags=h(this.loadTags,this),this.loading=!0,this.loadTags()}o=this.taiga,i=this.taiga.mixOf,this.taiga.trim,this.taiga.toString,this.taiga.joinStr,this.taiga.groupBy,this.taiga.bindOnce,P=this.taiga.debounce,this.taiga.getDefaulColorList,e=angular.module("taigaAdmin"),r=i(o.Controller,o.PageMixin),t(c,r),c.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","tgErrorHandlingService","tgProjectService"],c.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},c.prototype.loadInitialData=function(){return this.loadProject()},e.controller("ProjectValuesSectionController",c),n=o.Controller,t(u,n),u.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources"],u.prototype.loadValues=function(){return this.rs[this.scope.resource].listValues(this.scope.projectId,this.scope.type).then((e=this,function(t){return t.length&&(e.scope.values=t,e.scope.maxValueOrder=_.maxBy(t,"order").order),t}));var e},u.prototype.moveValue=function(t,e,r){var n,i=this.scope.values,o=i.indexOf(e);return i.splice(o,1),i.splice(r,0,e),_.each(i,function(t,e){return t.order=e}),this.repo.saveAll(i).then((n=this,function(){return n.rootscope.$broadcast("admin:project-values:updated")}))},r=u,e.controller("ProjectValuesController",r),n=o.Controller,t(l,n),l.$inject=["$scope","$rootScope","$tgRepo","$translate","$tgConfirm","$tgResources","tgProjectService"],l.prototype.addSwimlane=function(){var e,t,r=this.rs[this.scope.resource].create(this.scope.projectId,this.scope.swimlane.name);return r.success((e=this,function(t){return e.scope.swimlaneAdded(),e.loadSwimlanes(),e.rootscope.$broadcast("project:load")})),r.error((t=this,function(){return t.confirm.notify("light-error",t.translate.instant("ADMIN.PROJECT_KANBAN_OPTIONS.ACTION_ADD_SWIMLANE")),t.scope.hideSwimlaneForm()}))},l.prototype.updateSwimlane=function(t,e){return this.rs[this.scope.resource].edit(t.id,e).then((r=this,function(t){return r.loadSwimlanes(),r.rootscope.$broadcast("project:load")}));var r},l.prototype.setDefaultSwimlane=function(t){return this.rs.projects.patch_default_swimlane(this.scope.projectId,t.id).then((e=this,function(){return e.rootscope.$broadcast("project:load")}));var e},l.prototype.updatedSwimlanePosition=function(r,t){var e,n=this.scope.values.find(function(t){return t.id===r.id});if(n.order!==t)return(n=this.scope.values.filter(function(t,e){return t.id!==r.id})).splice(t,0,r),n=n.map(function(t,e){return[t.id,e]}),this.rs[this.scope.resource].bulkUpdateOrder(this.scope.projectId,n).then((e=this,function(t){return e.loadSwimlanes()}))},l.prototype.filterArchivedProjectStatuses=function(){return this.scope.project.us_statuses.filter(function(t){return!0!==t.is_archived})},l.prototype.filterArchivedSwimlaneStatus=function(t){return t.statuses.filter(function(t){return!0!==t.is_archived})},l.prototype.loadSwimlanes=function(){return this.rs[this.scope.resource].list(this.scope.projectId).then((e=this,function(t){return e.scope.values=t}));var e},l.prototype.removeSwimlane=function(t,e){return this.rs[this.scope.resource].delete(t,e).then((r=this,function(){return r.loadSwimlanes(),r.rootscope.$broadcast("project:load")}));var r},e.controller("ProjectSwimlanesValuesController",l),n=function(i){return{link:function(t,e,r,n){return e.controller(),t.isFormVisible=!1,t.isNewSwimlane=!1,t.swimlane={name:""},t.swimlaneAdded=function(){return t.swimlane={name:""},t.isNewSwimlane=!0,t.isFormVisible=!1,setTimeout(function(){return t.isNewSwimlane=!1,t.$apply()},1e4)},t.displaySwimlaneForm=function(){return t.isFormVisible=!0,i(function(){return e.find("#admin-swimlanes-form-input").focus()})},t.hideSwimlaneForm=function(){return t.isFormVisible=!1,t.swimlane={name:""}},t.$on("$destroy",function(){return e.off()})}}},e.directive("tgProjectSwimlanesValues",["$timeout",n]),n=function(u,l,p){return{link:function(s,a,t,c){return c=a.controller(),s.displaySwimlaneSingleForm=!1,s.swimlaneSingleForm={name:""},s.updateSwimlane=function(t){return s.displaySwimlaneSingleForm=!1,c.updateSwimlane(t,s.swimlaneSingleForm.name)},s.setDefaultSwimlane=function(t){return c.setDefaultSwimlane(t)},s.getDefaultTitle=function(t){return t.id===s.project.default_swimlane?u.instant("LIGHTBOX.ADMIN_KANBAN_POWERUPS.DEFAULT_SWIMLANE"):u.instant("LIGHTBOX.ADMIN_KANBAN_POWERUPS.SET_DEFAULT_SWIMLANE")},s.removeSwimlaneTitle=function(t){if(t.id===s.project.default_swimlane)return u.instant("LIGHTBOX.ADMIN_KANBAN_POWERUPS.DISABLE_DELETE_SWIMLANE")},s.editSwimlaneSingleForm=function(){return s.displaySwimlaneSingleForm=!0},s.cancelEditSwimlaneSingleForm=function(){return s.displaySwimlaneSingleForm=!1},s.removeSwimlaneDialog=function(t,e){var r,n,i,o=u.instant("LIGHTBOX.ADMIN_KANBAN_POWERUPS.TITLE_ACTION_DELETE_SWIMLANE");return p.on("leave",a[0],function(t,e){if("close"===e)return p.off("leave",a[0]),c.scope.$evalAsync(function(){return c.scope.deletingSwimlane=!1})}),1<s.values.length?(i=u.instant("LIGHTBOX.ADMIN_KANBAN_POWERUPS.SUBTITLE_ACTION_DELETE_SWIMLANE_OPTIONS",{swimlane:e.name}),n=u.instant("LIGHTBOX.ADMIN_KANBAN_POWERUPS.SUBTITLE_ACTION_DELETE_SWIMLANE_REPLACEMENT"),r={},_.each(s.values,function(t){if(e.id!==t.id)return r[t.id]=t.name}),l.askChoice(o,i,r,n).then(function(t){return c.scope.deletingSwimlane=!0,c.removeSwimlane(e.id,t.selected),t.finish()})):(i=u.instant("LIGHTBOX.ADMIN_KANBAN_POWERUPS.SUBTITLE_ACTION_DELETE_SWIMLANE_LAST"),l.askDelete(o,i).then(function(t){return c.scope.deletingSwimlane=!0,c.removeSwimlane(e.id),t.finish()}))}}}},e.directive("tgProjectSwimlanesSingle",["$translate","$tgConfirm","$animate",n]),n=function(){return{link:function(n,t,e,i){var r,o,s;return i=t.controller(),o=null,s=t.find(".sortable"),(r=dragula([s[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:s[0]})).on("dragend",function(t){var e,r;return o=$(t),e=o.scope().value,r=o.index(),n.$apply(function(){return i.updatedSwimlanePosition(e,r)})}),n.$on("$destroy",function(){return t.off(),r.destroy()})}}},e.directive("tgSortableSwimlanes",[n]),t(p,r),p.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources"],p.prototype.loadValues=function(){return this.rs[this.scope.resource].listValues(this.scope.projectId,this.scope.type).then((e=this,function(t){return t.length?(e.scope.maxValueOrder=_.maxBy(t,"order").order,e.displayValues(t)):e.createDefaultValues(),t}));var e},p.prototype.createDefaultValues=function(){var e;if(null!=this.rs[this.scope.resource].createDefaultValues)return this.rs[this.scope.resource].createDefaultValues(this.scope.projectId,this.scope.type).then((e=this,function(t){return e.rootscope.$broadcast("admin:project-values:updated"),(t=t.data).length&&(e.scope.maxValueOrder=_.maxBy(t,"order").order,e.displayValues(t)),t}))},p.prototype.displayValues=function(t){return _.each(t,function(t,e){return t.days_to_due_abs=null!==t.days_to_due?Math.abs(t.days_to_due):null,t.sign=0<=t.days_to_due?1:-1}),this.scope.values=t},e.controller("ProjectDueDatesValuesController",p),s=function(t,d,h,e,r,f,m,g){var n=function(r,t,e){var n=null,i=t.find(".sortable"),o=dragula([i[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:i[0]});return o.on("dragend",function(t){var e=(n=$(t)).scope().value,t=n.index();return r.$broadcast("admin:project-values:move",e,t)}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&o.dragging}}),r.$on("$destroy",function(){return t.off(),o.destroy()})},i=function(o,r,t){var e,n,i,s,a=r.controller(),c=t.type,u=t.objname,l=function(){return o.newValue={name:"",is_closed:!1,is_archived:!1}},p=function(){return o.addNewElementText=f.instant("ADMIN.PROJECT_VALUES_"+u.toUpperCase()+".ACTION_ADD")};return l(),p(),m.$on("$translateChangeEnd",function(){return o.$evalAsync(p)}),n=function(t){var e;if(null==t&&(t=!1),e=r.find(".table-main"),$(document.body).scrollTop(e.offset().top+e.height()),t)return r.find(".new-value input:visible").first().focus()},s=function(e){var t=e.parents("form"),r=t.checksley();if(r.validate())return(t=t.scope().value).color||(t.color="#A9AABC"),(t=d.save(t)).then(function(){var t=e.parents(".row.table-main");return t.addClass("hidden"),t.siblings(".visualization").removeClass("hidden"),m.$broadcast("admin:project-values:updated"),g.fetchProject()}),t.then(null,function(t){return r.setErrors(t)})},i=function(e){var t,r=e.parents("form").checksley();if(r.validate())return o.newValue.project=o.project.id,o.newValue.order=o.maxValueOrder?o.maxValueOrder+1:1,o.newValue.color||(o.newValue.color="#A9AABC"),(t=d.create(c,o.newValue)).then(function(t){return e.addClass("hidden"),o.values.push(t),o.maxValueOrder=t.order,l(),m.$broadcast("admin:project-values:updated")}),t.then(null,function(t){return r.setErrors(t)})},e=function(t){var e=t.parents(".row.table-main"),r=t.parents("form").scope().value;return o.$apply(function(){return e.addClass("hidden"),r.revert(),e.siblings(".visualization").removeClass("hidden")})},r.on("click",".show-add-new",function(t){return t.preventDefault(),r.find(".new-value").removeClass("hidden"),n(!0)}),r.on("click",".add-new",P(2e3,function(t){return t.preventDefault(),t=r.find(".new-value"),i(t)})),r.on("click",".delete-new",function(t){return t.preventDefault(),r.find(".new-value").addClass("hidden"),l()}),r.on("click",".edit-value",function(t){return t.preventDefault(),(t=angular.element(t.currentTarget).parents(".row.table-main")).addClass("hidden"),(t=t.siblings(".edition")).removeClass("hidden"),t.find("input:visible").first().focus().select()}),r.on("keyup",".new-value input",function(t){var e;return 13===t.keyCode?(e=r.find(".new-value"),i(e)):27===t.keyCode?(r.find(".new-value").addClass("hidden"),l()):void 0}),r.on("click",".save",function(t){return t.preventDefault(),t=angular.element(t.currentTarget),s(t)}),r.on("click",".cancel",function(t){return t.preventDefault(),t=angular.element(t.currentTarget),e(t)}),r.on("click",".delete-value",function(t){var e,r,n,i;return t.preventDefault(),n=angular.element(t.currentTarget).parents("form"),i=n.scope().value,e={},_.each(o.values,function(t){if(i.id!==t.id)return e[t.id]=t.name}),r=i.name,0===_.keys(e).length?h.error(f.instant("ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL")):(t=f.instant("ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE"),n=f.instant("ADMIN.PROJECT_VALUES.REPLACEMENT"),h.askChoice(t,r,e,n).then(function(t){var e=function(){return a.loadValues().finally(function(){return m.$broadcast("admin:project-values:updated"),t.finish()})},r=function(){return h.notify("error")};return d.remove(i,{moveTo:t.selected}).then(e,r)}))})};return{link:function(t,e,r){return n(t,e),i(t,e,r),t.$on("$destroy",function(){return e.off()})}}},e.directive("tgProjectValues",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope","tgProjectService",s]),r=function(t,u,l,e,r,p,d,n){var i=s(0,u,l,0,0,p,d,n),o=function(n,e,t,i){var r,o,s,a,c;return i=e.controller(),c=t.type,(s=function(){return n.newValue={name:"",days_to_due:0,sign:1}})(),r=function(t){return t.days_to_due=t.days_to_due_abs*t.sign},o=function(t){var t=angular.element(t.currentTarget),t=(t.parents(".row.table-main"),t.parents("form"));return t.scope().value?t.scope().value:t.scope().newValue},a=function(e){var t,r=e.parents("form").checksley();if(r.validate())return n.newValue.project=n.project.id,n.newValue.order=n.maxValueOrder?n.maxValueOrder+1:1,(t=u.create(c,n.newValue)).then(function(t){return e.addClass("hidden"),t.sign=n.newValue.sign,t.days_to_due_abs=n.newValue.days_to_due_abs,n.values.push(t),d.$broadcast("admin:project-values:updated"),s()}),t.then(null,function(t){return r.setErrors(t)})},e.on("input",".days-to-due-abs",function(t){var e;return t.preventDefault(),e=o(t),n.$apply(function(){return r(e)})}),e.on("click",".days-to-due-sign",function(t){var e;if(t.preventDefault(),Number(angular.element(t.currentTarget).parent().find("input").val())!==(e=o(t)).sign)return n.$apply(function(){return e.sign=-1*e.sign,r(e)})}),e.on("click",".add-new-due-date",P(2e3,function(t){return t.preventDefault(),t=e.find(".new-value"),a(t)})),e.on("click",".delete-due-date",function(t){var e,n;return t.preventDefault(),e=angular.element(t.currentTarget).parents("form"),n=e.scope().value,t=p.instant("LIGHTBOX.ADMIN_DUE_DATES.TITLE_ACTION_DELETE_DUE_DATE"),e=p.instant("LIGHTBOX.ADMIN_DUE_DATES.SUBTITLE_ACTION_DELETE_DUE_DATE",{due_date_status_name:n.name}),l.askDelete(t,e).then(function(t){var e=function(){return i.loadValues().finally(function(){return d.$broadcast("admin:project-values:updated"),t.finish()})},r=function(){return l.notify("error")};return u.remove(n).then(e,r)})})};return{link:function(t,e,r){return i.link(t,e,r),o(t,e,r)}}},e.directive("tgProjectDueDatesValues",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope","tgProjectService",r]),d=[{key:"text",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT"},{key:"multiline",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI"},{key:"richtext",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_RICHTEXT"},{key:"date",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE"},{key:"url",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL"},{key:"dropdown",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DROPDOWN"},{key:"checkbox",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_CHECKBOX"},{key:"number",name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_NUMBER"}],i=i(o.Controller,o.PageMixin),t(f,i),f.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","tgProjectService"],f.prototype._parseAttributesExtra=function(){return this.scope.customAttributes=_.map(this.scope.customAttributes,(e=this,function(t){return e._parseAttributeExtra(t)}));var e},f.prototype._parseAttributeExtra=function(t){return"dropdown"!==t.type||t.extra||(t.extra=[""]),t},f.prototype._onCustomAttributesModified=function(){return this.rootscope.$broadcast("admin:project-custom-attributes:updated")},f.prototype.loadCustomAttributes=function(){return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((r=this,function(t){var e;return r.scope.customAttributes=t,r.scope.maxOrder=null!=(e=_.maxBy(t,"order"))?e.order:void 0,r._parseAttributesExtra(),t}));var r},f.prototype.createCustomAttribute=function(t){return this.repo.create("custom-attributes/"+this.scope.type,t).then((e=this,function(){return e._onCustomAttributesModified()}));var e},f.prototype.saveCustomAttribute=function(t){return this.repo.save(t).then((e=this,function(){return e._onCustomAttributesModified()}));var e},f.prototype.deleteCustomAttribute=function(t){return this.repo.remove(t).then((e=this,function(){return e._onCustomAttributesModified()}));var e},f.prototype.moveCustomAttributes=function(t,e){var r,n=this.scope.customAttributes,i=n.indexOf(t);return n.splice(i,1),n.splice(e,0,t),_.each(n,function(t,e){return t.order=e}),this.repo.saveAll(n).then((r=this,function(){return r._onCustomAttributesModified()}))},e.controller("ProjectCustomAttributesController",f),i=function(t,C,e,w){return{link:function(i,a,t){var e,r,n,o,s,c,u,l,p,d,h,f,m,g,v,y,_,S,b,j,k,I,E,T=a.controller();return i.$on("$destroy",function(){return a.off()}),i.isExtraVisible={},r=function(t,e){return t.preventDefault(),e(angular.element(t.currentTarget).closest("form"))},g=function(){var t,e,r,n,i,o=a.find(".js-sortable"),s=dragula([o[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:o[0],moves:function(t,e,r){return!$(r).closest(".js-child-sortable")[0]&&$(t).is("div[tg-bind-scope]")}});for(s.on("dragend",function(t){var e=$(t),t=e.scope().attr,e=e.index();return T.moveCustomAttributes(t,e)}),n=[],e=0,r=(i=a.find(".js-child-sortable")).length;e<r;e++)s[t=i[e]]=dragula([t],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:t,moves:function(t){return $(t).is("div[tg-bind-scope]")}}),n.push(s[t].on("dragend",function(t){var e=$(t),r=e.scope().attr.extra,n=e.scope().$index,i=e.index(),t=r[n];return r.splice(n,1),r.splice(i,0,t),e.scope().attr.setAttr("extra",r),T.saveCustomAttribute(e.scope().attr).then(function(){return C.notify("success")})}));return n},j=function(){return a.find(".js-new-custom-field").removeClass("hidden"),a.find(".js-new-custom-field input:visible").first().focus()},d=function(){return a.find(".js-new-custom-field").addClass("hidden")},S=function(){return a.find(".js-add-custom-field-button").removeClass("hidden")},l=function(){return a.find(".js-add-custom-field-button").addClass("hidden")},b=function(){return a.find(".js-cancel-new-custom-field-button").removeClass("hidden")},p=function(){return a.find(".js-cancel-new-custom-field-button").addClass("hidden")},y=function(){return i.newAttr={}},c=function(t){var e,r,n=t.checksley();if(n.validate())return r=function(){return T.loadCustomAttributes(),d(),y(),C.notify("success")},e=function(t){return n.setErrors(t)},(t=i.newAttr).project=i.projectId,t.order=i.maxOrder?i.maxOrder+1:1,T.createCustomAttribute(t).then(r,e)},o=function(){return d(),y()},m=function(t){var e,r=t.scope().newAttr?t.scope().newAttr:t.scope().attr;if("dropdown"===r.type&&(null==(e=r.extra)||!e.length))return r.extra=[""],r.id?k(t):(I(-1),t.scope().$apply())},i.$watch("customAttributes",function(t){if(t)return 0===t.length?(p(),l(),j()):(d(),S(),b(),g())}),a.on("change",".custom-field-type select",function(t){return r(t,m)}),a.on("click",".js-add-custom-field-button",function(t){return r(t,j)}),a.on("click",".js-create-custom-field-button",P(2e3,function(t){return r(t,c)})),a.on("click",".js-cancel-new-custom-field-button",function(t){return t.preventDefault(),o()}),a.on("keyup",".js-new-custom-field input",function(t){return 13===t.keyCode?r(t,c):27===t.keyCode?o():void 0}),k=function(t){return t.find(".js-view-custom-field").addClass("hidden"),t.find(".js-edit-custom-field").removeClass("hidden"),t.find(".js-edit-custom-field input:visible").first().focus().select(),t.find(".js-view-custom-field-extra").addClass("hidden"),t.find(".js-edit-custom-field-extra").removeClass("hidden"),t.find(".custom-extra-actions").removeClass("hidden"),I(t.scope().attr.id),i.$apply()},E=function(t){var e,r,n,i=t.checksley();if(i.validate())return n=function(){return T.loadCustomAttributes(),h(t),C.notify("success")},r=function(t){return i.setErrors(t)},(e=t.scope().attr).setAttr("extra",e.extra),T.saveCustomAttribute(e).then(n,r)},s=function(t){return h(t),_(t)},h=function(t){return t.find(".js-edit-custom-field").addClass("hidden"),t.find(".js-view-custom-field").removeClass("hidden"),t.find(".js-edit-custom-field-extra").addClass("hidden"),t.find(".js-view-custom-field-extra").removeClass("hidden"),t.find(".custom-extra-actions").addClass("hidden")},_=function(t){return i.$apply(function(){return t.scope().attr.revert()})},a.on("click",".js-edit-custom-field-button",function(t){return r(t,k)}),a.on("click",".js-update-custom-field-button",P(1e3,function(t){return r(t,E)})),a.on("click",".js-cancel-edit-custom-field-button",function(t){return r(t,s)}),a.on("keyup",".js-edit-custom-field input",function(t){return 13===t.keyCode?r(t,E):27===t.keyCode?r(t,s):void 0}),u=function(t){var n=t.scope().attr,i=n.name,e=w.instant("COMMON.CUSTOM_ATTRIBUTES.DELETE"),t=w.instant("COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE");return C.askDelete(e,t,i).then(function(t){var e=function(){return T.loadCustomAttributes().finally(function(){return t.finish()})},r=function(){return C.notify("error",null,"We have not been able to delete '"+i+"'.")};return T.deleteCustomAttribute(n).then(e,r)})},a.on("click",".js-delete-custom-field-button",P(2e3,function(t){return r(t,u)})),i.toggleExtraVisible=function(t){return(i.isExtraVisible[t]?f:I)(t)},I=function(t){return i.isExtraVisible[t]=!0},f=function(t){return i.isExtraVisible[t]=!1},e=function(t,e){return t.preventDefault(),e(angular.element(t.currentTarget).closest("form"),angular.element(t.currentTarget).closest(".js-form"))},n=function(t,e){var r,n=t.scope();return(null!=(r=n.newAttr)&&r.extra?n.newAttr:n.attr).extra.push(""),n.$apply(),t.find(".js-edit-custom-field-extra").last().removeClass("hidden"),t.find(".js-view-custom-field-extra").last().addClass("hidden"),t.find(".js-edit-custom-field-extra input").last().focus()},v=function(t,e){return t.scope().attr.extra.splice(e.scope().$index,1),e.scope().$apply()},a.on("keyup",".js-edit-custom-field-extra input",function(t){return 13===t.keyCode?r(t,E):27===t.keyCode?r(t,s):void 0}),a.on("keyup",".js-new-custom-field-extra input",function(t){return 13===t.keyCode?r(t,c):27===t.keyCode?o():void 0}),a.on("click",".js-add-option-custom-field-extra-button",P(500,function(t){return e(t,n)})),a.on("click",".js-delete-custom-field-extra-button",P(500,function(t){return e(t,v)}))}}},e.directive("tgProjectCustomAttributes",["$log","$tgConfirm","animationFrame","$translate",i]),o=o.Controller,t(m,o),m.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$tgModel","tgProjectService"],m.prototype.loadTags=function(){var r,t=this.projectService.project.toJS();return this.rs.projects.tagsColors(t.id).then((r=this,function(t){return r.scope.projectTagsAll=_.map(t.getAttrs(),function(t,e){return r.model.make_model("tag",{name:e,color:t})}),r.filterAndSortTags(),r.loading=!1}))},m.prototype.filterAndSortTags=function(){return this.scope.projectTags=_.sortBy(this.scope.projectTagsAll,function(t){return t.name.toLowerCase()}),this.scope.projectTags=_.filter(this.scope.projectTags,(e=this,function(t){return-1!==t.name.indexOf(e.scope.tagsFilter.name)}));var e},m.prototype.createTag=function(t,e){return this.rs.projects.createTag(this.scope.projectId,t,e)},m.prototype.editTag=function(t,e,r){return t===e&&(e=null),this.rs.projects.editTag(this.scope.projectId,t,e,r)},m.prototype.deleteTag=function(t){return this.scope.loadingDelete=!0,this.rs.projects.deleteTag(this.scope.projectId,t).finally((e=this,function(){return e.scope.loadingDelete=!1}));var e},m.prototype.startMixingTags=function(t){return this.scope.mixingTags.toTag=t.name},m.prototype.toggleMixingFromTags=function(t){var e;if(t.name!==this.scope.mixingTags.toTag)return-1===(e=this.scope.mixingTags.fromTags.indexOf(t.name))?this.scope.mixingTags.fromTags.push(t.name):this.scope.mixingTags.fromTags.splice(e,1)},m.prototype.confirmMixingTags=function(){var t,e,r=this.scope.mixingTags.toTag,n=this.scope.mixingTags.fromTags;return this.scope.loadingMixing=!0,this.rs.projects.mixTags(this.scope.projectId,r,n).then((e=this,function(){return e.cancelMixingTags(),e.loadTags()})).finally((t=this,function(){return t.scope.loadingMixing=!1}))},m.prototype.cancelMixingTags=function(){return this.scope.mixingTags.toTag=null,this.scope.mixingTags.fromTags=[]},m.prototype.mixingClass=function(t){if(null!==this.scope.mixingTags.toTag)return t.name===this.scope.mixingTags.toTag?"mixing-tags-to":-1!==this.scope.mixingTags.fromTags.indexOf(t.name)?"mixing-tags-from":void 0},e.controller("ProjectTagsController",m),o=function(t,e,p,r,n,d,h){return{link:function(i,r,t){var n,o,s,e=$(window),a=r.controller(),c=(t.type,t.objname,function(){return i.newValue={tag:"",color:""}}),t=function(){return i.tagsFilter={name:""}},u=function(){return i.mixingTags={toTag:null,fromTags:[]}},l=function(){return i.addNewElementText=d.instant("ADMIN.PROJECT_VALUES_TAGS.ACTION_ADD")};return c(),t(),u(),l(),h.$on("$translateChangeEnd",function(){return i.$evalAsync(l)}),s=function(e){var t,r=e.parents("form"),n=r.checksley();if(n.validate())return(r=(t=r.scope().tag).clone()).revert(),i.loadingEdit=!0,(t=a.editTag(r.name,t.name,t.color)).then(function(){return a.loadTags().then(function(){var t=e.parents(".row.table-main");return t.addClass("hidden"),i.loadingEdit=!1,h.$broadcast("tags:updated"),t.siblings(".visualization").removeClass("hidden")})}),t.then(null,function(t){return i.loadingEdit=!1,n.setErrors(t.data)})},o=function(e){var r,t;e.parents("form");if((r=e.checksley()).validate())return i.loadingCreate=!0,(t=a.createTag(i.newValue.tag,i.newValue.color)).then(function(t){return a.loadTags().then(function(){return i.loadingCreate=!1,e.addClass("hidden"),h.$broadcast("tags:updated"),c()})}),t.then(null,function(t){return i.loadingCreate=!1,r.setErrors(t.data)})},n=function(t){var e=t.parents(".row.table-main"),r=t.parents("form").scope().tag;return i.$apply(function(){return e.addClass("hidden"),r.revert(),e.siblings(".visualization").removeClass("hidden")})},i.$watch("tagsFilter.name",function(t){return a.filterAndSortTags()}),e.on("keyup",function(t){if(27===t.keyCode)return i.$apply(u)}),r.on("click",".show-add-new",function(t){return t.preventDefault(),r.find(".new-value").removeClass("hidden")}),r.on("click",".add-new",P(2e3,function(t){return t.preventDefault(),t=r.find(".new-value"),o(t)})),r.on("click",".delete-new",function(t){return t.preventDefault(),r.find(".new-value").addClass("hidden"),c()}),r.on("click",".mix-tags",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),i.$apply(function(){return a.startMixingTags(e.parents("form").scope().tag)})}),r.on("click",".mixing-row",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),i.$apply(function(){return a.toggleMixingFromTags(e.parents("form").scope().tag)})}),r.on("click",".mixing-confirm",function(t){return t.preventDefault(),t.stopPropagation(),i.$apply(function(){return a.confirmMixingTags()})}),r.on("click",".mixing-cancel",function(t){return t.preventDefault(),t.stopPropagation(),i.$apply(function(){return a.cancelMixingTags()})}),r.on("click",".edit-value",function(t){return t.preventDefault(),(t=angular.element(t.currentTarget).parents(".row.table-main")).addClass("hidden"),(t=t.siblings(".edition")).removeClass("hidden"),t.find("input:visible").first().focus().select()}),r.on("keyup",".new-value input",function(t){var e;return 13===t.keyCode?(e=r.find(".new-value"),o(e)):27===t.keyCode?(r.find(".new-value").addClass("hidden"),c()):void 0}),r.on("keyup",".status-name input",function(t){var e=angular.element(t.currentTarget);return 13===t.keyCode?s(e):27===t.keyCode?n(e):void 0}),r.on("click",".save",function(t){return t.preventDefault(),t=angular.element(t.currentTarget),s(t)}),r.on("click",".cancel",function(t){return t.preventDefault(),t=angular.element(t.currentTarget),n(t)}),r.on("click",".delete-tag",function(t){var n;return t.preventDefault(),t=angular.element(t.currentTarget).parents("form"),n=t.scope().tag,t=d.instant("ADMIN.COMMON.TITLE_ACTION_DELETE_TAG"),p.askOnDelete(t,n.name).then(function(t){var e=function(){return a.loadTags().finally(function(){return h.$broadcast("tags:updated"),t.finish()})},r=function(){return p.notify("error")};return a.deleteTag(n.name).then(e,r)})}),i.$on("$destroy",function(){return r.off(),e.off()})}}},e.directive("tgProjectTags",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope",o]),o=function(){return{link:function(t,e,r,n){return t.wipClosed=!1,t.toggleWipVisibility=function(){return t.wipClosed=!t.wipClosed}}}},e.directive("tgProjectSwimlanesWip",o)}.call(this),function(){function m(t,e){return function(){return t.apply(e,arguments)}}var g,v,t,e,r,y,n,i={}.hasOwnProperty,S=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};function o(t,e,r,n,i,o,s,a,c,u,l,p,d,h){var f;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.model=u,this.appMetaService=l,this.translate=p,this.errorHandlingService=d,this.projectService=h,this._disableComputable=m(this._disableComputable,this),this._enableComputable=m(this._enableComputable,this),g(this),this.scope.sectionName="ADMIN.MENU.PERMISSIONS",this.scope.project={},this.scope.anyComputableRole=!0,(h=this.loadInitialData()).then((f=this,function(){var t=f.translate.instant("ADMIN.ROLES.PAGE_TITLE",{projectName:f.scope.project.name}),e=f.scope.project.description;return f.appMetaService.setAll(t,e)})),h.then(null,this.onInitialDataError.bind(this))}n=this.taiga,e=this.taiga.mixOf,v=this.taiga.bindOnce,t=this.taiga.debounce,g=this.taiga.bindMethods,r=angular.module("taigaAdmin"),y=["view_epics","view_milestones","view_us","view_tasks","view_issues","view_wiki_pages","view_wiki_links"],function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,e(n.Controller,n.PageMixin,n.FiltersMixin)),o.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgModel","tgAppMetaService","$translate","tgErrorHandlingService","tgProjectService"],o.prototype.loadProject=function(){var t=this.projectService.project.toJS();return(t=this.model.make_model("projects",t)).i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.anyComputableRole=_.some(_.map(t.roles,function(t){return t.computable})),t},o.prototype.loadRoles=function(){return this.rs.roles.list(this.scope.projectId).then((r=this,function(t){var e;return t=t.map(function(t){return t.external_user=!1,t}),e={name:r.translate.instant("ADMIN.ROLES.EXTERNAL_USER"),permissions:r.scope.project.public_permissions,external_user:!0},t.push(e),r.scope.roles=t,r.scope.role=r.scope.roles[0],r.scope.project.is_private||y.forEach(function(t){if(!r.scope.role.permissions.includes(t))return r.scope.role.permissions.push(t)}),t}));var r},o.prototype.loadInitialData=function(){return this.loadProject(),this.loadRoles()},o.prototype.forceLoadProject=function(){return this.rootscope.$broadcast("admin:project-roles:updated")},o.prototype.setRole=function(t){return this.scope.role=t,this.scope.$broadcast("role:changed",this.scope.role)},o.prototype.delete=function(){for(var t,e,r,n,i,o,s={},a=this.scope.roles,c=0,u=a.length;c<u;c++)(e=a[c]).id!==this.scope.role.id&&(s[e.id]=e.name);return 0===_.keys(s).length?this.confirm.error(this.translate.instant("ADMIN.ROLES.ERROR_DELETE_ALL")):(n=this.translate.instant("ADMIN.ROLES.TITLE_DELETE_ROLE"),r=this.scope.role.name,t=this.translate.instant("ADMIN.ROLES.REPLACEMENT_ROLE"),i=this.translate.instant("ADMIN.ROLES.WARNING_DELETE_ROLE"),this.confirm.askChoice(n,r,s,t,i).then((o=this,function(t){var e=function(){return o.forceLoadProject(),o.loadRoles().finally(function(){return t.finish()})},r=function(){return o.confirm.notify("error")};return o.repo.remove(o.scope.role,{moveTo:t.selected}).then(e,r)})))},o.prototype._enableComputable=function(){var t,e,r=function(){return t.confirm.notify("success"),t.forceLoadProject()},n=function(){return e.confirm.notify("error"),e.scope.role.revert()};return(e=t=this).repo.save(this.scope.role).then(r,n)},o.prototype._disableComputable=function(){var n,e,t=function(t){var e=function(){return t.finish(),n.confirm.notify("success"),n.forceLoadProject()},r=function(){return t.finish(),n.confirm.notify("error"),n.scope.role.revert()};return n.repo.save(n.scope.role).then(e,r)},r=function(t){return e.scope.role.revert()},i=(e=n=this).translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE"),o=this.translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE",{roleName:this.scope.role.name});return this.confirm.ask(i,o,"").then(t,r)},o.prototype.toggleComputable=t(2e3,function(){return this.scope.role.computable?this._enableComputable():this._disableComputable()}),r.controller("RolesController",o),t=function(o,s){return{link:function(e,r,t){var n=function(){return r.find(".total").toggle(),r.find(".edit-role").toggle()},i=function(){var t;return e.role.name=r.find("input").val(),(t=o.save(e.role)).then(function(){return s.notify("success")}),t.then(null,function(t){return s.notify("error")}),n()};return r.on("click",".edit-value",function(){return n(),r.find("input").focus(),r.find("input").val(e.role.name)}),r.on("click","a.save",i),r.on("keyup","input",function(t){return 13===t.keyCode?i():27===t.keyCode?n():void 0}),e.$on("role:changed",function(){if(r.find(".edit-role").is(":visible"))return n()}),e.$on("$destroy",function(){return r.off()})}}},r.directive("tgEditRole",["$tgRepo","$tgConfirm",t]),t=function(){return{link:function(t,e,r){e.controller();return t.$on("$destroy",function(){return e.off()})}}},r.directive("tgRoles",t),t=function(c,u){var l=["view_project","view_milestones","view_us","view_tasks","view_issues"];return{link:function(o,s,t){var a=s.controller();return o.$on("$destroy",function(){return s.off()}),s.on("click","button.add-button",function(t){return t.preventDefault(),s.find(".new").removeClass("hidden"),s.find(".new").focus(),s.find(".add-button").hide()}),s.on("keyup",".new",function(t){var e,r,n,i;return t.preventDefault(),13===t.keyCode?(i=angular.element(t.currentTarget),e={project:o.projectId,name:i.val(),permissions:l,order:_.maxBy(o.roles,function(t){return t.order}).order+1,computable:!1},s.find(".new").addClass("hidden"),s.find(".new").val(""),n=function(t){var e=o.roles.length-1;return o.roles.splice(e,0,t),a.setRole(t),s.find(".add-button").show(),a.forceLoadProject()},r=function(){return u.notify("error")},c.create("roles",e).then(n,r)):27===t.keyCode?(i=angular.element(t.currentTarget),s.find(".new").addClass("hidden"),s.find(".new").val(""),s.find(".add-button").show()):void 0})}}},r.directive("tgNewRole",["$tgRepo","$tgConfirm",t]),t=function(u,l,p,r){var d=_.template('<div class="resume-title" translate="<%- category.name %>"></div>\n<div class="summary-role">\n    <div class="count"><%- category.activePermissions %>/<%- category.permissions.length %></div>\n    <% _.each(category.permissions, function(permission) { %>\n        <div class="role-summary-single check-toggle <% if(permission.active) { %>active<% } %>"\n             title="{{ \'<%- permission.name %>\' | translate }}"></div>\n    <% }) %>\n</div>\n<tg-svg svg-icon="icon-arrow-right"></tg-svg>'),h=_.template('<div class="category-config" data-id="<%- index %>">\n    <div class="resume">\n    </div>\n    <div class="category-items">\n        <div class="items-container">\n        <% _.each(category.permissions, function(permission) { %>\n            <div class="category-item" data-id="<%- permission.key %>">\n                <span translate="<%- permission.name %>"></span>\n                <div class="check">\n                    <input type="checkbox"\n                           <% if(!permission.editable) { %> disabled="disabled" <% } %>\n                           <% if(permission.active) { %> checked="checked" <% } %>/>\n                    <div></div>\n                    <span class="check-text check-yes" translate="COMMON.YES"></span>\n                    <span class="check-text check-no" translate="COMMON.NO"></span>\n                </div>\n            </div>\n        <% }) %>\n        </div>\n    </div>\n</div>'),f=_.template('<div class="category-config-list"></div>');return{link:function(s,i,t){var o=i.controller(),a=function(e){var t=function(t){return _.map(t,function(t){return _.extend({},t,{active:(t=t.key,0<=S.call(e.permissions,t))})})},r=function(t,e,r){return!(e.external_user&&!r.is_private&&0===t.key.indexOf("view_"))},n=function(t){return _.map(t,function(t){return t.permissions=t.permissions.map(function(t){return t.editable=r(t,e,s.project),t}),_.extend({},t,{activePermissions:_.filter(t.permissions,"active").length})})},i=[],o=[{key:"view_epics",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.VIEW_EPICS"},{key:"add_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.ADD_EPICS"},{key:"modify_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.MODIFY_EPICS"},{key:"comment_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.COMMENT_EPICS"},{key:"delete_epic",name:"COMMON.PERMISIONS_CATEGORIES.EPICS.DELETE_EPICS"}];return i.push({name:"COMMON.PERMISIONS_CATEGORIES.EPICS.NAME",permissions:t(o)}),o=[{key:"view_milestones",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS"},{key:"add_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS"},{key:"modify_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS"},{key:"delete_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS"}],i.push({name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME",permissions:t(o)}),o=[{key:"view_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES"},{key:"add_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES"},{key:"modify_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES"},{key:"comment_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.COMMENT_USER_STORIES"},{key:"delete_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES"}],i.push({name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME",permissions:t(o)}),o=[{key:"view_tasks",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS"},{key:"add_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS"},{key:"modify_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS"},{key:"comment_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.COMMENT_TASKS"},{key:"delete_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS"}],i.push({name:"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME",permissions:t(o)}),o=[{key:"view_issues",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES"},{key:"add_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES"},{key:"modify_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES"},{key:"comment_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.COMMENT_ISSUES"},{key:"delete_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES"}],i.push({name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME",permissions:t(o)}),o=[{key:"view_wiki_pages",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES"},{key:"add_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES"},{key:"modify_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES"},{key:"delete_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES"},{key:"add_wiki_link",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS"},{key:"delete_wiki_link",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS"},{key:"view_wiki_links",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS"}],i.push({name:"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME",permissions:t(o)}),n(i)},c=function(t,e){return t.find(".resume").html(r(d({category:e}))(s))},n=function(t,e){e=h({category:t,index:e});return e=angular.element(e),c(e,t),r(e)(s)},e=function(){var r;return i.off(),r=f(),_.each(a(s.role),function(t,e){return s.project.is_private||t.permissions.forEach(function(t){if(y.includes(t.key))return t.editable=!1}),r=angular.element(r).append(n(t,e))}),i.html(r),i.on("click",".resume",function(t){return t.preventDefault(),(t=angular.element(t.currentTarget)).toggleClass("open-drawer"),t.next().toggleClass("open")}),i.on("change",".category-item input",function(t){var e,r=function(){var t=_.filter(i.find(".category-item input"),function(t){return angular.element(t).is(":checked")});return(t=_.sortBy(_.map(t,function(t){return angular.element(t).parents(".category-item").data("id")}))).length&&t.push("view_project"),t},n=angular.element(t.currentTarget);return s.role.permissions=r(),e=function(){var t=a(s.role),e=n.parents(".category-config").data("id");return c(n.parents(".category-config"),t[e]),u.$broadcast("projects:reload"),p.notify("success"),o.forceLoadProject()},t=function(){return p.notify("error"),n.prop("checked",!n.prop("checked")),s.role.permissions=r()},s.role.external_user?(s.project.public_permissions=s.role.permissions,s.project.anon_permissions=s.role.permissions.filter(function(t){return 0===t.indexOf("view_")}),l.save(s.project).then(e,t)):l.save(s.role).then(e,t)})};return s.$on("$destroy",function(){return i.off()}),s.$on("role:changed",e),v(s,t.ngModel,e)}}},r.directive("tgRolePermissions",["$rootScope","$tgRepo","$tgConfirm","$compile",t])}.call(this),function(){function t(t,e){for(var r in e)o.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var p,f,e,r,m,n,i,o={}.hasOwnProperty;function s(t,e,r,n,i,o,s,a,c,u){var l;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.location=i,this.navUrls=o,this.appMetaService=s,this.translate=a,this.errorHandlingService=c,this.projectService=u,p(this),this.scope.sectionName="ADMIN.WEBHOOKS.SECTION_NAME",this.scope.project={},(u=this.loadInitialData()).then((l=this,function(){var t=l.translate.instant("ADMIN.WEBHOOKS.PAGE_TITLE",{projectName:l.scope.project.name}),e=l.scope.project.description;return l.appMetaService.setAll(t,e)})),u.then(null,this.onInitialDataError.bind(this)),this.scope.$on("webhooks:reload",this.loadWebhooks)}function a(t,e,r,n,i,o,s){var a;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,p(this),this.scope.sectionName=this.translate.instant("ADMIN.GITHUB.SECTION_NAME"),this.scope.project={},(s=this.loadInitialData()).then((a=this,function(){var t=a.translate.instant("ADMIN.GITHUB.PAGE_TITLE",{projectName:a.scope.project.name}),e=a.scope.project.description;return a.appMetaService.setAll(t,e)})),s.then(null,this.onInitialDataError.bind(this))}function c(t,e,r,n,i,o,s){var a,c;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,p(this),this.scope.sectionName=this.translate.instant("ADMIN.GITLAB.SECTION_NAME"),this.scope.project={},(s=this.loadInitialData()).then((a=this,function(){var t=a.translate.instant("ADMIN.GITLAB.PAGE_TITLE",{projectName:a.scope.project.name}),e=a.scope.project.description;return a.appMetaService.setAll(t,e)})),s.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:modules:reload",(c=this,function(){return c.loadModules()}))}function u(t,e,r,n,i,o,s){var a,c;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,p(this),this.scope.sectionName=this.translate.instant("ADMIN.BITBUCKET.SECTION_NAME"),this.scope.project={},(s=this.loadInitialData()).then((a=this,function(){var t=a.translate.instant("ADMIN.BITBUCKET.PAGE_TITLE",{projectName:a.scope.project.name}),e=a.scope.project.description;return a.appMetaService.setAll(t,e)})),s.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:modules:reload",(c=this,function(){return c.loadModules()}))}function l(t,e,r,n,i,o,s){var a;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,this.projectService=s,p(this),this.scope.sectionName=this.translate.instant("ADMIN.GOGS.SECTION_NAME"),this.scope.project={},(s=this.loadInitialData()).then((a=this,function(){var t=a.translate.instant("ADMIN.GOGS.PAGE_TITLE",{projectName:a.scope.project.name}),e=a.scope.project.description;return a.appMetaService.setAll(t,e)})),s.then(null,this.onInitialDataError.bind(this))}i=this.taiga,e=this.taiga.mixOf,p=this.taiga.bindMethods,f=this.taiga.debounce,m=this.taiga.timeout,r=angular.module("taigaAdmin"),n=e(i.Controller,i.PageMixin,i.FiltersMixin),t(s,n),s.$inject=["$scope","$tgRepo","$tgResources","$routeParams","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","tgErrorHandlingService","tgProjectService"],s.prototype.loadWebhooks=function(){return this.rs.webhooks.list(this.scope.projectId).then((e=this,function(t){return e.scope.webhooks=t}));var e},s.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},s.prototype.loadInitialData=function(){return this.loadProject(),this.loadWebhooks()},r.controller("WebhooksController",s),n=function(l,p,d,t,h){return{link:function(n,i,t){var s=n.$eval(t.tgWebhook),e=function(){var o=h.instant("ADMIN.WEBHOOKS.DATE");return l.webhooklogs.list(s.id).then(function(t){for(var e,r,n=0,i=t.length;n<i;n++)(e=t[n]).validStatus=200<=(r=e.status)&&r<300,e.prettySentHeaders=_.map(_.toPairs(e.request_headers),function(t){return t[0]+": "+t[1]}).join("\n"),e.prettySentData=JSON.stringify(e.request_data),e.prettyDate=moment(e.created).format(o);return s.logs_counter=t.length,s.logs=t,a()})},a=function(){var t,e=i.find(".toggle-history"),r=e.parents(".single-webhook-wrapper").find(".webhooks-history").hasClass("open")?(t=h.instant("ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY"),h.instant("ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE")):(t=h.instant("ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY"),h.instant("ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE"));return e.text(t),e.prop("title",r)},r=function(){return i.find(".edition-mode").addClass("hidden"),i.find(".visualization-mode").removeClass("hidden")},t=function(){return i.find(".visualization-mode").addClass("hidden"),i.find(".edition-mode").removeClass("hidden")},o=function(){return i.find(".webhooks-history").addClass("open")},c=function(){return r(),n.$apply(function(){return s.revert()})},u=f(2e3,function(t){var e=t.parents("form").checksley();if(e.validate())return(t=p.save(s)).then(r),t.then(null,function(t){return d.notify("error"),e.setErrors(t)})});return i.on("click",".test-webhook",function(){return o(),l.webhooks.test(s.id).then(e)}),i.on("click",".edit-webhook",t),i.on("click",".cancel-existing",c),i.on("click",".edit-existing",function(t){return t.preventDefault(),t=angular.element(t.currentTarget),u(t)}),i.on("keyup",".edition-mode input",function(t){var e;return 13===t.keyCode?(e=angular.element(t.currentTarget),u(e)):27===t.keyCode?(e=angular.element(t.currentTarget),c()):void 0}),i.on("click",".delete-webhook",function(){var t=h.instant("ADMIN.WEBHOOKS.DELETE"),e=h.instant("ADMIN.WEBHOOKS.WEBHOOK_NAME",{name:s.name});return d.askOnDelete(t,e).then(function(t){var e=function(){return t.finish(),n.$emit("webhooks:reload")},r=function(){return t.finish(!1),d.notify("error")};return p.remove(s).then(e,r)})}),i.on("click",".toggle-history",function(t){angular.element(t.currentTarget);return null==s.logs||0===s.logs.length?e().then(function(){return m(0,function(){return i.find(".webhooks-history").toggleClass("open").slideToggle(),a()})}):(i.find(".webhooks-history").toggleClass("open").slideToggle(),n.$apply(function(){return a()}))}),i.on("click",".history-single",function(t){t=angular.element(t.currentTarget);return t.toggleClass("history-single-open"),t.siblings(".history-single-response").toggleClass("open")}),i.on("click",".resend-request",function(t){t=angular.element(t.currentTarget).data("log");return l.webhooklogs.resend(t).then(e)})}}},r.directive("tgWebhook",["$tgResources","$tgRepo","$tgConfirm","$tgLoading","$translate",n]),n=function(t,a,c,e,u){return{link:function(r,t,e){r.$eval(e.tgWebhook);var n,i=t.find(".new-webhook-form"),o=t.find(".add-webhook"),s=function(){return r.newValue={name:"",url:"",key:""}};return s(),r.$watch("webhooks",function(t){if(null!=t)return 0===t.length?(i.removeClass("hidden"),o.addClass("hidden"),i.find("input")[0].focus()):(i.addClass("hidden"),o.removeClass("hidden"))}),n=f(2e3,function(){var t,e=i.checksley();if(e.validate())return r.newValue.project=r.project.id,(t=a.create("webhooks",r.newValue)).then(function(){return u.trackEvent("webhooks","create","Create new webhook",1),r.$emit("webhooks:reload"),s()}),t.then(null,function(t){return c.notify("error"),e.setErrors(t)})}),i.on("click",".add-new",function(t){return t.preventDefault(),n()}),i.on("keyup","input",function(t){if(13===t.keyCode)return n()}),i.on("click",".cancel-new",function(t){return r.$apply(function(){if(s(),1<=r.webhooks.length)return i.addClass("hidden")})}),o.on("click",function(t){return i.removeClass("hidden"),i.find("input")[0].focus()})}}},r.directive("tgNewWebhook",["$tgResources","$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",n]),n=e(i.Controller,i.PageMixin,i.FiltersMixin),t(a,n),a.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],a.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"github").then((e=this,function(t){return e.scope.github=t}));var e},a.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},a.prototype.loadInitialData=function(){this.loadProject();return this.loadModules()},r.controller("GithubController",a),n=e(i.Controller,i.PageMixin,i.FiltersMixin),t(c,n),c.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],c.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"gitlab").then((e=this,function(t){return e.scope.gitlab=t}));var e},c.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},c.prototype.loadInitialData=function(){return this.loadProject(),this.loadModules()},r.controller("GitlabController",c),n=e(i.Controller,i.PageMixin,i.FiltersMixin),t(u,n),u.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],u.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"bitbucket").then((e=this,function(t){return e.scope.bitbucket=t}));var e},u.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},u.prototype.loadInitialData=function(){return this.loadProject(),this.loadModules()},r.controller("BitbucketController",u),n=function(n,i){return{link:function(t,e,r){return e.on("click",".select-input-content",function(){var t=e.find("input");if(t.val())return t.select(),document.execCommand("copy"),i.notify("success",n.instant("COMMON.COPIED_TO_CLIPBOARD"))})}}},r.directive("tgSelectInputText",["$translate","$tgConfirm",n]),n=function(s,a,c,u){return{link:function(r,t,e){var n=t.find("form").checksley({onlyOneErrorElement:!0}),i=f(2e3,function(t){var e;if(t.preventDefault(),n.validate())return e=c().target(o).start(),(t=s.saveAttribute(r.github,"github")).then(function(){return u.trackEvent("github-webhook","created-or-changed","Create or changed github webhook",1),e.finish(),a.notify("success")}),t.then(null,function(t){if(e.finish(),n.setErrors(t),t._error_message)return a.notify("error",t._error_message)})}),o=t.find(".submit-button");return t.on("submit","form",i)}}},r.directive("tgGithubWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",n]),n=function(s,a,c,u){return{link:function(r,t,e){var n=t.find("form").checksley({onlyOneErrorElement:!0}),i=f(2e3,function(t){var e;if(t.preventDefault(),n.validate())return e=c().target(o).start(),(t=s.saveAttribute(r.gitlab,"gitlab")).then(function(){return u.trackEvent("gitlab-webhook","created-or-changed","Create or changed gitlab webhook",1),e.finish(),a.notify("success"),r.$emit("project:modules:reload")}),t.then(null,function(t){if(e.finish(),n.setErrors(t),t._error_message)return a.notify("error",t._error_message)})}),o=t.find(".submit-button");return t.on("submit","form",i)}}},r.directive("tgGitlabWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",n]),n=function(s,a,c,u){return{link:function(r,t,e){var n=t.find("form").checksley({onlyOneErrorElement:!0}),i=f(2e3,function(t){var e;if(t.preventDefault(),n.validate())return e=c().target(o).start(),(t=s.saveAttribute(r.bitbucket,"bitbucket")).then(function(){return u.trackEvent("bitbucket-webhook","created-or-changed","Create or changed bitbucket webhook",1),e.finish(),a.notify("success"),r.$emit("project:modules:reload")}),t.then(null,function(t){if(e.finish(),n.setErrors(t),t._error_message)return a.notify("error",t._error_message)})}),o=t.find(".submit-button");return t.on("submit","form",i)}}},r.directive("tgBitbucketWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",n]),n=function(){return{link:function(t,e,r,n){return n.$parsers.push(function(t){return""===(t=$.trim(t))?[]:t.split(",")})},restrict:"EA",require:"ngModel"}},r.directive("tgValidOriginIps",n),i=e(i.Controller,i.PageMixin,i.FiltersMixin),t(l,i),l.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate","tgProjectService"],l.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"gogs").then((e=this,function(t){return e.scope.gogs=t}));var e},l.prototype.loadProject=function(){var t=this.projectService.project.toJS();return this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),t},l.prototype.loadInitialData=function(){return this.loadProject(),this.loadModules()},i=function(s,a,c,u){return{link:function(r,t,e){var n=t.find("form").checksley({onlyOneErrorElement:!0}),i=f(2e3,function(t){var e;if(t.preventDefault(),n.validate())return e=c().target(o).start(),(t=s.saveAttribute(r.gogs,"gogs")).then(function(){return u.trackEvent("gogs-webhook","create-or-change","Create or change gogs webhook",1),e.finish(),a.notify("success"),r.$emit("project:modules:reload")}),t.then(null,function(t){if(e.finish(),n.setErrors(t),t._error_message)return a.notify("error",t._error_message)})}),o=t.find(".submit-button");return t.on("submit","form",i),t.on("click",".submit-button",i)}}},r.controller("GogsController",l),r.directive("tgGogsWebhooks",["$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics",i])}.call(this),function(){this.taiga,this.taiga.bindOnce,this.taiga.timeout,this.taiga.debounce;var t=function(o,s,t,a,c,u,l,p,d,h){return{link:function(t,r,e){var n,i=null;return t.$on("deletelightbox:new",function(t,e){return l.open(r),i=e}),t.$on("$destroy",function(){return r.off()}),n=function(){var t;return p.start(),l.close(r),(t=o.remove(i)).then(function(t){return h.trackEvent("projects","delete","Delete project",1),p.pageLoaded(),s.$broadcast("projects:reload"),a.path(c.resolve("home")),u.notify("success"),d.loadProjects()}),t.then(null,function(){return u.notify("error"),l.close(r)})},r.on("click",".js-cancel",function(t){return t.preventDefault(),l.close(r)}),r.on("click",".js-confirm",function(t){return t.preventDefault(),n()})}}};angular.module("taigaProject").directive("tgLbDeleteProject",["$tgRepo","$rootScope","$tgAuth","$tgLocation","$tgNavUrls","$tgConfirm","lightboxService","tgLoader","tgCurrentUserService","$tgAnalytics",t])}.call(this),function(){var n=this.taiga.bindOnce,t=function(){return{link:function(t,e,r){return n(t,r.tgBoBind,function(t){return e.text(t)})}}},e=function(){return{link:function(t,e,r){return n(t,r.tgBoHtml,function(t){return e.html(t)})}}},r=function(){return{link:function(t,e,r){return n(t,r.tgBoRef,function(t){return e.html("#"+t+" ")})}}},i=function(){return{link:function(t,e,r){return n(t,r.tgBoSrc,function(t){return e.attr("src",t)})}}},o=function(){return{link:function(t,e,r){return n(t,r.tgBoHref,function(t){return e.attr("href",t)})}}},s=function(){return{link:function(t,e,r){return n(t,r.tgBoAlt,function(t){return e.attr("alt",t)})}}},a=function(){return{link:function(t,e,r){return n(t,r.tgBoTitle,function(t){return e.attr("title",t)})}}},c=function(){return{link:function(t,e,r){return t.$watch(r.tgTitleHtml,function(t){if(null!=t)return e.attr("title",t)})}}},u=function(){return{link:function(t,e,r){return t.$watch(r.tgBindHtml,function(t){if(null!=t)return e.html(t)})}}},l=angular.module("taigaBase");l.directive("tgBoBind",t),l.directive("tgBoHtml",e),l.directive("tgBoRef",r),l.directive("tgBoSrc",i),l.directive("tgBoHref",o),l.directive("tgBoAlt",s),l.directive("tgBoTitle",a),l.directive("tgBindTitle",c),l.directive("tgBindHtml",u)}.call(this),function(){var t;function e(){this.config=window.taigaConfig}e.prototype.get=function(t,e){return null==e&&(e=null),_.has(this.config,t)?this.config[t]:e},t=e,angular.module("taigaBase").service("$tgConfig",t)}.call(this),function(){function t(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var e,r,i={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a){this.rootScope=t,this.scope=e,this.params=r,this.repo=n,this.rs=i,this.confirm=o,this.projectService=s,this.errorHandlingService=a,this.scope.currentPlugin=_.head(_.filter(this.rootScope.adminPlugins,{slug:this.params.plugin})),this.scope.projectSlug=this.params.pslug,this.loadInitialData()}function o(t,e,r){this.rootScope=t,this.scope=e,this.params=r,this.scope.currentPlugin=_.head(_.filter(this.rootScope.userSettingsPlugins,{slug:this.params.plugin}))}e=angular.module("taigaBase"),r=taiga.Controller,t(n,r),n.$inject=["$rootScope","$scope","$routeParams","$tgRepo","$tgResources","$tgConfirm","tgProjectService","tgErrorHandlingService"],n.prototype.loadProject=function(){var t=this.projectService.project.toJS();return t.i_am_admin||this.errorHandlingService.permissionDenied(),this.scope.projectId=t.id,this.scope.project=t,this.scope.$emit("project:loaded",t),this.scope.$broadcast("project:loaded",t),t},n.prototype.loadInitialData=function(){return this.loadProject()},e.controller("ContribController",n),r=taiga.Controller,t(o,r),o.$inject=["$rootScope","$scope","$routeParams"],e.controller("ContribUserSettingsController",o)}.call(this),function(){var i={}.hasOwnProperty;function t(t,e){this.storage=t,this.params=e}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(t,this.taiga.Service),t.$inject=["$tgStorage","$routeParams"],t.prototype.generateHash=function(t){return null==t&&(t=[]),t=_.map(t,function(t){return JSON.stringify(t)}),hex_sha1(t.join(":"))}}.call(this),function(){var t,i={}.hasOwnProperty;function a(t,e,r,n,i,o,s){this.http=t,this.q=e,this.tgLoader=r,this.storage=n,this.rootScope=i,this.cacheFactory=o,this.translate=s,a.__super__.constructor.call(this),this.cache=this.cacheFactory("httpget")}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(a,this.taiga.Service),a.$inject=["$http","$q","tgLoader","$tgStorage","$rootScope","$cacheFactory","$translate"],a.prototype.headers=function(){var t={},e=this.storage.get("token");return e&&(t.Authorization="Bearer "+e),(e=this.translate.preferredLanguage())&&(t["Accept-Language"]=e),t},a.prototype.request=function(t){return t.headers=_.assign({},t.headers||{},this.headers()),this.http(t)},a.prototype.get=function(t,e,r){return r=_.assign({method:"GET",url:t},r),e&&(r.params=e),r.cache=this.cache,this.request(r).finally((n=this,function(t){return n.cache.removeAll()}));var n},a.prototype.post=function(t,e,r,n){return n=_.assign({method:"POST",url:t},n),e&&(n.data=e),r&&(n.params=r),n.responseType="text",this.request(n)},a.prototype.put=function(t,e,r,n){return n=_.assign({method:"PUT",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},a.prototype.patch=function(t,e,r,n){return n=_.assign({method:"PATCH",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},a.prototype.delete=function(t,e,r,n){return n=_.assign({method:"DELETE",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},t=a,angular.module("taigaBase").service("$tgHttp",t)}.call(this),function(){this.taiga;var t=function(s){return{link:function(n,i,o){var t=n.$watch(s(o.tgLoadElement),function(t){var e,r;if(t&&(r=s(o.tgLoadElement)(n),(e=i[0]).component=r.component,r.params&&(e.params=r.params),r.events))return e.events=r.events});return n.$on("$destroy",function(){return t()})}}};angular.module("taigaBase").directive("tgLoadElement",["$parse",t])}.call(this),function(){var t=function(n,i,t){return n.noreload=function(t){var e=i.current,r=t.$on("$locationChangeSuccess",function(){return i.current=e,r()});return n},n.isInCurrentRouteParams=function(t,e){return(n.search()||{})[t]===e},n};angular.module("taigaBase").factory("$tgLocation",["$location","$route","$rootScope",t])}.call(this),function(){var o,t,e=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},i={}.hasOwnProperty;function r(t,e,r){this._attrs=e,this._name=t,this._dataTypes=r,this.setAttrs(e),this.initialize()}function s(t,e,r,n){this.q=t,this.urls=e,this.storage=r,this.http=n,s.__super__.constructor.call(this)}r.prototype.realClone=function(){var t=_.cloneDeep(this._attrs),t=new r(this._name,t,this._dataTypes);return t._modifiedAttrs=_.cloneDeep(this._modifiedAttrs),t._isModified=_.cloneDeep(this._isModified),t},r.prototype.clone=function(){var t=new r(this._name,this._attrs,this._dataTypes);return t._modifiedAttrs=this._modifiedAttrs,t._isModified=this._isModified,t},r.prototype.applyCasts=function(){var t,e,r=this._dataTypes,n=[];for(t in r)e=r[t],(e=service.casts[e])&&n.push(this._attrs[t]=e(this._attrs[t]));return n},r.prototype.getIdAttrName=function(){return"id"},r.prototype.getName=function(){return this._name},r.prototype.getAttrs=function(t){return null==t&&(t=!1),null!=this._attrs.version&&(this._modifiedAttrs.version=this._attrs.version),t?_.extend({},this._modifiedAttrs):_.extend({},this._attrs,this._modifiedAttrs)},r.prototype.setAttrs=function(t){return this._attrs=t,this._modifiedAttrs={},this.applyCasts(),this._isModified=!1},r.prototype.setAttr=function(t,e){return this._modifiedAttrs[t]=e,this._isModified=!0},r.prototype.initialize=function(){var n=this,i=function(t){return function(){return("string"==typeof t&&"__"===t.substr(0,2)?n:e.call(_.keys(n._modifiedAttrs),t)<0?n._attrs:n._modifiedAttrs)[t]}},o=function(e){return function(t){"string"!=typeof e||"__"!==e.substr(0,2)?n._attrs[e]!==t?(n._modifiedAttrs[e]=t,n._isModified=!0):delete n._modifiedAttrs[e]:n[e]=t}};return _.each(this._attrs,function(t,e){var r={get:i(e),set:o(e),enumerable:!0,configurable:!0};return Object.defineProperty(n,e,r)})},r.prototype.serialize=function(){var t={data:_.clone(this._attrs),name:this._name};return JSON.stringify(t)},r.prototype.isModified=function(){return this._isModified},r.prototype.isAttributeModified=function(t){return null!=this._modifiedAttrs[t]},r.prototype.markSaved=function(){return this._isModified=!1,this._attrs=this.getAttrs(),this._modifiedAttrs={}},r.prototype.revert=function(){return this._modifiedAttrs={},this._isModified=!1},r.desSerialize=function(t){t=JSON.parse(t);return new r(t.url,t.data)},o=r,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(s,this.taiga.Service),s.$inject=["$q","$tgUrls","$tgStorage","$tgHttp"],t=function(t,e,r,n){var i={make_model:function(t,e,r,n){return null==r&&(r=o),null==n&&(n={}),new r(t,e,n)}};return i.cls=o,i.casts={int:function(t){return parseInt(t,10)},float:function(t){return parseFloat(t,10)}},i},angular.module("taigaBase").factory("$tgModel",["$q","$http","$tgUrls","$tgStorage",t])}.call(this),function(){var o,t,e,h,i={}.hasOwnProperty;function r(){this.urls={}}e=this.taiga,h=this.taiga.trim,o=this.taiga.bindOnce,t=angular.module("taigaBase"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,e.Service),r.prototype.update=function(t){return this.urls=_.merge({},this.urls,t||{})},r.prototype.formatUrl=function(t,e){var r;return null==e&&(e={}),r=function(t){return t=h(t,":"),e[t]||":"+t},t.replace(/(:\w+)/g,r)},r.prototype._resolve=function(t,e){t=this.urls[t];return t?e?this.formatUrl(t,e):t:""},r.prototype.resolve=function(t,e){e=this._resolve(t,e);return e.startsWith("/")?e.slice(1):e},t.service("$tgNavUrls",r),e=function(c,u,n,l,p,d){var i=function(t,e){var r=n.defer();return o(t,e,function(t){return r.resolve(t)}),r.promise},e=function(t,o){var e,r,n,t=_.map(t.split(":"),h),s=t[0],a=t[1];if(a)for(n=a.split(/(\w+)=/),n=_.filter(n,function(t){return t.length}),n=_.map(n,function(t){return h(t.replace(/,$/g,""))}),a=[],e=0;e<n.length;)(r={})[n[e]]=n[e+1],a.push(r),e+=2;else a=[];return t=_.map(a,function(t){return _.values(t)[0]}),t=_.map(t,function(t){return i(o,t)}),Promise.all(t).then(function(){for(var t,e,r={},n=0,i=a.length;n<i;n++)e=(e=a[n])[t=Object.keys(e)[0]],r[t]=o.$eval(e);return[s,r]})};return{link:function(o,s,a){return s.is("a")&&s.attr("href","#"),s.on("pointerenter",function(t){var i=$(t.currentTarget);if(!i.data("fullUrl")||a.tgNavGetParams!==i.data("params"))return e(a.tgNav,o).then(function(t){var e,r=t[0],n=t[1],t=u.getUser();return t&&(n.user=t.username),"project"===r&&(r=r+"-"+d.getPath(n.project,n.section)),r=c.resolve(r),e=c.formatUrl(r,n),a.tgNavGetParams&&(n=JSON.parse(a.tgNavGetParams),n=$.param(n),e=e+"?"+n,i.data("params",a.tgNavGetParams)),i.data("fullUrl",e),i.is("a")&&i.attr("href",e),s.on("click",function(t){if(!t.metaKey&&!t.ctrlKey&&(t.preventDefault(),!(i=$(t.currentTarget)).hasClass("noclick"))){switch(e=i.data("fullUrl"),t.which){case 1:l.url(e),o.$apply();break;case 2:window.open(e)}return p.closeAll()}})})}),o.$on("$destroy",function(){return s.off()})}}},t.directive("tgNav",["$tgNavUrls","$tgAuth","$q","$tgLocation","lightboxService","$tgSections",e])}.call(this),function(){var t,i={}.hasOwnProperty;function o(t,e,r,n,i){this.q=t,this.model=e,this.storage=r,this.http=n,this.urls=i,o.__super__.constructor.call(this)}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(o,this.taiga.Service),o.$inject=["$q","$tgModel","$tgStorage","$tgHttp","$tgUrls"],o.prototype.resolveUrlForModel=function(t){var e=t.getIdAttrName();return this.urls.resolve(t.getName())+"/"+t[e]},o.prototype.resolveUrlForAttributeModel=function(t){return this.urls.resolve(t.getName(),t.parent)},o.prototype.create=function(r,t,n,e){var i,o,s;return null==n&&(n={}),null==e&&(e={}),i=this.q.defer(),o=this.urls.resolve(r),(e=this.http.post(o,JSON.stringify(t),e)).success((s=this,function(t,e){return i.resolve(s.model.make_model(r,t,null,n))})),e.error(function(t,e){return i.reject(t)}),i.promise},o.prototype.remove=function(r,t){var n,e;return null==t&&(t={}),n=this.q.defer(),e=this.resolveUrlForModel(r),(t=this.http.delete(e,{},t)).success(function(t,e){return n.resolve(r)}),t.error(function(t,e){return n.reject(r)}),n.promise},o.prototype.saveAll=function(t,e){var r;return null==e&&(e=!0),t=_.map(t,(r=this,function(t){return r.save(t,!0)})),this.q.all(t)},o.prototype.save=function(i,t,e,r,o){var n,s,a;return null==t&&(t=!0),null==e&&(e={}),null==o&&(o=!1),s=this.q.defer(),!i.isModified()&&t?s.resolve(i):(a=this.resolveUrlForModel(i),n=JSON.stringify(i.getAttrs(t)),(r=t?this.http.patch(a,n,e,r):this.http.put(a,n,e,r)).success(function(t,e,r,n){return i._isModified=!1,i._attrs=_.extend(i.getAttrs(),t),i._modifiedAttrs={},i.applyCasts(),o?s.resolve([i,r()]):s.resolve(i)}),r.error(function(t,e){return s.reject(t)})),s.promise},o.prototype.saveAttribute=function(r,t,e){var n,i,o;return null==e&&(e=!0),n=this.q.defer(),null!=r&&r.isModified()||!e?(o=this.resolveUrlForAttributeModel(r),(i={})[t]=r.getAttrs(),(i=e?this.http.patch(o,i):this.http.put(o,i)).success(function(t,e){return r._isModified=!1,r._attrs=_.extend(r.getAttrs(),t),r._modifiedAttrs={},r.applyCasts(),n.resolve(r)}),i.error(function(t,e){return n.reject(t)})):n.resolve(r),n.promise},o.prototype.refresh=function(r){var n=this.q.defer(),t=this.resolveUrlForModel(r),t=this.http.get(t);return t.success(function(t,e){return r._modifiedAttrs={},r._attrs=t,r._isModified=!1,r.applyCasts(),n.resolve(r)}),t.error(function(t,e){return n.reject(t)}),n.promise},o.prototype.queryMany=function(r,t,e,n){var i,o,s;return null==e&&(e={}),null==n&&(n=!1),o=this.urls.resolve(r),i={headers:{}},e.enablePagination||(i.headers["x-disable-pagination"]="1"),this.http.get(o,t,i).then((s=this,function(t){var e=_.map(t.data,function(t){return s.model.make_model(r,t)});return n?[e,t.headers]:e}))},o.prototype.queryOneAttribute=function(e,r,n,t,i){var o,s,a;return null==i&&(i={}),s=this.urls.resolve(e,r),o={headers:{}},i.enablePagination||(o.headers["x-disable-pagination"]="1"),this.http.get(s,t,o).then((a=this,function(t){t=a.model.make_model(e,t.data[n]);return t.parent=r,t}))},o.prototype.queryOne=function(e,t,r,n){var i,o;return null==n&&(n={}),i=this.urls.resolve(e),t&&(i=i+"/"+t),t={headers:{}},n.enablePagination||(t.headers["x-disable-pagination"]="1"),this.http.get(i,r,t).then((o=this,function(t){return o.model.make_model(e,t.data)}))},o.prototype.queryOneRaw=function(t,e,r,n){return null==n&&(n={}),t=this.urls.resolve(t),e&&(t=t+"/"+e),e=_.merge({headers:{}},n),n.enablePagination||(e.headers["x-disable-pagination"]="1"),this.http.get(t,r,e).then(function(t){return t.data})},o.prototype.queryPaginated=function(n,t,e){var r,i;return null==e&&(e={}),r=this.urls.resolve(n),e=_.merge({headers:{}},e),this.http.get(r,t,e).then((i=this,function(t){var e=t.headers(),r={};return r.models=_.map(t.data,function(t){return i.model.make_model(n,t)}),r.count=parseInt(e["x-pagination-count"],10),r.current=parseInt(e["x-pagination-current"]||1,10),r.paginatedBy=parseInt(e["x-paginated-by"],10),r}))},o.prototype.queryOnePaginatedRaw=function(t,e,r,n){return null==n&&(n={}),t=this.urls.resolve(t),e&&(t=t+"/"+e),n=_.merge({headers:{}},n),this.http.get(t,r,n).then(function(t){var e=t.headers(),r={};return r.data=t.data,r.count=parseInt(e["x-pagination-count"],10),r.current=parseInt(e["x-pagination-current"]||1,10),r.paginatedBy=parseInt(e["x-paginated-by"],10),r})},o.prototype.resolve=function(t){var e={};return null!=t.pslug&&(e.project=t.pslug),null!=t.usref&&(e.us=t.usref),null!=t.taskref&&(e.task=t.taskref),null!=t.issueref&&(e.issue=t.issueref),null!=t.sslug&&(e.milestone=t.sslug),null!=t.wikipage&&(e.wikipage=t.wikipage),null!=t.ref&&(e.ref=t.ref),t=!(t.wikipage||t.sslug),this.queryOneRaw("resolver",null,e,{cache:t})},t=o,angular.module("taigaBase").service("$tgRepo",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t){e.__super__.constructor.call(this)}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.$inject=["$rootScope"],e.prototype.get=function(t,e){var r=localStorage.getItem(t);if(null===r)return e||null;try{return JSON.parse(r)}catch(t){return null}},e.prototype.set=function(t,e){return _.isObject(t)?_.each(t,(r=this,function(t,e){return r.set(e,t)})):localStorage.setItem(t,JSON.stringify(e));var r},e.prototype.contains=function(t){return null!==this.get(t)},e.prototype.remove=function(t){return localStorage.removeItem(t)},e.prototype.clear=function(){return localStorage.clear()},t=e,angular.module("taigaBase").service("$tgStorage",t)}.call(this),function(){var t,r,i={}.hasOwnProperty;function e(t){this.config=t,this.urls={},this.mainUrl=this.config.get("api")}r=function(t,e){return e=_.clone(e),t.replace(/%s/g,function(t){return String(e.shift())})},function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,this.taiga.Service),e.$inject=["$tgConfig"],e.prototype.update=function(t){return this.urls=_.merge(this.urls,t)},e.prototype.resolve=function(){var t,e=_.toArray(arguments);if(0===e.length)throw Error("wrong arguments to setUrls");return t=e.slice(0,1)[0],e=r(this.urls[t],e.slice(1)),r("%s/%s",[_.trimEnd(this.mainUrl,"/"),_.trimStart(e,"/")])},e.prototype.resolveAbsolute=function(){var t=this.resolve.apply(this,arguments);return/^https?:\/\//i.test(t)?t:/^\//.test(t)?window.location.protocol+"//"+window.location.host+t:window.location.protocol+"//"+window.location.host+"/"+t},t=e,angular.module("taigaBase").service("$tgUrls",t)}.call(this),function(){this.taiga;var t=function(r){var e=function(t,e){return r.queryOne(e,t)},n={epic:{get:function(t){return e(t,"custom-attributes-values/epic")}},userstory:{get:function(t){return e(t,"custom-attributes-values/userstory")}},task:{get:function(t){return e(t,"custom-attributes-values/task")}},issue:{get:function(t){return e(t,"custom-attributes-values/issue")}}};return function(t){return t.customAttributesValues=n}};angular.module("taigaResources").factory("$tgCustomAttributesValuesResourcesProvider",["$tgRepo",t])}.call(this),function(){this.taiga,this.taiga.sizeFormat;var t=function(r){var e=function(t,e){return r.queryMany(e,{project:t})},n={epic:{list:function(t){return e(t,"custom-attributes/epic")}},userstory:{list:function(t){return e(t,"custom-attributes/userstory")}},task:{list:function(t){return e(t,"custom-attributes/task")}},issue:{list:function(t){return e(t,"custom-attributes/issue")}}};return function(t){return t.customAttributes=n}};angular.module("taigaResources").factory("$tgCustomAttributesResourcesProvider",["$tgRepo",t])}.call(this),function(){var a=this.taiga.generateHash,t=function(n,e,r,i){var o={},s="epics-queryparams";return o.getByRef=function(t,e){var r=o.getQueryParams(t);return r.project=t,r.ref=e,n.queryOne("epics","by_ref",r)},o.listValues=function(t,e){var r={project:t};return o.storeQueryParams(t,r),n.queryMany(e,r)},o.storeQueryParams=function(t,e){t=a([t,t+":"+s]);return i.set(t,e)},o.getQueryParams=function(t){t=a([t,t+":"+s]);return i.get(t)||{}},o.upvote=function(t){t=r.resolve("epic-upvote",t);return e.post(t)},o.downvote=function(t){t=r.resolve("epic-downvote",t);return e.post(t)},o.watch=function(t){t=r.resolve("epic-watch",t);return e.post(t)},o.unwatch=function(t){t=r.resolve("epic-unwatch",t);return e.post(t)},function(t){return t.epics=o}};angular.module("taigaResources").factory("$tgEpicsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage",t])}.call(this),function(){this.taiga;var t=function(n,i,o){var e={get:function(t,e,r){return n.queryOneRaw("history/"+t,e,{type:r})},editComment:function(t,e,r,n){t=o.resolve("history/"+t);return t=t+"/"+e+"/edit_comment",r={id:r},n={comment:n},i.post(t,n,r).then(function(t){return t.data})},getCommentHistory:function(t,e,r){t=o.resolve("history/"+t);return t=t+"/"+e+"/comment_versions",r={id:r},i.get(t,r).then(function(t){return t.data})},deleteComment:function(t,e,r){t=o.resolve("history/"+t);return t=t+"/"+e+"/delete_comment",r={id:r},i.post(t,null,r).then(function(t){return t.data})},undeleteComment:function(t,e,r){t=o.resolve("history/"+t);return t=t+"/"+e+"/undelete_comment",r={id:r},i.post(t,null,r).then(function(t){return t.data})}};return function(t){return t.history=e}};angular.module("taigaResources").factory("$tgHistoryResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){this.taiga;var t=function(e){var r={get:function(t){return e.queryOne("invitations",t)}};return function(t){return t.invitations=r}};angular.module("taigaResources").factory("$tgInvitationsResourcesProvider",["$tgRepo",t])}.call(this),function(){var l=this.taiga.generateHash,t=function(i,o,s,r,t){var a={},n="issues-queryparams",c="taskboard-issues",u="issues-list";return a.get=function(t,e){var r=a.getQueryParams(t);return r.project=t,i.queryOne("issues",e,r)},a.getByRef=function(t,e){var r=a.getQueryParams(t);return r.project=t,r.ref=e,i.queryOne("issues","by_ref",r)},a.listInAllProjects=function(t){return i.queryMany("issues",t)},a.list=function(t,e,r){var n={project:t};return n=_.extend({},n,e||{}),a.storeQueryParams(t,n),i.queryPaginated("issues",n,r)},a.listInProject=function(t,e,r){return null==e&&(e=null),r=_.merge(r,{project:t}),e&&(r.milestone=e),a.storeQueryParams(t,r),i.queryMany("issues",r)},a.bulkCreate=function(t,e,r){var n=s.resolve("bulk-create-issues"),r={project_id:t,milestone_id:e,bulk_issues:r};return o.post(n,r)},a.upvote=function(t){t=s.resolve("issue-upvote",t);return o.post(t)},a.downvote=function(t){t=s.resolve("issue-downvote",t);return o.post(t)},a.watch=function(t){t=s.resolve("issue-watch",t);return o.post(t)},a.unwatch=function(t){t=s.resolve("issue-unwatch",t);return o.post(t)},a.stats=function(t){return i.queryOneRaw("projects",t+"/issues_stats")},a.filtersData=function(t){return i.queryOneRaw("issues-filters",null,t)},a.listValues=function(t,e){var r={project:t};return a.storeQueryParams(t,r),i.queryMany(e,r)},a.createDefaultValues=function(t,e){t={project_id:t},e=s.resolve(e+"-create-default");return o.post(e,t)},a.storeQueryParams=function(t,e){t=l([t,t+":"+n]);return r.set(t,e)},a.getQueryParams=function(t){t=l([t,t+":"+n]);return r.get(t)||{}},a.bulkUpdateMilestone=function(t,e,r){var n=s.resolve("bulk-update-issue-milestone"),r={project_id:t,milestone_id:e,bulk_issues:r};return o.post(n,r)},a.promoteToUserStory=function(t,e){t=s.resolve("promote-issue-to-us",t),e={project_id:e};return o.post(t,e)},a.storeIssuesShowTags=function(t,e){t=l([t,t+":"+u]);return r.set(t,e)},a.getIssuesShowTags=function(t){t=l([t,t+":"+u]);return r.get(t)},a.storeSprintShowTags=function(t,e){t=l([t,t+":"+c]);return r.set(t,e)},a.getSprintShowTags=function(t){t=l([t,t+":"+c]);return r.get(t)},function(t){return t.issues=a}};angular.module("taigaResources").factory("$tgIssuesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage","$q",t])}.call(this),function(){var o=this.taiga.generateHash,t=function(r){var e={},n="kanban-statuscolumnmodels",i="kanban-swimlanesmodels";return e.storeStatusColumnModes=function(t,e){t=o([t,t+":"+n]);return r.set(t,e)},e.getStatusColumnModes=function(t){t=o([t,t+":"+n]);return r.get(t)||{}},e.storeSwimlanesModes=function(t,e){t=o([t,t+":"+i]);return r.set(t,e)},e.getSwimlanesModes=function(t){t=o([t,t+":"+i]);return r.get(t)||{}},function(t){return t.kanban=e}};angular.module("taigaResources").factory("$tgKanbanResourcesProvider",["$tgStorage",t])}.call(this),function(){this.taiga,this.taiga.sizeFormat;var t=function(t){var e={list:function(){return t.queryMany("locales")}};return function(t){return t.locales=e}};angular.module("taigaResources").factory("$tgLocalesResourcesProvider",["$tgRepo",t])}.call(this),function(){this.taiga;var t=function(t,r,n){var e={render:function(t,e){return null!=e&&""!==e||(e=" "),t={project_id:t,content:e},e=r.resolve("wiki"),n.post(e+"/render",t).then(function(t){return t.data})}};return function(t){return t.mdrender=e}};angular.module("taigaResources").factory("$tgMdRenderResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",t])}.call(this),function(){this.taiga;var t=function(n,i,o){var e={get:function(t){return n.queryOne("memberships",t)},list:function(t,e,r){return null==r&&(r=!0),t={project:t},t=_.extend({},t,e||{}),r?n.queryPaginated("memberships",t):n.queryMany("memberships",t,{enablePagination:r})},listByUser:function(t,e){t={user:t};return t=_.extend({},t,e||{}),n.queryPaginated("memberships",t)},resendInvitation:function(t){var e=o.resolve("memberships");return i.post(e+"/"+t+"/resend_invitation",{})},bulkCreateMemberships:function(t,e,r){var n=o.resolve("bulk-create-memberships"),r={project_id:t,bulk_memberships:e,invitation_extra_text:r};return i.post(n,r)}};return function(t){return t.memberships=e}};angular.module("taigaResources").factory("$tgMembershipsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var t=function(r){var e={list:function(t,e){return r.queryOneAttribute("project-modules",t,e)}};return function(t){return t.modules=e}};angular.module("taigaResources").factory("$tgModulesResourcesProvider",["$tgRepo",t])}.call(this),function(){this.taiga;var t=function(e,t,r){var n={get:function(t){return e.queryOne("notify-policies",t)},list:function(t){t=_.extend({},void 0,t||{});return e.queryMany("notify-policies",t)}};return function(t){return t.notifyPolicies=n}};angular.module("taigaResources").factory("$tgNotifyPoliciesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){this.taiga;var m=this.taiga.sizeFormat,t=function(l,r,o,p,d,h,f){var e={get:function(t){return r.queryOne("projects",t)},getBySlug:function(t){return r.queryOne("projects","by_slug?slug="+t)},list:function(t){var e={order_by:"user_order"};return e=_.extend({},e,t||{}),r.queryMany("projects",e)},listByMember:function(t){t={member:t,order_by:"user_order"};return r.queryMany("projects",t)},templates:function(){return r.queryMany("project-templates")},usersList:function(t){t={project:t};return r.queryMany("users",t)},rolesList:function(t){t={project:t};return r.queryMany("roles",t)},stats:function(t){return r.queryOneRaw("projects",t+"/stats")},bulkUpdateOrder:function(t){var e=p.resolve("bulk-update-projects-order");return o.post(e,t)},regenerate_epics_csv_uuid:function(t){t=p.resolve("projects")+"/"+t+"/regenerate_epics_csv_uuid";return o.post(t)},regenerate_userstories_csv_uuid:function(t){t=p.resolve("projects")+"/"+t+"/regenerate_userstories_csv_uuid";return o.post(t)},regenerate_tasks_csv_uuid:function(t){t=p.resolve("projects")+"/"+t+"/regenerate_tasks_csv_uuid";return o.post(t)},regenerate_issues_csv_uuid:function(t){t=p.resolve("projects")+"/"+t+"/regenerate_issues_csv_uuid";return o.post(t)},delete_epics_csv_uuid:function(t){t=p.resolve("projects")+"/"+t+"/delete_epics_csv_uuid";return o.post(t)},delete_userstories_csv_uuid:function(t){t=p.resolve("projects")+"/"+t+"/delete_userstories_csv_uuid";return o.post(t)},delete_tasks_csv_uuid:function(t){t=p.resolve("projects")+"/"+t+"/delete_tasks_csv_uuid";return o.post(t)},patch_default_swimlane:function(t,e){t=p.resolve("projects")+"/"+t,e={default_swimlane:e};return o.patch(t,e)},delete_issues_csv_uuid:function(t){t=p.resolve("projects")+"/"+t+"/delete_issues_csv_uuid";return o.post(t)},leave:function(t){t=p.resolve("projects")+"/"+t+"/leave";return o.post(t)},memberStats:function(t){return r.queryOneRaw("projects",t+"/member_stats")},tagsColors:function(t){return r.queryOne("projects",t+"/tags_colors")},deleteTag:function(t,e){t=p.resolve("projects")+"/"+t+"/delete_tag";return o.post(t,{tag:e})},createTag:function(t,e,r){var n=p.resolve("projects")+"/"+t+"/create_tag",t={};return t.tag=e,t.color=null,r&&(t.color=r),o.post(n,t)},editTag:function(t,e,r,n){var i=p.resolve("projects")+"/"+t+"/edit_tag",t={};return t.from_tag=e,r&&(t.to_tag=r),t.color=null,n&&(t.color=n),o.post(i,t)},mixTags:function(t,e,r){t=p.resolve("projects")+"/"+t+"/mix_tags";return o.post(t,{to_tag:e,from_tags:r})},export:function(t){t=p.resolve("exporter")+"/"+t;return o.get(t)},import:function(t,r){var e,n,i,o,s,a,c=h.defer(),u=l.get("maxUploadFileSize",null);return u&&t.size>u?(n=f.instant("PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED",{fileName:t.name,fileSize:m(t.size),maxFileSize:m(u)}),i={status:413,data:{_error_message:n}},c.reject(i)):(a=function(t){var e=Math.round(t.loaded/t.total*100),t=f.instant("PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE",{uploadedSize:m(t.loaded),totalSize:m(t.total)});return r("in-progress",null,t,e)},o=function(t){return r("done",f.instant("PROJECT.IMPORT.TITLE"),f.instant("PROJECT.IMPORT.DESCRIPTION"))},s=function(t){return r("error")},e=function(t){var e;i={};try{i.data=JSON.parse(t.target.responseText)}catch(t){i.data={}}return i.status=t.target.status,t.target.getResponseHeader("Taiga-Info-Project-Is-Private")&&(i.headers={isPrivate:"True"===t.target.getResponseHeader("Taiga-Info-Project-Is-Private"),memberships:parseInt(t.target.getResponseHeader("Taiga-Info-Project-Memberships"))}),201!==(e=i.status)&&202!==e||c.resolve(i),c.reject(i)},u=function(t){return c.reject("fail")},(n=new FormData).append("dump",t),(t=new XMLHttpRequest).upload.addEventListener("progress",a,!1),t.upload.addEventListener("load",o,!1),t.upload.addEventListener("error",s,!1),t.upload.addEventListener("abort",s,!1),t.addEventListener("load",e,!1),t.addEventListener("error",u,!1),t.open("POST",p.resolve("importer")),t.setRequestHeader("Authorization","Bearer "+d.getToken()),t.setRequestHeader("Accept","application/json"),t.send(n)),c.promise},changeLogo:function(t,e){var r,n=l.get("maxUploadFileSize",null);return n&&e.size>n?(n={status:413,data:{_error_message:"'"+e.name+"' ("+m(e.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+m(n)+")"}},(r=h.defer()).reject(n),r.promise):((r=new FormData).append("logo",e),e={transformRequest:angular.identity,headers:{"Content-Type":void 0}},t=p.resolve("projects")+"/"+t+"/change_logo",o.post(t,r,{},e))},removeLogo:function(t){t=p.resolve("projects")+"/"+t+"/remove_logo";return o.post(t)}};return function(t){return t.projects=e}};angular.module("taigaResources").factory("$tgProjectsResourcesProvider",["$tgConfig","$tgRepo","$tgHttp","$tgUrls","$tgAuth","$q","$translate",t])}.call(this),function(){this.taiga;var t=function(e,t,r){var n={get:function(t){return e.queryOne("roles",t)},list:function(t){return e.queryMany("roles",{project:t})}};return function(t){return t.roles=n}};angular.module("taigaResources").factory("$tgRolesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){this.taiga;var t=function(t,i,o,s){var e={do:function(t,e){var r=s.defer(),e={url:i.resolve("search"),method:"GET",timeout:r.promise,cancelable:!0,params:{project:t,text:e,get_all:!1}},n=o.request(e).then(function(t){return t.data});return n.abort=function(){return r.resolve()},n.finally=function(){return n.abort=angular.noop,r=n=null},n}};return function(t){return t.search=e}};angular.module("taigaResources").factory("$tgSearchResourcesProvider",["$tgRepo","$tgUrls","$tgHttp","$q",t])}.call(this),function(){this.taiga.generateHash;var t=function(r,s,t,i,o){var e={get:function(t,e){return r.queryOne("milestones",e).then(function(t){var e=t.user_stories;return e=_.map(e,function(t){return s.make_model("userstories",t)}),t._attrs.user_stories=e,t})},stats:function(t,e){return r.queryOneRaw("milestones",e+"/stats")},list:function(t,e){t={project:t};return t=_.extend({},t,e||{}),r.queryMany("milestones",t,{},!0).then(function(t){for(var e,r,n=t[0],t=t[1],i=0,o=n.length;i<o;i++)r=(e=n[i]).user_stories,r=_.map(r,function(t){return s.make_model("userstories",t)}),e._attrs.user_stories=r;return{milestones:n,closed:parseInt(t("Taiga-Info-Total-Closed-Milestones"),10),open:parseInt(t("Taiga-Info-Total-Opened-Milestones"),10)}})},moveUserStoriesMilestone:function(t,e,r,n){t=o.resolve("move-userstories-to-milestone",t),n={project_id:e,milestone_id:r,bulk_stories:n};return i.post(t,n)},moveTasksMilestone:function(t,e,r,n){t=o.resolve("move-tasks-to-milestone",t),n={project_id:e,milestone_id:r,bulk_tasks:n};return i.post(t,n)},moveIssuesMilestone:function(t,e,r,n){t=o.resolve("move-issues-to-milestone",t),n={project_id:e,milestone_id:r,bulk_issues:n};return i.post(t,n)}};return function(t){return t.sprints=e}};angular.module("taigaResources").factory("$tgSprintsResourcesProvider",["$tgRepo","$tgModel","$tgStorage","$tgHttp","$tgUrls",t])}.call(this),function(){this.taiga.generateHash;var t=function(e,i,o){var r={list:function(t){t={project:t};return e.queryMany("swimlanes",t)},create:function(t,e,r){var n=o.resolve("swimlanes"),e={project:t,name:e};return r&&(e.order=r),i.post(n,e)},edit:function(t,e){var r=o.resolve("swimlanes");return r=r+"/"+t,e={name:e},i.patch(r,e)},bulkUpdateOrder:function(t,e){var r=o.resolve("swimlanes");return r+="/bulk_update_order",e={project:t,bulk_swimlanes:e},i.post(r,e)},wipLimitUpdate:function(t,e){var r=o.resolve("swimlane-userstory-statuses");return r=r+"/"+t,e={wip_limit:e},i.patch(r,e)},delete:function(t,e){var r=o.resolve("swimlanes");return r=e?r+"/"+t+"?moveTo="+e:r+"/"+t,i.delete(r)}};return function(t){return t.swimlanes=r}};angular.module("taigaResources").factory("$tgSwimlanesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var l=this.taiga.generateHash,t=function(i,o,s,n){var a={},r="tasks-queryparams",c="tasks-statuscolumnmodels",u="tasks-usrowmodels";return a.get=function(t,e,r){var n=a.getQueryParams(t);return n.project=t,n=_.extend({},n,r),i.queryOne("tasks",e,n)},a.getByRef=function(t,e,r){var n=a.getQueryParams(t);return n.project=t,n.ref=e,n=_.extend({},n,r),i.queryOne("tasks","by_ref",n)},a.listInAllProjects=function(t){return i.queryMany("tasks",t)},a.filtersData=function(t){return i.queryOneRaw("task-filters",null,t)},a.list=function(t,e,r,n){return null==e&&(e=null),null==r&&(r=null),n=_.merge(n,{project:t,order_by:"us_order"}),e&&(n.milestone=e),r&&(n.user_story=r),a.storeQueryParams(t,n),i.queryMany("tasks",n)},a.bulkCreate=function(t,e,r,n){var i=s.resolve("bulk-create-tasks"),n={project_id:t,milestone_id:e,us_id:r,bulk_tasks:n};return o.post(i,n).then(function(t){return t.data})},a.upvote=function(t){t=s.resolve("task-upvote",t);return o.post(t)},a.downvote=function(t){t=s.resolve("task-downvote",t);return o.post(t)},a.watch=function(t){t=s.resolve("task-watch",t);return o.post(t)},a.unwatch=function(t){t=s.resolve("task-unwatch",t);return o.post(t)},a.bulkUpdateTaskTaskboardOrder=function(t,e){var r=s.resolve("bulk-update-task-taskboard-order"),e={project_id:t,bulk_tasks:e};return o.post(r,e)},a.bulkUpdateMilestone=function(t,e,r){var n=s.resolve("bulk-update-task-milestone"),r={project_id:t,milestone_id:e,bulk_tasks:r};return o.post(n,r)},a.reorder=function(t,e,r){t=s.resolve("tasks")+"/"+t,r={headers:{"set-orders":JSON.stringify(r)}};return o.patch(t,e,null,r).then(function(t){return t.data})},a.listValues=function(t,e){t={project:t};return i.queryMany(e,t)},a.createDefaultValues=function(t,e){t={project_id:t},e=s.resolve(e+"-create-default");return o.post(e,t)},a.storeQueryParams=function(t,e){t=l([t,t+":"+r]);return n.set(t,e)},a.getQueryParams=function(t){t=l([t,t+":"+r]);return n.get(t)||{}},a.storeStatusColumnModes=function(t,e){t=l([t,t+":"+c]);return n.set(t,e)},a.getStatusColumnModes=function(t){t=l([t,t+":"+c]);return n.get(t)||{}},a.storeUsRowModes=function(t,e,r){t=l([t,e,t+":"+u]);return n.set(t,r)},a.getUsRowModes=function(t,e){t=l([t,e,t+":"+u]);return n.get(t)||{}},a.promoteToUserStory=function(t,e){t=s.resolve("promote-task-to-us",t),e={project_id:e};return o.post(t,e)},function(t){return t.tasks=a}};angular.module("taigaResources").factory("$tgTasksResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage",t])}.call(this),function(){this.taiga;var t=function(e,t,r){var n={get:function(t){return e.queryOne("user-project-settings",t)},list:function(t){t=_.extend({},void 0,t||{});return e.queryMany("user-project-settings",t)}};return function(t){return t.userProjectSettings=n}};angular.module("taigaResources").factory("$tgUserProjectSettingsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){this.taiga;var c=this.taiga.sizeFormat,t=function(i,t,o,s,a){var e={changeAvatar:function(t){var e,r,n=i.get("maxUploadFileSize",null);return n&&t.size>n?(r={status:413,data:{_error_message:"'"+t.name+"' ("+c(t.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+c(n)+")"}},(e=a.defer()).reject(r),e.promise):((r=new FormData).append("avatar",t),e={transformRequest:angular.identity,headers:{"Content-Type":void 0}},t=s.resolve("users")+"/change_avatar",o.post(t,r,{},e))},removeAvatar:function(){var t=s.resolve("users")+"/remove_avatar";return o.post(t)},changePassword:function(t,e){var r=s.resolve("users")+"/change_password",e={current_password:t,password:e};return o.post(r,e)}};return function(t){return t.userSettings=e}};angular.module("taigaResources").factory("$tgUserSettingsResourcesProvider",["$tgConfig","$tgRepo","$tgHttp","$tgUrls","$q",t])}.call(this),function(){this.taiga,this.taiga.sizeFormat;var t=function(n,i){var e={contacts:function(t,e){var r;return null==e&&(e={}),r=i.resolve("user-contacts",t),t={headers:{}},e.enablePagination||(t.headers["x-disable-pagination"]="1"),n.get(r,{},t).then(function(t){return t.data})}};return function(t){return t.users=e}};angular.module("taigaResources").factory("$tgUsersResourcesProvider",["$tgHttp","$tgUrls","$q",t])}.call(this),function(){var i=this.taiga.generateHash,u="backlog-tags",t=function(o,a,c,r,t){var s={},n="userstories-queryparams";return s.get=function(t,e,r){var n=s.getQueryParams(t);return n.project=t,n=_.extend({},n,r),o.queryOne("userstories",e,n)},s.getByRef=function(t,e,r){var n;return null==r&&(r={}),(n=s.getQueryParams(t)).project=t,n.ref=e,"null"===(n=_.extend({},n,r)).milestone&&(delete n.milestone,delete n["no-milestone"]),o.queryOne("userstories","by_ref",n)},s.listInAllProjects=function(t){return o.queryMany("userstories",t)},s.filtersData=function(t){return o.queryOneRaw("userstories-filters",null,t)},s.listUnassigned=function(t,e,r,n){var i;return null==n&&(n=!0),i={project:t,milestone:"null"},i=_.extend({},i,e||{}),n&&s.storeQueryParams(t,i),o.queryMany("userstories",_.extend(i,{page_size:r}),{enablePagination:!0},!0)},s.listAll=function(t,e){var r={project:t};return r=_.extend({},r,e||{}),s.storeQueryParams(t,r),o.queryMany("userstories",r)},s.bulkCreate=function(t,e,r,n){r={project_id:t,status_id:e,bulk_stories:r,swimlane_id:n},n=c.resolve("bulk-create-us");return a.post(n,r)},s.upvote=function(t){t=c.resolve("userstory-upvote",t);return a.post(t)},s.downvote=function(t){t=c.resolve("userstory-downvote",t);return a.post(t)},s.watch=function(t){t=c.resolve("userstory-watch",t);return a.post(t)},s.unwatch=function(t){t=c.resolve("userstory-unwatch",t);return a.post(t)},s.bulkUpdateBacklogOrder=function(t,e,r,n,i){var o=c.resolve("bulk-update-us-backlog-order"),i={project_id:t,bulk_userstories:i};return e&&(i.milestone_id=e),r?i.after_userstory_id=r:n&&(i.before_userstory_id=n),a.post(o,i)},s.bulkUpdateMilestone=function(t,e,r){var n=c.resolve("bulk-update-us-milestone"),r={project_id:t,milestone_id:e,bulk_stories:r};return a.post(n,r)},s.bulkUpdateKanbanOrder=function(t,e,r,n,i,o){var s=c.resolve("bulk-update-us-kanban-order"),o={project_id:t,status_id:e,bulk_userstories:o};return n?o.after_userstory_id=n:i&&(o.before_userstory_id=i),r&&(o.swimlane_id=r),a.post(s,o)},s.listValues=function(t,e){var r={project:t};return s.storeQueryParams(t,r),o.queryMany(e,r)},s.createDefaultValues=function(t,e){t={project_id:t},e=c.resolve(e+"-create-default");return a.post(e,t)},s.editStatus=function(t,e){var r=c.resolve("userstory-statuses");return r=r+"/"+t,e={wip_limit:e},a.patch(r,e)},s.storeQueryParams=function(t,e){t=i([t,t+":"+n]);return r.set(t,e)},s.getQueryParams=function(t){t=i([t,t+":"+n]);return r.get(t)||{}},s.storeBacklog=function(t,e){t=i([t,t+":backlog-ids"]);return r.set(t,e)},s.getBacklog=function(t){t=i([t,t+":backlog-ids"]);return r.get(t)||[]},s.storeShowTags=function(t,e){t=i([t,t+":"+u]);return r.set(t,e)},s.getShowTags=function(t){t=i([t,t+":"+u]);return r.get(t)},function(t){return t.userstories=s}};angular.module("taigaResources").factory("$tgUserstoriesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage","$q",t])}.call(this),function(){var t=function(e,r,n){var i={list:function(t){t={webhook:t};return e.queryMany("webhooklogs",t)},resend:function(t){t=r.resolve("webhooklogs-resend",t);return n.post(t)}};return function(t){return t.webhooklogs=i}};angular.module("taigaResources").factory("$tgWebhookLogsResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",t])}.call(this),function(){var t=function(e,r,n){var i={list:function(t){t={project:t};return e.queryMany("webhooks",t)},test:function(t){t=r.resolve("webhooks-test",t);return n.post(t)}};return function(t){return t.webhooks=i}};angular.module("taigaResources").factory("$tgWebhooksResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",t])}.call(this),function(){this.taiga;var t=function(r,t,e){var n={get:function(t){return r.queryOne("wiki",t)},getBySlug:function(t,e){return r.queryOne("wiki","by_slug?project="+t+"&slug="+e)},list:function(t){return r.queryMany("wiki",{project:t})},listLinks:function(t){return r.queryMany("wiki-links",{project:t})}};return function(t){return t.wiki=n}};angular.module("taigaResources").factory("$tgWikiResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",t])}.call(this),function(){var p,t,e,r,i={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.auth=u,this.translate=l,this.scope.sectionName=this.translate.instant("CHANGE_PASSWORD.SECTION_NAME"),this.scope.user=this.auth.getUser()}r=this.taiga,t=this.taiga.mixOf,p=this.taiga.debounce,e=angular.module("taigaUserSettings"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(r.Controller,r.PageMixin)),n.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","$translate"],e.controller("UserChangePasswordController",n),r=function(a,c,u,l){return{link:function(r,t,e,n){var i=new checksley.Form(t.find("form")),o=p(2e3,function(t){var e;if(t.preventDefault(),i.validate()){if(r.newPassword1===r.newPassword2)return e=u().target(s).start(),(t=a.userSettings.changePassword(r.currentPassword,r.newPassword1)).then(function(){return e.finish(),c.notify("success")}),t.then(null,function(t){return e.finish(),c.notify("error",t.data._error_message)});c.notify("error",l.instant("CHANGE_PASSWORD.ERROR_PASSWORD_MATCH"))}}),s=t.find(".submit-button");return t.on("submit","form",o),r.$on("$destroy",function(){return t.off()})}}},e.directive("tgUserChangePassword",["$tgResources","$tgConfirm","$tgLoading","$translate",r])}.call(this),function(){this.taiga,this.taiga.bindOnce;var p=this.taiga.debounce,t=function(o,t,s,a,c,u,l){return{link:function(r,n,t){var e,i;return r.$on("deletelightbox:new",function(t,e){return u.open(n)}),r.$on("$destroy",function(){return n.off()}),e=function(){var e=l().target(i).start(),t=o.remove(r.user);return t.then(function(t){return e.finish(),u.close(n),s.logout(),a.path(c.resolve("login"))}),t.then(null,function(){return e.finish(),console.log("FAIL")})},n.on("click",".js-cancel",function(t){return t.preventDefault(),u.close(n)}),n.on("click",".js-confirm",p(2e3,function(t){return t.preventDefault(),e()})),i=n.find(".js-confirm")},templateUrl:"user/lightbox/lightbox-delete-account.html"}};angular.module("taigaUserSettings").directive("tgLbDeleteUser",["$tgRepo","$rootScope","$tgAuth","$tgLocation","$tgNavUrls","lightboxService","$tgLoading",t])}.call(this),function(){var c,t,e,r,i={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a,c,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=c,this.auth=u,this.errorHandlingService=l,this.scope.sectionName="USER_SETTINGS.NOTIFICATIONS.LIVE_SECTION_NAME",this.scope.user=this.auth.getUser(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}r=this.taiga,t=this.taiga.mixOf,c=this.taiga.bindOnce,e=angular.module("taigaUserSettings"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(r.Controller,r.PageMixin)),n.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","tgErrorHandlingService"],n.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then((e=this,function(t){return e.scope.notifyPolicies=t}));var e},e.controller("UserLiveNotificationsController",n),r=function(){return{link:function(t,e,r){return t.$on("$destroy",function(){return e.off()})}}},e.directive("tgUserLiveNotifications",r),r=function(s,a,n){var i=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row" data-index="<%- index %>">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-all-<%- notifyPolicy.id %>"\n             value="2" <% if (notifyPolicy.live_notify_level == 2) { %>checked="checked"<% } %>/>\n      <label for="policy-all-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_ALL"></label>\n    </div>\n  </div>\n  <div class="policy-table-involved">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-involved-<%- notifyPolicy.id %>"\n             value="1" <% if (notifyPolicy.live_notify_level == 1) { %>checked="checked"<% } %> />\n      <label for="policy-involved-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED"></label>\n    </div>\n  </div>\n  <div class="policy-table-none">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-none-<%- notifyPolicy.id %>"\n             value="3" <% if (notifyPolicy.live_notify_level == 3) { %>checked="checked"<% } %> />\n      <label for="policy-none-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_NONE"></label>\n    </div>\n  </div>\n</div>\n<% }) %>');return{link:function(o,e,t){var r=function(){var t;return e.off(),t={notifyPolicies:o.notifyPolicies},t=i(t),e.html(n(t)(o)),e.on("change","input[type=radio]",function(t){var e=angular.element(t.currentTarget),r=e.parents(".policy-table-row").data("index"),n=o.notifyPolicies[r],i=n.live_notify_level;return n.live_notify_level=parseInt(e.val(),10),t=function(){return a.notify("success")},r=function(){return a.notify("error"),e.parents(".policy-table-row").find("input[value="+i+"]").prop("checked",!0)},s.save(n).then(t,r)})};return o.$on("$destroy",function(){return e.off()}),c(o,t.ngModel,r)}}},e.directive("tgUserLiveNotificationsList",["$tgRepo","$tgConfirm","$compile",r])}.call(this),function(){var r,t,e,f,n,i={}.hasOwnProperty;function o(t,e,r,n,i,o,s,a,c,u,l,p,d,h){this.scope=t,this.rootscope=e,this.config=r,this.repo=n,this.confirm=i,this.rs=o,this.params=s,this.q=a,this.location=c,this.navUrls=u,this.auth=l,this.translate=p,this.errorHandlingService=d,this.window=h,this.scope.sectionName="USER_SETTINGS.MENU.SECTION_TITLE",this.scope.project={},this.scope.user=this.auth.getUser(),this.scope.user?(this.scope.lang=this.getLan(),this.scope.theme=this.getTheme()):this.errorHandlingService.permissionDenied(),(h=this.config.get("maxUploadFileSize",null))&&(h=this.translate.instant("USER_SETTINGS.AVATAR_MAX_SIZE",{maxFileSize:f(h)}),this.scope.maxFileSizeMsg=h),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}n=this.taiga,t=this.taiga.mixOf,f=this.taiga.sizeFormat,e=angular.module("taigaUserSettings"),r=this.taiga.debounce,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,t(n.Controller,n.PageMixin)),o.$inject=["$scope","$rootScope","$tgConfig","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","$translate","tgErrorHandlingService","$window"],o.prototype.loadInitialData=function(){var e,r=window._taigaAvailableThemes;return this.scope.availableThemes=this.config.get("themes",[]).filter(function(t){return r.includes(t)}),this.rs.locales.list().then((e=this,function(t){return e.scope.locales=t}))},o.prototype.openDeleteLightbox=function(){return this.rootscope.$broadcast("deletelightbox:new",this.scope.user)},o.prototype.getLan=function(){return this.scope.user.lang||this.translate.preferredLanguage()},o.prototype.getTheme=function(){var t=window._taigaAvailableThemes,e=this.scope.user.theme||this.config.get("defaultTheme")||"taiga";return t.includes(e)||(e="taiga"),e},o.prototype.exportProfile=function(){var r,t=function(t){t=t.data.url;return this.window.open(t,"_blank")},e=function(t){var e;if(null!=(e=t.data)&&e._error_message)return r.confirm.notify("error",t.data._error_message)};return(r=this).auth.exportProfile().then(t,e)},o.prototype.verifyEmail=function(){var r,n,t=function(t){var e=r.translate.instant("USER_PROFILE.VERIFY_EMAIL_SUCCESS");return r.confirm.notify("success",e)},e=function(t){var e;if(null!=(e=t.data)&&e._error_message)return n.confirm.notify("error",t.data._error_message)};return(n=r=this).auth.sendVerificationEmail().then(t,e)},e.controller("UserSettingsController",o),n=function(s,a,c,u){return{link:function(i,o,t){var e=r(2e3,function(t){var e,r,n;if(t.preventDefault(),(r=o.find("form").checksley()).validate())return e=i.user.isAttributeModified("email"),i.user.lang=i.lang,i.user.theme=i.theme,n=function(t){return a.setUser(t),e?(t=u.instant("USER_PROFILE.CHANGE_EMAIL_SUCCESS"),s.success(t)):s.notify("success")},t=function(t){return r.setErrors(t),s.notify("error",t._error_message)},c.save(i.user).then(n,t)});return o.on("submit","form",e),i.$on("$destroy",function(){return o.off()})}}},e.directive("tgUserProfile",["$tgConfirm","$tgAuth","$tgRepo","$translate",n]),n=function(s,a,c,u){return{link:function(e,r,t){var n=function(){return r.find(".size-info").removeClass("hidden")},i=function(t){t=a.make_model("users",t.data);return s.setUser(t),e.user=t,r.find(".loading-overlay").removeClass("active"),u.notify("success")},o=function(t){return 413===t.status&&n(),r.find(".loading-overlay").removeClass("active"),u.notify("error",t.data._error_message)};return r.on("click",".js-change-avatar",function(t){return t.preventDefault(),r.find("#avatar-field").click()}),r.on("change","#avatar-field",function(t){if(e.avatarAttachment)return r.find(".loading-overlay").addClass("active"),c.userSettings.changeAvatar(e.avatarAttachment).then(i,o)}),r.on("click","a.js-use-gravatar",function(t){return r.find(".loading-overlay").addClass("active"),c.userSettings.removeAvatar().then(i,o)}),e.$on("$destroy",function(){return r.off()})}}},e.directive("tgUserAvatar",["$tgAuth","$tgModel","$tgResources","$tgConfirm",n]),n=function(i){return{link:function(t,e,r){var n=i(r.tgAvatarModel).assign;return e.bind("change",function(){return t.$apply(function(){return n(t,e[0].files[0])})})}}},e.directive("tgAvatarModel",["$parse",n])}.call(this),function(){var t=function(){return{link:function(t,e,r){r=r.tgUserSettingsNavigation;return e.find(".active").removeClass("active"),e.find("#usersettingsmenu-"+r).addClass("active"),t.$on("$destroy",function(){return e.off()})}}};angular.module("taigaUserSettings").directive("tgUserSettingsNavigation",t)}.call(this),function(){var c,t,e,r,i={}.hasOwnProperty;function n(t,e,r,n,i,o,s,a){this.scope=t,this.confirm=e,this.rs=r,this.auth=n,this.config=i,this.resources=o,this.currentUserService=s,this.translate=a,this.scope.sectionName="USER_SETTINGS.NOTIFICATIONS.SECTION_NAME",this.scope.user=this.auth.getUser(),this.loadInitialData().then(null,this.onInitialDataError.bind(this)),this.isSaas=this.config.get("isSaas"),this.onPremiseSubscribed=!1,this.loadPremise=!1}r=this.taiga,t=this.taiga.mixOf,c=this.taiga.bindOnce,e=angular.module("taigaUserSettings"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(r.Controller,r.PageMixin)),n.$inject=["$scope","$tgConfirm","$tgResources","$tgAuth","$tgConfig","tgResources","tgCurrentUserService","$translate"],n.prototype.subscribed=function(){return this.loadPremise=!0,this.resources.onPremise.subscribeOnPremiseNewsletter({email:this.currentUserService.getUser().get("email"),full_name:this.currentUserService.getUser().get("full_name"),origin_form:"Newsletter sign-up settings"}).then((e=this,function(){e.translate.instant("PROJECT.NEWSLETTER_OPENING.SAVED_PREFERENCE");return e.confirm.notify("success","Your preferences have been save successfully"),e.onPremiseSubscribed=!0,e.loadPremise=!1,e.resources.user.getUserStorage("dont_ask_premise_newsletter").then(function(t){return e.resources.user.setUserStorage("dont_ask_premise_newsletter",!0)}).catch(function(t){return t.status=404,e.resources.user.createUserStorage("dont_ask_premise_newsletter",!1)})})).catch((t=this,function(){return t.confirm.notify("light-error",""),t.loadPremise=!1}));var t,e},n.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then((e=this,function(t){return e.scope.notifyPolicies=t}));var e},e.controller("UserNotificationsController",n),r=function(){return{link:function(t,e,r){return t.$on("$destroy",function(){return e.off()})}}},e.directive("tgUserNotifications",r),r=function(s,a,n){var i=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row" data-index="<%- index %>">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-all-<%- notifyPolicy.id %>"\n             value="2" <% if (notifyPolicy.notify_level == 2) { %>checked="checked"<% } %>/>\n      <label for="policy-all-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_ALL"></label>\n    </div>\n  </div>\n  <div class="policy-table-involved">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-involved-<%- notifyPolicy.id %>"\n             value="1" <% if (notifyPolicy.notify_level == 1) { %>checked="checked"<% } %> />\n      <label for="policy-involved-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED"></label>\n    </div>\n  </div>\n  <div class="policy-table-none">\n    <div class="button-check">\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-none-<%- notifyPolicy.id %>"\n             value="3" <% if (notifyPolicy.notify_level == 3) { %>checked="checked"<% } %> />\n      <label for="policy-none-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_NONE"></label>\n    </div>\n  </div>\n</div>\n<% }) %>');return{link:function(o,e,t){var r=function(){var t;return e.off(),t={notifyPolicies:o.notifyPolicies},t=i(t),e.html(n(t)(o)),e.on("change","input[type=radio]",function(t){var e=angular.element(t.currentTarget),r=e.parents(".policy-table-row").data("index"),n=o.notifyPolicies[r],i=n.notify_level;return n.notify_level=parseInt(e.val(),10),t=function(){return a.notify("success")},r=function(){return a.notify("error"),e.parents(".policy-table-row").find("input[value="+i+"]").prop("checked",!0)},s.save(n).then(t,r)})};return o.$on("$destroy",function(){return e.off()}),c(o,t.ngModel,r)}}},e.directive("tgUserNotificationsList",["$tgRepo","$tgConfirm","$compile",r])}.call(this),function(){var t,e,r,i={}.hasOwnProperty,n=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};function o(t,e,r,n,i,o,s){this.rootScope=t,this.scope=e,this.tgSections=r,this.rs=n,this.repo=i,this.confirm=o,this.currentUserService=s,this.scope.sections=this.tgSections.list(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}r=this.taiga,t=this.taiga.mixOf,this.taiga.bindOnce,e=angular.module("taigaUserSettings"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(o,t(r.Controller,r.PageMixin)),o.$inject=["$rootScope","$scope","$tgSections","$tgResources","$tgRepo","$tgConfirm","tgCurrentUserService"],o.prototype.loadInitialData=function(){return this.rs.userProjectSettings.list().then((e=this,function(t){return e.scope.userProjectSettings=t}));var e},o.prototype.updateCustomHomePage=function(t){var e,r,n=function(){return e.currentUserService.loadProjects(),e.rootScope.$broadcast("dropdown-project-list:updated"),e.confirm.notify("success")},i=function(){return r.confirm.notify("error")};return(r=e=this).repo.save(t).then(n,i)},o.prototype.filteredSections=function(e){return _.filter(this.scope.sections,function(t){t=t.id;return 0<=n.call(e.allowed_sections,t)})},e.controller("UserProjectSettingsController",o)}.call(this),function(){var c,t,e,r,i={}.hasOwnProperty;function n(t,e,r){this.scope=t,this.rs=e,this.auth=r,this.scope.sectionName="USER_SETTINGS.EVENTS.SECTION_NAME",this.scope.user=this.auth.getUser(),this.loadInitialData().then(null,this.onInitialDataError.bind(this))}r=this.taiga,t=this.taiga.mixOf,c=this.taiga.bindOnce,e=angular.module("taigaUserSettings"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(n,t(r.Controller,r.PageMixin)),n.$inject=["$scope","$tgResources","$tgAuth"],n.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then((e=this,function(t){return e.scope.notifyPolicies=t}));var e},e.controller("UserWebNotificationsController",n),r=function(){return{link:function(t,e,r){return t.$on("$destroy",function(){return e.off()})}}},e.directive("tgUserWebNotifications",r),r=function(o,s,n){var a=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <div class="check" data-index="<%- index %>">\n      <input type="checkbox"\n        <% if(notifyPolicy.web_notify_level) { %> checked="checked" <% } %>\n        name="policy-<%- notifyPolicy.id %>" id="policy-<%- notifyPolicy.id %>"/>\n      <div></div>\n      <span class="check-text check-yes" translate="COMMON.YES"></span>\n      <span class="check-text check-no"" translate="COMMON.NO"></span>\n    </div>\n  </div>\n</div>\n<% }) %>');return{link:function(i,e,t){var r=function(){var t;return e.off(),t={notifyPolicies:i.notifyPolicies},t=a(t),e.html(n(t)(i)),e.on("click",".check",function(t){var e=angular.element(t.currentTarget),r=e.data("index"),n=i.notifyPolicies[r];return n.web_notify_level=!n.web_notify_level,t=function(){return s.notify("success"),e.find("input").prop("checked",n.web_notify_level)},r=function(){return s.notify("error")},o.save(n).then(t,r)})};return i.$on("$destroy",function(){return e.off()}),c(i,t.ngModel,r)}}},e.directive("tgUserWebNotificationsList",["$tgRepo","$tgConfirm","$compile",r])}.call(this),function(){angular.module("taigaComponents",[])}.call(this),function(){angular.module("taigaDiscover",[])}.call(this),function(){angular.module("taigaExternalApps",[])}.call(this),function(){angular.module("taigaHistory",[])}.call(this),function(){angular.module("taigaHome",[])}.call(this),function(){angular.module("taigaNavigationBar",[])}.call(this),function(){angular.module("taigaNotifications",[])}.call(this),function(){angular.module("taigaProfile",[])}.call(this),function(){angular.module("taigaProjects",[])}.call(this),function(){angular.module("taigaResources2",[])}.call(this),function(){angular.module("taigaUserTimeline",[])}.call(this),function(){angular.module("taigaUtils",[])}.call(this),function(){angular.module("taigaWikiHistory",[])}.call(this),function(){var t=function(){return{link:function(r,t,e){var n,i,o,s,a=function(t){return r.$evalAsync(function(){return void 0!==r.nextUp?r.renderCount=r.nextUp:r.renderCount=r.nextDown,$(c).removeClass("inc dec")})},c=t.find(".counter-translator");return c.on("transitionend",a),n=!1,i=void 0,s=r.$on("kanban:userstories:loaded",function(){return n=!0,s()}),o=function(e){var t=function(t){return{current:t,wip:e.wip}};return r.nextUp=void 0,r.nextDown=void 0,r.data&&void 0!==r.data.count?i!==r.data.count?n&&void 0!==i?(r.data.count>i?(i=r.data.count,r.nextUp=t(r.data.count)):r.data.count<i&&(i=r.data.count,r.nextDown=t(r.data.count)),void 0!==r.nextUp||void 0!==r.nextDown?(c.removeClass("inc dec"),r.$evalAsync(function(){return void 0!==r.nextUp?c.addClass("inc"):void 0!==r.nextDown?c.addClass("dec"):void 0})):void 0):(i=r.data.count,void(r.renderCount=t(i))):void 0:(i=0,void(r.renderCount=t(i)))},r.$watch("disabled",function(t){if(!r.disabled)return o(r.data)}),r.$watch("data",function(t){if(!r.disabled)return o(t)}),r.$on("$destroy",function(){return t.off(),c.off()})},template:'<div\n    ng-class="{\'wip-amount\': data.wip, \'limit-over\': data.count > data.wip}"\n    class="animated-counter-inner">\n    <div class="counter-translator">\n        <div class="result">\n            <span class="current">{{ nextUp.current || 0 }}</span><span ng-if="nextUp.wip"> / {{ nextUp.wip }}</span>\n        </div>\n        <div class="result">\n            <span class="current">{{ renderCount.current || 0 }}</span><span ng-if="renderCount.wip"> / {{ renderCount.wip }}</span>\n        </div>\n        <div class="result">\n            <span class="current">{{ nextDown.current || 0 }}</span><span ng-if="nextDown.wip"> / {{ nextDown.wip }}</span>\n        </div>\n    </div>\n</div>',scope:{data:"<",disabled:"<"}}};angular.module("taigaComponents").directive("tgAnimatedCounter",[t])}.call(this),function(){var t=function(t,e,r,n,i,o,c,s,u,l,p){return{link:function(r,e,n,i){var o=function(){var t,e;return-1!==(null!=(t=r.project)&&null!=(e=t.my_permissions)?e.indexOf(n.requiredPerm):void 0)},s=function(t){var e=i.$modelValue.assigned_to,t=p.searchUsers(t);return e&&(t=_.reject(t,{id:e})),e=_.slice(t,0,5),_.map(e,function(t){return t.avatar=l.getAvatar(t)}),r.users=_.slice(t,0,5),r.showMore=5<t.length},a=function(t){var e;return null!=t&&t.assigned_to?(r.selected=t.assigned_to,e=r.usersById[r.selected],r.fullName=null!=e?e.full_name_display:void 0,r.isUnassigned=!1,r.avatar=l.getAvatar(e),r.bg=r.avatar.bg,r.isIocaine=null!=t?t.is_iocaine:void 0):(r.fullName=c.instant("COMMON.ASSIGNED_TO.ASSIGN"),r.isUnassigned=!0,r.avatar=l.getAvatar(null),r.bg=null,r.isIocaine=!1),r.fullNameVisible=!(r.isUnassigned&&!u.isAuthenticated()),r.isEditable=o()};return e.on("click",".users-search",function(t){return t.stopPropagation()}),e.on("click",".users-dropdown",function(t){return t.preventDefault(),t.stopPropagation(),r.usersSearch="",s(),r.$apply(),e.find(".pop-users").popover().open()}),r.selfAssign=function(){return i.$modelValue.assigned_to=u.getUser().get("id"),a(i.$modelValue)},r.unassign=function(){return i.$modelValue.assigned_to=null,a()},r.$watch("usersSearch",function(t){if(null!=t)return s(t),e.find("input").focus()}),e.on("click",".user-list-single",function(t){return t.preventDefault(),t=angular.element(t.currentTarget),i.$modelValue.assigned_to=t.data("user-id"),a(i.$modelValue),r.$apply()}),r.$watch(n.ngModel,a),r.$on("isiocaine:changed",function(t,e){return a(e)}),r.$on("$destroy",function(){return e.off()})},templateUrl:"components/assigned-inline/assigned-to-inline.html",require:"ngModel"}};angular.module("taigaComponents").directive("tgAssignedToInline",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$translate","$compile","tgCurrentUserService","tgAvatarService","tgUserListService",t])}.call(this),function(){var h=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},t=function(t,e,r,n,i,o,s,a,l,p,d){return{scope:!0,link:function(e,r,t,n){var i=[],o=null,s=function(){return 0<i.length},a=function(t){var r,t=d.searchUsers(t),n=[];return _.map(t,function(t){var e=t.id;if(0<=h.call(i,e))return t.avatar=p.getAvatar(t),n.push(t)}),r=[],_.map(t,function(t){var e=t.id;if(h.call(i,e)<0)return t.avatar=p.getAvatar(t),r.push(t)}),e.selected=_.slice(n,0,5),e.selected.length<5?e.users=_.slice(r,0,5-e.selected.length):e.users=[],e.showMore=5<t.length},c=function(){var t=_.map(i,function(t){return e.usersById[t]});return t=_.filter(t,function(t){return!!t}),e.hiddenUsers=3<i.length?i.length-3:0,e.assignedUsers=_.slice(t,0,3),e.isAssigned=s()},u=function(){return _.map(i,function(t){if(!e.usersById[t])return i.splice(i.indexOf(t),1)}),0===i.length?o=null:-1!==i.indexOf(o)&&o||(o=i[0]),n.$modelValue.assigned_users?n.$modelValue.setAttr("assigned_users",i):n.$modelValue.assigned_users=i,n.$modelValue.assigned_to=o};return r.on("click",".users-dropdown",function(t){return t.preventDefault(),t.stopPropagation(),e.usersSearch=null,a(),e.$apply(),r.find(".pop-users").popover().open()}),e.assign=function(t){return i.push(t.id),c(),u()},e.selfAssign=function(){return i.push(l.getUser().get("id")),c(),u()},e.unassign=function(t){t=i.indexOf(t.id);return i.splice(t,1),c(),u()},r.on("click",".users-search",function(t){return t.stopPropagation()}),e.$watch("usersSearch",function(t){if(null!=t)return a(t),r.find("input").focus()}),e.$watch(t.ngModel,function(t){if(null!=t)return i=[],null!=t.assigned_users&&(i=t.assigned_users),t.assigned_to,c()}),e.$on("$destroy",function(){return r.off()})},templateUrl:"components/assigned-inline/assigned-users-inline.html",require:"ngModel"}};angular.module("taigaComponents").directive("tgAssignedUsersInline",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$translate","$compile","tgCurrentUserService","tgAvatarService","tgUserListService",t])}.call(this),function(){var t=function(i,o,s){return{link:function(e,t,r){var n=i(r.tgAttachmentLink)(e);return t.on("click",function(t){return taiga.isImage(n.getIn(["file","name"]))?(t.preventDefault(),e.$apply(function(){return s.open($("tg-attachments-preview")),o.fileId=n.getIn(["file","id"])})):taiga.isPdf(n.getIn(["file","name"]))?(t.preventDefault(),window.open(n.getIn(["file","url"]))):void 0}),e.$on("$destroy",function(){return t.off()})}}};t.$inject=["$parse","tgAttachmentsPreviewService","lightboxService"],angular.module("taigaComponents").directive("tgAttachmentLink",t)}.call(this),function(){var t=function(){return{scope:{},bindToController:{attachment:"=",onDelete:"&",onUpdate:"&",type:"="},controller:"Attachment",controllerAs:"vm",templateUrl:"components/attachment/attachment-gallery.html",link:function(t,e,r,n){}}};t.$inject=[],angular.module("taigaComponents").directive("tgAttachmentGallery",t)}.call(this),function(){var t;function e(t,e){this.attachmentsService=t,this.translate=e,this.form={},this.form.description=this.attachment.getIn(["file","description"]),this.form.is_deprecated=this.attachment.get(["file","is_deprecated"]),this.title=this.translate.instant("ATTACHMENT.TITLE",{fileName:this.attachment.get("name"),date:moment(this.attachment.get("created_date")).format(this.translate.instant("ATTACHMENT.DATE"))})}e.$inject=["tgAttachmentsService","$translate"],e.prototype.editMode=function(t){t=this.attachment.set("editable",t);return this.onUpdate({attachment:t})},e.prototype.delete=function(){return this.onDelete({attachment:this.attachment})},e.prototype.save=function(){var t=this.attachment.set("loading",!0);return this.onUpdate({attachment:t}),t=(t=this.attachment.merge({editable:!1,loading:!1})).mergeIn(["file"],{description:this.form.description,is_deprecated:!!this.form.is_deprecated}),this.onUpdate({attachment:t})},t=e,angular.module("taigaComponents").controller("Attachment",t)}.call(this),function(){var t=function(){return{scope:{},bindToController:{attachment:"=",onDelete:"&",onUpdate:"&",type:"="},controller:"Attachment",controllerAs:"vm",templateUrl:"components/attachment/attachment.html",link:function(t,e,r,n){}}};t.$inject=[],angular.module("taigaComponents").directive("tgAttachment",t)}.call(this),function(){var t=function(i){return{link:function(r,t,e){var n=i(e.tgAttachmentsDrop);return t.on("dragover",function(t){return t.preventDefault(),t.currentTarget.classList.add("attachment-dragover"),!1}),t.on("dragleave",function(t){return t.preventDefault(),t.currentTarget.classList.remove("attachment-dragover"),!1}),t.on("drop",function(t){var e;return t.stopPropagation(),t.preventDefault(),t.currentTarget.classList.remove("attachment-dragover"),e=t.dataTransfer||t.originalEvent&&t.originalEvent.dataTransfer,r.$apply(function(){return n(r,{files:e.files})})}),r.$on("$destroy",function(){return t.off()})}}};t.$inject=["$parse"],angular.module("taigaComponents").directive("tgAttachmentsDrop",t)}.call(this),function(){var t,p;function e(t,e,r,n,i,o,s){var a,c,u,l;this.translate=t,this.confirm=e,this.config=r,this.storage=n,this.attachmentsFullService=i,this.projectService=o,this.attachmentsPreviewService=s,this.mode=this.storage.get("attachment-mode","list"),this.maxFileSize=this.config.get("maxUploadFileSize",null),this.maxFileSize&&(this.maxFileSize=p(this.maxFileSize)),this.maxFileSizeMsg=this.maxFileSize?this.translate.instant("ATTACHMENT.MAX_UPLOAD_SIZE",{maxFileSize:this.maxFileSize}):"",taiga.defineImmutableProperty(this,"attachments",(a=this,function(){return a.attachmentsFullService.attachments})),taiga.defineImmutableProperty(this,"deprecatedsCount",(c=this,function(){return c.attachmentsFullService.deprecatedsCount})),taiga.defineImmutableProperty(this,"attachmentsVisible",(u=this,function(){return u.attachmentsFullService.attachmentsVisible})),taiga.defineImmutableProperty(this,"deprecatedsVisible",(l=this,function(){return l.attachmentsFullService.deprecatedsVisible}))}p=this.taiga.sizeFormat,e.$inject=["$translate","$tgConfirm","$tgConfig","$tgStorage","tgAttachmentsFullService","tgProjectService","tgAttachmentsPreviewService"],e.prototype.uploadingAttachments=function(){return this.attachmentsFullService.uploadingAttachments},e.prototype.addAttachment=function(t){var e="list"===this.mode;return this.attachmentsFullService.addAttachment(this.projectId,this.objId,this.type,t,e)},e.prototype.setMode=function(t){return this.mode=t,this.storage.set("attachment-mode",t)},e.prototype.toggleDeprecatedsVisible=function(){return this.attachmentsFullService.toggleDeprecatedsVisible()},e.prototype.addAttachments=function(t){return _.forEach(t,(e=this,function(t){return e.addAttachment(t)}));var e},e.prototype.loadAttachments=function(){return this.attachmentsFullService.loadAttachments(this.type,this.objId,this.projectId)},e.prototype.deleteAttachment=function(n){var i,t,o;return this.attachmentsPreviewService.fileId=null,t=this.translate.instant("ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT"),i=this.translate.instant("ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT",{fileName:n.getIn(["file","name"])}),this.confirm.askOnDelete(t,i).then((o=this,function(t){var e=function(){return i=o.translate.instant("ATTACHMENT.ERROR_DELETE_ATTACHMENT",{errorMessage:i}),o.confirm.notify("error",null,i),t.finish(!1)},r=function(){return t.finish()};return o.attachmentsFullService.deleteAttachment(n,o.type).then(r,e)}))},e.prototype.reorderAttachment=function(t,e){return this.attachmentsFullService.reorderAttachment(this.objId,this.type,t,e)},e.prototype.updateAttachment=function(t){return this.attachmentsFullService.updateAttachment(t,this.type)},e.prototype._isEditable=function(){return!!this.projectService.project&&this.projectService.hasPermission(this.editPermission)},e.prototype.showAttachments=function(){return this._isEditable()||this.attachmentsFullService.attachments.size},t=e,angular.module("taigaComponents").controller("AttachmentsFull",t)}.call(this),function(){this.taiga.bindOnce;var t=function(){return{scope:{},bindToController:{type:"@",objId:"=",projectId:"=",editPermission:"@"},controller:"AttachmentsFull",controllerAs:"vm",templateUrl:"components/attachments-full/attachments-full.html",link:function(t,e,r,n){return t.displayAttachmentInput=function(t){return angular.element("#add-attach").click(),!1}}}};t.$inject=[],angular.module("taigaComponents").directive("tgAttachmentsFull",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r){var n,i,o,s;this.attachmentsService=t,this.rootScope=e,this.q=r,this._attachments=Immutable.List(),this._deprecatedsCount=0,this._attachmentsVisible=Immutable.List(),this._deprecatedsVisible=!1,this.uploadingAttachments=[],this.types=this.attachmentsService.types,taiga.defineImmutableProperty(this,"attachments",(n=this,function(){return n._attachments})),taiga.defineImmutableProperty(this,"deprecatedsCount",(i=this,function(){return i._deprecatedsCount})),taiga.defineImmutableProperty(this,"attachmentsVisible",(o=this,function(){return o._attachmentsVisible})),taiga.defineImmutableProperty(this,"deprecatedsVisible",(s=this,function(){return s._deprecatedsVisible}))}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgAttachmentsService","$rootScope","$q"],e.prototype.toggleDeprecatedsVisible=function(){return this._deprecatedsVisible=!this._deprecatedsVisible,this.regenerate()},e.prototype.regenerate=function(){return this._deprecatedsCount=this._attachments.count(function(t){return t.getIn(["file","is_deprecated"])}),this._deprecatedsVisible?this._attachmentsVisible=this._attachments:this._attachmentsVisible=this._attachments.filter(function(t){return!t.getIn(["file","is_deprecated"])})},e.prototype.addAttachment=function(e,n,i,o,s,a){return null==s&&(s=!0),null==a&&(a=!1),this.q((c=this,function(r,t){return c.attachmentsService.validate(o)?(c.uploadingAttachments.push(o),c.attachmentsService.upload(o,n,e,i,a).then(function(e){var t;return c.uploadingAttachments=c.uploadingAttachments.filter(function(t){return t.name!==e.get("name")}),t=(t=Immutable.Map()).merge({file:e,editable:s,loading:!1,from_comment:a}),c._attachments=c._attachments.push(t),c.regenerate(),c.rootScope.$broadcast("attachment:create"),r(t)})):t(new Error(o))}));var c},e.prototype.loadAttachments=function(t,e,r){return this.attachmentsService.list(t,e,r).then((n=this,function(t){return n._attachments=t.map(function(t){return Immutable.Map().merge({loading:!1,editable:!1,file:t})}),n.rootScope.$broadcast("attachments:loaded",n._attachments),n.regenerate()}));var n},e.prototype.deleteAttachment=function(e,t){var r,n=function(){return r._attachments=r._attachments.filter(function(t){return t!==e}),r.regenerate()};return(r=this).attachmentsService.delete(t,e.getIn(["file","id"])).then(n)},e.prototype.reorderAttachment=function(t,e,r,n){var i=this.attachments.findIndex(function(t){return t===r}),i=this.attachments.remove(i);return i=(i=i.splice(n,0,r)).map(function(t,e){return t.setIn(["file","order"],e+1)}),this._attachments=i,this.regenerate(),i=null,0<n&&(i=this.attachments.get(n-1).getIn(["file","id"])),this.attachmentsService.bulkUpdateOrder(t,e,i,[r.getIn(["file","id"])])},e.prototype.updateAttachment=function(e,t){var r,n=this._attachments.findIndex(function(t){return t.getIn(["file","id"])===e.getIn(["file","id"])}),i=this._attachments.get(n),i=taiga.patch(i.get("file"),e.get("file"));return e.get("loading")||_.isEmpty(i)?this.setAttachments(n,e):this.attachmentsService.patch(e.getIn(["file","id"]),t,i).then((r=this,function(){return r.setAttachments(n,e)}))},e.prototype.setAttachments=function(t,e){return this._attachments=this._attachments.set(t,e),this.regenerate()},t=e,angular.module("taigaComponents").service("tgAttachmentsFullService",t)}.call(this),function(){var t;function e(t){var e;this.attachmentsPreviewService=t,taiga.defineImmutableProperty(this,"current",(e=this,function(){return e.attachmentsPreviewService.fileId?e.getCurrent():null}))}e.$inject=["tgAttachmentsPreviewService"],e.prototype.hasPagination=function(){return 1<this.attachments.filter(function(t){return taiga.isImage(t.getIn(["file","name"]))}).size},e.prototype.getCurrent=function(){var e,t=this.attachments.find((e=this,function(t){return e.attachmentsPreviewService.fileId===t.getIn(["file","id"])}));return t?t.get("file"):null},e.prototype.getIndex=function(){return this.attachments.findIndex((e=this,function(t){return e.attachmentsPreviewService.fileId===t.getIn(["file","id"])}));var e},e.prototype.next=function(){var t=this.getIndex(),t=this.attachments.slice(t+1).find(function(t){return taiga.isImage(t.getIn(["file","name"]))});return t=t||this.attachments.find(function(t){return taiga.isImage(t.getIn(["file","name"]))}),this.attachmentsPreviewService.fileId=t.getIn(["file","id"])},e.prototype.previous=function(){var t=this.getIndex(),t=this.attachments.slice(0,t).findLast(function(t){return taiga.isImage(t.getIn(["file","name"]))});return t=t||this.attachments.findLast(function(t){return taiga.isImage(t.getIn(["file","name"]))}),this.attachmentsPreviewService.fileId=t.getIn(["file","id"])},t=e,angular.module("taigaComponents").controller("AttachmentsPreview",t)}.call(this),function(){var t=function(t,i){return{scope:{},controller:"AttachmentsPreview",templateUrl:"components/attachments-preview/attachments-preview.html",link:function(e,t,r,n){return $(document.body).on("keydown.image-preview",function(t){return i.fileId&&(39===t.keyCode?n.next():37===t.keyCode&&n.previous()),e.$digest()}),e.$on("$destroy",function(){return $(document.body).off(".image-preview")})},controllerAs:"vm",bindToController:{attachments:"="}}};angular.module("taigaComponents").directive("tgAttachmentsPreview",["lightboxService","tgAttachmentsPreviewService",t])}.call(this),function(){var t,i={}.hasOwnProperty;function e(){}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=[],t=e,angular.module("taigaComponents").service("tgAttachmentsPreviewService",t)}.call(this),function(){var t;function e(t){this.attachmentsService=t}e.$inject=["tgAttachmentsService"],e.prototype.addAttachment=function(t){var e=Immutable.fromJS({file:t,name:t.name,size:t.size});if(this.attachmentsService.validate(t)&&(this.attachments=this.attachments.push(e),this.onAdd))return this.onAdd({attachment:e})},e.prototype.addAttachments=function(t){return _.forEach(t,this.addAttachment.bind(this))},e.prototype.deleteAttachment=function(e){if(this.attachments=this.attachments.filter(function(t){return t!==e}),this.onDelete)return this.onDelete({attachment:e})},t=e,angular.module("taigaComponents").controller("AttachmentsSimple",t)}.call(this),function(){var t=function(){return{scope:{},bindToController:{attachments:"=",onAdd:"&",onDelete:"&"},controller:"AttachmentsSimple",controllerAs:"vm",templateUrl:"components/attachments-simple/attachments-simple.html",link:function(t,e,r,n){return t.displayAttachmentInput=function(t){return angular.element("#add-attach").click(),!1}}}};t.$inject=[],angular.module("taigaComponents").directive("tgAttachmentsSimple",t)}.call(this),function(){var t=function(o){return{link:function(n,t,e){var i=o(e.tgAttachmentsSortable),r=dragula([t[0]],{copySortSource:!1,copy:!1,mirrorContainer:t[0],moves:function(t){return $(t).is("div[tg-bind-scope]")}});return r.on("dragend",function(t){var e,r;return t=$(t),e=t.scope().attachment,r=t.index(),n.$apply(function(){return i(n,{attachment:e,index:r})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&r.dragging}}),n.$on("$destroy",function(){return t.off(),r.destroy()})}}};t.$inject=["$parse"],angular.module("taigaComponents").directive("tgAttachmentsSortable",t)}.call(this),function(){var t=function(r){return{link:function(t,e){return r(function(){return e[0].select()})}}};t.$inject=["$timeout"],angular.module("taigaComponents").directive("tgAutoSelect",t)}.call(this),function(){var t=function(i){return{link:function(t,e,r){var n=r.tgAvatarBig?"avatarBig":"avatar";return t.$watch(n,function(t){t=i.getAvatar(t,n);return e.attr("src",t.url),e.attr("title",""+t.fullName),e.attr("alt",""+t.fullName),e.css("background",t.bg||"")})},scope:{avatar:"=tgAvatar",avatarBig:"=tgAvatarBig"}}};t.$inject=["tgAvatarService"],angular.module("taigaComponents").directive("tgAvatar",t),angular.module("taigaComponents").directive("tgAvatarBig",t)}.call(this),function(){var t=function(n,a,i,c,t){return{link:function(s,t,e){var r;return s.$watch("epics",function(t){return r(t)}),s.$on("related-epics:changed",function(t,e){return i.userstories.getByRef(e.project,e.ref,{}).then(function(t){return s.item.epics=t.epics,r(t.epics)})}),s.removeEpicRelationship=function(o){var t=n.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.TITLE"),e=n.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.MESSAGE",{epicSubject:o.get("subject")});return a.ask(t,null,e).then(function(t){var e=function(){return t.finish(),s.$broadcast("related-epics:changed",s.item)},r=function(){return t.finish(!1),a.notify("error")},n=o.get("id"),i=s.item.id;return c.epics.deleteRelatedUserstory(n,i).then(e,r)})},r=function(t){if(s.epicsLength=0,s.immutable_epics=[],t&&!t.isIterable)return s.epicsLength=t.length,s.immutable_epics=Immutable.fromJS(t)}},scope:{epics:"=",item:"="},templateUrl:function(t,e){return e.format?"components/belong-to-epics/belong-to-epics-"+e.format+".html":"components/belong-to-epics/belong-to-epics-pill.html"}}};angular.module("taigaEpics").directive("tgBelongToEpics",["$translate","$tgConfirm","$tgResources","tgResources","lightboxService",t])}.call(this),function(){var t=function(r,s,a,c){return{restrict:"A",compile:function(t,e){var n,i=s(e.tgBindWysiwygHtml),o=s(e.tgBindWysiwygHtml,function(t){return(t||"").toString()});return a.$$addBindingClass(t),n=function(t,e){return window._extraValidHtmlElments={input:!0},window._extraValidAttrs={checked:!0},t.html(r.getTrustedHtml(e)||""),t[0].querySelectorAll("pre code").forEach(function(t){var e,r=t.className+" ";return r+=t.parentNode?t.parentNode.className:"",e="plaintext",(r=/\blang(?:uage)?-([\w-]+)\b/i.exec(r))&&r.length&&(e=r[1]),hljs.getLanguage(e)?hljs.highlightBlock(t):ljs.load("/"+window._version+"/highlightjs-languages/"+e+".min.js",function(){return hljs.highlightBlock(t)})}),t[0].querySelectorAll('a[href^="#"]').forEach(function(e){return e.addEventListener("click",function(t){if(t.preventDefault(),t=document.querySelector(e.getAttribute("href")))return t.scrollIntoView()})})},function(e,r,t){return a.$$addBindingInfo(r,t.tgBindWysiwygHtml),e.$watch(o,function(){var t=c.getHTML(i(e));return t=c.relativePaths(t),c.refreshAttachmentURL(t).then(function(t){return n(r,t)}),n(r,t)})}}}};angular.module("taigaComponents").directive("tgBindWysiwygHtml",["$sce","$parse","$compile","tgWysiwygService",t])}.call(this),function(){var t=function(){return{scope:{levels:"=",value:"="},templateUrl:"components/board-zoom/board-zoom.html"}};angular.module("taigaComponents").directive("tgBoardZoom",[t])}.call(this),function(){var t;function e(){this.index=0}e.$inject=[],e.prototype.next=function(){if(this.index++,this.index>=this.images.size)return this.index=0},e.prototype.previous=function(){if(this.index--,this.index<0)return this.index=this.images.size-1},t=e,angular.module("taigaComponents").controller("CardSlideshow",t)}.call(this),function(){var t=function(){return{controller:"CardSlideshow",templateUrl:"components/card-slideshow/card-slideshow.html",bindToController:!0,controllerAs:"vm",scope:{images:"="}}};angular.module("taigaComponents").directive("tgCardSlideshow",t)}.call(this),function(){var t;function e(t){this.scope=t}e.$inject=["$scope"],e.prototype.getLinkParams=function(){var e,t=taiga.findScope(this.scope,function(t){return!(!t||!t.ctrl)&&t.ctrl}),r=t.lastLoadUserstoriesParams;return r?(r.status=this.scope.vm.item.getIn(["model","status"]),r.swimlane=this.scope.vm.item.getIn(["model","swimlane"]),r=_.pickBy(r,_.identity),t.scope.swimlanesList.size&&!r.swimlane&&(r.swimlane="null"),e={},Object.keys(r).forEach(function(t){return e["kanban-"+t]=r[t]}),e):{}},e.prototype.visible=function(t){return-1!==this.zoom.indexOf(t)},e.prototype.hasTasks=function(){var t=this.item.getIn(["model","tasks"]);return t&&0<t.size},e.prototype.getTagColor=function(t){return t||"#A9AABC"},e.prototype.hasMultipleAssignedUsers=function(){var t=this.item.getIn(["model","assigned_users"]);return t&&1<t.size},e.prototype.hasVisibleAttachments=function(){return 0<this.item.get("images").size},e.prototype.toggleFold=function(){return this.onToggleFold({id:this.item.get("id")})},e.prototype.getClosedTasks=function(){return this.item.getIn(["model","tasks"]).filter(function(t){return t.get("is_closed")})},e.prototype.closedTasksPercent=function(){return 100*this.getClosedTasks().size/this.item.getIn(["model","tasks"]).size},e.prototype.getModifyPermisionKey=function(){return"task"===this.type?"modify_task":"modify_us"},e.prototype.getDeletePermisionKey=function(){return"task"===this.type?"delete_task":"delete_us"},e.prototype._setVisibility=function(){var t={related:this.visible("related_tasks"),slides:this.visible("attachments")};return!_.isUndefined(this.item.get("foldStatusChanged"))&&this.visible("unfold")&&(2===this.zoomLevel?(t.related=this.item.get("foldStatusChanged"),t.slides=this.item.get("foldStatusChanged")):(t.related=!this.item.get("foldStatusChanged"),t.slides=!this.item.get("foldStatusChanged"))),this.item.getIn(["model","tasks"])&&this.item.getIn(["model","tasks"]).size||(t.related=!1),this.item.get("images")&&this.item.get("images").size||(t.slides=!1),t},e.prototype.isRelatedTasksVisible=function(){return this._setVisibility().related},e.prototype.isSlideshowVisible=function(){return this._setVisibility().slides},e.prototype.getNavKey=function(){return"task"===this.type?"project-tasks-detail":"issue"===this.type?"project-issues-detail":"project-userstories-detail"},t=e,angular.module("taigaComponents").controller("Card",t)}.call(this),function(){var t=function(){return{controller:"Card",controllerAs:"vm",templateUrl:"components/card/card.html",bindToController:{onToggleFold:"&",onClickAssignedTo:"&",onClickEdit:"&",onClickRemove:"&",onClickDelete:"&",onClickMoveToTop:"&",project:"<",item:"<",zoom:"<",zoomLevel:"<",archived:"<",inViewPort:"<",folded:"<",type:"@",isFirst:"<"}}};angular.module("taigaComponents").directive("tgCard",t)}.call(this),function(){var t=function(){return{link:function(t,e){return e.on("click",function(t){if(!$(t.target).is("input"))return t.preventDefault(),(t=e.find('input[type="file"]')).val(""),t.trigger("click")}),t.$on("$destroy",function(){return e.off()})}}};angular.module("taigaComponents").directive("tgClickInputFile",[t])}.call(this),function(){var e,t;function r(t){this.projectService=t,this.colorList=e(),this.checkIsColorRequired(),this.displayColorList=!1}t=this.taiga,e=t.getDefaulColorList,r.$inject=["tgProjectService"],r.prototype.userCanChangeColor=function(){return!this.requiredPerm||this.projectService.hasPermission(this.requiredPerm)},r.prototype.checkIsColorRequired=function(){if(!this.isColorRequired)return this.colorList=_.dropRight(this.colorList)},r.prototype.setColor=function(t){return this.color=t,this.customColor=t},r.prototype.resetColor=function(){if(this.isColorRequired&&!this.color)return this.color=this.initColor},r.prototype.toggleColorList=function(){return this.displayColorList=!this.displayColorList,this.customColor=this.color,this.resetColor()},r.prototype.onSelectDropdownColor=function(t){return this.color=t,this.onSelectColor({color:t}),this.toggleColorList()},r.prototype.onKeyDown=function(t){if(13===t.which)return!this.customColor&&this.isColorRequired||this.onSelectDropdownColor(this.customColor),t.preventDefault()},t=r,angular.module("taigaComponents").controller("ColorSelectorCtrl",t)}.call(this),function(){this.taiga.bindOnce;var t=function(a){return{link:function(t,e,r,n){var i=null,o=function(){return a.cancel(i),i=null},s=function(){if(!i)return i=a(function(){return n.displayColorList=!1,n.resetColor()},400)};return e.find(".color-selector").mouseenter(o).mouseleave(s),e.find(".color-selector-dropdown").mouseenter(o).mouseleave(s),t.$watch("vm.initColor",function(t){return n.setColor(t)})},templateUrl:"components/color-selector/color-selector.html",controller:"ColorSelectorCtrl",controllerAs:"vm",bindToController:{isColorRequired:"=",onSelectColor:"&",initColor:"=",requiredPerm:"@"},scope:{}}};t.$inject=["$timeout"],angular.module("taigaComponents").directive("tgColorSelector",t)}.call(this),function(){var t;function e(t,e,r,n,i){this.rootScope=t,this.confirm=e,this.modelTransform=r,this.navUrls=n,this.window=i,this.editMode=!1,this.loadingSubject=!1,this.originalSubject=this.item.subject,this.objType={tasks:"task",issues:"issue",userstories:"us"}[this.item._name]}t=angular.module("taigaBase"),e.$inject=["$rootScope","$tgConfirm","$tgQueueModelTransformation","$tgNavUrls","$window"],e.prototype._checkPermissions=function(){return this.permissions={canEdit:_.includes(this.project.my_permissions,this.requiredPerm)}},e.prototype.cancelEdit=function(){return this.editMode=!1,this.item.subject=this.originalSubject},e.prototype.editSubject=function(t){var e=this.window.getSelection();if("Range"!==e.type&&(t&&(this.editMode=!0),!t))return this.editMode=!1},e.prototype.onKeyDown=function(t){if(13===t.which&&this.saveSubject(),27===t.which)return this.item.subject=this.originalSubject,this.editSubject(!1)},e.prototype.saveSubject=function(){var t,e,r=function(){return t.loadingSubject=!1,t.rootScope.$broadcast("object:updated"),t.confirm.notify("success"),t.originalSubject=t.item.subject},n=function(){return e.loadingSubject=!1,e.confirm.notify("error")};return(e=t=this).editMode=!1,this.loadingSubject=!0,this.item,this.modelTransform.save(function(t){return t}).then(r,n)},t.controller("DetailHeaderCtrl",e)}.call(this),function(){var t=function(i){return this.$inject=[],{link:function(e,t,r,n){return e.blocked_html_note="",e.$watch("vm.item.blocked_note",function(t){t=i.getHTML(t);return e.blocked_html_note=t}),n._checkPermissions()},controller:"DetailHeaderCtrl",bindToController:!0,scope:{item:"=",project:"=",sectionName:"=",requiredPerm:"@"},controllerAs:"vm",templateUrl:"components/detail/header/detail-header.html"}};angular.module("taigaBase").directive("tgDetailHeader",["tgWysiwygService",t])}.call(this),function(){var t;function e(t,e){this.navUrls=t,this.rs=e}t=angular.module("taigaBase"),e.$inject=["$tgNavUrls","$tgResources"],e.prototype._checkNav=function(){var t,e,r,n,i="null"===this.rs.userstories.getQueryParams(this.item.project_extra_info.id).milestone,o=this.item.neighbors;if(this.previousUrl=null,this.nextUrl=null,i&&-1!==(e=(r=this.rs.userstories.getBacklog(this.item.project_extra_info.id)).findIndex((n=this,function(t){return t===n.item.ref})))&&(o={previous:{ref:r[e-1]},next:{ref:r[e+1]}}),null!=(null!=(e=o.previous)?e.ref:void 0)&&(t={project:this.item.project_extra_info.slug,ref:o.previous.ref},this.previousUrl=this.navUrls.resolve("project-"+this.item._name+"-detail",t)),null!=(null!=(e=o.next)?e.ref:void 0))return t={project:this.item.project_extra_info.slug,ref:o.next.ref},this.nextUrl=this.navUrls.resolve("project-"+this.item._name+"-detail",t)},t.controller("DetailNavCtrl",e)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return t.$watch("vm.item",function(t){if(t)return n._checkNav()})},controller:"DetailNavCtrl",bindToController:!0,scope:{item:"="},controllerAs:"vm",templateUrl:"components/detail/nav/detail-nav.html"}};angular.module("taigaBase").directive("tgDetailNav",t)}.call(this),function(){var t;function e(t,e){this.dueDateService=t,this.tgLightboxFactory=e}e.$inject=["tgDueDateService","tgLightboxFactory"],e.prototype.visible=function(){return this.dueDateService.visible(this._getScope())},e.prototype.disabled=function(){return this.dueDateService.disabled(this._getScope())},e.prototype.color=function(){return this.dueDateService.color(this._getScope())},e.prototype.title=function(){return this.dueDateService.title(this._getScope())},e.prototype.setDueDate=function(){if(!this.disabled())return this.tgLightboxFactory.create("tg-lb-set-due-date",{class:"lightbox lightbox-set-due-date"},{object:this.item,notAutoSave:this.notAutoSave})},e.prototype._getScope=function(){return{dueDate:this.dueDate,isClosed:this.isClosed,item:this.item,objType:this.objType,format:this.format,notAutoSave:this.notAutoSave}},t=e,angular.module("taigaComponents").controller("DueDateCtrl",t)}.call(this),function(){var t=function(t,o){return{link:function(e,r,t,n){var i;return e.open=!1,i=o.get(),_.merge(i,{field:r.find(".due-date-button")[0],container:r.find(".date-picker-container")[0],bound:!0,onClose:function(){return e.open=!1,e.$apply()},onSelect:function(){return n.dueDate=this.getMoment().format("YYYY-MM-DD")}}),r.picker=new Pikaday(i),r.on("click",".due-date-button",function(t){return t.preventDefault(),t.stopPropagation(),e.open?void r.picker.hide():(!r.picker.getDate()&&n.dueDate&&r.picker.setDate(moment(n.dueDate).format("YYYY-MM-DD")),r.picker.show(),e.open=!0,e.$apply())}),r.on("click",".date-picker-clean",function(t){return t.preventDefault(),t.stopPropagation(),n.dueDate=null,r.picker.setDate(n.dueDate),e.open=!1,r.picker.hide(),e.$apply()}),e.$on("status:changed",function(t,e){return n.isClosed=n.item.is_closed})},controller:"DueDateCtrl",controllerAs:"vm",bindToController:!0,templateUrl:"components/due-date/due-date-popover.html",scope:{dueDate:"=",isClosed:"=",item:"=",objType:"@",format:"@",notAutoSave:"="}}};angular.module("taigaComponents").directive("tgDueDatePopover",["$translate","tgDatePickerConfigService",t])}.call(this),function(){var t=function(o,s){return{link:function(e,r,t,n){var i=function(){var t=o.instant("COMMON.PICKERDATE.FORMAT");return n.dueDate&&(n.dueDate=moment(n.dueDate,t)),r.on("click",".date-picker-popover-trigger",function(t){if(!n.disabled())return t.preventDefault(),t.stopPropagation(),r.find(".date-picker-popover").popover().open()}),r.on("click",".date-picker-clean",function(t){return t.preventDefault(),t.stopPropagation(),n.dueDate=null,e.$apply(),r.find(".date-picker-popover").popover().close()}),t=s.get(),_.merge(t,{field:r.find("input.due-date")[0],container:r.find(".date-picker-container")[0],bound:!1,onSelect:function(){return n.dueDate=this.getMoment().format("YYYY-MM-DD"),r.find(".date-picker-popover").popover().close(),e.$apply()}}),r.picker=new Pikaday(t)};if("button-popover"===t.format)return i()},controller:"DueDateCtrl",controllerAs:"vm",bindToController:!0,templateUrl:function(t,e){return e.format?"components/due-date/due-date-"+e.format+".html":"components/due-date/due-date-icon.html"},scope:{dueDate:"=",isClosed:"=",item:"=",objType:"@",format:"@",notAutoSave:"="}}};angular.module("taigaComponents").directive("tgDueDate",["$translate","tgDatePickerConfigService",t])}.call(this),function(){var t,e;function r(t,e){this.translate=t,this.projectService=e,this.defaultConfig=[{color:"#93C45D",name:"normal due",days_to_due:null,by_default:!0},{color:"#EA7B4B",name:"due soon",days_to_due:14,by_default:!1},{color:"#E44057",name:"past due",days_to_due:0,by_default:!1}]}e=this.taiga,r.$inject=["$translate","tgProjectService"],r.prototype.visible=function(t){return"button"===t.format||null!=t.dueDate},r.prototype.disabled=function(t){return t.isClosed},r.prototype.color=function(t){return(null!=(t=this.getStatus(t))?t.color:void 0)||null},r.prototype.title=function(t){return t.dueDate?this._formatTitle(t):"button"===t.format?this.translate.instant("COMMON.DUE_DATE.TITLE_ACTION_SET_DUE_DATE"):""},r.prototype.getStatus=function(t){var e;return t.dueDate?(e=(e=this.projectService.project.toJS()[t.objType+"_duedates"])||this.defaultConfig,this._getAppearance(t,e)):null},r.prototype._getDefaultAppearance=function(t){var e=null;return _.map(t,function(t){if(!0===t.by_default)return e=t}),e},r.prototype._getAppearance=function(t,e){var r,n,i=this._getDefaultAppearance(e);return e=_.sortBy(e,function(t){return-t.days_to_due}),r=moment(t.dueDate),n=moment(),_.map(e,function(t){if(null!==t.days_to_due)return moment(r-moment.duration(t.days_to_due,"days"))<=n?i=t:void 0}),i},r.prototype._formatTitle=function(t){var e=this.translate.instant("COMMON.PICKERDATE.FORMAT"),e=moment(t.dueDate).format(e),t=this.getStatus(t);return null!=t&&t.name?e+" ("+t.name+")":e},t=r,e.DueDateService=t,angular.module("taigaCommon").service("tgDueDateService",t)}.call(this),function(){var t=function(o){return{restrict:"A",link:function(e,t,r,n){var i=o(r.tgFileChange);return t.on("change",function(t){return e.$apply(function(){return i(e,{files:t.currentTarget.files})})}),e.$on("$destroy",function(){return t.off()})}}};t.$inject=["$parse"],angular.module("taigaComponents").directive("tgFileChange",t)}.call(this),function(){var t,c,i={}.hasOwnProperty;function e(t,e,r){this.q=t,this.urls=e,this.http=r}c=taiga.generateHash,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=["$q","$tgUrls","$tgHttp"],e.prototype.storeFilters=function(t,r,e){var n,i,o=this.q.defer(),s=this.urls.resolve("user-storage"),a=c([t,t+":"+e]);return _.isEmpty(r)?((n=this.http.delete(s+"/"+a,{key:a,value:r})).then(function(){return o.resolve()}),n.then(null,function(){return o.reject()})):((n=this.http.put(s+"/"+a,{key:a,value:r})).then(function(t){return o.resolve()}),n.then(null,(i=this,function(t){var e=i.http.post(""+s,{key:a,value:r});return e.then(function(){return o.resolve()}),e.then(null,function(){return o.reject()})}))),o.promise},e.prototype.getFilters=function(t,e){var r=this.q.defer(),n=this.urls.resolve("user-storage"),e=c([t,t+":"+e]),e=this.http.get(n+"/"+e);return e.then(function(t){return r.resolve(t.data.value)}),e.then(null,function(t){return r.resolve({})}),r.promise},t=e,angular.module("taigaComponents").service("tgFilterRemoteStorageService",t)}.call(this),function(){var t=function(){return{priority:900,link:function(t,r,e,n){var i=$("tg-filter");return t.$watch(e.ngIf,function(t){var e;if(t)return i.find(".filter-list").hide(),i.height(),e=0,i.children().each(function(){return e+=$(this).outerHeight(!0)}),$(r.context.nextSibling).css({display:"block"})})}}};angular.module("taigaComponents").directive("tgFilterSlideDown",[t])}.call(this),function(){var t;function e(t){this.translate=t,this.opened=null,this.filterModeOptions=["include","exclude"],this.filterModeLabels={include:this.translate.instant("COMMON.FILTERS.ADVANCED_FILTERS.INCLUDE"),exclude:this.translate.instant("COMMON.FILTERS.ADVANCED_FILTERS.EXCLUDE")},this.filterMode="include",this.customFilterForm=!1,this.customFilterName="",this.$onChanges=function(t){if(t.selectedFilters)return this.getIncludedFilters(),this.getExcludedFilters()},this.includedFilters=this.getIncludedFilters(),this.excludedFilters=this.getExcludedFilters()}e.$inject=["$translate"],e.activeCustomFilter=null,e.repeatedFilterError=!1,e.lengthZeroError=!1,e.prototype.toggleFilterCategory=function(t){return this.opened===t?this.opened=null:this.opened=t},e.prototype.isOpen=function(t){return this.opened===t},e.prototype.openCustomFilter=function(){return this.customFilterForm=!0,this.lengthZeroError=!1,this.repeatedFilterError=!1},e.prototype.saveCustomFilter=function(){var e,r;return 0<this.customFilterName.length&&!this.customFilters.find((e=this,function(t){return t.name===e.customFilterName}))&&(this.lengthZeroError=!1,this.repeatedFilterError=!1,this.onSaveCustomFilter({name:this.customFilterName}),this.customFilterForm=!1,this.opened="custom-filter",this.customFilterName=""),0===this.customFilterName.length?this.lengthZeroError=!0:this.lengthZeroError=!1,this.customFilters.find((r=this,function(t){return t.name===r.customFilterName}))?this.repeatedFilterError=!0:this.repeatedFilterError=!1},e.prototype.unselectFilter=function(t){return this.activeCustomFilter=null,this.onRemoveFilter({filter:t})},e.prototype.selectFilter=function(t,e){return e={category:t,filter:e,mode:this.filterMode},this.activeCustomFilter=null,this.onAddFilter({filter:e})},e.prototype.removeCustomFilter=function(t){return this.activeCustomFilter=null,this.onRemoveCustomFilter({filter:t})},e.prototype.selectCustomFilter=function(t){return this.activeCustomFilter=t.id,this.onSelectCustomFilter({filter:t})},e.prototype.getIncludedFilters=function(){return this.includedFilters=_.filter(this.selectedFilters,function(t){return"include"===t.mode})},e.prototype.getExcludedFilters=function(){return this.excludedFilters=_.filter(this.selectedFilters,function(t){return"exclude"===t.mode})},e.prototype.isFilterSelected=function(e,r){return!!_.find(this.selectedFilters,function(t){return r.id===t.id&&e.dataType===t.dataType})},t=e,angular.module("taigaComponents").controller("Filter",t)}.call(this),function(){var t=function(){return{scope:{onChangeQ:"&",onAddFilter:"&",onSelectCustomFilter:"&",onRemoveFilter:"&",onRemoveCustomFilter:"&",onSaveCustomFilter:"&",customFilters:"<",filters:"<",selectedFilters:"<"},bindToController:!0,controller:"Filter",controllerAs:"vm",templateUrl:"components/filter/filter.html",link:function(i,o,t,e){var r=function(r){var n=new ResizeObserver(function(){var t=null,e=Number(o[0].style.getPropertyValue("--filter-list-max-height").replace("px",""));return(t=i.vm.opened?r.offsetHeight-o[0].offsetHeight+e:r.offsetHeight-o[0].offsetHeight)<100?t=100:380<t&&(t=380),o[0].style.setProperty("--filter-list-max-height",t+"px"),n.unobserve(o[0])});return n.observe(r)};if(t.$observe("open",function(t){return(t=i.$eval(t))?o.addClass("open"):o.removeClass("open")}),(t=$(".js-taskboard-manager")).length)return r(t[0])}}};angular.module("taigaComponents").directive("tgFilter",[t])}.call(this),function(){var t={bindings:{q:"<",change:"&"},template:'<input\n    type="search"\n    placeholder="{{\'COMMON.FILTERS.INPUT_PLACEHOLDER\' | translate}}"\n    ng-model="$ctrl.searchText"\n    ng-change="$ctrl.onChange($ctrl.searchText)" />\n<tg-svg svg-icon="icon-search"></tg-svg>',controller:function(){var e;this.searchText="",this.dirty=!1,this.$onChanges=function(t){if(t.q&&!this.dirty)return this.searchText=this.q},this.onChange=(e=this,function(t){return e.dirty=!0,e.change({q:t})})}};angular.module("taigaComponents").component("tgInputSearch",t)}.call(this),function(){var t;function e(){}e.prototype.edit=function(t){return this.onEditIssue({id:t.id})},e.prototype.toggleTags=function(){return this.onToggleTags({tags:this.showTags})},e.prototype.detach=function(t){return this.onDetachIssue({id:t.id})},e.prototype.delete=function(t){return this.onDeleteIssue({id:t.id})},t=e,angular.module("taigaComponents").controller("IssuesTable",t)}.call(this),function(){var t=function(i){return{controller:"IssuesTable",controllerAs:"ctrl",templateUrl:"components/issues-table/issues-table.html",bindToController:{issues:"<",showTags:"=",onLoadIssues:"&",onAddIssuesInBulk:"&",onAddNewIssue:"&",sprintIssues:"<",onDeleteIssue:"&",onEditIssue:"&",onDetachIssue:"&",onToggleTags:"&"},scope:!0,link:function(e,t,r,n){return e.issueOptions=null,e.displayOptions=function(t){return e.issueOptions=t},e.hideOptions=function(){return i(function(){return e.issueOptions=null},200)}}}};angular.module("taigaComponents").directive("tgIssuesTable",["$timeout",t])}.call(this),function(){this.taiga;var t=function(a,c,u,t,l){return{scope:{},link:function(t,e,r,n){var i,o=null,s=introJs();return s.oncomplete(function(){return $("html,body").scrollTop(0)}),s.onexit(function(){return c.disableJoyRide()}),i=function(t,e){if(e[t.joyride])return s.setOptions({exitOnEsc:!1,exitOnOverlayClick:!1,showStepNumbers:!1,nextLabel:l.instant("JOYRIDE.NAV.NEXT")+" &rarr;",prevLabel:"&larr; "+l.instant("JOYRIDE.NAV.BACK"),skipLabel:l.instant("JOYRIDE.NAV.SKIP"),doneLabel:l.instant("JOYRIDE.NAV.DONE"),disableInteraction:!0}),s.setOption("steps",u.get(t.joyride)),s.start()},a.$on("$routeChangeSuccess",function(t,e){return e.joyride&&c.isAuthenticated()?(s.oncomplete(function(){return c.disableJoyRide(e.joyride)}),e.loader?o=a.$on("loader:end",function(){return c.loadJoyRideConfig().then(function(t){return i(e,t)}),o()}):c.loadJoyRideConfig().then(function(t){return i(e,t)})):(s.exit(),void(o&&o()))})}}};t.$inject=["$rootScope","tgCurrentUserService","tgJoyRideService","$location","$translate"],angular.module("taigaComponents").directive("tgJoyRide",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){this.translate=t,this.checkPermissionsService=e}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["$translate","tgCheckPermissionsService"],e.prototype.getConfig=function(){return{dashboard:function(){var t=[{element:".project-list > section:not(.ng-hide)",position:"left",joyride:{title:n.translate.instant("JOYRIDE.DASHBOARD.STEP1.TITLE"),text:n.translate.instant("JOYRIDE.DASHBOARD.STEP1.TEXT")}},{element:".working-on-container",position:"right",joyride:{title:n.translate.instant("JOYRIDE.DASHBOARD.STEP2.TITLE"),text:n.translate.instant("JOYRIDE.DASHBOARD.STEP2.TEXT")}},{element:".watching-container",position:"right",joyride:{title:n.translate.instant("JOYRIDE.DASHBOARD.STEP3.TITLE"),text:[n.translate.instant("JOYRIDE.DASHBOARD.STEP3.TEXT1"),n.translate.instant("JOYRIDE.DASHBOARD.STEP3.TEXT2")]}}];return $(".project-list .create-project-button").is(":hidden")||t.push({element:".project-list .create-project-button",position:"bottom",joyride:{title:n.translate.instant("JOYRIDE.DASHBOARD.STEP4.TITLE"),text:[n.translate.instant("JOYRIDE.DASHBOARD.STEP4.TEXT1"),n.translate.instant("JOYRIDE.DASHBOARD.STEP4.TEXT2")]}}),t},backlog:function(){var t=[{element:".summary",position:"bottom",joyride:{title:r.translate.instant("JOYRIDE.BACKLOG.STEP1.TITLE"),text:[r.translate.instant("JOYRIDE.BACKLOG.STEP1.TEXT1"),r.translate.instant("JOYRIDE.BACKLOG.STEP1.TEXT2")]}},{element:".backlog-table-empty",position:"bottom",joyride:{title:r.translate.instant("JOYRIDE.BACKLOG.STEP2.TITLE"),text:r.translate.instant("JOYRIDE.BACKLOG.STEP2.TEXT")}},{element:".sprints",position:"left",joyride:{title:r.translate.instant("JOYRIDE.BACKLOG.STEP3.TITLE"),text:r.translate.instant("JOYRIDE.BACKLOG.STEP3.TEXT")}}];return r.checkPermissionsService.check("add_us")&&t.push({element:".new-us",position:"rigth",joyride:{title:r.translate.instant("JOYRIDE.BACKLOG.STEP4.TITLE"),text:r.translate.instant("JOYRIDE.BACKLOG.STEP4.TEXT")}}),t},kanban:(e=r=n=this,function(){var t=[{element:".kanban-table-inner",position:"bottom",joyride:{title:e.translate.instant("JOYRIDE.KANBAN.STEP1.TITLE"),text:e.translate.instant("JOYRIDE.KANBAN.STEP1.TEXT")}},{element:".card-placeholder",position:"right",joyride:{title:e.translate.instant("JOYRIDE.KANBAN.STEP2.TITLE"),text:e.translate.instant("JOYRIDE.KANBAN.STEP2.TEXT")}}];return e.checkPermissionsService.check("add_us")&&t.push({element:".add-action",position:"bottom",joyride:{title:e.translate.instant("JOYRIDE.KANBAN.STEP3.TITLE"),text:[e.translate.instant("JOYRIDE.KANBAN.STEP3.TEXT1"),e.translate.instant("JOYRIDE.KANBAN.STEP3.TEXT2")]}}),t})};var e,r,n},e.prototype.get=function(t){t=this.getConfig()[t].call(this);return _.map(t,function(t){var e="";return t.joyride.title&&(e+="<h3>"+t.joyride.title+"</h3>"),_.isArray(t.joyride.text)?_.forEach(t.joyride.text,function(t){return e+="<p>"+t+"</p>"}):e+="<p>"+t.joyride.text+"</p>",t.intro=e,t})},t=e,angular.module("taigaComponents").service("tgJoyRideService",t)}.call(this),function(){var t=function(s,t){return{scope:{onZoomChange:"&"},template:'<tg-board-zoom\n    class="board-zoom"\n    value="zoomIndex"\n    levels="levels"\n></tg-board-zoom>',link:function(r,t,e,n){var i,o;return r.zoomIndex=s.get("kanban_zoom",1),r.levels=4,o=[["assigned_to","ref"],["subject","card-data","assigned_to_extended"],["tags","extra_info","unfold"],["related_tasks","attachments"]],i=function(n){return null==n&&(n=0),3<n&&(n=3),n=Number(n),Number(s.get("kanban_zoom"))!==n&&s.set("kanban_zoom",n),_.reduce(o,function(t,e,r){return r<=n&&(t=t.concat(e)),t})},r.$watch("zoomIndex",function(t){var e=i(t);return r.onZoomChange({zoomLevel:t,zoom:e})})}}};angular.module("taigaComponents").directive("tgKanbanBoardZoom",["$tgStorage","tgProjectService",t])}.call(this),function(){var h=taiga.truncate,t=function(t,e,c,u,l,p,d){return{templateUrl:"components/lb-select-user/lb-select-user.html",link:function(i,r,t){var e,n,o,s=[],a=[];return u.open(r),o=function(t){var e,r,n;return null==t&&(t=""),n=_.compact(_.sortBy(_.filter(s,function(t){return _.includes(i.currentUsers,t.id)}),"name")),e=function(t,e){return("user"!==e.type||!_.find(n,["id",e.id]))&&(e=e.name.toUpperCase(),t=t.toUpperCase(),_.includes(e,t))},r=_.union(s,_.filter(a,function(t){return 0<_.difference(t.userIds,_.map(n,"id")).length})),e=_.sortBy(_.filter(r,_.partial(e,t)),"name"),t?(i.selected=[],i.collection=e):(i.selected=n,i.collection=_.union(n,e))},e=function(){return l.stop(),u.close(r)},i.$on("watcher:add",function(t,e){return i.item=e,o(),u.open(r).then(function(){return r.find("input").focus(),l.init(r)})}),i.$watch("activeUsers",function(n){var t;if(n&&(s=_.map(n,function(t){return{id:t.id,type:"user",name:t.full_name_display,avatar:p.getAvatar(t)}}),!i.single))return t=d.project.toJS(),a=_.map(t.roles,function(t){var e=_.filter(n,{role:t.id}),r=c.instant("LIGHTBOX.SELECT_USER.ROLE");return{id:t.id,type:"role",name:r+": "+t.name,avatar:null,userIds:_.map(e,"id"),userNames:h("("+_.join(_.map(e,"full_name_display"),", ")+")",110)}})}),i.$watch("currentUsers",function(t){if(t)return o()}),i.$watch("searchText",function(t){return o(t),r.find("input").focus()}),i.removeItem=function(t,e){return e.preventDefault(),e.stopPropagation(),e.currentTarget.remove(),i.searchText=null,_.pull(i.currentUsers,t.id),o()},i.addItem=function(t){if("user"===t.type){if(i.currentUsers.includes(t.id))return;if(i.single)return i.currentUsers=[t.id],void n();i.currentUsers.push(t.id)}return"role"===t.type&&(i.currentUsers=_.union(i.currentUsers,t.userIds)),i.searchText=null,o()},i.clearSearch=function(){return i.searchText=""},n=function(){return i.loading=!0,i.onClose(i.currentUsers),e(),i.loading=!1},r.on("click",".lb-select-user-confirm",function(t){if(!i.loading)return t.preventDefault(),n()}),r.on("click",".close",function(t){return t.preventDefault(),e(),i.$apply(function(){return i.searchText=null})}),i.$on("$destroy",function(){return r.off()})},scope:!0}};t.$inject=["$rootScope","$tgRepo","$translate","lightboxService","lightboxKeyboardNavigationService","tgAvatarService","tgProjectService"],angular.module("taigaComponents").directive("tgLbSelectUser",t)}.call(this),function(){var t=function(t){return{restrict:"AE",scope:{},controllerAs:"vm",controller:function(){return this.close=function(){return t.open=!1},Object.defineProperties(this,{open:{get:function(){return t.open}},title:{get:function(){return t.title}},desc:{get:function(){return t.desc}}})},link:function(t,e,r){},templateUrl:"components/live-announcement/live-announcement.html"}};t.$inject=["tgLiveAnnouncementService"],angular.module("taigaComponents").directive("tgLiveAnnouncement",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){this.open=!1,this.title="",this.desc=""}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.prototype.show=function(t,e){return this.open=!0,this.title=t,this.desc=e},t=e,angular.module("taigaComponents").service("tgLiveAnnouncementService",t)}.call(this),function(){var t;function e(t,e,r,n,i,o,s,a){var c;this.rootScope=t,this.scope=e,this.rs=r,this.projectService=n,this.translate=i,this.lightboxService=o,this.confirm=s,this.q=a,this.projectId=this.projectService.project.get("id"),this.loading=!1,this.someSelected=!1,this.selectedSprintId=null,this.typesSelected={uss:!1,tasks:!1,issues:!1},this.itemsToMove={},this._loadSprints(),this.scope.$watch("vm.openItems",(c=this,function(t){if(t)return c._init(t)}))}t=angular.module("taigaComponents"),e.$inject=["$rootScope","$scope","$tgResources","tgProjectService","$translate","lightboxService","$tgConfirm","$q"],e.prototype._init=function(t){var e;return this.hasManyItemTypes=1<_.size(this.openItems),this.ussCount=parseInt(null!=(e=t.uss)?e.length:void 0),this.updateSelected("uss",0<this.ussCount),this.tasksCount=parseInt(null!=(e=t.tasks)?e.length:void 0),this.updateSelected("tasks",0<this.tasksCount),this.issuesCount=parseInt(null!=(t=t.issues)?t.length:void 0),this.updateSelected("issues",0<this.issuesCount)},e.prototype._loadSprints=function(){return this.rs.sprints.list(this.projectId,{closed:!1}).then((e=this,function(t){return e.sprints=_.filter(t.milestones,function(t){return t.id!==e.sprint.id})}));var e},e.prototype.updateSelected=function(t,e){return this.typesSelected[t]=e,this.someSelected=_.some(this.typesSelected),!0===e?this.itemsToMove[t]=this.openItems[t]:this.itemsToMove[t]?delete this.itemsToMove[t]:void 0},e.prototype.submit=function(){var r,t,n={};return _.map(this.openItems,(r=this,function(t,e){if(!r.itemsToMove[e])return n[e]=!0})),this.loading=!0,this.moveItems().then((t=this,function(){if(t.rootScope.$broadcast("taskboard:items:move",t.typesSelected),t.lightboxService.closeAll(),t.loading=!1,0<_.size(n))return t.displayWarning(n)}))},e.prototype.moveItems=function(){var t=[];return this.itemsToMove.uss&&t.push(this.rs.sprints.moveUserStoriesMilestone(this.sprint.id,this.projectId,this.selectedSprintId,this.itemsToMove.uss)),this.itemsToMove.tasks&&t.push(this.rs.sprints.moveTasksMilestone(this.sprint.id,this.projectId,this.selectedSprintId,this.itemsToMove.tasks)),this.itemsToMove.issues&&t.push(this.rs.sprints.moveIssuesMilestone(this.sprint.id,this.projectId,this.selectedSprintId,this.itemsToMove.issues)),this.q.all(t)},e.prototype.displayWarning=function(t){var e,r,n=this.translate.instant("COMMON.I_GET_IT"),i=1===_.size(t)&&!0===t.issues?(e=this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_ISSUES_NOT_MOVED_TITLE"),this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_ISSUES_NOT_MOVED")):(r=0,_.map(this.itemsToMove,function(t,e){return r+=t.length}),e=this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_SPRINT_STILL_OPEN_TITLE",{total:r},"messageformat"),this.translate.instant("TASKBOARD.MOVE_TO_SPRINT.WARNING_SPRINT_STILL_OPEN",{sprintName:null!=(i=this.sprint)?i.name:void 0}));return this.confirm.success(e,i,null,n)},t.controller("MoveToSprintLbCtrl",e)}.call(this),function(){var t=angular.module("taigaComponents"),e=function(i){return{scope:{},bindToController:{openItems:"=",sprint:"="},templateUrl:"components/move-to-sprint/move-to-sprint-lb/move-to-sprint-lb.html",controller:"MoveToSprintLbCtrl",controllerAs:"vm",link:function(t,e,r,n){return i.open(e)}}};e.$inject=["lightboxService"],t.directive("tgLbMoveToSprint",e)}.call(this),function(){var t;function e(t,e,r){var n,i,o;this.scope=t,this.lightboxFactory=e,this.projectService=r,this.permissions=this.projectService.project.get("my_permissions"),this.hasOpenItems=!1,this.disabled=!1,this.openItems={uss:[],tasks:[],issues:[]},this.scope.$watch("vm.uss",(n=this,function(){return n.getOpenUss()})),this.scope.$watch("vm.unnasignedTasks",(i=this,function(){return i.getOpenStorylessTasks()})),this.scope.$watch("vm.issues",(o=this,function(){return o.getOpenIssues()}))}this.taiga,e.$inject=["$scope","tgLightboxFactory","tgProjectService"],e.prototype.checkOpenItems=function(){return _.some(Object.keys(this.openItems),(e=this,function(t){return 0<e.openItems[t].length}));var e},e.prototype.openLightbox=function(){var r;if(!1===this.disabled&&this.hasOpenItems)return r={},_.map(this.openItems,function(t,e){if(t.length)return r[e]=t}),this.lightboxFactory.create("tg-lb-move-to-sprint",{class:"lightbox lightbox-move-to-sprint",sprint:"sprint","open-items":"openItems"},{sprint:this.sprint,openItems:r})},e.prototype.getOpenUss=function(){var e;if(this.uss&&-1!==this.permissions.indexOf("modify_us"))return this.openItems.uss=[],this.uss.map((e=this,function(t){if(!1===t.is_closed)return e.openItems.uss.push({us_id:t.id,order:t.sprint_order})})),this.hasOpenItems=this.checkOpenItems()},e.prototype.getOpenStorylessTasks=function(){var e;if(this.unnasignedTasks&&-1!==this.permissions.indexOf("modify_task"))return this.openItems.tasks=[],this.unnasignedTasks.map((e=this,function(t){return t.map(function(t){t=e.taskMap.get(t);if(!1===t.get("model").get("is_closed"))return e.openItems.tasks.push({task_id:t.get("model").get("id"),order:t.get("model").get("taskboard_order")})})})),this.hasOpenItems=this.checkOpenItems()},e.prototype.getOpenIssues=function(){var e;if(this.issues&&-1!==this.permissions.indexOf("modify_issue"))return this.openItems.issues=[],this.issues.map((e=this,function(t){if(!1===t.get("status").get("is_closed"))return e.openItems.issues.push({issue_id:t.get("id")})})),this.hasOpenItems=this.checkOpenItems()},t=e,angular.module("taigaComponents").controller("MoveToSprintCtrl",t)}.call(this),function(){var t=angular.module("taigaComponents"),e=function(t){return{controller:"MoveToSprintCtrl",controllerAs:"vm",bindToController:!0,templateUrl:"components/move-to-sprint/move-to-sprint.html",scope:{sprint:"=",uss:"=",unnasignedTasks:"=",issues:"=",disabled:"=",taskMap:"="}}};e.$inject=["tgTaskboardTasks"],t.directive("tgMoveToSprint",[e])}.call(this),function(){var t=function(n){return{link:function(t,r,e){return t.$watch("project",function(t){var e;if(t=Immutable.fromJS(t))return(e=t.get("logo_big_url"))?(r.attr("src",e),r.css("background","")):(t=n.getDefaultProjectLogo(t.get("slug"),t.get("id")),r.attr("src",t.src),r.css("background",t.color))})},scope:{project:"=tgProjectLogoBigSrc"}}};t.$inject=["tgProjectLogoService"],angular.module("taigaComponents").directive("tgProjectLogoBigSrc",t)}.call(this),function(){var t=function(n){return{link:function(t,r,e){return t.$watch("project",function(t){var e;if(t=Immutable.fromJS(t))return(e=t.get("logo_small_url"))?(r.attr("src",e),r.css("background","")):(t=n.getDefaultProjectLogo(t.get("slug"),t.get("id")),r.attr("src",t.src),r.css("background",t.color))})},scope:{project:"=tgProjectLogoSmallSrc"}}};t.$inject=["tgProjectLogoService"],angular.module("taigaComponents").directive("tgProjectLogoSmallSrc",t)}.call(this),function(){var t;function e(t,e){this.projectService=t,this.lightboxFactory=e,this.project=null,this.menu=Immutable.Map()}e.$inject=["tgProjectService","tgLightboxFactory"],e.prototype.show=function(){var t,e;return this.project=this.projectService.project,this.sprints=null!=(t=this.project.get("milestones"))?t.toJS():void 0,this.active=this._getActiveSection(),this.projectMenu={component:"tg-project-navigation",params:{project:this.projectService.project.toJS()},events:{search:(e=this,function(){return e.search()})}},this._setVideoConference(),this._setMenuPermissions()},e.prototype.hide=function(){return this.project=null,this.menu={}},e.prototype.search=function(){return this.lightboxFactory.create("tg-search-box",{class:"lightbox lightbox-search"})},e.prototype._setVideoConference=function(){var t=this._videoConferenceUrl();if(t)return this.project=this.project.set("videoconferenceUrl",t)},e.prototype._setMenuPermissions=function(){if(this.menu=Immutable.Map({epics:!1,backlog:!1,kanban:!1,issues:!1,wiki:!1}),this.project.get("is_epics_activated")&&-1!==this.project.get("my_permissions").indexOf("view_epics")&&(this.menu=this.menu.set("epics",!0)),this.project.get("is_backlog_activated")&&-1!==this.project.get("my_permissions").indexOf("view_us")&&(this.menu=this.menu.set("backlog",!0)),this.project.get("is_kanban_activated")&&-1!==this.project.get("my_permissions").indexOf("view_us")&&(this.menu=this.menu.set("kanban",!0)),this.project.get("is_issues_activated")&&-1!==this.project.get("my_permissions").indexOf("view_issues")&&(this.menu=this.menu.set("issues",!0)),this.project.get("is_wiki_activated")&&-1!==this.project.get("my_permissions").indexOf("view_wiki_pages"))return this.menu=this.menu.set("wiki",!0)},e.prototype._getActiveSection=function(){var t,e=this.projectService.section,r=this.projectService.sectionsBreadcrumb,n=r.lastIndexOf("backlog"),r=r.lastIndexOf("kanban");return-1===n&&-1===r||(t=-1===r||r<n?"backlog":"kanban"),"backlog-kanban"===e&&("backlog"===t||"kanban"===t?e=t:this.project.get("is_backlog_activated")&&!this.project.get("is_kanban_activated")?e="backlog":!this.project.get("is_backlog_activated")&&this.project.get("is_kanban_activated")&&(e="kanban")),e},e.prototype._videoConferenceUrl=function(){var t,e;if("whereby-com"===this.project.get("videoconferences"))t="https://whereby.com/";else if("talky"===this.project.get("videoconferences"))t="https://talky.io/";else{if("jitsi"!==this.project.get("videoconferences"))return"custom"===this.project.get("videoconferences")?this.project.get("videoconferences_extra_data"):"";t="https://meet.jit.si/"}return e=this.project.get("videoconferences_extra_data")?this.project.get("slug")+"-"+taiga.slugify(this.project.get("videoconferences_extra_data")):this.project.get("slug"),"jitsi"===this.project.get("videoconferences")&&(e=e.replace(/-/g,"")),t+e},t=e,angular.module("taigaComponents").controller("ProjectMenu",t)}.call(this),function(){this.taiga;var t=function(s,t){return{scope:{},controller:"ProjectMenu",controllerAs:"vm",templateUrl:"components/project-menu/project-menu.html",link:function(t,e,r,n){var i,o=function(){return s.project?n.show():n.hide()};return t.$watch(function(){return s.project},o),i=!1,window.addEventListener("scroll",function(){var t=$(window).scrollTop();return 48<t&&!1===i?(e.find(".sticky-project-menu").addClass("unblock"),i=!0):0===t&&!0===i?(e.find(".sticky-project-menu").removeClass("unblock"),i=!1):void 0})}}};t.$inject=["tgProjectService","tgLightboxFactory"],angular.module("taigaComponents").directive("tgProjectMenu",t)}.call(this),function(){var t=function(a,c,u,l){return{restrict:"AE",require:"ngModel",templateUrl:"components/promote-to-us/promote-to-us.html",link:function(t,e,r,i){var o=null,s=function(t,e){t.project;var r=function(t){return e.finish(),u.notify("success"),a.$broadcast("promote-"+o+"-to-us:success",t.data[0])},n=function(){return e.finish(),u.notify("error")};return c[t._name].promoteToUserStory(t.id,t.project).then(r,n)};return e.on("click",".promote-button",function(t){var e,r,n;return t.preventDefault(),e=i.$modelValue,r="COMMON.CONFIRM_PROMOTE."+(o=_.get({tasks:"task",issues:"issue"},e._name)).toUpperCase(),n=l.instant(r+".TITLE"),t=l.instant(r+".MESSAGE"),r=e.subject,u.ask(n,r,t).then(function(t){return s(e,t)})}),t.$on("$destroy",function(){return e.off()})}}};angular.module("taigaComponents").directive("tgPromoteToUsButton",["$rootScope","$tgResources","$tgConfirm","$translate",t])}.call(this),function(){var t=angular.module("taigaComponents"),p=this.taiga.normalizeString,d=this.taiga.groupBy,e=function(l){return{link:function(n,t,r,i){var e,o,s,a,c,u;return n.templateUrl="components/search-list/search-list-"+n.itemType+"-choice.html",n.currentSelected=null,e=[],s={},"issue"===n.itemType&&(n.milestonesById=d(n.project.milestones,function(t){return t.id})),n.filterClosed&&(n.showClosed=!1,"sprint"===n.itemType&&(n.textShowClosed=l.instant("BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS"),n.textHideClosed=l.instant("BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS"))),t.on("click",".choice",function(t){var e=parseInt($(t.currentTarget).data("choice-id")),e=(null!=(t=r.ngModel)?t.id:void 0)!==e?s[e]:null;return i.$setViewValue(e),n.currentSelected=e,n.$apply()}),o=function(t,e){return _.includes(a(e),a(t))},a=function(t){return"string"!=typeof t&&(t=t.toString()),p(t.toUpperCase())},u=function(){return n.currentSelected=null,i.$setViewValue(null)},c=function(){return u(),n.searchText="",e=angular.copy(n.items),s=d(e,function(t){return t.id})},n.isVisible=function(t){var e;return!(n.filterClosed&&!n.showClosed)||("sprint"!==n.itemType||!t.closed&&!t.is_closed||((null!=(e=n.currentSelected)?e.id:void 0)===t.id&&u(),!1))},n.toggleShowClosed=function(t){return n.showClosed=!n.showClosed},n.filterItems=function(r){if(n.filtering=!0,n.items=_.filter(e,function(t){var e=t.getAttrs();return Array.isArray(n.filterBy)?_.some(n.filterBy,function(t){return o(r,e[t])}):o(r,e[n.filterBy])}),!_.find(n.items,n.currentSelected))return u()},n.$watch("items",function(t){if(!n.filtering&&t)return c()})},templateUrl:"components/search-list/search-list.html",require:"ngModel",scope:{label:"@",placeholder:"@",project:"=",filterBy:"=",items:"=",itemType:"@",filterClosed:"=",itemDisabled:"="}}};t.directive("tgSearchList",["$translate",e])}.call(this),function(){this.taiga;var a=this.taiga.timeout,t=(this.taiga.cancelTimeout,function(o,s){return{link:function(e,t,r){var n,i;return e.displaySelector=!1,e.selectedSwimlane=null,a=null,n=function(){var t;return e.userStory.id?e.userStory.swimlane?(t=e.swimlanes.filter(function(t){return t.id===e.userStory.swimlane}),e.currentSwimlane=t.get(0)):e.currentSwimlane=null:(t=e.swimlanes.filter(function(t){return t.id===e.defaultSwimlaneId}),e.currentSwimlane=t.get(0)),i()},i=function(){return!e.userStory.id||e.currentSwimlane?e.selectedSwimlane=e.currentSwimlane.id:e.selectedSwimlane=null},e.displayOptions=function(){return a&&(o.cancel(a),a=null),e.displaySelector=!0},e.hideOptions=function(){return a=o(function(){return e.displaySelector=!1},100)},e.selectSwimlane=function(t){return"noSwimlane"===t?(t={id:null,kanban_order:1,name:s.instant("KANBAN.UNCLASSIFIED_USER_STORIES")},e.ngModel=t.id):e.ngModel=-1!==t.id?t.id:null,e.currentSwimlane=t,e.hideOptions(),i()},e.$watch("userStory",function(t){return n()}),n()},templateUrl:"components/swimlane-selector/swimlane-selector.html",scope:{swimlanes:"<",defaultSwimlaneId:"<",userStory:"<",hasUnclassifiedStories:"<",ngModel:"="},require:"ngModel"}});angular.module("taigaComponents").directive("tgSwimlaneSelector",["$timeout","$translate",t])}.call(this),function(){var t=function(){var o=function(t){var e,r;return t.addClass("selected"),r=t.position().top+t.outerHeight(),(e=t.parent().outerHeight())<r?(e=r-e,t.parent().scrollTop(t.parent().scrollTop()+e)):t.position().top<0?t.parent().scrollTop(t.parent().scrollTop()+t.position().top):void 0},n=function(t,e,r){var n,i=t.find(".selected");return 40===e?i.length?(n=i.next("li")).length?(i.removeClass("selected"),o(n)):void 0:o(t.find("li:first")):38===e?i.length?(e=i.prev("li")).length?(i.removeClass("selected"),o(e)):void 0:o(t.find("li:last")):void 0},e=function(){return $(document).off(".tags-keyboard-navigation")};return{link:function(t,r){return e(),$(r).parent().on("keydown.tags-keyboard-navigation",function(t){var e=t.keyCode||t.which;if(40===e||38===e)return t.preventDefault(),n(r,e)}),t.$on("$destroy",e)},templateUrl:"components/tags/tag-dropdown/tag-dropdown.html",scope:{onSelectTag:"&",colorArray:"=",tag:"="}}};angular.module("taigaCommon").directive("tgTagsDropdown",t)}.call(this),function(){var t;function e(t){this.tagLineService=t,this.disableColorSelection=!1,this.newTag={name:"",color:null},this.colorArray=[],this.addTag=!1}this.taiga.trim,t=angular.module("taigaCommon"),e.$inject=["tgTagLineService"],e.prototype.checkPermissions=function(){return this.tagLineService.checkPermissions(this.project.my_permissions,this.permissions)},e.prototype._createColorsArray=function(t){return this.colorArray=this.tagLineService.createColorsArray(t)},e.prototype.displayTagInput=function(){return this.addTag=!0},e.prototype.addNewTag=function(t,e){if(this.newTag.name="",this.newTag.color=null,t.length)return this.disableColorSelection?t.length?this.onAddTag({name:t,color:e}):void 0:(this.project.tags_colors[t]&&(e=this.project.tags_colors[t]),this.onAddTag({name:t,color:e}))},e.prototype.selectColor=function(t){return this.newTag.color=t},t.controller("TagLineCommonCtrl",e)}.call(this),function(){var t=function(){return{link:function(e,r,t,n){var i;return _.isUndefined(t.disableColorSelection)||(n.disableColorSelection=!0),i=e.$watch("vm.project",function(t){if(t&&Object.keys(t).length)return i(),n.disableColorSelection?void 0:n.colorArray=n._createColorsArray(n.project.tags_colors)}),r.on("keydown",".tag-input",function(t){return 27===t.keyCode?(n.addTag=!1,n.newTag.name="",n.newTag.color="",t.stopPropagation()):13===t.keyCode&&(t.preventDefault(),r.find(".tags-dropdown .selected").length?(t=$(".tags-dropdown .selected .tags-dropdown-name").text(),n.addNewTag(t,null)):n.addNewTag(n.newTag.name,n.newTag.color)),e.$apply()})},scope:{permissions:"@",loadingAddTag:"=",loadingRemoveTag:"=",tags:"=",project:"=",onAddTag:"&",onDeleteTag:"&"},templateUrl:"components/tags/tag-line-common/tag-line-common.html",controller:"TagLineCommonCtrl",controllerAs:"vm",bindToController:!0}};angular.module("taigaCommon").directive("tgTagLineCommon",t)}.call(this),function(){var t,s;function e(t,e,r){this.rootScope=t,this.confirm=e,this.modelTransform=r,this.loadingAddTag=!1}s=this.taiga.trim,t=angular.module("taigaCommon"),e.$inject=["$rootScope","$tgConfirm","$tgQueueModelTransformation"],e.prototype.onDeleteTag=function(t){var e,r,n,i,o;return this.loadingRemoveTag=t[0],r=function(t){return i.rootScope.$broadcast("object:updated"),i.loadingRemoveTag=!1,t},o=i=this,e=function(){return o.confirm.notify("error"),o.loadingRemoveTag=!1},n=s(t[0].toLowerCase()),this.modelTransform.save(function(t){var e=_.clone(t.tags);return _.remove(e,function(t){return t[0]===n}),t.tags=e,t}).then(r,e)},e.prototype.onAddTag=function(r,n){var t,e,i,o;return this.loadingAddTag=!0,e=function(t){return i.rootScope.$broadcast("object:updated"),i.rootScope.$broadcast("tags:updated"),i.addTag=!1,i.loadingAddTag=!1,t},t=function(){return o.loadingAddTag=!1,o.confirm.notify("error")},(o=i=this).modelTransform.save(function(t){s(r.toLowerCase());var e=_.clone(t.tags);return e.push([r,n]),t.tags=e,t}).then(e,t)},t.controller("TagLineCtrl",e)}.call(this),function(){var t=function(){return{scope:{item:"=",permissions:"@",project:"="},templateUrl:"components/tags/tag-line-detail/tag-line-detail.html",controller:"TagLineCtrl",controllerAs:"vm",bindToController:!0}};angular.module("taigaCommon").directive("tgTagLine",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){}t=angular.module("taigaCommon"),function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=[],e.prototype.checkPermissions=function(t,e){return _.includes(t,e)},e.prototype.createColorsArray=function(t){return _.map(t,function(t,e){return[e,t]})},t.service("tgTagLineService",e)}.call(this),function(){var t=function(){return{templateUrl:"components/tags/tag/tag.html",scope:{tag:"<",loadingRemoveTag:"<",onDeleteTag:"&",hasPermissions:"<"}}};angular.module("taigaCommon").directive("tgTag",t)}.call(this),function(){var t=function(s){return{scope:{onZoomChange:"&"},template:'<tg-board-zoom\n    levels="levels"\n    class="board-zoom"\n    value="zoomIndex"\n></tg-board-zoom>',link:function(r,t,e,n){var i,o;return r.zoomIndex=s.get("taskboard_zoom",2),r.levels=4,o=[["assigned_to","ref"],["subject"],["tags","extra_info","unfold","card-data","assigned_to_extended"],["related_tasks","attachments"]],i=function(n){return null==n&&(n=0),n=Number(n),Number(s.get("taskboard_zoom"))!==n&&s.set("taskboard_zoom",n),_.reduce(o,function(t,e,r){return r<=n&&(t=t.concat(e)),t})},r.$watch("zoomIndex",function(t){var e=i(t);return r.onZoomChange({zoomLevel:t,zoom:e})})}}};angular.module("taigaComponents").directive("tgTaskboardZoom",["$tgStorage",t])}.call(this),function(){var t=function(o,s){return{link:function(n,t,e){var i,r;if(s.hasPermission("modify_task"))return i=o(e.tgTasksSortable),(r=dragula([t[0]],{copySortSource:!1,copy:!1,mirrorContainer:t[0],moves:function(t){return $(t).is("div.single-related-task.js-related-task")}})).on("dragend",function(t){var t=$(t),e=t.scope().task,r=t.index();return n.$apply(function(){return i(n,{task:e,newIndex:r})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&r.dragging}}),n.$on("$destroy",function(){return t.off(),r.destroy()})}}};t.$inject=["$parse","tgProjectService"],angular.module("taigaComponents").directive("tgTasksSortable",t)}.call(this),function(){var t=function(n){return{restrict:"AE",link:function(e,t,r){return e.privacyPolicyUrl=n.get("privacyPolicyUrl"),e.termsOfServiceUrl=n.get("termsOfServiceUrl"),e.target=!1,e.privacyPolicyUrl&&e.termsOfServiceUrl||(e.target=!0),t.on("change","input[name='accepted_terms']",function(t){t=angular.element(t.currentTarget);return e.target=t.is(":checked"),e.$apply()})},scope:{target:"="},templateUrl:"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html"}};angular.module("taigaComponents").directive("tgTermsOfServiceAndPrivacyPolicyNotice",["$tgConfig",t])}.call(this),function(){var t=function(p,d,t,e,h,r,f,n,m,i,g){return{link:function(r,t,n,i){var e,o=null!=(e=m.getUser())?e.get("id"):void 0,s=function(){var t,e;return-1!==(null!=(t=r.project)&&null!=(e=t.my_permissions)?e.indexOf(n.requiredPerm):void 0)},a=function(t){return null!=t?t.is_iocaine:void 0},c=function(){return r.assignedUser&&r.assignedUser.id===o},u=function(e){var t;return r.loading=!0,(t=h.save(function(t){return t.assigned_to=e,t})).then(function(t){return n.ngModel=t,p.$broadcast("object:updated")}),t.then(null,function(){return d.notify("error")}),t.finally(function(){return r.loading=!1}),t},l=function(t){return r.assignedUser=r.usersById[null!=t?t.assigned_to:void 0],r.isEditable=s(),r.isIocaine=a(t),r.isSelfAssigned=c()};return t.on("click",".remove-user",function(t){if(s())return t.stopPropagation(),t=f.instant("COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED"),d.ask(t).then(function(t){return t.finish(),u(null)})}),r.openAssignedUsers=function(){var t=function(t){return u(t.pop()||null)},e=_.clone(i.$modelValue,!1);return g.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:[e.assigned_to],activeUsers:this.activeUsers,onClose:t,single:!0,lbTitle:f.instant("COMMON.ASSIGNED_USERS.ADD")})},r.selfAssign=function(){return u(o)},r.$watch(n.ngModel,function(t,e){if(null!=t)return l(t)}),r.$on("$destroy",function(){return t.off()})},templateUrl:"components/ticket-assigned/assigned-to.html",require:"ngModel"}};angular.module("taigaComponents").directive("tgAssignedTo",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$translate","$compile","tgCurrentUserService","tgAvatarService","tgLightboxFactory",t])}.call(this),function(){var g=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},t=function(l,p,t,d,e,r,h,f,m){return{scope:!0,templateUrl:"components/ticket-assigned/assigned-users.html",link:function(n,t,i,o){var s,a,e,r,c,u=null!=(e=f.getUser())?e.get("id"):void 0;return n.visibleAssignedUsersCount=4,n.displayHidden=!1,n.toggleFold=function(){return n.displayHidden=!n.displayHidden},a=function(){var t,e;return-1!==(null!=(t=n.project)&&null!=(e=t.my_permissions)?e.indexOf(i.requiredPerm):void 0)},c=function(e,r){var t;return n.loading=!0,(t=d.save(function(t){return t.assigned_users=e,r?t.assigned_to=r:e.length?_.includes(e,t.assigned_to)||(t.assigned_to=e[0]):t.assigned_to=null,t})).then(function(){return l.$broadcast("object:updated")}),t.then(null,function(){return p.notify("error")}),t.finally(function(){return n.loading=!1})},n.openAssignedUsers=function(){var t=function(t){return c(t)},e=_.clone(o.$modelValue,!1);return m.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:e.assigned_users,activeUsers:n.activeUsers,onClose:t,lbTitle:h.instant("COMMON.ASSIGNED_USERS.ADD")})},t.on("click",".user-list-single",function(t){if(a())return t.stopPropagation(),n.openAssignedUsers()}),t.on("click",".remove-user",function(t){var e,r;if(a())return t.stopPropagation(),r=angular.element(t.currentTarget),e=r.data("user-id"),t=h.instant("COMMON.ASSIGNED_USERS.TITLE_LIGHTBOX_DELETE_ASSIGNED"),r=n.usersById[e].full_name_display,p.askOnDelete(t,r).then(function(t){return t.finish(),t=_.clone(o.$modelValue.assigned_users,!1),t=_.pull(t,e),s(t)})}),n.selfAssign=function(){var t;if(a())return(t=_.clone(o.$modelValue.assigned_users,!1)).push(u),t=_.uniq(t),c(t,u)},s=function(r){var t;return n.loading=!0,(t=d.save(function(t){var e;return t.assigned_users=r,e=t.assigned_to,g.call(r,e)<0&&0<r.length&&(t.assigned_to=r[0]),0===r.length&&(t.assigned_to=null),t})).then(function(){var t=d.getObj();return i.ngModel=t,l.$broadcast("object:updated")}),t.then(null,function(){return item.revert(),p.notify("error")}),t.finally(function(){return n.loading=!1})},r=function(t){var e=_.map(t,function(t){return n.usersById[t]});return n.assignedUsers=_.compact(e),n.selfAssigned=_.includes(t,u),n.isEditable=a()},n.$on("assigned-user:deleted",function(t,e){var r=_.clone(o.$modelValue.assigned_users,!1);return r=_.pull(r,e),r=_.uniq(r),s(r)}),n.$on("assigned-user:added",function(t,e){var r=_.clone(o.$modelValue.assigned_users,!1);return r.push(e),r=_.uniq(r),c(r,e)}),n.$watch(i.ngModel,function(t,e){if(null!=t)return r(t.assigned_users)}),n.$on("$destroy",function(){return t.off()})},require:"ngModel"}};angular.module("taigaComponents").directive("tgAssignedUsers",["$rootScope","$tgConfirm","$tgRepo","$tgQueueModelTransformation","$tgTemplate","$compile","$translate","tgCurrentUserService","tgLightboxFactory",t])}.call(this),function(){var t;function e(t,e,r,n,i){this.currentUserService=t,this.rootScope=e,this.lightboxFactory=r,this.translate=n,this.modelTransform=i,this.user=this.currentUserService.getUser(),this.loading=!1}e.$inject=["tgCurrentUserService","$rootScope","tgLightboxFactory","$translate","$tgQueueModelTransformation"],e.prototype.openWatchers=function(){var e,t=function(t){return e.save(t)};return(e=this).lightboxFactory.create("tg-lb-select-user",{class:"lightbox lightbox-select-user"},{currentUsers:this.item.watchers,activeUsers:this.activeUsers,onClose:t,lbTitle:this.translate.instant("COMMON.WATCHERS.ADD")})},e.prototype.getPerms=function(){return this.item?{userstories:"modify_us",issues:"modify_issue",tasks:"modify_task",epics:"modify_epic"}[this.item._name]:""},e.prototype.watch=function(){var t,e;return this.loading=!0,(t=this._watch()).finally((e=this,function(){return e.loading=!1})),t},e.prototype.unwatch=function(){var t,e;return this.loading=!0,(t=this._unwatch()).finally((e=this,function(){return e.loading=!1})),t},e.prototype.deleteWatcher=function(e){var t=_.filter(this.item.watchers,function(t){return t!==e});return this.save(t)},e.prototype.save=function(e){var t,r,n;return this.loading=!0,(t=this.modelTransform.save(function(t){return t.watchers=e,t})).then((r=this,function(){return r.rootScope.$broadcast("object:updated")})),t.finally((n=this,function(){return n.loading=!1}))},e.prototype._watch=function(){return this.onWatch()},e.prototype._unwatch=function(){return this.onUnwatch()},t=e,angular.module("taigaComponents").controller("TicketWatchersController",t)}.call(this),function(){var t=function(t,o,e,r,n,i,s,a){return{scope:!0,controller:"TicketWatchersController",bindToController:{item:"=",onWatch:"=",onUnwatch:"=",activeUsers:"="},controllerAs:"vm",templateUrl:"components/ticket-watchers/ticket-watchers.html",link:function(n,t,r){var i,e;return n.visibleWatchersCount=4,n.displayHidden=!1,n.isAuthenticated=!!a.getUser(),i=function(){var t,e;return-1!==(null!=(t=n.project)&&null!=(e=t.my_permissions)?e.indexOf(r.requiredPerm):void 0)},e=function(){var t=_.clone(null!=(t=n.vm.item)?t.watchers:void 0,!1),t=_.map(t,function(t){return n.usersById[t]});return t=_.filter(t,function(t){return!!t}),n.vm.watchers=_.compact(t),n.isEditable=i()},n.toggleFold=function(){return n.displayHidden=!n.displayHidden},t.on("click",".user-list-single",function(t){if(i())return t.stopPropagation(),n.vm.openWatchers()}),t.on("click",".remove-user",function(t){var e,r;if(i())return t.stopPropagation(),e=angular.element(t.currentTarget),r=e.data("watcher-id"),t=s.instant("COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER"),e=n.usersById[r].full_name_display,o.askOnDelete(t,e).then(function(t){return t.finish(),n.vm.deleteWatcher(r)})}),n.$on("watcher:added",function(t,e){var r=_.clone(n.item.watchers,!1);return r.push(e),r=_.uniq(watchers),n.vm.save(r)}),n.$on("watchers:selected",function(t,e){return n.vm.save(e)}),n.$watch("vm.item",function(t){if(t)return e()}),n.$on("$destroy",function(){return t.off()})}}};t.$inject=["$rootScope","$tgConfirm","$tgRepo","$tgQueueModelTransformation","$tgTemplate","$compile","$translate","tgCurrentUserService"],angular.module("taigaComponents").directive("tgWatchers",t)}.call(this),function(){var c=this.taiga.timeout,t=function(o,t){var s=[{contentType:"icon",icon:"icon-project",message:"PROJECTS_ORDER"},{contentType:"icon",icon:"icon-upvote",message:"VOTING"},{contentType:"icon",icon:"icon-attach",message:"ISSUES_TO_SPRINT"},{contentType:"icon",icon:"icon-clock",message:"DUE_DATE"},{contentType:"icon",icon:"icon-iocaine",message:"IOCAIN"},{contentType:"icon",icon:"icon-blocked-project",message:"BLOCKED"},{contentType:"icon",icon:"icon-promote",message:"PROMOTE"},{contentType:"icon",icon:"icon-bulk",message:"BULK"},{contentType:"range",message:"ZOOM"},{contentType:"icon",icon:"icon-settings",message:"CUSTOM_FIELDS"},{contentType:"arrows",message:"SLIDE_ARROWS"}],a=function(t){return Math.floor(Math.random()*t)+1};return{link:function(e,t,r){var n,i;return e.tipLoaded=!1,i=null,o.onStart(function(){return i=c(1e3,function(){return n()})}),o.onEnd(function(){return clearTimeout(i),e.tipLoaded=!1}),n=function(){var t;return e.tipLoaded=!0,t=s[a(s.length-1)],e.tip={contentType:t.contentType,message:"TIPS.TIP_"+t.message,icon:t.icon,color:"tip-color-"+a(5)}}},scope:!0,templateUrl:"components/tips/tip.html"}};angular.module("taigaComponents").directive("tgTips",["tgLoader","$translate",t])}.call(this),function(){var t=function(n,i){return{scope:{usId:"=",projectSlug:"="},controllerAs:"vm",templateUrl:"components/tribe-button/tribe-button.html",link:function(t,e,r){return t.vm={},t.vm.tribeHost=n.config.tribeHost,t.vm.url=i.protocol()+"://"+i.host(),"http"===i.protocol()&&80!==i.port()||"https"===i.protocol()&&443!==i.port()?t.vm.url=t.vm.url+":"+i.port():void 0}}};t.$inject=["$tgConfig","$tgLocation"],angular.module("taigaComponents").directive("tgTribeButton",t)}.call(this),function(){var t=function(n){return{templateUrl:"components/tribe-button/tribe-linked.html",scope:{gigTitle:"=",gigId:"="},link:function(e,t,r){return e.vm={},e.vm.tribeHost=n.config.tribeHost,e.vm.show=function(){return e.vm.open=!0},e.vm.hide=function(t){return e.vm.open=!1}}}};t.$inject=["$tgConfig"],angular.module("taigaComponents").directive("tgTribeLinked",t)}.call(this),function(){var t;function e(t){this.currentUserService=t,this.user=this.currentUserService.getUser(),this.loading=!1}e.$inject=["tgCurrentUserService"],e.prototype.toggleVote=function(){var t,e;return this.loading=!0,(t=this.item.is_voter?this.onDownvote():this.onUpvote()).finally((e=this,function(){return e.loading=!1})),t},t=e,angular.module("taigaComponents").controller("VoteButton",t)}.call(this),function(){var t=function(){return{scope:{},controller:"VoteButton",bindToController:{item:"=",onUpvote:"=",onDownvote:"="},controllerAs:"vm",templateUrl:"components/vote-button/vote-button.html"}};angular.module("taigaComponents").directive("tgVoteButton",t)}.call(this),function(){var t;function e(t,e,r){this.scope=t,this.rootscope=e,this.rs=r,this.new_wip_limit=this.status.wip_limit}e.$inject=["$scope","$rootScope","$tgResources"],e.prototype.submitSwimlaneNewStatus=function(){return this.scope.displayWipLimitSelector=!1,this.status.swimlane_userstory_status_id?this.rs.swimlanes.wipLimitUpdate(this.status.swimlane_userstory_status_id,this.new_wip_limit).then((e=this,function(){return e.rootscope.$broadcast("swimlane:load")})):this.rs.userstories.editStatus(this.status.id,this.new_wip_limit).then((t=this,function(){return t.rootscope.$broadcast("project:load")}));var t,e},t=e,angular.module("taigaComponents").controller("ProjectSwimlanesWipLimit",t)}.call(this),function(){this.taiga,this.taiga.timeout,this.taiga.cancelTimeout;var t=function(t){return{link:function(t,e,r){return t.displayWipLimitSelector=!1,t.toggleWipSelectorVisibility=function(){return t.displayWipLimitSelector=!t.displayWipLimitSelector}},scope:{},templateUrl:"components/wip-limit-selector/wip-limit-selector.html",controller:"ProjectSwimlanesWipLimit",bindToController:{status:"="},controllerAs:"vm"}};angular.module("taigaComponents").directive("tgWipLimitSelector",[t])}.call(this),function(){var t=function(o){return{scope:!0,link:function(i,t,e){return i.uploadFiles=function(t,e){var r=parseInt(i.vm.projectId,10),n=parseInt(i.vm.object,10);return r=r||parseInt(i.vm.project.id,10),o.addAttachment(r,n,o.types[i.vm.name],t,!0,!0).then(function(t){return e({default:t.getIn(["file","url"])})})}},template:'<div>\n    <tg-wysiwyg\n        editonly\n        required\n        project="vm.project"\n        content=\'vm.comment.comment\'\n        on-save="vm.saveComment(text, cb)"\n        on-cancel="vm.onEditMode({commentId: vm.comment.id})"\n        on-upload-file=\'uploadFiles\'>\n    </tg-wysiwyg>\n</div>'}};angular.module("taigaComponents").directive("tgCommentEditWysiwyg",["tgAttachmentsFullService",t])}.call(this),function(){var t=function(i,o,s){return{scope:!0,link:function(r,t,e){var n;return r.editableDescription=!1,r.saveComment=function(t,e){return r.content="",r.vm.type.comment=t,(t=i.save(function(t){})).then(function(){return r.vm.onAddComment&&r.vm.onAddComment(),o.$broadcast("object:updated")}),t.finally(e)},n={epics:"epic",userstories:"us",userstory:"us",issues:"issue",tasks:"task",epic:"epic",us:"us",issue:"issue",task:"task"},r.onChange=function(t){return r.vm.type.comment=t},r.uploadFiles=function(t,e){return s.addAttachment(r.vm.project.id,r.vm.type.id,n[r.vm.type._name],t,!0,!0).then(function(t){return e({default:t.getIn(["file","url"])})})},r.content="",r.$watch("vm.type",function(t){if(t)return r.storageKey="comment-"+t.project+"-"+t.id+"-"+t._name})},template:"<div>\n    <tg-wysiwyg\n        required\n        not-persist\n        project=\"vm.project\"\n        placeholder=\"'COMMENTS.TYPE_NEW_COMMENT '| translate\"\n        storage-key='storageKey'\n        content='content'\n        on-save='saveComment(text, cb)'\n        on-upload-file='uploadFiles'>\n    </tg-wysiwyg>\n</div>"}};angular.module("taigaComponents").directive("tgCommentWysiwyg",["$tgQueueModelTransformation","$rootScope","tgAttachmentsFullService",t])}.call(this),function(){var t=function(i){return{scope:!0,link:function(r,t,e){var n={epics:"epic",userstories:"us",userstory:"us",issues:"issue",tasks:"task",epic:"epic",us:"us",issue:"issue",task:"task"};return r.uploadFiles=function(t,e){return i.addAttachment(r.project.id,r.ctrl.objectId.toString(),n[r.ctrl.type],t).then(function(t){return e({default:t.getIn(["file","url"])})})}},template:'<tg-wysiwyg\n    class="custom-field"\n    editonly="!!customAttributeValue.value.length"\n    project="project"\n    content=\'customAttributeValue.value\'\n    on-save="saveCustomRichText(text, cb)"\n    on-cancel="cancelCustomRichText()"\n    on-upload-file=\'uploadFiles\'>\n</tg-wysiwyg>'}};angular.module("taigaComponents").directive("tgCustomFieldEditWysiwyg",["tgAttachmentsFullService",t])}.call(this),function(){var t=function(o,s,a,c,t){return{scope:!0,link:function(r,t,n){var i;return r.editableDescription=!1,r.saveDescription=function(e,t){var r=o.save(function(t){return t.description=e,t});return r.then(function(){return a.notify("success"),s.$broadcast("object:updated")}),r.then(null,function(){return a.notify("error")}),r.finally(t)},i={epics:"epic",userstories:"us",userstory:"us",issues:"issue",tasks:"task",epic:"epic",us:"us",issue:"issue",task:"task"},r.uploadFiles=function(t,e){return c.addAttachment(r.project.id,r.item.id,i[n.type],t).then(function(t){return e({default:t.getIn(["file","url"])})})},r.$watch(n.model,function(t){if(t)return r.item=t,r.version=t.version,r.storageKey=r.project.id+"-"+t.id+"-"+n.type}),r.$watch("project",function(t){if(t)return r.editableDescription=-1!==t.my_permissions.indexOf(n.requiredPerm)})},template:'<div>\n    <tg-wysiwyg\n        ng-if="editableDescription && project"\n        html-read-mode="true"\n        project="project"\n        placeholder="\'COMMON.DESCRIPTION.EMPTY \'| translate"\n        version=\'version\'\n        storage-key=\'storageKey\'\n        content=\'item.description\'\n        on-save=\'saveDescription(text, cb)\'\n        on-upload-file=\'uploadFiles\'>\n    </tg-wysiwyg>\n    <div\n        class="wysiwyg"\n        ng-if="!editableDescription && item.description.length"\n        tg-bind-wysiwyg-html="item.description"></div>\n\n    <div\n        class="wysiwyg no-description"\n        ng-if="!editableDescription && !item.description.length">\n        {{\'COMMON.DESCRIPTION.NO_DESCRIPTION\' | translate}}\n    </div>\n</div>'}};angular.module("taigaComponents").directive("tgItemWysiwyg",["$tgQueueModelTransformation","$rootScope","$tgConfirm","tgAttachmentsFullService","$translate",t])}.call(this),function(){this.taiga;var t=function(b,j,k,I,t,$,E,e,T){return{templateUrl:"common/components/wysiwyg-toolbar.html",scope:{htmlReadMode:"<",editonly:"<",project:"<",placeholder:"<",version:"<",storageKey:"<",content:"<",onCancel:"&",onSave:"&",onUploadFile:"<",onChange:"&"},link:function(i,e,t){var r,n,o,s,a,c,u,l,p,d,h,f,m,g,v,y=!!t.$attr.editonly,S=!!t.$attr.notPersist;return void 0!==i.editonly&&(y=i.editonly),i.required=!!t.$attr.required,i.editMode=y||!1,i.mode=localStorage.getItem("editor-mode")||"html","html"!==i.mode&&"markdown"!==i.mode&&(i.mode="html"),i.markdown="",i.html="",f=null,T.attachments.toJS(),s=[],l=function(){var n=null;if(e.on("mousedown",".js-wysiwyg-html",function(t){return n={x:t.clientX,y:t.clientY}}),e.on("click",".js-wysiwyg-html",function(t){var e=Math.abs(t.clientX-n.x),r=Math.abs(t.clientY-n.y);if(n=null,!(10<e||10<r))return"A"!==t.target.tagName&&"A"!==t.target.parentElement.tagName?i.$applyAsync(function(){return i.setEditMode(!0)}):void 0}),(s=f.querySelectorAll('a[target="_blank"]:not(.link-event)')).length)return s.forEach(function(t){return t.classList.add("link-event"),t.addEventListener("mousedown",function(t){if(!i.editMode)return t.preventDefault(),t.stopPropagation()}),t.addEventListener("click",function(t){if(!i.editMode)return window.open(t.currentTarget.getAttribute("href"),"_blank")})})},g=i.$watch("content",function(t){var e;if(!_.isUndefined(t)&&(i.outdated=u(),!i.markdown.length&&!t.length||i.markdown!==t))return t=a(),i.markdown=t,$.open()?e=$.onEnd(function(){return i.$evalAsync(function(){return n(t),e()})}):n(t),g()}),n=function(t){if(!f)return(f=document.createElement("tg-text-editor")).projectId=i.project.id,f.projectSlug=i.project.slug,f.placeholder=i.placeholder,h(t),f.mode=i.mode,f.lan=b.preferredLanguage(),f.uploadFunction=i.onUploadFile,f.members=i.project.members.map(function(t){return Object.assign(t,{fullNameDisplay:t.full_name_display})}),i.$applyAsync(l),c()&&i.setEditMode(!0),f.addEventListener("modeChanged",function(t){return i.$evalAsync(function(){return i.mode=t.detail,i.setEditMode(!0),localStorage.setItem("editor-mode",i.mode)})}),f.addEventListener("focusChanged",function(t){if(t.detail)return i.$evalAsync(function(){return i.setEditMode(!0)})}),f.addEventListener("changed",function(t){return"html"===i.mode?i.html=t.detail:i.markdown=t.detail,m()}),e.find(".editor-wrapper")[0].appendChild(f)},h=function(t){return I.refreshAttachmentURLFromMarkdown(t).then(function(t){return f.markdown=t})},i.setEditMode=function(t){return i.editMode=t,f.mode=t?i.mode:"html"},i.save=function(t){t&&t.preventDefault(),h(i.markdown),i.required&&!i.markdown.length||(i.saving=!0,i.outdated=!1,i.onSave({text:i.markdown,cb:d}),l())},i.cancel=function(t){t&&t.preventDefault(),y||i.setEditMode(!1),S?r():(i.markdown=i.content,h(i.content||"")),o(),i.outdated=!1,i.onCancel(),l()},r=function(){return i.markdown="",h("")},d=function(){return i.saving=!1,y||i.setEditMode(!1),S&&r(),o(),E.trackEvent("develop","save wysiwyg",i.mode,1)},u=function(){var t=k.get(i.storageKey);return!(!t||!t.version||t.version===i.version)},c=function(){return!!k.get(i.storageKey)},a=function(){var t=k.get(i.storageKey);return t?t.text:i.content},o=function(){return k.remove(i.storageKey)},i.cancelWithConfirmation=function(){var t,e;return i.content===i.markdown?(i.cancel(),document.activeElement.blur&&document.activeElement.blur(),document.body.click(),null):(e=b.instant("COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE"),t=b.instant("COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE"),j.ask(e,null,t).then(function(t){return i.cancel(),t.finish()}))},v=function(){return i.markdown=I.getMarkdown(i.html)},p=function(t){var e;if(i.storageKey)return(e={}).version=i.version||0,e.text=t,k.set(i.storageKey,e)},t=function(){if(i.editMode)return"html"===i.mode&&v(),p(i.markdown),i.onChange({markdown:i.markdown})},m=_.throttle(t,200)}}};angular.module("taigaComponents").directive("tgWysiwyg",["$translate","$tgConfirm","$tgStorage","tgWysiwygService","animationFrame","tgLoader","$tgAnalytics","$location","tgAttachmentsFullService",t])}.call(this),function(){var t;function e(t,e,r,n){this.projectService=t,this.attachmentsFullService=e,this.attachmentsService=r,this.sce=n,this.projectDataConversion={},this.cache={}}e.$inject=["tgProjectService","tgAttachmentsFullService","tgAttachmentsService","$sce"],e.prototype.getMarkdown=function(t){var e=this.projectService.project.get("id");return this.projectDataConversion[e]||(this.dataConversion=window.angularDataConversion(),this.dataConversion.setUp(this.projectService.project.get("slug")),this.projectDataConversion[e]=this.dataConversion),this.projectDataConversion[e].toMarkdown(t)},e.prototype.getHTML=function(t){var e;return t&&t.length?(e=this.projectService.project.get("id"),this.projectDataConversion[e]||(this.dataConversion=window.angularDataConversion(),this.dataConversion.setUp(this.projectService.project.get("slug")),this.projectDataConversion[e]=this.dataConversion),this.projectDataConversion[e].toHtml(t)):""},e.prototype.getAttachmentData=function(t){return this.attachmentsService.get(t[0],t[1]).then(function(t){return t.data.url})},e.prototype.getCachedAttachment=function(t){var e,r,n=parseInt(t[1],10),i=this.attachmentsFullService.attachments.toJS().find(function(t){return t.file.id===n});return i?Promise.resolve(i.file.url):(e=t[0]+t[1],(i=this.cache[e])?Promise.resolve(i):this.getAttachmentData(t).then((r=this,function(t){return r.cache[e]=t})))},e.prototype.relativePaths=function(t){var e=document.createElement("html");return e.innerHTML=this.sce.trustAsHtml(t)||"",e.querySelectorAll("a").forEach(function(t){var e,r=t.getAttribute("href");if(!r||r.startsWith("http")||r.startsWith("/")||t.classList.contains("mention")||((e=window.location.href.slice(0,window.location.href.lastIndexOf("/")+1)).endsWith("/")||(e+="/"),e=e+t.getAttribute("href"),t.removeAttribute("rel"),t.removeAttribute("target"),t.setAttribute("href",e)),r.startsWith("project")&&t.classList.contains("mention"))return t.removeAttribute("rel"),t.removeAttribute("target")}),e.innerHTML},e.prototype.refreshAttachmentURLFromMarkdown=function(t){var e,t=this.getHTML(t);return this.refreshAttachmentURL(t).then((e=this,function(t){return e.getMarkdown(t)}))},e.prototype.refreshAttachmentURL=function(t){var e,i,o,s,r=document.createElement("html");return window._extraValidHtmlElments={input:!0},window._extraValidAttrs={checked:!0},r.innerHTML=this.sce.trustAsHtml(t)||"",o=/#_taiga-refresh=([a-zA-Z]*\:\d+)/,e={elements:r.querySelectorAll("a"),attr:"href"},t={elements:r.querySelectorAll("img"),attr:"src"},i=[],_.map([e,t],(s=this,function(n){return _.map(n.elements,function(e){var t,r=e.getAttribute(n.attr);if(r&&r.indexOf&&-1!==r.indexOf("#_taiga-refresh=")&&(t=r.match(o))&&2===t.length)return t=t[1].split(":"),t=s.getCachedAttachment(t).then(function(t){return e.setAttribute(n.attr,t)}).catch(function(){return console.warn("attachment ref not found",r)}),i.push(t)})})),Promise.all(i).then(function(){return r.innerHTML})},t=e,angular.module("taigaComponents").service("tgWysiwygService",t)}.call(this),function(){var t;function e(t){this.translate=t,this.is_open=!1,this.texts={week:this.translate.instant("DISCOVER.FILTERS.WEEK"),month:this.translate.instant("DISCOVER.FILTERS.MONTH"),year:this.translate.instant("DISCOVER.FILTERS.YEAR"),all:this.translate.instant("DISCOVER.FILTERS.ALL_TIME")}}e.$inject=["$translate"],e.prototype.currentText=function(){return this.texts[this.currentOrderBy]},e.prototype.open=function(){return this.is_open=!0},e.prototype.close=function(){return this.is_open=!1},e.prototype.orderBy=function(t){return this.currentOrderBy=t,this.is_open=!1,this.onChange({orderBy:this.currentOrderBy})},t=e,angular.module("taigaDiscover").controller("DiscoverHomeOrderBy",t)}.call(this),function(){var t=function(){return{controller:"DiscoverHomeOrderBy",controllerAs:"vm",bindToController:!0,templateUrl:"discover/components/discover-home-order-by/discover-home-order-by.html",scope:{currentOrderBy:"=orderBy",onChange:"&"},link:function(t,e,r){}}};t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverHomeOrderBy",t)}.call(this),function(){var t;function e(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"projects",(e=this,function(){return e.discoverProjectsService.projectsCount})),this.discoverProjectsService.fetchStats()}e.$inject=["tgDiscoverProjectsService"],e.prototype.selectFilter=function(t){return this.onChange({filter:t,q:this.q})},e.prototype.submitFilter=function(){return this.onChange({filter:this.filter,q:this.q})},t=e,angular.module("taigaDiscover").controller("DiscoverSearchBar",t)}.call(this),function(){var t=function(){return{controller:"DiscoverSearchBar",controllerAs:"vm",templateUrl:"discover/components/discover-search-bar/discover-search-bar.html",bindToController:!0,scope:{q:"=",filter:"=",onChange:"&"},compile:function(t,e){if(!e.q)return e.q=""},link:function(t,e,r,n){}}};t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearchBar",t)}.call(this),function(){var t;function e(){this.like_is_open=0===this.orderBy.indexOf("-total_fans"),this.activity_is_open=0===this.orderBy.indexOf("-total_activity")}e.$inject=[],e.prototype.openLike=function(){return this.like_is_open=!0,this.activity_is_open=!1,this.setOrderBy("-total_fans_last_week")},e.prototype.openActivity=function(){return this.activity_is_open=!0,this.like_is_open=!1,this.setOrderBy("-total_activity_last_week")},e.prototype.setOrderBy=function(t){return null==t&&(t=""),t||(this.like_is_open=!1,this.activity_is_open=!1),this.onChange({orderBy:t})},t=e,angular.module("taigaDiscover").controller("DiscoverSearchListHeader",t)}.call(this),function(){var t=function(){return{controller:"DiscoverSearchListHeader",controllerAs:"vm",bindToController:!0,templateUrl:"discover/components/discover-search-list-header/discover-search-list-header.html",scope:{onChange:"&",orderBy:"="},link:function(t,e,r){}}};t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearchListHeader",t)}.call(this),function(){var t;function e(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"featured",(e=this,function(){return e.discoverProjectsService.featured})),this.discoverProjectsService.fetchFeatured()}e.$inject=["tgDiscoverProjectsService"],t=e,angular.module("taigaDiscover").controller("FeaturedProjects",t)}.call(this),function(){var t=function(){return{controller:"FeaturedProjects",controllerAs:"vm",templateUrl:"discover/components/featured-projects/featured-projects.html",scope:{},link:function(t,e,r){}}};t.$inject=[],angular.module("taigaDiscover").directive("tgFeaturedProjects",t)}.call(this),function(){var t=function(){return{templateUrl:"discover/components/highlighted/highlighted.html",scope:{loading:"=",highlighted:"=",orderBy:"="}}};t.$inject=[],angular.module("taigaDiscover").directive("tgHighlighted",t)}.call(this),function(){var t;function e(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"highlighted",(e=this,function(){return e.discoverProjectsService.mostActive})),this.currentOrderBy="year",this.order_by=this.getOrderBy()}e.$inject=["tgDiscoverProjectsService"],e.prototype.fetch=function(){return this.loading=!0,this.order_by=this.getOrderBy(),this.discoverProjectsService.fetchMostActive({order_by:this.order_by}).then((t=this,function(){return t.loading=!1}));var t},e.prototype.orderBy=function(t){return this.currentOrderBy=t,this.fetch()},e.prototype.getOrderBy=function(t){return"all"===this.currentOrderBy?"-total_activity":"-total_activity_last_"+this.currentOrderBy},t=e,angular.module("taigaDiscover").controller("MostActive",t)}.call(this),function(){var t=function(){return{controller:"MostActive",controllerAs:"vm",templateUrl:"discover/components/most-active/most-active.html",scope:{},link:function(t,e,r,n){return n.fetch()}}};t.$inject=[],angular.module("taigaDiscover").directive("tgMostActive",t)}.call(this),function(){var t;function e(t){var e;this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"highlighted",(e=this,function(){return e.discoverProjectsService.mostLiked})),this.currentOrderBy="year",this.order_by=this.getOrderBy()}e.$inject=["tgDiscoverProjectsService"],e.prototype.fetch=function(){return this.loading=!0,this.order_by=this.getOrderBy(),this.discoverProjectsService.fetchMostLiked({order_by:this.order_by}).then((t=this,function(){return t.loading=!1}));var t},e.prototype.orderBy=function(t){return this.currentOrderBy=t,this.fetch()},e.prototype.getOrderBy=function(){return"all"===this.currentOrderBy?"-total_fans":"-total_fans_last_"+this.currentOrderBy},t=e,angular.module("taigaDiscover").controller("MostLiked",t)}.call(this),function(){var t=function(){return{controller:"MostLiked",controllerAs:"vm",templateUrl:"discover/components/most-liked/most-liked.html",scope:{},link:function(t,e,r,n){return n.fetch()}}};t.$inject=[],angular.module("taigaDiscover").directive("tgMostLiked",t)}.call(this),function(){var t;function e(t,e,r,n){this.location=t,this.navUrls=e,this.appMetaService=r,this.translate=n,r=this.translate.instant("DISCOVER.PAGE_TITLE"),n=this.translate.instant("DISCOVER.PAGE_DESCRIPTION"),this.appMetaService.setAll(r,n)}e.$inject=["$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],e.prototype.onSubmit=function(t){var e=this.navUrls.resolve("discover-search");return this.location.search("text",t).path(e)},t=e,angular.module("taigaDiscover").controller("DiscoverHome",t)}.call(this),function(){var t;function e(t,e,r,n,i,o,s){var a,c;this.routeParams=t,this.discoverProjectsService=e,this.route=r,this.location=n,this.analytics=i,this.appMetaService=o,this.translate=s,this.page=1,taiga.defineImmutableProperty(this,"searchResult",(a=this,function(){return a.discoverProjectsService.searchResult})),taiga.defineImmutableProperty(this,"nextSearchPage",(c=this,function(){return c.discoverProjectsService.nextSearchPage})),this.q=this.routeParams.text,this.filter=this.routeParams.filter||"all",this.orderBy=this.routeParams.order_by||"",this.loadingGlobal=!1,this.loadingList=!1,this.loadingPagination=!1,o=this.translate.instant("DISCOVER.SEARCH.PAGE_TITLE"),s=this.translate.instant("DISCOVER.SEARCH.PAGE_DESCRIPTION"),this.appMetaService.setAll(o,s),this.analytics.trackPage(this.location.url(),"Discover Search")}e.$inject=["$routeParams","tgDiscoverProjectsService","$route","$tgLocation","$tgAnalytics","tgAppMetaService","$translate"],e.prototype.fetch=function(){return this.page=1,this.discoverProjectsService.resetSearchList(),this.search()},e.prototype.fetchByGlobalSearch=function(){var t;if(!this.loadingGlobal)return this.loadingGlobal=!0,this.fetch().then((t=this,function(){return t.loadingGlobal=!1}))},e.prototype.fetchByOrderBy=function(){var t;if(!this.loadingList)return this.loadingList=!0,this.fetch().then((t=this,function(){return t.loadingList=!1}))},e.prototype.showMore=function(){var t;if(!this.loadingPagination)return this.loadingPagination=!0,this.page++,this.search().then((t=this,function(){return t.loadingPagination=!1}))},e.prototype.search=function(){var t=this.getFilter(),e={page:this.page,q:this.q,order_by:this.orderBy};return _.assign(e,t),this.discoverProjectsService.fetchSearch(e)},e.prototype.getFilter=function(){return"people"===this.filter?{is_looking_for_people:!0}:"scrum"===this.filter?{is_backlog_activated:!0}:"kanban"===this.filter?{is_kanban_activated:!0}:{}},e.prototype.onChangeFilter=function(t,e){return this.filter=t,this.q=e,this.route.updateParams({filter:this.filter,text:this.q}),this.analytics.trackPage(this.location.url(),"Discover Search"),this.fetchByGlobalSearch()},e.prototype.onChangeOrder=function(t){return this.orderBy=t,this.route.updateParams({order_by:t}),this.analytics.trackPage(this.location.url(),"Discover Search"),this.fetchByOrderBy()},t=e,angular.module("taigaDiscover").controller("DiscoverSearch",t)}.call(this),function(){var t=function(){return{controller:"DiscoverSearch",controllerAs:"vm",link:function(t,e,r,n){return n.fetch()}}};t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearch",t)}.call(this),function(){var t,c,r,i={}.hasOwnProperty;function e(t,e){var r,n,i,o,s,a;this.rs=t,this.projectsService=e,this._mostLiked=Immutable.List(),this._mostActive=Immutable.List(),this._featured=Immutable.List(),this._searchResult=Immutable.List(),this._projectsCount=0,this.decorate=this.projectsService._decorate.bind(this.projectsService),c.defineImmutableProperty(this,"mostLiked",(r=this,function(){return r._mostLiked})),c.defineImmutableProperty(this,"mostActive",(n=this,function(){return n._mostActive})),c.defineImmutableProperty(this,"featured",(i=this,function(){return i._featured})),c.defineImmutableProperty(this,"searchResult",(o=this,function(){return o._searchResult})),c.defineImmutableProperty(this,"nextSearchPage",(s=this,function(){return s._nextSearchPage})),c.defineImmutableProperty(this,"projectsCount",(a=this,function(){return a._projectsCount}))}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,(c=this.taiga).Service),e.$inject=["tgResources","tgProjectsService"],r={discover_mode:!0},e.prototype.fetchMostLiked=function(t){var e,t=_.extend({},r,t);return this.rs.projects.getProjects(t,!1).then((e=this,function(t){var t=t.data.slice(0,4),t=Immutable.fromJS(t);return t=t.map(e.decorate),e._mostLiked=t}))},e.prototype.fetchMostActive=function(t){var e,t=_.extend({},r,t);return this.rs.projects.getProjects(t,!1).then((e=this,function(t){var t=t.data.slice(0,4),t=Immutable.fromJS(t);return t=t.map(e.decorate),e._mostActive=t}))},e.prototype.fetchFeatured=function(){var e,t=_.extend({},r);return t.is_featured=!0,this.rs.projects.getProjects(t,!1).then((e=this,function(t){var t=t.data.slice(0,4),t=Immutable.fromJS(t);return t=t.map(e.decorate),e._featured=t}))},e.prototype.resetSearchList=function(){return this._searchResult=Immutable.List()},e.prototype.fetchStats=function(){return this.rs.stats.discover().then((e=this,function(t){return e._projectsCount=t.getIn(["projects","total"])}));var e},e.prototype.fetchSearch=function(t){var e,t=_.extend({},r,t);return this.rs.projects.getProjects(t).then((e=this,function(t){return e._nextSearchPage=!!t.headers("X-Pagination-Next"),t=(t=Immutable.fromJS(t.data)).map(e.decorate),e._searchResult=e._searchResult.concat(t)}))},t=e,angular.module("taigaDiscover").service("tgDiscoverProjectsService",t)}.call(this),function(){var i,t,r;function e(t,e,r,n){this.confirm=t,this.projectService=e,this.epicsService=r,this.analytics=n,this.project=this.projectService.project.toJS(),this.newEpic={color:i(),status:this.project.default_epic_status,tags:[]},this.attachments=Immutable.List(),this.loading=!1}t=this.taiga,r=t.trim,i=t.getRandomDefaultColor,e.$inject=["$tgConfirm","tgProjectService","tgEpicsService","$tgAnalytics"],e.prototype.createEpic=function(){var e,r;if(this.validateForm())return this.loading=!0,this.epicsService.createEpic(this.newEpic,this.attachments).then((r=this,function(t){return r.analytics.trackEvent("epic","create","create epic",1),r.onCreateEpic(),r.loading=!1})).catch((e=this,function(t){if(e.loading=!1,e.setFormErrors(t.data),t.data._error_message)return e.confirm.notify("error",t.data._error_message)}))},e.prototype.selectColor=function(t){return this.newEpic.color=t},e.prototype.addTag=function(e,t){if(e=r(e.toLowerCase()),!_.find(this.newEpic.tags,function(t){return t[0]===e}))return this.newEpic.tags.push([e,t])},e.prototype.deleteTag=function(e){return _.remove(this.newEpic.tags,function(t){return t[0]===e[0]})},e.prototype.addAttachment=function(t){return this.attachments.push(t)},t=e,angular.module("taigaEpics").controller("CreateEpicCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){var i=e.find("form").checksley();return n.validateForm=function(){return i.validate()},n.setFormErrors=function(t){return i.setErrors(t)}},templateUrl:"epics/create-epic/create-epic.html",controller:"CreateEpicCtrl",controllerAs:"vm",bindToController:{onCreateEpic:"&"},scope:{}}};angular.module("taigaEpics").directive("tgCreateEpic",t)}.call(this),function(){var t;function e(t,e,r){this.confirm=t,this.projectService=e,this.epicsService=r,this.displayUserStories=!1,this.displayAssignedTo=!1,this.displayStatusList=!1,this.loadingStatus=!1,this.project=this.projectService.project.toJS(),this._calculateProgressBar()}e.$inject=["$tgConfirm","tgProjectService","tgEpicsService"],e.prototype._calculateProgressBar=function(){var t,e;return!0===this.epic.getIn(["status_extra_info","is_closed"])?this.percentage="100%":(t=this.epic.getIn(["user_stories_counts","progress"]),e=this.epic.getIn(["user_stories_counts","total"]),this.percentage=0===e?"0%":100*t/e+"%")},e.prototype.canEditEpics=function(){return this.projectService.hasPermission("modify_epic")},e.prototype.toggleUserStoryList=function(){return this.displayUserStories?this.displayUserStories=!1:this.epicsService.listRelatedUserStories(this.epic).then((e=this,function(t){return e.epicStories=t,e.displayUserStories=!0})).catch((t=this,function(){return t.confirm.notify("error")}));var t,e},e.prototype.updateStatus=function(t){return this.displayStatusList=!1,this.loadingStatus=!0,this.epicsService.updateEpicStatus(this.epic,t).catch((r=this,function(){return r.confirm.notify("error")})).finally((e=this,function(){return e.loadingStatus=!1}));var e,r},e.prototype.updateAssignedTo=function(t){return this.assignLoader=!0,this.epicsService.updateEpicAssignedTo(this.epic,(null!=t?t.id:void 0)||null).catch((r=this,function(){return r.confirm.notify("error")})).then((e=this,function(){return e.assignLoader=!1}));var e,r},t=e,angular.module("taigaEpics").controller("EpicRowCtrl",t)}.call(this),function(){var t=function(){return{templateUrl:"epics/dashboard/epic-row/epic-row.html",controller:"EpicRowCtrl",controllerAs:"vm",bindToController:!0,scope:{epic:"=",options:"="}}};angular.module("taigaEpics").directive("tgEpicRow",t)}.call(this),function(){var t,p;function e(t,e,r,n,i,o,s,a,c){var u,l;this.params=t,this.errorHandlingService=e,this.lightboxFactory=r,this.lightboxService=n,this.confirm=i,this.projectService=o,this.epicsService=s,this.appMetaService=a,this.translate=c,this.sectionName="EPICS.SECTION_NAME",p.defineImmutableProperty(this,"project",(u=this,function(){return u.projectService.project})),p.defineImmutableProperty(this,"epics",(l=this,function(){return l.epicsService.epics})),this.appMetaService.setfn(this._setMeta.bind(this))}p=this.taiga,e.$inject=["$routeParams","tgErrorHandlingService","tgLightboxFactory","lightboxService","$tgConfirm","tgProjectService","tgEpicsService","tgAppMetaService","$translate"],e.prototype._setMeta=function(){var t;return this.project?(t={projectName:this.project.get("name"),projectDescription:this.project.get("description")},{title:this.translate.instant("EPICS.PAGE_TITLE",t),description:this.translate.instant("EPICS.PAGE_DESCRIPTION",t)}):null},e.prototype.loadInitialData=function(){return this.epicsService.clear(),this.projectService.setProjectBySlug(this.params.pslug).then((t=this,function(){return t.projectService.isEpicsDashboardEnabled()?t.projectService.hasPermission("view_epics")?t.epicsService.fetchEpics():t.errorHandlingService.permissionDenied():t.errorHandlingService.notFound()}));var t},e.prototype.canCreateEpics=function(){return this.projectService.hasPermission("add_epic")},e.prototype.onCreateEpic=function(){var t,e=function(){t.lightboxService.closeAll(),t.confirm.notify("success")};return(t=this).lightboxFactory.create("tg-create-epic",{class:"lightbox lightbox-create-epic open","on-create-epic":"onCreateEpic()"},{onCreateEpic:e.bind(this)})},t=e,angular.module("taigaEpics").controller("EpicsDashboardCtrl",t)}.call(this),function(){var t=function(o,s){return{link:function(n,t,e){var i,r;if(s.hasPermission("modify_epic"))return i=o(e.tgEpicsSortable),(r=dragula([t[0]],{copySortSource:!1,copy:!1,mirrorContainer:t[0],moves:function(t){return $(t).is("div.epics-table-body-row")}})).on("dragend",function(t){var t=$(t),e=t.scope().epic,r=t.index();return n.$apply(function(){return i(n,{epic:e,newIndex:r})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&r.dragging}}),n.$on("$destroy",function(){return t.off(),r.destroy()})}}};t.$inject=["$parse","tgProjectService"],angular.module("taigaComponents").directive("tgEpicsSortable",t)}.call(this),function(){var t,c,u;function e(t,e,r,n,i){var o,s,a;this.confirm=t,this.epicsService=e,this.timeout=r,this.storage=n,this.projectService=i,this.hash=c([this.projectService.project.get("id"),"epics"]),this.displayOptions=!1,this.displayVotes=!0,this.options=this.storage.get(this.hash,{votes:!0,name:!0,project:!0,sprint:!0,assigned:!0,status:!0,progress:!0,closed:!0,closed_us:!0}),u.defineImmutableProperty(this,"epics",(o=this,function(){return o.epicsService.epics})),u.defineImmutableProperty(this,"disabledEpicsPagination",(s=this,function(){return s.epicsService._disablePagination})),u.defineImmutableProperty(this,"loadingEpics",(a=this,function(){return a.epicsService._loadingEpics}))}u=this.taiga,c=this.taiga.generateHash,e.$inject=["$tgConfirm","tgEpicsService","$timeout","$tgStorage","tgProjectService"],e.prototype.toggleEpicTableOptions=function(){return this.displayOptions=!this.displayOptions},e.prototype.reorderEpic=function(t,e){return t.get("epics_order")===e?null:this.epicsService.reorderEpic(t,e).then(null,(r=this,function(){return r.confirm.notify("error")}));var r},e.prototype.nextPage=function(){return this.epicsService.nextPage()},e.prototype.hoverEpicTableOption=function(){if(this.timer)return this.timeout.cancel(this.timer)},e.prototype.hideEpicTableOption=function(){return this.timer=this.timeout((t=this,function(){return t.displayOptions=!1}),400);var t},e.prototype.updateViewOptions=function(){return this.storage.set(this.hash,this.options)},t=e,angular.module("taigaEpics").controller("EpicsTableCtrl",t)}.call(this),function(){var t=function(){return{templateUrl:"epics/dashboard/epics-table/epics-table.html",controller:"EpicsTableCtrl",controllerAs:"vm",scope:{}}};angular.module("taigaEpics").directive("tgEpicsTable",t)}.call(this),function(){var t;function e(){this._calculateProgressBar()}t=angular.module("taigaEpics"),e.$inject=[],e.prototype._calculateProgressBar=function(){var t,e;return!0===this.story.get("is_closed")?this.percentage="100%":(t=this.story.get("tasks").size,e=this.story.get("tasks").filter(function(t){return t.get("is_closed")}).size,this.percentage=0===t?"0%":100*e/t+"%")},t.controller("StoryRowCtrl",e)}.call(this),function(){var t=function(){return{templateUrl:"epics/dashboard/story-row/story-row.html",controller:"StoryRowCtrl",controllerAs:"vm",bindToController:!0,scope:{story:"=",options:"="}}};angular.module("taigaEpics").directive("tgStoryRow",t)}.call(this),function(){var t,s;function e(t,e,r,n,i){var o;this.projectService=t,this.attachmentsService=e,this.resources=r,this.xhrError=n,this.q=i,this.clear(),s.defineImmutableProperty(this,"epics",(o=this,function(){return o._epics}))}s=this.taiga,e.$inject=["tgProjectService","tgAttachmentsService","tgResources","tgXhrErrorService","$q"],e.prototype.clear=function(){return this._loadingEpics=!1,this._disablePagination=!1,this._page=1,this._epics=Immutable.List()},e.prototype.fetchEpics=function(e){return null==e&&(e=!1),this._loadingEpics=!0,this._disablePagination=!0,this.resources.epics.list(this.projectService.project.get("id"),this._page).then((n=this,function(t){return e?(n.clear(),n._epics=t.list):n._epics=n._epics.concat(t.list),n._loadingEpics=!1,n._disablePagination=!t.headers("x-pagination-next")})).catch((r=this,function(t){return r.xhrError.response(t)}));var r,n},e.prototype.nextPage=function(){return this._page++,this.fetchEpics()},e.prototype.listRelatedUserStories=function(t){return this.resources.userstories.listInEpic(t.get("id"))},e.prototype.createEpic=function(t,r,e){return t.project=e||this.projectService.project.get("id"),this.resources.epics.post(t).then((n=this,function(e){var t;return r?(t=_.map(r.toJS(),function(t){return n.attachmentsService.upload(t.file,e.get("id"),e.get("project"),"epic")}),n.q.all(t).then(n.fetchEpics.bind(n,!0))):e}));var n},e.prototype.reorderEpic=function(e,t){var r,n,i,o,s={};return this._epics.forEach(function(t){return s[t.get("id")]=t.get("epics_order")}),n=(i=this.epics.filter(function(t){return t.get("id")!==e.get("id")})).slice(0,t),i=i.slice(t),t=(r=n.last())?r.get("epics_order")+1:0,s[e.get("id")]=t,n=n.filter(function(t){return t.get("epics_order")===r.get("epics_order")}),n=_.fromPairs(n.map(function(t){return[t.get("id"),t.get("epics_order")]}).toJS()),i.forEach(function(t){return s[t.get("id")]=t.get("epics_order")+1}),this._epics=this._epics.map(function(t){return t.set("epics_order",s[t.get("id")])}),this._epics=this._epics.sortBy(function(t){return t.get("epics_order")}),t={epics_order:t,version:e.get("version")},this.resources.epics.reorder(e.get("id"),t,n).then((o=this,function(e){return o._epics=o._epics.map(function(t){return t.get("id")===e.get("id")?e:t})}))},e.prototype.reorderRelatedUserstory=function(t,e,r,n){var i,o=e.filter(function(t){return t.get("id")!==r.get("id")}).slice(0,n),s=o.last(),a=s?s.get("epic_order")+1:0,e=o.filter(function(t){return t.get("epic_order")===s.get("epic_order")}),n=_.fromPairs(e.map(function(t){return[t.get("id"),t.get("epic_order")]}).toJS()),o={order:a},e=t.get("id"),a=r.get("id");return this.resources.epics.reorderRelatedUserstory(e,a,o,n).then((i=this,function(){return i.listRelatedUserStories(t)}))},e.prototype.replaceEpic=function(e){return this._epics=this._epics.map(function(t){return t.get("id")===e.get("id")?e:t})},e.prototype.updateEpicStatus=function(t,e){e={status:e,version:t.get("version")};return this.resources.epics.patch(t.get("id"),e).then(this.replaceEpic.bind(this))},e.prototype.updateEpicAssignedTo=function(t,e){e={assigned_to:e,version:t.get("version")};return this.resources.epics.patch(t.get("id"),e).then(this.replaceEpic.bind(this))},t=e,angular.module("taigaEpics").service("tgEpicsService",t)}.call(this),function(){var t;function e(t,e){this.projectService=t,this.epicsService=e,this.sectionName="Epics",this.showCreateRelatedUserstoriesLightbox=!1}t=angular.module("taigaEpics"),e.$inject=["tgProjectService","tgEpicsService"],e.prototype.showRelatedUserStoriesSection=function(){var t;return this.projectService.hasPermission("view_epics")||0<(null!=(t=this.userstories)?t.length:void 0)},e.prototype.userCanSort=function(){return this.projectService.hasPermission("modify_epic")},e.prototype.loadRelatedUserstories=function(){return this.epicsService.listRelatedUserStories(this.epic).then((e=this,function(t){return e.userstories=t}));var e},e.prototype.reorderRelatedUserstory=function(t,e){return this.epicsService.reorderRelatedUserstory(this.epic,this.userstories,t,e).then((r=this,function(t){return r.userstories=t}));var r},t.controller("RelatedUserStoriesCtrl",e)}.call(this),function(){var t;function e(t,e,r,n){this.currentUserService=t,this.rs=e,this.confirm=r,this.analytics=n,this.projects=null,this.projectUserstories=Immutable.List(),this.loading=!1}t=angular.module("taigaEpics"),e.$inject=["tgCurrentUserService","tgResources","$tgConfirm","$tgAnalytics"],e.prototype.loadProjects=function(){if(null===this.projects)return this.projects=this.currentUserService.projects.get("unblocked")},e.prototype.filterUss=function(t,e){var r;return this.rs.userstories.listInAllProjects({project:t,q:e},!0).then((r=this,function(t){var e=r.epicUserstories.map(function(t){return t.get("id")}),t=t.filter(function(t){return-1===e.indexOf(t.get("id"))});return r.projectUserstories=t}))},e.prototype.saveRelatedUserStory=function(t,e){var r,n,i,o,s;if(this.validateExistingUserstoryForm())return this.loading=!0,n=function(t){return o.loading=!1,o.confirm.notify("error"),o.setExistingUserstoryFormErrors(t)},i=function(){return s.analytics.trackEvent("epic related user story","create","create related user story on epic",1),s.loading=!1,e&&e(),s.loadRelatedUserstories()},r=(s=o=this).epic.get("id"),this.rs.epics.addRelatedUserstory(r,t).then(i,n)},e.prototype.bulkCreateRelatedUserStories=function(t,e,r){var n,i,o,s,a;if(this.validateNewUserstoryForm())return this.loading=!0,i=function(t){return s.loading=!1,s.confirm.notify("error"),s.setNewUserstoryFormErrors(t)},o=function(){return a.analytics.trackEvent("epic related user story","create","create related user story on epic",1),a.loading=!1,r&&r(),a.loadRelatedUserstories()},n=(a=s=this).epic.get("id"),this.rs.epics.bulkCreateRelatedUserStories(n,t,e).then(o,i)},t.controller("RelatedUserstoriesCreateCtrl",e)}.call(this),function(){var t=angular.module("taigaEpics"),s=this.taiga.debounceLeading,e=function(t){return this.lightboxService=t,{link:function(e,r,t,n){var i=r.find(".new-user-story-form").checksley(),o=r.find(".existing-user-story-form").checksley();return n.validateNewUserstoryForm=function(){return i.validate()},n.setNewUserstoryFormErrors=function(t){return i.setErrors(t)},n.validateExistingUserstoryForm=function(){return o.validate()},n.setExistingUserstoryFormErrors=function(t){return o.setErrors(t)},e.showLightbox=function(t){return n.loadProjects(),e.selectProject(t).then(function(){return lightboxService.open(r.find(".lightbox-create-related-user-stories"))})},e.closeLightbox=function(){return e.selectedUserstory=null,e.searchUserstory="",e.relatedUserstoriesText="",lightboxService.close(r.find(".lightbox-create-related-user-stories"))},e.$watch("vm.project",function(t){if(null!=t)return e.selectedProject=t.get("id")}),e.selectProject=function(t){return e.selectedUserstory=null,e.searchUserstory="",n.filterUss(t,e.searchUserstory)},e.onUpdateSearchUserstory=s(300,function(){return e.selectedUserstory=null,n.filterUss(e.selectedProject,e.searchUserstory)})},templateUrl:"epics/related-userstories/related-userstories-create/related-userstories-create.html",controller:"RelatedUserstoriesCreateCtrl",controllerAs:"vm",bindToController:!0,scope:{showCreateRelatedUserstoriesLightbox:"=",project:"=",epic:"=",epicUserstories:"=",loadRelatedUserstories:"&"}}};e.$inject=["lightboxService"],t.directive("tgRelatedUserstoriesCreate",e)}.call(this),function(){var t=angular.module("taigaEpics"),e=function(o,s){return{link:function(n,t,e){var i,r;if(s.hasPermission("modify_epic"))return i=o(e.tgRelatedUserstoriesSortable),(r=dragula([t[0]],{copySortSource:!1,copy:!1,mirrorContainer:t[0],moves:function(t){return $(t).is("tg-related-userstory-row")}})).on("dragend",function(t){var t=$(t),e=t.scope().us,r=t.index();return n.$apply(function(){return i(n,{us:e,newIndex:r})})}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&r.dragging}}),n.$on("$destroy",function(){return t.off(),r.destroy()})}}};e.$inject=["$parse","tgProjectService"],t.directive("tgRelatedUserstoriesSortable",e)}.call(this),function(){var t=angular.module("taigaEpics"),e=function(){return{templateUrl:"epics/related-userstories/related-userstories.html",controller:"RelatedUserStoriesCtrl",controllerAs:"vm",bindToController:!0,scope:{userstories:"=",project:"=",epic:"="}}};e.$inject=[],t.directive("tgRelatedUserstories",e)}.call(this),function(){var t;function e(t,e,r,n){this.avatarService=t,this.translate=e,this.confirm=r,this.rs=n}t=angular.module("taigaEpics"),e.$inject=["tgAvatarService","$translate","$tgConfirm","tgResources"],e.prototype.setAvatarData=function(){var t=this.userstory.get("assigned_to_extra_info");return this.avatar=this.avatarService.getAvatar(t)},e.prototype.getAssignedToFullNameDisplay=function(){return this.userstory.get("assigned_to")?this.userstory.getIn(["assigned_to_extra_info","full_name_display"]):this.translate.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED")},e.prototype.onDeleteRelatedUserstory=function(){var o,t=this.translate.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.TITLE"),s=this.translate.instant("LIGHTBOX.REMOVE_RELATIONSHIP_WITH_EPIC.MESSAGE",{epicSubject:this.epic.get("subject")});return this.confirm.ask(t,null,s).then((o=this,function(t){var e=function(){return s=o.translate.instant("EPIC.ERROR_UNLINK_RELATED_USERSTORY",{errorMessage:s}),o.confirm.notify("error",null,s),t.finish(!1)},r=function(){return o.loadRelatedUserstories(),t.finish()},n=o.epic.get("id"),i=o.userstory.get("id");return o.rs.epics.deleteRelatedUserstory(n,i).then(r,e)}))},t.controller("RelatedUserstoryRowCtrl",e)}.call(this),function(){var t=angular.module("taigaEpics"),e=function(){return{link:function(t,e,r,n){return n.setAvatarData()},templateUrl:"epics/related-userstories/related-userstory-row/related-userstory-row.html",controller:"RelatedUserstoryRowCtrl",controllerAs:"vm",bindToController:!0,scope:{userstory:"=",epic:"=",project:"=",loadRelatedUserstories:"&"}}};e.$inject=[],t.directive("tgRelatedUserstoryRow",e)}.call(this),function(){function l(t,e){return function(){return t.apply(e,arguments)}}var t,p,i={}.hasOwnProperty;function e(t,e,r,n,i,o,s,a){var c,u;this.routeParams=t,this.externalAppsService=e,this.window=r,this.currentUserService=n,this.location=i,this.navUrls=o,this.xhrError=s,this.loader=a,this.createApplicationToken=l(this.createApplicationToken,this),this._getApplicationToken=l(this._getApplicationToken,this),this._redirect=l(this._redirect,this),this.loader.start(!1),this._applicationId=this.routeParams.application,this._state=this.routeParams.state,this._getApplicationToken(),this._user=this.currentUserService.getUser(),this._application=null,s=encodeURIComponent(this.location.url()),a=this.navUrls.resolve("login"),this.loginWithAnotherUserUrl=a+"?next="+s+"&force_login=1",p.defineImmutableProperty(this,"user",(c=this,function(){return c._user})),p.defineImmutableProperty(this,"application",(u=this,function(){return u._application}))}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,(p=this.taiga).Controller),e.$inject=["$routeParams","tgExternalAppsService","$window","tgCurrentUserService","$location","$tgNavUrls","tgXhrErrorService","tgLoader"],e.prototype._redirect=function(t){t=t.get("next_url");return this.window.open(t,"_self")},e.prototype._getApplicationToken=function(){return this.externalAppsService.getApplicationToken(this._applicationId,this._state).then((r=this,function(t){return r._application=t.get("application"),t.get("auth_code")?r._redirect(t):r.loader.pageLoaded()})).catch((e=this,function(t){return e.loader.pageLoaded(),e.xhrError.response(t)}));var e,r},e.prototype.cancel=function(){return this.window.history.back()},e.prototype.createApplicationToken=function(){return this.externalAppsService.authorizeApplicationToken(this._applicationId,this._state).then((r=this,function(t){return r._redirect(t)})).catch((e=this,function(t){return e.xhrError.response(t)}));var e,r},t=e,angular.module("taigaExternalApps").controller("ExternalApp",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t){this.rs=t}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgResources"],e.prototype.getApplicationToken=function(t,e){return this.rs.externalapps.getApplicationToken(t,e)},e.prototype.authorizeApplicationToken=function(t,e){return this.rs.externalapps.authorizeApplicationToken(t,e)},t=e,angular.module("taigaExternalApps").service("tgExternalAppsService",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t){this.lightboxFactory=t}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgLightboxFactory"],e.prototype.sendFeedback=function(){return this.lightboxFactory.create("tg-lb-feedback",{class:"lightbox lightbox-feedback lightbox-generic-form"})},t=e,angular.module("taigaFeedback").service("tgFeedbackService",t)}.call(this),function(){var t;function e(t,e){this.rs=t,this.xhrError=e,this._contentType=null,this._objectId=null,this.clear()}this.taiga,e.$inject=["tgResources","tgXhrErrorService"],e.prototype.clear=function(){return this.page=1,this.loadingEntries=!1,this.disablePagination=!1,this.entries=Immutable.List(),this.count=null},e.prototype.fetchEntries=function(e){var r,n;if(null==e&&(e=!1),e&&(this.page=1),this.loadingEntries=!0,this.disablePagination=!0,this._contentType&&this._objectId)return this.rs.history.getHistory("activity",this._contentType,this._objectId,this.page).then((n=this,function(t){return e?(n.clear(),n.entries=t.list):n.entries=n.entries.concat(t.list),n.loadingEntries=!1,n.disablePagination=!t.headers("x-pagination-next"),n.count=t.headers("x-pagination-count"),n.entries})).catch((r=this,function(t){return r.xhrError.response(r.entries)}))},e.prototype.nextPage=function(t){return null==t&&(t="comment"),this.page++,this.fetchEntries()},e.prototype.init=function(t,e){return this._contentType=t,this._objectId=e,this.clear()},t=e,angular.module("taigaHistory").service("tgActivityService",t)}.call(this),function(){var t;function e(t,e,r){this.currentUserService=t,this.permissionService=e,this.lightboxFactory=r,this.hiddenDeletedComment=!0}t=angular.module("taigaHistory"),e.$inject=["tgCurrentUserService","tgCheckPermissionsService","tgLightboxFactory"],e.prototype.showDeletedComment=function(){return this.hiddenDeletedComment=!1},e.prototype.hideDeletedComment=function(){return this.hiddenDeletedComment=!0},e.prototype.checkCancelComment=function(t){if(27===t.keyCode)return this.onEditMode({commentId:this.comment.id})},e.prototype.canEditDeleteComment=function(){if(this.currentUserService.getUser())return this.user=this.currentUserService.getUser(),this.user.get("id")===this.comment.user.pk||this.permissionService.check("modify_project")},e.prototype.saveComment=function(t,e){return this.onEditComment({commentId:this.comment.id,commentData:t,callback:e})},e.prototype.displayCommentHistory=function(){return this.lightboxFactory.create("tg-lb-display-historic",{class:"lightbox lightbox-display-historic",comment:"comment",name:"name",object:"object"},{comment:this.comment,name:this.name,object:this.object})},t.controller("CommentCtrl",e)}.call(this),function(){var t=function(){return{scope:{name:"@",projectId:"@",object:"@",comment:"<",type:"<",loading:"<",editing:"<",deleting:"<",objectId:"<",editMode:"<",project:"<",onEditMode:"&",onDeleteComment:"&",onRestoreDeletedComment:"&",onEditComment:"&"},templateUrl:"history/comments/comment.html",bindToController:!0,controller:"CommentCtrl",controllerAs:"vm"}};angular.module("taigaHistory").directive("tgComment",t)}.call(this),function(){var t;function e(){}t=angular.module("taigaHistory"),e.$inject=[],e.prototype.initializePermissions=function(){return this.canAddCommentPermission="comment_"+this.name},t.controller("CommentsCtrl",e)}.call(this),function(){var t=function(){return{scope:{type:"<",name:"@",object:"@",comments:"<",onEditMode:"&",onDeleteComment:"&",onRestoreDeletedComment:"&",onAddComment:"&",onEditComment:"&",editMode:"<",loading:"<",deleting:"<",editing:"<",project:"=",reverse:"="},templateUrl:"history/comments/comments.html",bindToController:!0,controller:"CommentsCtrl",controllerAs:"vm",link:function(t,e,r,n){return n.initializePermissions()}}};angular.module("taigaHistory").directive("tgComments",t)}.call(this),function(){var t;function e(t){this.rs=t}t=angular.module("taigaHistory"),e.$inject=["$tgResources"],e.prototype._loadHistoric=function(){var e,t=this.name,r=this.object,n=this.comment.id;return this.rs.history.getCommentHistory(t,r,n).then((e=this,function(t){return e.commentHistoryEntries=t}))},t.controller("LightboxDisplayHistoricCtrl",e)}.call(this),function(){var t=function(i){return{scope:{},bindToController:{name:"=",object:"=",comment:"="},templateUrl:"history/history-lightbox/comment-history-lightbox.html",controller:"LightboxDisplayHistoricCtrl",controllerAs:"vm",link:function(t,e,r,n){return n._loadHistoric(),i.open(e)}}};t.$inject=["lightboxService"],angular.module("taigaHistory").directive("tgLbDisplayHistoric",t)}.call(this),function(){var t=function(){return{scope:{entry:"<"},templateUrl:"history/history-lightbox/history-entry.html"}};angular.module("taigaHistory").directive("tgHistoryEntry",t)}.call(this),function(){var t=function(){return{templateUrl:"history/history-tabs/history-tabs.html",scope:{showCommentTab:"&",showActivityTab:"&",onActiveComments:"&",onActiveActivities:"&",onOrderComments:"&",activeTab:"<",commentsNum:"<",activitiesNum:"<",onReverse:"<"}}};angular.module("taigaHistory").directive("tgHistoryTabs",t)}.call(this),function(){var t;function e(t,e,r,n,i,o){var s,a;this.rs=t,this.repo=e,this.storage=r,this.projectService=n,this.activityService=i,this.wysiwygService=o,this.editing=null,this.deleting=null,this.editMode={},this.viewComments=!0,this.reverse=this.storage.get("orderComments"),taiga.defineImmutableProperty(this,"disabledActivityPagination",(s=this,function(){return s.activityService.disablePagination})),taiga.defineImmutableProperty(this,"loadingActivity",(a=this,function(){return a.activityService.loading}))}t=angular.module("taigaHistory"),e.$inject=["$tgResources","$tgRepo","$tgStorage","tgProjectService","tgActivityService","tgWysiwygService"],e.prototype._loadHistory=function(){return this._loadComments(),this._loadActivity()},e.prototype._loadActivity=function(){return this.activityService.init(this.name,this.id),this.activityService.fetchEntries().then((e=this,function(t){return e.activitiesNum=e.activityService.count,e.activities=t.toJS()}));var e},e.prototype._loadComments=function(){return this.rs.history.get(this.name,this.id,"comment").then((e=this,function(t){return e.comments=_.filter(t,function(t){return""!==t.comment}),e.reverse&&(e.comments,_.reverse(e.comments)),e.commentsNum=e.comments.length}));var e},e.prototype.nextActivityPage=function(){return this.activityService.nextPage().then((e=this,function(t){return e.activities=t.toJS()}));var e},e.prototype.showHistorySection=function(){return this.showCommentTab()||this.showActivityTab()},e.prototype.showCommentTab=function(){return 0<this.commentsNum||this.projectService.hasPermission("comment_"+this.name)},e.prototype.showActivityTab=function(){return 0<this.activitiesNum},e.prototype.toggleEditMode=function(t){return this.editMode[t]=!this.editMode[t]},e.prototype.onActiveHistoryTab=function(t){return this.viewComments=t},e.prototype.deleteComment=function(t){var e,r=this.name,n=this.id,i=t;return this.deleting=t,this.rs.history.deleteComment(r,n,i).then((e=this,function(){return e._loadComments(),e.deleting=null}))},e.prototype.editComment=function(t,e){var r,n=this.name,i=this.id,o=t;return this.editing=t,this.rs.history.editComment(n,i,o,e).then((r=this,function(){return r._loadComments(),r.toggleEditMode(t),r.editing=null}))},e.prototype.restoreDeletedComment=function(t){var e,r=this.name,n=this.id,i=t;return this.editing=t,this.rs.history.undeleteComment(r,n,i).then((e=this,function(){return e._loadComments(),e.editing=null}))},e.prototype.addComment=function(){return this.editMode={},this.editing=null,this._loadComments()},e.prototype.onOrderComments=function(){return this.reverse=!this.reverse,this.storage.set("orderComments",this.reverse),this._loadComments()},t.controller("HistorySection",e)}.call(this),function(){var t=angular.module("taigaHistory"),e=(this.taiga.bindOnce,function(){return{link:function(t,e,r,n){return t.$on("object:updated",function(){return n._loadActivity()}),t.$watch("vm.id",function(t){return n._loadHistory()})},templateUrl:"history/history.html",controller:"HistorySection",controllerAs:"vm",bindToController:!0,scope:{type:"=",name:"@",id:"=",project:"="}}});e.$inject=[],t.directive("tgHistorySection",e)}.call(this),function(){var t;function e(){}t=angular.module("taigaHistory"),e.$inject=[],e.prototype.diffTags=function(){var e;return"tags"===this.type?(this.diffRemoveTags=_.difference(this.diff[0],this.diff[1]).toString(),this.diffAddTags=_.difference(this.diff[1],this.diff[0]).toString()):"promoted_to"===this.type?(e=_.difference(this.diff[1],this.diff[0]),this.promotedTo=_.filter(this.model.generated_user_stories,function(t){return _.includes(e,t.id)})):void 0},t.controller("ActivitiesDiffCtrl",e)}.call(this),function(){var t=function(){return{scope:{model:"<",type:"<",diff:"<"},templateUrl:"history/history/history-diff.html",controller:"ActivitiesDiffCtrl",controllerAs:"vm",bindToController:!0,link:function(t,e,r,n){return n.diffTags()}}};angular.module("taigaHistory").directive("tgHistoryDiff",t)}.call(this),function(){var t=function(){return{scope:{activities:"<",model:"<"},templateUrl:"history/history/history.html",link:function(t,e,r){}}};angular.module("taigaHistory").directive("tgHistory",t)}.call(this),function(){var t=function(t,i){return{templateUrl:"home/duties/duty.html",scope:{duty:"=tgDuty",isHidden:"=",type:"@"},link:function(e,r,t,n){return e.vm={},e.vm.duty=e.duty,e.vm.type=e.type,e.vm.isHidden=e.isHidden,e.vm.getDutyType=function(){if(e.vm.duty)return"epics"===e.vm.duty.get("_name")?i.instant("COMMON.EPIC"):"userstories"===e.vm.duty.get("_name")?i.instant("COMMON.USER_STORY"):"tasks"===e.vm.duty.get("_name")?i.instant("COMMON.TASK"):"issues"===e.vm.duty.get("_name")?i.instant("COMMON.ISSUE"):void 0},r.on("click",".button-hide",function(t){return t.preventDefault(),r.remove(),e.$emit("duty:toggle-hidden",e.vm.duty,e.vm.type)})}}};t.$inject=["$tgNavUrls","$translate"],angular.module("taigaHome").directive("tgDuty",t)}.call(this),function(){var t;function e(t,e,r){this.currentUserService=t,this.location=e,this.navUrls=r,this.currentUserService.getUser()||this.location.path(this.navUrls.resolve("discover"))}e.$inject=["tgCurrentUserService","$location","$tgNavUrls"],t=e,angular.module("taigaHome").controller("Home",t)}.call(this),function(){var t,m,i={}.hasOwnProperty;function e(t,e,r,n){this.navurls=t,this.rs=e,this.projectsService=r,this.q=n}m=this.taiga.groupBy,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,taiga.Service),e.$inject=["$tgNavUrls","tgResources","tgProjectsService","$q"],e.prototype._attachProjectInfoToWorkInProgress=function(t,i){var r,e,n,o,s,a;return a=this,r=function(t,e){var r=i.get(String(t.get("project"))),n={project:r.get("slug"),ref:t.get("ref")},n=a.navurls.resolve("project-"+e+"-detail",n);return t=(t=(t=t.set("url",n)).set("project",r)).set("_name",e)},n=function(t,e){return t=(t=t.filter(function(t){return i.get(String(t.get("project")))})).map(function(t){return r(t,e)})},(o=t.get("assignedTo")).get("epics")&&(e=n(o.get("epics"),"epics"),o=o.set("epics",e)),o.get("userStories")&&(e=n(o.get("userStories"),"userstories"),o=o.set("userStories",e)),o.get("tasks")&&(e=n(o.get("tasks"),"tasks"),o=o.set("tasks",e)),o.get("issues")&&(e=n(o.get("issues"),"issues"),o=o.set("issues",e)),(s=t.get("watching")).get("epics")&&(e=n(s.get("epics"),"epics"),s=s.set("epics",e)),s.get("userStories")&&(e=n(s.get("userStories"),"userstories"),s=s.set("userStories",e)),s.get("tasks")&&(e=n(s.get("tasks"),"tasks"),s=s.set("tasks",e)),s.get("issues")&&(e=n(s.get("issues"),"issues"),s=s.set("issues",e)),(t=t.set("assignedTo",o)).set("watching",s)},e.prototype.getWorkInProgress=function(t){var e,r,n,i=Immutable.Map(),o=this.projectsService.getListProjectsByUserId(t).then(function(t){return i=Immutable.fromJS(m(t.toJS(),function(t){return t.id}))}),s=Immutable.Map(),a={status__is_closed:!1,assigned_to:t},c={is_closed:!1,assigned_users:t,dashboard:!0},u={status__is_closed:!1,assigned_to:t},l={status__is_closed:!1,assigned_to:t},p=this.rs.epics.listInAllProjects(a).then(function(t){return s=s.set("epics",t)}),d=this.rs.userstories.listInAllProjects(c).then(function(t){return s=s.set("userStories",t)}),h=this.rs.tasks.listInAllProjects(u).then(function(t){return s=s.set("tasks",t)}),f=this.rs.issues.listInAllProjects(l).then(function(t){return s=s.set("issues",t)});return l={status__is_closed:!(u={status__is_closed:!(c={is_closed:!(a={status__is_closed:!1,watchers:t}),watchers:t,dashboard:!0}),watchers:t}),watchers:t},e=Immutable.Map(),a=this.rs.epics.listInAllProjects(a).then(function(t){return e=e.set("epics",t)}),c=this.rs.userstories.listInAllProjects(c).then(function(t){return e=e.set("userStories",t)}),u=this.rs.tasks.listInAllProjects(u).then(function(t){return e=e.set("tasks",t)}),l=this.rs.issues.listInAllProjects(l).then(function(t){return e=e.set("issues",t)}),r=Immutable.Map(),this.q.all([o,p,a,d,c,h,u,f,l]).then((n=this,function(){return r=(r=r.set("assignedTo",s)).set("watching",e),r=n._attachProjectInfoToWorkInProgress(r,i)}))},t=e,angular.module("taigaHome").service("tgHomeService",t)}.call(this),function(){var t=function(i){return{templateUrl:"home/projects/home-project-list.html",scope:{},link:function(t,e,r,n){return t.vm={},taiga.defineImmutableProperty(t.vm,"projects",function(){return i.projects.get("recents")})}}};t.$inject=["tgCurrentUserService"],angular.module("taigaHome").directive("tgHomeProjectList",t)}.call(this),function(){var t;function e(t){this.homeService=t,this.assignedTo=Immutable.Map(),this.hiddenAssignedTo=[],this.showHiddenAssignedTo=!1,this.watching=Immutable.Map(),this.showHiddenWatching=!1}e.$inject=["tgHomeService"],e.prototype._setAssignedTo=function(t){var e=t.get("assignedTo").get("epics"),r=t.get("assignedTo").get("userStories"),n=t.get("assignedTo").get("tasks"),t=t.get("assignedTo").get("issues");if(this.assignedTo=r.concat(n).concat(t).concat(e),0<this.assignedTo.size)return this.assignedTo=this.assignedTo.sortBy(function(t){return t.get("modified_date")}).reverse()},e.prototype._setWatching=function(t){var e=t.get("watching").get("epics"),r=t.get("watching").get("userStories"),n=t.get("watching").get("tasks"),t=t.get("watching").get("issues");if(this.watching=r.concat(n).concat(t).concat(e),0<this.watching.size)return this.watching=this.watching.sortBy(function(t){return t.get("modified_date")}).reverse()},e.prototype.getWorkInProgress=function(t){return this.homeService.getWorkInProgress(t).then((e=this,function(t){return e._setAssignedTo(t),e._setWatching(t)}));var e},t=e,angular.module("taigaHome").controller("WorkingOn",t)}.call(this),function(){var g=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1},v=(this.taiga,this.taiga.generateHash),t=function(t,f,m){return{controller:"WorkingOn",controllerAs:"vm",templateUrl:"home/working-on/working-on.html",scope:{},link:function(n,t,e,r){var i,o,s,a,c=function(t){var e=v(["ShowHiddenDashboardDuties",t]);return m.set(e,n.showHiddenDuties[t])},u=function(t){t=v(["ShowHiddenDashboardDuties",t]);return m.get(t)||!1},l=function(t){var e=v(["HiddenDashboardDuties",t]);return m.set(e,n.hiddenDuties[t])},p=function(t){t=v(["HiddenDashboardDuties",t]);return m.get(t)||[]},d=function(t,e){var r=t.get("id");return 0<=g.call(n.hiddenDuties[e],r)?n.hiddenDuties[e].splice(n.hiddenDuties[e].indexOf(t.get("id")),1):n.hiddenDuties[e].push(t.get("id")),l(e),n.$apply()},h=f.getUser();if(h){for(h=h.get("id"),r.getWorkInProgress(h),a=["working-on","watching"],n.hiddenDuties={},n.showHiddenDuties={},n.toggleShowHiddenDuties=function(t){return 0<=g.call(a,t)?(n.showHiddenDuties[t]=!n.showHiddenDuties[t],c(t)):console.error("Invalid duties slot `"+t+"`")},i=0,o=a.length;i<o;i++)s=a[i],n.hiddenDuties[s]=p(s),n.showHiddenDuties[s]=u(s);return n.$on("duty:toggle-hidden",function(t,e,r){return 0<=g.call(a,r)?d(e,r):console.error("Invalid duties slot `"+r+"`")})}}}};t.$inject=["tgHomeService","tgCurrentUserService","$tgStorage"],angular.module("taigaHome").directive("tgWorkingOn",t)}.call(this),function(){var t;function e(t,e,r,n,i){this.projectService=t,this.rs=e,this.lightboxService=r,this.confirm=n,this.rootScope=i,this.project=this.projectService.project,this.roles=this.projectService.project.get("roles"),this.rolesValues={},this.loading=!1,this.defaultMaxInvites=4}this.taiga,e.$inject=["tgProjectService","$tgResources","lightboxService","$tgConfirm","$rootScope"],e.prototype._areRolesValidated=function(){return Object.defineProperty(this,"areRolesValidated",{get:(t=this,function(){return _.filter(_.values(t.rolesValues),function(t){return t}).length===t.contactsToInvite.size+t.emailsToInvite.size})});var t},e.prototype._checkLimitMemberships=function(){var t;return null===this.project.get("max_memberships")?this.membersLimit=this.defaultMaxInvites:(t=Math.max(this.project.get("max_memberships")-this.project.get("total_memberships"),0),this.membersLimit=Math.min(t,this.defaultMaxInvites)),this.showWarningMessage=this.membersLimit<this.defaultMaxInvites},e.prototype.sendInvites=function(){var r,e,n;return this.setInvitedContacts=[],_.forEach(this.rolesValues,(r=this,function(t,e){return r.setInvitedContacts.push({role_id:t,username:e})})),this.loading=!0,this.rs.memberships.bulkCreateMemberships(this.project.get("id"),this.setInvitedContacts,this.inviteContactsMessage).then((n=this,function(t){return n.projectService.fetchProject().then(function(){return n.loading=!1,n.lightboxService.closeAll(),n.rootScope.$broadcast("membersform:new:success"),n.confirm.notify("success")})})).catch((e=this,function(t){return e.loading=!1,t.data._error_message?e.confirm.notify("error",t.data._error_message):t.data.__all__?e.confirm.notify("error",t.data.__all__[0]):void 0}))},t=e,angular.module("taigaAdmin").controller("InviteMembersFormCtrl",t)}.call(this),function(){var t=function(){return{scope:{},templateUrl:"invite-members/invite-members-form/invite-members-form.html",controller:"InviteMembersFormCtrl",controllerAs:"vm",bindToController:{contactsToInvite:"<",emailsToInvite:"=",onDisplayContactList:"&",onRemoveInvitedContact:"&",onRemoveInvitedEmail:"&",onSendInvites:"&"},link:function(t,e,r,n){return n._areRolesValidated(),n._checkLimitMemberships()}}};angular.module("taigaAdmin").directive("tgInviteMembersForm",t)}.call(this),function(){var t;function e(t,e,r){this.userService=t,this.currentUserService=e,this.projectService=r,this.contactsToInvite=Immutable.List(),this.emailsToInvite=Immutable.List(),this.contacts=Immutable.List(),this.displayContactList=!1}this.taiga,e.$inject=["tgUserService","tgCurrentUserService","tgProjectService"],e.prototype._getContacts=function(){var e,t=this.currentUserService.getUser().get("id"),r=this.projectService.project.get("id");return this.userService.getContacts(t,r).then((e=this,function(t){return e.contacts=t}))},e.prototype._filterContacts=function(e){return this.contacts=this.contacts.filter(function(t){return t.get("id")!==e.get("id")})},e.prototype.inviteSuggested=function(t){return this.contactsToInvite=this.contactsToInvite.push(t),this._filterContacts(t),this.displayContactList=!0},e.prototype.removeContact=function(e){return this.contactsToInvite=this.contactsToInvite.filter(function(t){return t.get("id")!==e.id}),e=Immutable.fromJS(e),this.contacts=this.contacts.push(e),this.testEmptyContacts()},e.prototype.inviteEmail=function(t){t=Immutable.Map({email:t});return this.emailsToInvite=this.emailsToInvite.push(t),this.displayContactList=!0},e.prototype.removeEmail=function(e){return this.emailsToInvite=this.emailsToInvite.filter(function(t){return t.get("email")!==e.email}),this.testEmptyContacts()},e.prototype.testEmptyContacts=function(){if(this.emailsToInvite.size+this.contactsToInvite.size===0)return this.displayContactList=!1},t=e,angular.module("taigaAdmin").controller("AddMembersCtrl",t)}.call(this),function(){var t=function(i){return{scope:{},templateUrl:"invite-members/lightbox-add-members.html",controller:"AddMembersCtrl",controllerAs:"vm",link:function(t,e,r,n){return i.open(e),n._getContacts()}}};angular.module("taigaAdmin").directive("tgLbAddMembers",["lightboxService",t])}.call(this),function(){var t,e;function r(){this.contactQuery=""}e=this.taiga,r.$inject=[],r.prototype.isEmail=function(){return e.isEmail(this.contactQuery)},r.prototype.filterContacts=function(){return this.filteredContacts=this.contacts.filter((e=this,function(t){return t.get("full_name_display").toLowerCase().includes(e.contactQuery.toLowerCase())||t.get("username").toLowerCase().includes(e.contactQuery.toLowerCase())})).slice(0,12);var e},r.prototype.setInvited=function(t){return this.onInviteSuggested({contact:t})},t=r,angular.module("taigaAdmin").controller("SuggestAddMembersCtrl",t)}.call(this),function(){var t=function(t){return{scope:{},templateUrl:"invite-members/suggest-add-members/suggest-add-members.html",controller:"SuggestAddMembersCtrl",controllerAs:"vm",bindToController:{contacts:"=",onInviteSuggested:"&",onInviteEmail:"&"},link:function(t,e,r,n){return t.$watch("vm.contacts",function(t){if(t)return n.filterContacts()})}}};angular.module("taigaAdmin").directive("tgSuggestAddMembers",["lightboxService",t])}.call(this),function(){var s=this.taiga.timeout,t=function(i,o,t){return{templateUrl:"navigation-bar/dropdown-notifications/dropdown-notifications.html",scope:{active:"="},link:function(r,t,e,n){return r.notificationsList=[],r.loading=!1,r.$on("notifications:loaded",function(t,e){return r.loading=!1,void 0!==r.total&&e>r.total?(r.newEvent=!0,s(100,function(){return r.total=e,r.$apply()}),s(2e3,function(){return r.newEvent=!1})):r.total=e}),r.$on("notifications:loading",function(){return r.loading=!0}),r.setAllAsRead=function(){return o.setNotificationsAsRead().then(function(){return i.$emit("notifications:dismiss-all")})}}}};angular.module("taigaNavigationBar").directive("tgDropdownNotifications",["$rootScope","tgNotificationsService","tgCurrentUserService",t])}.call(this),function(){var t=function(i,o,s,a){return{templateUrl:"navigation-bar/dropdown-project-list/dropdown-project-list.html",scope:{active:"="},link:function(t,e,r,n){return t.vm={},taiga.defineImmutableProperty(t.vm,"projects",function(){return o.projects.get("recents")}),taiga.defineImmutableProperty(t.vm,"currentProject",function(){return a.project?a.project.get("id"):null}),t.vm.newProject=function(){return s.newProject()},t=function(){return e.find(".dropdown-project-list ul li a").data("fullUrl","")},i.$on("dropdown-project-list:updated",t)}}};t.$inject=["$rootScope","tgCurrentUserService","tgProjectsService","tgProjectService"],angular.module("taigaNavigationBar").directive("tgDropdownProjectList",t)}.call(this),function(){var t=function(i,o,s,a,c){return{templateUrl:"navigation-bar/dropdown-user/dropdown-user.html",scope:{},link:function(t,e,r,n){return t.vm={},t.vm.isFeedbackEnabled=o.get("feedbackEnabled"),t.vm.customSupportUrl=o.get("supportUrl"),taiga.defineImmutableProperty(t.vm,"user",function(){return i.userData}),t.vm.logout=function(){return i.logout(),s.url(a.resolve("discover")),s.search({})},t.vm.userSettingsPlugins=_.filter(c.userSettingsPlugins,{userMenu:!0})}}};t.$inject=["$tgAuth","$tgConfig","$tgLocation","$tgNavUrls","$rootScope"],angular.module("taigaNavigationBar").directive("tgDropdownUser",t)}.call(this),function(){var t=function(a,c,u,l,p,d){return{templateUrl:"navigation-bar/navigation-bar.html",scope:{},link:function(r,t,e,n){var i,o,s;return r.vm={},taiga.defineImmutableProperty(r.vm,"projects",function(){return a.projects.get("recents")}),taiga.defineImmutableProperty(r.vm,"isAuthenticated",function(){return a.isAuthenticated()}),taiga.defineImmutableProperty(r.vm,"isEnabledHeader",function(){return c.isEnabledHeader()}),r.vm.publicRegisterEnabled=p.get("publicRegisterEnabled"),r.vm.customSupportUrl=p.get("supportUrl"),r.vm.isFeedbackEnabled=p.get("feedbackEnabled"),o=function(){var e=document.querySelector("#userpilot-resource-centre-frame");if(e)return r.$applyAsync(function(){var t=e.contentWindow.document.body.querySelector("#widget-title");if(t)return r.vm.userPilotTitle=t.innerText,clearInterval(s)})},i=10,window.TAIGA_USER_PILOT_TOKEN&&(r.vm.userPilotTitle="Help center",r.vm.userpilotEnabled=!0,s=setInterval(function(){if(o(),!--i)return clearInterval(s)},1e3)),r.vm.login=function(){var t=encodeURIComponent(u.url());return u.url(l.resolve("login")),u.search({next:t})},r.vm.sendFeedback=function(){return d.sendFeedback()},window._taigaSendFeedback=r.vm.sendFeedback,r.$on("$routeChangeSuccess",function(){var t;switch(r.vm.active=null,t=u.path()){case"/":return r.vm.active="dashboard";case"/discover":return r.vm.active="discover";case"/notifications":return r.vm.active="notifications";case"/projects/":return r.vm.active="projects";default:if(t.startsWith("/project"))return r.vm.active="project"}})}}};t.$inject=["tgCurrentUserService","tgNavigationBarService","$tgLocation","$tgNavUrls","$tgConfig","tgFeedbackService"],angular.module("taigaNavigationBar").directive("tgNavigationBar",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){this.disableHeader()}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.prototype.enableHeader=function(){return this.enabledHeader=!0},e.prototype.disableHeader=function(){return this.enabledHeader=!1},e.prototype.isEnabledHeader=function(){return this.enabledHeader},t=e,angular.module("taigaNavigationBar").service("tgNavigationBarService",t)}.call(this),function(){var t=function(){return{templateUrl:"notifications/notifications-list/notifications-list.html",controller:"Notifications",controllerAs:"vm",bindToController:!0,scope:{infiniteScrollContainer:"@",infiniteScrollDistance:"=",infiniteScrollDisabled:"=",onlyUnread:"=onlyUnread"}}};angular.module("taigaNotifications").directive("tgNotificationsList",t)}.call(this),function(){var t,e,i={}.hasOwnProperty;function r(t,e,r,n,i,o,s){var a,c,u;this.rootScope=t,this.scope=e,this.notificationsService=r,this.currentUserService=n,this.events=i,this.location=o,this.window=s,this.total=0,this.user=this.currentUserService.getUser(),this.scrollDisabled=!1,this.initList(),this.loadNotifications(),this.rootScope.$on("notifications:dismiss",(a=this,function(t){if(a.onlyUnread)return a.reloadList()})),this.rootScope.$on("notifications:new",(c=this,function(t){return c.reloadList()})),this.rootScope.$on("notifications:dismiss-all",(u=this,function(t){return u.reloadList()}))}e=this.taiga,t=this.taiga.mixOf,this.taiga.debounceLeading,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,t(e.Controller,e.PageMixin,e.FiltersMixin)),r.$inject=["$rootScope","$scope","tgNotificationsService","tgCurrentUserService","$tgEvents","$location","$window"],r.prototype.initList=function(){return this.notificationsList=Immutable.List(),this.user&&(this.list=this.notificationsService.getNotificationsList(this.user.get("id"),null!=this.onlyUnread)),this.loading=null==this.list},r.prototype.reloadList=function(){return this.initList(),this.loadNotifications()},r.prototype.loadNotifications=function(){return this.scrollDisabled=!0,this.loading=!0,this.scope.$emit("notifications:loading"),this.list.next().then((e=this,function(t){return e.notificationsList=e.notificationsList.concat(t.get("items")),!e.infiniteScrollDisabled&&t.get("next")&&(e.scrollDisabled=!1),e.total=t.get("total"),e.scope.$emit("notifications:loaded",e.total),e.loading=!1,e.notificationsList}));var e},r.prototype.setAsRead=function(t,e){return this.notificationsService.setNotificationAsRead(t.get("id")).then((r=this,function(){return r.location.$$url===e?r.window.location.reload():r.location.path(e),r.rootScope.$broadcast("notifications:dismiss")}));var r},r.prototype.setAllAsRead=function(){return this.notificationsService.setNotificationsAsRead().then((t=this,function(){return t.rootScope.$broadcast("notifications:dismiss-all")}));var t},e=r,angular.module("taigaNotifications").controller("Notifications",e)}.call(this),function(){var t,r,n,i={}.hasOwnProperty;function e(t,e,r,n,i){this.rs=t,this.userTimelinePaginationSequenceService=e,this.translate=r,this.navUrls=n,this.tgSections=i}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.$inject=["tgResources","tgUserTimelinePaginationSequenceService","$translate","$tgNavUrls","$tgSections"],r=[{check:function(t){return 1===t.get("event_type")},key:"EVENTS.ASSIGNED_YOU",translate_params:["username","obj_name"]},{check:function(t){return 2===t.get("event_type")},key:"EVENTS.MENTIONED_YOU",translate_params:["username","obj_name"]},{check:function(t){return 3===t.get("event_type")},key:"EVENTS.ADDED_YOU_AS_WATCHER",translate_params:["username","obj_name"]},{check:function(t){return 4===t.get("event_type")},key:"EVENTS.ADDED_YOU_AS_MEMBER",translate_params:["username"]},{check:function(t){return 5===t.get("event_type")},key:"EVENTS.COMMENTED",translate_params:["username","obj_name"]},{check:function(t){return 6===t.get("event_type")},key:"EVENTS.MENTIONED_YOU_IN_COMMENT",translate_params:["username","obj_name"]}],n={username:function(t){var e,r,n=t.getIn(["data","user"]);return n.get("is_profile_visible")?(e=this.translate.instant("COMMON.SEE_USER_PROFILE",{username:n.get("username")}),r=this.navUrls.resolve("user-profile",{username:t.getIn(["data","user","username"])}),this._getLink(t,r,n.get("name"),"user-link",e)):this._getUsernameSpan(n.get("name"))},project_name:function(t){var e=this.navUrls.resolve("project",{project:t.getIn(["data","project","slug"])});return this._getLink(t,e,t.getIn(["data","project","name"]),"project-link")},obj_name:function(t){var e=this._getNotificationObject(t),r=this._getDetailObjUrl(t,e.get("content_type")),e="#"+e.get("ref")+" "+e.get("subject");return this._getLink(t,r,e,"object-link")}},e.prototype.getNotificationsList=function(e,r){var n,i,t={};return t.fetch=(n=this,function(t){return n.rs.users.getNotifications(e,t,r).then(function(t){return t})}),t.map=(i=this,function(t){return i._addNotificationAttributes(t)}),this.userTimelinePaginationSequenceService.generate(t)},e.prototype.setNotificationAsRead=function(t){return this.rs.users.setNotificationAsRead(t)},e.prototype.setNotificationsAsRead=function(){return this.rs.users.setNotificationsAsRead()},e.prototype._getNotificationObject=function(t){if(t.get("data").get("obj"))return t.get("data").get("obj")},e.prototype._getType=function(e){return _.find(r,function(t){return t.check(e)})},e.prototype._addNotificationAttributes=function(t){var e=t.get("event_type"),r=this._getType(t),e=this._getTitle(t,e,r),r=(t=t.set("title_html",e)).getIn(["data","project","slug"]),e=this.tgSections.getPath(r),r=this.navUrls.resolve("project-"+e,{project:r});return t=(t=t.set("projectUrl",r)).set("obj",this._getNotificationObject(t))},e.prototype._translateTitleParams=function(t,e,r){return n[t].call(this,e,r)},e.prototype._getDetailObjUrl=function(t,e){var r={issue:"project-issues-detail",task:"project-tasks-detail",userstory:"project-userstories-detail"};return this.navUrls.resolve(r[e],{project:t.getIn(["data","project","slug"]),ref:t.getIn(["data","obj","ref"])})},e.prototype._getLink=function(t,e,r,n,i){return i=i||r,r=$("<span>").attr("ng-non-bindable",!0).text(r),$('<a href="">').attr("title",i).attr("class",n).attr("ng-click",'vm.setAsRead(notification, "'+e+'")').append(r).prop("outerHTML")},e.prototype._getUsernameSpan=function(t){return $("<span>").addClass("username").text(t).prop("outerHTML")},e.prototype._getParams=function(e,r,t){var n,i={};return t.translate_params.forEach((n=this,function(t){return i[t]=n._translateTitleParams(t,e,r)})),i},e.prototype._getTitle=function(t,e,r){var n,i=this._getParams(t,e,r),o={};return Object.keys(i).forEach(function(t){return o[t]="{{"+t+"}}"}),n=this.translate.instant(r.key,o),Object.keys(i).forEach(function(t){var e="{{"+t+"}}";return n=n.replace(new RegExp(e,"g"),i[t])}),n},t=e,angular.module("taigaNotifications").service("tgNotificationsService",t)}.call(this),function(){var t;function e(t){this.userService=t,this.loadStats()}e.$inject=["tgUserService"],e.prototype.loadStats=function(){return this.userService.getStats(this.user.get("id")).then((e=this,function(t){return e.stats=t}));var e},t=e,angular.module("taigaProfile").controller("ProfileBar",t)}.call(this),function(){var t=function(){return{templateUrl:"profile/profile-bar/profile-bar.html",controller:"ProfileBar",controllerAs:"vm",scope:{user:"=user",isCurrentUser:"=iscurrentuser"},bindToController:!0}};angular.module("taigaProfile").directive("tgProfileBar",t)}.call(this),function(){var t;function e(t,e){this.userService=t,this.currentUserService=e,this.currentUser=this.currentUserService.getUser(),this.isCurrentUser=!1,this.currentUser&&this.currentUser.get("id")===this.user.get("id")&&(this.isCurrentUser=!0)}e.$inject=["tgUserService","tgCurrentUserService"],e.prototype.loadContacts=function(){return this.userService.getContacts(this.user.get("id")).then((e=this,function(t){return e.contacts=t}));var e},t=e,angular.module("taigaProfile").controller("ProfileContacts",t)}.call(this),function(){var t=function(){return{templateUrl:"profile/profile-contacts/profile-contacts.html",scope:{user:"="},controllerAs:"vm",controller:"ProfileContacts",link:function(t,e,r,n){return n.loadContacts()},bindToController:!0}};angular.module("taigaProfile").directive("tgProfileContacts",t)}.call(this),function(){var t=function(){return{scope:{item:"=tgFavItem"},link:function(t,e,r,n){return t.vm={item:t.item}},templateUrl:function(t,e){return"project"===e.itemType?"profile/profile-favs/items/project.html":"profile/profile-favs/items/ticket.html"}}};angular.module("taigaProfile").directive("tgFavItem",t)}.call(this),function(){function t(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t}var e,r,i={}.hasOwnProperty;function n(){this._init()}function o(t){this.userService=t,o.__super__.constructor.call(this),this.tabName="likes",this.enableFilterByAll=!1,this.enableFilterByProjects=!1,this.enableFilterByEpics=!1,this.enableFilterByUserStories=!1,this.enableFilterByTasks=!1,this.enableFilterByIssues=!1,this.enableFilterByTextQuery=!0,this._getItems=this.userService.getLiked}function s(t){this.userService=t,s.__super__.constructor.call(this),this.tabName="upvotes",this.enableFilterByAll=!0,this.enableFilterByProjects=!1,this.enableFilterByEpics=!0,this.enableFilterByUserStories=!0,this.enableFilterByTasks=!0,this.enableFilterByIssues=!0,this.enableFilterByTextQuery=!0,this._getItems=this.userService.getVoted}function a(t){this.userService=t,a.__super__.constructor.call(this),this.tabName="watchers",this._getItems=this.userService.getWatched}r=this.taiga.debounceLeading,n.prototype._init=function(){return this.enableFilterByAll=!0,this.enableFilterByProjects=!0,this.enableFilterByEpics=!0,this.enableFilterByUserStories=!0,this.enableFilterByTasks=!0,this.enableFilterByIssues=!0,this.enableFilterByTextQuery=!0,this._resetList(),this.q=null,this.type=null},n.prototype._resetList=function(){return this.items=Immutable.List(),this.scrollDisabled=!1,this._page=1},n.prototype._enableLoadingSpinner=function(){return this.isLoading=!0},n.prototype._disableLoadingSpinner=function(){return this.isLoading=!1},n.prototype._enableScroll=function(){return this.scrollDisabled=!1},n.prototype._disableScroll=function(){return this.scrollDisabled=!0},n.prototype._checkIfHasMorePages=function(t){return t?(this._page+=1,this._enableScroll()):this._disableScroll()},n.prototype._checkIfHasNoResults=function(){return this.hasNoResults=0===this.items.size},n.prototype.loadItems=function(){return this._enableLoadingSpinner(),this._disableScroll(),this._getItems(this.user.get("id"),this._page,this.type,this.q).then((e=this,function(t){return e.items=e.items.concat(t.get("data")),e._checkIfHasMorePages(t.get("next")),e._checkIfHasNoResults(),e._disableLoadingSpinner(),e.items})).catch((t=this,function(){return t._disableLoadingSpinner(),t.items}));var t,e},n.prototype.filterByTextQuery=r(500,function(){return this._resetList(),this.loadItems()}),n.prototype.showAll=function(){if(null!==this.type)return this.type=null,this._resetList(),this.loadItems()},n.prototype.showProjectsOnly=function(){if("project"!==this.type)return this.type="project",this._resetList(),this.loadItems()},n.prototype.showEpicsOnly=function(){if("epic"!==this.type)return this.type="epic",this._resetList(),this.loadItems()},n.prototype.showUserStoriesOnly=function(){if("userstory"!==this.type)return this.type="userstory",this._resetList(),this.loadItems()},n.prototype.showTasksOnly=function(){if("task"!==this.type)return this.type="task",this._resetList(),this.loadItems()},n.prototype.showIssuesOnly=function(){if("issue"!==this.type)return this.type="issue",this._resetList(),this.loadItems()},t(o,e=n),o.$inject=["tgUserService"],r=o,angular.module("taigaProfile").controller("ProfileLiked",r),t(s,e),s.$inject=["tgUserService"],r=s,angular.module("taigaProfile").controller("ProfileVoted",r),t(a,e),a.$inject=["tgUserService"],e=a,angular.module("taigaProfile").controller("ProfileWatched",e)}.call(this),function(){var t={scope:{},bindToController:{user:"=",type:"@",q:"@",scrollDisabled:"@",isLoading:"@",hasNoResults:"@"},controller:null,controllerAs:"vm",templateUrl:"profile/profile-favs/profile-favs.html"},e=function(){return _.extend({},t,{controller:"ProfileLiked"})};angular.module("taigaProfile").directive("tgProfileLiked",e),e=function(){return _.extend({},t,{controller:"ProfileVoted"})},angular.module("taigaProfile").directive("tgProfileVoted",e),e=function(){return _.extend({},t,{controller:"ProfileWatched"})},angular.module("taigaProfile").directive("tgProfileWatched",e)}.call(this),function(){var t;function e(t){this.translate=t,t=Math.floor(Math.random()*this.HINTS.length)+1,this.hint=this.HINTS[t-1],this.hint.linkText=this.hint.linkText||"HINTS.LINK",this.hint.title=this.translate.instant("HINTS.HINT"+t+"_TITLE"),this.hint.text=this.translate.instant("HINTS.HINT"+t+"_TEXT")}e.prototype.HINTS=[{url:"https://community.taiga.io/t/import-export-taiga-projects/168"},{url:"https://community.taiga.io/t/customisation-for-your-projects/127#tier-4-custom-fields-and-due-dates-5"},{},{}],(t=e).$inject=["$translate"],angular.module("taigaProfile").controller("ProfileHints",t)}.call(this),function(){var t=function(t){return{scope:{},controller:"ProfileHints",controllerAs:"vm",templateUrl:"profile/profile-hints/profile-hints.html"}};t.$inject=["$translate"],angular.module("taigaProfile").directive("tgProfileHints",t)}.call(this),function(){var t;function e(t,e){this.projectsService=t,this.userService=e}e.$inject=["tgProjectsService","tgUserService"],e.prototype.loadProjects=function(){return this.projectsService.getProjectsByUserId(this.user.get("id")).then((r=this,function(t){return r.userService.attachUserContactsToProjects(r.user.get("id"),t)})).then((e=this,function(t){return e.projects=t}));var e,r},t=e,angular.module("taigaProfile").controller("ProfileProjects",t)}.call(this),function(){var t=function(){return{templateUrl:"profile/profile-projects/profile-projects.html",scope:{user:"="},link:function(t,e,r,n){return n.loadProjects()},bindToController:!0,controllerAs:"vm",controller:"ProfileProjects"}};angular.module("taigaProfile").directive("tgProfileProjects",t)}.call(this),function(){var t=function(){return{templateUrl:"profile/profile-tab/profile-tab.html",scope:{},require:"^tgProfileTabs",link:function(e,t,r,n,i){if(e.tab={},r.$observe("tgProfileTab",function(t){return e.tab.name=t}),r.$observe("tabTitle",function(t){return e.tab.title=t}),e.tab.icon=r.tabIcon,e.tab.active=!!r.tabActive,!0!==e.$eval(r.tabDisabled))return n.addTab(e.tab)},transclude:!0}};angular.module("taigaProfile").directive("tgProfileTab",t)}.call(this),function(){var t;function e(){this.tabs=[]}e.prototype.addTab=function(t){return this.tabs.push(t)},e.prototype.toggleTab=function(t){return _.map(this.tabs,function(t){return t.active=!1}),t.active=!0},t=e,angular.module("taigaProfile").controller("ProfileTabs",t)}.call(this),function(){var t=function(){return{scope:{},controller:"ProfileTabs",controllerAs:"vm",templateUrl:"profile/profile-tabs/profile-tabs.html",transclude:!0}};angular.module("taigaProfile").directive("tgProfileTabs",t)}.call(this),function(){var t;function e(t,e,r,n,i,o){var s,a;this.appMetaService=t,this.currentUserService=e,this.routeParams=r,this.userService=n,this.xhrError=i,this.translate=o,this.isCurrentUser=!1,this.routeParams.slug?this.userService.getUserByUserName(this.routeParams.slug).then((a=this,function(t){return t.get("is_active")?(a.user=t,a.isCurrentUser=!1,a._setMeta(a.user),t):a.xhrError.notFound()})).catch((s=this,function(t){return s.xhrError.response(t)})):(this.user=this.currentUserService.getUser(),this.isCurrentUser=!0,this._setMeta(this.user))}e.$inject=["tgAppMetaService","tgCurrentUserService","$routeParams","tgUserService","tgXhrErrorService","$translate"],e.prototype._setMeta=function(t){var e={userFullName:t.get("full_name_display"),userUsername:t.get("username")},e=this.translate.instant("USER.PROFILE.PAGE_TITLE",e),t=t.get("bio");return this.appMetaService.setAll(e,t)},t=e,angular.module("taigaProfile").controller("Profile",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/project/blocked-project-explanation.html"}};angular.module("taigaProjects").directive("tgBlockedProjectExplanation",t)}.call(this),function(){var t;function e(t){this.lightboxFactory=t}e.$inject=["tgLightboxFactory"],e.prototype.launchContactForm=function(){return this.lightboxFactory.create("tg-lb-contact-project",{class:"lightbox lightbox-contact-project e2e-lightbox-contact-project",project:"project"},{project:this.project})},t=e,angular.module("taigaProjects").controller("ContactProjectButtonCtrl",t)}.call(this),function(){var t=function(){return{scope:{},controller:"ContactProjectButtonCtrl",bindToController:{project:"=",layout:"@"},controllerAs:"vm",templateUrl:"projects/components/contact-project-button/contact-project-button.html"}};angular.module("taigaProjects").directive("tgContactProjectButton",t)}.call(this),function(){var t;function e(t,e,r){this.lightboxService=t,this.rs=e,this.confirm=r,this.contact={}}e.$inject=["lightboxService","tgResources","$tgConfirm"],e.prototype.contactProject=function(){var t,e=this.project.get("id"),r=this.contact.message,r=this.rs.projects.contactProject(e,r);return this.sendingFeedback=!0,r.then((t=this,function(){return t.lightboxService.closeAll(),t.sendingFeedback=!1,t.confirm.notify("success")}))},t=e,angular.module("taigaProjects").controller("ContactProjectLbCtrl",t)}.call(this),function(){var t=function(r){return this.inject=["lightboxService"],{controller:"ContactProjectLbCtrl",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/lb-contact-project/lb-contact-project.html",link:function(t,e){return r.open(e)}}};angular.module("taigaProjects").directive("tgLbContactProject",["lightboxService",t])}.call(this),function(){var t;function e(t,e){this.confirm=t,this.likeButtonService=e,this.isMouseOver=!1,this.loading=!1}e.$inject=["$tgConfirm","tgLikeProjectButtonService"],e.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},e.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},e.prototype.toggleLike=function(){var t,e;return this.loading=!0,(t=this.project.get("is_fan")?this._unlike():this._like()).finally((e=this,function(){return e.loading=!1})),t},e.prototype._like=function(){return this.likeButtonService.like(this.project.get("id")).then((e=this,function(){return e.showTextWhenMouseIsLeave()})).catch((t=this,function(){return t.confirm.notify("error")}));var t,e},e.prototype._unlike=function(){return this.likeButtonService.unlike(this.project.get("id")).catch((t=this,function(){return t.confirm.notify("error")}));var t},t=e,angular.module("taigaProjects").controller("LikeProjectButton",t)}.call(this),function(){var t=function(){return{scope:{},controller:"LikeProjectButton",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/like-project-button/like-project-button.html"}};angular.module("taigaProjects").directive("tgLikeProjectButton",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r){this.rs=t,this.currentUserService=e,this.projectService=r}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.$inject=["tgResources","tgCurrentUserService","tgProjectService"],e.prototype._getProjectIndex=function(e){return this.currentUserService.projects.get("all").findIndex(function(t){return t.get("id")===e})},e.prototype._updateProjects=function(t,r){var t=this._getProjectIndex(t);if(-1!==t)return t=this.currentUserService.projects.get("all").update(t,function(t){var e=t.get("total_fans");return r?e++:e--,t.merge({is_fan:r,total_fans:e})}),this.currentUserService.setProjects(t)},e.prototype._updateCurrentProject=function(t){var e=this.projectService.project.get("total_fans");return t?e++:e--,e=this.projectService.project.merge({is_fan:t,total_fans:e}),this.projectService.setProject(e)},e.prototype.like=function(t){return this.rs.projects.likeProject(t).then((e=this,function(){return e._updateProjects(t,!0),e._updateCurrentProject(!0)}));var e},e.prototype.unlike=function(t){return this.rs.projects.unlikeProject(t).then((e=this,function(){return e._updateProjects(t,!1),e._updateCurrentProject(!1)}));var e},t=e,angular.module("taigaProjects").service("tgLikeProjectButtonService",t)}.call(this),function(){var t=function(u){return{scope:{projects:"=tgSortProjects"},link:function(a,t,e,r){var c=null,n=dragula([t[0]],{copySortSource:!1,copy:!1,mirrorContainer:t[0],moves:function(t){return $(t).hasClass("list-itemtype-project")}});return n.on("dragend",function(t){var e,r,n,i,t=(c=$(t)).scope().project,o=c.index(),s=_.map(a.projects.toJS(),function(t){return t.id});for((s=_.without(s,t.get("id"))).splice(o,0,t.get("id")),n=[],o=e=0,r=s.length;e<r;o=++e)i=s[o],n.push({project_id:i,order:o});return u.bulkUpdateProjectsOrder(n)}),autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&n.dragging}}),a.$on("$destroy",function(){return t.off(),n.destroy()})}}};angular.module("taigaProjects").directive("tgSortProjects",["tgCurrentUserService",t])}.call(this),function(){var t;function e(t,e){this.confirm=t,this.watchButtonService=e,this.showWatchOptions=!1,this.loading=!1}e.$inject=["$tgConfirm","tgWatchProjectButtonService"],e.prototype.toggleWatcherOptions=function(){return this.showWatchOptions=!this.showWatchOptions},e.prototype.closeWatcherOptions=function(){return this.showWatchOptions=!1},e.prototype.watch=function(t){var e,r;if(t!==this.project.get("notify_level"))return this.loading=!0,this.closeWatcherOptions(),this.watchButtonService.watch(this.project.get("id"),t).catch((r=this,function(){return r.confirm.notify("error")})).finally((e=this,function(){return e.loading=!1}))},e.prototype.unwatch=function(){return this.loading=!0,this.closeWatcherOptions(),this.watchButtonService.unwatch(this.project.get("id")).catch((e=this,function(){return e.confirm.notify("error")})).finally((t=this,function(){return t.loading=!1}));var t,e},t=e,angular.module("taigaProjects").controller("WatchProjectButton",t)}.call(this),function(){var t=function(){return{scope:{},controller:"WatchProjectButton",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/watch-project-button/watch-project-button.html"}};angular.module("taigaProjects").directive("tgWatchProjectButton",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r){this.rs=t,this.currentUserService=e,this.projectService=r}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.$inject=["tgResources","tgCurrentUserService","tgProjectService"],e.prototype._getProjectIndex=function(e){return this.currentUserService.projects.get("all").findIndex(function(t){return t.get("id")===e})},e.prototype._updateProjects=function(t,r,n){var t=this._getProjectIndex(t);if(-1!==t){var i,t=this.currentUserService.projects.get("all").update(t,(i=this,function(t){var e=t.get("total_watchers");return!i.projectService.project.get("is_watcher")&&n?e++:i.projectService.project.get("is_watcher")&&!n&&e--,t.merge({is_watcher:n,total_watchers:e,notify_level:r})}));return this.currentUserService.setProjects(t)}},e.prototype._updateCurrentProject=function(t,e){var r=this.projectService.project.get("total_watchers");return!this.projectService.project.get("is_watcher")&&e?r++:this.projectService.project.get("is_watcher")&&!e&&r--,r=this.projectService.project.merge({is_watcher:e,notify_level:t,total_watchers:r}),this.projectService.setProject(r)},e.prototype.watch=function(t,e){return this.rs.projects.watchProject(t,e).then((r=this,function(){return r._updateProjects(t,e,!0),r._updateCurrentProject(e,!0)}));var r},e.prototype.unwatch=function(t){return this.rs.projects.unwatchProject(t).then((e=this,function(){return e._updateProjects(t,null,!1),e._updateCurrentProject(null,!1)}));var e},t=e,angular.module("taigaProjects").service("tgWatchProjectButtonService",t)}.call(this),function(){var t;function e(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.platformName="Asana",this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,this.projectForm.project_type="scrum",!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}e.$inject=["tgCurrentUserService"],e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},e.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},e.prototype.canCreateProject=function(){return(this.projectForm.is_private?this.canCreatePrivateProjects:this.canCreatePublicProjects).valid},e.prototype.isDisabled=function(){return!this.canCreateProject()},t=e,angular.module("taigaProjects").controller("AsanaImportProjectFormCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/asana-import/asana-import-project-form/asana-import-project-form.html",controller:"AsanaImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}};t.$inject=[],angular.module("taigaProjects").directive("tgAsanaImportProjectForm",t)}.call(this),function(){var t;function e(t,e,r,n){var i,o;this.asanaImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.step="autorization-asana",this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.asanaImportService.projects})),taiga.defineImmutableProperty(this,"members",(o=this,function(){return o.asanaImportService.projectUsers}))}e.$inject=["tgAsanaImportService","$tgConfirm","$translate","tgImportProjectService"],e.prototype.startProjectSelector=function(){return this.step="project-select-asana",this.asanaImportService.fetchProjects()},e.prototype.onSelectProject=function(t){return this.step="project-form-asana",this.project=t,this.fetchingUsers=!0,this.asanaImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},e.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-asana"},e.prototype.onCancelMemberSelection=function(){return this.step="project-form-asana"},e.prototype.startImport=function(t){var e=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0);return e.start(),t=this.asanaImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private"),this.project.get("project_type")),this.importProjectService.importPromise(t).then(function(){return e.stop()})},e.prototype.submitUserSelection=function(t){return this.startImport(t),null},t=e,angular.module("taigaProjects").controller("AsanaImportCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/asana-import/asana-import.html",controller:"AsanaImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgAsanaImport",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r){this.resources=t,this.location=e,this.q=r,this.projects=Immutable.List(),this.projectUsers=Immutable.List(),this.token=null}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgResources","$location","$q"],e.prototype.setToken=function(t){return this.token=t},e.prototype.fetchProjects=function(){return this.resources.asanaImporter.listProjects(this.token).then((e=this,function(t){return e.projects=t}));var e},e.prototype.fetchUsers=function(t){return this.resources.asanaImporter.listUsers(this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},e.prototype.importProject=function(t,e,r,n,i,o,s){return this.resources.asanaImporter.importProject(this.token,t,e,r,n,i,o,s)},e.prototype.getAuthUrl=function(){return this.q((r=this,function(e){return r.resources.asanaImporter.getAuthUrl().then(function(t){return r.authUrl=t.data.url,e(r.authUrl)})}));var r},e.prototype.authorize=function(t){return this.q((n=this,function(e,r){return n.resources.asanaImporter.authorize(t).then(function(t){return n.token=t.data.token,e(n.token)},function(t){return r(new Error(t.status))})}));var n},t=e,angular.module("taigaProjects").service("tgAsanaImportService",t)}.call(this),function(){var t;function e(t,e,r,n,i,o){this.currentUserService=t,this.projectsService=e,this.projectUrl=r,this.location=n,this.navUrls=i,this.analytics=o,this.errorList=[],this.projectForm={is_private:!1},this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0),"scrum"===this.type?this.projectForm.creation_template=1:this.projectForm.creation_template=2}e.$inject=["tgCurrentUserService","tgProjectsService","$projectUrl","$location","$tgNavUrls","$tgAnalytics"],e.prototype.submit=function(){if(this.errorList=[],this.projectForm.name||this.errorList.push("name"),this.projectForm.description||this.errorList.push("description"),0===this.errorList.length)return this.formSubmitLoading=!0,this.projectsService.create(this.projectForm).then((e=this,function(t){return e.analytics.trackEvent("project","create","project creation",{slug:t.get("slug"),id:t.get("id")}),e.location.url(e.projectUrl.get(t)),e.currentUserService.loadProjects()}));var e},e.prototype.onCancelForm=function(){return this.location.path(this.navUrls.resolve("create-project"))},e.prototype.canCreateProject=function(){return(this.projectForm.is_private?this.canCreatePrivateProjects:this.canCreatePublicProjects).valid},e.prototype.isDisabled=function(){return this.formSubmitLoading||!this.canCreateProject()},t=e,angular.module("taigaProjects").controller("CreateProjectFormCtrl",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/create/create-project-form/create-project-form.html",controller:"CreateProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{type:"@"}}};angular.module("taigaProjects").directive("tgCreateProjectForm",t)}.call(this),function(){var t=function(){return{scope:{isPrivate:"=",limitMembersPrivateProject:"=",limitMembersPublicProject:"="},templateUrl:"projects/create/create-project-members-restrictions/create-project-members-restrictions.html"}};angular.module("taigaProject").directive("tgCreateProjectMembersRestrictions",[t])}.call(this),function(){var t=function(){return{scope:{isPrivate:"=",canCreatePrivateProjects:"=",canCreatePublicProjects:"="},templateUrl:"projects/create/create-project-restrictions/create-project-restrictions.html"}};angular.module("taigaProject").directive("tgCreateProjectRestrictions",[t])}.call(this),function(){var t;function e(t,e,r,n,i,o,s){var a,c,u;this.appMetaService=t,this.translate=e,this.projectService=r,this.authService=n,this.lightboxFactory=i,this.rs=o,this.config=s,taiga.defineImmutableProperty(this,"project",(a=this,function(){return a.projectService.project})),this.appMetaService.setfn(this._setMeta.bind(this)),this.authService.refresh(),this.displayScrumDesc=!1,this.dontAsk=!1,this.config.get("isSaas")||this.rs.user.getUserStorage("dont_ask_premise_newsletter").then((u=this,function(t){return u.dontAsk=t,u.displayOnPremise()})).catch((c=this,function(t){return t.status=404,c.rs.user.createUserStorage("dont_ask_premise_newsletter",!1),c.dontAsk=!1,c.displayOnPremise()}))}e.$inject=["tgAppMetaService","$translate","tgProjectService","$tgAuth","tgLightboxFactory","tgResources","$tgConfig"],e.prototype._setMeta=function(){var t;return this.project?(t={projectName:this.project.get("name")},{title:this.translate.instant("PROJECT.PAGE_TITLE",t),description:this.project.get("description")}):null},e.prototype.displayOnPremise=function(){if(!this.dontAsk)return this.lightboxFactory.create("tg-newsletter-email-lightbox",{class:"lightbox newsletter-email"})},e.prototype.displayHelp=function(t,e){if(e.stopPropagation(),e.preventDefault(),"scrum"===t&&(this.displayScrumDesc=!this.displayScrumDesc),"kanban"===t)return this.displayKanbanDesc=!this.displayKanbanDesc},t=e,angular.module("taigaProjects").controller("CreateProjectCtrl",t)}.call(this),function(){var t;function e(t,e,r,n){var i;this.currentUserService=t,this.projectsService=e,this.location=r,this.navUrls=n,this.user=this.currentUserService.getUser(),this.members=Immutable.List(),this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.currentUserService.projects.get("all")})),this.projectForm={is_private:!1},!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}e.$inject=["tgCurrentUserService","tgProjectsService","$tgLocation","$tgNavUrls"],e.prototype.refreshReferenceProject=function(t){return this.projectsService.getProjectBySlug(t).then((e=this,function(t){return e.referenceProject=t,e.members=t.get("members").filter(function(t){return t.get("id")!==e.user.get("id")}),e.invitedMembers=e.members.map(function(t){return t.get("id")}),e.checkUsersLimit()}));var e},e.prototype.toggleInvitedMember=function(e){return this.invitedMembers.includes(e)?this.invitedMembers=this.invitedMembers.filter(function(t){return t!==e}):this.invitedMembers=this.invitedMembers.push(e),this.checkUsersLimit()},e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.invitedMembers.size+1),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.invitedMembers.size+1)},e.prototype.submit=function(){var e,t=this.referenceProject.get("id"),r=this.projectForm;return r.users=this.invitedMembers,this.formSubmitLoading=!0,this.projectsService.duplicate(t,r).then((e=this,function(t){return e.formSubmitLoading=!1,e.location.path(e.navUrls.resolve("project",{project:t.data.slug})),e.currentUserService.loadProjects()}))},e.prototype.canCreateProject=function(){return this.projectForm.is_private?this.canCreatePrivateProjects.valid&&this.limitMembersPrivateProject.valid:this.canCreatePublicProjects.valid&&this.limitMembersPublicProject.valid},e.prototype.isDisabled=function(){return this.formSubmitLoading||!this.canCreateProject()},e.prototype.onCancelForm=function(){return this.location.path(this.navUrls.resolve("create-project"))},t=e,angular.module("taigaProjects").controller("DuplicateProjectCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){},templateUrl:"projects/create/duplicate/duplicate-project.html",controller:"DuplicateProjectCtrl",controllerAs:"vm",bindToController:!0,scope:{}}};t.$inject=[],angular.module("taigaProjects").directive("tgDuplicateProject",t)}.call(this),function(){var t;function e(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.platformName="Github",this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,this.projectForm.project_type="kanban",!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}e.$inject=["tgCurrentUserService"],e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},e.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},e.prototype.canCreateProject=function(){return(this.projectForm.is_private?this.canCreatePrivateProjects:this.canCreatePublicProjects).valid},e.prototype.isDisabled=function(){return!this.canCreateProject()},t=e,angular.module("taigaProjects").controller("GithubImportProjectFormCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/github-import/github-import-project-form/github-import-project-form.html",controller:"GithubImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}};t.$inject=[],angular.module("taigaProjects").directive("tgGithubImportProjectForm",t)}.call(this),function(){var t;function e(t,e,r,n){var i,o;this.githubImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.step="autorization-github",this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.githubImportService.projects})),taiga.defineImmutableProperty(this,"members",(o=this,function(){return o.githubImportService.projectUsers}))}e.$inject=["tgGithubImportService","$tgConfirm","$translate","tgImportProjectService"],e.prototype.startProjectSelector=function(){return this.step="project-select-github",this.githubImportService.fetchProjects()},e.prototype.onSelectProject=function(t){return this.step="project-form-github",this.project=t,this.fetchingUsers=!0,this.githubImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},e.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-github"},e.prototype.onCancelMemberSelection=function(){return this.step="project-form-github"},e.prototype.startImport=function(t){var e=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0);return e.start(),t=this.githubImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private"),this.project.get("project_type")),this.importProjectService.importPromise(t).then(function(){return e.stop()})},e.prototype.submitUserSelection=function(t){return this.startImport(t),null},t=e,angular.module("taigaProjects").controller("GithubImportCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/github-import/github-import.html",controller:"GithubImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgGithubImport",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){this.resources=t,this.q=e,this.projects=Immutable.List(),this.projectUsers=Immutable.List()}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgResources","$q"],e.prototype.setToken=function(t){return this.token=t},e.prototype.fetchProjects=function(){return this.resources.githubImporter.listProjects(this.token).then((e=this,function(t){return e.projects=t}));var e},e.prototype.fetchUsers=function(t){return this.resources.githubImporter.listUsers(this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},e.prototype.importProject=function(t,e,r,n,i,o,s){return this.resources.githubImporter.importProject(this.token,t,e,r,n,i,o,s)},e.prototype.getAuthUrl=function(t){return this.q((r=this,function(e){return r.resources.githubImporter.getAuthUrl(t).then(function(t){return r.authUrl=t.data.url,e(r.authUrl)})}));var r},e.prototype.authorize=function(t){return this.q((n=this,function(e,r){return n.resources.githubImporter.authorize(t).then(function(t){return n.token=t.data.token,e(n.token)},function(t){return r(new Error(t.status))})}));var n},t=e,angular.module("taigaProjects").service("tgGithubImportService",t)}.call(this),function(){var t;function e(t,e){this.currentUserService=t,this.userService=e,this.selectImportUserLightbox=!1,this.warningImportUsers=!1,this.displayEmailSelector=!0,this.cancelledUsers=Immutable.List(),this.selectedUsers=Immutable.List(),this.selectableUsers=Immutable.List(),this.userContacts=Immutable.List()}e.$inject=["tgCurrentUserService","tgUserService"],e.prototype.fetchUser=function(){return this.currentUser=this.currentUserService.getUser(),this.userService.getContacts(this.currentUser.get("id")).then((e=this,function(t){return e.userContacts=t,e.refreshSelectableUsers()}));var e},e.prototype.searchUser=function(t){return this.selectImportUserLightbox=!0,this.searchingUser=t},e.prototype.beforeSubmitUsers=function(){return this.selectedUsers.size!==this.members.size?this.warningImportUsers=!0:this.submit()},e.prototype.confirmUser=function(t,e){var r;return this.selectImportUserLightbox=!1,r=(r=(r=Immutable.Map()).set("user",t)).set("taigaUser",e),this.selectedUsers=this.selectedUsers.push(r),this.discardSuggestedUser(t),this.refreshSelectableUsers()},e.prototype.unselectUser=function(e){var t=this.selectedUsers.findIndex(function(t){return t.getIn(["user","id"])===e.get("id")});return this.selectedUsers=this.selectedUsers.delete(t),this.refreshSelectableUsers()},e.prototype.discardSuggestedUser=function(t){return this.cancelledUsers=this.cancelledUsers.push(t.get("id"))},e.prototype.getSelectedMember=function(e){return this.selectedUsers.find(function(t){return t.getIn(["user","id"])===e.get("id")})},e.prototype.isMemberSelected=function(t){return!!this.getSelectedMember(t)},e.prototype.getUser=function(t){t=this.getSelectedMember(t);return t?t.get("taigaUser"):null},e.prototype.submit=function(){var r;return this.warningImportUsers=!1,r=Immutable.Map(),this.selectedUsers.map(function(t){var e="";return e=_.isString(t.get("taigaUser"))?t.get("taigaUser"):t.getIn(["taigaUser","id"]),r=r.set(t.getIn(["user","id"]),e)}),this.onSubmit({users:r})},e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size+1),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size+1)},e.prototype.showSuggestedMatch=function(t){return t.get("user")&&-1===this.cancelledUsers.indexOf(t.get("id"))&&!this.isMemberSelected(t)},e.prototype.getDistinctSelectedTaigaUsers=function(){var e,r=[];return this.selectedUsers.filter(function(t){t=t.getIn(["taigaUser","id"]);return-1===r.indexOf(t)&&(r.push(t),!0)}).filter((e=this,function(t){return t.getIn(["taigaUser","id"])!==e.currentUser.get("id")}))},e.prototype.refreshSelectableUsers=function(){var t;return this.importMoreUsersDisabled=this.isImportMoreUsersDisabled(),this.importMoreUsersDisabled?(t=this.getDistinctSelectedTaigaUsers(),this.selectableUsers=t.map(function(t){return t.get("taigaUser")}),this.displayEmailSelector=!1):(this.selectableUsers=this.userContacts,this.displayEmailSelector=!0),this.selectableUsers=this.selectableUsers.push(this.currentUser)},e.prototype.isImportMoreUsersDisabled=function(){var t=this.getDistinctSelectedTaigaUsers().size+2;return this.project.get("is_private")?!this.currentUserService.canAddMembersPrivateProject(t).valid:!this.currentUserService.canAddMembersPublicProject(t).valid},t=e,angular.module("taigaProjects").controller("ImportProjectMembersCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.fetchUser(),t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/import-project-members/import-project-members.html",controller:"ImportProjectMembersCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSubmit:"&",platform:"@",logo:"@",onCancel:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgImportProjectMembers",t)}.call(this),function(){var t;function e(){}e.prototype.selectProject=function(t){return this.onSelectProject({project:Immutable.fromJS(t)})},t=e,angular.module("taigaProjects").controller("ImportProjectSelectorCtrl",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/create/import-project-selector/import-project-selector.html",controller:"ImportProjectSelectorCtrl",controllerAs:"vm",bindToController:!0,scope:{projects:"<",onCancel:"&",onSelectProject:"&",logo:"@",noProjectsMsg:"@",search:"@"}}};angular.module("taigaProjects").directive("tgImportProjectSelector",t)}.call(this),function(){var t;function e(t,e,r,n,i){this.confirm=t,this.rs=e,this.importProjectService=r,this.translate=n,this.analytics=i}e.$inject=["$tgConfirm","$tgResources","tgImportProjectService","$translate","$tgAnalytics"],e.prototype.importTaiga=function(t){var e;this.analytics.trackEvent("import","taiga","Start import from taiga",1),t=t[0],(e=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0)).start(),t=this.rs.projects.import(t,e.update),this.importProjectService.importPromise(t).finally(function(){return e.stop()})},t=e,angular.module("taigaProjects").controller("ImportTaigaCtrl",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/create/import-taiga/import-taiga.html",controller:"ImportTaigaCtrl",controllerAs:"vm",bindToController:!0,scope:{}}};angular.module("taigaProjects").directive("tgImportTaiga",t)}.call(this),function(){var t=function(n){return{templateUrl:"projects/create/import/import-project-error-lb.html",link:function(t,e,r){return n.open(e),t.close=function(){n.close(e)}}}};t.$inject=["lightboxService"],angular.module("taigaProjects").directive("tgLbImportError",t)}.call(this),function(){var t;function e(t,e,r,n,i,o,s,a,c,u,l){this.trelloService=t,this.jiraService=e,this.githubService=r,this.asanaService=n,this.location=i,this.window=o,this.routeParams=s,this.tgNavUrls=a,this.config=c,this.confirm=u,this.analytics=l}e.$inject=["tgTrelloImportService","tgJiraImportService","tgGithubImportService","tgAsanaImportService","$location","$window","$routeParams","$tgNavUrls","$tgConfig","$tgConfirm","$tgAnalytics"],e.prototype.start=function(){var t,e,r,n,i,o,s;if(this.token=null,this.from=this.routeParams.platform,e=this.location.search(),this.from&&this.analytics.trackEvent("import",this.from,"Start import from "+this.from,1),"asana"===this.from){if(e.code,e.code)return r=e.code,this.asanaService.authorize(r).then(function(t){return n.location.search({token:encodeURIComponent(JSON.stringify(t))})},(n=this).cancelCurrentImport.bind(this));this.token=JSON.parse(decodeURIComponent(e.token)),this.asanaService.setToken(this.token)}if("trello"===this.from){if(e.oauth_verifier)return r=e.oauth_verifier,this.trelloService.authorize(r).then(function(t){return i.location.search({token:t})},(i=this).cancelCurrentImport.bind(this));e.token&&(this.token=e.token,this.trelloService.setToken(e.token))}if("github"===this.from){if(e.code)return t=e.code,this.githubService.authorize(t).then(function(t){return o.location.search({token:t})},(o=this).cancelCurrentImport.bind(this));e.token&&(this.token=e.token,this.githubService.setToken(e.token))}if("jira"===this.from)return e.oauth_token?(t=e.oauth_verifier,this.jiraService.authorize(t).then(function(t){return s.location.search({token:t.token,url:t.url})},(s=this).cancelCurrentImport.bind(this))):(this.token=e.token,this.jiraService.setToken(e.token,e.url))},e.prototype.select=function(t){var e,r,n,i,o,s;return"trello"===t?this.trelloService.getAuthUrl().then((s=this,function(t){return s.window.open(t,"_self")})):"jira"===t?this.jiraService.getAuthUrl(this.jiraUrl).then(function(t){return o.window.open(t,"_self")},(i=o=this,function(t){return i.confirm.notify("error",t)})):"github"===t?(e=this.location.absUrl()+"/github",this.githubService.getAuthUrl(e).then((n=this,function(t){return n.window.open(t,"_self")}))):"asana"===t?this.asanaService.getAuthUrl().then((r=this,function(t){return r.window.open(t,"_self")})):this.from=t},e.prototype.unfoldOptions=function(t){return this.unfoldedOptions=t},e.prototype.isActiveImporter=function(t){switch(t){case"asana":return this.config.get("enableAsanaImporter");case"github":return this.config.get("enableGithubImporter");case"jira":return this.config.get("enableJiraImporter");case"trello":return this.config.get("enableTrelloImporter");default:return!1}},e.prototype.cancelCurrentImport=function(){return this.location.url(this.tgNavUrls.resolve("create-project-import"))},e.prototype.backToCreate=function(){return this.location.url(this.tgNavUrls.resolve("create-project"))},t=e,angular.module("taigaProjects").controller("ImportProjectCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.start()},templateUrl:"projects/create/import/import-project.html",controller:"ImportProjectCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancelImport:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgImportProject",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r,n,i,o,s){this.currentUserService=t,this.tgAuth=e,this.lightboxFactory=r,this.translate=n,this.confirm=i,this.location=o,this.tgNavUrls=s}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgCurrentUserService","$tgAuth","tgLightboxFactory","$translate","$tgConfirm","$location","$tgNavUrls"],e.prototype.importPromise=function(t){return t.then(this.importSuccess.bind(this),this.importError.bind(this))},e.prototype.importSuccess=function(r){var n,t=this.currentUserService.loadProjects();return t.then((n=this,function(){var t,e;return 202===r.status?(e=n.translate.instant("PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE"),t=n.translate.instant("PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE"),n.location.path(n.tgNavUrls.resolve("home")),n.confirm.success(e,t)):(t={project:r.data.slug},n.location.path(n.tgNavUrls.resolve("project-admin-project-profile-details",t)),t=n.translate.instant("PROJECT.IMPORT.SYNC_SUCCESS"),n.confirm.notify("success",t))})),t},e.prototype.importError=function(r){var n,t=this.tgAuth.refresh();return t.then((n=this,function(){var t,e=n.getRestrictionError(r);return e?n.lightboxFactory.create("tg-lb-import-error",{class:"lightbox lightbox-import-error"},e):(t=n.translate.instant("PROJECT.IMPORT.ERROR"),429===r.status?t=n.translate.instant("PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST"):null!=(e=r.data)&&e._error_message&&(t=n.translate.instant("PROJECT.IMPORT.ERROR_MESSAGE",{error_message:r.data._error_message})),n.confirm.notify("error",t))})),t},e.prototype.getRestrictionError=function(t){var e,r,n,i,o;return!!t.headers&&(e="",o=this.currentUserService.getUser(),r=null,t.headers.isPrivate?(i=!this.currentUserService.canCreatePrivateProjects().valid,n=null!==o.get("max_memberships_private_projects")&&t.headers.memberships>=o.get("max_memberships_private_projects"),i&&n?(e="private-space-members",r=o.get("max_memberships_private_projects")):i?e="private-space":n&&(e="private-members",r=o.get("max_memberships_private_projects"))):(i=!this.currentUserService.canCreatePublicProjects().valid,n=null!==o.get("max_memberships_public_projects")&&t.headers.memberships>=o.get("max_memberships_public_projects"),i&&n?(e="public-space-members",r=o.get("max_memberships_public_projects")):i?e="public-space":n&&(e="public-members",r=o.get("max_memberships_public_projects"))),!!e&&{key:e,values:{max_memberships:r,members:t.headers.memberships}})},t=e,angular.module("taigaProjects").service("tgImportProjectService",t)}.call(this),function(){var t;function e(){}e.$inject=[],e.prototype.isDisabled=function(t){return-1===this.invitedMembers.indexOf(t)},t=e,angular.module("taigaProjects").controller("InviteMembersCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){},templateUrl:"projects/create/invite-members/invite-members.html",controller:"InviteMembersCtrl",controllerAs:"vm",bindToController:!0,scope:{invitedMembers:"<",members:"<",onToggleInvitedMember:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgInviteMembers",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/create/invite-members/single-member/single-member.html",scope:{disabled:"<",avatar:"="}}};t.$inject=[],angular.module("taigaProjects").directive("tgSingleMember",t)}.call(this),function(){var t;function e(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,"agile"===this.projectForm.importer_type?this.projectForm.project_type=null:this.projectForm.project_type="scrum",this.projectForm.create_subissues=!0,!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}e.$inject=["tgCurrentUserService"],e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},e.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},e.prototype.canCreateProject=function(){return(this.projectForm.is_private?this.canCreatePrivateProjects:this.canCreatePublicProjects).valid},e.prototype.isDisabled=function(){return!this.canCreateProject()},t=e,angular.module("taigaProjects").controller("JiraImportProjectFormCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/jira-import/jira-import-project-form/jira-import-project-form.html",controller:"JiraImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}};t.$inject=[],angular.module("taigaProjects").directive("tgJiraImportProjectForm",t)}.call(this),function(){var t;function e(t,e,r,n){var i,o;this.jiraImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.step="autorization-jira",this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.jiraImportService.projects})),taiga.defineImmutableProperty(this,"members",(o=this,function(){return o.jiraImportService.projectUsers}))}e.$inject=["tgJiraImportService","$tgConfirm","$translate","tgImportProjectService"],e.prototype.startProjectSelector=function(){return this.step="project-select-jira",this.jiraImportService.fetchProjects()},e.prototype.onSelectProject=function(t){return this.step="project-form-jira",this.project=t,this.fetchingUsers=!0,this.jiraImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},e.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-jira"},e.prototype.onCancelMemberSelection=function(){return this.step="project-form-jira"},e.prototype.startImport=function(t){var e,r=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0);return r.start(),"issues"===(e=this.project.get("project_type"))&&this.project.get("create_subissues")&&(e="issues-with-subissues"),e=this.jiraImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private"),e,this.project.get("importer_type")),this.importProjectService.importPromise(e).then(function(){return r.stop()})},e.prototype.submitUserSelection=function(t){return this.startImport(t),null},t=e,angular.module("taigaProjects").controller("JiraImportCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/jira-import/jira-import.html",controller:"JiraImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgJiraImport",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r){this.resources=t,this.location=e,this.q=r,this.projects=Immutable.List(),this.projectUsers=Immutable.List()}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgResources","$location","$q"],e.prototype.setToken=function(t,e){return this.token=t,this.url=e},e.prototype.fetchProjects=function(){return this.resources.jiraImporter.listProjects(this.url,this.token).then((e=this,function(t){return e.projects=t}));var e},e.prototype.fetchUsers=function(t){return this.resources.jiraImporter.listUsers(this.url,this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},e.prototype.importProject=function(t,e,r,n,i,o,s,a){return this.resources.jiraImporter.importProject(this.url,this.token,t,e,r,n,i,o,s,a)},e.prototype.getAuthUrl=function(t){return this.q((n=this,function(e,r){return n.resources.jiraImporter.getAuthUrl(t).then(function(t){return n.authUrl=t.data.url,e(n.authUrl)},function(t){return r(t.data._error_message)})}));var n},e.prototype.authorize=function(t){return this.q((n=this,function(e,r){return n.resources.jiraImporter.authorize(t).then(function(t){return n.token=t.data.token,n.url=t.data.url,e(t.data)},function(t){return r(new Error(t.status))})}));var n},t=e,angular.module("taigaProjects").service("tgJiraImportService",t)}.call(this),function(){var t=function(i,o,t,s,a,c,u){return{scope:{visible:"<",openNewsletter:"<",onClose:"&",onSelectUser:"&"},templateUrl:"projects/create/newsletter-email-lightbox/newsletter-email-lightbox.html",link:function(e,r,t,n){return i.open(r),e.dontAsk=!1,e.preference=!1,e.$watch("vm.visible",function(t){return t&&!r.hasClass("open")?(n.start(),i.open(r,null,e.vm.onClose).then(function(){return r.find("input").focus(),o.init(r)})):!t&&r.hasClass("open")?i.close(r).then(function(){return n.userEmail="",n.usersSearch=""}):void 0}),e.closeLightbox=function(){return i.close(r)},e.setEmail=function(){return e.preference?c.onPremise.subscribeOnPremiseNewsletter({email:a.getUser().get("email"),full_name:a.getUser().get("full_name"),origin_form:"Newsletter sign-up create"}).then(function(){return s.user.setUserStorage("dont_ask_premise_newsletter",!0),e.closeLightbox()}).catch(function(){return u.notify("light-error","")}):(s.user.setUserStorage("dont_ask_premise_newsletter",e.dontAsk),e.closeLightbox())}}}};t.$inject=["lightboxService","lightboxKeyboardNavigationService","$tgStorage","tgResources","tgCurrentUserService","tgResources","$tgConfirm"],angular.module("taigaProjects").directive("tgNewsletterEmailLightbox",t)}.call(this),function(){var t;function e(){}e.$inject=[],e.prototype.start=function(){return this.mode="search",this.invalid=!1},e.prototype.assignUser=function(){return this.onSelectUser({user:this.user,taigaUser:this.userEmail})},e.prototype.selectUser=function(t){return this.onSelectUser({user:this.user,taigaUser:Immutable.fromJS(t)})},t=e,angular.module("taigaProjects").controller("SelectImportUserLightboxCtrl",t)}.call(this),function(){var t=function(i,o){return{controller:"SelectImportUserLightboxCtrl",controllerAs:"vm",bindToController:!0,scope:{user:"<",visible:"<",onClose:"&",onSelectUser:"&",selectableUsers:"<",isPrivate:"<",limitMembersPrivateProject:"<",limitMembersPublicProject:"<",displayEmailSelector:"<"},templateUrl:"projects/create/select-import-user-lightbox/select-import-user-lightbox.html",link:function(e,r,t,n){return e.$watch("vm.visible",function(t){return t&&!r.hasClass("open")?(n.start(),i.open(r,null,e.vm.onClose).then(function(){return r.find("input").focus(),o.init(r)})):!t&&r.hasClass("open")?i.close(r).then(function(){return n.userEmail="",n.usersSearch=""}):void 0})}}};t.$inject=["lightboxService","lightboxKeyboardNavigationService"],angular.module("taigaProjects").directive("tgSelectImportUserLightbox",t)}.call(this),function(){var t;function e(t){this.currentUserService=t,this.canCreatePublicProjects=this.currentUserService.canCreatePublicProjects(),this.canCreatePrivateProjects=this.currentUserService.canCreatePrivateProjects(),this.projectForm=this.project.toJS(),this.platformName="Trello",this.projectForm.is_private=!1,this.projectForm.keepExternalReference=!1,!this.canCreatePublicProjects.valid&&this.canCreatePrivateProjects.valid&&(this.projectForm.is_private=!0)}e.$inject=["tgCurrentUserService"],e.prototype.checkUsersLimit=function(){return this.limitMembersPrivateProject=this.currentUserService.canAddMembersPrivateProject(this.members.size),this.limitMembersPublicProject=this.currentUserService.canAddMembersPublicProject(this.members.size)},e.prototype.saveForm=function(){return this.onSaveProjectDetails({project:Immutable.fromJS(this.projectForm)})},e.prototype.canCreateProject=function(){return(this.projectForm.is_private?this.canCreatePrivateProjects:this.canCreatePublicProjects).valid},e.prototype.isDisabled=function(){return!this.canCreateProject()},t=e,angular.module("taigaProjects").controller("TrelloImportProjectFormCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return t.$watch("vm.members",n.checkUsersLimit.bind(n))},templateUrl:"projects/create/trello-import/trello-import-project-form/trello-import-project-form.html",controller:"TrelloImportProjectFormCtrl",controllerAs:"vm",bindToController:!0,scope:{members:"<",project:"<",onSaveProjectDetails:"&",onCancelForm:"&",fetchingUsers:"<"}}};t.$inject=[],angular.module("taigaProjects").directive("tgTrelloImportProjectForm",t)}.call(this),function(){var t;function e(t,e,r,n){var i,o;this.trelloImportService=t,this.confirm=e,this.translate=r,this.importProjectService=n,this.project=null,taiga.defineImmutableProperty(this,"projects",(i=this,function(){return i.trelloImportService.projects})),taiga.defineImmutableProperty(this,"members",(o=this,function(){return o.trelloImportService.projectUsers}))}e.$inject=["tgTrelloImportService","$tgConfirm","$translate","tgImportProjectService"],e.prototype.startProjectSelector=function(){return this.trelloImportService.fetchProjects().then((t=this,function(){return t.step="project-select-trello"}));var t},e.prototype.onSelectProject=function(t){return this.step="project-form-trello",this.project=t,this.fetchingUsers=!0,this.trelloImportService.fetchUsers(this.project.get("id")).then((e=this,function(){return e.fetchingUsers=!1}));var e},e.prototype.onSaveProjectDetails=function(t){return this.project=t,this.step="project-members-trello"},e.prototype.onCancelMemberSelection=function(){return this.step="project-form-trello"},e.prototype.startImport=function(t){var e=this.confirm.loader(this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.TITLE"),this.translate.instant("PROJECT.IMPORT.IN_PROGRESS.DESCRIPTION"),!0);return e.start(),t=this.trelloImportService.importProject(this.project.get("name"),this.project.get("description"),this.project.get("id"),t,this.project.get("keepExternalReference"),this.project.get("is_private")),this.importProjectService.importPromise(t).then(function(){return e.stop()})},e.prototype.submitUserSelection=function(t){return this.startImport(t),null},t=e,angular.module("taigaProjects").controller("TrelloImportCtrl",t)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.startProjectSelector()},templateUrl:"projects/create/trello-import/trello-import.html",controller:"TrelloImportCtrl",controllerAs:"vm",bindToController:!0,scope:{onCancel:"&"}}};t.$inject=[],angular.module("taigaProjects").directive("tgTrelloImport",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){this.resources=t,this.q=e,this.projects=Immutable.List(),this.projectUsers=Immutable.List(),this.token=null}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["tgResources","$q"],e.prototype.setToken=function(t){return this.token=t},e.prototype.fetchProjects=function(){return this.resources.trelloImporter.listProjects(this.token).then((e=this,function(t){return e.projects=t}));var e},e.prototype.fetchUsers=function(t){return this.resources.trelloImporter.listUsers(this.token,t).then((e=this,function(t){return e.projectUsers=t}));var e},e.prototype.importProject=function(t,e,r,n,i,o){return this.resources.trelloImporter.importProject(this.token,t,e,r,n,i,o)},e.prototype.getAuthUrl=function(){return this.q((r=this,function(e){return r.resources.trelloImporter.getAuthUrl().then(function(t){return r.authUrl=t.data.url,e(r.authUrl)})}));var r},e.prototype.authorize=function(t){return this.q((n=this,function(e,r){return n.resources.trelloImporter.authorize(t).then(function(t){return n.token=t.data.token,e(n.token)},function(t){return r(new Error(t.status))})}));var n},t=e,angular.module("taigaProjects").service("tgTrelloImportService",t)}.call(this),function(){var t=function(n,i){return{link:function(e,r,t){return e.$watch("visible",function(t){return t&&!r.hasClass("open")?n.open(r,e.onClose).then(function(){return r.find("input").focus(),i.init(r)}):!t&&r.hasClass("open")?n.close(r):void 0})},templateUrl:"projects/create/warning-user-import-lightbox/warning-user-import-lightbox.html",scope:{visible:"<",onClose:"&",onConfirm:"&"}}};t.$inject=["lightboxService","lightboxKeyboardNavigationService"],angular.module("taigaProjects").directive("tgWarningUserImportLightbox",t)}.call(this),function(){var t;function e(t){var e;this.currentUserService=t,taiga.defineImmutableProperty(this,"projects",(e=this,function(){return e.currentUserService.projects.get("all")}))}e.$inject=["tgCurrentUserService"],t=e,angular.module("taigaProjects").controller("ProjectsListing",t)}.call(this),function(){var t;function e(t,e,r,n,i){var o;this.routeParams=t,this.location=e,this.projectService=r,this.rs=n,this.tgSections=i,this.getProjectHomepage().then((o=this,function(t){return t?o.location.url("project/"+o.routeParams.pslug+"/"+t):o.gotoDefaultProjectHomepage()})).then(null,function(){return this.gotoDefaultProjectHomepage()})}e.$inject=["$routeParams","$location","tgProjectService","$tgResources","$tgSections"],e.prototype.gotoDefaultProjectHomepage=function(){return this.location.url("project/"+this.routeParams.pslug+"/timeline")},e.prototype.getProjectHomepage=function(){var e,r=this.projectService.project.toJS();return this.rs.userProjectSettings.list({project:r.id}).then((e=this,function(t){t=_.find(t,{project:r.id});if(t)return e.tgSections.getPath(r.slug,t.homepage)}))},t=e,angular.module("taigaProjects").controller("ProjectRouter",t)}.call(this),function(){var t;function e(t,e,r,n,i,o,s,a){var c,u,l;this.routeParams=t,this.appMetaService=e,this.auth=r,this.translate=n,this.projectService=i,this.config=o,this.navUrls=s,this.location=a,this.user=this.auth.userData,taiga.defineImmutableProperty(this,"project",(c=this,function(){return c.projectService.project})),taiga.defineImmutableProperty(this,"members",(u=this,function(){return u.projectService.activeMembers})),taiga.defineImmutableProperty(this,"isAuthenticated",(l=this,function(){return!!l.user})),a=this.location.url(),this.registerUrl=this.navUrls.resolve("register")+"?next="+a,this.loginUrl=this.navUrls.resolve("login")+"?next="+a,this.publicRegisterEnabled=this.config.get("publicRegisterEnabled"),this.appMetaService.setfn(this._setMeta.bind(this))}e.$inject=["$routeParams","tgAppMetaService","$tgAuth","$translate","tgProjectService","$tgConfig","$tgNavUrls","$location"],e.prototype._setMeta=function(){var t;return this.project?(t={projectName:this.project.get("name")},{title:this.translate.instant("PROJECT.PAGE_TITLE",t),description:this.project.get("description")}):null},t=e,angular.module("taigaProjects").controller("Project",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){this.rs=t,this.projectUrl=e}t=this.taiga,this.taiga.groupBy,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,t.Service),e.$inject=["tgResources","$projectUrl"],e.prototype.create=function(t){return this.rs.projects.create(t)},e.prototype.duplicate=function(t,e){return this.rs.projects.duplicate(t,e)},e.prototype.getProjectBySlug=function(t){return this.rs.projects.getProjectBySlug(t).then((e=this,function(t){return e._decorate(t)}));var e},e.prototype.getProjectStats=function(t){return this.rs.projects.getProjectStats(t)},e.prototype.getProjectsByUserId=function(t,e){return this.rs.projects.getProjectsByUserId(t,e).then((r=this,function(t){return t.map(r._decorate.bind(r))}));var r},e.prototype.getListProjectsByUserId=function(t,e){return this.rs.projects.getListProjectsByUserId(t,e).then((r=this,function(t){return t.map(r._decorate.bind(r))}));var r},e.prototype._decorate=function(t){var e=this.projectUrl.get(t.toJS());return t=t.set("url",e)},e.prototype.bulkUpdateProjectsOrder=function(t){return this.rs.projects.bulkUpdateOrder(t)},e.prototype.transferValidateToken=function(t,e){return this.rs.projects.transferValidateToken(t,e)},e.prototype.transferAccept=function(t,e,r){return this.rs.projects.transferAccept(t,e,r)},e.prototype.transferReject=function(t,e,r){return this.rs.projects.transferReject(t,e,r)},t=e,angular.module("taigaProjects").service("tgProjectsService",t)}.call(this),function(){var t=function(){return{templateUrl:"projects/transfer/cant-own-project-explanation.html"}};angular.module("taigaProjects").directive("tgCantOwnProjectExplanation",t)}.call(this),function(){var t;function e(t,e,r,n,i,o,s,a,c,u){this.routeParams=t,this.projectsService=e,this.projectService=r,this.location=n,this.authService=i,this.currentUserService=o,this.navUrls=s,this.translate=a,this.confirmService=c,this.errorHandlingService=u}t=angular.module("taigaProjects"),e.$inject=["$routeParams","tgProjectsService","tgProjectService","$location","$tgAuth","tgCurrentUserService","$tgNavUrls","$translate","$tgConfirm","tgErrorHandlingService"],e.prototype.initialize=function(){return this.projectId=this.project.get("id"),this.token=this.routeParams.token,this.showAddComment=!1,this._refreshUserData()},e.prototype._validateToken=function(){return this.projectsService.transferValidateToken(this.projectId,this.token).then(null,(r=this,function(t,e){return r.errorHandlingService.notfound()}));var r},e.prototype._refreshUserData=function(){return this.authService.refresh().then((t=this,function(){return t._validateToken(),t._setProjectData(),t._checkOwnerData()}));var t},e.prototype._setProjectData=function(){return this.canBeOwnedByUser=this.currentUserService.canOwnProject(this.project)},e.prototype._checkOwnerData=function(){var t,e=this.currentUserService.getUser();return this.project.get("is_private")?(this.currentProjects=e.get("total_private_projects"),this.maxProjects=e.get("max_private_projects"),t=e.get("max_memberships_private_projects"),null===this.maxProjects?(this.maxProjects=this.translate.instant("ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS"),this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE"):this.currentProjects<this.maxProjects?this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE":this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE_EXCEEDED"):(this.currentProjects=e.get("total_public_projects"),this.maxProjects=e.get("max_public_projects"),t=e.get("max_memberships_public_projects"),null===this.maxProjects?(this.maxProjects=this.translate.instant("ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS"),this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC"):this.currentProjects<this.maxProjects?this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC":this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC_EXCEEDED"),this.validNumberOfMemberships=null===t||this.project.get("total_memberships")<=t},e.prototype.transferAccept=function(t,e){return this.loadingAccept=!0,this.projectsService.transferAccept(this.project.get("id"),t,e).then((r=this,function(){return r.projectService.fetchProject().then(function(){var t=r.navUrls.resolve("project-admin-project-profile-details",{project:r.project.get("slug")});r.loadingAccept=!1,r.location.path(t),r.confirmService.notify("success",r.translate.instant("ADMIN.PROJECT_TRANSFER.ACCEPTED_PROJECT_OWNERNSHIP"),"",5e3)})}));var r},e.prototype.transferReject=function(t,e){return this.loadingReject=!0,this.projectsService.transferReject(this.project.get("id"),t,e).then((r=this,function(){var t=r.navUrls.resolve("home",{project:r.project.get("slug")});r.loadingReject=!1,r.location.path(t),r.confirmService.notify("success",r.translate.instant("ADMIN.PROJECT_TRANSFER.REJECTED_PROJECT_OWNERNSHIP"),"",5e3)}));var r},e.prototype.addComment=function(){return this.showAddComment=!0},e.prototype.hideComment=function(){return this.showAddComment=!1,this.reason=""},t.controller("TransferProjectController",e)}.call(this),function(){var t=function(){return{link:function(t,e,r,n){return n.initialize()},scope:{},bindToController:{project:"="},templateUrl:"projects/transfer/transfer-project.html",controller:"TransferProjectController",controllerAs:"vm"}};angular.module("taigaProjects").directive("tgTransferProject",t)}.call(this),function(){this.taiga;var g=this.taiga.sizeFormat,t=function(p,i,d,h,f,m){var t={list:function(t,e,r){var t="attachments/"+t,e={object_id:e,project:r},r={headers:{"x-disable-pagination":"1"}},t=p.resolve(t);return i.get(t,e,r).then(function(t){return Immutable.fromJS(t.data)})},get:function(t,e){t="attachments/"+t,e=p.resolve(t)+"/"+e;return i.get(e)},delete:function(t,e){t="attachments/"+t,e=p.resolve(t)+"/"+e;return i.delete(e)},patch:function(t,e,r){t="attachments/"+t,e=p.resolve(t)+"/"+e;return i.patch(e,r)},bulkAttachments:function(t,e,r,n){var e="attachments/"+e,e=p.resolve(e)+"/bulk_update_order";return i.post(e,{object_id:t,after_attachment_id:r,bulk_attachments:n})},create:function(t,e,r,n,i){var o,s,a,c="attachments/"+t,u=p.resolve(c),l=f.defer();return void 0===n?l.reject(null):(a=d.get("maxUploadFileSize",null))&&n.size>a?(s={status:413,data:{_error_message:"'"+n.name+"' ("+g(n.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+g(a)+")"}},l.reject(s)):(t=function(t){return h.$apply(function(){return n.status="in-progress",n.size=g(t.total),n.progressMessage="upload "+g(t.loaded)+" of "+g(t.total),n.progressPercent=""+Math.round(t.loaded/t.total*100)})},c=function(r){return h.$apply(function(){var e,t;n.status="done",t=r.target.status;try{e=JSON.parse(r.target.responseText)}catch(t){e={}}return 200<=t&&t<400?(e=Immutable.fromJS(e),l.resolve(e)):(s={status:t,data:{_error_message:null!=(t=o.attached_file)?t[0]:void 0}},l.reject(s))})},a=function(t){return h.$apply(function(){return n.status="error",l.reject("fail")})},(o=new FormData).append("project",e),o.append("object_id",r),o.append("attached_file",n),o.append("from_comment",i),(i=new XMLHttpRequest).upload.addEventListener("progress",t,!1),i.addEventListener("load",c,!1),i.addEventListener("error",a,!1),a=m.get("token"),i.open("POST",u),i.setRequestHeader("Authorization","Bearer "+a),i.setRequestHeader("Accept","application/json"),i.send(o)),l.promise}};return function(){return{attachments:t}}};t.$inject=["$tgUrls","$tgHttp","$tgConfig","$rootScope","$q","$tgStorage"],angular.module("taigaResources2").factory("tgAttachmentsResource",t)}.call(this),function(){var t=function(i,o){var t={listInAllProjects:function(t){var e=i.resolve("epics"),r={headers:{"x-disable-pagination":"1"}};return o.get(e,t,r).then(function(t){return Immutable.fromJS(t.data)})},list:function(t,e){var r;return null==e&&(e=0),r=i.resolve("epics"),e={project:t,page:e},o.get(r,e).then(function(t){return{list:Immutable.fromJS(t.data),headers:t.headers}})},patch:function(t,e){t=i.resolve("epics")+"/"+t;return o.patch(t,e).then(function(t){return Immutable.fromJS(t.data)})},post:function(t){var e=i.resolve("epics");return o.post(e,t).then(function(t){return Immutable.fromJS(t.data)})},reorder:function(t,e,r){t=i.resolve("epics")+"/"+t,r={headers:{"set-orders":JSON.stringify(r)}};return o.patch(t,e,null,r).then(function(t){return Immutable.fromJS(t.data)})},addRelatedUserstory:function(t,e){var r=i.resolve("epic-related-userstories",t),t={user_story:e,epic:t};return o.post(r,t)},reorderRelatedUserstory:function(t,e,r,n){e=i.resolve("epic-related-userstories",t)+"/"+e,n={headers:{"set-orders":JSON.stringify(n)}};return o.patch(e,r,null,n)},bulkCreateRelatedUserStories:function(t,e,r){t=i.resolve("epic-related-userstories-bulk-create",t),e={bulk_userstories:r,project_id:e};return o.post(t,e)},deleteRelatedUserstory:function(t,e){e=i.resolve("epic-related-userstories",t)+"/"+e;return o.delete(e)}};return function(){return{epics:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgEpicsResource",t)}.call(this),function(){var t=function(n,i){var t={getApplicationToken:function(t,e){var r=n.resolve("applications");return r=r+"/"+t+"/token?state="+e,i.get(r).then(function(t){return Immutable.fromJS(t.data)})},authorizeApplicationToken:function(t,e){var r=n.resolve("application-tokens");return r+="/authorize",t={state:e,application:t},i.post(r,t).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{externalapps:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgExternalAppsResource",t)}.call(this),function(){var t=function(i,o){var t={getHistory:function(t,e,r,n){e=i.resolve("history/"+e);return o.get(e+"/"+r,{page:n,type:t}).then(function(t){return{list:Immutable.fromJS(t.data),headers:t.headers}})}};return function(){return{history:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgHistory",t)}.call(this),function(){this.taiga;var t,e,r,n,i=function(c,u){var t={getAuthUrl:function(t){return t=c.resolve("importers-trello-auth-url"),u.get(t)},authorize:function(t){var e=c.resolve("importers-trello-authorize");return u.post(e,{code:t})},listProjects:function(t){var e=c.resolve("importers-trello-list-projects");return u.post(e,{token:t}).then(function(t){return Immutable.fromJS(t.data)})},listUsers:function(t,e){var r=c.resolve("importers-trello-list-users");return u.post(r,{token:t,project:e}).then(function(t){return Immutable.fromJS(t.data)})},importProject:function(t,e,r,n,i,o,s){var a=c.resolve("importers-trello-import-project"),s={token:t,name:e,description:r,project:n,users_bindings:i.toJS(),keep_external_reference:o,is_private:s,template:"kanban"};return u.post(a,s)}};return function(){return{trelloImporter:t}}};i.$inject=["$tgUrls","$tgHttp"],(r=function(d,h){var t={getAuthUrl:function(t){t=d.resolve("importers-jira-auth-url")+"?url="+t;return h.get(t)},authorize:function(t){var e=d.resolve("importers-jira-authorize");return h.post(e,{oauth_verifier:t})},listProjects:function(t,e){var r=d.resolve("importers-jira-list-projects");return h.post(r,{url:t,token:e}).then(function(t){return Immutable.fromJS(t.data)})},listUsers:function(t,e,r){var n=d.resolve("importers-jira-list-users");return h.post(n,{url:t,token:e,project:r}).then(function(t){return Immutable.fromJS(t.data)})},importProject:function(t,e,r,n,i,o,s,a,c,u){var l=d.resolve("importers-jira-import-project"),p="kanban"!==c?"scrum":"kanban",p={url:t,token:e,name:r,description:n,project:i,users_bindings:o.toJS(),keep_external_reference:s,is_private:a,project_type:c,importer_type:u,template:p};return h.post(l,p)}};return function(){return{jiraImporter:t}}}).$inject=["$tgUrls","$tgHttp"],(e=function(u,l){var t={getAuthUrl:function(t){t=u.resolve("importers-github-auth-url")+"?uri="+t;return l.get(t)},authorize:function(t){var e=u.resolve("importers-github-authorize");return l.post(e,{code:t})},listProjects:function(t){var e=u.resolve("importers-github-list-projects");return l.post(e,{token:t}).then(function(t){return Immutable.fromJS(t.data)})},listUsers:function(t,e){var r=u.resolve("importers-github-list-users");return l.post(r,{token:t,project:e}).then(function(t){return Immutable.fromJS(t.data)})},importProject:function(t,e,r,n,i,o,s,a){var c=u.resolve("importers-github-import-project"),a={token:t,name:e,description:r,project:n,users_bindings:i.toJS(),keep_external_reference:o,is_private:s,template:a};return l.post(c,a)}};return function(){return{githubImporter:t}}}).$inject=["$tgUrls","$tgHttp"],(t=function(u,l){var t={getAuthUrl:function(){var t=u.resolve("importers-asana-auth-url");return l.get(t)},authorize:function(t){var e=u.resolve("importers-asana-authorize");return l.post(e,{code:t})},listProjects:function(t){var e=u.resolve("importers-asana-list-projects");return l.post(e,{token:t}).then(function(t){return Immutable.fromJS(t.data)})},listUsers:function(t,e){var r=u.resolve("importers-asana-list-users");return l.post(r,{token:t,project:e}).then(function(t){return Immutable.fromJS(t.data)})},importProject:function(t,e,r,n,i,o,s,a){var c=u.resolve("importers-asana-import-project"),a={token:t,name:e,description:r,project:n,users_bindings:i.toJS(),keep_external_reference:o,is_private:s,template:a};return l.post(c,a)}};return function(){return{asanaImporter:t}}}).$inject=["$tgUrls","$tgHttp"],(n=angular.module("taigaResources2")).factory("tgTrelloImportResource",i),n.factory("tgJiraImportResource",r),n.factory("tgGithubImportResource",e),n.factory("tgAsanaImportResource",t)}.call(this),function(){var t=function(n,i){var t={listInAllProjects:function(t){var e=n.resolve("issues"),r={headers:{"x-disable-pagination":"1"}};return i.get(e,t,r).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{issues:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgIssuesResource",t)}.call(this),function(){var t=function(t,e,r){var n={subscribeOnPremiseNewsletter:function(t){t={url:r.get("newsletterSubscriberUrl")+"/subscribe/",method:"POST",cancelable:!0,data:t};return e.request(t).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{onPremise:n}}};t.$inject=["$tgUrls","$tgHttp","$tgConfig"],angular.module("taigaResources2").factory("tgOnPremiseResource",t)}.call(this),function(){var t=function(i,o,n){var t={create:function(t){var e=i.resolve("projects");return o.post(e,JSON.stringify(t)).then(function(t){return Immutable.fromJS(t.data)})},duplicate:function(t,e){var r=i.resolve("projects");return r=r+"/"+t+"/duplicate",t=e.users.map(function(t){return{id:t}}),t={name:e.name,description:e.description,is_private:e.is_private,users:t},o.post(r,t)},getProjects:function(t,e){var r;return null==t&&(t={}),null==e&&(e=!0),r=i.resolve("projects"),e=e?{}:{headers:{"x-lazy-pagination":!0}},o.get(r,t,e)},getProjectBySlug:function(t){var e=i.resolve("projects");return e=e+"/by_slug?slug="+t,o.get(e).then(function(t){return Immutable.fromJS(t.data)})},getProjectsByUserId:function(t,e){var r,n;return null==e&&(e=!1),n=i.resolve("projects"),r={},e||(r.headers={"x-disable-pagination":"1"}),t={member:t,order_by:"user_order"},o.get(n,t,r).then(function(t){return Immutable.fromJS(t.data)})},getListProjectsByUserId:function(t,e){var r,n;return null==e&&(e=!1),n=i.resolve("projects"),r={},e||(r.headers={"x-disable-pagination":"1"}),t={member:t,order_by:"user_order",slight:!0},o.get(n,t,r).then(function(t){return Immutable.fromJS(t.data)})},getProjectStats:function(t){var e=i.resolve("projects");return e=e+"/"+t,o.get(e).then(function(t){return Immutable.fromJS(t.data)})},bulkUpdateOrder:function(t){var e=i.resolve("bulk-update-projects-order");return o.post(e,t)},getTimeline:function(t,e){var r={page:e,only_relevant:!0},e=i.resolve("timeline-project");return e=e+"/"+t,o.get(e,r,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),n(t)})},likeProject:function(t){t=i.resolve("project-like",t);return o.post(t)},unlikeProject:function(t){t=i.resolve("project-unlike",t);return o.post(t)},watchProject:function(t,e){e={notify_level:e,live_notify_level:e},t=i.resolve("project-watch",t);return o.post(t,e)},unwatchProject:function(t){t=i.resolve("project-unwatch",t);return o.post(t)},contactProject:function(t,e){t={project:t,comment:e},e=i.resolve("project-contact");return o.post(e,t)},transferValidateToken:function(t,e){e={token:e},t=i.resolve("project-transfer-validate-token",t);return o.post(t,e)},transferAccept:function(t,e,r){r={token:e,reason:r},t=i.resolve("project-transfer-accept",t);return o.post(t,r)},transferReject:function(t,e,r){r={token:e,reason:r},t=i.resolve("project-transfer-reject",t);return o.post(t,r)},transferRequest:function(t){t=i.resolve("project-transfer-request",t);return o.post(t)},transferStart:function(t,e,r){r={user:e,reason:r},t=i.resolve("project-transfer-start",t);return o.post(t,r)}};return function(){return{projects:t}}};t.$inject=["$tgUrls","$tgHttp","tgPaginateResponseService"],angular.module("taigaResources2").factory("tgProjectsResources",t)}.call(this),function(){var u=["tgProjectsResources","tgUserResources","tgUsersResources","tgUserstoriesResource","tgTasksResource","tgIssuesResource","tgExternalAppsResource","tgAttachmentsResource","tgStatsResource","tgHistory","tgEpicsResource","tgTrelloImportResource","tgJiraImportResource","tgGithubImportResource","tgAsanaImportResource","tgOnPremiseResource"],t=function(t){for(var e,r,n,i,o,s,a=0,c=u.length;a<c;a++)for(o=u[a],o=t.get(o),i=t.invoke(o),e=0,r=(n=Object.keys(i)).length;e<r;e++)this[s=n[e]]&&console.warn("repeated resource "+s),this[s]=i[s];return this};t.$inject=["$injector"],angular.module("taigaResources2").service("tgResources",t)}.call(this),function(){var t=function(n,i){var t={discover:function(t,e){var r=n.resolve("stats-discover");return i.get(r).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{stats:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgStatsResource",t)}.call(this),function(){var t=function(n,i){var t={listInAllProjects:function(t){var e=n.resolve("tasks"),r={headers:{"x-disable-pagination":"1"}};return i.get(e,t,r).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{tasks:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgTasksResource",t)}.call(this),function(){var t=function(n,i,t){var e={getUserStorage:function(t){var e=n.resolve("user-storage");return t&&(e+="/"+t),i.get(e,{}).then(function(t){return t.data.value})},setUserStorage:function(t,e){var r=n.resolve("user-storage")+"/"+t,e={key:t,value:e};return i.put(r,e)},createUserStorage:function(t,e){var r=n.resolve("user-storage"),e={key:t,value:e};return i.post(r,e)}};return function(){return{user:e}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgUserResources",t)}.call(this),function(){var t=function(o,s,a){var t={getUserByUsername:function(t){var e=o.resolve("by_username"),r={headers:{"x-disable-pagination":"1"}},t={username:t};return s.get(e,t,r).then(function(t){return Immutable.fromJS(t.data)})},getStats:function(t){var e=o.resolve("user-stats",t),t={headers:{"x-disable-pagination":"1"}};return s.get(e,{},t).then(function(t){return Immutable.fromJS(t.data)})},getContacts:function(t,e){var r=o.resolve("user-contacts",t),t={};return null!=e&&(t.exclude_project=e),e={headers:{"x-disable-pagination":"1"}},s.get(r,t,e).then(function(t){return Immutable.fromJS(t.data)})},getLiked:function(t,e,r,n){var i=o.resolve("user-liked",t),t={};return null!=e&&(t.page=e),null!=r&&(t.type=r),null!=n&&(t.q=n),t.only_relevant=!0,s.get(i,t,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),a(t)})},getVoted:function(t,e,r,n){var i=o.resolve("user-voted",t),t={};return null!=e&&(t.page=e),null!=r&&(t.type=r),null!=n&&(t.q=n),s.get(i,t,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),a(t)})},getWatched:function(t,e,r,n){var i=o.resolve("user-watched",t),t={};return null!=e&&(t.page=e),null!=r&&(t.type=r),null!=n&&(t.q=n),s.get(i,t,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),a(t)})},getProfileTimeline:function(t,e){var r={page:e},e=o.resolve("timeline-profile");return e=e+"/"+t,s.get(e,r,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),a(t)})},getUserTimeline:function(t,e){var r={page:e,only_relevant:!0},e=o.resolve("timeline-user");return e=e+"/"+t,s.get(e,r,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),a(t)})},getNotifications:function(t,e,r){e={page:e};return r&&(e.only_unread=!0),r=o.resolve("notifications"),s.get(r,e,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),Immutable.Map({data:t.get("data").get("objects"),next:!!t.get("headers")("x-pagination-next"),prev:!!t.get("headers")("x-pagination-prev"),current:t.get("headers")("x-pagination-current"),count:t.get("headers")("x-pagination-count"),total:t.get("data").get("total")})})},setNotificationAsRead:function(t){t=o.resolve("notifications")+"/"+t+"/set-as-read";return s.patch(t).then(function(t){return t})},setNotificationsAsRead:function(){var t=o.resolve("notifications")+"/set-as-read";return s.post(t).then(function(t){return t})}};return function(){return{users:t}}};t.$inject=["$tgUrls","$tgHttp","tgPaginateResponseService"],angular.module("taigaResources2").factory("tgUsersResources",t)}.call(this),function(){var t=function(i,o){var t={listInAllProjects:function(t,e){var r,n;return null==e&&(e=!1),n=i.resolve("userstories"),e||(r={headers:{"x-disable-pagination":"1"}}),o.get(n,t,r).then(function(t){return Immutable.fromJS(t.data)})},listAllInProject:function(t){var e=i.resolve("userstories"),r={headers:{"x-disable-pagination":"1"}},t={project:t};return o.get(e,t,r).then(function(t){return Immutable.fromJS(t.data)})},listInEpic:function(t){var e=i.resolve("userstories"),r={headers:{"x-disable-pagination":"1"}},t={epic:t,order_by:"epic_order",include_tasks:!0};return o.get(e,t,r).then(function(t){return Immutable.fromJS(t.data)})}};return function(){return{userstories:t}}};t.$inject=["$tgUrls","$tgHttp"],angular.module("taigaResources2").factory("tgUserstoriesResource",t)}.call(this),function(){var t,r;function e(t){this.rootScope=t}t=this.taiga,r=t.truncate,e.$inject=["$rootScope"],e.prototype._set=function(t,e){var r;if(t)return"title"===t?(0===(r=$("head title")).length&&(r=$("<title></title>"),$("head").append(r)),r.html(e||"")):(0===t.indexOf("og:")?0===(r=$("head meta[property='"+t+"']")).length&&(r=$("<meta property='"+t+"'/>"),$("head").append(r)):0===(r=$("head meta[name='"+t+"']")).length&&(r=$("<meta name='"+t+"'/>"),$("head").append(r)),r.attr("content",e||""))},e.prototype.setTitle=function(t){return this._set("title",t)},e.prototype.setDescription=function(t){return this._set("description",r(t,250))},e.prototype.setTwitterMetas=function(t,e){return this._set("twitter:card","summary"),this._set("twitter:site","@taigaio"),this._set("twitter:title",t),this._set("twitter:description",r(e,300)),this._set("twitter:image",window.location.origin+"/"+window._version+"/images/logo-color.png")},e.prototype.setOpenGraphMetas=function(t,e){return this._set("og:type","object"),this._set("og:site_name","Taiga - Love your projects"),this._set("og:title",t),this._set("og:description",r(e,300)),this._set("og:image",window.location.origin+"/"+window._version+"/images/logo-color.png"),this._set("og:url",window.location.href)},e.prototype.setAll=function(t,e){return this.setTitle(t),this.setDescription(e),this.setTwitterMetas(t,e),this.setOpenGraphMetas(t,e)},e.prototype.addMobileViewport=function(){return $("head").append('<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">')},e.prototype.removeMobileViewport=function(){return $('head meta[name="viewport"]').remove()},e.prototype.setfn=function(t){return this.listener&&this._listener(),this._listener=this.rootScope.$watchCollection(t,(e=this,function(t){if(t)return e.setAll(t.title,t.description),e._listener()}));var e},t=e,angular.module("taigaCommon").service("tgAppMetaService",t)}.call(this),function(){var t,i;function e(t,e,r,n){this.confirm=t,this.config=e,this.translate=r,this.rs=n,this.types={epics:"epic",userstories:"us",userstory:"us",issues:"issue",tasks:"task",epic:"epic",us:"us",issue:"issue",task:"task",wiki:"wiki",wikipage:"wiki"},this.maxFileSize=this.getMaxFileSize(),this.maxFileSize&&(this.maxFileSizeFormated=i(this.maxFileSize))}i=this.taiga.sizeFormat,e.$inject=["$tgConfirm","$tgConfig","$translate","tgResources"],e.prototype.sizeError=function(t){t=this.translate.instant("ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED",{fileName:t.name,fileSize:i(t.size),maxFileSize:this.maxFileSizeFormated});return this.confirm.notify("error",t)},e.prototype.validate=function(t){return!(this.maxFileSize&&t.size>this.maxFileSize)||(this.sizeError(t),!1)},e.prototype.getMaxFileSize=function(){return this.config.get("maxUploadFileSize",null)},e.prototype.list=function(t,e,r){return this.rs.attachments.list(t,e,r).then(function(t){return t.sortBy(function(t){return t.get("order")})})},e.prototype.get=function(t,e){return this.rs.attachments.get(this.types[t],e)},e.prototype.delete=function(t,e){return this.rs.attachments.delete(t,e)},e.prototype.saveError=function(t,e){var r="";return t&&(r=this.translate.instant("ATTACHMENT.ERROR_UPLOAD_ATTACHMENT",{fileName:t.name,errorMessage:e.data._error_message})),this.confirm.notify("error",r)},e.prototype.upload=function(t,e,r,n,i){return null==i&&(i=!1),(i=this.rs.attachments.create(n,r,e,t,i)).then(null,this.saveError.bind(this,t)),i},e.prototype.bulkUpdateOrder=function(t,e,r,n){n=this.rs.attachments.bulkAttachments(t,e,r,n);return n.then(null,this.saveError.bind(this,null)),n},e.prototype.patch=function(t,e,r){r=this.rs.attachments.patch(e,t,r);return r.then(null,this.saveError.bind(this,null)),r},t=e,angular.module("taigaCommon").service("tgAttachmentsService",t)}.call(this),function(){var t;function e(t){var e;this.config=t,e=[window._version+"/images/user-avatars/user-avatar-01.png",window._version+"/images/user-avatars/user-avatar-02.png",window._version+"/images/user-avatars/user-avatar-03.png",window._version+"/images/user-avatars/user-avatar-04.png",window._version+"/images/user-avatars/user-avatar-05.png"],t=["rgba( 178, 176, 204, 1 )","rgba( 183, 203, 131, 1 )","rgba( 210, 198, 139, 1 )","rgba( 214, 161, 212, 1 )","rgba( 247, 154, 154, 1 )"],this.logos=_.cartesianProduct(e,t)}e.prototype.getDefault=function(t){var e;return e=murmurhash3_32_gc(t,42),t=this.logos.length,t=(+e%(t=+t)+t)%t,{src:(t=this.logos[t])[0],color:t[1]}},e.prototype.getUnnamed=function(){return{url:window._version+"/images/unnamed.png",username:""}},e.prototype.getAvatar=function(t,e){var r,n,i,o,s;return t?(r="avatarBig"===e?"big_photo":"photo",e=null,t=t instanceof Immutable.Map?(n=t.get("gravatar_id"),e=t.get(r),s="@"+t.get("username"),t.get("full_name_display")):(n=t.gravatar_id,e=t[r],s="@"+t.username,t.full_name_display),n?e?{url:e,username:s,fullName:t}:-1===location.host.indexOf("localhost")&&this.config.get("gravatar",!0)?(o=location.protocol+"//"+location.host+this.config.get("baseHref"),i=this.getDefault(n),{url:"https://www.gravatar.com/avatar/"+n+"?s=200&d="+encodeURIComponent(o+i.src),bg:i.color,username:s,fullName:t}):{url:(o=location.protocol+"//"+location.host+this.config.get("baseHref"))+(i=this.getDefault(n)).src,bg:i.color,username:s,fullName:t}:this.getUnnamed()):this.getUnnamed()},t=e,angular.module("taigaCommon").service("tgAvatarService",["$tgConfig",t])}.call(this),function(){var t;function e(t){this.projectService=t}this.taiga,e.$inject=["tgProjectService"],e.prototype.check=function(t){return!!this.projectService.project&&-1!==this.projectService.project.get("my_permissions").indexOf(t)},t=e,angular.module("taigaCommon").service("tgCheckPermissionsService",t)}.call(this),function(){var t,e,s;function r(t,e,r,n){var i,o;this.projectsService=t,this.storageService=e,this.rs=r,this.q=n,this._user=null,this._projects=Immutable.Map(),this._projectsById=Immutable.Map(),this._joyride=null,s.defineImmutableProperty(this,"projects",(i=this,function(){return i._projects})),s.defineImmutableProperty(this,"projectsById",(o=this,function(){return o._projectsById}))}s=this.taiga,e=this.taiga.groupBy,r.$inject=["tgProjectsService","$tgStorage","tgResources","$q"],r.prototype.isAuthenticated=function(){return null!==this.getUser()},r.prototype.getUser=function(){var t;return this._user||(t=this.storageService.get("userInfo"))&&(t=Immutable.fromJS(t),this.setUser(t)),this._user},r.prototype.removeUser=function(){return this._user=null,this._projects=Immutable.Map(),this._projectsById=Immutable.Map(),this._joyride=null},r.prototype.setUser=function(t){return this._user=t,this._loadUserInfo()},r.prototype.bulkUpdateProjectsOrder=function(t){return this.projectsService.bulkUpdateProjectsOrder(t).then((e=this,function(){return e.loadProjects()}));var e},r.prototype.loadProjects=function(){return this.projectsService.getProjectsByUserId(this._user.get("id")).then((e=this,function(t){return e.setProjects(t)}));var e},r.prototype.loadProjectsList=function(){return this.projectsService.getListProjectsByUserId(this._user.get("id"),null).then((e=this,function(t){return e.setProjects(t)}));var e},r.prototype.disableJoyRide=function(t){if(this.isAuthenticated())return t?this._joyride[t]=!1:this._joyride={backlog:!1,kanban:!1,dashboard:!1},this.rs.user.setUserStorage("joyride",this._joyride)},r.prototype.loadJoyRideConfig=function(){return this.q((r=this,function(e){if(null===r._joyride)return r.rs.user.getUserStorage("joyride").then(function(t){return r._joyride=t,e(r._joyride)}).catch(function(){return r._joyride={backlog:!0,kanban:!0,dashboard:!0},r.rs.user.createUserStorage("joyride",r._joyride),e(r._joyride)});e(r._joyride)}));var r},r.prototype._loadUserInfo=function(){return this.q.all([this.loadProjectsList()])},r.prototype.setProjects=function(t){return this._projects=this._projects.set("all",t),this._projects=this._projects.set("recents",t.slice(0,4)),this._projects=this._projects.set("unblocked",t.filter(function(t){return null===t.toJS().blocked_code})),this._projectsById=Immutable.fromJS(e(t.toJS(),function(t){return t.id})),this.projects},r.prototype.canCreatePrivateProjects=function(){var t=this.getUser();return null!==t.get("max_private_projects")&&t.get("total_private_projects")>=t.get("max_private_projects")?{valid:!1,reason:"max_private_projects",type:"private_project",current:t.get("total_private_projects"),max:t.get("max_private_projects")}:{valid:!0}},r.prototype.canCreatePublicProjects=function(){var t=this.getUser();return t&&null!==t.get("max_public_projects")&&t.get("total_public_projects")>=t.get("max_public_projects")?{valid:!1,reason:"max_public_projects",type:"public_project",current:t.get("total_public_projects"),max:t.get("max_public_projects")}:{valid:!0}},r.prototype.canAddMembersPublicProject=function(t){var e=this.getUser();return null!==e.get("max_memberships_public_projects")&&t>e.get("max_memberships_public_projects")?{valid:!1,reason:"max_members_public_projects",type:"public_project",current:t,max:e.get("max_memberships_public_projects")}:{valid:!0}},r.prototype.canAddMembersPrivateProject=function(t){var e=this.getUser();return null!==e.get("max_memberships_private_projects")&&t>e.get("max_memberships_private_projects")?{valid:!1,reason:"max_members_private_projects",type:"private_project",current:t,max:e.get("max_memberships_private_projects")}:{valid:!0}},r.prototype.canOwnProject=function(t){var e,r;this.getUser();if(t.get("is_private")){if(!(r=this.canCreatePrivateProjects()).valid)return r;if(!(e=this.canAddMembersPrivateProject(t.get("total_memberships"))).valid)return e}else{if(!(r=this.canCreatePublicProjects()).valid)return r;if(!(e=this.canAddMembersPublicProject(t.get("total_memberships"))).valid)return e}return{valid:!0}},t=r,angular.module("taigaCommon").service("tgCurrentUserService",t)}.call(this),function(){var t;function e(t){this.rootScope=t}this.taiga,e.$inject=["$rootScope"],e.prototype.init=function(){return this.rootScope.errorHandling={}},e.prototype.notfound=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.notfound=!0},e.prototype.error=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.error=!0},e.prototype.permissionDenied=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.permissionDenied=!0},e.prototype.block=function(){return this.rootScope.errorHandling.showingError=!0,this.rootScope.errorHandling.blocked=!0},t=e,angular.module("taigaCommon").service("tgErrorHandlingService",t)}.call(this),function(){var t;function e(t,e){this.rootScope=t,this.compile=e}e.$inject=["$rootScope","$compile"],e.prototype.create=function(t,e,r){var n=this.rootScope.$new();n=_.merge(n,r),t=$("<div>").attr(t,!0).attr("tg-bind-scope",!0),e&&t.attr(e),t.addClass("remove-on-close"),n=this.compile(t)(n),$(document.body).append(n)},t=e,angular.module("taigaCommon").service("tgLightboxFactory",t)}.call(this),function(){var t=function(){return function(t){return Immutable.Map({data:t.get("data"),next:!!t.get("headers")("x-pagination-next"),prev:!!t.get("headers")("x-pagination-prev"),current:t.get("headers")("x-pagination-current"),count:t.get("headers")("x-pagination-count")})}};angular.module("taigaCommon").factory("tgPaginateResponseService",t)}.call(this),function(){var t;function e(){var t=[window._version+"/images/project-logos/project-logo-01.png",window._version+"/images/project-logos/project-logo-02.png",window._version+"/images/project-logos/project-logo-03.png",window._version+"/images/project-logos/project-logo-04.png",window._version+"/images/project-logos/project-logo-05.png"],e=["rgba( 153,  214, 220, 1 )","rgba( 213,  156,  156, 1 )","rgba( 214, 161, 212,  1 )","rgba( 164, 162, 219, 1 )","rgba( 152, 224, 168,  1 )"];this.logos=_.cartesianProduct(t,e)}e.prototype.getDefaultProjectLogo=function(t,e){return t=murmurhash3_32_gc(t+"-"+e,42),e=this.logos.length,e=(+t%(e=+e)+e)%e,{src:(e=this.logos[e])[0],color:e[1]}},t=e,angular.module("taigaCommon").service("tgProjectLogoService",t)}.call(this),function(){var t,d;function e(t,e,r,n,i,o){var s,a,c,u,l,p;this.rootScope=t,this.projectsService=e,this.xhrError=r,this.userActivityService=n,this.interval=i,this.q=o,this.manageProjectSignal=(s=this.manageProjectSignal,a=this,function(){return s.apply(a,arguments)}),this._project=null,this._section=null,this._sectionsBreadcrumb=Immutable.List(),this._activeMembers=Immutable.List(),d.defineImmutableProperty(this,"project",(c=this,function(){return c._project})),d.defineImmutableProperty(this,"section",(u=this,function(){return u._section})),d.defineImmutableProperty(this,"sectionsBreadcrumb",(l=this,function(){return l._sectionsBreadcrumb})),d.defineImmutableProperty(this,"activeMembers",(p=this,function(){return p._activeMembers})),window.localStorage.e2e||this.autoRefresh(),this.watchSignals()}d=this.taiga,e.$inject=["$rootScope","tgProjectsService","tgXhrErrorService","tgUserActivityService","$interval","$q"],e.prototype.watchSignals=function(){for(var t,e=["admin:project-modules:updated","admin:project-roles:updated","admin:project-default-values:updated","admin:project-values:updated","admin:project-values:move","admin:project-custom-attributes:updated","sprintform:create:success","sprintform:edit:success","sprintform:remove:success","tags:updated"],r=[],n=0,i=e.length;n<i;n++)t=e[n],r.push(this.rootScope.$on(t,this.manageProjectSignal));return r},e.prototype.manageProjectSignal=function(t){return this.fetchProject()},e.prototype.cleanProject=function(){return this._project=null,this._activeMembers=Immutable.List(),this._section=null,this._sectionsBreadcrumb=Immutable.List()},e.prototype.autoRefresh=function(){var t,e,r,n=this.interval((t=this,function(){return t.fetchProject()}),6e5);return this.userActivityService.onInactive((e=this,function(){return e.interval.cancel(n)})),this.userActivityService.onActive((r=this,function(){return r.fetchProject(),r.autoRefresh()}))},e.prototype.setSection=function(t){return this._section=t,this._sectionsBreadcrumb=t?this._sectionsBreadcrumb.push(this._section):Immutable.List()},e.prototype.setProject=function(t){return this._project=t,this._activeMembers=this._project.get("members").filter(function(t){return t.get("is_active")})},e.prototype.setProjectBySlug=function(r){return this.q((n=this,function(e,t){return n.project&&n.project.get("slug")===r?e():n.projectsService.getProjectBySlug(r).then(function(t){return n.setProject(t),e()}).catch(function(t){return n.xhrError.response(t)})}));var n},e.prototype.fetchProject=function(){var t,e;if(this.project)return t=this.project.get("slug"),this.projectsService.getProjectBySlug(t).then((e=this,function(t){return e.setProject(t)}))},e.prototype.hasPermission=function(t){return-1!==this._project.get("my_permissions").indexOf(t)},e.prototype.isEpicsDashboardEnabled=function(){return this._project.get("is_epics_activated")},t=e,angular.module("taigaCommon").service("tgProjectService",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(){return e.__super__.constructor.apply(this,arguments)}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.prototype.use=function(t){var e=$("link[rel='stylesheet']:first");return 0===e.length&&(e=$("<link rel='stylesheet' href='' type='text/css'>"),$("head").append(e)),e.attr("href",window._version+"/styles/theme-"+t+".css")},t=e,angular.module("taigaCommon").service("tgThemeService",t)}.call(this),function(){var t;function e(t){if(this.timeout=t,window.localStorage.e2e)return null;window.addEventListener("mousemove",this.resetTimer.bind(this),!1),window.addEventListener("mousedown",this.resetTimer.bind(this),!1),window.addEventListener("keypress",this.resetTimer.bind(this),!1),window.addEventListener("mousewheel",this.resetTimer.bind(this),!1),window.addEventListener("touchmove",this.resetTimer.bind(this),!1),this.subscriptionsActive=[],this.subscriptionsInactive=[],this.isActive=!0,this.startTimer()}this.taiga,this.taiga.groupBy,e.$inject=["$timeout"],e.prototype.idleTimeout=3e5,e.prototype.startTimer=function(){return this.timerId=this.timeout(this._fireInactive.bind(this),this.idleTimeout)},e.prototype.resetTimer=function(){return this.isActive||this._fireActive(),this.timeout.cancel(this.timerId),this.startTimer(),this.isActive=!0},e.prototype.onActive=function(t){return this.subscriptionsActive.push(t),this._unSubscriptionsActive.bind(this,t)},e.prototype.onInactive=function(t){return this.subscriptionsInactive.push(t),this._unSubscriptionsInactive.bind(this,t)},e.prototype._fireActive=function(){return this.subscriptionsActive.forEach(function(t){return t()})},e.prototype._fireInactive=function(){return this.isActive=!1,this.subscriptionsInactive.forEach(function(t){return t()})},e.prototype._unSubscriptionsActive=function(e){return this.subscriptionsActive=this.subscriptionsActive.filter(function(t){return t!==e})},e.prototype._unSubscriptionsInactive=function(e){return this.subscriptionsInactive=this.subscriptionsInactive.filter(function(t){return t!==e})},t=e,angular.module("taigaCommon").service("tgUserActivityService",t)}.call(this),function(){var t,r;function e(t,e){this.currentUserService=t,this.projectService=e}this.taiga,r=this.taiga.normalizeString,e.$inject=["tgCurrentUserService","tgProjectService"],e.prototype.filterUsers=function(t,e){e=e.full_name_display.toUpperCase();return e=r(e),t=t.toUpperCase(),t=r(t),_.includes(e,t)},e.prototype.searchUsers=function(t,e){var r,n;return this.currentUser=this.currentUserService.getUser(),r=_.clone(this.projectService.activeMembers.toJS(),!0),e&&(r=_.reject(r,{id:e.id})),r=_.sortBy(r,(n=this,function(t){var e;return t.id===(null!=(e=n.currentUser)?e.get("id"):void 0)?0:t.id})),null!=t&&(r=_.filter(r,_.partial(this.filterUsers,t))),r},t=e,angular.module("taigaCommon").service("tgUserListService",t)}.call(this),function(){var e,t,i={}.hasOwnProperty;function r(t){this.rs=t,e(this)}t=this.taiga,e=t.bindMethods,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(r,t.Service),r.$inject=["tgResources"],r.prototype.getUserByUserName=function(t){return this.rs.users.getUserByUsername(t)},r.prototype.getContacts=function(t,e){return this.rs.users.getContacts(t,e)},r.prototype.getLiked=function(t,e,r,n){return this.rs.users.getLiked(t,e,r,n)},r.prototype.getVoted=function(t,e,r,n){return this.rs.users.getVoted(t,e,r,n)},r.prototype.getWatched=function(t,e,r,n){return this.rs.users.getWatched(t,e,r,n)},r.prototype.getStats=function(t){return this.rs.users.getStats(t)},r.prototype.attachUserContactsToProjects=function(t,e){return this.getContacts(t).then(function(r){return e=e.map(function(e){var t=r.filter(function(t){t=t.get("id");return-1!==e.get("members").indexOf(t)});return e=e.set("contacts",t)})})},t=r,angular.module("taigaCommon").service("tgUserService",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e){this.q=t,this.errorHandlingService=e}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,taiga.Service),e.$inject=["$q","tgErrorHandlingService"],e.prototype.notFound=function(){return this.errorHandlingService.notfound()},e.prototype.permissionDenied=function(){return this.errorHandlingService.permissionDenied()},e.prototype.response=function(t){return t&&(404===t.status?this.notFound():403===t.status&&this.permissionDenied()),this.q.reject(t)},t=e,angular.module("taigaCommon").service("tgXhrErrorService",t)}.call(this),function(){var t=function(n,i){var t=[".jpg",".jpeg",".bmp",".gif",".png"],o=function(e){return e=e.toLowerCase(),_.some(t,function(t){return-1!==e.indexOf(t,e-t.length)})};return{link:function(t,e){var r=o(t.attachment.get("url"))?n.get("user-timeline/user-timeline-attachment/user-timeline-attachment-image.html"):n.get("user-timeline/user-timeline-attachment/user-timeline-attachment.html");return e.html(r),i(e.contents())(t),e.find("img").error(function(){return this.remove()})},scope:{attachment:"=tgUserTimelineAttachment"}}};t.$inject=["$tgTemplate","$compile"],angular.module("taigaUserTimeline").directive("tgUserTimelineAttachment",t)}.call(this),function(){var t,n;function e(t,e){this.translate=t,this.sce=e}n=this.taiga.unslugify,e.$inject=["$translate","$sce"],e.prototype._fieldTranslationKey={status:"COMMON.FIELDS.STATUS",subject:"COMMON.FIELDS.SUBJECT",description_diff:"COMMON.FIELDS.DESCRIPTION",points:"COMMON.FIELDS.POINTS",assigned_to:"COMMON.FIELDS.ASSIGNED_TO",assigned_users:"COMMON.FIELDS.ASSIGNED_USERS",severity:"ISSUES.FIELDS.SEVERITY",priority:"ISSUES.FIELDS.PRIORITY",type:"ISSUES.FIELDS.TYPE",is_iocaine:"TASK.FIELDS.IS_IOCAINE",is_blocked:"COMMON.FIELDS.IS_BLOCKED",color:"COMMON.FIELDS.COLOR",due_date:"COMMON.FIELDS.DUE_DATE",due_date_reason:"COMMON.FIELDS.DUE_DATE_REASON",milestone:"COMMON.FIELDS.SPRINT"},e.prototype._params={username:function(t,e){var r=t.getIn(["data","user"]);return r.get("is_profile_visible")?(t=this.translate.instant("COMMON.SEE_USER_PROFILE",{username:r.get("username")}),this._getLink("user-profile:username=timeline.getIn(['data', 'user', 'username'])",r.get("name"),t)):this._getUsernameSpan(r.get("name"))},field_name:function(t,e){t=t.getIn(["data","value_diff","key"]);return this.translate.instant(this._fieldTranslationKey[t])},project_name:function(t,e){return this._getLink("project:project=timeline.getIn(['data', 'project', 'slug'])",t.getIn(["data","project","name"]))},new_value:function(t,e){var r,n,t=_.isArray(t.getIn(["data","value_diff","value"]).toJS())?(null===(n=t.getIn(["data","value_diff","value"]).get(1))&&"assigned_to"===t.getIn(["data","value_diff","key"])&&(n=this.translate.instant("ACTIVITY.VALUES.UNASSIGNED")),null===n&&"assigned_users"===t.getIn(["data","value_diff","key"])?n=this.translate.instant("ACTIVITY.VALUES.UNASSIGNED"):"due_date"===t.getIn(["data","value_diff","key"])&&(n=n?(r=this.translate.instant("COMMON.PICKERDATE.FORMAT"),moment(n,"YYYY-MM-DD").format(r)):this.translate.instant("ACTIVITY.VALUES.NOT_SET")),n):t.getIn(["data","value_diff","value"]).first().get(1);return $("<span>").attr("ng-non-bindable",!0).text(t).prop("outerHTML")},sprint_name:function(t,e){return this._getLink("project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])",t.getIn(["data","milestone","name"]))},us_name:function(t,e){var t=this._getTimelineObj(t,e).get("userstory"),e={obj:"parent_userstory"},e=this._getDetailObjUrl(e),t="#"+t.get("ref")+" "+t.get("subject");return this._getLink(e,t)},related_us_name:function(t,e){var t=t.getIn(["data","userstory"]),t="#"+t.get("ref")+" "+t.get("subject");return this._getLink("project-userstories-detail:project=timeline.getIn(['data', 'userstory', 'project', 'slug']),ref=timeline.getIn(['data', 'userstory', 'ref'])",t)},epic_name:function(t,e){var t=t.getIn(["data","epic"]),t="#"+t.get("ref")+" "+t.get("subject");return this._getLink("project-epics-detail:project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['data', 'epic', 'ref'])",t)},obj_name:function(t,e){var r=this._getTimelineObj(t,e),t=this._getDetailObjUrl(e),r="wikipage"===e.obj?n(r.get("slug")):"milestone"===e.obj?r.get("name"):"#"+r.get("ref")+" "+r.get("subject");return this._getLink(t,r)},role_name:function(t,e){return _.escape(t.getIn(["data","value_diff","value"]).keySeq().first())}},e.prototype._translateTitleParams=function(t,e,r){return this._params[t].call(this,e,r)},e.prototype._getTimelineObj=function(t,e){return t.getIn(["data",e.obj])},e.prototype._getDetailObjUrl=function(t){var e={issue:["project-issues-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],wikipage:["project-wiki-page",":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])"],task:["project-tasks-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],userstory:["project-userstories-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],parent_userstory:["project-userstories-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])"],milestone:["project-taskboard",":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])"],epic:["project-epics-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"]};return e[t.obj][0]+e[t.obj][1]},e.prototype._getLink=function(t,e,r){return e=$("<span>").attr("ng-non-bindable",!0).text(e),$("<a>").attr("tg-nav",t).append(e).prop("outerHTML")},e.prototype._getUsernameSpan=function(t){return $("<span>").addClass("username").text(t).prop("outerHTML")},e.prototype._getParams=function(e,r,t){var n,i={};return t.translate_params.forEach((n=this,function(t){return i[t]=n._translateTitleParams(t,e,r)})),i},e.prototype.getTitle=function(t,e,r){var n,i=this._getParams(t,e,r),o={};return Object.keys(i).forEach(function(t){return o[t]="{{"+t+"}}"}),n=this.translate.instant(r.key,o),Object.keys(i).forEach(function(t){var e="{{"+t+"}}";return n=n.replace(new RegExp(e,"g"),i[t])}),n},t=e,angular.module("taigaUserTimeline").service("tgUserTimelineItemTitle",t)}.call(this),function(){var t;function e(){}e.prototype.getType=function(e,r){var t=[{check:function(t,e){return"membership"===e.obj},key:"TIMELINE.NEW_MEMBER",translate_params:["project_name"],member:function(t){return Immutable.Map({user:t.getIn(["data","user"]),role:t.getIn(["data","role"])})}},{check:function(t,e){return"project"===e.obj&&"create"===e.type},key:"TIMELINE.NEW_PROJECT",translate_params:["username","project_name"],description:function(t){return t.getIn(["data","project","description"])}},{check:function(t,e){return"change"===e.type&&t.hasIn(["data","value_diff"])&&"attachments"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.UPLOAD_ATTACHMENT",translate_params:["username","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"create"===e.type},key:"TIMELINE.US_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"issue"===e.obj&&"create"===e.type},key:"TIMELINE.ISSUE_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"wikipage"===e.obj&&"create"===e.type},key:"TIMELINE.WIKI_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"create"===e.type&&!t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"create"===e.type&&t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_CREATED_WITH_US",translate_params:["username","project_name","obj_name","us_name"]},{check:function(t,e){return"milestone"===e.obj&&"create"===e.type},key:"TIMELINE.MILESTONE_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"epic"===e.obj&&"create"===e.type},key:"TIMELINE.EPIC_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"relateduserstory"===e.obj&&"create"===e.type},key:"TIMELINE.EPIC_RELATED_USERSTORY_CREATED",translate_params:["username","project_name","related_us_name","epic_name"]},{check:function(t,e){return t.getIn(["data","comment"])&&"userstory"===e.obj},key:"TIMELINE.NEW_COMMENT_US",translate_params:["username","obj_name"],description:function(t){t=t.getIn(["data","comment_html"]);return $($.parseHTML(t)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"issue"===e.obj},key:"TIMELINE.NEW_COMMENT_ISSUE",translate_params:["username","obj_name"],description:function(t){t=t.getIn(["data","comment_html"]);return $($.parseHTML(t)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"task"===e.obj},key:"TIMELINE.NEW_COMMENT_TASK",translate_params:["username","obj_name"],description:function(t){t=t.getIn(["data","comment_html"]);return $($.parseHTML(t)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"epic"===e.obj},key:"TIMELINE.NEW_COMMENT_EPIC",translate_params:["username","obj_name"],description:function(t){t=t.getIn(["data","comment_html"]);return $($.parseHTML(t)).text()}},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"moveInBacklog"===t.getIn(["data","value_diff","key"])&&t.hasIn(["data","value_diff","value","backlog_order"])&&"change"===e.type},key:"TIMELINE.US_MOVED",translate_params:["username","obj_name"]},{check:function(t,e){return!(!t.hasIn(["data","value_diff"])||"moveInBacklog"!==t.getIn(["data","value_diff","key"])||"change"!==e.type||"userstory"!==e.obj)&&null===t.getIn(["data","value_diff","value","milestone"]).get(1)},key:"TIMELINE.US_REMOVED_FROM_MILESTONE",translate_params:["username","obj_name"]},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"moveInBacklog"===t.getIn(["data","value_diff","key"])&&"change"===e.type&&"userstory"===e.obj},key:"TIMELINE.US_ADDED_MILESTONE",translate_params:["username","obj_name","sprint_name"]},{check:function(t,e){return!(!t.hasIn(["data","value_diff"])||"blocked"!==t.getIn(["data","value_diff","key"])||"change"!==e.type)&&!0===t.getIn(["data","value_diff","value","is_blocked"]).get(1)},key:"TIMELINE.BLOCKED",translate_params:["username","obj_name"],description:function(t){return!!t.hasIn(["data","value_diff","value","blocked_note_html"])&&(t=t.getIn(["data","value_diff","value","blocked_note_html"]).get(1),$($.parseHTML(t)).text())}},{check:function(t,e){return!(!t.hasIn(["data","value_diff"])||"blocked"!==t.getIn(["data","value_diff","key"])||"change"!==e.type)&&!1===t.getIn(["data","value_diff","value","is_blocked"]).get(1)},key:"TIMELINE.UNBLOCKED",translate_params:["username","obj_name"]},{check:function(t,e){return"milestone"===e.obj&&"change"===e.type},key:"TIMELINE.MILESTONE_UPDATED",translate_params:["username","obj_name"]},{check:function(t,e){return"wikipage"===e.obj&&"change"===e.type},key:"TIMELINE.WIKI_UPDATED",translate_params:["username","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"points"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.US_UPDATED_POINTS",translate_params:["username","field_name","obj_name","new_value","role_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.US_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type},key:"TIMELINE.US_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"issue"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.ISSUE_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"issue"===e.obj&&"change"===e.type},key:"TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&!t.getIn(["data","task","userstory"])&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.TASK_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&t.getIn(["data","task","userstory"])&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.TASK_UPDATED_WITH_US",translate_params:["username","field_name","obj_name","us_name"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&!t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE",translate_params:["username","field_name","obj_name","us_name","new_value"]},{check:function(t,e){return"epic"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.EPIC_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"epic"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"color"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.EPIC_UPDATED_WITH_NEW_COLOR",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"epic"===e.obj&&"change"===e.type},key:"TIMELINE.EPIC_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"user"===e.obj&&"create"===e.type},key:"TIMELINE.NEW_USER",translate_params:["username"]}];return _.find(t,function(t){return t.check(e,r)})},t=e,angular.module("taigaUserTimeline").service("tgUserTimelineItemType",t)}.call(this),function(){var t=function(){return{templateUrl:"user-timeline/user-timeline-item/user-timeline-item.html",scope:{timeline:"=tgUserTimelineItem"}}};angular.module("taigaUserTimeline").directive("tgUserTimelineItem",t)}.call(this),function(){var t=function(){var t={generate:function(r){var n,t,i=1,o=Immutable.List();return r.minItems=r.minItems||20,t=function(){return o=Immutable.List(),n()},n=function(){return r.fetch(i).then(function(t){var e;return i++,e=t.get("data"),r.filter&&(e=r.filter(e)),r.map&&e&&(e=e.map(r.map)),(o=o.concat(e)).size<r.minItems&&t.get("next")?n():Immutable.Map({items:o,total:t.get("total"),next:t.get("next")})})},{next:t}}};return t};angular.module("taigaUserTimeline").factory("tgUserTimelinePaginationSequenceService",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t){this.userTimelineService=t,this.timelineList=Immutable.List(),this.scrollDisabled=!1,this.timeline=null,this.projectId?this.timeline=this.userTimelineService.getProjectTimeline(this.projectId):this.currentUser?this.timeline=this.userTimelineService.getProfileTimeline(this.user.get("id")):this.timeline=this.userTimelineService.getUserTimeline(this.user.get("id")),this.loadTimeline()}t=this.taiga,function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype}(e,(0,this.taiga.mixOf)(t.Controller,t.PageMixin,t.FiltersMixin)),e.$inject=["tgUserTimelineService"],e.prototype.loadTimeline=function(){return this.scrollDisabled=!0,this.timeline.next().then((e=this,function(t){return e.timelineList=e.timelineList.concat(t.get("items")),t.get("next")&&(e.scrollDisabled=!1),e.timelineList}));var e},t=e,angular.module("taigaUserTimeline").controller("UserTimeline",t)}.call(this),function(){var t=function(){return{templateUrl:"user-timeline/user-timeline/user-timeline.html",controller:"UserTimeline",controllerAs:"vm",scope:{projectId:"=projectid",user:"=",currentUser:"="},bindToController:!0}};angular.module("taigaProfile").directive("tgUserTimeline",t)}.call(this),function(){var t,i={}.hasOwnProperty;function e(t,e,r,n){this.rs=t,this.userTimelinePaginationSequenceService=e,this.userTimelineItemType=r,this.userTimelineItemTitle=n}(function(t,e){for(var r in e)i.call(e,r)&&(t[r]=e[r]);function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype})(e,this.taiga.Service),e.$inject=["tgResources","tgUserTimelinePaginationSequenceService","tgUserTimelineItemType","tgUserTimelineItemTitle"],e.prototype._valid_fields=["status","subject","description_diff","assigned_users","assigned_to","points","severity","priority","type","attachments","is_iocaine","content_diff","name","estimated_finish","estimated_start","blocked","moveInBacklog","milestone","color","due_date","due_date_reason"],e.prototype._invalid=[{check:function(t){var e=t.get("data").get("value_diff");if(e){if(t=e.get("key"),-1===this._valid_fields.indexOf(t))return!0;if("attachments"===t&&0===e.get("value").get("new").size)return!0}return!1}},{check:function(t){var e=t.get("event_type").split("."),t=t.get("data").get("value_diff");return"change"===e[2]&&void 0===t}},{check:function(t){return"delete"===t.get("event_type").split(".")[2]}},{check:function(t){t=t.get("event_type").split(".");return"project"===t[1]&&"change"===t[2]}},{check:function(t){return!!t.get("data").get("comment_deleted")}},{check:function(t){var e=t.get("event_type").split("."),r=t.get("data").get("value_diff");return!(!r||"task"!==e[1]||"change"!==e[2]||"milestone"!==r.get("key"))&&t.get("data").get("value_diff").get("value")}}],e.prototype._isInValidTimeline=function(e){return _.some(this._invalid,(r=this,function(t){return t.check.call(r,e)}));var r},e.prototype._parseEventType=function(t){return{section:(t=t.split("."))[0],obj:t[1],type:t[2]}},e.prototype._getTimelineObject=function(t,e){if(t.get("data").get(e.obj))return t.get("data").get(e.obj)},e.prototype._attachExtraInfoToTimelineEntry=function(t,e,r){var n=this.userTimelineItemTitle.getTitle(t,e,r);return t=(t=t.set("title_html",n)).set("obj",this._getTimelineObject(t,e)),r.description&&(t=t.set("description",r.description(t))),r.member&&(t=t.set("member",r.member(t))),"attachments"===t.getIn(["data","value_diff","key"])&&t.hasIn(["data","value_diff","value","new"])&&(t=t.set("attachments",t.getIn(["data","value_diff","value","new"]))),t},e.prototype._parseTimeline=function(t){var n,i=Immutable.List();return t.get("data").forEach((n=this,function(r){var t=n._parseEventType(r.get("event_type")),e=r.get("data").get("values_diff");return e&&e.count()?(e.has("is_blocked")&&(e=Immutable.Map({blocked:e})),e.has("milestone")?e="userstory"===t.obj?Immutable.Map({moveInBacklog:e}):e.deleteIn(["values_diff","milestone"]):"milestone"===t.obj&&(e=Immutable.Map({milestone:e})),e.forEach(function(t,e){var t=Immutable.Map({key:e,value:t}),t=r.setIn(["data","value_diff"],t);return t=t.deleteIn(["data","values_diff"]),i=i.push(t)})):(e=r.deleteIn(["data","values_diff"]),i=i.push(e))})),t.set("data",i)},e.prototype._addEntyAttributes=function(t){var e=this._parseEventType(t.get("event_type")),r=this.userTimelineItemType.getType(t,e);return this._attachExtraInfoToTimelineEntry(t,e,r)},e.prototype.getProfileTimeline=function(e){var r,n,i,t={};return t.fetch=(r=this,function(t){return r.rs.users.getProfileTimeline(e,t).then(function(t){return r._parseTimeline(t)})}),t.map=(n=this,function(t){return n._addEntyAttributes(t)}),t.filter=(i=this,function(t){return t.filterNot(function(t){return i._isInValidTimeline(t)})}),this.userTimelinePaginationSequenceService.generate(t)},e.prototype.getUserTimeline=function(e){var r,n,i,t={};return t.fetch=(r=this,function(t){return r.rs.users.getUserTimeline(e,t).then(function(t){return r._parseTimeline(t)})}),t.map=(n=this,function(t){return n._addEntyAttributes(t)}),t.filter=(i=this,function(t){return t.filterNot(function(t){return i._isInValidTimeline(t)})}),this.userTimelinePaginationSequenceService.generate(t)},e.prototype.getProjectTimeline=function(e){var r,n,i,t={};return t.fetch=(r=this,function(t){return r.rs.projects.getTimeline(e,t).then(function(t){return r._parseTimeline(t)})}),t.map=(n=this,function(t){return n._addEntyAttributes(t)}),t.filter=(i=this,function(t){return t.filterNot(function(t){return i._isInValidTimeline(t)})}),this.userTimelinePaginationSequenceService.generate(t)},t=e,angular.module("taigaUserTimeline").service("tgUserTimelineService",t)}.call(this),function(){var t=function(){return{link:function(t,e,r){return e.on("click",function(t){return t.stopPropagation()})}}};angular.module("taigaUtils").directive("tgIsolateClick",t)}.call(this),function(){var t=function(){return{templateUrl:"wiki/history/wiki-history-diff.html",scope:{key:"<",diff:"<"}}};angular.module("taigaWikiHistory").directive("tgWikiHistoryDiff",t)}.call(this),function(){var t=function(){return{link:function(t,e,r){return t.singleHistoryEntry=t.historyEntry.toJS()},templateUrl:"wiki/history/wiki-history-entry.html",scope:{historyEntry:"<"}}};angular.module("taigaWikiHistory").directive("tgWikiHistoryEntry",t)}.call(this),function(){var t,n;function e(t){var e,r;this.activityService=t,n.defineImmutableProperty(this,"historyEntries",(e=this,function(){return e.activityService.entries})),n.defineImmutableProperty(this,"disablePagination",(r=this,function(){return r.activityService.disablePagination})),this.toggle=!1}n=this.taiga,t=angular.module("taigaWikiHistory"),e.$inject=["tgActivityService"],e.prototype.initializeHistory=function(t){return t&&this.activityService.init("wiki",t),this.loadHistory()},e.prototype.loadHistory=function(){return this.activityService.fetchEntries()},e.prototype.nextPage=function(){return this.activityService.nextPage()},t.controller("WikiHistoryCtrl",e)}.call(this),function(){var i=this.taiga.bindOnce,t=function(){return{scope:{},bindToController:{wikiId:"<"},controller:"WikiHistoryCtrl",controllerAs:"vm",templateUrl:"wiki/history/wiki-history.html",link:function(t,e,r,n){return i(t,"vm.wikiId",function(t){return n.initializeHistory(t)})}}};angular.module("taigaWikiHistory").directive("tgWikiHistory",t)}.call(this);
//# sourceMappingURL=maps/app.js.map
