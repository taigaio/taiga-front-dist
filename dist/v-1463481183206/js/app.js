(function(){var t,e,r,n,i,o,s;this.taiga=s={},this.taigaContribPlugins=this.taigaContribPlugins||window.taigaContribPlugins||[],s.generateHash=function(t){return null==t&&(t=[]),t=_.map(t,function(t){return JSON.stringify(t)}),hex_sha1(t.join(":"))},s.generateUniqueSessionIdentifier=function(){var t,e;return t=(new Date).getTime(),e=Math.floor(150994944*Math.random()),s.generateHash([t,e])},s.sessionId=s.generateUniqueSessionIdentifier(),t=function(t,e,r,n,i,o,a,u,c){var l,p,d,f,h,m,g,v,y;return c.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/),m=t.when,t.when=function(e,r){return r.resolve||(r.resolve={}),angular.extend(r.resolve,{languageLoad:["$q","$translate",function(t,e){var r;return r=t.defer(),e().then(function(){return r.resolve()}),r.promise}]}),m.call(t,e,r)},t.when("/",{templateUrl:"home/home.html",controller:"Home",controllerAs:"vm",loader:!0,title:"HOME.PAGE_TITLE",loader:!0,description:"HOME.PAGE_DESCRIPTION",joyride:"dashboard"}),t.when("/discover",{templateUrl:"discover/discover-home/discover-home.html",controller:"DiscoverHome",controllerAs:"vm",title:"PROJECT.NAVIGATION.DISCOVER",loader:!0}),t.when("/discover/search",{templateUrl:"discover/discover-search/discover-search.html",title:"PROJECT.NAVIGATION.DISCOVER",loader:!0,controller:"DiscoverSearch",controllerAs:"vm",reloadOnSearch:!1}),t.when("/projects/",{templateUrl:"projects/listing/projects-listing.html",access:{requiresLogin:!0},title:"PROJECTS.PAGE_TITLE",description:"PROJECTS.PAGE_DESCRIPTION",loader:!0,controller:"ProjectsListing",controllerAs:"vm"}),t.when("/blocked-project/:pslug/",{templateUrl:"projects/project/blocked-project.html",loader:!0,controller:"Project",controllerAs:"vm"}),t.when("/project/:pslug/",{templateUrl:"projects/project/project.html",loader:!0,controller:"Project",controllerAs:"vm",section:"project-timeline"}),t.when("/project/:pslug/search",{templateUrl:"search/search.html",reloadOnSearch:!1,section:"search",loader:!0}),t.when("/project/:pslug/backlog",{templateUrl:"backlog/backlog.html",loader:!0,section:"backlog",joyride:"backlog"}),t.when("/project/:pslug/kanban",{templateUrl:"kanban/kanban.html",loader:!0,section:"kanban",joyride:"kanban"}),t.when("/project/:pslug/taskboard/:sslug",{templateUrl:"taskboard/taskboard.html",loader:!0,section:"backlog"}),t.when("/project/:pslug/us/:usref",{templateUrl:"us/us-detail.html",loader:!0,section:"backlog-kanban"}),t.when("/project/:pslug/task/:taskref",{templateUrl:"task/task-detail.html",loader:!0,section:"backlog-kanban"}),t.when("/project/:pslug/wiki",{redirectTo:function(t){return"/project/"+t.pslug+"/wiki/home"}}),t.when("/project/:pslug/wiki/:slug",{templateUrl:"wiki/wiki.html",loader:!0,section:"wiki"}),t.when("/project/:pslug/team",{templateUrl:"team/team.html",loader:!0,section:"team"}),t.when("/project/:pslug/issues",{templateUrl:"issue/issues.html",loader:!0,section:"issues"}),t.when("/project/:pslug/issue/:issueref",{templateUrl:"issue/issues-detail.html",loader:!0,section:"issues"}),t.when("/project/:pslug/admin/project-profile/details",{templateUrl:"admin/admin-project-profile.html",section:"admin"}),t.when("/project/:pslug/admin/project-profile/default-values",{templateUrl:"admin/admin-project-default-values.html",section:"admin"}),t.when("/project/:pslug/admin/project-profile/modules",{templateUrl:"admin/admin-project-modules.html",section:"admin"}),t.when("/project/:pslug/admin/project-profile/export",{templateUrl:"admin/admin-project-export.html",section:"admin"}),t.when("/project/:pslug/admin/project-profile/reports",{templateUrl:"admin/admin-project-reports.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/status",{templateUrl:"admin/admin-project-values-status.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/points",{templateUrl:"admin/admin-project-values-points.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/priorities",{templateUrl:"admin/admin-project-values-priorities.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/severities",{templateUrl:"admin/admin-project-values-severities.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/types",{templateUrl:"admin/admin-project-values-types.html",section:"admin"}),t.when("/project/:pslug/admin/project-values/custom-fields",{templateUrl:"admin/admin-project-values-custom-fields.html",section:"admin"}),t.when("/project/:pslug/admin/memberships",{templateUrl:"admin/admin-memberships.html",section:"admin"}),t.when("/project/:pslug/admin/roles",{templateUrl:"admin/admin-roles.html",section:"admin"}),t.when("/project/:pslug/admin/third-parties/webhooks",{templateUrl:"admin/admin-third-parties-webhooks.html",section:"admin"}),t.when("/project/:pslug/admin/third-parties/github",{templateUrl:"admin/admin-third-parties-github.html",section:"admin"}),t.when("/project/:pslug/admin/third-parties/gitlab",{templateUrl:"admin/admin-third-parties-gitlab.html",section:"admin"}),t.when("/project/:pslug/admin/third-parties/bitbucket",{templateUrl:"admin/admin-third-parties-bitbucket.html",section:"admin"}),t.when("/project/:pslug/admin/contrib/:plugin",{templateUrl:"contrib/main.html"}),t.when("/project/:pslug/transfer/:token",{templateUrl:"projects/transfer/transfer-page.html",loader:!0,controller:"Project",controllerAs:"vm"}),t.when("/user-settings/user-profile",{templateUrl:"user/user-profile.html"}),t.when("/user-settings/user-change-password",{templateUrl:"user/user-change-password.html"}),t.when("/user-settings/mail-notifications",{templateUrl:"user/mail-notifications.html"}),t.when("/change-email/:email_token",{templateUrl:"user/change-email.html"}),t.when("/cancel-account/:cancel_token",{templateUrl:"user/cancel-account.html"}),t.when("/user-settings/contrib/:plugin",{templateUrl:"contrib/user-settings.html"}),t.when("/profile",{templateUrl:"profile/profile.html",loader:!0,access:{requiresLogin:!0},controller:"Profile",controllerAs:"vm"}),t.when("/profile/:slug",{templateUrl:"profile/profile.html",loader:!0,controller:"Profile",controllerAs:"vm"}),t.when("/login",{templateUrl:"auth/login.html",title:"LOGIN.PAGE_TITLE",description:"LOGIN.PAGE_DESCRIPTION",disableHeader:!0,controller:"LoginPage"}),t.when("/register",{templateUrl:"auth/register.html",title:"REGISTER.PAGE_TITLE",description:"REGISTER.PAGE_DESCRIPTION",disableHeader:!0}),t.when("/forgot-password",{templateUrl:"auth/forgot-password.html",title:"FORGOT_PASSWORD.PAGE_TITLE",description:"FORGOT_PASSWORD.PAGE_DESCRIPTION",disableHeader:!0}),t.when("/change-password/:token",{templateUrl:"auth/change-password-from-recovery.html",title:"CHANGE_PASSWORD.PAGE_TITLE",description:"CHANGE_PASSWORD.PAGE_TITLE",disableHeader:!0}),t.when("/invitation/:token",{templateUrl:"auth/invitation.html",title:"INVITATION.PAGE_TITLE",description:"INVITATION.PAGE_DESCRIPTION",disableHeader:!0}),t.when("/external-apps",{templateUrl:"external-apps/external-app.html",title:"EXTERNAL_APP.PAGE_TITLE",description:"EXTERNAL_APP.PAGE_DESCRIPTION",controller:"ExternalApp",controllerAs:"vm",disableHeader:!0,mobileViewport:!0}),t.when("/error",{templateUrl:"error/error.html"}),t.when("/not-found",{templateUrl:"error/not-found.html"}),t.when("/permission-denied",{templateUrl:"error/permission-denied.html"}),t.otherwise({redirectTo:"/not-found"}),e.html5Mode({enabled:!0,requireBase:!1}),f={"Content-Type":"application/json","Accept-Language":window.taigaConfig.defaultLanguage||"en","X-Session-Id":s.sessionId},r.defaults.headers["delete"]=f,r.defaults.headers.patch=f,r.defaults.headers.post=f,r.defaults.headers.put=f,r.defaults.headers.get={"X-Session-Id":s.sessionId},r.useApplyAsync(!0),i.setSessionId(s.sessionId),l=function(t,e,r,n){var i;return i=function(i){var o;return 0===i.status||-1===i.status&&!i.config.cancelable?(n.closeAll(),e.path(r.resolve("error")),e.replace()):401===i.status&&-1===e.url().indexOf("/login")&&(o=encodeURIComponent(e.url()),e.url(r.resolve("login")).search("next="+o)),t.reject(i)},{responseError:i}},n.factory("authHttpIntercept",["$q","$location","$tgNavUrls","lightboxService",l]),r.interceptors.push("authHttpIntercept"),h=function(t,e){return{request:function(t){return e.logRequest(),t},requestError:function(r){return e.logResponse(),t.reject(r)},responseError:function(r){return e.logResponse(),t.reject(r)},response:function(t){return e.logResponse(),t}}},n.factory("loaderIntercept",["$q","tgLoader",h]),r.interceptors.push("loaderIntercept"),y=function(t){var e;return e=function(e){var r;return 400===e.status&&e.data.version&&(r=angular.element("body").injector(),r.invoke(["$tgConfirm","$translate",function(t){return function(t,e){var r;return r=e.instant("ERROR.VERSION_ERROR"),t.notify("error",r,null,1e4)}}(this)])),t.reject(e)},{responseError:e}},n.factory("versionCheckHttpIntercept",["$q",y]),r.interceptors.push("versionCheckHttpIntercept"),p=function(t,e,r,n){var i,o,s;return i=function(){var t,i,o;return o=e.pslug,t=n.resolve("blocked-project",{project:o}),i=r.url(),-1===i.indexOf(t)?r.replace().path(t):void 0},s=function(t){return t.data.blocked_code&&i(),t},o=function(e){return 451===e.status&&i(),t.reject(e)},{response:s,responseError:o}},n.factory("blockingIntercept",["$q","$routeParams","$location","$tgNavUrls",p]),r.interceptors.push("blockingIntercept"),o.debugInfoEnabled(window.taigaConfig.debugInfo||!1),localStorage.userInfo&&(v=JSON.parse(localStorage.userInfo)),g=(null!=v?v.lang:void 0)||window.taigaConfig.defaultLanguage||"en",u.addPart("taiga"),a.useLoader("$translatePartialLoader",{urlTemplate:"/"+window._version+"/locales/{part}/locale-{lang}.json"}).useSanitizeValueStrategy("escapeParameters").addInterpolation("$translateMessageFormatInterpolation").preferredLanguage(g),a.fallbackLanguage(g),d=window.getDecorators(),_.each(d,function(t){return n.decorator(t.provider,t.decorator)})},e=function(t,e){var r;return moment.locale(t),"en"!==t&&ljs.load("/"+window._version+"/locales/moment-locales/"+t+".js"),r={defaultMessage:e.instant("COMMON.FORM_ERRORS.DEFAULT_MESSAGE"),type:{email:e.instant("COMMON.FORM_ERRORS.TYPE_EMAIL"),url:e.instant("COMMON.FORM_ERRORS.TYPE_URL"),urlstrict:e.instant("COMMON.FORM_ERRORS.TYPE_URLSTRICT"),number:e.instant("COMMON.FORM_ERRORS.TYPE_NUMBER"),digits:e.instant("COMMON.FORM_ERRORS.TYPE_DIGITS"),dateIso:e.instant("COMMON.FORM_ERRORS.TYPE_DATEISO"),alphanum:e.instant("COMMON.FORM_ERRORS.TYPE_ALPHANUM"),phone:e.instant("COMMON.FORM_ERRORS.TYPE_PHONE")},notnull:e.instant("COMMON.FORM_ERRORS.NOTNULL"),notblank:e.instant("COMMON.FORM_ERRORS.NOT_BLANK"),required:e.instant("COMMON.FORM_ERRORS.REQUIRED"),regexp:e.instant("COMMON.FORM_ERRORS.REGEXP"),min:e.instant("COMMON.FORM_ERRORS.MIN"),max:e.instant("COMMON.FORM_ERRORS.MAX"),range:e.instant("COMMON.FORM_ERRORS.RANGE"),minlength:e.instant("COMMON.FORM_ERRORS.MIN_LENGTH"),maxlength:e.instant("COMMON.FORM_ERRORS.MAX_LENGTH"),rangelength:e.instant("COMMON.FORM_ERRORS.RANGE_LENGTH"),mincheck:e.instant("COMMON.FORM_ERRORS.MIN_CHECK"),maxcheck:e.instant("COMMON.FORM_ERRORS.MAX_CHECK"),rangecheck:e.instant("COMMON.FORM_ERRORS.RANGE_CHECK"),equalto:e.instant("COMMON.FORM_ERRORS.EQUAL_TO"),linewidth:e.instant("COMMON.FORM_ERRORS.LINEWIDTH"),pikaday:e.instant("COMMON.FORM_ERRORS.PIKADAY")},checksley.updateMessages("default",r)},r=function(t,r,n,i,o,a,u,c,l,p,d,f){var h,m,g;return t.debug("Initialize application"),r.$on("$translatePartialLoaderStructureChanged",function(){return a.refresh()}),g={linewidth:function(t,e){var r,n;return r=s.nl2br(t).split("<br />"),n=_.every(r,function(t){return t.length<e})},pikaday:function(t){var e;return e=a.instant("COMMON.PICKERDATE.FORMAT"),moment(t,e).isValid()}},checksley.updateValidators(g),r.contribPlugins=this.taigaContribPlugins,r.adminPlugins=_.filter(this.taigaContribPlugins,{type:"admin"}),r.userSettingsPlugins=_.filter(this.taigaContribPlugins,{type:"userSettings"}),r.$on("$translateChangeEnd",function(t,r){var n;return n=r.language,e(n,a)}),Promise.setScheduler(function(t){return r.$evalAsync(t)}),i.setupConnection(),n.isAuthenticated()&&(m=n.getUser()),o.initialize(),h=r.$on("$routeChangeStart",function(t,e){return e.loader&&d.start(!0),h()}),r.$on("$routeChangeSuccess",function(t,e){var r,i;return e.loader&&d.start(!0),e.access&&e.access.requiresLogin&&(n.isAuthenticated()||u.path(c.resolve("login"))),p.setSection(e.section),e.params.pslug?p.setProjectBySlug(e.params.pslug):p.cleanProject(),(e.title||e.description)&&(i=a.instant(e.title||""),r=a.instant(e.description||""),l.setAll(i,r)),e.mobileViewport?l.addMobileViewport():l.removeMobileViewport(),e.disableHeader?f.disableHeader():f.enableHeader()})},o=_.filter(this.taigaContribPlugins,function(t){return t.module}),angular.module("infinite-scroll").value("THROTTLE_MILLISECONDS",500),i=["taigaBase","taigaCommon","taigaResources","taigaResources2","taigaAuth","taigaEvents","taigaHome","taigaNavigationBar","taigaProjects","taigaRelatedTasks","taigaBacklog","taigaTaskboard","taigaKanban","taigaIssues","taigaUserStories","taigaTasks","taigaTeam","taigaWiki","taigaSearch","taigaAdmin","taigaProject","taigaUserSettings","taigaFeedback","taigaPlugins","taigaIntegrations","taigaComponents","taigaProfile","taigaHome","taigaUserTimeline","taigaExternalApps","taigaDiscover","templates","ngSanitize","ngRoute","ngAnimate","ngAria","pascalprecht.translate","infinite-scroll","tgRepeat"].concat(_.map(o,function(t){return t.module})),n=angular.module("taiga",i),n.config(["$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider",t]),n.run(["$log","$rootScope","$tgAuth","$tgEvents","$tgAnalytics","$translate","$tgLocation","$tgNavUrls","tgAppMetaService","tgProjectService","tgLoader","tgNavigationBarService","$route",r])}).call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty,o=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(){}return t}(),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e}(t),e=function(t){function e(){return this.onInitialDataError=o(this.onInitialDataError,this),e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.onInitialDataError=function(t){return t&&(404===t.status?(this.location.path(this.navUrls.resolve("not-found")),this.location.replace()):403===t.status&&(this.location.path(this.navUrls.resolve("permission-denied")),this.location.replace())),this.q.reject(t)},e}(t),this.taiga.Base=t,this.taiga.Service=r,this.taiga.Controller=e}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m,g,v,y,b,$,S,k,j,I,T,E=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},C=[].slice,O=function(t,e){function r(){this.constructor=t}for(var n in e)w.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},w={}.hasOwnProperty;t=function(t,e){return t.classList?t.classList.add(e):t.className+=" "+e},p=function(t){return function(t){var e;return e="<br />",(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+e+"$2")}}(this),e=function(t){return function(t){var e,r;return e=_.keys(t),r=[],_.forIn(t,function(t,n){return E.call(e,n)<0?r.push(n):void 0}),_.bindAll(t,r)}}(this),r=function(t){return function(t,e,r){var n,i;return i=t.$eval(e),void 0!==i?r(i):(n=null,n=t.$watch(e,function(t){return void 0!==t?(r(t),n?n():void 0):void 0}))}}(this),l=function(){var t,e,r,n,i,o,s,a;for(e=arguments[0],o=2<=arguments.length?C.call(arguments,1):[],t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return O(e,t),e}(e),r=o.length-1;r>=0;r+=-1){i=o[r],a=i.prototype;for(s in a)n=a[s],t.prototype[s]=n}return t},j=function(t,e){return _.trim(t,e)},g=function(t){return t.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-")},T=function(t){return t?_.capitalize(t.replace(/-/g," ")):t},k=function(t,e){var r,n;return r=t.data("nextTextPosition"),(null==r||r>=e.length)&&(r=0),n=e[r],t.data("nextTextPosition",r+1),t.text(n)},a=function(t,e){var r,n,i,o;for(o={},r=0,i=t.length;i>r;r++)n=t[r],o[e(n)]=n;return o},$=function(t,e){return window.setTimeout(e,t)},n=function(t){return window.clearTimeout(t)},h=function(t,e){return _.defer(function(r){return function(){return t.$apply(e)}}(this))},S=function(t){return _.isNumber(t)?t+"":_.isString(t)?t:_.isPlainObject(t)?JSON.stringify(t):_.isUndefined(t)?"":t.toString()},c=function(t,e){return e.join(t)},i=function(t,e){return _.debounce(e,t,{leading:!0,trailing:!1})},o=function(t,e){return _.debounce(e,t,{leading:!1,trailing:!0})},v=function(t,e){return _.startsWith(t,e)},I=function(t,e,r){var n;return null==r&&(r="..."),"string"==typeof t||t instanceof String?(n=t.slice(0),n.length>e&&(n=n.substring(0,e+1),n=n.substring(0,Math.min(n.length,n.lastIndexOf(" "))),n+=r),n):t},m=function(t,e){var r,n,i;return null==e&&(e=1),isNaN(parseFloat(t))||!isFinite(t)?"-":0===t?"0 bytes":(i=["bytes","KB","MB","GB","TB","PB"],r=Math.floor(Math.log(t)/Math.log(1024)),r>5&&(r=5),n=(t/Math.pow(1024,r)).toFixed(e),n+" "+i[r])},y=function(t,e){var r;return e?(r=new RegExp("<(?!"+e+"s*/?)[^>]+>","gi"),String(t).replace(r,"")):String(t).replace(/<\/?[^>]+>/g,"")},f=function(t,e,r){var n;return n=new RegExp("<("+e+")>","gi"),t=t.replace(n,"<"+r+">"),n=new RegExp("</("+e+")>","gi"),t=t.replace(n,"</"+r+">")},s=function(t){return function(t,e,r){return Object.defineProperty(t,e,{get:function(){var t;if(!_.isFunction(r))throw"defineImmutableProperty third param must be a function";if(t=r(),t&&_.isObject(t)&&void 0===t.size)throw"defineImmutableProperty must return immutable data";return t}})}}(this),_.mixin({removeKeys:function(t,e){return _.chain([e]).flatten().reduce(function(t,e){return delete t[e],t},t).value()},cartesianProduct:function(){return _.reduceRight(arguments,function(t,e){return _.flatten(_.map(t,function(t){return _.map(e,function(e){return[e].concat(t)})}),!0)},[[]])}}),u=function(t){return null!==t.match(/\.(jpe?g|png|gif|gifv|webm)/i)},d=function(t,e){var r;return r={},e.forEach(function(e,n){return e!==t.get(n)?e.toJS?r[n]=e.toJS():r[n]=e:void 0}),r},b=this.taiga,b.addClass=t,b.nl2br=p,b.bindMethods=e,b.bindOnce=r,b.mixOf=l,b.trim=j,b.slugify=g,b.unslugify=T,b.toggleText=k,b.groupBy=a,b.timeout=$,b.cancelTimeout=n,b.scopeDefer=h,b.toString=S,b.joinStr=c,b.truncate=I,b.debounce=i,b.debounceLeading=o,b.startswith=v,b.sizeFormat=m,b.stripTags=y,b.replaceTags=f,b.defineImmutableProperty=s,b.isImage=u,b.patch=d}.call(this),function(){var t,e,r,n,i,o,s;i=this.taiga,r=this.taiga.groupBy,n=this.taiga.joinStr,s=this.taiga.trim,o=this.taiga.toString,e=function(){function t(){}return t.prototype.fillUsersAndRoles=function(t,e){var n,i;return n=_.filter(t,function(t){return function(t){return t.is_active}}(this)),this.scope.activeUsers=_.sortBy(n,"full_name_display"),this.scope.activeUsersById=r(this.scope.activeUsers,function(t){return t.id}),this.scope.users=_.sortBy(t,"full_name_display"),this.scope.usersById=r(this.scope.users,function(t){return t.id}),this.scope.roles=_.sortBy(e,"order"),i=_(this.scope.project.members).map("role").uniq().value(),this.scope.computableRoles=_(e).filter("computable").filter(function(t){return _.includes(i,t.id)}).value()},t.prototype.loadUsersAndRoles=function(){var t;return t=this.q.all([this.rs.projects.usersList(this.scope.projectId),this.rs.projects.rolesList(this.scope.projectId)]),t.then(function(t){return function(e){var r,n;return n=e[0],r=e[1],t.fillUsersAndRoles(n,r),e}}(this))},t}(),i.PageMixin=e,t=function(){function t(){}return t.prototype.selectFilter=function(t,e,r){var o,a,u;return null==r&&(r=!1),u=this.location.search(),void 0!==u[t]&&"page"!==t&&(o=_.map(i.toString(u[t]).split(","),function(t){return s(t)}),o.push(i.toString(e)),o=_.compact(o),e=n(",",_.uniq(o))),this.location.isInCurrentRouteParams(t,e)?void 0:(a=r?this.location:this.location.noreload(this.scope),a.search(t,e))},t.prototype.replaceFilter=function(t,e,r){var n;return null==r&&(r=!1),this.location.isInCurrentRouteParams(t,e)?void 0:(n=r?this.location:this.location.noreload(this.scope),n.search(t,e))},t.prototype.replaceAllFilters=function(t,e){var r;return null==e&&(e=!1),r=e?this.location:this.location.noreload(this.scope),r.search(t)},t.prototype.unselectFilter=function(t,e,r){var o,a,u,c;return null==r&&(r=!1),u=this.location.search(),void 0!==u[t]?(void 0!==e&&null!==e||delete u[t],c=_.map(i.toString(u[t]).split(","),function(t){return s(t)}),a=_.reject(c,function(t){return t===i.toString(e)}),a=_.compact(a),e=_.isEmpty(a)?null:n(",",_.uniq(a)),o=r?this.location:this.location.noreload(this.scope),o.search(t,e)):void 0},t}(),i.FiltersMixin=t}.call(this),function(){var t;t=angular.module("taigaAdmin",[])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f=function(t,e){function r(){this.constructor=t}for(var n in e)h.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},h={}.hasOwnProperty;d=this.taiga,l=this.taiga.debounce,p=angular.module("taigaAuth",["taigaResources"]),a=function(){function t(t,e,r,n){var i;t.isAuthenticated()&&(i=r.resolve("home"),n.next&&(i=n.next,e.search("next",null)),e.path(i))}return t.$inject=["tgCurrentUserService","$location","$tgNavUrls","$routeParams"],t}(),p.controller("LoginPage",a),t=function(t){function e(t,r,n,i,o,s,a,u,c,l){var p;this.rootscope=t,this.storage=r,this.model=n,this.rs=i,this.http=o,this.urls=s,this.config=a,this.translate=u,this.currentUserService=c,this.themeService=l,e.__super__.constructor.call(this),p=this.getUser(),this._currentTheme=this._getUserTheme(),this.setUserdata(p)}return f(e,t),e.$inject=["$rootScope","$tgStorage","$tgModel","$tgResources","$tgHttp","$tgUrls","$tgConfig","$translate","tgCurrentUserService","tgThemeService"],e.prototype.setUserdata=function(t){return t?(this.userData=Immutable.fromJS(t.getAttrs()),this.currentUserService.setUser(this.userData)):this.userData=null},e.prototype._getUserTheme=function(){var t;return(null!=(t=this.rootscope.user)?t.theme:void 0)||this.config.get("defaultTheme")||"taiga"},e.prototype._setTheme=function(){var t;return t=this._getUserTheme(),this._currentTheme!==t?(this._currentTheme=t,this.themeService.use(this._currentTheme)):void 0},e.prototype._setLocales=function(){var t,e;return t=(null!=(e=this.rootscope.user)?e.lang:void 0)||this.config.get("defaultLanguage")||"en",this.translate.preferredLanguage(t),this.translate.use(t)},e.prototype.getUser=function(){var t,e;return this.rootscope.user?this.rootscope.user:(e=this.storage.get("userInfo"))?(t=this.model.make_model("users",e),this.rootscope.user=t,this._setLocales(),this._setTheme(),t):(this._setTheme(),null)},e.prototype.setUser=function(t){return this.rootscope.auth=t,this.storage.set("userInfo",t.getAttrs()),this.rootscope.user=t,this.setUserdata(t),this._setLocales(),this._setTheme()},e.prototype.clear=function(){return this.rootscope.auth=null,this.rootscope.user=null,this.storage.remove("userInfo")},e.prototype.setToken=function(t){return this.storage.set("token",t)},e.prototype.getToken=function(){return this.storage.get("token")},e.prototype.removeToken=function(){return this.storage.remove("token")},e.prototype.isAuthenticated=function(){return null!==this.getUser()},e.prototype.refresh=function(){var t;return t=this.urls.resolve("user-me"),this.http.get(t).then(function(t){return function(e,r){var n;return n=e.data,n.token=t.getUser().auth_token,n=t.model.make_model("users",n),t.setUser(n),n}}(this))},e.prototype.login=function(t,e){var r;return r=this.urls.resolve("auth"),t=_.clone(t,!1),t.type=e?e:"normal",this.removeToken(),this.http.post(r,t).then(function(t){return function(e,r){var n;return n=t.model.make_model("users",e.data),t.setToken(n.auth_token),t.setUser(n),n}}(this))},e.prototype.logout=function(){return this.removeToken(),this.clear(),this.currentUserService.removeUser(),this._setTheme(),this._setLocales()},e.prototype.register=function(t,e,r){var n;return n=this.urls.resolve("auth-register"),t=_.clone(t,!1),t.type=e?e:"public","private"===e&&(t.existing=r?r:!1),this.removeToken(),this.http.post(n,t).then(function(t){return function(e){var r;return r=t.model.make_model("users",e.data),t.setToken(r.auth_token),t.setUser(r),r}}(this))},e.prototype.getInvitation=function(t){return this.rs.invitations.get(t)},e.prototype.acceptInvitiationWithNewUser=function(t){return this.register(t,"private",!1)},e.prototype.acceptInvitiationWithExistingUser=function(t){return this.register(t,"private",!0)},e.prototype.forgotPassword=function(t){var e;return e=this.urls.resolve("users-password-recovery"),t=_.clone(t,!1),this.removeToken(),this.http.post(e,t)},e.prototype.changePasswordFromRecovery=function(t){var e;return e=this.urls.resolve("users-change-password-from-recovery"),t=_.clone(t,!1),this.removeToken(),this.http.post(e,t)},e.prototype.changeEmail=function(t){var e;return e=this.urls.resolve("users-change-email"),t=_.clone(t,!1),this.http.post(e,t)},e.prototype.cancelAccount=function(t){var e;return e=this.urls.resolve("users-cancel-account"),t=_.clone(t,!1),this.http.post(e,t)},e}(d.Service),p.service("$tgAuth",t),u=function(t,e,r,n){var i,o;return i=n.get("auth/login-text.html",!0),o=function(){var n,o,s;return(o=t.get("publicRegisterEnabled"))?(s=e.resolve("register"),r.next&&r.next!==e.resolve("register")&&(n=encodeURIComponent(r.next),s+="?next="+n),i({url:s})):""},{restrict:"AE",scope:{},template:o}},p.directive("tgPublicRegisterMessage",["$tgConfig","$tgNavUrls","$routeParams","$tgTemplate",u]),s=function(t,e,r,n,i,o,s,a){var u;return u=function(u,c,p){var d,f,h,m;return d=new checksley.Form(c.find("form.login-form")),i.next&&i.next!==o.resolve("login")?u.nextUrl=decodeURIComponent(i.next):u.nextUrl=o.resolve("home"),h=function(t){return s.setupConnection(),r.url(u.nextUrl)},f=function(t){return e.notify("light-error",a.instant("LOGIN_FORM.ERROR_AUTH_INCORRECT"))},u.onKeyUp=function(t){var e,r;return e=angular.element(t.currentTarget),r=e.val(),u.iscapsLockActivated=!1,r!==r.toLowerCase()?u.iscapsLockActivated=!0:void 0},m=l(2e3,function(e){return function(e){var r,i,o;return e.preventDefault(),d.validate()?(r={username:c.find("form.login-form input[name=username]").val(),password:c.find("form.login-form input[name=password]").val()},i=n.get("loginFormType","normal"),o=t.login(r,i),o.then(h,f)):void 0}}(this)),c.on("submit","form",m),window.prerenderReady=!0,u.$on("$destroy",function(){return c.off()})},{link:u}},p.directive("tgLogin",["$tgAuth","$tgConfirm","$tgLocation","$tgConfig","$routeParams","$tgNavUrls","$tgEvents","$translate",s]),c=function(t,e,r,n,i,o,s,a){var u;return u=function(o,u,c){var p,d,f,h;return i.get("publicRegisterEnabled")||(r.path(n.resolve("not-found")),r.replace()),o.data={},p=u.find("form").checksley({onlyOneErrorElement:!0}),o.nextUrl=n.resolve("home"),f=function(t){return s.trackEvent("auth","register","user registration",1),r.url(o.nextUrl)},d=function(t){var r;return t.data._error_message&&(r=a.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),e.notify("light-error",r)),p.setErrors(t.data)},h=l(2e3,function(e){return function(e){var r;return e.preventDefault(),p.validate()?(r=t.register(o.data),r.then(f,d)):void 0}}(this)),u.on("submit","form",h),o.$on("$destroy",function(){return u.off()}),window.prerenderReady=!0},{link:u}},p.directive("tgRegister",["$tgAuth","$tgConfirm","$tgLocation","$tgNavUrls","$tgConfig","$routeParams","$tgAnalytics","$translate",c]),i=function(t,e,r,n,i){var o;return o=function(o,s,a){var u,c,p,d;return o.data={},u=s.find("form").checksley(),p=function(t){var o,s;return r.path(n.resolve("login")),s=i.instant("FORGOT_PASSWORD_FORM.SUCCESS_TITLE"),o=i.instant("FORGOT_PASSWORD_FORM.SUCCESS_TEXT"),e.success(s,o)},c=function(t){var r;return r=i.instant("FORGOT_PASSWORD_FORM.ERROR"),e.notify("light-error",r)},d=l(2e3,function(e){return function(e){var r;return e.preventDefault(),u.validate()?(r=t.forgotPassword(o.data),r.then(p,c)):void 0}}(this)),s.on("submit","form",d),o.$on("$destroy",function(){return s.off()}),window.prerenderReady=!0},{link:o}},p.directive("tgForgotPassword",["$tgAuth","$tgConfirm","$tgLocation","$tgNavUrls","$translate",i]),n=function(t,e,r,n,i,o){var s;return s=function(s,a,u){var c,p,d,f,h;return s.data={},null!=n.token?(s.tokenInParams=!0,s.data.token=n.token):(r.path(i.resolve("login")),h=o.instant("CHANGE_PASSWORD_RECOVERY_FORM.ERROR"),e.notify("light-error",h)),c=a.find("form").checksley(),d=function(t){return r.path(i.resolve("login")),h=o.instant("CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS"),e.success(h)},p=function(t){return h=o.instant("CHANGE_PASSWORD_RECOVERY_FORM.ERROR"),e.notify("light-error",h)},f=l(2e3,function(e){return function(e){var r;return e.preventDefault(),c.validate()?(r=t.changePasswordFromRecovery(s.data),r.then(d,p)):void 0}}(this)),a.on("submit","form",f),s.$on("$destroy",function(){return a.off()})},{link:s}},p.directive("tgChangePasswordFromRecovery",["$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",n]),o=function(t,e,r,n,i,o,s){var a;return a=function(a,u,c){var p,d,f,h,m,g,v,y,b,$;return $=n.token,g=t.getInvitation($),g.then(function(t){return a.invitation=t}),g.then(null,function(t){var n;return r.path(i.resolve("login")),n=s.instant("INVITATION_LOGIN_FORM.NOT_FOUND"),e.notify("light-error",n)}),a.dataLogin={token:$},p=u.find("form.login-form").checksley({onlyOneErrorElement:!0}),h=function(t){var n;return o.trackEvent("auth","invitationAccept","invitation accept with existing user",1),r.path(i.resolve("project",{project:a.invitation.project_slug})),n=s.instant("INVITATION_LOGIN_FORM.SUCCESS",{project_name:a.invitation.project_name}),e.notify("success",n)},d=function(t){return e.notify("light-error",t.data._error_message)},y=l(2e3,function(e){return function(e){return e.preventDefault(),p.validate()?(g=t.acceptInvitiationWithExistingUser(a.dataLogin),g.then(h,d)):void 0}}(this)),u.on("submit","form.login-form",y),u.on("click",".button-login",y),a.dataRegister={token:$},v=u.find("form.register-form").checksley({onlyOneErrorElement:!0}),m=function(t){return o.trackEvent("auth","invitationAccept","invitation accept with new user",1),r.path(i.resolve("project",{project:a.invitation.project_slug})),e.notify("success","You've successfully joined this project","Welcome to "+_.escape(a.invitation.project_name))},f=function(t){var r;return t.data._error_message&&(r=s.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),e.notify("light-error",r)),v.setErrors(t.data)},b=l(2e3,function(e){return function(e){return e.preventDefault(),v.validate()?(g=t.acceptInvitiationWithNewUser(a.dataRegister),g.then(m,f)):void 0}}(this)),u.on("submit","form.register-form",b),u.on("click",".button-register",b),a.$on("$destroy",function(){return u.off()})},{link:a}},p.directive("tgInvitation",["$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$tgAnalytics","$translate",o]),r=function(t,e,r,n,i,o,s,a){var u;return u=function(e,u,c){var l,p,d,f;return e.data={},e.data.email_token=o.email_token,l=u.find("form").checksley(),d=function(e){var o;return r.isAuthenticated()?t.queryOne("users",r.getUser().id).then(function(t){return function(t){return r.setUser(t),i.path(s.resolve("home"))}}(this)):i.path(s.resolve("login")),o=a.instant("CHANGE_EMAIL_FORM.SUCCESS"),n.success(o)},p=function(t){var e;return e=a.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),n.notify("light-error",e)},f=function(){var t;if(l.validate())return t=r.changeEmail(e.data),t.then(d,p)},u.on("submit",function(t){return t.preventDefault(),f()}),u.on("click","a.button-change-email",function(t){return t.preventDefault(),f()}),e.$on("$destroy",function(){
return u.off()})},{link:u}},p.directive("tgChangeEmail",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls","$translate",r]),e=function(t,e,r,n,i,o,s){var a;return a=function(t,e,a){var u,c,p,d;return t.data={},t.data.cancel_token=o.cancel_token,u=e.find("form").checksley(),p=function(t){var e;return r.logout(),i.path(s.resolve("home")),e=$translate.instant("CANCEL_ACCOUNT.SUCCESS"),n.success(e)},c=function(t){var e;return e=$translate.instant("COMMON.GENERIC_ERROR",{error:t.data._error_message}),n.notify("error",e)},d=l(2e3,function(e){return function(e){var n;return e.preventDefault(),u.validate()?(n=r.cancelAccount(t.data),n.then(p,c)):void 0}}(this)),e.on("submit","form",d),t.$on("$destroy",function(){return e.off()})},{link:a}},p.directive("tgCancelAccount",["$tgRepo","$tgModel","$tgAuth","$tgConfirm","$tgLocation","$routeParams","$tgNavUrls",e])}.call(this),function(){var t;t=angular.module("taigaBacklog",[])}.call(this),function(){var t,e,r,n,i,o,s;o=this.taiga,r=this.taiga.groupBy,e=this.taiga.bindOnce,i=angular.module("taigaBase",[]),t=function(t,e){var r;return r=function(r,n,i){return e.onresize=function(){return t.$broadcast("resize")}},{link:r}},i.directive("tgMain",["$rootScope","$window",t]),s={home:"/",projects:"/projects",error:"/error","not-found":"/not-found","permission-denied":"/permission-denied",discover:"/discover","discover-search":"/discover/search",login:"/login","forgot-password":"/forgot-password","change-password":"/change-password/:token","change-email":"/change-email/:token","cancel-account":"/cancel-account/:token",register:"/register",invitation:"/invitation/:token","create-project":"/create-project",profile:"/profile","user-profile":"/profile/:username","blocked-project":"/blocked-project/:project",project:"/project/:project","project-backlog":"/project/:project/backlog","project-taskboard":"/project/:project/taskboard/:sprint","project-kanban":"/project/:project/kanban","project-issues":"/project/:project/issues","project-search":"/project/:project/search","project-userstories-detail":"/project/:project/us/:ref","project-tasks-detail":"/project/:project/task/:ref","project-issues-detail":"/project/:project/issue/:ref","project-wiki":"/project/:project/wiki","project-wiki-page":"/project/:project/wiki/:slug","project-team":"/project/:project/team","project-admin-home":"/project/:project/admin/project-profile/details","project-admin-project-profile-details":"/project/:project/admin/project-profile/details","project-admin-project-profile-default-values":"/project/:project/admin/project-profile/default-values","project-admin-project-profile-modules":"/project/:project/admin/project-profile/modules","project-admin-project-profile-export":"/project/:project/admin/project-profile/export","project-admin-project-profile-reports":"/project/:project/admin/project-profile/reports","project-admin-project-values-status":"/project/:project/admin/project-values/status","project-admin-project-values-points":"/project/:project/admin/project-values/points","project-admin-project-values-priorities":"/project/:project/admin/project-values/priorities","project-admin-project-values-severities":"/project/:project/admin/project-values/severities","project-admin-project-values-types":"/project/:project/admin/project-values/types","project-admin-project-values-custom-fields":"/project/:project/admin/project-values/custom-fields","project-admin-memberships":"/project/:project/admin/memberships","project-admin-roles":"/project/:project/admin/roles","project-admin-third-parties-webhooks":"/project/:project/admin/third-parties/webhooks","project-admin-third-parties-github":"/project/:project/admin/third-parties/github","project-admin-third-parties-gitlab":"/project/:project/admin/third-parties/gitlab","project-admin-third-parties-bitbucket":"/project/:project/admin/third-parties/bitbucket","project-admin-contrib":"/project/:project/admin/contrib/:plugin","user-settings-user-profile":"/user-settings/user-profile","user-settings-user-change-password":"/user-settings/user-change-password","user-settings-user-avatar":"/user-settings/user-avatar","user-settings-mail-notifications":"/user-settings/mail-notifications","user-settings-contrib":"/user-settings/contrib/:plugin"},n=function(t,e){return t.debug("Initialize navigation urls"),e.update(s)},i.run(["$log","$tgNavUrls",n])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m=[].slice,g=function(t,e){function r(){this.constructor=t}for(var n in e)v.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},v={}.hasOwnProperty;h=this.taiga,f=angular.module("taigaCommon",[]),i=function(t){return{get:function(){return{i18n:{previousMonth:t.instant("COMMON.PICKERDATE.PREV_MONTH"),nextMonth:t.instant("COMMON.PICKERDATE.NEXT_MONTH"),months:[t.instant("COMMON.PICKERDATE.MONTHS.JAN"),t.instant("COMMON.PICKERDATE.MONTHS.FEB"),t.instant("COMMON.PICKERDATE.MONTHS.MAR"),t.instant("COMMON.PICKERDATE.MONTHS.APR"),t.instant("COMMON.PICKERDATE.MONTHS.MAY"),t.instant("COMMON.PICKERDATE.MONTHS.JUN"),t.instant("COMMON.PICKERDATE.MONTHS.JUL"),t.instant("COMMON.PICKERDATE.MONTHS.AUG"),t.instant("COMMON.PICKERDATE.MONTHS.SEP"),t.instant("COMMON.PICKERDATE.MONTHS.OCT"),t.instant("COMMON.PICKERDATE.MONTHS.NOV"),t.instant("COMMON.PICKERDATE.MONTHS.DEC")],weekdays:[t.instant("COMMON.PICKERDATE.WEEK_DAYS.SUN"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.MON"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.TUE"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.WED"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.THU"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.FRI"),t.instant("COMMON.PICKERDATE.WEEK_DAYS.SAT")],weekdaysShort:[t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI"),t.instant("COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT")]},isRTL:"true"===t.instant("COMMON.PICKERDATE.IS_RTL"),firstDay:parseInt(t.instant("COMMON.PICKERDATE.FIRST_DAY_OF_WEEK"),10),format:t.instant("COMMON.PICKERDATE.FORMAT")}}}},f.factory("tgDatePickerConfigService",["$translate",i]),c=function(t,e){var r;return r=function(){return t.getSelection?t.getSelection().toString():e.selection?e.selection.createRange().text:""},{get:r}},f.factory("$selectedText",["$window","$document",c]),r=function(t){var e,r;return r=function(t,e,r){return e&&r&&e.get("my_permissions").indexOf(r)>-1?t.removeClass("hidden"):void 0},e=function(e,n,i){var o,s,a;return n.addClass("hidden"),o=i.tgCheckPermission,a=e.$watch(function(){return t.project},function(){return t.project?(r(n,t.project,o),a()):void 0}),s=i.$observe("tgCheckPermission",function(e){return e?(r(n,t.project,e),s()):void 0}),e.$on("$destroy",function(){return n.off()})},{link:e}},r.$inject=["tgProjectService"],f.directive("tgCheckPermission",r),n=function(){var t,e;return e="tgClassPermission",t=function(t,r,n){var i,o,s;return i=function(t,e,n){var i;return i="!"===n[0],i&&(n=n.slice(1)),i&&-1===t.my_permissions.indexOf(n)?r.addClass(e):i||-1===t.my_permissions.indexOf(n)?r.removeClass(e):r.addClass(e)},o=function(r){var o,a,u,c;if(r){s(),a=t.$eval(n[e]),c=[];for(o in a)u=a[o],c.push(i(r,o,u));return c}},s=t.$watch("project",o)},{link:t}},f.directive("tgClassPermission",n),t=function(){var t,e,r,n;return e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame,r=function(t){return function(t){var i;return i=n.shift(),i(),n.length?e(r):void 0}}(this),n=[],t=function(){var t,i,o,s;for(s=[],i=0,o=arguments.length;o>i;i++)t=arguments[i],n.push(t),1===n.length?s.push(e(r)):s.push(void 0);return s},{add:t}},f.factory("animationFrame",t),d=function(){var t;return t=function(t,e,r){return e.find("textarea").on("focus",function(){return e.addClass("active")})},{link:t}},f.directive("tgToggleComment",d),s=function(t){var e;return e=function(e){var r;return r={project:e.slug},e.is_backlog_activated&&e.my_permissions.indexOf("view_us")>-1?t.resolve("project-backlog",r):e.is_kanban_activated&&e.my_permissions.indexOf("view_us")>-1?t.resolve("project-kanban",r):e.is_wiki_activated&&e.my_permissions.indexOf("view_wiki_pages")>-1?t.resolve("project-wiki",r):e.is_issues_activated&&e.my_permissions.indexOf("view_issues")>-1?t.resolve("project-issues",r):t.resolve("project",r)},{get:e}},f.factory("$projectUrl",["$tgNavUrls",s]),a=function(t){var e,r,n;return e=t.defer(),e.resolve(),r=e.promise,n={bindAdd:function(t){return function(e){return function(){var n;return n=1<=arguments.length?m.call(arguments,0):[],r=r.then(function(){return e.apply(t,n)})}}}(this),add:function(t){return function(t){return r=r?r.then(t):t(),n}}(this)}},f.factory("$tgQqueue",["$q",a]),u=function(t){function e(t,e,r,n){this.qqueue=t,this.repo=e,this.q=r,this.model=n}return g(e,t),e.$inject=["$tgQqueue","$tgRepo","$q","$tgModel"],e.prototype.setObject=function(t,e){this.scope=t,this.prop=e},e.prototype.clone=function(){var t,e;return t=_.cloneDeep(this.scope[this.prop]._attrs),e=this.model.make_model(this.scope[this.prop]._name,t)},e.prototype.getObj=function(){return this.scope[this.prop]},e.prototype.save=function(t){var e;return e=this.q.defer(),this.qqueue.add(function(r){return function(){var n,i,o,s;return o=r.getObj(),i=o.comment,o.comment="",n=r.clone(),t(n),i.length&&(n.comment=i),s=function(){return r.scope[r.prop]=n,e.resolve.apply(null,arguments)},r.repo.save(n).then(s,e.reject)}}(this)),e.promise},e}(h.Service),f.service("$tgQueueModelTransformation",u),p=function(t){return{get:function(e){return function(e,r){var n;return null==r&&(r=!1),n=t.get(e),r&&(n=_.template(n)),n}}(this)}},f.factory("$tgTemplate",["$templateCache",p]),e=function(){var t;return t="<tg-svg class=\"capslock\" ng-if=\"capslockIcon && iscapsLockActivated\" svg-icon='icon-capslock' svg-title='COMMON.CAPSLOCK_WARNING'></tg-svg>",{template:t}},f.directive("tgCapslock",[e]),o=function(){var t;return t='<a class="close" href="" title="{{\'COMMON.CLOSE\' | translate}}">\n    <tg-svg svg-icon="icon-close"></tg-svg>\n</a>',{template:t}},f.directive("tgLightboxClose",[o]),l=function(){var t;return t='<svg class="{{ \'icon \' + svgIcon }}">\n    <use xlink:href="" ng-attr-xlink:href="{{ \'#\' + svgIcon }}">\n        <title ng-if="svgTitle">{{svgTitle}}</title>\n        <title\n            ng-if="svgTitleTranslate"\n            translate="{{svgTitleTranslate}}"\n            translate-values="{{svgTitleTranslateValues}}"\n            ></title>\n    </use>\n</svg>',{scope:{svgIcon:"@",svgTitle:"@",svgTitleTranslate:"@",svgTitleTranslateValues:"="},template:t}},f.directive("tgSvg",[l])}.call(this),function(){var t,e,r,n,i,o,s=function(t,e){return function(){return t.apply(e,arguments)}};o=this.taiga,i=this.taiga.startswith,r=this.taiga.bindMethods,n=angular.module("taigaEvents",[]),e=function(){function t(t,e,n,i,o,a){this.win=t,this.log=e,this.config=n,this.auth=i,this.liveAnnouncementService=o,this.rootScope=a,this.processMessage=s(this.processMessage,this),r(this)}return t.prototype.initialize=function(t){return this.sessionId=t,this.subscriptions={},this.connected=!1,this.error=!1,this.pendingMessages=[],this.missedHeartbeats=0,this.heartbeatInterval=null,void 0===this.win.WebSocket?this.log.info("WebSockets not supported on your browser"):void 0},t.prototype.setupConnection=function(){var t,e,r,n;return this.stopExistingConnection(),(n=this.config.get("eventsUrl"))?(i(n,"ws:")||i(n,"wss:")||(t=this.win.location,r="https:"===t.protocol?"wss:":"ws:",e=_.trimStart(n,"/"),n=r+"//"+t.host+"/"+e),this.ws=new this.win.WebSocket(n),this.ws.addEventListener("open",this.onOpen),this.ws.addEventListener("message",this.onMessage),this.ws.addEventListener("error",this.onError),this.ws.addEventListener("close",this.onClose)):void 0},t.prototype.stopExistingConnection=function(){return void 0!==this.ws?(this.ws.removeEventListener("open",this.onOpen),this.ws.removeEventListener("close",this.onClose),this.ws.removeEventListener("error",this.onError),this.ws.removeEventListener("message",this.onMessage),this.stopHeartBeatMessages(),this.ws.close(),delete this.ws):void 0},t.prototype.notifications=function(){return this.subscribe(null,"notifications",function(t){return function(e){return t.liveAnnouncementService.show(e.title,e.desc),t.rootScope.$digest()}}(this))},t.prototype.startHeartBeatMessages=function(){var t,e;if(!this.heartbeatInterval)return e=this.config.get("eventsMaxMissedHeartbeats",5),t=this.config.get("eventsHeartbeatIntervalTime",6e4),this.missedHeartbeats=0,this.heartbeatInterval=setInterval(function(t){return function(){var r,n;try{if(t.missedHeartbeats>=e)throw new Error("Too many missed heartbeats PINGs.");return t.missedHeartbeats++,t.sendMessage({cmd:"ping"}),t.log.debug("HeartBeat send PING")}catch(n){return r=n,t.log.error("HeartBeat error: "+r.message),t.stopHeartBeatMessages()}}}(this),t),this.log.debug("HeartBeat enabled")},t.prototype.stopHeartBeatMessages=function(){return this.heartbeatInterval?(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null,this.log.debug("HeartBeat disabled")):void 0},t.prototype.processHeartBeatPongMessage=function(t){return this.missedHeartbeats=0,this.log.debug("HeartBeat recived PONG")},t.prototype.serialize=function(t){return _.isObject(t)?JSON.stringify(t):t},t.prototype.sendMessage=function(t){var e,r,n,i,o;if(this.pendingMessages.push(t),this.connected){for(n=_.map(this.pendingMessages,this.serialize),this.pendingMessages=[],o=[],e=0,r=n.length;r>e;e++)i=n[e],o.push(this.ws.send(i));return o}},t.prototype.processMessage=function(t){var e,r;return e=t.routing_key,null!=this.subscriptions[e]?(r=this.subscriptions[e],r.scope?r.scope.$apply(function(){return r.callback(t.data)}):r.callback(t.data)):void 0},t.prototype.subscribe=function(t,e,r){var n,i;if(!this.error)return this.log.debug("Subscribe to: "+e),i={scope:t,routingKey:e,callback:_.debounce(r,500,{leading:!0,trailing:!1})},n={cmd:"subscribe",routing_key:e},this.subscriptions[e]=i,this.sendMessage(n),t?t.$on("$destroy",function(t){return function(){return t.unsubscribe(e)}}(this)):void 0},t.prototype.unsubscribe=function(t){var e;if(!this.error)return this.log.debug("Unsubscribe from: "+t),e={cmd:"unsubscribe",routing_key:t},this.sendMessage(e)},t.prototype.onOpen=function(){var t,e;return this.connected=!0,this.startHeartBeatMessages(),this.notifications(),this.log.debug("WebSocket connection opened"),e=this.auth.getToken(),t={cmd:"auth",data:{token:e,sessionId:this.sessionId}},this.sendMessage(t)},t.prototype.onMessage=function(t){var e;return this.log.debug("WebSocket message received: "+t.data),e=JSON.parse(t.data),"pong"===e.cmd?this.processHeartBeatPongMessage(e):this.processMessage(e)},t.prototype.onError=function(t){return this.log.error("WebSocket error: "+t),this.error=!0},t.prototype.onClose=function(){return this.log.debug("WebSocket closed."),this.connected=!1,this.stopHeartBeatMessages()},t}(),t=function(){function t(){}return t.prototype.setSessionId=function(t){return this.sessionId=t},t.prototype.$get=function(t,r,n,i,o,s){var a;return a=new e(t,r,n,i,o,s),a.initialize(this.sessionId),a},t.prototype.$get.$inject=["$window","$log","$tgConfig","$tgAuth","tgLiveAnnouncementService","$rootScope"],t}(),n.provider("$tgEvents",t)}.call(this),function(){var t,e,r,n,i,o,s,a;s=this.taiga,n=this.taiga.groupBy,e=this.taiga.bindOnce,i=this.taiga.mixOf,r=this.taiga.debounce,a=this.taiga.trim,o=angular.module("taigaFeedback",[]),t=function(t,e,n,i,o){var s,a;return a=function(o,s,a){var u,c,l,p;return u=s.find("form").checksley(),l=r(2e3,function(r){return function(r){var a,c;return r.preventDefault(),u.validate()?(a=i().target(p).start(),c=e.create("feedback",o.feedback),c.then(function(e){return a.finish(),t.close(s),n.notify("success","\\o/ we'll be happy to read your")}),c.then(null,function(){return a.finish(),n.notify("error")})):void 0}}(this)),p=s.find(".submit-button"),s.on("submit","form",l),c=function(){return o.feedback={},t.open(s),s.find("textarea").focus()},o.$on("$destroy",function(){return s.off()}),c()},s={link:a,templateUrl:"common/lightbox-feedback.html",scope:{}}},o.directive("tgLbFeedback",["lightboxService","$tgRepo","$tgConfirm","$tgLoading","tgFeedbackService",t])}.call(this),function(){var t;t=angular.module("taigaIntegrations",[])}.call(this),function(){var t;t=angular.module("taigaIssues",[])}.call(this),function(){var t;t=angular.module("taigaKanban",[])}.call(this),function(){var t;t=angular.module("taigaPlugins",["ngRoute"])}.call(this),function(){var t;t=angular.module("taigaProject",[])}.call(this),function(){var t,e,r,n,i,o,s,a,u;a=this.taiga,u=this.taiga.trim,o=this.taiga.debounce,s=angular.module("taigaRelatedTasks",[]),n=function(t,e,r,n,i,s,a){var u,c,l;return l=s.get("task/related-task-row.html",!0),c=s.get("task/related-task-row-edit.html",!0),u=function(s,u,p,d){var f,h,m;return m=o(2e3,function(e){var o,s;return e.subject=u.find("input").val(),o=i().target(u.find(".task-name")).start(),s=t.save(e),s.then(function(t){return function(){return o.finish(),n.$broadcast("related-tasks:update")}}(this)),s.then(null,function(t){return function(){return o.finish(),u.find("input").val(e.subject),r.notify("error")}}(this)),s}),f=function(t){return u.html(e(c({task:t}))(s)),u.on("keyup","input",function(t){return 13===t.keyCode?m(d.$modelValue).then(function(){return h(d.$modelValue)}):27===t.keyCode?h(d.$modelValue):void 0}),u.on("click",".save-task",function(t){return m(d.$modelValue).then(function(){return h(d.$modelValue)})}),u.on("click",".cancel-edit",function(t){return h(d.$modelValue)})},h=function(n){var i;return u.off(),i={modify_task:-1!==s.project.my_permissions.indexOf("modify_task"),delete_task:-1!==s.project.my_permissions.indexOf("delete_task")},u.html(e(l({task:n,perms:i}))(s)),u.on("click",".edit-task",function(){return f(d.$modelValue),u.find("input").focus().select()}),u.on("click",".delete-task",function(e){var i,o;return o=a.instant("TASK.TITLE_DELETE_ACTION"),n=d.$modelValue,i=n.subject,r.askOnDelete(o,i).then(function(e){var i;return i=t.remove(n),i.then(function(){return e.finish(),s.$emit("related-tasks:delete")}),i.then(null,function(){return e.finish(!1),r.notify("error")})})})},s.$watch(p.ngModel,function(t){return t?h(t):void 0}),s.$on("related-tasks:assigned-to-changed",function(){return n.$broadcast("related-tasks:update")}),s.$on("related-tasks:status-changed",function(){return n.$broadcast("related-tasks:update")}),s.$on("$destroy",function(){return u.off()})},{link:u,require:"ngModel"}},s.directive("tgRelatedTaskRow",["$tgRepo","$compile","$tgConfirm","$rootScope","$tgLoading","$tgTemplate","$translate",n]),r=function(t,e,r,n,i,o){var s,u;return u={subject:"",assigned_to:null},s=function(e,s,c){var l,p,d,f;return p=function(n){var a,u;return n.subject=s.find("input").val(),n.assigned_to=e.newTask.assigned_to,n.status=e.newTask.status,e.newTask.status=e.project.default_task_status,e.newTask.assigned_to=null,a=i().target(s.find(".task-name")).start(),u=t.create("tasks",n),u.then(function(){return o.trackEvent("task","create","create task on userstory",1),a.finish(),e.$emit("related-tasks:add")}),u.then(null,function(){return s.find("input").val(n.subject),a.finish(),r.notify("error")}),u},l=function(){return s.off(),e.openNewRelatedTask=!1},f=function(){return u={subject:"",assigned_to:null},u.status=e.project.default_task_status,u.project=e.project.id,u.user_story=e.us.id,e.newTask=n.make_model("tasks",u)},d=function(){return e.openNewRelatedTask=!0,s.on("keyup","input",function(t){return 13===t.keyCode?p(u).then(function(){return f(),s.find("input").focus()}):27===t.keyCode?e.$apply(function(){return l()}):void 0})},e.save=function(){return p(u).then(function(){return l()})},a.bindOnce(e,"us",f),e.$on("related-tasks:show-form",function(){return e.$apply(d)}),e.$on("$destroy",function(){return s.off()})},{scope:!0,link:s,templateUrl:"task/related-task-create-form.html"}},s.directive("tgRelatedTaskCreateForm",["$tgRepo","$compile","$tgConfirm","$tgModel","$tgLoading","$tgAnalytics",r]),e=function(t,e,r,n,i){var o,s;return s=i.get("common/components/add-button.html",!0),o=function(t,r,n){return t.$watch("project",function(n){return n?(r.off(),-1!==t.project.my_permissions.indexOf("add_task")?r.html(e(s())(t)):r.html(""),r.on("click",".add-button",function(e){return t.$emit("related-tasks:add-new-clicked")})):void 0}),t.$on("$destroy",function(){return r.off()})},{link:o}},s.directive("tgRelatedTaskCreateButton",["$tgRepo","$compile","$tgConfirm","$tgModel","$tgTemplate",e]),i=function(t,e,r){var n;return n=function(t,n,i){var o,s,u;return u=function(){return e.tasks.list(t.projectId,null,t.usId).then(function(e){return function(e){return t.tasks=_.sortBy(e,"ref"),e}}(this))},s=function(){return t.project?-1!==t.project.my_permissions.indexOf("view_tasks"):!1},o=function(){return t.project?-1!==t.project.my_permissions.indexOf("modify_task"):!1},t.showRelatedTasks=function(){var e;return s()&&(o()||(null!=(e=t.tasks)?e.length:void 0))},t.$on("related-tasks:add",function(){return u().then(function(){return r.$broadcast("related-tasks:update")})}),t.$on("related-tasks:delete",function(){return u().then(function(){return r.$broadcast("related-tasks:update")})}),t.$on("related-tasks:add-new-clicked",function(){return t.$broadcast("related-tasks:show-form")}),a.bindOnce(t,"us",function(t){return u()}),t.$on("$destroy",function(){return n.off()})},{link:n}},s.directive("tgRelatedTasks",["$tgRepo","$tgResources","$rootScope",i]),t=function(t,e,r){var n,i;return i=_.template('<img src="<%- imgurl %>" alt="<%- name %>"/>\n<figcaption><%- name %></figcaption>'),n=function(n,s,u){var c,l,p,d,f;return f=function(t){var e,o;return e={name:r.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png"},o=n.usersById[t.assigned_to],o&&(e.imgurl=o.photo,e.name=o.full_name_display),s.find(".avatar").html(i(e)),s.find(".task-assignedto").attr("title",e.name)},c=s.controller(),d=n.$eval(u.tgRelatedTaskAssignedToInlineEdition),p=n.$eval(u.notAutoSave),l=!p,n.$watch(u.tgRelatedTaskAssignedToInlineEdition,function(){return d=n.$eval(u.tgRelatedTaskAssignedToInlineEdition),f(d)}),f(d),s.on("click",".task-assignedto",function(t){return e.$broadcast("assigned-to:add",d)}),a.bindOnce(n,"project",function(t){return-1===t.my_permissions.indexOf("modify_task")?(s.unbind("click"),s.find("a").addClass("not-clickable")):void 0}),n.$on("assigned-to:added",o(2e3,function(e){return function(e,r,i){return i.id===d.id?(i.assigned_to=r,l&&t.save(i).then(function(){return n.$emit("related-tasks:assigned-to-changed")}),f(i)):void 0}}(this))),n.$on("$destroy",function(){return s.off()})},{link:n}},s.directive("tgRelatedTaskAssignedToInlineEdition",["$tgRepo","$rootScope","$translate",t])}.call(this),function(){var t,e,r,n,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=this.taiga,t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e}(i.Service),o={auth:"/auth","auth-register":"/auth/register",invitations:"/invitations",users:"/users",by_username:"/users/by_username","users-password-recovery":"/users/password_recovery","users-change-password-from-recovery":"/users/change_password_from_recovery","users-change-password":"/users/change_password","users-change-email":"/users/change_email","users-cancel-account":"/users/cancel","user-stats":"/users/%s/stats","user-liked":"/users/%s/liked","user-voted":"/users/%s/voted","user-watched":"/users/%s/watched","user-contacts":"/users/%s/contacts","user-me":"/users/me",permissions:"/permissions","notify-policies":"/notify-policies","user-storage":"/user-storage",memberships:"/memberships","bulk-create-memberships":"/memberships/bulk_create",roles:"/roles",permissions:"/permissions",resolver:"/resolver",projects:"/projects","project-templates":"/project-templates","project-modules":"/projects/%s/modules","bulk-update-projects-order":"/projects/bulk_update_order","project-like":"/projects/%s/like","project-unlike":"/projects/%s/unlike","project-watch":"/projects/%s/watch","project-unwatch":"/projects/%s/unwatch","project-transfer-validate-token":"/projects/%s/transfer_validate_token","project-transfer-accept":"/projects/%s/transfer_accept","project-transfer-reject":"/projects/%s/transfer_reject","project-transfer-request":"/projects/%s/transfer_request","project-transfer-start":"/projects/%s/transfer_start","userstory-statuses":"/userstory-statuses",points:"/points","task-statuses":"/task-statuses","issue-statuses":"/issue-statuses","issue-types":"/issue-types",priorities:"/priorities",severities:"/severities",milestones:"/milestones",userstories:"/userstories","bulk-create-us":"/userstories/bulk_create","bulk-update-us-backlog-order":"/userstories/bulk_update_backlog_order","bulk-update-us-sprint-order":"/userstories/bulk_update_sprint_order","bulk-update-us-kanban-order":"/userstories/bulk_update_kanban_order","userstories-filters":"/userstories/filters_data","userstory-upvote":"/userstories/%s/upvote","userstory-downvote":"/userstories/%s/downvote","userstory-watch":"/userstories/%s/watch","userstory-unwatch":"/userstories/%s/unwatch",tasks:"/tasks","bulk-create-tasks":"/tasks/bulk_create","bulk-update-task-taskboard-order":"/tasks/bulk_update_taskboard_order","task-upvote":"/tasks/%s/upvote","task-downvote":"/tasks/%s/downvote","task-watch":"/tasks/%s/watch","task-unwatch":"/tasks/%s/unwatch",issues:"/issues","bulk-create-issues":"/issues/bulk_create","issues-filters":"/issues/filters_data","issue-upvote":"/issues/%s/upvote","issue-downvote":"/issues/%s/downvote","issue-watch":"/issues/%s/watch","issue-unwatch":"/issues/%s/unwatch",wiki:"/wiki","wiki-restore":"/wiki/%s/restore","wiki-links":"/wiki-links","history/us":"/history/userstory","history/issue":"/history/issue","history/task":"/history/task","history/wiki":"/history/wiki","attachments/us":"/userstories/attachments","attachments/issue":"/issues/attachments","attachments/task":"/tasks/attachments","attachments/wiki_page":"/wiki/attachments","custom-attributes/userstory":"/userstory-custom-attributes","custom-attributes/issue":"/issue-custom-attributes","custom-attributes/task":"/task-custom-attributes","custom-attributes-values/userstory":"/userstories/custom-attributes-values","custom-attributes-values/issue":"/issues/custom-attributes-values","custom-attributes-values/task":"/tasks/custom-attributes-values",webhooks:"/webhooks","webhooks-test":"/webhooks/%s/test",webhooklogs:"/webhooklogs","webhooklogs-resend":"/webhooklogs/%s/resend","userstories-csv":"/userstories/csv?uuid=%s","tasks-csv":"/tasks/csv?uuid=%s","issues-csv":"/issues/csv?uuid=%s","timeline-profile":"/timeline/profile","timeline-user":"/timeline/user","timeline-project":"/timeline/project",search:"/search",exporter:"/exporter",importer:"/importer/load_dump",feedback:"/feedback",locales:"/locales",applications:"/applications","application-tokens":"/application-tokens","stats-discover":"/stats/discover"},r=function(t,e){return t.debug("Initialize api urls"),e.update(o)},e=function(t,e){var r,n,i,o,s;for(t.debug("Initialize resources"),o=_.toArray(arguments).slice(2),s=[],r=0,n=o.length;n>r;r++)i=o[r],s.push(i(e));return s},n=angular.module("taigaResources",["taigaBase"]),n.service("$tgResources",t),n.run(["$log","$tgUrls",r]),n.run(["$log","$tgResources","$tgProjectsResourcesProvider","$tgCustomAttributesResourcesProvider","$tgCustomAttributesValuesResourcesProvider","$tgMembershipsResourcesProvider","$tgNotifyPoliciesResourcesProvider","$tgInvitationsResourcesProvider","$tgRolesResourcesProvider","$tgUserSettingsResourcesProvider","$tgSprintsResourcesProvider","$tgUserstoriesResourcesProvider","$tgTasksResourcesProvider","$tgIssuesResourcesProvider","$tgWikiResourcesProvider","$tgSearchResourcesProvider","$tgMdRenderResourcesProvider","$tgHistoryResourcesProvider","$tgKanbanResourcesProvider","$tgModulesResourcesProvider","$tgWebhooksResourcesProvider","$tgWebhookLogsResourcesProvider","$tgLocalesResourcesProvider","$tgUsersResourcesProvider",e])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p=function(t,e){function r(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},d={}.hasOwnProperty;c=this.taiga,s=this.taiga.groupBy,n=this.taiga.bindOnce,a=this.taiga.mixOf,o=this.taiga.debounceLeading,l=this.taiga.trim,i=this.taiga.debounce,u=angular.module("taigaSearch",[]),e=function(t){function e(t,e,r,i,s,a,u,c,l){var p,d;this.scope=t,this.repo=e,this.rs=r,this.params=i,this.q=s,this.location=a,this.appMetaService=u,this.navUrls=c,this.translate=l,this.scope.sectionName="Search",d=this.loadInitialData(),d.then(function(t){return function(){var e,r;return r=t.translate.instant("SEARCH.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.translate.instant("SEARCH.PAGE_DESCRIPTION",{projectName:t.scope.project.name,projectDescription:t.scope.project.description}),t.appMetaService.setAll(r,e)}}(this)),d.then(null,this.onInitialDataError.bind(this)),this.scope.searchTerm=null,p=o(100,function(t){return function(e){return t.loadSearchData(e)}}(this)),n(this.scope,"projectId",function(t){return function(e){return!t.scope.searchResults&&t.scope.searchTerm?t.loadSearchData():void 0}}(this)),this.scope.$watch("searchTerm",function(t){return function(e){return void 0!==e&&t.scope.projectId?t.loadSearchData(e):void 0}}(this))}return p(e,t),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$translate"],e.prototype.loadFilters=function(){var t;return t=this.q.defer(),t.resolve(),t.promise},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return t.scope.project=e,t.scope.$emit("project:loaded",e),t.scope.issueStatusById=s(e.issue_statuses,function(t){return t.id}),t.scope.taskStatusById=s(e.task_statuses,function(t){return t.id}),t.scope.severityById=s(e.severities,function(t){return t.id}),t.scope.priorityById=s(e.priorities,function(t){return t.id}),t.scope.usStatusById=s(e.us_statuses,function(t){return t.id}),e}}(this))},e.prototype.loadSearchData=function(t){return null==t&&(t=""),this.scope.loading=!0,this._loadSearchData(t).then(function(t){return function(e){return t.scope.searchResults=e,t.scope.loading=!1}}(this))},e.prototype._loadSearchData=function(t){return null==t&&(t=""),this._promise&&this._promise.abort(),this._promise=this.rs.search["do"](this.scope.projectId,t),this._promise},e.prototype.loadInitialData=function(){return this.loadProject().then(function(t){return function(e){return t.scope.projectId=e.id,t.fillUsersAndRoles(e.members,e.roles)}}(this))},e}(a(c.Controller,c.PageMixin)),u.controller("SearchController",e),t=function(t,e,r,n,o){var s;return s=function(s,a,u){var c,l,p;return l=null,p=i(2e3,function(t){return function(t){var i,u,c;return t.preventDefault(),i=a.find("form").checksley(),i.validate()?(u=a.find("#search-text").val(),c=r.resolve("project-search",{project:l.get("slug")}),s.$apply(function(){return e.close(a),n.path(c),n.search("text",u).path(c),o.reload()})):void 0}}(this)),c=function(){return l=t.project,e.open(a).then(function(){return a.find("#search-text").focus()})},a.on("submit","form",p),c()},{templateUrl:"search/lightbox-search.html",link:s}},t.$inject=["tgProjectService","lightboxService","$tgNavUrls","$tgLocation","$route"],u.directive("tgSearchBox",t),r=function(t,e,r,n,i){var o,s;return s=function(t,n,o,s){var a,u,c,p,d,f,h,m,g;return u=!0,a="userstories",m=n.find(".search-filter"),p=null,c=function(t){var e,r,n,i,o,s,c;
if(n=0,s={},s.name="userstories",s.value=[],!u)return s.name=a,s.value=t[a],s;if(t)for(o=["userstories","issues","tasks","wikipages"],e=0,r=o.length;r>e;e++)if(i=o[e],c=t[i],c.length>n){n=c.length,s.name=i,s.value=c;break}return 0===n?s:s},f=function(t){var e,r,n;r=[];for(e in t)n=t[e],m.find("li."+e).show(),r.push(m.find("li."+e+" .num").html(n.length));return r},d=function(t){return m.find("a.active").removeClass("active"),m.find("li."+t.name+" a").addClass("active"),u=!1,a=t.name},g={issues:r.get("search-issues"),tasks:r.get("search-tasks"),userstories:r.get("search-userstories"),wikipages:r.get("search-wikipages")},h=function(r){var i,o,s,a,u;return o=n.find(".search-result-table").children(),s=o.scope(),s&&(s.$destroy(),o.remove()),a=t.$new(),a[r.name]=r.value,u=angular.element.parseHTML(l(g[r.name])),i=e(u)(a),n.find(".search-result-table").html(i)},t.$watch("searchResults",function(t){var e;return(p=t)?(e=c(t),f(t),h(e),d(e)):void 0}),t.$watch("searchTerm",function(t){return void 0!==t?i.search("text",t):void 0}),n.on("click",".search-filter li > a",function(e){var r,n,i,o;return e.preventDefault(),o=angular.element(e.currentTarget),i=o.parent().data("name"),n=p?p[i]:[],r={name:i,value:n},t.$apply(function(){return h(r),d(r)})})},o=function(t,e,r){var i,o;return i=e.controller(),s(t,e,r,i),o=n.text,t.$watch("projectId",function(e){return null!=e?t.searchTerm=o:void 0})},{link:o}},u.directive("tgSearch",["$log","$compile","$templateCache","$routeParams","$tgLocation",r])}.call(this),function(){var t;t=angular.module("taigaTaskboard",[])}.call(this),function(){var t;t=angular.module("taigaTasks",[])}.call(this),function(){var t;t=angular.module("taigaTeam",[])}.call(this),function(){var t;t=angular.module("taigaUserSettings",[])}.call(this),function(){var t;t=angular.module("taigaUserStories",[])}.call(this),function(){var t;t=angular.module("taigaWiki",[])}.call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;r=this.taiga,e=angular.module("taigaCommon"),t=function(t){function e(t,e,r,n,i,o){var s;this.rootscope=t,this.log=e,this.config=r,this.win=n,this.doc=i,this.location=o,this.initialized=!1,s=this.config.get("analytics",{}),this.accountId=s.accountId,this.pageEvent=s.pageEvent||"$routeChangeSuccess",this.trackRoutes=s.trackRoutes||!0,this.ignoreFirstPageLoad=s.ignoreFirstPageLoad||!1}return n(e,t),e.$inject=["$rootScope","$log","$tgConfig","$window","$document","$location"],e.prototype.initialize=function(){return this.accountId?(this.injectAnalytics(),this.win.ga("create",this.accountId,"auto"),this.win.ga("require","displayfeatures"),this.trackRoutes&&!this.ignoreFirstPageLoad&&this.win.ga("send","pageview",this.getUrl()),this.trackRoutes&&this.rootscope.$on(this.pageEvent,function(t){return function(){return t.trackPage(t.getUrl(),"Taiga")}}(this)),this.initialized=!0):void this.log.debug("Analytics: no acount id provided. Disabling.")},e.prototype.getUrl=function(){return this.location.path()},e.prototype.injectAnalytics=function(){var t;return(t=function(t,e,r,n,i,o,s){t.GoogleAnalyticsObject=i,t[i]=t[i]||function(){(t[i].q=t[i].q||[]).push(arguments)},t[i].l=1*new Date,o=e.createElement(r),s=e.getElementsByTagName(r)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)})(window,document,"script","//www.google-analytics.com/analytics.js","ga")},e.prototype.trackPage=function(t,e){return this.initialized&&this.win.ga?(e=e||this.doc[0].title,this.win.ga("send","pageview",{page:t,title:e})):void 0},e.prototype.trackEvent=function(t,e,r,n){return this.initialized&&this.win.ga?this.win.ga("send","event",t,e,r,n):void 0},e}(r.Service),e.service("$tgAnalytics",t)}.call(this),function(){var t,e;e=angular.module("taigaCommon"),t=function(t){var e;return t.debugInfo||(jQuery.fn.scope=function(){return this.data("scope")}),e=function(e,r){return t.debugInfo?void 0:r.data("scope",e).addClass("tg-scope")},{link:e}},e.directive("tgBindScope",["$tgConfig",t])}.call(this),function(){var t;t=function(t){var e;return e=function(e,r,n){return e.$watch(n.tgCompileHtml,function(n,i){return r.html(n),t(r.contents())(e)})},{link:e}},t.$inject=["$compile"],angular.module("taigaCommon").directive("tgCompileHtml",t)}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m,g,v,y,b,S,k,j;j=this.taiga,S=this.taiga.bindOnce,k=angular.module("taigaCommon"),n=function(t){var e,r;return r=function(e,r,n){var i,o,s;return s=t.instant("BACKLOG.SPRINTS.DATE"),o=moment(r).format(s),i=moment(n).format(s),e.html(o+"-"+i)},e=function(t,e,n){var i,o,s;return o=n.tgDateRange.split(","),i=o[0],s=o[1],S(t,i,function(n){return S(t,s,function(t){return r(e,n,t)})})},{link:e}},k.directive("tgDateRange",["$translate",n]),i=function(t,e){var r;return r=function(r,n,i,o){var s,a,u;return a=null,s=function(){var t;return t=e.get(),_.merge(t,{field:n[0],onSelect:function(t){return function(t){return a=t}}(this),onOpen:function(t){return function(){return null!=a?n.picker.setDate(a):void 0}}(this)}),n.picker=new Pikaday(t)},u=t.$on("$translateChangeEnd",function(t){return function(t){return s()}}(this)),r.$watch(i.ngModel,function(t){return null==t||n.picker||s(),null!=t?n.picker.setDate(t):void 0}),r.$on("$destroy",function(){return n.off(),u()})},{link:r,require:"ngModel"}},k.directive("tgDateSelector",["$rootScope","tgDatePickerConfigService",i]),g=function(){var t,e;return e=function(t,e,r){return t.hasClass(".current-progress")?t.css("width",e+"%"):(t.find(".current-progress").css("width",r+"%"),t.find(".number").html(e+" %"))},t=function(t,r,n){return S(t,n.tgSprintProgressbar,function(t){var n,i,o,s;return n=t.closed_points,o=t.total_points,i=0,0!==o&&(i=Math.round(100*(n/o))),s=0,0!==o&&(s=Math.round(98*(n/o))),e(r,i,s)}),t.$on("$destroy",function(){return r.off()})},{link:t}},k.directive("tgSprintProgressbar",g),r=function(t,e,r,n){var i;return i=function(t,e,i){return S(t,i.ngModel,function(e){var i;return null!=e?(t.owner=e.owner_extra_info||{full_name_display:r.instant("COMMON.EXTERNAL_USER"),photo:"/"+window._version+"/images/user-noimage.png"},t.url=(null!=(i=t.owner)?i.is_active:void 0)?n.resolve("user-profile",{username:t.owner.username}):"",t.date=moment(e.created_date).format(r.instant("COMMON.DATETIME"))):void 0}),t.$on("$destroy",function(){return e.off()})},{link:i,restrict:"EA",require:"ngModel",scope:!0,templateUrl:"common/components/created-by.html"}},k.directive("tgCreatedByDisplay",["$tgTemplate","$compile","$translate","$tgNavUrls",r]),b=function(t,e,r,n,i,o,s){var a,u;return u=i.get("common/components/watchers.html",!0),a=function(r,i,a,c){var l,p,d,f;return p=function(){var t,e;return-1!==(null!=(t=r.project)&&null!=(e=t.my_permissions)?e.indexOf(a.requiredPerm):void 0)},f=function(i){var o;return o=n.save(function(t){return t.watchers=i,t}),o.then(function(){return i=_.map(i,function(t){return r.usersById[t]}),d(i),t.$broadcast("object:updated")}),o.then(null,function(){return e.notify("error")})},l=function(i){var o;return o=n.save(function(t){return t.watchers=i,t}),o.then(function(){var e,i;return e=n.getObj(),i=_.map(e.watchers,function(t){return r.usersById[t]}),d(i),t.$broadcast("object:updated")}),o.then(null,function(){return item.revert(),e.notify("error")})},d=function(t){var e,n;return e={watchers:t,isEditable:p()},n=o(u(e))(r),i.html(n)},i.on("click",".js-delete-watcher",function(t){var n,i,o,a;return t.preventDefault(),p()?(i=angular.element(t.currentTarget),a=i.data("watcher-id"),o=s.instant("COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER"),n=r.usersById[a].full_name_display,e.askOnDelete(o,n).then(function(t){return function(t){var e;return t.finish(),e=_.clone(c.$modelValue.watchers,!1),e=_.pull(e,a),l(e)}}(this))):void 0}),r.$on("watcher:added",function(t,e){var r;return r=_.clone(c.$modelValue.watchers,!1),r.push(e),r=_.uniq(r),f(r)}),r.$watch(a.ngModel,function(t){var e;if(null!=t)return e=_.map(t.watchers,function(t){return r.usersById[t]}),d(e)}),r.$on("$destroy",function(){return i.off()})},{link:a,require:"ngModel"}},k.directive("tgWatchers",["$rootScope","$tgConfirm","$tgRepo","$tgQueueModelTransformation","$tgTemplate","$compile","$translate",b]),t=function(t,e,r,n,i,o,s,a,u){var c,l;return l=o.get("common/components/assigned-to.html",!0),c=function(r,o,c,p){var d,f,h;return d=function(){var t,e;return-1!==(null!=(t=r.project)&&null!=(e=t.my_permissions)?e.indexOf(c.requiredPerm):void 0)},h=function(r){var s,a,u;return a=p.$modelValue.clone(),a.assigned_to=r,s=n().target(o).start(),u=i.save(function(t){return t.assigned_to=r,t}),u.then(function(){return s.finish(),f(i.getObj()),t.$broadcast("object:updated")}),u.then(null,function(){return e.notify("error"),s.finish()}),u},f=function(t){var e,n,i,c,p,f;return null!=(null!=t?t.assigned_to:void 0)?(n=t.assigned_to_extra_info.full_name_display,f=t.assigned_to_extra_info.photo,p=!1):(n=s.instant("COMMON.ASSIGNED_TO.ASSIGN"),f="/"+window._version+"/images/unnamed.png",p=!0),c=null!=t?t.is_iocaine:void 0,e={fullName:n,photo:f,isUnassigned:p,isEditable:d(),isIocaine:c,fullNameVisible:!(p&&!u.isAuthenticated())},i=a(l(e))(r),o.html(i)},o.on("click",".user-assigned",function(e){return e.preventDefault(),d()?r.$apply(function(){return t.$broadcast("assigned-to:add",p.$modelValue)}):void 0}),o.on("click",".assign-to-me",function(t){return t.preventDefault(),d()?(p.$modelValue.assigned_to=u.getUser().get("id"),h(u.getUser().get("id"))):void 0}),o.on("click",".remove-user",function(t){var r;return t.preventDefault(),d()?(r=s.instant("COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED"),e.ask(r).then(function(t){return function(t){return t.finish(),p.$modelValue.assigned_to=null,h(null)}}(this))):void 0}),r.$on("assigned-to:added",function(t,e,r){return r.id===p.$modelValue.id?h(e):void 0}),r.$watch(c.ngModel,function(t){return f(t)}),r.$on("$destroy",function(){return o.off()})},{link:c,require:"ngModel"}},k.directive("tgAssignedTo",["$rootScope","$tgConfirm","$tgRepo","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$translate","$compile","tgCurrentUserService",t]),e=function(t,e,r){var n,i;return i=r.get("common/components/block-button.html"),n=function(r,n,i,o){var s;return s=function(){return-1!==r.project.my_permissions.indexOf("modify_us")},r.$watch(i.ngModel,function(t){return t?(s()&&n.find(".item-block").addClass("editable"),t.is_blocked?(n.find(".item-block").removeClass("is-active"),n.find(".item-unblock").addClass("is-active")):(n.find(".item-block").addClass("is-active"),n.find(".item-unblock").removeClass("is-active"))):void 0}),n.on("click",".item-block",function(e){return e.preventDefault(),t.$broadcast("block",o.$modelValue)}),n.on("click",".item-unblock",function(r){var i,s;return r.preventDefault(),i=e().target(n.find(".item-unblock")).start(),s=function(){return i.finish()},t.$broadcast("unblock",o.$modelValue,s)}),r.$on("$destroy",function(){return n.off()})},{link:n,restrict:"EA",require:"ngModel",template:i}},k.directive("tgBlockButton",["$rootScope","$tgLoading","$tgTemplate",e]),o=function(t,e,r,n,i){var o,s;return s=i.get("common/components/delete-button.html"),o=function(i,o,s,a){return s.onDeleteGoToUrl?s.onDeleteTitle?(o.on("click",".button-delete",function(t){var o,u;return u=s.onDeleteTitle,o=a.$modelValue.subject,r.askOnDelete(u,o).then(function(t){return function(t){var o;return o=e.remove(a.$modelValue),o.then(function(){var e;return t.finish(),e=i.$eval(s.onDeleteGoToUrl),n.path(e)}),o.then(null,function(){return t.finish(!1),r.notify("error")})}}(this))}),i.$on("$destroy",function(){return o.off()})):t.error("DeleteButtonDirective requires on-delete-title set in scope."):t.error("DeleteButtonDirective requires on-delete-go-to-url set in scope.")},{link:o,restrict:"EA",require:"ngModel",template:s}},k.directive("tgDeleteButton",["$log","$tgRepo","$tgConfirm","$tgLocation","$tgTemplate",o]),a=function(t,e,r,n,i,o){var s,a;return a=o.get("common/components/editable-subject.html"),s=function(e,o,s,a){var u,c;return e.$on("object:updated",function(){return o.find(".edit-subject").hide(),o.find(".view-subject").show()}),u=function(){return-1!==e.project.my_permissions.indexOf(s.requiredPerm)},c=function(e){var s,a;return s=n().target(o.find(".save-container")).start(),a=i.save(function(t){return t.subject=e,t}),a.then(function(e){return function(){return r.notify("success"),t.$broadcast("object:updated"),o.find(".edit-subject").hide(),o.find(".view-subject").show()}}(this)),a.then(null,function(){return r.notify("error")}),a["finally"](function(){return s.finish()}),a},o.click(function(){return u()?(o.find(".edit-subject").show(),o.find(".view-subject").hide(),o.find("input").focus()):void 0}),o.on("click",".save",function(t){var r;return t.preventDefault(),r=e.item.subject,c(r)}),o.on("keyup","input",function(t){var r;return 13===t.keyCode?(r=e.item.subject,c(r)):27===t.keyCode?(e.$apply(function(t){return function(){return a.$modelValue.revert()}}(this)),o.find(".edit-subject").hide(),o.find(".view-subject").show()):void 0}),o.find(".edit-subject").hide(),e.$watch(s.ngModel,function(t){return t?(e.item=t,u()?void 0:o.find(".view-subject .edit").remove()):void 0}),e.$on("$destroy",function(){return o.off()})},{link:s,restrict:"EA",require:"ngModel",template:a}},k.directive("tgEditableSubject",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate",a]),s=function(t,e,r,n,i,o,s,a,u){var c,l,p,d;return d=a.get("common/components/editable-description.html"),l=a.get("common/components/editable-description-msg-edit-mode.html"),p=a.get("common/components/editable-description-msg-read-mode.html"),c=function(e,a,c,d){var f,h,m;return a.find(".edit-description").hide(),a.find(".view-description .edit").hide(),e.$on("object:updated",function(){return a.find(".edit-description").hide(),a.find(".view-description").show()}),h=function(){return-1!==e.project.my_permissions.indexOf(c.requiredPerm)},m=function(e){var n,o;return n=i().target(a.find(".save-container")).start(),o=s.save(function(t){return t.description=e,t}),o.then(function(){return r.notify("success"),t.$broadcast("object:updated"),a.find(".edit-description").hide(),a.find(".view-description").show()}),o.then(null,function(){return r.notify("error")}),o["finally"](function(){return n.finish()})},f=function(){return e.item.revert(),a.find(".edit-description").hide(),a.find(".view-description").show()},a.on("mouseup",".view-description",function(t){var e;return e=angular.element(t.target),!h()||e.is("a")||o.get().length?void 0:(a.find(".edit-description").show(),a.find(".view-description").hide(),a.find("textarea").focus())}),a.on("click","a",function(t){var e,r;return r=angular.element(t.target),e=r.attr("href"),0===e.indexOf("#")?(t.preventDefault(),$("body").scrollTop($(e).offset().top)):void 0}),a.on("click",".save",function(t){var r;return t.preventDefault(),r=e.item.description,m(r)}),a.on("keydown","textarea",function(t){return 27===t.keyCode?e.$applyAsync(function(){var t,e;return e=u.instant("COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE"),t=u.instant("COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE"),r.ask(e,null,t).then(function(t){return f(),t.finish()})}):void 0}),e.$watch(c.ngModel,function(t){return t?(e.item=t,h()?(a.find(".view-description .edit").show(),a.find(".view-description .us-content").addClass("editable"),e.noDescriptionMsg=n(l)(e)):e.noDescriptionMsg=n(p)(e)):void 0}),e.$on("$destroy",function(){return a.off()})},{link:c,restrict:"EA",require:"ngModel",template:d}},k.directive("tgEditableDescription",["$rootScope","$tgRepo","$tgConfirm","$compile","$tgLoading","$selectedText","$tgQueueModelTransformation","$tgTemplate","$translate",s]),u=function(t,e){var r;return r=function(r,n,i,o){var s,a;return s=function(){return n.find("textarea").is(":visible")&&o.$modelValue.id},a=function(r,n){return t.validate(r)?e.addAttachment(o.$modelValue.project,o.$modelValue.id,n,r).then(function(t){return j.isImage(t.getIn(["file","name"]))?"!["+t.getIn(["file","name"])+"]("+t.getIn(["file","url"])+")":"["+t.getIn(["file","name"])+"]("+t.getIn(["file","url"])+")"}):void 0},n.on("dragover",function(t){var e;return e=n.find("textarea").focus(),!1}),n.on("drop",function(t){var e,r,i,u;return t.stopPropagation(),t.preventDefault(),s()?(e=t.dataTransfer||t.originalEvent&&t.originalEvent.dataTransfer,i=n.find("textarea"),i.addClass("in-progress"),u=o.$modelValue._name,"userstories"===u?u="us":"tasks"===u?u="task":"issues"===u?u="issue":"wiki"===u&&(u="wiki_page"),r=_.map(e.files,function(t){return a(t,u)}),Promise.all(r).then(function(t){return i=n.find("textarea"),$.markItUp({replaceWith:t.join(" ")}),i.removeClass("in-progress")})):void 0})},{link:r,restrict:"EA",require:"ngModel"}},k.directive("tgEditableWysiwyg",["tgAttachmentsService","tgAttachmentsFullService",u]),m=function(){var t;return t=function(t,e,r){var n;return n=t.$eval(r.tgListitemUsStatus),S(t,"usStatusById",function(t){return e.html(t[n.status].name)})},{link:t}},k.directive("tgListitemUsStatus",m),f=function(){var t;return t=function(t,e,r){var n;return n=t.$eval(r.tgListitemTaskStatus),S(t,"taskStatusById",function(t){return e.html(t[n.status].name)})},{link:t}},k.directive("tgListitemTaskStatus",f),c=function(t,e){var r,n;return n=t.get("common/components/list-item-assigned-to-avatar.html",!0),r=function(t,r,i){return S(t,"usersById",function(o){var s,a,u;return a=t.$eval(i.tgListitemAssignedto),s={name:e.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png"},u=o[a.assigned_to],u&&(s.imgurl=u.photo,s.name=u.full_name_display),r.html(n(s))})},{link:r}},k.directive("tgListitemAssignedto",["$tgTemplate","$translate",c]),l=function(){var t;return t=function(t,e,r){var n;return n=t.$eval(r.tgListitemIssueStatus),S(t,"issueStatusById",function(t){return e.html(t[n.status].name)})},{link:t}},k.directive("tgListitemIssueStatus",l),h=function(){var t;return t=function(t,e,r){var n;return n=function(t,r){var n,i;return i=t[r.type],n=e.find(".level"),n.css("background-color",i.color),n.attr("title",i.name)},S(t,"issueTypeById",function(e){var i;return i=t.$eval(r.tgListitemType),n(e,i)}),t.$watch(r.tgListitemType,function(e){return n(t.issueTypeById,e)})},{link:t,templateUrl:"common/components/level.html"}},k.directive("tgListitemType",h),p=function(){var t;return t=function(t,e,r){var n;return n=function(t,r){var n,i;return i=t[r.priority],n=e.find(".level"),n.css("background-color",i.color),n.attr("title",i.name)},S(t,"priorityById",function(e){var i;return i=t.$eval(r.tgListitemPriority),n(e,i)}),t.$watch(r.tgListitemPriority,function(e){return n(t.priorityById,e)})},{link:t,templateUrl:"common/components/level.html"}},k.directive("tgListitemPriority",p),d=function(){var t;return t=function(t,e,r){var n;return n=function(t,r){var n,i;return i=t[r.severity],n=e.find(".level"),n.css("background-color",i.color),n.attr("title",i.name)},S(t,"severityById",function(e){var i;return i=t.$eval(r.tgListitemSeverity),n(e,i)}),t.$watch(r.tgListitemSeverity,function(e){return n(t.severityById,e)})},{link:t,templateUrl:"common/components/level.html"}},k.directive("tgListitemSeverity",d),y=function(t){var e,r,n;return n=t.get("common/components/progress-bar.html",!0),r=function(t,e){return t.html(n({percentage:e}))},e=function(t,e,n){var i;return i=angular.element(e),t.$watch(n.tgProgressBar,function(t){return t=_.max([0,t]),t=_.min([100,t]),r(e,t)}),t.$on("$destroy",function(){return e.off()})},{link:e}},k.directive("tgProgressBar",["$tgTemplate",y]),v=function(t){var e;return e=function(t,e,r){return r.$observe("i18nSectionName",function(e){return t.sectionName=e}),t.$on("$destroy",function(){return e.off()})},{link:e,templateUrl:"common/components/main-title.html",scope:{projectName:"=projectName"}}},k.directive("tgMainTitle",["$translate",v])}.call(this),function(){var t,e,r,n,i,o,s,a,u=function(t,e){function r(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=this.taiga,a=this.taiga.timeout,n=this.taiga.cancelTimeout,i=this.taiga.debounce,r=this.taiga.bindMethods,e={success:{title:"NOTIFICATION.OK",message:"NOTIFICATION.SAVED"},error:{title:"NOTIFICATION.WARNING",message:"NOTIFICATION.WARNING_TEXT"},"light-error":{title:"NOTIFICATION.WARNING",message:"NOTIFICATION.WARNING_TEXT"}},t=function(t){function o(t,e,n,i){this.q=t,this.lightboxService=e,this.loading=n,this.translate=i,r(this)}return u(o,t),o.$inject=["$q","lightboxService","$tgLoading","$translate"],o.prototype.hide=function(t){return t?(this.lightboxService.close(t),t.off(".confirm-dialog")):void 0},o.prototype.ask=function(t,e,r,n){var o,s;return null==n&&(n=".lightbox-generic-ask"),o=this.q.defer(),s=angular.element(n),t&&s.find(".title").text(t),e&&s.find(".subtitle").text(e),r&&s.find(".message").text(r),s.on("click.confirm-dialog",".button-green",i(2e3,function(t){return function(e){var r,n;return e.preventDefault(),n=angular.element(e.currentTarget),r=t.loading().target(n).start(),o.resolve({finish:function(e){return null==e&&(e=!0),r.finish(),e?t.hide(s):void 0}})}}(this))),s.on("click.confirm-dialog",".button-red",function(t){return function(e){return e.preventDefault(),o.reject(),t.hide(s)}}(this)),this.lightboxService.open(s),o.promise},o.prototype.askOnDelete=function(t,e){return this.ask(t,this.translate.instant("NOTIFICATION.ASK_DELETE"),e)},o.prototype.askChoice=function(t,e,r,n,o,s){var a,u,c;return null==s&&(s=".lightbox-ask-choice"),u=this.q.defer(),c=angular.element(s),c.find(".title").text(t),c.find(".subtitle").text(e),n?c.find(".replacement").text(n):c.find(".replacement").remove(),o?c.find(".warning").text(o):c.find(".warning").remove(),a=c.find(".choices"),a.html(""),_.each(r,function(t,e){return t=_.escape(t),a.append(angular.element("<option value='"+e+"'>"+t+"</option>"))}),c.on("click.confirm-dialog","a.button-green",i(2e3,function(t){return function(e){var r,n;return e.preventDefault(),n=angular.element(e.currentTarget),r=t.loading().target(n).start(),u.resolve({selected:a.val(),finish:function(e){return null==e&&(e=!0),r.finish(),e?t.hide(c):void 0}})}}(this))),c.on("click.confirm-dialog",".button-red",function(t){return function(e){return e.preventDefault(),u.reject(),t.hide(c)}}(this)),this.lightboxService.open(c),u.promise},o.prototype.error=function(t){var e,r;return e=this.q.defer(),r=angular.element(".lightbox-generic-error"),r.find(".title").html(t),r.on("click.confirm-dialog",".button-green",function(t){return function(n){return n.preventDefault(),e.resolve(),t.hide(r)}}(this)),r.on("click.confirm-dialog",".close",function(t){return function(n){return n.preventDefault(),e.resolve(),t.hide(r)}}(this)),this.lightboxService.open(r),e.promise},o.prototype.success=function(t,e,r){var n,i,o,a,u;return n=this.q.defer(),o=angular.element(".lightbox-generic-success"),o.find("img").remove(),o.find("svg").remove(),r&&("img"===r.type?i=$("<img>").addClass("lb-icon").attr("src",r.name):"svg"===r.type&&(i=document.createElement("div"),s.addClass(i,"icon"),s.addClass(i,r.name),s.addClass(i,"lb-icon"),a=document.createElementNS("http://www.w3.org/2000/svg","svg"),u=document.createElementNS("http://www.w3.org/2000/svg","use"),u.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+r.name),i.appendChild(a).appendChild(u)),i&&o.find("section").prepend(i)),t&&o.find(".title").html(t),e&&o.find(".message").html(e),o.on("click.confirm-dialog",".button-green",function(t){return function(e){return e.preventDefault(),n.resolve(),t.hide(o)}}(this)),o.on("click.confirm-dialog",".close",function(t){return function(e){return e.preventDefault(),n.resolve(),t.hide(o)}}(this)),this.lightboxService.open(o),n.promise},o.prototype.loader=function(t,e){var r;return r=angular.element(".lightbox-generic-loading"),t&&r.find(".title").html(t),e&&r.find(".message").html(e),{start:function(t){return function(){return t.lightboxService.open(r)}}(this),stop:function(t){return function(){return t.lightboxService.close(r)}}(this),update:function(t){return function(t,e,n,i){return e&&r.find(".title").html(e),n&&r.find(".message").html(n),i?(r.find(".spin").addClass("hidden"),r.find(".progress-bar-wrapper").removeClass("hidden"),r.find(".progress-bar-wrapper > .bar").width(i+"%"),r.find(".progress-bar-wrapper > span").html(i+"%").css("left",i-9+"%")):(r.find(".spin").removeClass("hidden"),r.find(".progress-bar-wrapper").addClass("hidden"))}}(this)}},o.prototype.notify=function(t,r,i,o){var s,u,c;return c=".notification-message-"+t,u=angular.element(c),u.hasClass("active")?void 0:(i?u.find("h4").html(i):u.find("h4").html(this.translate.instant(e[t].title)),r?u.find("p").html(r):u.find("p").html(this.translate.instant(e[t].message)),s=angular.element("body"),s.find(".notification-message .notification-light").removeClass("active").addClass("inactive"),s.find(c).removeClass("inactive").addClass("active"),this.tsem&&n(this.tsem),o||(o="error"===t||"light-error"===t?3500:1500),this.tsem=a(o,function(t){return function(){return s.find(c).removeClass("active").addClass("inactive").one("animationend",function(){return $(this).removeClass("inactive")}),delete t.tsem}}(this)),u.on("click",".icon-close, .close",function(t){return function(t){return s.find(c).removeClass("active").addClass("inactive")}}(this)))},o}(s.Service),o=angular.module("taigaCommon"),o.service("$tgConfirm",t)}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h=function(t,e){function r(){this.constructor=t}for(var n in e)m.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},m={}.hasOwnProperty;f=this.taiga,u=this.taiga.bindMethods,c=this.taiga.bindOnce,l=this.taiga.debounce,p=f.generateHash,d=angular.module("taigaCommon"),o="text",i="multiline",n="date",a="url",s=[{key:o,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT"},{key:i,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI"},{key:n,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE"},{key:a,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL"}],e=function(t){function e(t,e,r,n,i,o){this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.confirm=i,this.q=o,u(this),this.type=null,this.objectId=null,this.projectId=null,this.customAttributes=[],this.customAttributesValues=null}return h(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$tgConfirm","$q"],e.prototype.initialize=function(t,e){return this.project=this.scope.project,this.type=t,this.objectId=e,this.projectId=this.scope.projectId},e.prototype.loadCustomAttributesValues=function(){return this.objectId?this.rs.customAttributesValues[this.type].get(this.objectId).then(function(t){return function(e){return t.customAttributes=t.project[t.type+"_custom_attributes"],t.customAttributesValues=e,e}}(this)):this.customAttributesValues},e.prototype.getAttributeValue=function(t){var e;return e=_.clone(t,!1),e.value=this.customAttributesValues.attributes_values[t.id],e},e.prototype.updateAttributeValue=function(t){var e,r,n;return n=function(t){return function(){return t.rootscope.$broadcast("custom-attributes-values:edit")}}(this),r=function(t){return function(e){return t.confirm.notify("error"),t.q.reject()}}(this),e=_.clone(this.customAttributesValues.attributes_values,!0),e[t.id]=t.value,this.customAttributesValues.attributes_values=e,this.customAttributesValues.id=this.objectId,this.repo.save(this.customAttributesValues).then(n,r)},e}(f.Controller),r=function(t,r){var n,i,o,s;return o=t.get("custom-attributes/custom-attributes-values.html",!0),n=function(t){return p(["custom-attributes-collapsed",t])},i=function(t,e,i,o){var s,a;return s=o[0],a=o[1],c(t,i.ngModel,function(t){return s.initialize(i.type,t.id),s.loadCustomAttributesValues()}),e.on("click",".custom-fields-header .collapse",function(){var t,o;return o=n(i.type),t=!r.get(o),r.set(o,t),t?(e.find(".custom-fields-header .icon").removeClass("open"),e.find(".custom-fields-body").removeClass("open")):(e.find(".custom-fields-header .icon").addClass("open"),e.find(".custom-fields-body").addClass("open"))}),t.$on("$destroy",function(){return e.off()})},s=function(t,e){var i;return i=r.get(n(e.type))||!1,o({requiredEditionPerm:e.requiredEditionPerm,collapsed:i})},{require:["tgCustomAttributesValues","ngModel"],controller:e,controllerAs:"ctrl",restrict:"AE",scope:!0,link:i,template:s}},d.directive("tgCustomAttributesValues",["$tgTemplate","$tgStorage","$translate",r]),t=function(t,e,r,i,o){var s,a,u;return a=t.get("custom-attributes/custom-attribute-value.html",!0),u=t.get("custom-attributes/custom-attribute-value-edit.html",!0),s=function(t,s,c,p){var d,f,h,m,g,v;return h=i.instant("COMMON.PICKERDATE.FORMAT"),m=function(e,i){var c,l,p,d,m;return null==i&&(i=!1),m=e.type===n&&e.value?moment(e.value,"YYYY-MM-DD").format(h):e.value,p=f(),c={id:e.id,name:e.name,description:e.description,value:m,isEditable:p,type:e.type},!p||!i&&m?(d=a(c),d=r(d)(t),s.html(d)):(d=u(c),d=r(d)(t),s.html(d),e.type===n?(l=o.get(),_.merge(l,{field:s.find("input[name=value]")[0],onSelect:function(t){return function(t){var e;return e=t}}(this),onOpen:function(t){return function(){return"undefined"!=typeof selectedDate&&null!==selectedDate?s.picker.setDate(selectedDate):void 0}}(this)}),s.picker=new Pikaday(l)):void 0)},f=function(){var e,r;return e=t.project.my_permissions,r=c.requiredEditionPerm,e.indexOf(r)>-1},v=l(2e3,function(e){return function(e){var r,i;return e.preventDefault(),r=s.find("form").checksley(),r.validate()?(i=s.find("input[name=value], textarea[name='value']"),d.value=i.val(),d.type===n&&moment(d.value,h).isValid()&&(d.value=moment(d.value,h).format("YYYY-MM-DD")),t.$apply(function(){return p.updateAttributeValue(d).then(function(){return m(d,!1)})})):void 0}}(this)),g=function(){return s.find("input[name='value'], textarea[name='value']").focus().select()},d=t.$eval(c.tgCustomAttributeValue),m(d),s.on("click",".js-value-view-mode span a",function(t){return t.stopPropagation()}),s.on("click",".js-value-view-mode",function(){return f()&&!e.get().length?(m(d,!0),g()):void 0}),s.on("click",".js-edit-description",function(t){return t.preventDefault(),m(d,!0),g()}),s.on("keyup","input[name=value], textarea[name='value']",function(t){return 13===t.keyCode&&"textarea"!==t.currentTarget.type?v(t):27===t.keyCode?m(d,!1):void 0}),s.on("submit","form",v),s.on("click",".js-save-description",v),t.$on("$destroy",function(){return s.off()})},{link:s,require:"^tgCustomAttributesValues",restrict:"AE"}},d.directive("tgCustomAttributeValue",["$tgTemplate","$selectedText","$compile","$translate","tgDatePickerConfigService",t])}.call(this),function(){var t,e,r,n,i,o,s=function(t,e){return function(){return t.apply(e,arguments)}};o=this.taiga,n=this.taiga.groupBy,i=angular.module("taigaCommon"),e=function(t,e,r,n,i){var o;return o=function(e,r,o,s){return e.$watch(o.ngModel,function(o){var a;return o?(a=t.create(r,o,e.project),a.onSelectedPointForRole=function(t,r,n){return o.points=n,a.render(),e.$apply(function(){return s.$setViewValue(o)})},a.render=function(){var t,r,o,s;return t={totalPoints:this.calculateTotalPoints(),roles:this.calculateRoles(),editable:this.isEditable},o="common/estimation/us-estimation-points-per-role.html",s=n.get(o,!0),r=s(t),r=i(r)(e),this.$el.html(r)},a.render()):void 0}),e.$on("$destroy",function(){return r.off()})},{link:o,restrict:"EA",require:"ngModel"}},i.directive("tgLbUsEstimation",["$tgEstimationsService","$rootScope","$tgRepo","$tgTemplate","$compile",e]),r=function(t,e,r,n,i,o,s){var a;return a=function(r,a,u,c){var l;return l=function(t){var e,r;return r=o.save(function(e){return function(e){return e.points=t,e}}(this)),e=function(t){return function(){return s.notify("error")}}(this),r.then(null,e)},r.$watchCollection(function(){return c.$modelValue&&c.$modelValue.points},function(){var o,s;return s=c.$modelValue,s?(o=t.create(a,s,r.project),o.onSelectedPointForRole=function(t,r,n){
return l(n).then(function(){return e.$broadcast("object:updated")})},o.render=function(){var t,e,o,s;return t={totalPoints:this.calculateTotalPoints(),roles:this.calculateRoles(),editable:this.isEditable},o="common/estimation/us-estimation-points-per-role.html",s=n.get(o,!0),e=s(t),e=i(e)(r),this.$el.html(e)},o.render()):void 0}),r.$on("$destroy",function(){return a.off()})},{link:a,restrict:"EA",require:"ngModel"}},i.directive("tgUsEstimation",["$tgEstimationsService","$rootScope","$tgRepo","$tgTemplate","$compile","$tgQueueModelTransformation","$tgConfirm",r]),t=function(t,e,r,i,o){var a,u,c;return c=t.get("common/estimation/us-estimation-points.html",!0),a=function(){function t(t,e,r){this.$el=t,this.us=e,this.project=r,this.bindClickEvents=s(this.bindClickEvents,this),this.isEditable=-1!==this.project.my_permissions.indexOf("modify_us"),this.roles=this.project.roles,this.points=this.project.points,this.pointsById=n(this.points,function(t){return t.id}),this.onSelectedPointForRole=function(t,e){},this.render=function(){}}return t.prototype.save=function(t,n){var s;return s=i.defer(),o.add(function(t){return function(){var n,i;return i=function(){return s.resolve()},n=function(){return r.notify("error"),t.us.revert(),t.render(),s.reject()},e.save(t.us).then(i,n)}}(this)),s.promise},t.prototype.calculateTotalPoints=function(){var t,e;return e=_.map(this.us.points,function(t){return function(e,r){var n;return null!=(n=t.pointsById[e])?n.value:void 0}}(this)),0===e.length?"?":(t=_.filter(e,function(t){return null!=t}),0===t.length?"?":_.reduce(t,function(t,e){return t+e}))},t.prototype.calculateRoles=function(){var t,e;return t=_.filter(this.project.roles,"computable"),e=_.map(t,function(t){return function(e){var r,n;return r=t.us.points[e.id],n=t.pointsById[r],e=_.clone(e,!0),e.points=null!=n&&null!=n.name?n.name:"?",e}}(this))},t.prototype.bindClickEvents=function(){return this.$el.on("click",".total.clickable",function(t){return function(e){var r,n;return e.preventDefault(),e.stopPropagation(),n=angular.element(e.currentTarget),r=n.data("role-id"),t.renderPointsSelector(r,n),n.siblings().removeClass("active"),n.addClass("active")}}(this)),this.$el.on("click",".point",function(t){return function(e){var r,n,i,o;return e.preventDefault(),e.stopPropagation(),o=angular.element(e.currentTarget),i=o.data("role-id"),r=o.data("point-id"),t.$el.find(".popover").popover().close(),n=_.clone(t.us.points,!0),n[i]=r,t.onSelectedPointForRole(i,r,n)}}(this))},t.prototype.renderPointsSelector=function(t,e){var r,n,i,o,s;return o=_.map(this.points,function(e){return function(r){return r=_.clone(r,!0),r.selected=e.us.points[t]!==r.id,r}}(this)),i=5,r=_.some(o,function(t){return function(t){return t.name.length>i}}(this)),n=c({points:o,roleId:t,horizontal:r}),this.$el.find(".popover").popover().close(),this.$el.find(".pop-points-open").remove(),null!=e?this.$el.find(e).append(n):this.$el.append(n),this.$el.find(".pop-points-open").popover().open(function(){return $(this).removeClass("active").closest("li").removeClass("active")}),this.$el.find(".pop-points-open").show(),s=this.$el.find(".pop-points-open"),s.offset().top+s.height()>document.body.clientHeight?s.addClass("pop-bottom"):void 0},t}(),u=function(t,e,r){var n;return t.unbind("click"),n=new a(t,e,r),n.isEditable&&n.bindClickEvents(),n},{create:u}},i.factory("$tgEstimationsService",["$tgTemplate","$tgRepo","$tgConfirm","$q","$tgQqueue",t])}.call(this),function(){var t,e,r,n,i,o,s,a;o=this.taiga,e=angular.module("taigaCommon"),t=function(){return function(t,e){return t===[null,void 0]?e:t}},e.filter("default",t),a=function(t){return function(e){return e?t.instant("COMMON.YES"):t.instant("COMMON.NO")}},e.filter("yesNo",["$translate",a]),s=function(){return o.unslugify},e.filter("unslugify",s),r=function(){return function(t,e){return t?moment(t).format(e):""}},e.filter("momentFormat",r),n=function(){return function(t,e){return t?moment(t).fromNow(e||!1):""}},e.filter("momentFromNow",n),i=function(t){return function(){return t.taiga.sizeFormat}}(this),e.filter("sizeFormat",i)}.call(this),function(){var t,e,r,n,i,o,s,a,u=function(t,e){function r(){this.constructor=t}for(var n in e)c.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},c={}.hasOwnProperty;s=this.taiga,a=this.taiga.trim,n=this.taiga.bindOnce,i=this.taiga.debounce,o=angular.module("taigaCommon"),r={"userstories.userstory":["watchers","kanban_order","backlog_order","sprint_order","finish_date","tribe_gig"],"tasks.task":["watchers","us_order","taskboard_order"],"issues.issue":["watchers"]},t=function(t){function e(t,e,r){this.scope=t,this.repo=e,this.rs=r}return u(e,t),e.$inject=["$scope","$tgRepo","$tgResources"],e.prototype.initialize=function(t,e){return this.type=t,this.objectId=e},e.prototype.loadHistory=function(t,e){return this.rs.history.get(t,e).then(function(t){return function(e){var n,i,o,s,a,u,c;for(s=0,u=e.length;u>s;s++)o=e[s],null!=o.values_diff.description_diff&&(o.values_diff.description=o.values_diff.description_diff),delete o.values_diff.description_html,delete o.values_diff.description_diff,null!=o.values_diff.blocked_note_diff&&(o.values_diff.blocked_note=o.values_diff.blocked_note_diff),delete o.values_diff.blocked_note_html,delete o.values_diff.blocked_note_diff;for(a=0,c=e.length;c>a;a++)i=e[a],n=i.key.split(":")[0],null!=r[n]&&(i.values_diff=_.removeKeys(i.values_diff,r[n]));return t.scope.history=_.filter(e,function(t){return Object.keys(t.values_diff).length>0}),t.scope.comments=_.filter(e,function(t){return""!==t.comment})}}(this))},e.prototype.deleteComment=function(t,e,r){return this.rs.history.deleteComment(t,e,r).then(function(r){return function(){return r.loadHistory(t,e)}}(this))},e.prototype.undeleteComment=function(t,e,r){return this.rs.history.undeleteComment(t,e,r).then(function(r){return function(){return r.loadHistory(t,e)}}(this))},e}(s.Controller),e=function(e,r,o,s,a,u,c,l,p,d){var f,h,m,g,v,y,b,S,k,j;return y=s.get("common/history/history-change-diff.html",!0),k=s.get("common/history/history-change-points.html",!0),b=s.get("common/history/history-change-generic.html",!0),v=s.get("common/history/history-change-attachment.html",!0),S=s.get("common/history/history-change-list.html",!0),j=s.get("common/history/history-deleted-comment.html",!0),h=s.get("common/history/history-activity.html",!0),g=s.get("common/history/history-base-entries.html",!0),m=s.get("common/history/history-base.html",!0),f=function(t,e,s,f){var I,T,E,C,O,w,A,P,M,R,U,D,N,L,x,B,F,H,q,V,G;return G=s.type,O=null,V=!1,q=!1,C=function(){return u.instant("ACTIVITY.DATETIME")},n(t,s.ngModel,function(t){return G=s.type,O=t.id,f.initialize(G,O),f.loadHistory(G,O)}),E=function(t){var e;return e={subject:u.instant("ACTIVITY.FIELDS.SUBJECT"),name:u.instant("ACTIVITY.FIELDS.NAME"),description:u.instant("ACTIVITY.FIELDS.DESCRIPTION"),content:u.instant("ACTIVITY.FIELDS.CONTENT"),status:u.instant("ACTIVITY.FIELDS.STATUS"),is_closed:u.instant("ACTIVITY.FIELDS.IS_CLOSED"),finish_date:u.instant("ACTIVITY.FIELDS.FINISH_DATE"),type:u.instant("ACTIVITY.FIELDS.TYPE"),priority:u.instant("ACTIVITY.FIELDS.PRIORITY"),severity:u.instant("ACTIVITY.FIELDS.SEVERITY"),assigned_to:u.instant("ACTIVITY.FIELDS.ASSIGNED_TO"),watchers:u.instant("ACTIVITY.FIELDS.WATCHERS"),milestone:u.instant("ACTIVITY.FIELDS.MILESTONE"),user_story:u.instant("ACTIVITY.FIELDS.USER_STORY"),project:u.instant("ACTIVITY.FIELDS.PROJECT"),is_blocked:u.instant("ACTIVITY.FIELDS.IS_BLOCKED"),blocked_note:u.instant("ACTIVITY.FIELDS.BLOCKED_NOTE"),points:u.instant("ACTIVITY.FIELDS.POINTS"),client_requirement:u.instant("ACTIVITY.FIELDS.CLIENT_REQUIREMENT"),team_requirement:u.instant("ACTIVITY.FIELDS.TEAM_REQUIREMENT"),is_iocaine:u.instant("ACTIVITY.FIELDS.IS_IOCAINE"),tags:u.instant("ACTIVITY.FIELDS.TAGS"),attachments:u.instant("ACTIVITY.FIELDS.ATTACHMENTS"),is_deprecated:u.instant("ACTIVITY.FIELDS.IS_DEPRECATED"),blocked_note:u.instant("ACTIVITY.FIELDS.BLOCKED_NOTE"),is_blocked:u.instant("ACTIVITY.FIELDS.IS_BLOCKED"),order:u.instant("ACTIVITY.FIELDS.ORDER"),backlog_order:u.instant("ACTIVITY.FIELDS.BACKLOG_ORDER"),sprint_order:u.instant("ACTIVITY.FIELDS.SPRINT_ORDER"),kanban_order:u.instant("ACTIVITY.FIELDS.KANBAN_ORDER"),taskboard_order:u.instant("ACTIVITY.FIELDS.TASKBOARD_ORDER"),us_order:u.instant("ACTIVITY.FIELDS.US_ORDER")},e[t]||t},I=function(t){return _.keys(t.values_diff).length},T=function(t){return _.isArray(t)?0===t.length?u.instant("ACTIVITY.VALUES.EMPTY"):t.join(", "):""===t?u.instant("ACTIVITY.VALUES.EMPTY"):null==t||t===!1?u.instant("ACTIVITY.VALUES.NO"):t===!0?u.instant("ACTIVITY.VALUES.YES"):t},A=function(t){var e;return e=_.map(t,function(t,e){return"new"===e?_.map(t,function(t){return y({name:u.instant("ACTIVITY.NEW_ATTACHMENT"),diff:t.filename})}):"deleted"===e?_.map(t,function(t){return y({name:u.instant("ACTIVITY.DELETED_ATTACHMENT"),diff:t.filename})}):_.map(t,function(t){var e,r;return r=u.instant("ACTIVITY.UPDATED_ATTACHMENT",{filename:t.filename}),e=_.map(t.changes,function(t,e){return{name:E(e),from:T(t[0]),to:T(t[1])}}),v({name:r,diff:e})})}),_.flatten(e).join("\n")},x=function(e){var r;return r=_.map(e,function(e,r){return"new"===r?_.map(e,function(e){var r;return r=b({name:e.name,from:T(""),to:T(e.value)}),r=c(r)(t),r[0].outerHTML}):"deleted"===r?_.map(e,function(t){return y({name:u.instant("ACTIVITY.DELETED_CUSTOM_ATTRIBUTE"),diff:t.name})}):_.map(e,function(t){var e;return e=_.map(t.changes,function(e){return b({name:t.name,from:T(e[0]),to:T(e[1])})}),_.flatten(e).join("\n")})}),_.flatten(r).join("\n")},U=function(e,r){var n,i,o,s,a,l;return"description"===e?y({name:E("description"),diff:r[1]}):"blocked_note"===e?y({name:E("blocked_note"),diff:r[1]}):"points"===e?(o=k({points:r}),o=c(o)(t),o[0].outerHTML):"attachments"===e?A(r):"custom_attributes"===e?x(r):"tags"===e||"watchers"===e?(s=E(e),a=_.difference(r[0],r[1]),n=_.difference(r[1],r[0]),o=S({name:s,removed:a,added:n}),o=c(o)(t),o[0].outerHTML):"assigned_to"===e?(s=E(e),i=T(r[0]||u.instant("ACTIVITY.VALUES.UNASSIGNED")),l=T(r[1]||u.instant("ACTIVITY.VALUES.UNASSIGNED")),b({name:s,from:i,to:l})):(s=E(e),i=T(r[0]),l=T(r[1]),b({name:s,from:i,to:l}))},R=function(t){return _.map(t.values_diff,function(t,e){return U(e,t)})},D=function(t){var e;return e=I(t),u.instant("ACTIVITY.SIZE_CHANGE",{size:e},"messageformat")},N=function(e){var r,n,i,o;return e.delete_comment_date||(null!=(n=e.delete_comment_user)?n.name:void 0)?(r=j({deleteCommentDate:e.delete_comment_date?moment(e.delete_comment_date).format(C()):void 0,deleteCommentUser:e.delete_comment_user.name,deleteComment:e.comment_html,activityId:e.id,canRestoreComment:t.user&&(e.delete_comment_user.pk===t.user.id||t.project.my_permissions.indexOf("modify_project")>-1)}),r=c(r)(t),r[0].outerHTML):(r=h({avatar:e.user.photo,userFullName:e.user.name,userProfileUrl:e.user.is_active?l.resolve("user-profile",{username:e.user.username}):"",creationDate:moment(e.created_at).format(C()),comment:e.comment_html,changesText:D(e),changes:R(e),mode:"comment",deleteCommentActionTitle:u.instant("COMMENTS.DELETE"),deleteCommentDate:e.delete_comment_date?moment(e.delete_comment_date).format(C()):void 0,deleteCommentUser:(null!=(i=e.delete_comment_user)?i.name:void 0)?e.delete_comment_user.name:void 0,activityId:e.id,canDeleteComment:e.user.pk===(null!=(o=t.user)?o.id:void 0)||t.project.my_permissions.indexOf("modify_project")>-1}),r=c(r)(t),r[0].outerHTML)},M=function(t){var e;return h({avatar:t.user.photo,userFullName:t.user.name,userProfileUrl:t.user.is_active?l.resolve("user-profile",{username:t.user.username}):"",creationDate:moment(t.created_at).format(C()),comment:t.comment_html,changes:R(t),changesText:"",mode:"activity",deleteCommentDate:t.delete_comment_date?moment(t.delete_comment_date).format(C()):void 0,deleteCommentUser:(null!=(e=t.delete_comment_user)?e.name:void 0)?t.delete_comment_user.name:void 0,activityId:t.id})},B=function(e,r){var n,i;return i=e.length===r?0:r-e.length,n=g({entries:e,showMore:i}),n=c(n)(t)},P=function(){var r,n,i,o,a;return n=t.comments||[],r=t.history||[],o=!!r.length,i=!!n.length||d.check("modify_"+s.type),a=m({ngmodel:s.ngModel,type:s.type,mode:s.mode,historyVisible:o,commentsVisible:i}),a=c(a)(t),e.html(a)},F=function(){return P(),L(),w()},L=function(){var r,n,i;return r=t.comments||[],i=r.length,V||(r=_.takeRight(r,4)),r=_.map(r,function(t){return N(t)}),n=B(r,i),e.find(".comments-list").html(n)},w=function(){var r,n,i;return r=t.history||[],i=r.length,q||(r=_.takeRight(r,4)),r=_.map(r,function(t){return M(t)}),n=B(r,i),e.find(".changes-list").html(n)},H=o.bindAdd(function(n){return function(n){var i,o,u,c;return t.$broadcast("markdown-editor:submit"),e.find(".comment-list").addClass("activeanimation"),i=r().target(n).start(),c=function(){return p.$broadcast("comment:new"),f.loadHistory(G,O)["finally"](function(){return i.finish()})},u=function(){return i.finish(),a.notify("error")},o=t.$eval(s.ngModel),f.repo.save(o).then(c,u)}}(this)),t.$watch("comments",F),t.$watch("history",F),t.$on("object:updated",function(){return f.loadHistory(G,O)}),e.on("click",".add-comment .button-green",i(2e3,function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),H(e)})),e.on("click","a",function(t){var e,r;return r=angular.element(t.target),e=r.attr("href"),e&&0===e.indexOf("#")?(t.preventDefault(),$("body").scrollTop($(e).offset().top)):void 0}),e.on("click",".show-more",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),e.parent().is(".changes-list")?(q=!q,w()):(V=!V,L())}),e.on("click",".show-deleted-comment",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),e.parents(".activity-single").find(".hide-deleted-comment").show(),e.parents(".activity-single").find(".show-deleted-comment").hide(),e.parents(".activity-single").find(".comment-body").show()}),e.on("click",".hide-deleted-comment",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),e.parents(".activity-single").find(".hide-deleted-comment").hide(),e.parents(".activity-single").find(".show-deleted-comment").show(),e.parents(".activity-single").find(".comment-body").hide()}),e.on("click",".changes-title",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),e.parent().find(".change-entry").toggleClass("active")}),e.on("focus",".add-comment textarea",function(t){return $(this).addClass("active")}),e.on("click",".history-tabs a",function(t){var r;return r=angular.element(t.currentTarget),e.find(".history-tabs li").removeClass("active"),r.parent().addClass("active"),e.find(".history section").addClass("hidden"),e.find(".history section."+r.data("section-class")).removeClass("hidden")}),e.on("click",".comment-delete",i(2e3,function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=r.data("activity-id"),f.deleteComment(G,O,e)})),e.on("click",".comment-restore",i(2e3,function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=r.data("activity-id"),f.undeleteComment(G,O,e)})),t.$on("$destroy",function(){return e.off()}),P()},{controller:t,restrict:"AE",link:f}},o.directive("tgHistory",["$log","$tgLoading","$tgQqueue","$tgTemplate","$tgConfirm","$translate","$compile","$tgNavUrls","$rootScope","tgCheckPermissionsService",e])}.call(this),function(){var t,e,r;r=angular.module("taigaCommon"),t=function(t,e,r,n,i,o,s,a){var u;return u=function(u,c,l){var p;return p=function(t){var e,r,n,i,o,a;return t.headers?(e="",a=s.getUser(),r=0,t.headers.isPrivate?(i=!s.canCreatePrivateProjects().valid,r=null,n=null!==a.get("max_memberships_private_projects")&&t.headers.memberships>=a.get("max_memberships_private_projects"),i&&n?(e="private-space-members",r=a.get("max_memberships_private_projects")):i?e="private-space":n&&(e="private-members",r=a.get("max_memberships_private_projects"))):(o=!s.canCreatePublicProjects().valid,n=null!==a.get("max_memberships_public_projects")&&t.headers.memberships>=a.get("max_memberships_public_projects"),o&&n?(e="public-space-members",r=a.get("max_memberships_public_projects")):o?e="public-space":n&&(e="public-members",r=a.get("max_memberships_public_projects"))),{key:e,values:{max_memberships:r,members:t.headers.memberships}}):!1},c.on("click",".import-project-button",function(t){return t.preventDefault(),c.find("input.import-file").val(""),c.find("input.import-file").trigger("click")}),c.on("change","input.import-file",function(u){var c,l,d,f;return u.preventDefault(),(c=u.target.files[0])?(l=e.loader(i.instant("PROJECT.IMPORT.UPLOADING_FILE")),f=function(t){return s.loadProjects().then(function(){var o,s,a,u;return l.stop(),202===t.status?(u=i.instant("PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE"),s=i.instant("PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE"),e.success(u,s)):(o={project:t.data.slug},r.path(n.resolve("project-admin-project-profile-details",o)),a=i.instant("PROJECT.IMPORT.SYNC_SUCCESS"),e.notify("success",a))})},d=function(t){return a.refresh().then(function(){var r,n,s;return s=p(t),l.stop(),s?o.create("tg-lb-import-error",{"class":"lightbox lightbox-import-error"},s):(r=i.instant("PROJECT.IMPORT.ERROR"),429===t.status?r=i.instant("PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST"):(null!=(n=t.data)?n._error_message:void 0)&&(r=i.instant("PROJECT.IMPORT.ERROR_MESSAGE",{error_message:t.data._error_message})),e.notify("error",r))})},l.start(),t.projects["import"](c,l.update).then(f,d)):void 0})},{link:u}},r.directive("tgImportProjectButton",["$tgResources","$tgConfirm","$location","$tgNavUrls","$translate","tgLightboxFactory","tgCurrentUserService","$tgAuth",t]),e=function(t){var e;return e=function(e,r,n){return t.open(r),e.close=function(){t.close(r)}},{templateUrl:"common/lightbox/lightbox-import-error.html",link:e}},e.$inject=["lightboxService"],r.directive("tgLbImportError",e)}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m,g=function(t,e){function r(){this.constructor=t}for(var n in e)v.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},v={}.hasOwnProperty;f=angular.module("taigaCommon"),p=this.taiga.bindOnce,m=this.taiga.timeout,d=this.taiga.debounce,h=this.taiga.sizeFormat,c=function(t){function e(t,e){this.animationFrame=t,this.q=e}return g(e,t),e.prototype.open=function(t){var e,r,n;return _.isString(t)&&(t=$(t)),e=this.q.defer(),n=t.children().not(".close"),n.hide(),this.animationFrame.add(function(){return t.css("display","flex")}),this.animationFrame.add(function(){return t.addClass("open"),t.one("transitionend",function(e){return function(){var e;return e=t.find("input,textarea").first(),e.length?t.find("input,textarea").first().focus():document.activeElement?$(document.activeElement).blur():void 0}}(this))}),this.animationFrame.add(function(t){return function(){return n.show(),e.resolve()}}(this)),r=angular.element(document),r.on("keydown.lightbox",function(e){return function(r){var n;return n=r.keyCode?r.keyCode:r.which,27===n?e.close(t):void 0}}(this)),e.promise},e.prototype.close=function(t){var e,r;return _.isString(t)&&(t=$(t)),e=angular.element(document),e.off(".lightbox"),e.off(".keyboard-navigation"),this.animationFrame.add(function(){return t.addClass("close"),t.one("transitionend",function(e){return function(){return t.removeAttr("style"),t.removeClass("open").removeClass("close")}}(this))}),t.hasClass("remove-on-close")?(r=t.data("scope"),r&&r.$destroy(),t.remove()):void 0},e.prototype.closeAll=function(){var t,e,r,n,i,o;for(t=angular.element(document),i=t.find(".lightbox.open"),o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(this.close($(n)));return o},e}(taiga.Service),f.service("lightboxService",["animationFrame","$q",c]),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return g(e,t),e.prototype.stop=function(){var t;return t=angular.element(document),t.off(".keyboard-navigation")},e.prototype.dispatch=function(t,e){var r,n,i;if(r=t.find(".selected"),13===e)return 1===t.find(".user-list-single").length?t.find(".user-list-single:first").trigger("click"):r.trigger("click");if(40===e){if(!r.length)return t.find('.user-list-single:not(".is-active"):first').addClass("selected");if(n=r.next(".user-list-single"),n.length)return r.removeClass("selected"),n.addClass("selected")}else if(38===e){if(!r.length)return t.find(".user-list-single:last").addClass("selected");if(i=r.prev('.user-list-single:not(".is-active")'),i.length)return r.removeClass("selected"),i.addClass("selected")}},e.prototype.init=function(t){var e;return this.stop(),e=angular.element(document),e.on("keydown.keyboard-navigation",function(e){return function(r){var n;return n=r.keyCode?r.keyCode:r.which,40===n||38===n||13===n?(r.preventDefault(),e.dispatch(t,n)):void 0}}(this))},e}(taiga.Service),f.service("lightboxKeyboardNavigationService",a),s=function(t){var e;return e=function(e,r,n){return r.on("click",".close",function(e){return e.preventDefault(),t.close(r)})},{restrict:"C",link:e}},f.directive("lightbox",["lightboxService",s]),r=function(t,e,r,n,i,o,s){var a;return a=function(e,a,u,c){var l,p,d;return p=s.instant(u.title),a.find("h2.title").text(p),d=function(e){return function(e){var n;return n=o.save(function(t){return t.is_blocked=!1,t.blocked_note="",t}),n.then(function(){return r.notify("success"),t.$broadcast("object:updated"),e()}),n.then(null,function(){return r.notify("error"),item.revert()}),n["finally"](function(){return e()}),n}}(this),l=function(){var e,s;return e=i().target(a.find(".button-green")).start(),s=o.save(function(t){return t.is_blocked=!0,t.blocked_note=a.find(".reason").val(),t}),s.then(function(){return r.notify("success"),t.$broadcast("object:updated")}),s.then(null,function(){return r.notify("error")}),s["finally"](function(){return e.finish(),n.close(a)})},e.$on("block",function(){return a.find(".reason").val(c.$modelValue.blocked_note),n.open(a)}),e.$on("unblock",function(t){return function(t,e,r){return d(r)}}(this)),e.$on("$destroy",function(){return a.off()}),a.on("click",".button-green",function(t){return t.preventDefault(),l()})},{templateUrl:"common/lightbox/lightbox-block.html",link:a,require:"ngModel"}},f.directive("tgLbBlock",["$rootScope","$tgRepo","$tgConfirm","lightboxService","$tgLoading","$tgQueueModelTransformation","$translate",r]),n=function(t,e,r){var n,i,o;return i=e.get("common/lightbox/lightbox-blocking-message-input.html",!0),n=function(e,r,n,i){return n.watch?e.$watch(n.watch,function(t){return t===!0&&t===!0?r.find(".blocked-note").removeClass("hidden"):r.find(".blocked-note").addClass("hidden")}):t.error("No watch attribute on tg-blocking-message-input directive")},o=function(t,e){return i({ngmodel:e.ngModel})},{template:o,link:n,require:"ngModel",restrict:"EA"}},f.directive("tgBlockingMessageInput",["$log","$tgTemplate","$compile",n]),o=function(t,e,r,n,i,o,s,a,u,c){var l;return l=function(r,l,p){var f,h,m,g,v,y,b,$;return v=null,r.createEditUs={},r.isNew=!0,f=Immutable.List(),h=Immutable.List(),y=function(){return f=Immutable.List(),h=Immutable.List()},r.addAttachment=function(t){return f=f.push(t)},r.deleteAttachment=function(t){return h=h.push(t)},r.$on("usform:new",function(t,n,o,a){return v&&v.reset(),r.isNew=!0,r.usStatusList=a,r.attachments=Immutable.List(),y(),r.us=e.make_model("userstories",{project:n,points:{},status:o,is_archived:!1,tags:[]}),l.find(".button-green").html(s.instant("COMMON.CREATE")),l.find(".title").html(s.instant("LIGHTBOX.CREATE_EDIT_US.NEW_US")),l.find(".tag-input").val(""),l.find(".blocked-note").addClass("hidden"),l.find("label.blocked").removeClass("selected"),l.find("label.team-requirement").removeClass("selected"),l.find("label.client-requirement").removeClass("selected"),i.open(l)}),r.$on("usform:edit",function(t,e,n){return v&&v.reset(),r.us=e,r.attachments=Immutable.fromJS(n),r.isNew=!1,y(),l.find(".button-green").html(s.instant("COMMON.SAVE")),l.find(".title").html(s.instant("LIGHTBOX.CREATE_EDIT_US.EDIT_US")),l.find(".tag-input").val(""),e.is_blocked?(l.find(".blocked-note").removeClass("hidden"),l.find("label.blocked").addClass("selected")):(l.find(".blocked-note").addClass("hidden"),l.find("label.blocked").removeClass("selected")),e.team_requirement?l.find("label.team-requirement").addClass("selected"):l.find("label.team-requirement").removeClass("selected"),e.client_requirement?l.find("label.client-requirement").addClass("selected"):l.find("label.client-requirement").removeClass("selected"),i.open(l)}),m=function(t){var e;return e=_.map(f.toJS(),function(e){return c.upload(e.file,t.id,r.us.project,"us")}),u.all(e)},g=function(t){var e;return e=_.map(h.toJS(),function(t){return c["delete"]("us",t.id)}),u.all(e)},b=d(2e3,function(e){return function(e){var s,u,c;return e.preventDefault(),v=l.find("form").checksley(),v.validate()?(u=o().target($).start(),r.isNew?(c=t.create("userstories",r.us),s="usform:new:success"):(c=t.save(r.us),s="usform:edit:success"),c.then(function(t){return g(t).then(function(e){return function(){return m(t)}}(this)),t}),c.then(function(t){return u.finish(),i.close(l),n.$broadcast(s,t)}),c.then(null,function(t){return u.finish(),v.setErrors(t),t._error_message?a.notify("error",t._error_message):void 0})):void 0}}(this)),$=l.find(".submit-button"),l.on("submit","form",b),l.on("click",".close",function(t){return t.preventDefault(),r.$apply(function(){return r.us.revert()}),i.close(l)}),l.keydown(function(t){var e;return e=t.keyCode?t.keyCode:t.which,27===e?(i.close(l),r.$apply(function(){return r.us.revert()})):void 0}),r.$on("$destroy",function(){return l.off()})},{link:l}},f.directive("tgLbCreateEditUserstory",["$tgRepo","$tgModel","$tgResources","$rootScope","lightboxService","$tgLoading","$translate","$tgConfirm","$q","tgAttachmentsService",o]),i=function(t,e,r,n,i){var o;return o=function(t,o,s){var a,u,c;return a=null,t.$on("usform:bulk",function(e,r,i){return a&&a.reset(),t["new"]={projectId:r,statusId:i,bulk:""},n.open(o)}),u=d(2e3,function(s){return function(s){var u,l;return s.preventDefault(),a=o.find("form").checksley({onlyOneErrorElement:!0}),a.validate()?(u=i().target(c).start(),l=e.userstories.bulkCreate(t["new"].projectId,t["new"].statusId,t["new"].bulk),l.then(function(t){return u.finish(),r.$broadcast("usform:bulk:success",t),n.close(o)}),l.then(null,function(t){return u.finish(),a.setErrors(t),t._error_message?$confirm.notify("error",t._error_message):void 0})):void 0}}(this)),c=o.find(".submit-button"),o.on("submit","form",u),t.$on("$destroy",function(){return o.off()})},{link:o}},f.directive("tgLbCreateBulkUserstories",["$tgRepo","$tgResources","$rootScope","lightboxService","$tgLoading",i]),t=function(t,e,r,n){var i;return i=function(i,o,s){var a,u,c,l,p,d,f;return d=null,p=null,f=r.get("common/lightbox/lightbox-assigned-to-users.html",!0),c=function(t){var e;return e=t,e=e.replace("","A").replace("","A").replace("","A"),e=e.replace("","E").replace("","E").replace("","E"),e=e.replace("","I").replace("","I").replace("","I"),e=e.replace("","O").replace("","O").replace("","O"),e=e.replace("","U").replace("","U").replace("","U")},u=function(t,e){var r;return r=e.full_name_display.toUpperCase(),r=c(r),t=t.toUpperCase(),t=c(t),_.includes(r,t)},l=function(t,e){var r,s,a;return a=_.clone(i.activeUsers,!0),null!=t&&(a=_.reject(a,{id:t.id})),null!=e&&(a=_.filter(a,_.partial(u,e))),r={selected:t,users:_.slice(a,0,5),showMore:a.length>5},s=f(r),s=n(s)(i),o.find(".assigned-to-list").html(s)},a=function(){return e.stop(),t.close(o)},i.$on("assigned-to:add",function(r,n){var s;return p=n,s=n.assigned_to,d=i.usersById[s],l(d),t.open(o).then(function(){return o.find("input").focus(),e.init(o)})}),i.$watch("usersSearch",function(t){return null!=t?(l(d,t),o.find("input").focus()):void 0}),o.on("click",".user-list-single",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),a(),i.$apply(function(){return i.$broadcast("assigned-to:added",e.data("user-id"),p),i.usersSearch=null})}),o.on("click",".remove-assigned-to",function(t){return t.preventDefault(),t.stopPropagation(),a(),i.$apply(function(){return i.usersSearch=null,i.$broadcast("assigned-to:added",null,p)})}),o.on("click",".close",function(t){return t.preventDefault(),a(),i.$apply(function(){return i.usersSearch=null})}),i.$on("$destroy",function(){return o.off()})},{templateUrl:"common/lightbox/lightbox-assigned-to.html",link:i}},f.directive("tgLbAssignedto",["lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile",t]),l=function(t,e,r,n,i){var o;return o=function(t,o,s){var a,u,c,l,p;return l=null,p=n.get("common/lightbox/lightbox-assigned-to-users.html",!0),u=function(e){var r,n;return null==e&&(e=""),r=function(t,e){var r;return l&&_.find(l.watchers,function(t){return t===e.id})?!1:(r=e.full_name_display.toUpperCase(),t=t.toUpperCase(),_.includes(r,t))},n=_.clone(t.activeUsers,!0),n=_.filter(n,_.partial(r,e))},c=function(e){var r,n;return r={selected:!1,users:_.slice(e,0,5),showMore:e.length>5},n=p(r),n=i(n)(t),o.find(".ticket-watchers").html(n)},a=function(){return r.stop(),e.close(o)},t.$on("watcher:add",function(t,n){var i;return l=n,i=u(),c(i),e.open(o).then(function(){return o.find("input").focus(),r.init(o)})}),t.$watch("usersSearch",function(t){var e;if(null!=t)return e=u(t),c(e),o.find("input").focus()}),o.on("click",".user-list-single",d(200,function(e){var r;return a(),e.preventDefault(),r=angular.element(e.currentTarget),t.$apply(function(){return t.usersSearch=null,t.$broadcast("watcher:added",r.data("user-id"))})})),o.on("click",".close",function(e){return e.preventDefault(),a(),t.$apply(function(){return t.usersSearch=null})}),t.$on("$destroy",function(){return o.off()})},{templateUrl:"common/lightbox/lightbox-users.html",link:o}},f.directive("tgLbWatchers",["$tgRepo","lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile",l]),e=function(t,e,r){var n;return n=function(e,r,n){return t.open(r)},{templateUrl:"common/lightbox/lightbox-attachment-preview.html",link:n,scope:!0}},f.directive("tgLbAttachmentPreview",["lightboxService","$tgTemplate","$compile",e]),u=function(t,e,r){var n;return n=function(e,r,n){return t.open(r)},{templateUrl:"common/lightbox/lightbox-leave-project-warning.html",link:n,scope:!0}},f.directive("tgLightboxLeaveProjectWarning",["lightboxService",u])}.call(this),function(){var t,e,r,n,i,o;i=this.taiga,n=this.taiga.sizeFormat,o=this.taiga.timeout,r=angular.module("taigaCommon"),e=function(t,e){var r;return r=function(e,r,n){return t.onStart(function(){return $(document.body).addClass("loader-active"),r.addClass("active")}),t.onEnd(function(){return $(document.body).removeClass("loader-active"),r.removeClass("active")})},{link:r}},r.directive("tgLoader",["tgLoader","$rootScope",e]),t=function(t){var e,r,n,i,s,a,u,c;return r={minTime:300},i=!1,c=0,a=0,n=0,s=function(e){var s,u,l;return null==e&&(e=!1),c&&(l=0,e||(u=(new Date).getTime(),s=u-c,s<r.minTime&&(l=r.minTime-s)),o(l,function(){return t.$broadcast("loader:end"),i=!1,window.prerenderReady=!0})),c=0,a=0,n=0},e=function(){var t;return t=setInterval(function(){return n&&0===a?(s(),clearInterval(t)):void 0},50)},u=function(){return c=(new Date).getTime(),t.$broadcast("loader:start"),i=!0},{pageLoaded:s,start:function(t){return null==t&&(t=!1),!i&&(u(),t)?e():void 0},onStart:function(e){return t.$on("loader:start",e)},onEnd:function(e){return t.$on("loader:end",e)},logRequest:function(){return a++},logResponse:function(){return a--,n=(new Date).getTime()}}},t.$inject=["$rootScope"],r.factory("tgLoader",t)}.call(this),function(){var t,e,r,n=[].slice;r=angular.module("taigaCommon"),e=function(t){var e;return e="<img class='loading-spinner' src='/"+window._version+"/svg/spinner-circle.svg' alt='loading...' />",function(){var r;return r={settings:{target:null,scope:null,classes:[],timeout:0,template:null},target:function(t){return r.settings.target=t,r},scope:function(t){return r.settings.scope=t,r},template:function(t){
return r.settings.template=t,r},removeClasses:function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],r.settings.classes=t,r},timeout:function(t){return r.settings.timeout=t,r},start:function(){var t,n;return t=r.settings.target,r.settings.classes.map(function(e){return t.removeClass(e)}),t.hasClass("loading")||r.settings.template||(r.settings.template=t.html()),n=setTimeout(function(){return t.hasClass("loading")?void 0:(t.addClass("loading"),t.html(e))},r.settings.timeout),r.settings.timeoutId=n,r},finish:function(){var e,n,i;return n=r.settings.target,i=r.settings.timeoutId,i&&(clearTimeout(i),e=r.settings.classes,e.map(function(t){return r.settings.target.addClass(t)}),n.html(r.settings.template),n.removeClass("loading"),r.settings.scope&&t(n.contents())(r.settings.scope)),r}}}},e.$inject=["$compile"],r.factory("$tgLoading",e),t=function(t){var e;return e=function(e,r,n){var i,o;return i=null,o=r.html(),e.$watch(n.tgLoading,function(n){return function(n){return n?i=t().target(r).timeout(100).template(o).scope(e).start():i?i.finish():void 0}}(this))},{link:e}},r.directive("tgLoading",["$tgLoading",t])}.call(this),function(){var t,e,r,n,i,o;o=this.taiga,r=this.taiga.bindOnce,n=this.taiga.debounce,i=angular.module("taigaCommon"),e=function(t,e){var i,o;return o=e.get("common/popover/popover-us-status.html",!0),i=function(e,i,s){var a,u,c;return a=i.controller(),u=function(t){var r,n,o;return o=i.find(".us-status"),n=i.find(".us-status .us-status-bind"),r=e.usStatusById,r[t.status]?(n.text(r[t.status].name),o.css("color",r[t.status].color)):void 0},i.on("click",".us-status",function(t){return t.preventDefault(),t.stopPropagation(),i.find(".pop-status").popover().open()}),i.on("click",".status",n(2e3,function(r){var n,o;return r.preventDefault(),r.stopPropagation(),n=angular.element(r.currentTarget),o=e.$eval(s.tgUsStatus),o.status=n.data("status-id"),u(o),i.find(".pop-status").popover().close(),e.$apply(function(){return t.save(o).then(function(){return e.$eval(s.onUpdate)})})})),e.$on("userstories:loaded",function(){return u(e.$eval(s.tgUsStatus))}),e.$on("$destroy",function(){return i.off()}),c=e.$eval(s.tgUsStatus),u(c),r(e,"project",function(t){var r;return r=o({statuses:t.us_statuses}),i.append(r),-1===e.project.my_permissions.indexOf("modify_us")?(i.unbind("click"),i.find("a").addClass("not-clickable")):void 0})},{link:i}},i.directive("tgUsStatus",["$tgRepo","$tgTemplate",e]),t=function(t,e){var r,i,s;return i=e.get("common/popover/popover-related-task-status.html",!0),s=function(t,e,r){var n,i;return i=t.find(".us-status"),n=t.find(".task-status .task-status-bind"),r[e.status]?(n.text(r[e.status].name),i.css("color",r[e.status].color)):void 0},r=function(e,r,a){var u,c,l,p;return u=r.controller(),p=e.$eval(a.tgRelatedTaskStatus),l=e.$eval(a.notAutoSave),c=!l,r.on("click",".task-status",function(t){return t.preventDefault(),t.stopPropagation(),r.find(".pop-status").popover().open()}),r.on("click",".status",n(2e3,function(n){var i;return n.preventDefault(),n.stopPropagation(),i=angular.element(n.currentTarget),p.status=i.data("status-id"),r.find(".pop-status").popover().close(),s(r,p,e.taskStatusById),c?e.$apply(function(){return t.save(p).then(function(){return e.$eval(a.onUpdate),e.$emit("related-tasks:status-changed")})}):void 0})),e.$watch(a.tgRelatedTaskStatus,function(){return p=e.$eval(a.tgRelatedTaskStatus),s(r,p,e.taskStatusById)}),o.bindOnce(e,"project",function(t){return r.append(i({statuses:t.task_statuses})),s(r,p,e.taskStatusById),-1===t.my_permissions.indexOf("modify_task")?(r.unbind("click"),r.find("a").addClass("not-clickable")):void 0}),e.$on("$destroy",function(){return r.off()})},{link:r}},i.directive("tgRelatedTaskStatus",["$tgRepo","$tgTemplate",t]),$.fn.popover=function(){var t,e,r,n,i,o;return t=this,i=function(e){return function(){var e,r,n,i,o,s,a,u,c,l;return t.css({display:"block",visibility:"hidden"}),i=$(window).scrollTop(),e=i+$(window).height(),o=$(window).width(),n=o,r=0,c=t.offset().top,s=c+t.height(),l=t.width(),a=t.offset().left,u=t.offset().left+l,t.css({display:"none",visibility:"visible"}),e>=s&&c>=i&&a>=r&&n>=u}}(this),n=function(e){return function(e){return e&&e.call(t),t.fadeOut(function(){return t.removeClass("active").removeClass("fix")}),t.off("popup:close")}}(this),r=function(t){return function(){return $(".popover.active").each(function(){return $(this).trigger("popup:close")})}}(this),o=function(o){return function(o){return t.hasClass("active")?e():(r(),i()||t.addClass("fix"),t.fadeIn(function(){return t.addClass("active"),$(document.body).off("popover"),$(document.body).one("click.popover",function(){return r()})}),t.on("popup:close",function(t){return n(o)}))}}(this),e=function(e){return function(){return t.trigger("popup:close")}}(this),{open:o,close:e,closeAll:r}}}.call(this),function(){var t,e,r;r=this.taiga,e=angular.module("taigaCommon"),t=function(t,e){var r;return this.config=e,r=this.config.get("ravenConfig",null),r?(t.debug("Using the RavenJS exception handler."),Raven.config(r).install(),function(e,r){return t.error.apply(t,arguments),Raven.captureException(e)}):(t.debug("Using the default logging exception handler."),function(e,r){return t.error.apply(t,arguments)})},e.factory("$exceptionHandler",["$log","$tgConfig",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};s=this.taiga,a=this.taiga.trim,i=this.taiga.bindOnce,o=angular.module("taigaCommon"),n=function(){var t,e,r;return t=function(t){return _.isArray(t)?t.join(", "):""},r=function(t){var e;return t?(e=_(t.split(",")).map(function(t){return _.trim(t)}),e.value()):[]},e=function(e,n,i,o){return o.$formatters.push(t),o.$parsers.push(r),e.$on("$destroy",function(){return n.off()})},{require:"ngModel",link:e}},o.directive("tgTags",n),t=function(){var t,e;return e={backlog:_.template('<% _.each(tags, function(tag) { %>\n    <span class="tag" style="border-left: 5px solid <%- tag.color %>"><%- tag.name %></span>\n<% }) %>'),kanban:_.template('<% _.each(tags, function(tag) { %>\n    <a class="kanban-tag" href="" style="border-color: <%- tag.color %>" title="<%- tag.name %>" />\n<% }) %>'),taskboard:_.template('<% _.each(tags, function(tag) { %>\n    <a class="taskboard-tag" href="" style="border-color: <%- tag.color %>" title="<%- tag.name %>" />\n<% }) %>')},t=function(t,r,n,i){var o;return o=function(i){var o,s,a;return a=e[n.tgColorizeTagsType],i.sort(),s=_.map(i,function(e){var r;return r=t.project.tags_colors[e],{name:e,color:r}}),o=a({tags:s}),r.html(o)},t.$watch(n.tgColorizeTags,function(t){return null!=t?o(t):void 0}),t.$on("$destroy",function(){return r.off()})},{link:t}},o.directive("tgColorizeTags",t),e=function(t,e,r){var n,o,s,c,l;return o=13,n=188,l=e.get("common/tag/lb-tag-line-tags.html",!0),s=null,c=function(t,e,n,c){var p,d,f,h,m,g,v;return h=function(n,i){var o,s;return o={tags:_.map(n,function(t){return{name:t,color:i[t]}})},_.map(o.tags,function(t){return function(t){return t.color?t.style="border-left: 5px solid "+t.color:void 0}}(this)),s=r(l(o))(t),e.find(".tags-container").html(s)},v=function(){return e.find(".save").removeClass("hidden")},f=function(){return e.find(".save").addClass("hidden")},m=function(){return e.find("input").val(""),s.close()},p=function(e){var r;return e=a(e.toLowerCase()),0!==e.length?(r=_.clone(c.$modelValue,!1),null==r&&(r=[]),u.call(r,e)<0&&r.push(e),t.$apply(function(){return c.$setViewValue(r)}),f()):void 0},d=function(e){var r;return e=a(e.toLowerCase()),0!==e.length?(r=_.clone(c.$modelValue,!1),r=_.pull(r,e),t.$apply(function(){return c.$setViewValue(r)})):void 0},g=function(){var t;return t=e.find("input").val(),p(t),m()},e.on("keypress","input",function(t){var e;return e=angular.element(t.currentTarget),t.keyCode===o?(t.preventDefault(),g()):","===String.fromCharCode(t.keyCode)?(t.preventDefault(),g()):e.val().length?v():f()}),e.on("click",".save",function(t){return t.preventDefault(),g()}),e.on("click",".remove-tag",function(t){var e,r;return t.preventDefault(),e=angular.element(t.currentTarget),r=e.siblings(".tag-name").text(),d(r)}),i(t,"project",function(t){var r;return r=e.find("input"),s=new Awesomplete(r[0],{list:_.keys(t.tags_colors)}),r.on("awesomplete-selectcomplete",function(){return p(r.val()),r.val("")})}),t.$watch(n.ngModel,function(e){var r,n;return n=(null!=(r=t.project)?r.tags_colors:void 0)||[],h(e,n)}),t.$on("$destroy",function(){return e.off()})},{link:c,require:"ngModel",templateUrl:"common/tag/lb-tag-line.html"}},o.directive("tgLbTagLine",["$tgResources","$tgTemplate","$compile",e]),r=function(t,e,r,n,o,s,c){var l,p,d,f,h;return p=13,d=27,l=188,h=s.get("common/tag/tags-line-tags.html",!0),f=function(e,r,s,l){var f,m,g,v,y,b,$,S,k,j,I,T,E,C,O,w;return m=null,S=function(){return null!=s.requiredPerm?-1!==e.project.my_permissions.indexOf(s.requiredPerm):!0},j=function(t,n){var i,o;return i={tags:_.map(t,function(t){return{name:t,color:n[t]}}),isEditable:S()},o=c(h(i))(e),r.find("div.tags-container").html(o)},k=function(){return r.find(".add-tag").remove(),r.find("input").remove(),r.find(".save").remove()},E=function(){return r.find(".add-tag").removeClass("hidden")},v=function(){return r.find(".add-tag").addClass("hidden")},C=function(){return r.find(".add-tag-text").removeClass("hidden")},y=function(){return r.find(".add-tag-text").addClass("hidden")},w=function(){return r.find(".save").removeClass("hidden")},$=function(){return r.find(".save").addClass("hidden")},O=function(){return r.find("input").removeClass("hidden").focus()},b=function(){return r.find("input").addClass("hidden").blur()},I=function(){return r.find("input").val(""),m.close()},f=function(e){var r,i,s;return e=a(e.toLowerCase()),0!==e.length?(s=o.save(function(t){var r;return t.tags||(t.tags=[]),r=_.clone(t.tags),u.call(r,e)<0&&r.push(e),t.tags=r,t}),i=function(){return t.$broadcast("object:updated")},r=function(){return n.notify("error")},$(),s.then(i,r)):void 0},g=function(e){var r,i,s;return e=a(e.toLowerCase()),0!==e.length?(s=o.save(function(t){var r;return r=_.clone(t.tags,!1),t.tags=_.pull(r,e),t}),i=function(){return t.$broadcast("object:updated")},r=function(){return n.notify("error")},s.then(i,r)):void 0},T=function(){var t;return t=r.find("input").val(),f(t),I()},r.on("keypress","input",function(t){var e;return e=angular.element(t.currentTarget),t.keyCode===p?T():","===String.fromCharCode(t.keyCode)?(t.preventDefault(),T()):e.val().length?w():$()}),r.on("keyup","input",function(t){return t.keyCode===d?(I(),b(),$(),E()):void 0}),r.on("click",".save",function(t){return t.preventDefault(),T()}),r.on("click",".add-tag",function(t){return t.preventDefault(),v(),O()}),r.on("click",".remove-tag",function(t){var e,r;return t.preventDefault(),e=angular.element(t.currentTarget),r=e.siblings(".tag-name").text(),g(r)}),i(e,"project.tags_colors",function(t){var e;return S()?(E(),e=r.find("input"),m=new Awesomplete(e[0],{list:_.keys(t)}),e.on("awesomplete-selectcomplete",function(){return f(e.val()),e.val("")})):void k()}),e.$watchCollection(function(){var t;return null!=(t=l.$modelValue)?t.tags:void 0},function(){var t,r,n,i;return(t=l.$modelValue)?((null!=(r=t.tags)?r.length:void 0)?y():C(),i=(null!=(n=e.project)?n.tags_colors:void 0)||[],j(t.tags,i)):void 0}),e.$on("$destroy",function(){return r.off()})},{link:f,require:"ngModel",templateUrl:"common/tag/tag-line.html"}},o.directive("tgTagLine",["$rootScope","$tgRepo","$tgResources","$tgConfirm","$tgQueueModelTransformation","$tgTemplate","$compile",r])}.call(this),function(){var t,e,r,n,i=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};n=this.taiga,e=this.taiga.bindOnce,r=angular.module("taigaCommon"),t=function(t,e,r,o,s,a){var u,c;return c=o.get("common/wysiwyg/wysiwyg-markitup-preview.html",!0),u=function(o,u,l,p){var d,f,h,m,g,v,_,y,b,S,k,j,I;return m=angular.element(u),y=$("<div/>",{"class":"preview"}),h=function(){return m.parents(".markdown").find(".preview").remove(),m.parents(".markItUp").show()},o.$on("markdown-editor:submit",function(){return h()}),f=null,b=!1,_=function(){var t,n;if(!b)return b=!0,n=m.parents(".markdown"),t=m.parents(".markItUp"),e.mdrender.render(o.projectId,p.$modelValue).then(function(e){var i,a;return i=c({data:e.data}),i=s(i)(o),n.append(i),t.hide(),b=!1,a=m.closest(".markdown"),a.on("mouseup.preview",".preview",function(t){var e;return t.preventDefault(),e=angular.element(t.target),e.is("a")||!r.get().length?(a.off(".preview"),h()):void 0})})},k=function(t,e){var r,n,i,o;return t.createTextRange?(n=t.createTextRange(),n.move("character",e),n.select()):t.selectionStart&&(t.focus(),t.setSelectionRange(e,e)),o=t.value.split("\n").length,r=t.value.slice(0,+(e-1)+1||9e9).split("\n").length,i=r/o,u.scrollTop(i*u[0].scrollHeight-u.height()/2)},d=function(t,e,r){var n,i,o,s,a,u;for(u=t.value.split("\n"),r?u[e]=r+u[e]:u[e]="",n=0,o=i=0,s=u.length;s>i&&(a=u[o],n+=a.length+1||1,o!==e);o=++i);return t.value=u.join("\n"),r?n-u[e].length+r.length-1:n},v=function(t){var e,r,n;for(r=/(<<<|>>>)/gi,n=0,e=[];n=r.exec(t.textarea.value);)e.push(n.index);return t.donotparse=e},I=function(t){var e,r,n,o,s,a,u,c;for(o=/<<</gi,s=0,a=0;;){if(s=o.exec(t.textarea.value),!s)break;if(r=s.index,i.call(t.donotparse,r)<0){a=s.index;break}}if(s){for(o=/>>>/gi,e=0;;){if(s=o.exec(t.textarea.value),!s)break;if(n=s.index,i.call(t.donotparse,n)<0){e=s.index;break}}return c=t.textarea.value,u=c.substring(a,e).replace("<<<","").replace(">>>",""),u=u.replace("(","%28").replace(")","%29"),u=u.replace("[","%5B").replace("]","%5D"),c=c.substring(0,a)+u+c.substring(e+3,c.length),t.textarea.value=c,t.donotparse=void 0}},g=function(t,e){var r,n,i,o,s;for(r="",o=$.trim(t.selection||t.placeHolder).length,n=i=0,s=o-1;s>=0?s>=i:i>=s;n=s>=0?++i:--i)r+=e;return"\n"+r+"\n"},S=function(){var t;return t={nameSpace:"markdown",onShiftEnter:{keepDefault:!1,openWith:"\n\n"},onEnter:{keepDefault:!1,replaceWith:function(){return $(".textcomplete-dropdown").is(":visible")?void 0:"\n"},afterInsert:function(t){var e,r,n,i,o,s,a,u,c;return i=t.textarea.value.split("\n"),e=t.caretPosition>0?t.textarea.value.slice(0,+(t.caretPosition-1)+1||9e9).split("\n").length:1,a=t.textarea.value.slice(t.caretPosition).split("\n")[0],n=i[e-1],s=n.match(/^(\s*- ).*/),s&&(r=n.match(/^(\s*)\-\s$/),r?(u=e-1,c=null):(u=e,c=""+s[1]),o=d(t.textarea,u,c)),s=n.match(/^(\s*\* ).*/),s&&(r=n.match(/^(\s*\* )$/),r?(u=e-1,c=null):(u=e,c=""+s[1]),o=d(t.textarea,u,c)),s=n.match(/^(\s*)(\d+)\.\s/),s&&(r=n.match(/^(\s*)(\d+)\.\s$/),r?(u=e-1,c=null):(u=e,c=s[1]+(parseInt(s[2],10)+1)+". "),o=d(t.textarea,u,c)),o?k(t.textarea,o):void 0}},markupSet:[{name:a.instant("COMMON.WYSIWYG.H1_BUTTON"),key:"1",placeHolder:a.instant("COMMON.WYSIWYG.H1_SAMPLE_TEXT"),closeWith:function(t){return g(t,"=")}},{name:a.instant("COMMON.WYSIWYG.H2_BUTTON"),key:"2",placeHolder:a.instant("COMMON.WYSIWYG.H2_SAMPLE_TEXT"),closeWith:function(t){return g(t,"-")}},{name:a.instant("COMMON.WYSIWYG.H3_BUTTON"),key:"3",openWith:"### ",placeHolder:a.instant("COMMON.WYSIWYG.H3_SAMPLE_TEXT")},{separator:"---------------"},{name:a.instant("COMMON.WYSIWYG.BOLD_BUTTON"),key:"B",openWith:"**",closeWith:"**",placeHolder:a.instant("COMMON.WYSIWYG.BOLD_BUTTON_SAMPLE_TEXT")},{name:a.instant("COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT"),key:"I",openWith:"_",closeWith:"_",placeHolder:a.instant("COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT")},{name:a.instant("COMMON.WYSIWYG.STRIKE_BUTTON"),key:"S",openWith:"~~",closeWith:"~~",placeHolder:a.instant("COMMON.WYSIWYG.STRIKE_SAMPLE_TEXT")},{separator:"---------------"},{name:a.instant("COMMON.WYSIWYG.BULLETED_LIST_BUTTON"),openWith:"- ",placeHolder:a.instant("COMMON.WYSIWYG.BULLETED_LIST_SAMPLE_TEXT")},{name:a.instant("COMMON.WYSIWYG.NUMERIC_LIST_BUTTON"),openWith:function(t){return t.line+". "},placeHolder:a.instant("COMMON.WYSIWYG.NUMERIC_LIST_SAMPLE_TEXT")},{separator:"---------------"},{name:a.instant("COMMON.WYSIWYG.PICTURE_BUTTON"),key:"P",openWith:"![",closeWith:'](<<<[![Url:!:http://]!]>>> "[![Title]!]")',placeHolder:a.instant("COMMON.WYSIWYG.PICTURE_SAMPLE_TEXT"),beforeInsert:function(t){return v(t)},afterInsert:function(t){return I(t)}},{name:a.instant("COMMON.WYSIWYG.LINK_BUTTON"),key:"L",openWith:"[",closeWith:'](<<<[![Url:!:http://]!]>>> "[![Title]!]")',placeHolder:a.instant("COMMON.WYSIWYG.LINK_SAMPLE_TEXT"),beforeInsert:function(t){return v(t)},afterInsert:function(t){return I(t)}},{separator:"---------------"},{name:a.instant("COMMON.WYSIWYG.QUOTE_BLOCK_BUTTON"),openWith:"> ",placeHolder:a.instant("COMMON.WYSIWYG.QUOTE_BLOCK_SAMPLE_TEXT")},{name:a.instant("COMMON.WYSIWYG.CODE_BLOCK_BUTTON"),openWith:"```\n",placeHolder:a.instant("COMMON.WYSIWYG.CODE_BLOCK_SAMPLE_TEXT"),closeWith:"\n```"},{separator:"---------------"},{name:a.instant("COMMON.WYSIWYG.PREVIEW_BUTTON"),call:_,className:"preview-icon"}],afterInsert:function(t){var e;return e=angular.element(t.textarea),p.$setViewValue(e.val())}},m.markItUpRemove().markItUp(t).textcomplete([{cache:!0,match:/(^|\s)#([a-z0-9]+)$/i,search:function(t,r){var i,s,a;return t=n.slugify(t),a=["issues","tasks","userstories"],s=["ref","subject"],i=function(e){return function(e){var r,i,o;for(r=0,i=s.length;i>r;r++)if(o=s[r],n.slugify(e[o]).indexOf(t)>=0)return!0;return!1}}(this),f&&f.abort(),f=e.search["do"](o.projectId,t),f.then(function(t){return function(t){var e,n,o,s;if(t.count<1||t.count===t.wikipages.length)return r([]);for(o=[],e=0,n=a.length;n>e;e++)s=a[e],t[s]&&t[s].length>0?o.push(r(t[s].filter(i),!0)):o.push(void 0);return o}}(this)),r([])},replace:function(t){return"$1#"+t.ref+" "},template:function(t,e){return"#"+t.ref+" - "+t.subject}},{cache:!0,match:/(^|\s)@([a-z0-9\-\._]{2,})$/i,search:function(t,e){var r,i;return i=n.slugify(t),r=["username","full_name","full_name_display"],e(o.project.members.length<1?[]:o.project.members.filter(function(t){return function(t){var e,o,s;for(e=0,o=r.length;o>e;e++)if(s=r[e],n.slugify(t[s]).indexOf(i)>=0)return!0;return!1}}(this)))},replace:function(t){return"$1@"+t.username+" "},template:function(t){return t.username+" - "+t.full_name_display}},{cache:!0,match:/(^|\s)\[\[([a-z0-9\-]+)$/i,search:function(t,r){return t=n.slugify(t),e.search["do"](o.projectId,t).then(function(e){return function(e){return e.count<1&&r([]),e.count<1||!e.wikipages||e.wikipages.length<=0?r([]):r(e.wikipages.filter(function(e){return n.slugify(e.slug).indexOf(t)>=0}),!0),r([])}}(this))},replace:function(t){return"$1[["+t.slug+"]]"},template:function(t,e){return t.slug}}],{debounce:200})},S(),j=t.$on("$translateChangeEnd",S),m.on("keypress",function(t){return o.$apply()}),o.$on("$destroy",function(){return u.off(),j()})},{link:u,require:"ngModel"}},r.directive("tgMarkitup",["$rootScope","$tgResources","$selectedText","$tgTemplate","$compile","$translate",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u;a=this.taiga,i=this.taiga.mixOf,u=this.taiga.toggleText,s=this.taiga.scopeDefer,e=this.taiga.bindOnce,n=this.taiga.groupBy,r=this.taiga.debounceLeading,o=angular.module("taigaBacklog"),t=function(t,e,n,i,o){var s,a,u;return a=i.get("backlog/filters.html",!0),u=i.get("backlog/filter-selected.html",!0),s=function(e,n,i){var s,c,l,p,d,f,h,m,g,v,y,b;return c="",s=n.closest(".wrapper").controller(),g=[],y=function(t,e){return n.find(".filters-cats").hide(),n.find(".filter-list").removeClass("hidden"),n.find("h2.breadcrumb").removeClass("hidden"),n.find("h2 a.subfilter span.title").html(t),n.find("h2 a.subfilter span.title").prop("data-type",e),c=l()},v=function(){return n.find(".filters-cats").show(),n.find(".filter-list").addClass("hidden"),n.find("h2.breadcrumb").addClass("hidden")},p=function(){var t,r,n,i,o,s;v(),g=[],i=e.filters;for(n in i)for(s=i[n],t=0,r=s.length;r>t;t++)o=s[t],o.selected&&g.push(o);return h()},h=function(){var t;return _.map(g,function(t){return function(t){return t.color?t.style="border-left: 3px solid "+t.color:void 0}}(this)),t=u({filters:g}),t=o(t)(e),n.find(".filters-applied").html(t)},f=function(t){var r;return _.map(t,function(t){return function(t){return t.color?t.style="border-left: 3px solid "+t.color:void 0}}(this)),r=a({filters:t}),r=o(r)(e),n.find(".filter-list").html(r)},l=function(){return n.find("h2 a.subfilter span.title").prop("data-type")},d=function(){return c=l(),t.all([s.loadUserstories(!0),s.generateFilters()]).then(function(){var t;return t=e.filters[c],f(_.reject(t,"selected"))})},b=function(t,r){var n,i;return c=l(),i=e.filters[t],n=_.find(i,{id:r}),n.selected=!n.selected,n.selected?(g.push(n),e.$apply(function(){return s.selectFilter(t,r)})):(g=_.reject(g,function(t){return n.type===t.type&&n.id===t.id}),s.unselectFilter(t,r)),h(g),t===c&&f(_.reject(i,"selected")),d()},m=r(100,function(t){return void 0!==t?(0===t.length?s.replaceFilter("q",null):s.replaceFilter("q",t),d()):void 0}),e.$watch("filtersQ",m),e.$on("backlog:loaded",function(t){return p()}),e.$on("filters:update",function(t){return s.generateFilters().then(function(){var t;return t=e.filters[c],c?f(_.reject(t,"selected")):void 0})}),n.on("click",".filters-cats > ul > li > a",function(t){var r,n;return t.preventDefault(),n=angular.element(t.currentTarget),r=e.filters[n.data("type")],f(_.reject(r,"selected")),y(n.attr("title"),n.data("type"))}),n.on("click",".filters-inner > .filters-step-cat > .breadcrumb > .back",function(t){return t.preventDefault(),v()}),n.on("click",".remove-filter",function(t){var e,r,n;return t.preventDefault(),r=angular.element(t.currentTarget).parent(),e=r.data("id"),n=r.data("type"),b(n,e)}),n.on("click",".filter-list .single-filter",function(t){var e,r,n;return t.preventDefault(),r=angular.element(t.currentTarget),r.hasClass("active")?r.removeClass("active"):r.addClass("active"),e=r.data("id"),n=r.data("type"),b(n,e)})},{link:s}},o.directive("tgBacklogFilters",["$q","$log","$tgLocation","$tgTemplate","$compile",t])}.call(this),function(){var t,e,r,n,i;i=this.taiga,e=this.taiga.bindOnce,r=this.taiga.debounce,n=angular.module("taigaBacklog"),t=function(t,e,n,i,o,s,a){var u;return u=function(n,u,c){var l,p,d,f,h,m,g;return f=!1,l=!0,p=null,m=function(){return p&&p.reset(),n.sprint={project:null,name:null,estimated_start:null,estimated_finish:null}},g=r(2e3,function(r){return function(r){var c,d,h,m,g,v,_;return r.preventDefault(),_=angular.element(r.currentTarget),m=a.instant("COMMON.PICKERDATE.FORMAT"),v=u.find(".submit-button"),p=u.find("form").checksley(),p.validate()?(f=!1,h=angular.copy(n.sprint),c=null,l?(h.estimated_start=moment(h.estimated_start,m).format("YYYY-MM-DD"),h.estimated_finish=moment(h.estimated_finish,m).format("YYYY-MM-DD"),g=t.create("milestones",h),c="sprintform:create:success"):(h.setAttr("estimated_start",moment(h.estimated_start,m).format("YYYY-MM-DD")),h.setAttr("estimated_finish",moment(h.estimated_finish,m).format("YYYY-MM-DD")),g=t.save(h),c="sprintform:edit:success"),d=s().target(v).start(),g.then(function(t){return d.finish(),l&&(n.sprintsCounter+=1),i.$broadcast(c,t),o.close(u)}),g.then(null,function(t){return d.finish(),p.setErrors(t),t._error_message?e.notify("light-error",t._error_message):t.__all__?e.notify("light-error",t.__all__[0]):void 0})):(f=!0,void u.find(".last-sprint-name").addClass("disappear"))}}(this)),h=function(){var r,s;return s=a.instant("LIGHTBOX.DELETE_SPRINT.TITLE"),r=n.sprint.name,e.askOnDelete(s,r).then(function(r){return function(r){var s,a;return a=function(){return r.finish(),n.milestonesCounter-=1,o.close(u),i.$broadcast("sprintform:remove:success",n.sprint)},s=function(){return r.finish(!1),e.notify("error")},t.remove(n.sprint).then(a,s)}}(this))},d=function(){var t,e;return t=_.filter(n.sprints,function(t){return!t.closed}),e=_.sortBy(t,function(t){return moment(t.estimated_finish,"YYYY-MM-DD").format("X")}),e[e.length-1]},n.$on("sprintform:create",function(t,e){var r,i,s,c,f,h;return m(),p=u.find("form").checksley(),p.reset(),l=!0,f=a.instant("COMMON.PICKERDATE.FORMAT"),n.sprint.project=e,n.sprint.name=null,n.sprint.slug=null,s=d(),i=moment(),s?i=moment(s.estimated_finish):n.sprint.estimated_start&&(i=moment(n.sprint.estimated_start)),n.sprint.estimated_start=i.format(f),r=moment().add(2,"weeks"),s?r=moment(s.estimated_finish).add(2,"weeks"):n.sprint.estimated_finish&&(r=moment(n.sprint.estimated_finish)),n.sprint.estimated_finish=r.format(f),c=u.find(".last-sprint-name"),null!=(null!=s?s.name:void 0)&&(h=a.instant("LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME",{lastSprint:s.name}),c.html(h)),u.find(".delete-sprint").addClass("hidden"),h=a.instant("LIGHTBOX.ADD_EDIT_SPRINT.TITLE"),u.find(".title").text(h),h=a.instant("COMMON.CREATE"),u.find(".button-green").text(h),o.open(u),u.find(".sprint-name").focus(),u.find(".last-sprint-name").removeClass("disappear")}),n.$on("sprintform:edit",function(t,e){var r,i,s;return m(),l=!1,i=a.instant("COMMON.PICKERDATE.FORMAT"),n.$apply(function(){return n.sprint=e,n.sprint.estimated_start=moment(n.sprint.estimated_start).format(i),n.sprint.estimated_finish=moment(n.sprint.estimated_finish).format(i)}),u.find(".delete-sprint").removeClass("hidden"),r=a.instant("BACKLOG.EDIT_SPRINT"),u.find(".title").text(r),s=a.instant("COMMON.SAVE"),u.find(".button-green").text(s),o.open(u),u.find(".sprint-name").focus().select(),u.find(".last-sprint-name").addClass("disappear")}),u.on("keyup",".sprint-name",function(t){return u.find(".sprint-name").val().length>0||f?u.find(".last-sprint-name").addClass("disappear"):u.find(".last-sprint-name").removeClass("disappear")}),u.on("submit","form",g),u.on("click",".delete-sprint",function(t){return t.preventDefault(),h()}),n.$on("$destroy",function(){return u.off()}),m()},{link:u}},n.directive("tgLbCreateEditSprint",["$tgRepo","$tgConfirm","$tgResources","$rootScope","lightboxService","$tgLoading","$translate",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m,g,v=function(t,e){function r(){this.constructor=t}for(var n in e)y.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},y={}.hasOwnProperty;h=this.taiga,p=this.taiga.mixOf,g=this.taiga.toggleText,f=this.taiga.scopeDefer,u=this.taiga.bindOnce,l=this.taiga.groupBy,m=this.taiga.timeout,a=this.taiga.bindMethods,c=this.taiga.generateHash,d=angular.module("taigaBacklog"),t=function(t){function e(t,e,r,n,i,o,s,u,c,l,p,d,f,h,m,g){var v;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=u,this.appMetaService=c,this.navUrls=l,this.events=p,this.analytics=d,this.translate=f,this.loading=h,this.rs2=m,this.modelTransform=g,a(this),this.page=1,this.disablePagination=!1,this.firstLoadComplete=!1,this.scope.userstories=[],this.scope.sectionName=this.translate.instant("BACKLOG.SECTION_NAME"),this.showTags=!1,this.activeFilters=!1,this.scope.showGraphPlaceholder=null,this.initializeEventHandlers(),v=this.loadInitialData(),v.then(function(t){return function(){var e,r;return t.firstLoadComplete=!0,r=t.translate.instant("BACKLOG.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.translate.instant("BACKLOG.PAGE_DESCRIPTION",{projectName:t.scope.project.name,projectDescription:t.scope.project.description}),t.appMetaService.setAll(r,e),t.rs.userstories.getShowTags(t.scope.projectId)?(t.showTags=!0,t.scope.$broadcast("showTags",t.showTags)):void 0}}(this)),v.then(null,this.onInitialDataError.bind(this))}return v(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate","$tgLoading","tgResources","$tgQueueModelTransformation"],e.prototype.initializeEventHandlers=function(){return this.scope.$on("usform:bulk:success",function(t){return function(){return t.loadUserstories(!0),t.loadProjectStats(),t.analytics.trackEvent("userstory","create","bulk create userstory on backlog",1)}}(this)),this.scope.$on("sprintform:create:success",function(t){return function(){return t.loadSprints(),t.loadProjectStats(),t.analytics.trackEvent("sprint","create","create sprint on backlog",1)}}(this)),this.scope.$on("usform:new:success",function(t){return function(){return t.loadUserstories(!0),t.loadProjectStats(),t.rootscope.$broadcast("filters:update"),t.analytics.trackEvent("userstory","create","create userstory on backlog",1)}}(this)),this.scope.$on("sprintform:edit:success",function(t){return function(){return t.loadProjectStats()}}(this)),this.scope.$on("sprintform:remove:success",function(t){return function(e,r){return t.loadSprints(),t.loadProjectStats(),t.loadUserstories(!0),r.closed&&t.loadClosedSprints(),t.rootscope.$broadcast("filters:update")}}(this)),this.scope.$on("usform:edit:success",function(t){return function(e,r){var n;return n=_.findIndex(t.scope.userstories,function(t){return t.id===r.id}),t.scope.userstories[n]=r,t.rootscope.$broadcast("filters:update")}}(this)),this.scope.$on("sprint:us:move",this.moveUs),this.scope.$on("sprint:us:moved",function(t){return function(){return t.loadSprints(),t.loadProjectStats()}}(this)),this.scope.$on("backlog:load-closed-sprints",this.loadClosedSprints),this.scope.$on("backlog:unload-closed-sprints",this.unloadClosedSprints)},e.prototype.initializeSubscription=function(){var t,e;return t="changes.project."+this.scope.projectId+".userstories",this.events.subscribe(this.scope,t,function(t){return function(e){return t.loadAllPaginatedUserstories(),t.loadSprints()}}(this)),e="changes.project."+this.scope.projectId+".milestones",this.events.subscribe(this.scope,e,function(t){return function(e){return t.loadSprints()}}(this))},e.prototype.toggleShowTags=function(){return this.scope.$apply(function(t){return function(){return t.showTags=!t.showTags,t.rs.userstories.storeShowTags(t.scope.projectId,t.showTags)}}(this))},e.prototype.toggleActiveFilters=function(){return this.activeFilters=!this.activeFilters},e.prototype.loadProjectStats=function(){return this.rs.projects.stats(this.scope.projectId).then(function(t){return function(e){var r;return t.scope.stats=e,r=e.total_points?e.total_points:e.defined_points,r?t.scope.stats.completedPercentage=Math.round(100*e.closed_points/r):t.scope.stats.completedPercentage=0,t.scope.showGraphPlaceholder=!(null!=e.total_points&&null!=e.total_milestones),e}}(this))},e.prototype.unloadClosedSprints=function(){return this.scope.$apply(function(t){return function(){return t.scope.closedSprints=[],t.rootscope.$broadcast("closed-sprints:reloaded",[])}}(this))},e.prototype.loadClosedSprints=function(){var t;return t={closed:!0},this.rs.sprints.list(this.scope.projectId,t).then(function(t){return function(e){var r,n,i,o;for(o=e.milestones,t.scope.totalClosedMilestones=e.closed,r=0,n=o.length;n>r;r++)i=o[r],i.user_stories=_.sortBy(i.user_stories,"sprint_order");return t.scope.closedSprints=o,t.scope.closedSprintsById=l(o,function(t){return t.id}),t.rootscope.$broadcast("closed-sprints:reloaded",o),o}}(this))},e.prototype.loadSprints=function(){var t;return t={closed:!1},this.rs.sprints.list(this.scope.projectId,t).then(function(t){return function(e){var r,n,i,o;for(o=e.milestones,t.scope.totalMilestones=o,t.scope.totalClosedMilestones=e.closed,t.scope.totalOpenMilestones=e.open,t.scope.totalMilestones=t.scope.totalOpenMilestones+t.scope.totalClosedMilestones,r=0,n=o.length;n>r;r++)i=o[r],i.user_stories=_.sortBy(i.user_stories,"sprint_order");return t.scope.sprints=o,t.scope.openSprints=_.filter(o,function(t){return!t.closed}).reverse(),t.scope.closedSprints||(t.scope.closedSprints=[]),t.scope.sprintsCounter=o.length,t.scope.sprintsById=l(o,function(t){return t.id}),t.rootscope.$broadcast("sprints:loaded",o),t.scope.currentSprint=t.findCurrentSprint(),o}}(this))},e.prototype.restoreFilters=function(){var t,e;return e=this.scope.oldSelectedTags,t=this.scope.oldSelectedStatuses,t||t?(this.scope.filtersQ=this.scope.filtersQOld,this.replaceFilter("q",this.scope.filtersQ),_.each([e,t],function(t){return function(e){return _.each(e,function(e){var r,n;return n=t.scope.filters[e.type],
r=_.find(n,{id:e.id}),r.selected=!0,t.selectFilter(e.type,e.id)})}}(this)),this.loadUserstories()):void 0},e.prototype.resetFilters=function(){var t,e;return e=_.filter(this.scope.filters.tags,"selected"),t=_.filter(this.scope.filters.status,"selected"),this.scope.oldSelectedTags=e,this.scope.oldSelectedStatuses=t,this.scope.filtersQOld=this.scope.filtersQ,this.scope.filtersQ=void 0,this.replaceFilter("q",this.scope.filtersQ),_.each([e,t],function(t){return function(e){return _.each(e,function(e){var r,n;return n=t.scope.filters[e.type],r=_.find(n,{id:e.id}),r.selected=!1,t.unselectFilter(e.type,e.id)})}}(this)),this.loadUserstories()},e.prototype.loadAllPaginatedUserstories=function(){var t;return t=this.page,this.loadUserstories(!0,this.scope.userstories.length).then(function(e){return function(){return e.page=t}}(this))},e.prototype.loadUserstories=function(t,e){var r;return null==t&&(t=!1),this.scope.projectId?(this.loadingUserstories=!0,this.disablePagination=!0,this.scope.httpParams=this.getUrlFilters(),this.rs.userstories.storeQueryParams(this.scope.projectId,this.scope.httpParams),t&&(this.page=1),this.scope.httpParams.page=this.page,r=this.rs.userstories.listUnassigned(this.scope.projectId,this.scope.httpParams,e),r.then(function(e){return function(r){var n,i;return i=r[0],n=r[1],t&&(e.scope.userstories=[]),e.scope.userstories=e.scope.userstories.concat(_.sortBy(i,"backlog_order")),e.setSearchDataFilters(),e.loadingUserstories=!1,n("x-pagination-next")&&(e.disablePagination=!1,e.page++),f(e.scope,function(){return e.scope.$broadcast("userstories:loaded")}),i}}(this))):null},e.prototype.loadBacklog=function(){return this.q.all([this.loadProjectStats(),this.loadSprints(),this.loadUserstories()])},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return e.is_backlog_activated||t.location.path(t.navUrls.resolve("permission-denied")),t.scope.projectId=e.id,t.scope.project=e,t.scope.closedMilestones=!!e.total_closed_milestones,t.scope.$emit("project:loaded",e),t.scope.points=_.sortBy(e.points,"order"),t.scope.pointsById=l(e.points,function(t){return t.id}),t.scope.usStatusById=l(e.us_statuses,function(t){return t.id}),t.scope.usStatusList=_.sortBy(e.us_statuses,"id"),e}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(e){return t.fillUsersAndRoles(e.members,e.roles),t.initializeSubscription()}}(this)),t.then(function(t){return function(){return t.loadBacklog()}}(this)).then(function(t){return function(){return t.generateFilters()}}(this)).then(function(t){return function(){return t.scope.$emit("backlog:loaded")}}(this))},e.prototype.prepareBulkUpdateData=function(t,e){return null==e&&(e="backlog_order"),_.map(t,function(t){return{us_id:t.id,order:t[e]}})},e.prototype.resortUserStories=function(t,e){var r,n,i,o,s;for(null==e&&(e="backlog_order"),i=[],r=o=0,s=t.length;s>o;r=++o)n=t[r],n[e]=r,n.isModified()&&i.push(n);return i},e.prototype.moveUs=function(t,e,r,n){var i,o,s,a,u,c,l,p,d,f,h,m,g,v,y,b,$,S,k,j,I,T,E;if(b=e[0].milestone,$=e[0].project,m=!1,g=!1,I=this.scope.sprintsById[b],!I&&this.scope.closedSprintsById&&(I=this.scope.closedSprintsById[b],I&&(m=!0)),y=this.scope.sprintsById[n],!y&&n&&(y=this.scope.closedSprintsById[n],y&&(g=!0)),n===b)return s=null,E=null,E=null===n?this.scope.userstories:y.user_stories,this.scope.$apply(function(){var t,n,i,o,s,a;for(i=n=0,o=e.length;o>n;i=++n)a=e[i],s=E.indexOf(a),E.splice(s,1);return t=[r,0].concat(e),Array.prototype.splice.apply(E,t)}),null===n?(s=this.resortUserStories(E,"backlog_order"),o=this.prepareBulkUpdateData(s,"backlog_order"),this.rs.userstories.bulkUpdateBacklogOrder($,o).then(function(t){return function(){return t.rootscope.$broadcast("sprint:us:moved")}}(this))):(s=this.resortUserStories(E,"sprint_order"),o=this.prepareBulkUpdateData(s,"sprint_order"),this.rs.userstories.bulkUpdateSprintOrder($,o).then(function(t){return function(){return t.rootscope.$broadcast("sprint:us:moved")}}(this))),S;if(null===n){for(a=0,l=e.length;l>a;a++)T=e[a],T.milestone=null;return this.scope.$apply(function(t){return function(){var n,i,o,s,a,u;for(n=[r,0].concat(e),Array.prototype.splice.apply(t.scope.userstories,n),u=[],i=o=0,s=e.length;s>o;i=++o)T=e[i],a=I.user_stories.indexOf(T),u.push(I.user_stories.splice(a,1));return u}}(this)),S=this.repo.save(T),S=S.then(function(t){return function(){return s=t.resortUserStories(t.scope.userstories,"backlog_order"),o=t.prepareBulkUpdateData(s,"backlog_order"),t.rs.userstories.bulkUpdateBacklogOrder(T.project,o).then(function(){return t.rootscope.$broadcast("sprint:us:moved"),m?t.rootscope.$broadcast("backlog:load-closed-sprints"):void 0})}}(this)),S.then(null,function(){return console.log("FAIL")}),S}if(null===b){for(c=0,p=e.length;p>c;c++)T=e[c],T.milestone=n;for(i=[r,0].concat(e),Array.prototype.splice.apply(y.user_stories,i),u=h=0,d=e.length;d>h;u=++h)T=e[u],j=this.scope.userstories.indexOf(T),this.scope.userstories.splice(j,1)}else{for(v=0,f=e.length;f>v;v++)T=e[v],T.milestone=n;this.scope.$apply(function(t){return function(){var t,n,o;for(i=[r,0].concat(e),Array.prototype.splice.apply(y.user_stories,i),o=[],n=0,t=e.length;t>n;n++)T=e[n],j=I.user_stories.indexOf(T),o.push(I.user_stories.splice(j,1));return o}}(this))}return k=_.map(e,function(t){return function(e){return t.repo.save(e)}}(this)),S=this.q.all(k).then(function(t){return function(){return s=t.resortUserStories(y.user_stories,"sprint_order"),o=t.prepareBulkUpdateData(s,"sprint_order"),t.rs.userstories.bulkUpdateSprintOrder($,o).then(function(e){return t.rootscope.$broadcast("sprint:us:moved")}),t.rs.userstories.bulkUpdateBacklogOrder($,o).then(function(){return t.rootscope.$broadcast("sprint:us:moved")}),g||m?t.scope.$broadcast("backlog:load-closed-sprints"):void 0}}(this)),S.then(null,function(){return console.log("FAIL")}),S},e.prototype.isFilterSelected=function(t,e){return!(null==this.searchdata[t]||!this.searchdata[t][e])},e.prototype.setSearchDataFilters=function(){var t,e,r,n,i;r=this.getUrlFilters(),r.q&&(this.scope.filtersQ=this.scope.filtersQ||r.q),this.searchdata={},e=[];for(t in r)i=r[t],null==this.searchdata[t]&&(this.searchdata[t]={}),e.push(function(){var e,r,o,s;for(o=h.toString(i).split(","),s=[],e=0,r=o.length;r>e;e++)n=o[e],s.push(this.searchdata[t][n]=!0);return s}.call(this));return e},e.prototype.getUrlFilters=function(){return _.pick(this.location.search(),"status","tags","q")},e.prototype.generateFilters=function(){var t,e;return e=this.getUrlFilters(),this.scope.filters={},t={},t.project=this.scope.projectId,t.tags=e.tags,t.status=e.status,t.q=e.q,t.milestone="null",this.rs.userstories.filtersData(t).then(function(t){return function(r){var n,i,o,s;return n=function(t,e,r){return _.map(t,function(t){return t.type=e,t})},s=function(t){return _.map(t,function(t){return t.id=t.name,t.type="tags",t})},t.scope.filters.status=n(r.statuses,"status",t.scope.usStatusById),t.scope.filters.tags=s(r.tags),o=_.filter(t.scope.filters.tags,"selected"),o=_.map(o,"id"),i=_.filter(t.scope.filters.status,"selected"),i=_.map(i,"id"),t.markSelectedFilters(t.scope.filters,e),t.rs.userstories.storeQueryParams(t.scope.projectId,{status:i,tags:o,project:t.scope.projectId,milestone:null})}}(this))},e.prototype.markSelectedFilters=function(t,e){var r,n,i,o,s,a,u,c,l,p,d,f;p={},u=_.omit(e,"page","orderBy");for(s in u)for(f=u[s],null==p[s]&&(p[s]={}),c=(""+f).split(","),n=0,o=c.length;o>n;n++)d=c[n],p[s][d]=!0;r=function(t,e){return!(null==p[t]||!p[t][e])},l=[];for(i in t)f=t[i],l.push(function(){var t,e,n;for(n=[],t=0,e=f.length;e>t;t++)a=f[t],n.push(a.selected=r(a.type,a.id)?!0:void 0);return n}());return l},e.prototype.updateUserStoryStatus=function(){return this.setSearchDataFilters(),this.generateFilters().then(function(t){return function(){return t.rootscope.$broadcast("filters:update"),t.loadProjectStats()}}(this))},e.prototype.editUserStory=function(t,e,r){var n,i;return i=$(r.target),n=this.loading().target(i).removeClasses("edit-story").timeout(200).start(),this.rs.userstories.getByRef(t,e).then(function(e){return function(r){return e.rs2.attachments.list("us",r.id,t).then(function(t){return e.rootscope.$broadcast("usform:edit",r,t.toJS()),n.finish()})}}(this))},e.prototype.deleteUserStory=function(t){var e,r;return r=this.translate.instant("US.TITLE_DELETE_ACTION"),e=t.subject,this.confirm.askOnDelete(r,e).then(function(e){return function(r){var n;return e.scope.userstories=_.without(e.scope.userstories,t),n=e.repo.remove(t),n.then(function(){return r.finish(),e.q.all([e.loadProjectStats(),e.loadSprints()])}),n.then(null,function(){return r.finish(!1),e.confirm.notify("error")})}}(this))},e.prototype.addNewUs=function(t){switch(t){case"standard":return this.rootscope.$broadcast("usform:new",this.scope.projectId,this.scope.project.default_us_status,this.scope.usStatusList);case"bulk":return this.rootscope.$broadcast("usform:bulk",this.scope.projectId,this.scope.project.default_us_status)}},e.prototype.addNewSprint=function(){return this.rootscope.$broadcast("sprintform:create",this.scope.projectId)},e.prototype.findCurrentSprint=function(){var t;return t=(new Date).getTime(),_.find(this.scope.sprints,function(e){var r,n;return n=moment(e.estimated_start,"YYYY-MM-DD").format("x"),r=moment(e.estimated_finish,"YYYY-MM-DD").format("x"),t>=n&&r>=t})},e}(p(h.Controller,h.PageMixin,h.FiltersMixin)),d.controller("BacklogController",t),e=function(t,e,r){var n,i,o,s,a,u,c;return n=_.template('<div class="doom-line"><span><%- text %></span></div>'),o=function(t,e,i,o){var s,a,u,c;return u=function(){var r,n,i,o,a,u,l,p,d,f;if(null!=t.stats&&null!=t.stats.total_points&&0!==t.stats.total_points){if(c(),p=t.stats,d=p.total_points,r=p.assigned_points,!t.userstories)return;for(u=t.userstories,l=[],i=o=0,a=u.length;a>o;i=++o){if(f=u[i],r+=f.total_points,r>d){n=e.find(".backlog-table-body .us-item-row")[i],s(n);break}l.push(void 0)}return l}},c=function(){return e.find(".doom-line").remove()},s=function(t){var e;return e=r.instant("BACKLOG.DOOMLINE"),$(t).before(n({text:e}))},a=function(){var t;return t=e.find(".backlog-table-body .us-item-row"),_.map(t,function(t){return angular.element(t)})},t.$on("userstories:loaded",u),t.$watch("stats",u)},a=function(e,r,n,i){var o,s,a,u,l,p,d;return s=function(){var t;return t=r.find(".backlog-table-body input:checkbox:checked"),_.map(t,function(t){var r;return t=$(t).closest(".tg-scope"),r=t.scope(),r.us.milestone=e.sprints[0].id,r.us})},p=function(n,o){var s,a,u;return u=_(e.userstories),e.userstories=u.without.apply(u,n).value(),s=_.map(n,function(t,e){return t.total_points}),a=_.reduce(s,function(t,e){return t+e}),o.user_stories=_.union(o.user_stories,n),o.total_points+=a,t.saveAll(n).then(function(){return i.loadSprints(),i.loadProjectStats()}),r.find(".move-to-sprint").hide()},u=function(t){return p(t,e.currentSprint)},l=function(t){return p(t,e.sprints[0])},d=!1,a=null,o=function(t){var n,i;return a=t.closest(".us-item-row"),t.closest(".us-item-row").toggleClass("ui-multisortable-multiple"),n=r.find(".move-to-sprint"),i=r.find(".backlog-table-body input:checkbox:checked"),i.length>0&&e.sprints.length>0?n.show():n.hide()},$(window).on("keydown.shift-pressed keyup.shift-pressed",function(t){return d=!!t.shiftKey,!0}),r.on("change",".backlog-table-body input:checkbox",function(t){var e,r,n,i,s;return a&&d&&(r=[],e=$(t.currentTarget).closest(".us-item-row"),n=a.nextAll(),i=a.prevAll(),_.some(n,function(t){return t===e[0]})?r=a.nextUntil(e):_.some(i,function(t){return t===e[0]})&&(r=a.prevUntil(e)),_.map(r,function(t){var e;return e=$(t).find("input:checkbox"),e.prop("checked",!0),o(e)})),s=angular.element(t.currentTarget),s.closest(".us-item-row").toggleClass("is-checked"),o(s)}),r.on("click","#move-to-latest-sprint",function(t){return function(t){var r;return r=s(),e.$apply(_.partial(l,r))}}(this)),r.on("click","#move-to-current-sprint",function(t){return function(t){var r;return r=s(),e.$apply(_.partial(u,r))}}(this)),r.on("click","#show-tags",function(t){return t.preventDefault(),i.toggleShowTags(),c(i)})},c=function(t){var e,n;return e=angular.element("#show-tags"),t.showTags?(e.addClass("active"),n=r.instant("BACKLOG.TAGS.HIDE"),e.text(n)):(e.removeClass("active"),n=r.instant("BACKLOG.TAGS.SHOW"),e.text(n))},u=function(t,n,i){var o,s,a,u;return a=n.find("sidebar.filters-bar"),a.one("transitionend",function(){return m(150,function(){return e.$broadcast("resize"),$(".burndown").css("visibility","visible")})}),u=angular.element("#show-filters-button"),$(".burndown").css("visibility","hidden"),a.toggleClass("active"),u.toggleClass("active"),o=r.instant("BACKLOG.FILTERS.HIDE"),s=r.instant("BACKLOG.FILTERS.SHOW"),g(u,[o,s]),a.hasClass("active")?i.restoreFilters():i.resetFilters(),i.toggleActiveFilters()},s=function(t,e,r,n){return t.filtersSearch={},e.on("click","#show-filters-button",function(r){return r.preventDefault(),t.$apply(function(){return u(t,e,n)})})},i=function(t,e,r,n){var i,l;return i=e.controller(),a(t,e,r,i),s(t,e,r,i),o(t,e,r,i),l=i.getUrlFilters(),(l.status||l.tags||l.q)&&u(t,e,i),t.$on("showTags",function(){return c(i)}),t.$on("$destroy",function(){return e.off(),$(window).off(".shift-pressed")})},{link:i}},d.directive("tgBacklog",["$tgRepo","$rootScope","$translate",e]),s=function(t,e,r,n){var i,o;return o=e.get("backlog/us-role-points-popover.html",!0),i=function(e,i,s){return u(e,"project",function(t){var n,s;return s=_.filter(t.roles,"computable"),n=_.size(s),n>1?i.append(r(o({roles:s}))(e)):(i.find(".icon-arrow-down").remove(),i.find(".header-points").addClass("not-clickable"))}),e.$on("uspoints:select",function(t,e,r){return i.find(".popover").popover().close(),i.find(".header-points").html(r+"/<span>Total</span>")}),e.$on("uspoints:clear-selection",function(t,e){var r;return i.find(".popover").popover().close(),r=n.instant("COMMON.FIELDS.POINTS"),i.find(".header-points").text(r)}),i.on("click",function(t){var e;return e=angular.element(t.target),(e.is("span")||e.is("div"))&&t.stopPropagation(),i.find(".popover").popover().open()}),i.on("click",".clear-selection",function(e){return e.preventDefault(),e.stopPropagation(),t.$broadcast("uspoints:clear-selection")}),i.on("click",".role",function(e){var r,n;return e.preventDefault(),e.stopPropagation(),n=angular.element(e.currentTarget),r=n.scope(),t.$broadcast("uspoints:select",n.data("role-id"),n.text())}),e.$on("$destroy",function(){return i.off()})},{link:i}},d.directive("tgUsRolePointsSelector",["$rootScope","$tgTemplate","$compile","$translate",s]),o=function(t,e,r){var n,i;return i=r.get("common/estimation/us-points-roles-popover.html",!0),n=function(e,n,o){var s,a,u,c,l,p,d;return s=n.controller(),d=null,p=null,c=null,u=null,e.$on("uspoints:select",function(t,r,n){var i;return i=e.$eval(o.tgBacklogUsPoints),p=r,u.render()}),e.$on("uspoints:clear-selection",function(t){var r;return r=e.$eval(o.tgBacklogUsPoints),p=null,u.render()}),e.$watch(o.tgBacklogUsPoints,function(i){var o;return i?(u=t.create(n,i,e.project),o=u.calculateRoles(),0===o.length?(n.find(".icon-arrow-bottom").remove(),n.find("a.us-points").addClass("not-clickable")):1===o.length&&(p=_.keys(i.points)[0]),u.isEditable&&a(),u.onSelectedPointForRole=function(t,e,r){return i.points=r,u.render(),this.save(t,e).then(function(){return s.loadProjectStats()})},u.render=function(){var t,e,n,i,s,a,u,c,l;return l=this.calculateTotalPoints(),null==p||1===o.length?(u=l,c=l):(i=this.us.points[p],s=this.pointsById[i],u=s.name+" / <span>"+l+"</span>",c=s.name+" / "+l),t={totalPoints:l,roles:this.calculateRoles(),editable:this.isEditable,text:u,title:c},n="common/estimation/us-estimation-total.html",a=r.get(n,!0),e=a(t),this.$el.html(e)},u.render()):void 0}),l=function(){var t,e;return e=u.calculateRoles(),t=i({roles:e}),n.append(t),n.find(".pop-role").popover().open(function(){return $(this).remove()})},a=function(){return n.on("click","a.us-points",function(t){var r;return t.preventDefault(),t.stopPropagation(),r=e.$eval(o.tgBacklogUsPoints),d=p,null!=p?u.renderPointsSelector(p):l()}),n.on("click",".role",function(t){var r,i,s;return t.preventDefault(),t.stopPropagation(),i=angular.element(t.currentTarget),s=e.$eval(o.tgBacklogUsPoints),d=i.data("role-id"),r=n.find(".pop-role"),r.find("a").removeClass("active"),r.find("a[data-role-id='"+d+"']").addClass("active"),u.renderPointsSelector(d)})},e.$on("$destroy",function(){return n.off()})},{link:n}},d.directive("tgBacklogUsPoints",["$tgEstimationsService","$tgRepo","$tgTemplate",o]),i=function(t){var e,r,n;return e=function(){return $(".js-burndown-graph").removeClass("shown"),$(".js-toggle-burndown-visibility-button").removeClass("active"),$(".js-burndown-graph").removeClass("open")},n=function(t){return $(".js-toggle-burndown-visibility-button").addClass("active"),t?$(".js-burndown-graph").addClass("shown"):$(".js-burndown-graph").addClass("open")},r=function(r,i,o){var s,a,u;return s=!0,a=c(["is-burndown-grpahs-collapsed"]),r.isBurndownGraphCollapsed=t.get(a)||!1,u=function(){return r.isBurndownGraphCollapsed?e(s):n(s),s=!1},r.$watch("showGraphPlaceholder",function(){return null!=r.showGraphPlaceholder?(r.isBurndownGraphCollapsed=r.isBurndownGraphCollapsed||r.showGraphPlaceholder,u()):void 0}),i.on("click",".js-toggle-burndown-visibility-button",function(){return r.isBurndownGraphCollapsed=!r.isBurndownGraphCollapsed,t.set(a,r.isBurndownGraphCollapsed),u()}),r.$on("$destroy",function(){return i.off()})},{link:r}},d.directive("tgToggleBurndownVisibility",["$tgStorage",i]),r=function(t){var e,r;return r=function(e,r){var n,i,o,s,a,u,c,l,p,d,f;return d=e.width(),e.height(d/6),a=function(){l=[];for(var t=0,e=r.milestones.length-1;e>=0?e>=t:t>=e;e>=0?t++:t--)l.push(t);return l}.apply(this),o=[],f=_.map(r.milestones,function(t){return 0}),o.push({data:_.zip(a,f),lines:{fillColor:"rgba(0,0,0,0)"},points:{show:!1}}),u=_.map(r.milestones,function(t){return t.optimal}),o.push({data:_.zip(a,u),lines:{fillColor:"rgba(120,120,120,0.2)"}}),s=_.filter(_.map(r.milestones,function(t){return t.evolution}),function(t){return null!=t}),o.push({data:_.zip(a,s),lines:{fillColor:"rgba(102,153,51,0.3)"}}),n=_.map(r.milestones,function(t){return-t["team-increment"]-t["client-increment"]}),o.push({data:_.zip(a,n),lines:{fillColor:"rgba(255,51,51,0.3)"}}),p=_.map(r.milestones,function(t){return-t["team-increment"]}),o.push({data:_.zip(a,p),lines:{fillColor:"rgba(153,51,51,0.3)"}}),i=["rgba(0,0,0,1)","rgba(120,120,120,0.2)","rgba(102,153,51,1)","rgba(153,51,51,1)","rgba(255,51,51,1)"],c={grid:{borderWidth:{top:0,right:1,left:0,bottom:0},borderColor:"#ccc",hoverable:!0},xaxis:{ticks:r.milestones.length,axisLabel:t.instant("BACKLOG.CHART.XAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5,tickFormatter:function(t,e){return""}},yaxis:{axisLabel:t.instant("BACKLOG.CHART.YAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},series:{shadowSize:0,lines:{show:!0,fill:!0},points:{show:!0,fill:!0,radius:4,lineWidth:2}},colors:i,tooltip:!0,tooltipOpts:{content:function(e,n,i,o){var s;return 1===o.seriesIndex?(s={sprintName:r.milestones[n].name,value:Math.abs(i)},t.instant("BACKLOG.CHART.OPTIMAL",s)):2===o.seriesIndex?(s={sprintName:r.milestones[n].name,value:Math.abs(i)},t.instant("BACKLOG.CHART.REAL",s)):3===o.seriesIndex?(s={sprintName:r.milestones[n].name,value:Math.abs(i)},t.instant("BACKLOG.CHART.INCREMENT_CLIENT",s)):(s={sprintName:r.milestones[n].name,value:Math.abs(i)},t.instant("BACKLOG.CHART.INCREMENT_TEAM",s))}}},e.empty(),e.plot(o,c).data("plot")},e=function(t,e,n){var i;return i=angular.element(e),t.$watch("stats",function(e){return null!=t.stats?(r(i,t.stats),t.$on("resize",function(){return r(i,t.stats)})):void 0}),t.$on("$destroy",function(){return e.off()})},{link:e}},d.directive("tgBurndownBacklogGraph",["$translate",r]),n=function(t,e){var r,n,i,o;return o=t.get("backlog/progress-bar.html",!0),i=function(t,r,n,i){var s;return s=o({projectPointsPercentaje:n,closedPointsPercentaje:i}),s=e(s)(t),r.html(s)},r=function(t){var e;return e=_.max([0,t]),e=_.min([100,e]),Math.round(e)},n=function(t,e,n){var o;return o=angular.element(e),t.$watch(n.tgBacklogProgressBar,function(n){var o,s,a,u,c;return null!=n?(c=n.total_points?n.total_points:n.defined_points,a=n.defined_points,o=n.closed_points,a>c?(u=100*c/a,s=100*o/a):(u=100,s=100*o/c),u=r(u-3),s=r(s-3),i(t,e,u,s)):void 0}),t.$on("$destroy",function(){return e.off()})},{link:n}},d.directive("tgBacklogProgressBar",["$tgTemplate","$compile",n])}.call(this),function(){var t,e,r,n,i,o,s,a,u;a=this.taiga,i=this.taiga.mixOf,u=this.taiga.toggleText,s=this.taiga.scopeDefer,e=this.taiga.bindOnce,n=this.taiga.groupBy,o=angular.module("taigaBacklog"),r=function(t){return $(t).scope().$destroy(),$(t).off(),$(t).remove()},t=function(t,n,i,o,s){var a;return a=function(t,n,i){return e(t,"project",function(e){var i,a,u,c;if(e.my_permissions.indexOf("modify_us")>-1)return u=!1,a=function(){var t;return t=s.instant("BACKLOG.SORTABLE_FILTER_ERROR"),o.notify("error",t)},i=dragula([n[0],$(".empty-backlog")[0]],{copySortSource:!1,copy:!1,isContainer:function(t){return t.classList.contains("sprint-table")},moves:function(t){var e;return $(t).hasClass("row")?(e=$(t).parent(),u=e.hasClass("backlog-table-body"),u&&n.hasClass("active-filters")?(a(),!1):!0):!1}}),i.on("drag",function(t,e){var r,n;return n=$(t).parent(),u=n.hasClass("backlog-table-body"),$(document.body).addClass("drag-active"),r=$(t).find("input[type='checkbox']").is(":checked"),window.dragMultiple.start(t,e)}),i.on("cloned",function(t){return $(t).addClass("backlog-us-mirror")}),i.on("dragend",function(e){var n,i,o,s,a,c,l,p,d;return $(".doom-line").remove(),c=$(e).parent(),s=c.hasClass("backlog-table-body")||c.hasClass("empty-backlog"),l=u||s?u===s:$(e).scope().sprint.id===c.scope().sprint.id,n=window.dragMultiple.stop(),$(document.body).removeClass("drag-active"),a=$(e).parent().find(".row"),p=null,i=n.length?n[0]:e,s?o=$(i).index(".backlog-table-body .row"):(o=$(i).index(),p=c.scope().sprint.id),l?d=n.length?_.map(n,function(t){return t=$(t).scope().us}):_.map(a,function(t){var e;return t=$(t),e=t.scope().us}):(d=n.length?_.map(n,function(t){return t=$(t).scope().us}):[$(e).scope().us],n.length?_.each(n,function(t){return r(t)}):r(e)),t.$emit("sprint:us:move",d,o,p)}),c=autoScroll([window],{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&i.dragging}}),t.$on("$destroy",function(){return n.off(),i.destroy()})})},{link:a}},o.directive("tgBacklogSortable",["$tgRepo","$tgResources","$rootScope","$tgConfirm","$translate",t])}.call(this),function(){var t,e,r,n,i;i=this.taiga,n=angular.module("taigaBacklog"),t=function(t,e){var r,n,i,o;return i=50,n={duration:500,easing:"linear"},o=function(t){return function(t){var e,r;return r=t.find(".sprint-table"),e=t.find(".compact-sprint"),e.toggleClass("active"),r.toggleClass("open")}}(this),r=function(t,r,i){return t.$watch(i.tgBacklogSprint,function(e){return e=t.$eval(i.tgBacklogSprint),e.closed?r.addClass("sprint-closed"):o(r)}),r.on("click",".sprint-name > .compact-sprint",function(t){return t.preventDefault(),o(r),r.find(".sprint-table").slideToggle(n)}),r.on("click",".edit-sprint",function(r){var n;return r.preventDefault(),n=t.$eval(i.tgBacklogSprint),e.$broadcast("sprintform:edit",n)}),t.$on("$destroy",function(){return r.off()})},{link:r}},n.directive("tgBacklogSprint",["$tgRepo","$rootScope",t]),e=function(t,e,r,n){var i,o;return o=e.get("backlog/sprint-header.html"),i=function(e,i,s,a){var u,c,l,p;return l=n.instant("BACKLOG.SPRINTS.DATE"),u=function(){return-1!==e.project.my_permissions.indexOf("modify_milestone")},c=function(){return-1!==e.project.my_permissions.indexOf("view_milestones")},p=function(n){var s,a,p,d,f,h,m;return h=t.resolve("project-taskboard",{project:e.project.slug,sprint:n.slug}),f=moment(n.estimated_start).format(l),d=moment(n.estimated_finish).format(l),p=f+"-"+d,a={name:n.name,taskboardUrl:h,estimatedDateRange:p,closedPoints:n.closed_points||0,totalPoints:n.total_points||0,isVisible:c(),isEditable:u()},m=e.$new(),_.assign(m,a),s=r(o)(m),i.html(s)},e.$watch(s.ngModel,function(t){return p(t)}),e.$on("sprintform:edit:success",function(){return p(a.$modelValue)}),e.$on("$destroy",function(){return i.off()})},{link:i,restrict:"EA",require:"ngModel"}},n.directive("tgBacklogSprintHeader",["$tgNavUrls","$tgTemplate","$compile","$translate",e]),r=function(t,e,r){var n,i;return n=!0,i=function(i,o,s){var a,u;return u=$("<div>"),o.after(u),a=null,o.on("click",function(r){return r.preventDefault(),n=!n,a=e().target(u).start(),n?t.$broadcast("backlog:unload-closed-sprints"):t.$broadcast("backlog:load-closed-sprints")}),i.$on("$destroy",function(){return o.off()}),i.$on("closed-sprints:reloaded",function(t){return function(t,e){var n,i;return a.finish(),n=e.length>0?"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS":"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS",i=r.instant(n),o.find(".text").text(i)}}(this))},{link:i}},n.directive("tgBacklogToggleClosedSprintsVisualization",["$rootScope","$tgLoading","$translate",r])}.call(this),function(){var t,e,r,n,i,o,s,a,u;s=this.taiga,n=this.taiga.mixOf,u=this.taiga.toggleText,o=this.taiga.scopeDefer,e=this.taiga.bindOnce,r=this.taiga.groupBy,a=this.taiga.timeout,i=angular.module("taigaTaskboard"),t=function(t){var e,r;return r=function(e,r){var n,i,o,s;return s=e.width(),e.height(240),i=_.map(r,function(t){return moment(t.day)}),n=[],n.unshift({data:_.zip(i,_.map(r,function(t){return t.optimal_points})),lines:{fillColor:"rgba(120,120,120,0.2)"}}),n.unshift({data:_.zip(i,_.map(r,function(t){return t.open_points})),lines:{fillColor:"rgba(102,153,51,0.3)"}}),o={grid:{borderWidth:{top:0,right:1,left:0,bottom:0},borderColor:"#ccc",hoverable:!0},xaxis:{tickSize:[1,"day"],min:i[0],max:_.last(i),mode:"time",daysNames:i,axisLabel:t.instant("TASKBOARD.CHARTS.XAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},yaxis:{min:0,axisLabel:t.instant("TASKBOARD.CHARTS.YAXIS_LABEL"),axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial, Helvetica, Tahoma, sans-serif",axisLabelPadding:5},series:{shadowSize:0,lines:{show:!0,fill:!0},points:{show:!0,fill:!0,radius:4,lineWidth:2}},colors:["rgba(102,153,51,1)","rgba(120,120,120,0.2)"],tooltip:!0,tooltipOpts:{content:function(e,r,n,i){var o,s;return o=moment(r).format(t.instant("TASKBOARD.CHARTS.DATE")),s=Math.round(n),1===i.seriesIndex?t.instant("TASKBOARD.CHARTS.OPTIMAL",{formattedDate:o,roundedValue:s}):t.instant("TASKBOARD.CHARTS.REAL",{formattedDate:o,roundedValue:s})}}},e.empty(),e.plot(n,o).data("plot")},e=function(t,e,n){var i;return i=angular.element(e),t.$on("resize",function(){return t.stats?r(i,t.stats.days):void 0}),t.$on("taskboard:graph:toggle-visibility",function(){return e.parent().toggleClass("open"),a(100,function(){return t.stats?r(i,t.stats.days):void 0})}),t.$watch("stats",function(e){return null!=t.stats?r(i,t.stats.days):void 0}),t.$on("$destroy",function(){return e.off()})},{link:e}},i.directive("tgSprintGraph",["$translate",t])}.call(this),function(){var t,e,r,n,i,o;o=this.taiga,r=this.taiga.bindOnce,n=this.taiga.debounce,e=function(t,e,r,i,o,s,a,u,c){var l;return l=function(e,r,l){var p,d,f,h,m,g,v;return e.isNew=!0,p=Immutable.List(),d=Immutable.List(),m=function(){return p=Immutable.List(),d=Immutable.List()},e.addAttachment=function(t){return p=p.push(t)},e.deleteAttachment=function(t){return d=d.push(t)},f=function(t){var r;return r=_.map(p.toJS(),function(r){return c.upload(r.file,t.id,e.task.project,"task")}),u.all(r)},h=function(t){var e;return e=_.map(d.toJS(),function(t){return c["delete"]("task",t.id)}),u.all(e)},e.$on("taskform:new",function(t,n,i){var o,u;return e.task={project:e.projectId,milestone:n,user_story:i,is_archived:!1,status:e.project.default_task_status,assigned_to:null,tags:[]},e.isNew=!0,e.attachments=Immutable.List(),m(),o=a.instant("COMMON.CREATE"),r.find(".button-green").html(o),u=a.instant("LIGHTBOX.CREATE_EDIT_TASK.TITLE"),r.find(".title").html(u+"  "),r.find(".tag-input").val(""),s.open(r)}),e.$on("taskform:edit",function(t,n,i){var o,u;return e.task=n,e.isNew=!1,e.attachments=Immutable.fromJS(i),m(),u=a.instant("COMMON.SAVE"),o=a.instant("LIGHTBOX.CREATE_EDIT_TASK.ACTION_EDIT"),r.find(".button-green").html(u),r.find(".title").html(o+"  "),r.find(".tag-input").val(""),s.open(r)}),v=r.find(".submit-button"),g=n(2e3,function(n){return function(n){var a,u,c,l;return n.preventDefault(),c=r.find("form").checksley(),c.validate()?(e.isNew?(l=t.create("tasks",e.task),a="taskform:new:success"):(l=t.save(e.task),a="taskform:edit:success"),l.then(function(t){return f(t),h(t),t}),u=o().target(v).start(),l.then(function(t){return u.finish(),s.close(r),i.$broadcast(a,t)})):void 0}}(this)),r.on("submit","form",g),e.$on("$destroy",function(){return r.off()})},{link:l}},t=function(t,e,r,i,o){var s;return s=function(t,s,a){var u,c;return t.form={data:"",usId:null},u=n(2e3,function(n){return function(n){var a,u,l,p,d,f,h;return n.preventDefault(),l=s.find("form").checksley(),l.validate()?(a=i().target(c).start(),u=t.form.data,p=t.projectId,f=t.form.sprintId,h=t.form.usId,d=e.tasks.bulkCreate(p,f,h,u),d.then(function(t){return a.finish(),r.$broadcast("taskform:bulk:success",t),o.close(s)}),d.then(null,function(){return a.finish(),console.log("FAIL")})):void 0}}(this)),t.$on("taskform:bulk",function(e,r,n){return o.open(s),t.form={data:"",sprintId:r,usId:n}}),c=s.find(".submit-button"),s.on("submit","form",u),t.$on("$destroy",function(){return s.off()})},{link:s}},i=angular.module("taigaTaskboard"),i.directive("tgLbCreateEditTask",["$tgRepo","$tgModel","$tgResources","$rootScope","$tgLoading","lightboxService","$translate","$q","tgAttachmentsService",e]),i.directive("tgLbCreateBulkTasks",["$tgRepo","$tgResources","$rootScope","$tgLoading","lightboxService",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h=function(t,e){function r(){this.constructor=t}for(var n in e)m.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},m={}.hasOwnProperty;p=this.taiga,f=this.taiga.toggleText,u=this.taiga.mixOf,a=this.taiga.groupBy,s=this.taiga.bindOnce,l=this.taiga.scopeDefer,d=this.taiga.timeout,o=this.taiga.bindMethods,c=angular.module("taigaTaskboard"),t=function(t){function e(t,e,r,n,i,s,a,u,c,l,p,d,f){var h;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=s,this.q=a,this.appMetaService=u,this.location=c,this.navUrls=l,this.events=p,this.analytics=d,this.translate=f,o(this),this.scope.sectionName=this.translate.instant("TASKBOARD.SECTION_NAME"),this.initializeEventHandlers(),h=this.loadInitialData(),h.then(function(t){return function(){return t._setMeta()}}(this)),h.then(null,this.onInitialDataError.bind(this))}return h(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","tgAppMetaService","$tgLocation","$tgNavUrls","$tgEvents","$tgAnalytics","$translate"],e.prototype._setMeta=function(){var t,e,r;return e=this.translate.instant("BACKLOG.SPRINTS.DATE"),r=this.translate.instant("TASKBOARD.PAGE_TITLE",{projectName:this.scope.project.name,sprintName:this.scope.sprint.name}),t=this.translate.instant("TASKBOARD.PAGE_DESCRIPTION",{projectName:this.scope.project.name,sprintName:this.scope.sprint.name,startDate:moment(this.scope.sprint.estimated_start).format(e),endDate:moment(this.scope.sprint.estimated_finish).format(e),completedPercentage:this.scope.stats.completedPercentage||"0",completedPoints:this.scope.stats.completedPointsSum||"--",totalPoints:this.scope.stats.totalPointsSum||"--",openTasks:this.scope.stats.openTasks||"--",
totalTasks:this.scope.stats.total_tasks||"--"}),this.appMetaService.setAll(r,t)},e.prototype.initializeEventHandlers=function(){return this.scope.$on("taskform:bulk:success",function(t){return function(){return t.loadTaskboard(),t.analytics.trackEvent("task","create","bulk create task on taskboard",1)}}(this)),this.scope.$on("taskform:new:success",function(t){return function(){return t.loadTaskboard(),t.analytics.trackEvent("task","create","create task on taskboard",1)}}(this)),this.scope.$on("taskform:edit:success",function(t){return function(){return t.loadTaskboard()}}(this)),this.scope.$on("taskboard:task:move",this.taskMove),this.scope.$on("assigned-to:added",function(t){return function(e,r,n){var i;return n.assigned_to=r,i=t.repo.save(n),i.then(null,function(){return console.log("FAIL")})}}(this))},e.prototype.initializeSubscription=function(){var t,e;return t="changes.project."+this.scope.projectId+".tasks",this.events.subscribe(this.scope,t,function(t){return function(e){return t.loadTaskboard()}}(this)),e="changes.project."+this.scope.projectId+".userstories",this.events.subscribe(this.scope,e,function(t){return function(e){return t.refreshTagsColors(),t.loadSprintStats(),t.loadSprint()}}(this))},e.prototype.loadProject=function(){return this.rs.projects.get(this.scope.projectId).then(function(t){return function(e){return e.is_backlog_activated||t.location.path(t.navUrls.resolve("permission-denied")),t.scope.project=e,t.scope.pointsList=_.sortBy(e.points,"order"),t.scope.pointsById=a(e.points,function(t){return t.id}),t.scope.roleById=a(e.roles,function(t){return t.id}),t.scope.taskStatusList=_.sortBy(e.task_statuses,"order"),t.scope.usStatusList=_.sortBy(e.us_statuses,"order"),t.scope.usStatusById=a(e.us_statuses,function(t){return t.id}),t.scope.$emit("project:loaded",e),t.fillUsersAndRoles(e.members,e.roles),e}}(this))},e.prototype.loadSprintStats=function(){return this.rs.sprints.stats(this.scope.projectId,this.scope.sprintId).then(function(t){return function(e){var r,n,i,o;return o=_.reduce(_.values(e.total_points),function(t,e){return t+e},0),r=_.reduce(_.values(e.completed_points),function(t,e){return t+e},0),n=o-r,i=e.total_tasks-e.completed_tasks,t.scope.stats=e,t.scope.stats.totalPointsSum=o,t.scope.stats.completedPointsSum=r,t.scope.stats.remainingPointsSum=n,t.scope.stats.remainingTasks=i,e.totalPointsSum?t.scope.stats.completedPercentage=Math.round(100*e.completedPointsSum/e.totalPointsSum):t.scope.stats.completedPercentage=0,t.scope.stats.openTasks=e.total_tasks-e.completed_tasks,e}}(this))},e.prototype.refreshTagsColors=function(){return this.rs.projects.tagsColors(this.scope.projectId).then(function(t){return function(e){return t.scope.project.tags_colors=e}}(this))},e.prototype.loadSprint=function(){return this.rs.sprints.get(this.scope.projectId,this.scope.sprintId).then(function(t){return function(e){return t.scope.sprint=e,t.scope.userstories=_.sortBy(e.user_stories,"sprint_order"),e}}(this))},e.prototype.loadTasks=function(){return this.rs.tasks.list(this.scope.projectId,this.scope.sprintId).then(function(t){return function(e){var r,n,i,o,s,a,u,c,l,p,d,f,h;for(t.scope.tasks=_.sortBy(e,"taskboard_order"),t.scope.usTasks={},u=_.union(t.scope.userstories,[{id:null}]),r=0,o=u.length;o>r;r++)for(f=u[r],t.scope.usTasks[f.id]={},c=t.scope.taskStatusList,n=0,s=c.length;s>n;n++)p=c[n],t.scope.usTasks[f.id][p.id]=[];for(l=t.scope.tasks,i=0,a=l.length;a>i;i++)d=l[i],null!=t.scope.usTasks[d.user_story]&&null!=t.scope.usTasks[d.user_story][d.status]&&t.scope.usTasks[d.user_story][d.status].push(d);return 0===e.length&&(h=t.scope.userstories.length>0?t.scope.userstories[0].id:null,t.scope.usTasks[h][t.scope.taskStatusList[0].id].push({isPlaceholder:!0})),e}}(this))},e.prototype.loadTaskboard=function(){return this.q.all([this.refreshTagsColors(),this.loadSprintStats(),this.loadSprint().then(function(t){return function(){return t.loadTasks()}}(this))])},e.prototype.loadInitialData=function(){var t,e;return t={pslug:this.params.pslug,sslug:this.params.sslug},e=this.repo.resolve(t).then(function(t){return function(e){return t.scope.projectId=e.project,t.scope.sprintId=e.milestone,t.initializeSubscription(),e}}(this)),e.then(function(t){return function(){return t.loadProject()}}(this)).then(function(t){return function(){return t.loadTaskboard()}}(this))},e.prototype.refreshTasksOrder=function(t){var e,r;return r=this.resortTasks(t),e=this.prepareBulkUpdateData(r),this.rs.tasks.bulkUpdateTaskTaskboardOrder(this.scope.project.id,e)},e.prototype.resortTasks=function(t){var e,r,n,i,o;for(i=[],r=e=0,o=t.length;o>e;r=++e)n=t[r],n.taskboard_order=r,n.isModified()&&i.push(n);return i},e.prototype.prepareBulkUpdateData=function(t){return _.map(t,function(t){return{task_id:t.id,order:t.taskboard_order}})},e.prototype.taskMove=function(t,e,r,n,i){var o,s,a;return s=this.scope.usTasks[e.user_story][e.status].indexOf(e),this.scope.usTasks[e.user_story][e.status].splice(s,1),a=this.scope.usTasks[r][n],a.splice(i,0,e),e.user_story=r,e.status=n,e.taskboard_order=i,o=this.repo.save(e),this.rootscope.$broadcast("sprint:task:moved",e),o.then(function(t){return function(){return t.refreshTasksOrder(a),t.loadSprintStats()}}(this)),o.then(null,function(t){return function(){return console.log("FAIL TASK SAVE")}}(this))},e.prototype.addNewTask=function(t,e){switch(t){case"standard":return this.rootscope.$broadcast("taskform:new",this.scope.sprintId,null!=e?e.id:void 0);case"bulk":return this.rootscope.$broadcast("taskform:bulk",this.scope.sprintId,null!=e?e.id:void 0)}},e.prototype.editTaskAssignedTo=function(t){return this.rootscope.$broadcast("assigned-to:add",t)},e}(u(p.Controller,p.PageMixin)),c.controller("TaskboardController",t),e=function(t){var e;return e=function(e,r,n){var i,o;return i=r.controller(),r.on("click",".toggle-analytics-visibility",function(e){var r;return e.preventDefault(),r=angular.element(e.currentTarget),r.toggleClass("active"),t.$broadcast("taskboard:graph:toggle-visibility")}),o=r.find(".taskboard-table-body"),o.on("scroll",function(t){var e,n;return n=angular.element(t.currentTarget),e=r.find(".taskboard-table-header .taskboard-table-inner"),e.css("left",-1*n.scrollLeft())}),e.$on("$destroy",function(){return r.off()})},{link:e}},c.directive("tgTaskboard",["$rootScope",e]),n=function(t,e,r,n){var i;return i=function(i,o,s,a){return i.$watch("task",function(t){return t.is_blocked&&!o.hasClass("blocked")?o.addClass("blocked"):!t.is_blocked&&o.hasClass("blocked")?o.removeClass("blocked"):void 0}),o.find(".edit-task").on("click",function(s){return o.find(".edit-task").hasClass("noclick")?void 0:i.$apply(function(){var o,a,u;return a=$(s.target),o=e().target(a).timeout(200).start(),u=i.task,r.tasks.getByRef(u.project,u.ref).then(function(e){return function(e){return n.attachments.list("task",e.id,e.project).then(function(r){return t.$broadcast("taskform:edit",e,r.toJS()),o.finish()})}}(this))})})},{link:i}},c.directive("tgTaskboardTask",["$rootScope","$tgLoading","$tgResources","tgResources",n]),r=function(t){var e,r,n;return e=40,n=300,r=function(r,i,o){var a,u,c,l,p;return r.$on("sprint:task:moved",function(t){return function(){return c()}}(this)),s(r,"usTasks",function(e){return r.statusesFolded=t.tasks.getStatusColumnModes(r.project.id),r.usFolded=t.tasks.getUsRowModes(r.project.id,r.sprintId),c()}),r.foldStatus=function(e){return r.statusesFolded[e.id]=!r.statusesFolded[e.id],t.tasks.storeStatusColumnModes(r.projectId,r.statusesFolded),c()},r.foldUs=function(e){return e?r.usFolded[e.id]=!r.usFolded[e.id]:r.usFolded[null]=!r.usFolded[null],t.tasks.storeUsRowModes(r.projectId,r.sprintId,r.usFolded),c()},a=function(t){return function(t,n){var i,o,s;return i=r.usTasks[t][n].length,r.statusesFolded[n]?(i&&r.usFolded[t]?(o=Math.round(Math.sqrt(i)),s=e*o):s=e,s):0}}(this),p=function(t){return function(t,e){var r;return r=i.find(".squish-status-"+t),e?r.css("max-width",e):r.css("max-width",n)}}(this),l=function(t){return function(){var t,e,r;return t=[],e=i.find(".task-colum-name"),t=_.map(e,function(t){return $(t).outerWidth(!0)}),r=_.reduce(t,function(t,e){return t+e}),i.find(".taskboard-table-inner").css("width",r)}}(this),u=function(t){return function(t){var e;return e=a(null,t),_.forEach(r.userstories,function(r){var n;return n=a(r.id,t),n>e?e=n:void 0}),p(t,e)}}(this),c=function(t){return function(){_.forEach(r.taskStatusList,function(t){return u(t.id)}),l()}}(this)},{link:r}},c.directive("tgTaskboardSquishColumn",["$tgResources",r]),i=function(t,e){var r,n;return r=!1,n=function(t,n,i){var o;return o=n.parent().find("a.task-assigned"),o.addClass("not-clickable"),t.$watch("task.assigned_to",function(n){var i;return i=t.usersById[n],void 0===i?_.assign(t,{name:e.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png",clickable:r}):_.assign(t,{name:i.full_name_display,imgurl:i.photo,clickable:r}),o.text(t.name)}),s(t,"project",function(e){return e.my_permissions.indexOf("modify_task")>-1?(r=!0,n.find(".avatar-assigned-to").on("click",function(e){return function(e){var r;if(!n.find("a").hasClass("noclick"))return r=n.controller(),r.editTaskAssignedTo(t.task)}}(this)),o.removeClass("not-clickable"),o.on("click",function(e){var r;if(!n.find("a").hasClass("noclick"))return r=n.controller(),r.editTaskAssignedTo(t.task)})):void 0})},{link:n,templateUrl:"taskboard/taskboard-user.html",scope:{usersById:"=users",project:"=",task:"="}}},c.directive("tgTaskboardUserAvatar",["$log","$translate",i])}.call(this),function(){var t,e,r,n,i,o,s,a;s=this.taiga,n=this.taiga.mixOf,a=this.taiga.toggleText,o=this.taiga.scopeDefer,e=this.taiga.bindOnce,r=this.taiga.groupBy,i=angular.module("taigaBacklog"),t=function(t,r,n){var i;return i=function(t,r,i){return e(t,"tasks",function(e){var i,o,s,a,u,c,l,p;if(t.project.my_permissions.indexOf("modify_us")>-1)return c=null,u=null,a=null,p=r,o=function(t){return t.scope().$destroy(),t.off(),t.remove()},i=_.map(r.find(".task-column"),function(t){return t}),s=dragula(i,{copySortSource:!1,copy:!1,mirrorContainer:r[0],moves:function(t){return $(t).hasClass("taskboard-task")}}),s.on("drag",function(t){return c=$(t).parent().scope()}),s.on("dragend",function(e){var r,i,s,l,p,d,f;return f=$(e).parent(),a=$(e),i=a.scope().task,r=a.index(),u=f.scope(),d=c.us?c.us.id:null,p=c.st.id,l=u.us?u.us.id:null,s=u.st.id,s===p&&l===d||o(a),t.$apply(function(){return n.$broadcast("taskboard:task:move",i,l,s,r)})}),l=autoScroll(i,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&s.dragging}}),t.$on("$destroy",function(){return r.off(),s.destroy()})})},{link:i}},i.directive("tgTaskboardSortable",["$tgRepo","$tgResources","$rootScope",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m,g,v,y,b=function(t,e){function r(){this.constructor=t}for(var n in e)S.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},S={}.hasOwnProperty;m=this.taiga,d=this.taiga.mixOf,v=this.taiga.toggleText,h=this.taiga.scopeDefer,c=this.taiga.bindOnce,p=this.taiga.groupBy,g=this.taiga.timeout,u=this.taiga.bindMethods,f=angular.module("taigaKanban"),l="maximized",y=["maximized","minimized"],r=function(t){function e(t,e,r,n,i,o,s,a,c,l,p,d,f){var h;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.appMetaService=c,this.navUrls=l,this.events=p,this.analytics=d,this.translate=f,u(this),this.scope.sectionName=this.translate.instant("KANBAN.SECTION_NAME"),this.scope.statusViewModes={},this.initializeEventHandlers(),h=this.loadInitialData(),h.then(function(t){return function(){var e,r;return r=t.translate.instant("KANBAN.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.translate.instant("KANBAN.PAGE_DESCRIPTION",{projectName:t.scope.project.name,projectDescription:t.scope.project.description}),t.appMetaService.setAll(r,e)}}(this)),h.then(null,this.onInitialDataError.bind(this))}return b(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate"],e.prototype.initializeEventHandlers=function(){return this.scope.$on("usform:new:success",function(t){return function(){return t.loadUserstories(),t.refreshTagsColors(),t.analytics.trackEvent("userstory","create","create userstory on kanban",1)}}(this)),this.scope.$on("usform:bulk:success",function(t){return function(){return t.loadUserstories(),t.analytics.trackEvent("userstory","create","bulk create userstory on kanban",1)}}(this)),this.scope.$on("usform:edit:success",function(t){return function(){return t.loadUserstories(),t.refreshTagsColors()}}(this)),this.scope.$on("assigned-to:added",this.onAssignedToChanged),this.scope.$on("kanban:us:move",this.moveUs),this.scope.$on("kanban:show-userstories-for-status",this.loadUserStoriesForStatus),this.scope.$on("kanban:hide-userstories-for-status",this.hideUserStoriesForStatus)},e.prototype.addNewUs=function(t,e){switch(t){case"standard":return this.rootscope.$broadcast("usform:new",this.scope.projectId,e,this.scope.usStatusList);case"bulk":return this.rootscope.$broadcast("usform:bulk",this.scope.projectId,e)}},e.prototype.changeUsAssignedTo=function(t){return this.rootscope.$broadcast("assigned-to:add",t)},e.prototype.onAssignedToChanged=function(t,e,r){var n;return r.assigned_to=e,n=this.repo.save(r),n.then(null,function(){return console.log("FAIL")})},e.prototype.refreshTagsColors=function(){return this.rs.projects.tagsColors(this.scope.projectId).then(function(t){return function(e){return t.scope.project.tags_colors=e}}(this))},e.prototype.loadUserstories=function(){var t,e;return t={status__is_archived:!1},e=this.rs.userstories.listAll(this.scope.projectId,t).then(function(t){return function(e){var r,n,i,o,s,a,u,c,l,p,d,f,m;for(t.scope.userstories=e,f=_.groupBy(e,"status"),m=[],u=t.scope.usStatusList,r=0,o=u.length;o>r;r++){if(p=u[r],null==f[p.id]&&(f[p.id]=[]),null!=t.scope.usByStatus)for(c=t.scope.usByStatus[p.id],n=0,s=c.length;s>n;n++)d=c[n],d.status!==p.id&&m.push(d);if(p.is_archived&&null!=t.scope.usByStatus&&0!==t.scope.usByStatus[p.id].length)for(l=t.scope.usByStatus[p.id].concat(m),i=0,a=l.length;a>i;i++)d=l[i],d.status===p.id&&f[p.id].push(d);f[p.id]=_.sortBy(f[p.id],"kanban_order")}return 0===e.length&&(p=t.scope.usStatusList[0],f[p.id].push({isPlaceholder:!0})),t.scope.usByStatus=f,h(t.scope,function(){return t.scope.$broadcast("userstories:loaded",e)}),e}}(this)),e.then(function(t){return function(){return t.scope.$broadcast("redraw:wip")}}(this)),e},e.prototype.loadUserStoriesForStatus=function(t,e){var r;return r={status:e},this.rs.userstories.listAll(this.scope.projectId,r).then(function(t){return function(r){return t.scope.usByStatus[e]=_.sortBy(r,"kanban_order"),t.scope.$broadcast("kanban:shown-userstories-for-status",e,r),r}}(this))},e.prototype.hideUserStoriesForStatus=function(t,e){return this.scope.usByStatus[e]=[],this.scope.$broadcast("kanban:hidden-userstories-for-status",e)},e.prototype.loadKanban=function(){return this.q.all([this.refreshTagsColors(),this.loadUserstories()])},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return e.is_kanban_activated||t.location.path(t.navUrls.resolve("permission-denied")),t.scope.projectId=e.id,t.scope.project=e,t.scope.projectId=e.id,t.scope.points=_.sortBy(e.points,"order"),t.scope.pointsById=p(e.points,function(t){return t.id}),t.scope.usStatusById=p(e.us_statuses,function(t){return t.id}),t.scope.usStatusList=_.sortBy(e.us_statuses,"order"),t.generateStatusViewModes(),t.scope.$emit("project:loaded",e),e}}(this))},e.prototype.initializeSubscription=function(){var t;return t="changes.project."+this.scope.projectId+".userstories",this.events.subscribe(this.scope,t,function(t){return function(e){return t.loadUserstories()}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(e){return t.fillUsersAndRoles(e.members,e.roles),t.initializeSubscription(),t.loadKanban()}}(this))},e.prototype.generateStatusViewModes=function(){var t,e,r,n,i,o;for(o=this.rs.kanban.getStatusViewModes(this.scope.projectId),this.scope.statusViewModes={},n=this.scope.usStatusList,t=0,e=n.length;e>t;t++)i=n[t],r=o[i.id]||l,this.scope.statusViewModes[i.id]=r;return this.storeStatusViewModes()},e.prototype.storeStatusViewModes=function(){return this.rs.kanban.storeStatusViewModes(this.scope.projectId,this.scope.statusViewModes)},e.prototype.updateStatusViewMode=function(t,e){return this.scope.statusViewModes[t]=e,this.storeStatusViewModes()},e.prototype.isMaximized=function(t){var e;return e=this.scope.statusViewModes[t]||l,"maximized"===e},e.prototype.isMinimized=function(t){var e;return e=this.scope.statusViewModes[t]||l,"minimized"===e},e.prototype.prepareBulkUpdateData=function(t,e){return null==e&&(e="kanban_order"),_.map(t,function(t){return{us_id:t.id,order:t[e]}})},e.prototype.resortUserStories=function(t){var e,r,n,i,o;for(i=[],r=e=0,o=t.length;o>e;r=++e)n=t[r],n.kanban_order=r,n.isModified()&&i.push(n);return i},e.prototype.moveUs=function(t,e,r,n,i){var o,s,a;return r!==n?(a=this.scope.usByStatus[r].indexOf(e),this.scope.usByStatus[r].splice(a,1),this.scope.usByStatus[n].splice(i,0,e),e.status=n):(a=this.scope.usByStatus[n].indexOf(e),this.scope.usByStatus[n].splice(a,1),this.scope.usByStatus[n].splice(i,0,e)),o=this.resortUserStories(this.scope.usByStatus[n]),this.scope.usByStatus[n]=_.sortBy(this.scope.usByStatus[n],"kanban_order"),s=this.repo.save(e),s=s.then(function(t){return function(){var r;return o=_.reject(o,{id:e.id}),r=t.prepareBulkUpdateData(o),t.rs.userstories.bulkUpdateKanbanOrder(e.project,r).then(function(){return o})}}(this))},e}(d(m.Controller,m.PageMixin,m.FiltersMixin)),f.controller("KanbanController",r),n=function(t,e){var r;return r=function(t,e,r){var n;return n=e.find(".kanban-table-body"),n.on("scroll",function(t){var r,n;return n=angular.element(t.currentTarget),r=e.find(".kanban-table-header .kanban-table-inner"),r.css("left",-1*n.scrollLeft())}),t.$on("$destroy",function(){return e.off()})},{link:r}},f.directive("tgKanban",["$tgRepo","$rootScope",n]),t=function(t,e){var r,n,i;return i=e.instant("KANBAN.ACTION_SHOW_ARCHIVED"),r=e.instant("KANBAN.ACTION_HIDE_ARCHIVED"),n=function(e,n,o){var s,a;return a=e.$eval(o.tgKanbanArchivedStatusHeader),s=!0,e["class"]="icon-watch",e.title=i,n.on("click",function(n){return s=!s,e.$apply(function(){return s?(e["class"]="icon-watch",e.title=i,t.$broadcast("kanban:hide-userstories-for-status",a.id)):(e["class"]="icon-unwatch",e.title=r,t.$broadcast("kanban:show-userstories-for-status",a.id))})}),e.$on("$destroy",function(){return n.off()})},{link:n}},f.directive("tgKanbanArchivedStatusHeader",["$rootScope","$translate",t]),e=function(t){var e,r;return r=[],e=function(e,n,i){var o,s,a;return o=t.instant("KANBAN.HIDDEN_USER_STORIES"),s=e.$eval(i.tgKanbanArchivedStatusIntro),n.text(o),a=function(){return r.length>0?n.text(""):n.text(o)},e.$on("kanban:us:move",function(t,e,n,i,o){var u;return s.id===i?s.id===n?(u=r.indexOf(e),r.splice(u,1),r.splice(o,0,e)):(e.isArchived=!0,r.splice(o,0,e)):s.id===n&&(e.isArchived=!1,u=r.indexOf(e),r.splice(u,1)),a()}),e.$on("kanban:shown-userstories-for-status",function(t,e,n){return e===s.id?(r=_.filter(n,function(t){return t.status===s.id}),a()):void 0}),e.$on("kanban:hidden-userstories-for-status",function(t,e){return e===s.id?(r=[],a()):void 0}),e.$on("$destroy",function(){return n.off()})},{link:e}},f.directive("tgKanbanArchivedStatusIntro",["$translate",e]),s=function(t,e,r,n){var i;return i=function(i,o,s,a){return i.$watch("us",function(t){return t.is_blocked&&!o.hasClass("blocked")?o.addClass("blocked"):!t.is_blocked&&o.hasClass("blocked")?o.removeClass("blocked"):void 0}),o.on("click",".edit-us",function(i){var s,u,c;if(!o.find(".icon-edit").hasClass("noclick"))return u=$(i.target),s=e().target(u).timeout(200).removeClasses("icon-edit").start(),c=a.$modelValue,r.userstories.getByRef(c.project,c.ref).then(function(e){return function(e){return n.attachments.list("us",c.id,c.project).then(function(r){return t.$broadcast("usform:edit",e,r.toJS()),s.finish()})}}(this))}),i.getTemplateUrl=function(){return i.us.isPlaceholder?"common/components/kanban-placeholder.html":"kanban/kanban-task.html"},i.$on("$destroy",function(){return o.off()})},{template:'<ng-include src="getTemplateUrl()"/>',link:i,require:"ngModel"}},f.directive("tgKanbanUserstory",["$rootScope","$tgLoading","$tgResources","tgResources",s]),i=function(t){var e;return e=function(e,r,n){var i;return e.$on("project:loaded",function(r,n){return e.folds=t.kanban.getStatusColumnModes(n.id),i()}),e.foldStatus=function(r){e.folds[r.id]=!e.folds[r.id],t.kanban.storeStatusColumnModes(e.projectId,e.folds),i()},i=function(){var t,n;return t=_.map(e.usStatusList,function(t){return e.folds[t.id]?40:310}),n=_.reduce(t,function(t,e){return t+e}),r.find(".kanban-table-inner").css("width",n)}},{link:e}},f.directive("tgKanbanSquishColumn",["$tgResources",i]),a=function(){var t;return t=function(t,e,r){var n,i;return i=t.$eval(r.tgKanbanWipLimit),n=function(t){return function(){return e.find(".kanban-wip-limit").remove(),g(200,function(){var t;return t=e.find(".kanban-task")[i.wip_limit],t?angular.element(t).before("<div class='kanban-wip-limit'></div>"):void 0})}}(this),i&&!i.is_archived&&(t.$on("redraw:wip",n),t.$on("kanban:us:move",n),t.$on("usform:new:success",n),t.$on("usform:bulk:success",n)),t.$on("$destroy",function(){return e.off()})},{link:t}},f.directive("tgKanbanWipLimit",a),o=function(t,e,r){var n,i,o;return o=_.template('<figure class="avatar">\n    <a href="#" title="{{\'US.ASSIGN\' | translate}}" <% if (!clickable) {%>class="not-clickable"<% } %>>\n        <img src="<%- imgurl %>" alt="<%- name %>" class="avatar">\n    </a>\n</figure>'),n=!1,i=function(i,s,a,u){var l,p,d;return p=s.parent().find("a.task-assigned"),p.addClass("not-clickable"),a.tgKanbanUserAvatar?(d=i.$watch(a.tgKanbanUserAvatar,function(e){var r;return null==i.usersById?(t.error("KanbanUserDirective requires userById set in scope."),d()):(r=i.usersById[e],l(r))}),l=function(t){var a,u;return a=void 0===t?{name:r.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png",clickable:n}:{name:t.full_name_display,imgurl:t.photo,clickable:n},u=e(o(a))(i),s.html(u),p.text(a.name)},c(i,"project",function(t){return t.my_permissions.indexOf("modify_us")>-1?(n=!0,s.on("click",function(t){return function(t){var e,r;if(!s.find("a").hasClass("noclick"))return r=u.$modelValue,e=s.controller(),e.changeUsAssignedTo(r)}}(this)),p.removeClass("not-clickable"),p.on("click",function(t){var e,r;if(!s.find("a").hasClass("noclick"))return r=u.$modelValue,e=s.controller(),e.changeUsAssignedTo(r)})):void 0}),i.$on("$destroy",function(){return s.off()})):t.error("KanbanUserDirective: no attr is defined")},{link:i,require:"ngModel"}},f.directive("tgKanbanUserAvatar",["$log","$compile","$translate",o])}.call(this),function(){var t,e,r,n,i,o,s,a,u;s=this.taiga,n=this.taiga.mixOf,u=this.taiga.toggleText,o=this.taiga.scopeDefer,e=this.taiga.bindOnce,r=this.taiga.groupBy,a=this.taiga.timeout,i=angular.module("taigaKanban"),t=function(t,r,n){var i;return i=function(t,r,i){return e(t,"project",function(e){var i,o,s,a,u,c,l,p;if(e.my_permissions.indexOf("modify_us")>-1)return c=null,u=null,a=null,p=r,o=function(t){return t.scope().$destroy(),t.off(),t.remove()},i=_.map(r.find(".task-column"),function(t){return t}),s=dragula(i,{copySortSource:!1,copy:!1,mirrorContainer:p[0],moves:function(t){return $(t).hasClass("kanban-task")}}),s.on("drag",function(t){return c=$(t).parent().scope()}),s.on("dragend",function(e){var r,i,s,l,p;return p=$(e).parent(),a=$(e),i=a.scope().us,r=a.index(),u=p.scope(),s=u.s.id,l=c.s.id,s!==l&&o(a),t.$apply(function(){return n.$broadcast("kanban:us:move",i,i.status,s,r)})}),l=autoScroll(i,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&s.dragging}}),t.$on("$destroy",function(){return r.off(),s.destroy()})})},{link:i}},i.directive("tgKanbanSortable",["$tgRepo","$tgResources","$rootScope",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m=function(t,e){function r(){this.constructor=t}for(var n in e)g.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},g={}.hasOwnProperty;f=this.taiga,p=this.taiga.mixOf,h=this.taiga.toString,l=this.taiga.joinStr,c=this.taiga.groupBy,u=this.taiga.bindOnce,a=this.taiga.bindMethods,d=angular.module("taigaIssues"),t=function(t){function e(t,e,r,n,i,o,s,u,c,l,p,d,f,h){var m;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=u,this.log=c,this.appMetaService=l,this.analytics=p,this.navUrls=d,this.translate=f,this.modelTransform=h,a(this),this.scope.issueRef=this.params.issueref,this.scope.sectionName=this.translate.instant("ISSUES.SECTION_NAME"),this.initializeEventHandlers(),m=this.loadInitialData(),m.then(function(t){return function(){return t._setMeta(),t.initializeOnDeleteGoToUrl()}}(this)),m.then(null,this.onInitialDataError.bind(this))}return m(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgAnalytics","$tgNavUrls","$translate","$tgQueueModelTransformation"],e.prototype._setMeta=function(){var t,e,r,n,i,o;return o=this.translate.instant("ISSUE.PAGE_TITLE",{issueRef:"#"+this.scope.issue.ref,issueSubject:this.scope.issue.subject,projectName:this.scope.project.name}),t=this.translate.instant("ISSUE.PAGE_DESCRIPTION",{issueStatus:(null!=(e=this.scope.statusById[this.scope.issue.status])?e.name:void 0)||"--",issueType:(null!=(r=this.scope.typeById[this.scope.issue.type])?r.name:void 0)||"--",issueSeverity:(null!=(n=this.scope.severityById[this.scope.issue.severity])?n.name:void 0)||"--",issuePriority:(null!=(i=this.scope.priorityById[this.scope.issue.priority])?i.name:void 0)||"--",issueDescription:angular.element(this.scope.issue.description_html||"").text()}),this.appMetaService.setAll(o,t)},e.prototype.initializeEventHandlers=function(){return this.scope.$on("attachment:create",function(t){return function(){return t.analytics.trackEvent("attachment","create","create attachment on issue",1)}}(this)),this.scope.$on("promote-issue-to-us:success",function(t){return function(){return t.analytics.trackEvent("issue","promoteToUserstory","promote issue to userstory",1),t.rootscope.$broadcast("object:updated"),t.loadIssue()}}(this)),this.scope.$on("comment:new",function(t){return function(){return t.loadIssue()}}(this)),this.scope.$on("custom-attributes-values:edit",function(t){return function(){return t.rootscope.$broadcast("object:updated")}}(this))},e.prototype.initializeOnDeleteGoToUrl=function(){var t;return t={project:this.scope.project.slug},this.scope.project.is_issues_activated?this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-issues",t):this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t)},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),t.scope.statusList=e.issue_statuses,t.scope.statusById=c(e.issue_statuses,function(t){return t.id}),t.scope.typeById=c(e.issue_types,function(t){return t.id}),t.scope.typeList=_.sortBy(e.issue_types,"order"),t.scope.severityList=e.severities,t.scope.severityById=c(e.severities,function(t){return t.id}),t.scope.priorityList=e.priorities,t.scope.priorityById=c(e.priorities,function(t){return t.id}),e}}(this))},e.prototype.loadIssue=function(){return this.rs.issues.getByRef(this.scope.projectId,this.params.issueref).then(function(t){return function(e){var r,n,i;return t.scope.issue=e,t.scope.issueId=e.id,t.scope.commentModel=e,t.modelTransform.setObject(t.scope,"issue"),null!=(null!=(n=t.scope.issue.neighbors.previous)?n.ref:void 0)&&(r={project:t.scope.project.slug,ref:t.scope.issue.neighbors.previous.ref},t.scope.previousUrl=t.navUrls.resolve("project-issues-detail",r)),null!=(null!=(i=t.scope.issue.neighbors.next)?i.ref:void 0)?(r={project:t.scope.project.slug,ref:t.scope.issue.neighbors.next.ref},t.scope.nextUrl=t.navUrls.resolve("project-issues-detail",r)):void 0}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(e){return t.fillUsersAndRoles(e.members,e.roles),t.loadIssue()}}(this))},e.prototype.onUpvote=function(){var t,e;return e=function(t){return function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.issues.upvote(this.scope.issueId).then(e,t)},e.prototype.onDownvote=function(){var t,e;return e=function(t){return function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.issues.downvote(this.scope.issueId).then(e,t)},e.prototype.onWatch=function(){var t,e;return e=function(t){return function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.issues.watch(this.scope.issueId).then(e,t)},e.prototype.onUnwatch=function(){var t,e;return e=function(t){return function(){return t.loadIssue(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.issues.unwatch(this.scope.issueId).then(e,t)},e}(p(f.Controller,f.PageMixin)),d.controller("IssueDetailController",t),i=function(t,e){var r,n;return n=t.get("common/components/status-display.html",!0),r=function(t,r,i){var o;return o=function(i){var o,s;return s=t.statusById[i.status],o=n({is_closed:s.is_closed,status:s}),o=e(o)(t),r.html(o)},t.$watch(i.ngModel,function(t){return null!=t?o(t):void 0}),t.$on("$destroy",function(){return r.off()})},{link:r,restrict:"EA",require:"ngModel"}},d.directive("tgIssueStatusDisplay",["$tgTemplate","$compile",i]),n=function(t,e,r,n,i,o,s){var a,u;return u=o.get("common/components/status-button.html",!0),a=function(e,o,a,c){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_issue")},p=function(t){return function(t){var r,n;return n=e.statusById[t.status],r=u({status:n,statuses:e.statusList,editable:l()}),r=s(r)(e),o.html(r)}}(this),d=function(e){var s,a,u,c;return $.fn.popover().closeAll(),s=n().target(o).start(),c=i.save(function(t){return t.status=e,t}),u=function(){return t.$broadcast("object:updated"),s.finish()},a=function(){return r.notify("error"),s.finish()},c.then(u,a)},o.on("click",".js-edit-status",function(t){return t.preventDefault(),t.stopPropagation(),l()?o.find(".pop-status").popover().open():void 0}),o.on("click",".status",function(t){var e;return t.preventDefault(),t.stopPropagation(),l()?(e=angular.element(t.currentTarget),d(e.data("status-id"))):void 0}),e.$watch(function(){var t;return null!=(t=c.$modelValue)?t.status:void 0},function(){var t;return t=c.$modelValue,t?p(t):void 0}),e.$on("$destroy",function(){return o.off()})},{link:a,restrict:"EA",require:"ngModel"}},d.directive("tgIssueStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),o=function(t,e,r,n,i,o,s){var a,u;return u=o.get("issue/issue-type-button.html",!0),a=function(e,o,a,c){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_issue")},p=function(t){return function(t){var r,n;return n=e.typeById[t.type],r=u({type:n,typees:e.typeList,editable:l()}),r=s(r)(e),o.html(r)}}(this),d=function(e){var s,a,u,c;return $.fn.popover().closeAll(),s=n().target(o.find(".level-name")).start(),c=i.save(function(t){
return t.type=e,t}),u=function(){return t.$broadcast("object:updated"),s.finish()},a=function(){return r.notify("error"),s.finish()},c.then(u,a)},o.on("click",".type-data",function(t){return t.preventDefault(),t.stopPropagation(),l()?o.find(".pop-type").popover().open():void 0}),o.on("click",".type",function(t){var e,r;return t.preventDefault(),t.stopPropagation(),l()?(e=angular.element(t.currentTarget),r=e.data("type-id"),d(r)):void 0}),e.$watch(function(){var t;return null!=(t=c.$modelValue)?t.type:void 0},function(){var t;return t=c.$modelValue,t?p(t):void 0}),e.$on("$destroy",function(){return o.off()})},{link:a,restrict:"EA",require:"ngModel"}},d.directive("tgIssueTypeButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",o]),r=function(t,e,r,n,i,o,s){var a,u;return u=o.get("issue/issue-severity-button.html",!0),a=function(e,o,a,c){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_issue")},p=function(t){return function(t){var r,n;return n=e.severityById[t.severity],r=u({severity:n,severityes:e.severityList,editable:l()}),r=s(r)(e),o.html(r)}}(this),d=function(e){var s,a,u,c;return $.fn.popover().closeAll(),s=n().target(o.find(".level-name")).start(),c=i.save(function(t){return t.severity=e,t}),u=function(){return t.$broadcast("object:updated"),s.finish()},a=function(){return r.notify("error"),s.finish()},c.then(u,a)},o.on("click",".severity-data",function(t){return t.preventDefault(),t.stopPropagation(),l()?o.find(".pop-severity").popover().open():void 0}),o.on("click",".severity",function(t){var e,r;return t.preventDefault(),t.stopPropagation(),l()?(r=angular.element(t.currentTarget),e=r.data("severity-id"),d(e)):void 0}),e.$watch(function(){var t;return null!=(t=c.$modelValue)?t.severity:void 0},function(){var t;return t=c.$modelValue,t?p(t):void 0}),e.$on("$destroy",function(){return o.off()})},{link:a,restrict:"EA",require:"ngModel"}},d.directive("tgIssueSeverityButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",r]),e=function(t,e,r,n,i,o,s){var a,u;return u=o.get("issue/issue-priority-button.html",!0),a=function(e,o,a,c){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_issue")},p=function(t){return function(t){var r,n;return n=e.priorityById[t.priority],r=u({priority:n,priorityes:e.priorityList,editable:l()}),r=s(r)(e),o.html(r)}}(this),d=function(e){var s,a,u,c;return $.fn.popover().closeAll(),s=n().target(o.find(".level-name")).start(),c=i.save(function(t){return t.priority=e,t}),u=function(){return t.$broadcast("object:updated"),s.finish()},a=function(){return r.notify("error"),s.finish()},c.then(u,a)},o.on("click",".priority-data",function(t){return t.preventDefault(),t.stopPropagation(),l()?o.find(".pop-priority").popover().open():void 0}),o.on("click",".priority",function(t){var e,r;return t.preventDefault(),t.stopPropagation(),l()?(r=angular.element(t.currentTarget),e=r.data("priority-id"),d(e)):void 0}),e.$watch(function(){var t;return null!=(t=c.$modelValue)?t.priority:void 0},function(){var t;return t=c.$modelValue,t?p(t):void 0}),e.$on("$destroy",function(){return o.off()})},{link:a,restrict:"EA",require:"ngModel"}},d.directive("tgIssuePriorityButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",e]),s=function(t,e,r,n){var i;return i=function(i,o,s,a){var u;return u=function(n){return function(n,i){var o,s,a;return o={generated_from_issue:n.id,project:n.project,subject:n.subject,description:n.description,tags:n.tags,is_blocked:n.is_blocked,blocked_note:n.blocked_note},a=function(){return i.finish(),r.notify("success"),t.$broadcast("promote-issue-to-us:success")},s=function(){return i.finish(),r.notify("error")},e.create("userstories",o).then(a,s)}}(this),o.on("click","a",function(t){var e,i,o,s;return t.preventDefault(),e=a.$modelValue,s=n.instant("ISSUES.CONFIRM_PROMOTE.TITLE"),i=n.instant("ISSUES.CONFIRM_PROMOTE.MESSAGE"),o=e.subject,r.ask(s,o,i).then(function(t){return function(t){return u(e,t)}}(this))}),i.$on("$destroy",function(){return o.off()})},{restrict:"AE",require:"ngModel",templateUrl:"issue/promote-issue-to-us-button.html",link:i}},d.directive("tgPromoteIssueToUsButton",["$rootScope","$tgRepo","$tgConfirm","$translate",s])}.call(this),function(){var t,e,r,n,i,o;o=this.taiga,r=this.taiga.bindOnce,n=this.taiga.debounce,i=angular.module("taigaIssues"),e=function(t,e,r,i,o,s,a){var u;return u=function(u,c,l){var p,d,f,h,m,g;return f=c.find("form").checksley(),u.issue={},u.attachments=Immutable.List(),u.$on("issueform:new",function(t,e){return f.reset(),h(),c.find(".tag-input").val(""),i.open(c),u.issue={project:e.id,subject:"",status:e.default_issue_status,type:e.default_issue_type,priority:e.default_priority,severity:e.default_severity,tags:[]}}),u.$on("$destroy",function(){return c.off()}),d=function(t){var e;return e=_.map(p.toJS(),function(e){return a.upload(e.file,t.id,u.issue.project,"issue")}),s.all(e)},p=Immutable.List(),h=function(){return p=Immutable.List(),u.attachments=Immutable.List()},u.addAttachment=function(t){return p=p.push(t)},m=n(2e3,function(n){return function(n){var s,a;return n.preventDefault(),f.validate()?(s=o().target(g).start(),a=t.create("issues",u.issue),a.then(function(t){return d(t)}),a.then(function(t){return s.finish(),r.$broadcast("issueform:new:success",t),i.close(c),e.notify("success")}),a.then(null,function(){return s.finish(),e.notify("error")})):void 0}}(this)),g=c.find(".submit-button"),c.on("submit","form",m)},{link:u}},i.directive("tgLbCreateIssue",["$tgRepo","$tgConfirm","$rootScope","lightboxService","$tgLoading","$q","tgAttachmentsService",e]),t=function(t,e,r,i,o,s){var a;return a=function(t,a,u){var c,l,p;return c=null,t.$on("issueform:bulk",function(e,r,n){return c&&c.reset(),s.open(a),t["new"]={projectId:r,bulk:""}}),l=n(2e3,function(n){return function(n){var u,l,d,f;return n.preventDefault(),c=a.find("form").checksley(),c.validate()?(u=o().target(p).start(),l=t["new"].bulk,d=t["new"].projectId,f=e.issues.bulkCreate(d,l),f.then(function(t){return u.finish(),i.$broadcast("issueform:new:success",t),s.close(a),r.notify("success")}),f.then(null,function(){return u.finish(),r.notify("error")})):void 0}}(this)),p=a.find(".submit-button"),a.on("submit","form",l),t.$on("$destroy",function(){return a.off()})},{link:a}},i.directive("tgLbCreateBulkIssues",["$tgRepo","$tgResources","$tgConfirm","$rootScope","$tgLoading","lightboxService",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m=function(t,e){return function(){return t.apply(e,arguments)}},g=function(t,e){function r(){this.constructor=t}for(var n in e)v.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},v={}.hasOwnProperty;d=this.taiga,c=this.taiga.mixOf,h=this.taiga.trim,f=this.taiga.toString,u=this.taiga.joinStr,a=this.taiga.groupBy,o=this.taiga.bindOnce,s=this.taiga.debounceLeading,p=this.taiga.startswith,l=angular.module("taigaIssues"),r=function(t){function e(t,e,r,n,i,o,s,a,u,c,l,p,d,f){var h,g;return this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.urls=o,this.params=s,this.q=a,this.location=u,this.appMetaService=c,this.navUrls=l,this.events=p,this.analytics=d,this.translate=f,this.loadIssues=m(this.loadIssues,this),this.scope.sectionName="Issues",this.scope.filters={},_.isEmpty(this.location.search())?(h=this.rs.issues.getFilters(this.params.pslug),h.page=1,this.location.search(h),void this.location.replace()):(g=this.loadInitialData(),g.then(function(t){return function(){var e,r;return r=t.translate.instant("ISSUES.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.translate.instant("ISSUES.PAGE_DESCRIPTION",{projectName:t.scope.project.name,projectDescription:t.scope.project.description}),t.appMetaService.setAll(r,e)}}(this)),g.then(null,this.onInitialDataError.bind(this)),void this.scope.$on("issueform:new:success",function(t){return function(){return t.analytics.trackEvent("issue","create","create issue on issues list",1),t.loadIssues()}}(this)))}return g(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$tgUrls","$routeParams","$q","$tgLocation","tgAppMetaService","$tgNavUrls","$tgEvents","$tgAnalytics","$translate"],e.prototype.initializeSubscription=function(){var t;return t="changes.project."+this.scope.projectId+".issues",this.events.subscribe(this.scope,t,function(t){return function(e){return t.loadIssues()}}(this))},e.prototype.storeFilters=function(){return this.rs.issues.storeFilters(this.params.pslug,this.location.search())},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return e.is_issues_activated||t.location.path(t.navUrls.resolve("permission-denied")),t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),t.scope.issueStatusById=a(e.issue_statuses,function(t){return t.id}),t.scope.issueStatusList=_.sortBy(e.issue_statuses,"order"),t.scope.severityById=a(e.severities,function(t){return t.id}),t.scope.severityList=_.sortBy(e.severities,"order"),t.scope.priorityById=a(e.priorities,function(t){return t.id}),t.scope.priorityList=_.sortBy(e.priorities,"order"),t.scope.issueTypes=_.sortBy(e.issue_types,"order"),t.scope.issueTypeById=a(e.issue_types,function(t){return t.id}),e}}(this))},e.prototype.getUrlFilters=function(){var t;return t=_.pick(this.location.search(),"page","tags","status","types","q","severities","priorities","assignedTo","createdBy","orderBy"),t.page||(t.page=1),t},e.prototype.getUrlFilter=function(t){var e;return e=_.pick(this.location.search(),t),e[t]},e.prototype.loadMyFilters=function(){return this.rs.issues.getMyFilters(this.scope.projectId).then(function(t){return function(t){return _.map(t,function(t,e){return{id:e,name:e,type:"myFilters",selected:!1}})}}(this))},e.prototype.removeNotExistingFiltersFromUrl=function(){var t,e,r,n,i,o;t=this.location.search(),o=this.getUrlFilters();for(r in o)n=o[r],"page"!==r&&"orderBy"!==r&&"q"!==r&&(i="tags"===r?_.map((""+n).split(",")):_.map((""+n).split(","),function(t){return"null"===t?null:parseInt(t)}),e=_.intersection(i,_.map(this.scope.filters[r],"id")),i.length!==e.length&&this.location.search(r,e.join()));return t!==this.location.search()?this.location.replace():void 0},e.prototype.markSelectedFilters=function(t,e){var r,n,i,o,s,a,u,c,l,p,d,f;p={},u=_.omit(e,"page","orderBy");for(s in u)for(f=u[s],null==p[s]&&(p[s]={}),c=(""+f).split(","),n=0,o=c.length;o>n;n++)d=c[n],p[s][d]=!0;r=function(t,e){return!(null==p[t]||!p[t][e])},l=[];for(i in t)f=t[i],l.push(function(){var t,e,n;for(n=[],t=0,e=f.length;e>t;t++)a=f[t],n.push(a.selected=r(a.type,a.id)?!0:void 0);return n}());return l},e.prototype.loadFilters=function(){var t,e,r;return r=this.getUrlFilters(),r.q&&(this.scope.filtersQ=r.q),e=this.loadMyFilters().then(function(t){return function(e){return t.scope.filters.myFilters=e,e}}(this)),t={},t.project=this.scope.projectId,t.tags=r.tags,t.status=r.status,t.q=r.q,t.types=r.types,t.severities=r.severities,t.priorities=r.priorities,t.assigned_to=r.assignedTo,t.owner=r.createdBy,e=e.then(function(e){return function(){return e.rs.issues.filtersData(t)}}(this)),e.then(function(t){return function(e){var n,i,o;return o=function(t,e,r){var n,i;return n=_.map(t,function(t){return t.type=e,t.name=t.full_name?t.full_name:r,t}),i=_.remove(n,function(t){return!t.id}),n=_.sortBy(n,function(t){return t.name.toUpperCase()}),i.length>0&&n.unshift(i[0]),n},n=function(t,e,r){return _.map(t,function(t){return t.type=e,t})},i=function(t){return _.map(t,function(t){return t.id=t.name,t.type="tags",t})},t.scope.filters.status=n(e.statuses,"status",t.scope.issueStatusById),t.scope.filters.severities=n(e.severities,"severities",t.scope.severityById),t.scope.filters.priorities=n(e.priorities,"priorities",t.scope.priorityById),t.scope.filters.assignedTo=o(e.assigned_to,"assignedTo","Unassigned"),t.scope.filters.createdBy=o(e.owners,"createdBy","Unknown"),t.scope.filters.types=n(e.types,"types",t.scope.issueTypeById),t.scope.filters.tags=i(e.tags),t.removeNotExistingFiltersFromUrl(),t.markSelectedFilters(t.scope.filters,r),t.rootscope.$broadcast("filters:loaded",t.scope.filters)}}(this))},e.prototype.loadIssuesRequests=0,e.prototype.loadIssues=function(){var t,e,r,n;this.scope.urlFilters=this.getUrlFilters(),this.scope.httpParams={},r=this.scope.urlFilters;for(t in r)n=r[t],"severities"===t?t="severity":"orderBy"===t?t="order_by":"priorities"===t?t="priority":"assignedTo"===t?t="assigned_to":"createdBy"===t?t="owner":"status"===t?t="status":"types"===t&&(t="type"),this.scope.httpParams[t]=n;return e=this.rs.issues.list(this.scope.projectId,this.scope.httpParams),this.loadIssuesRequests+=1,e.index=this.loadIssuesRequests,e.then(function(t){return function(r){return e.index===t.loadIssuesRequests&&(t.scope.issues=r.models,t.scope.page=r.current,t.scope.count=r.count,t.scope.paginatedBy=r.paginatedBy),r}}(this)),e},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(e){return t.fillUsersAndRoles(e.members,e.roles),t.initializeSubscription(),t.loadFilters(),t.loadIssues()}}(this))},e.prototype.saveCurrentFiltersTo=function(t){var e;return e=this.q.defer(),this.rs.issues.getMyFilters(this.scope.projectId).then(function(r){return function(n){return n[t]=r.location.search(),r.rs.issues.storeMyFilters(r.scope.projectId,n).then(function(){return e.resolve()})}}(this)),e.promise},e.prototype.deleteMyFilter=function(t){var e;return e=this.q.defer(),this.rs.issues.getMyFilters(this.scope.projectId).then(function(r){return function(n){return delete n[t],r.rs.issues.storeMyFilters(r.scope.projectId,n).then(function(){return e.resolve()})}}(this)),e.promise},e.prototype.addNewIssue=function(){return this.rootscope.$broadcast("issueform:new",this.scope.project)},e.prototype.addIssuesInBulk=function(){return this.rootscope.$broadcast("issueform:bulk",this.scope.projectId)},e}(c(d.Controller,d.PageMixin,d.FiltersMixin)),l.controller("IssuesController",r),n=function(t,e,r,n){var i,o,s,a;return a=r.get("issue/issue-paginator.html",!0),s=function(t,e,r,i){var o,s,u,c,l,p,d;return s=2,l=4,u=2,c=2,o=e.find(".issues-paginator"),p=function(){var e;return e=t.count/t.paginatedBy,e=parseInt(e,10)<e?parseInt(e,10)+1:parseInt(e,10)},d=function(){var e,r,i,d,f,h,m,g;if(f=p(),1>=f)return void o.hide();for(o.show(),m=[],h={},h.pages=m,h.showPrevious=t.page>1,h.showNext=!(t.page===f),e=t.page,i=d=1,g=f;g>=1?g>=d:d>=g;i=g>=1?++d:--d)i===e+s&&f>e+s+c?m.push({classes:"dots",type:"dots"}):i===e-l&&e>u+l?m.push({classes:"dots",type:"dots"}):i>e+s&&f-c>=i||e-l>i&&i>u||(i===e?m.push({classes:"active",num:i,type:"page-active"}):m.push({classes:"page",num:i,type:"page"}));return r=a(h),r=n(r)(t),o.html(r)},t.$watch("issues",function(t){return t?d():void 0}),e.on("click",".issues-paginator a.next",function(e){return e.preventDefault(),t.$apply(function(){return i.selectFilter("page",t.page+1),i.loadIssues()})}),e.on("click",".issues-paginator a.previous",function(e){return e.preventDefault(),t.$apply(function(){return i.selectFilter("page",t.page-1),i.loadIssues()})}),e.on("click",".issues-paginator li.page > a",function(e){var r,n;return e.preventDefault(),n=angular.element(e.currentTarget),r=n.data("pagenum"),t.$apply(function(){return i.selectFilter("page",r),i.loadIssues()})})},o=function(t,e,r,n){var i,o,s;return o=n.getUrlFilter("orderBy")||"created_date",o&&(s=p(o,"-")?"icon-arrow-up":"icon-arrow-bottom",i=e.find(".row.title > div[data-fieldname='"+h(o,"-")+"']"),i.html(i.html()+"<span class='icon "+s+"'></span>")),e.on("click",".row.title > div",function(r){var i,a,u;return u=angular.element(r.currentTarget),o=n.getUrlFilter("orderBy"),a=u.data("fieldname"),i=o===a?"-"+a:a,t.$apply(function(){return n.replaceFilter("orderBy",i),n.storeFilters(),n.loadIssues().then(function(){return e.find(".row.title > div > span.icon").remove(),s=p(i,"-")?"icon-arrow-up":"icon-arrow-bottom",u.html(u.html()+"<span class='icon "+s+"'></span>")})})})},i=function(t,e,r){var n;return n=e.controller(),o(t,e,r,n),s(t,e,r,n),t.$on("$destroy",function(){return e.off()})},{link:i}},l.directive("tgIssues",["$log","$tgLocation","$tgTemplate","$compile",n]),i=function(t,e,r,n,i,o,a,u,c,l){var p,f,h;return f=a.get("issue/issues-filters.html",!0),h=a.get("issue/issues-filters-selected.html",!0),p=function(e,r,a){var p,m,g,v,y,b,$,S,k,j,I,T;return p=r.closest(".wrapper").controller(),S=[],j=function(t,e){return r.find(".filters-cats").hide(),r.find(".filter-list").removeClass("hidden"),r.find(".breadcrumb").removeClass("hidden"),r.find("h2 .subfilter .title").html(t),r.find("h2 .subfilter .title").prop("data-type",e)},k=function(){return r.find(".filters-cats").show(),r.find(".filter-list").addClass("hidden"),r.find(".breadcrumb").addClass("hidden")},g=function(t){var e,r,n,i,o;S=[];for(n in t)for(o=t[n],e=0,r=o.length;r>e;e++)i=o[e],i.selected&&S.push(i);return b(S)},b=function(t){var n;return _.filter(t,function(t){return function(t){return t.color?t.style="border-left: 3px solid "+t.color:void 0}}(this)),n=h({filters:t}),n=c(n)(e),r.find(".filters-applied").html(n),l.isAuthenticated()&&t.length>0?r.find(".save-filters").show():r.find(".save-filters").hide()},y=function(t){var n;return _.filter(t,function(t){return function(t){return t.color?t.style="border-left: 3px solid "+t.color:void 0}}(this)),n=f({filters:t}),n=c(n)(e),r.find(".filter-list").html(n)},m=function(){return r.find(".subfilter .title").prop("data-type")},v=function(){var r;return r=m(),t.all([p.loadIssues(),p.loadFilters()]).then(function(){var t;return t=e.filters[r],y(_.reject(t,"selected"))})},I=function(t,r){var i,o,s,a;return"myFilters"===t?(n.issues.getMyFilters(e.projectId).then(function(t){var n,i;return i=t,n=i[r],n.page=1,p.replaceAllFilters(n),p.storeFilters(),p.loadIssues(),p.markSelectedFilters(e.filters,n),g(e.filters)}),null):(a=e.filters[t],s="tags"===t?d.toString(r):r,o=_.find(a,{id:s}),o.selected=!o.selected,null===r&&(r="null"),o.selected?(S.push(o),p.selectFilter(t,r),p.selectFilter("page",1),p.storeFilters()):(S=_.reject(S,function(t){return t.id===o.id&&t.type===o.type}),p.unselectFilter(t,r),p.selectFilter("page",1),p.storeFilters()),v(),b(S),i=m(),t===i?y(_.reject(a,"selected")):void 0)},e.$on("filters:loaded",function(t,e){return g(e)}),e.$on("filters:issueupdate",function(t,n){var i;return i=f({filters:n.status}),i=c(i)(e),r.find(".filter-list").html(i)}),$=s(100,function(t,e){return void 0!==t&&t!==e?(p.replaceFilter("page",null,!0),0===t.length?(p.replaceFilter("q",null),p.storeFilters()):(p.replaceFilter("q",t),p.storeFilters()),v()):void 0}),T=e.$watch("issues",function(t){return _.isUndefined(t)?void 0:(e.$watch("filtersQ",$),T())}),r.on("click",".filters-cat-single",function(t){var r,n;return t.preventDefault(),n=angular.element(t.currentTarget),r=e.filters[n.data("type")],y(_.reject(r,"selected")),j(n.attr("title"),n.data("type"))}),r.on("click",".back",function(t){return t.preventDefault(),k(r)}),r.on("click",".filters-applied .remove-filter",function(t){var e,r,n;return t.preventDefault(),r=angular.element(t.currentTarget).parent(),e=r.data("id")||null,n=r.data("type"),I(n,e)}),r.on("click",".filter-list .single-filter",function(t){var e,r,n;return t.preventDefault(),r=angular.element(t.currentTarget),r.toggleClass("active"),e=r.data("id")||null,n=r.data("type"),"myFilters"===n&&r.removeClass("active"),I(n,e)}),r.on("click",".filter-list .remove-filter",function(t){var r,n,o,s;return t.preventDefault(),t.stopPropagation(),o=angular.element(t.currentTarget),r=o.parent().data("id"),s=u.instant("ISSUES.FILTERS.CONFIRM_DELETE.TITLE"),n=u.instant("ISSUES.FILTERS.CONFIRM_DELETE.MESSAGE",{customFilterName:r}),i.askOnDelete(s,n).then(function(t){var n;return n=p.deleteMyFilter(r),n.then(function(){return n=p.loadMyFilters(),n.then(function(r){return t.finish(),e.filters.myFilters=r,y(e.filters.myFilters)}),n.then(null,function(){return t.finish()})}),n.then(null,function(){return t.finish(!1),i.notify("error")})})}),r.on("click",".save-filters",function(t){return t.preventDefault(),y(e.filters.myFilters),j("My filters","myFilters"),r.find(".save-filters").hide(),r.find(".my-filter-name").removeClass("hidden"),r.find(".my-filter-name").focus(),e.$apply()}),r.on("keyup",".my-filter-name",function(t){var n,s,a,u;return t.preventDefault(),13===t.keyCode?(u=angular.element(t.currentTarget),s=u.val(),n=o().target(r.find(".new")).start(),a=p.saveCurrentFiltersTo(s),a.then(function(){var t;return t=p.loadMyFilters(),t.then(function(t){var i;return n.finish(),e.filters.myFilters=t,i=r.find("h2 .subfilter .title").prop("data-type"),"myFilters"===i&&y(e.filters.myFilters),r.find(".my-filter-name").addClass("hidden"),r.find(".save-filters").show()}),t.then(null,function(){return n.finish(),i.notify("error","Error loading custom filters")})}),a.then(null,function(){return n.finish(),r.find(".my-filter-name").val(s).focus().select(),i.notify("error","Filter not saved")})):27===t.keyCode?(r.find(".my-filter-name").val(""),r.find(".my-filter-name").addClass("hidden"),r.find(".save-filters").show()):void 0})},{link:p}},l.directive("tgIssuesFilters",["$q","$log","$tgLocation","$tgResources","$tgConfirm","$tgLoading","$tgTemplate","$translate","$compile","$tgAuth",i]),e=function(t,e,r){var n,i,o;return i=e.get("issue/issue-status-inline-edition-selection.html",!0),o=function(t,e,r){var n,i,o;return i=t.find(".issue-status"),n=t.find(".issue-status .issue-status-bind"),o=r[e.status],o?(n.text(o.name),n.prop("title",o.name),i.css("color",o.color)):void 0},n=function(e,n,s){var a,u;return a=n.controller(),u=e.$eval(s.tgIssueStatusInlineEdition),n.on("click",".issue-status",function(t){return t.preventDefault(),t.stopPropagation(),n.find(".pop-status").popover().open()}),n.on("click",".status",function(i){var s,c,l,p,d;for(i.preventDefault(),i.stopPropagation(),d=angular.element(i.currentTarget),p=e.filters.status,c=0,l=p.length;l>c;c++)s=p[c],s.id===u.status&&s.count--;return u.status=d.data("status-id"),n.find(".pop-status").popover().close(),o(n,u,e.issueStatusById),e.$apply(function(){var n,i,o;for(t.save(u).then(function(){return a.loadIssues()}),o=e.filters.status,n=0,i=o.length;i>n;n++)s=o[n],s.id===u.status&&s.count++;return r.$broadcast("filters:issueupdate",e.filters)})}),d.bindOnce(e,"project",function(t){return n.append(i({statuses:t.issue_statuses})),o(n,u,e.issueStatusById),-1===t.my_permissions.indexOf("modify_issue")?(n.unbind("click"),n.find("a").addClass("not-clickable")):void 0}),e.$watch(s.tgIssueStatusInlineEdition,function(t){return function(t){return o(n,t,e.issueStatusById)}}(this)),e.$on("$destroy",function(){return n.off()})},{link:n}},l.directive("tgIssueStatusInlineEdition",["$tgRepo","$tgTemplate","$rootScope",e]),t=function(t,e,r){var n,i;return i=_.template('<img src="<%- imgurl %>" alt="<%- name %>"/>\n<figcaption><%- name %></figcaption>'),n=function(n,o,s){var a,u,c;return c=function(t){var e,s;return e={name:r.instant("COMMON.ASSIGNED_TO.NOT_ASSIGNED"),imgurl:"/"+window._version+"/images/unnamed.png"},s=n.usersById[t.assigned_to],s&&(e.name=s.full_name_display,e.imgurl=s.photo),o.find(".avatar").html(i(e)),o.find(".issue-assignedto").attr("title",e.name)},a=o.controller(),u=n.$eval(s.tgIssueAssignedToInlineEdition),c(u),o.on("click",".issue-assignedto",function(t){return e.$broadcast("assigned-to:add",u)}),d.bindOnce(n,"project",function(t){return-1===t.my_permissions.indexOf("modify_issue")?(o.unbind("click"),o.find("a").addClass("not-clickable")):void 0}),n.$on("assigned-to:added",function(e){return function(e,r,n){return n.id===u.id?(n.assigned_to=r,t.save(n),c(n)):void 0}}(this)),n.$watch(s.tgIssueAssignedToInlineEdition,function(t){return function(t){return c(t)}}(this)),n.$on("$destroy",function(){return o.off()})},{link:n}},l.directive("tgIssueAssignedToInlineEdition",["$tgRepo","$rootScope","$translate",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p=function(t,e){function r(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},d={}.hasOwnProperty;l=this.taiga,u=this.taiga.mixOf,a=this.taiga.groupBy,s=this.taiga.bindOnce,o=this.taiga.bindMethods,c=angular.module("taigaUserStories"),i=function(t){function e(t,e,r,n,i,s,a,u,c,l,p,d,f,h){var m;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=s,this.q=a,this.location=u,this.log=c,this.appMetaService=l,this.navUrls=p,this.analytics=d,this.translate=f,this.modelTransform=h,o(this),this.scope.usRef=this.params.usref,this.scope.sectionName=this.translate.instant("US.SECTION_NAME"),this.initializeEventHandlers(),m=this.loadInitialData(),m.then(function(t){return function(){return t._setMeta(),t.initializeOnDeleteGoToUrl()}}(this)),m.then(null,this.onInitialDataError.bind(this))}return p(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","$tgQueueModelTransformation"],e.prototype._setMeta=function(){var t,e,r,n,i,o;return o=this.scope.tasks.length,t=_.filter(this.scope.tasks,function(t){return function(e){return t.scope.taskStatusById[e.status].is_closed}}(this)).length,r=o>0?Math.round(100*t/o):0,i=this.translate.instant("US.PAGE_TITLE",{userStoryRef:"#"+this.scope.us.ref,userStorySubject:this.scope.us.subject,projectName:this.scope.project.name}),e=this.translate.instant("US.PAGE_DESCRIPTION",{userStoryStatus:(null!=(n=this.scope.statusById[this.scope.us.status])?n.name:void 0)||"--",userStoryPoints:this.scope.us.total_points,userStoryDescription:angular.element(this.scope.us.description_html||"").text(),userStoryClosedTasks:t,userStoryTotalTasks:o,userStoryProgressPercentage:r}),this.appMetaService.setAll(i,e)},e.prototype.initializeEventHandlers=function(){return this.scope.$on("related-tasks:update",function(t){return function(){var e;return t.scope.tasks=_.clone(t.scope.tasks,!1),e=_.every(t.scope.tasks,function(t){return t.is_closed}),t.scope.us.is_closed!==e?t.loadUs():void 0}}(this)),this.scope.$on("attachment:create",function(t){return function(){return t.analytics.trackEvent("attachment","create","create attachment on userstory",1)}}(this)),this.scope.$on("comment:new",function(t){return function(){return t.loadUs()}}(this))},e.prototype.initializeOnDeleteGoToUrl=function(){var t;return t={project:this.scope.project.slug},this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t),this.scope.project.is_backlog_activated?this.scope.us.milestone?(t.sprint=this.scope.sprint.slug,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-taskboard",t)):this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-backlog",t):this.scope.project.is_kanban_activated?this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-kanban",t):void 0},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),t.scope.statusList=e.us_statuses,t.scope.statusById=a(e.us_statuses,function(t){return t.id}),t.scope.taskStatusById=a(e.task_statuses,function(t){return t.id}),t.scope.pointsList=_.sortBy(e.points,"order"),t.scope.pointsById=a(t.scope.pointsList,function(t){return t.id}),e}}(this))},e.prototype.loadUs=function(){var t,e,r,n;return t=_.pick(this.location.search(),"milestone","no-milestone","kanban-status"),r=t.milestone,r&&this.rs.userstories.storeQueryParams(this.scope.projectId,{milestone:r,order_by:"sprint_order"}),n=t["no-milestone"],n&&this.rs.userstories.storeQueryParams(this.scope.projectId,{milestone:"null",order_by:"backlog_order"}),e=t["kanban-status"],e&&this.rs.userstories.storeQueryParams(this.scope.projectId,{status:e,order_by:"kanban_order"}),this.rs.userstories.getByRef(this.scope.projectId,this.params.usref).then(function(t){return function(e){var r,n,i;return t.scope.us=e,t.scope.usId=e.id,t.scope.commentModel=e,t.modelTransform.setObject(t.scope,"us"),null!=(null!=(n=t.scope.us.neighbors.previous)?n.ref:void 0)&&(r={project:t.scope.project.slug,ref:t.scope.us.neighbors.previous.ref},t.scope.previousUrl=t.navUrls.resolve("project-userstories-detail",r)),null!=(null!=(i=t.scope.us.neighbors.next)?i.ref:void 0)&&(r={project:t.scope.project.slug,ref:t.scope.us.neighbors.next.ref},t.scope.nextUrl=t.navUrls.resolve("project-userstories-detail",r)),e}}(this))},e.prototype.loadSprint=function(){return this.scope.us.milestone?this.rs.sprints.get(this.scope.us.project,this.scope.us.milestone).then(function(t){return function(e){return t.scope.sprint=e,e}}(this)):void 0},e.prototype.loadTasks=function(){return this.rs.tasks.list(this.scope.projectId,null,this.scope.usId).then(function(t){return function(e){return t.scope.tasks=e,e}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(e){return t.fillUsersAndRoles(e.members,e.roles),t.loadUs().then(function(){return t.q.all([t.loadSprint(),t.loadTasks()])})}}(this))},e.prototype.onUpvote=function(){var t,e;return e=function(t){return function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.userstories.upvote(this.scope.usId).then(e,t)},e.prototype.onDownvote=function(){var t,e;return e=function(t){return function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.userstories.downvote(this.scope.usId).then(e,t)},e.prototype.onWatch=function(){var t,e;return e=function(t){return function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.userstories.watch(this.scope.usId).then(e,t)},e.prototype.onUnwatch=function(){var t,e;return e=function(t){return function(){return t.loadUs(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.userstories.unwatch(this.scope.usId).then(e,t)},e}(u(l.Controller,l.PageMixin)),c.controller("UserStoryDetailController",i),r=function(t,e){var r,n;return n=t.get("common/components/status-display.html",!0),r=function(t,r,i){var o;return o=function(i){var o,s;return s=t.statusById[i.status],o=n({is_closed:i.is_closed,status:s}),o=e(o)(t),r.html(o)},t.$watch(i.ngModel,function(t){return null!=t?o(t):void 0}),t.$on("$destroy",function(){return r.off()})},{link:r,restrict:"EA",require:"ngModel"}},c.directive("tgUsStatusDisplay",["$tgTemplate","$compile",r]),e=function(t,e,r,n,i,o,s){var a,u;return u=o.get("common/components/status-button.html",!0),a=function(e,o,a,c){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_us")},p=function(t){return function(t){var r,n;return n=e.statusById[t.status],r=u({status:n,statuses:e.statusList,editable:l()}),o.html(r),s(o.contents())(e)}}(this),d=function(e){return function(e){var s,a,u,c;return o.find(".pop-status").popover().close(),s=n().target(o.find(".js-edit-status")).start(),c=i.save(function(t){return t.status=e,t}),u=function(){return t.$broadcast("object:updated"),s.finish()},a=function(){return r.notify("error"),s.finish()},c.then(u,a)}}(this),o.on("click",".js-edit-status",function(t){return t.preventDefault(),t.stopPropagation(),l()?o.find(".pop-status").popover().open():void 0}),o.on("click",".status",function(t){var e,r;return t.preventDefault(),t.stopPropagation(),l()?(r=angular.element(t.currentTarget),e=r.data("status-id"),d(e)):void 0}),e.$watch(function(){var t;return null!=(t=c.$modelValue)?t.status:void 0},function(){var t;return t=c.$modelValue,
t?p(t):void 0}),e.$on("$destroy",function(){return o.off()})},{link:a,restrict:"EA",require:"ngModel"}},c.directive("tgUsStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",e]),n=function(t,e,r,n,i,o,s){var a,u;return u=o.get("us/us-team-requirement-button.html",!0),a=function(e,o,a,c){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_us")},p=function(t){var r,n;return r={canEdit:l(),isRequired:t.team_requirement},n=u(r),n=s(n)(e),o.html(n)},d=function(e){var s,a;return s=n().target(o.find("label")).start(),a=i.save(function(t){return t.team_requirement=e,t}),a.then(function(e){return function(){return s.finish(),t.$broadcast("object:updated")}}(this)),a.then(null,function(){return s.finish(),r.notify("error")})},o.on("click",".team-requirement",function(t){var e;if(l())return e=!c.$modelValue.team_requirement,d(e)}),e.$watch(function(){var t;return null!=(t=c.$modelValue)?t.team_requirement:void 0},function(){var t;return t=c.$modelValue,t?p(t):void 0}),e.$on("$destroy",function(){return o.off()})},{link:a,restrict:"EA",require:"ngModel"}},c.directive("tgUsTeamRequirementButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",n]),t=function(t,e,r,n,i,o,s){var a,u;return u=o.get("us/us-client-requirement-button.html",!0),a=function(e,o,a,c){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_us")},p=function(t){var r,n;return r={canEdit:l(),isRequired:t.client_requirement},n=s(u(r))(e),o.html(n)},d=function(e){var s,a;return s=n().target(o.find("label")).start(),a=i.save(function(t){return t.client_requirement=e,t}),a.then(function(e){return function(){return s.finish(),t.$broadcast("object:updated")}}(this)),a.then(null,function(){return r.notify("error")})},o.on("click",".client-requirement",function(t){var e;if(l())return e=!c.$modelValue.client_requirement,d(e)}),e.$watch(function(){var t;return null!=(t=c.$modelValue)?t.client_requirement:void 0},function(){var t;return t=c.$modelValue,t?p(t):void 0}),e.$on("$destroy",function(){return o.off()})},{link:a,restrict:"EA",require:"ngModel"}},c.directive("tgUsClientRequirementButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$tgTemplate","$compile",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},l={}.hasOwnProperty;u=this.taiga,s=this.taiga.mixOf,o=this.taiga.groupBy,i=this.taiga.bindMethods,a=angular.module("taigaTasks"),t=function(t){function e(t,e,r,n,o,s,a,u,c,l,p,d,f,h){var m;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=o,this.params=s,this.q=a,this.location=u,this.log=c,this.appMetaService=l,this.navUrls=p,this.analytics=d,this.translate=f,this.modelTransform=h,i(this),this.scope.taskRef=this.params.taskref,this.scope.sectionName=this.translate.instant("TASK.SECTION_NAME"),this.initializeEventHandlers(),m=this.loadInitialData(),m.then(function(t){return function(){return t._setMeta(),t.initializeOnDeleteGoToUrl()}}(this)),m.then(null,this.onInitialDataError.bind(this))}return c(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate","$tgQueueModelTransformation"],e.prototype._setMeta=function(){var t,e,r;return r=this.translate.instant("TASK.PAGE_TITLE",{taskRef:"#"+this.scope.task.ref,taskSubject:this.scope.task.subject,projectName:this.scope.project.name}),t=this.translate.instant("TASK.PAGE_DESCRIPTION",{taskStatus:(null!=(e=this.scope.statusById[this.scope.task.status])?e.name:void 0)||"--",taskDescription:angular.element(this.scope.task.description_html||"").text()}),this.appMetaService.setAll(r,t)},e.prototype.initializeEventHandlers=function(){return this.scope.$on("attachment:create",function(t){return function(){return t.analytics.trackEvent("attachment","create","create attachment on task",1)}}(this)),this.scope.$on("custom-attributes-values:edit",function(t){return function(){return t.rootscope.$broadcast("object:updated")}}(this)),this.scope.$on("comment:new",function(t){return function(){return t.loadTask()}}(this))},e.prototype.initializeOnDeleteGoToUrl=function(){var t;if(t={project:this.scope.project.slug},this.scope.onDeleteGoToUrl=this.navUrls.resolve("project",t),this.scope.project.is_backlog_activated){if(this.scope.task.milestone)return t.sprint=this.scope.sprint.slug,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-taskboard",t);if(this.scope.task.us)return t.ref=this.scope.us.ref,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-userstories-detail",t)}else if(this.scope.project.is_kanban_activated&&this.scope.us)return t.ref=this.scope.us.ref,this.scope.onDeleteGoToUrl=this.navUrls.resolve("project-userstories-detail",t)},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),t.scope.statusList=e.task_statuses,t.scope.statusById=o(e.task_statuses,function(t){return t.id}),e}}(this))},e.prototype.loadTask=function(){return this.rs.tasks.getByRef(this.scope.projectId,this.params.taskref).then(function(t){return function(e){var r,n,i;return t.scope.task=e,t.scope.taskId=e.id,t.scope.commentModel=e,t.modelTransform.setObject(t.scope,"task"),null!=(null!=(n=t.scope.task.neighbors.previous)?n.ref:void 0)&&(r={project:t.scope.project.slug,ref:t.scope.task.neighbors.previous.ref},t.scope.previousUrl=t.navUrls.resolve("project-tasks-detail",r)),null!=(null!=(i=t.scope.task.neighbors.next)?i.ref:void 0)&&(r={project:t.scope.project.slug,ref:t.scope.task.neighbors.next.ref},t.scope.nextUrl=t.navUrls.resolve("project-tasks-detail",r)),e}}(this))},e.prototype.loadSprint=function(){return this.scope.task.milestone?this.rs.sprints.get(this.scope.task.project,this.scope.task.milestone).then(function(t){return function(e){return t.scope.sprint=e,e}}(this)):void 0},e.prototype.loadUserStory=function(){return this.scope.task.user_story?this.rs.userstories.get(this.scope.task.project,this.scope.task.user_story).then(function(t){return function(e){return t.scope.us=e,e}}(this)):void 0},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(e){return t.fillUsersAndRoles(e.members,e.roles),t.loadTask().then(function(){return t.q.all([t.loadSprint(),t.loadUserStory()])})}}(this))},e.prototype.onUpvote=function(){var t,e;return e=function(t){return function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.tasks.upvote(this.scope.taskId).then(e,t)},e.prototype.onDownvote=function(){var t,e;return e=function(t){return function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.tasks.downvote(this.scope.taskId).then(e,t)},e.prototype.onWatch=function(){var t,e;return e=function(t){return function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.tasks.watch(this.scope.taskId).then(e,t)},e.prototype.onUnwatch=function(){var t,e;return e=function(t){return function(){return t.loadTask(),t.rootscope.$broadcast("object:updated")}}(this),t=function(t){return function(){return t.confirm.notify("error")}}(this),this.rs.tasks.unwatch(this.scope.taskId).then(e,t)},e}(s(u.Controller,u.PageMixin)),a.controller("TaskDetailController",t),n=function(t,e){var r,n;return n=t.get("common/components/status-display.html",!0),r=function(t,r,i){var o;return o=function(i){var o,s;return s=t.statusById[i.status],o=n({is_closed:s.is_closed,status:s}),o=e(o)(t),r.html(o)},t.$watch(i.ngModel,function(t){return null!=t?o(t):void 0}),t.$on("$destroy",function(){return r.off()})},{link:r,restrict:"EA",require:"ngModel"}},a.directive("tgTaskStatusDisplay",["$tgTemplate","$compile",n]),r=function(t,e,r,n,i,o,s,a){var u,c;return c=a.get("common/components/status-button.html",!0),u=function(e,s,a,u){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_task")},p=function(t){return function(t){var r,n;return n=e.statusById[t.status],r=o(c({status:n,statuses:e.statusList,editable:l()}))(e),s.html(r)}}(this),d=function(e){var o,a,u,c;return o=n().target(s).start(),c=i.save(function(t){return t.status=e,t}),u=function(){return t.$broadcast("object:updated"),o.finish()},a=function(){return r.notify("error"),o.finish()},c.then(u,a)},s.on("click",".js-edit-status",function(t){return t.preventDefault(),t.stopPropagation(),l()?s.find(".pop-status").popover().open():void 0}),s.on("click",".status",function(t){var e;return t.preventDefault(),t.stopPropagation(),l()?(e=angular.element(t.currentTarget),$.fn.popover().closeAll(),d(e.data("status-id"))):void 0}),e.$watch(function(){var t;return null!=(t=u.$modelValue)?t.status:void 0},function(){var t;return t=u.$modelValue,t?p(t):void 0}),e.$on("$destroy",function(){return s.off()})},{link:u,restrict:"EA",require:"ngModel"}},a.directive("tgTaskStatusButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$translate","$tgTemplate",r]),e=function(t,e,r,n,i,o,s){var a,u;return u=s.get("issue/iocaine-button.html",!0),a=function(e,s,a,c){var l,p,d;return l=function(){return-1!==e.project.my_permissions.indexOf("modify_task")},p=function(t){var r,n;return l()||t.is_iocaine?(r={isIocaine:t.is_iocaine,isEditable:l()},n=o(u(r))(e),s.html(n)):void s.html("")},d=function(e){var o,a;return o=n().target(s.find("label")).start(),a=i.save(function(t){return t.is_iocaine=e,t}),a.then(function(){return t.$broadcast("object:updated")}),a.then(null,function(){return r.notify("error")}),a["finally"](function(){return o.finish()})},s.on("click",".is-iocaine",function(t){var e;if(l())return e=!c.$modelValue.is_iocaine,d(e)}),e.$watch(function(){var t;return null!=(t=c.$modelValue)?t.is_iocaine:void 0},function(){var t;return t=c.$modelValue,t?p(t):void 0}),e.$on("$destroy",function(){return s.off()})},{link:a,restrict:"EA",require:"ngModel"}},a.directive("tgTaskIsIocaineButton",["$rootScope","$tgRepo","$tgConfirm","$tgLoading","$tgQueueModelTransformation","$compile","$tgTemplate",e])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l=function(t,e){function r(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},p={}.hasOwnProperty;c=this.taiga,a=this.taiga.mixOf,u=angular.module("taigaTeam"),e=function(t){function e(t,e,r,n,i,o,s,a,u,c,l,p){var d;this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.params=i,this.q=o,this.location=s,this.navUrls=a,this.appMetaService=u,this.auth=c,this.translate=l,this.projectService=p,this.scope.sectionName="TEAM.SECTION_NAME",d=this.loadInitialData(),d.then(function(t){return function(){var e,r;return r=t.translate.instant("TEAM.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.translate.instant("TEAM.PAGE_DESCRIPTION",{projectName:t.scope.project.name,projectDescription:t.scope.project.description}),t.appMetaService.setAll(r,e)}}(this)),d.then(null,this.onInitialDataError.bind(this))}return l(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$routeParams","$q","$location","$tgNavUrls","tgAppMetaService","$tgAuth","$translate","tgProjectService"],e.prototype.setRole=function(t){return t?this.scope.filtersRole=t:this.scope.filtersRole=null},e.prototype.loadMembers=function(){var t,e,r,n,i;for(i=this.auth.getUser(),this.scope.totals={},n=this.scope.activeUsers,t=0,e=n.length;e>t;t++)r=n[t],this.scope.totals[r.id]=0;return this.scope.currentUser=_.find(this.scope.activeUsers,{id:null!=i?i.id:void 0}),this.scope.memberships=_.reject(this.scope.activeUsers,{id:null!=i?i.id:void 0})},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),t.scope.issuesEnabled=e.is_issues_activated,t.scope.tasksEnabled=e.is_kanban_activated||e.is_backlog_activated,t.scope.wikiEnabled=e.is_wiki_activated,t.scope.owner=e.owner.id,e}}(this))},e.prototype.loadMemberStats=function(){return this.rs.projects.memberStats(this.scope.projectId).then(function(t){return function(e){var r;return r={},_.forEach(t.scope.totals,function(r,n){var i;return i=_.map(e,function(t,e){return t[n]}),r=_.reduce(i,function(t,e){return t+e}),t.scope.totals[n]=r}),t.scope.stats=t._processStats(e),t.scope.stats.totals=t.scope.totals}}(this))},e.prototype._processStat=function(t){var e,r,n,i,o;r=_.max(_.toArray(t)),n=_.min(_.toArray(t)),i=Object();for(e in t)p.call(t,e)&&(o=t[e],o===n?i[e]=.1:o===r?i[e]=1:i[e]=.5*o/r);return i},e.prototype._processStats=function(t){var e,r;for(e in t)r=t[e],t[e]=this._processStat(r);return t},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(e){var r;return t.fillUsersAndRoles(e.members,e.roles),t.loadMembers(),r=_.map(t.scope.users,function(t){return t.role}),t.scope.roles=_.filter(t.scope.roles,function(t){return-1!==r.indexOf(t.id)}),t.loadMemberStats()}}(this))},e}(a(c.Controller,c.PageMixin)),u.controller("TeamController",e),r=function(){return{templateUrl:"team/team-filter.html"}},u.directive("tgTeamFilters",[r]),i=function(){return{templateUrl:"team/team-member-stats.html",scope:{stats:"=",userId:"=user",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled"}}},u.directive("tgTeamMemberStats",i),n=function(){return{templateUrl:"team/team-member-current-user.html",scope:{project:"=project",currentUser:"=currentuser",stats:"=",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled",owner:"=owner"}}},u.directive("tgTeamCurrentUser",n),o=function(){var t;return t="team/team-members.html",{templateUrl:t,scope:{memberships:"=",filtersQ:"=filtersq",filtersRole:"=filtersrole",stats:"=",issuesEnabled:"=issuesenabled",tasksEnabled:"=tasksenabled",wikiEnabled:"=wikienabled",owner:"=owner"}}},u.directive("tgTeamMembers",o),t=function(t,e,r,n,i,o,s,a){var u;return u=function(t,u,c){var l;return l=function(){var s,u;return u=o.instant("TEAM.ACTION_LEAVE_PROJECT"),s=o.instant("TEAM.CONFIRM_LEAVE_PROJECT"),e.ask(u,s).then(function(o){return function(o){var s;return s=n.projects.leave(t.project.id),s.then(function(){return a.loadProjects().then(function(){return o.finish(),e.notify("success"),r.path(i.resolve("home"))})}),s.then(null,function(t){return t.finish(),e.notify("error",t.data._error_message)})}}(this))},t.leave=function(){return t.project.owner.id===t.user.id?s.create("tg-lightbox-leave-project-warning",{"class":"lightbox lightbox-leave-project-warning"},{isCurrentUser:!0,project:t.project}):l()}},{scope:{user:"=",project:"="},templateUrl:"team/leave-project.html",link:u}},u.directive("tgLeaveProject",["$tgRepo","$tgConfirm","$tgLocation","$tgResources","$tgNavUrls","$translate","tgLightboxFactory","tgCurrentUserService",t]),s=function(){return function(t,e,r){return _.filter(t,function(t){return(!r||t.role===r.id)&&(!e||t.full_name.search(new RegExp(e,"i"))>=0)})}},u.filter("membersFilter",s)}.call(this),function(){var t,e,r,n,i,o,s,a,u,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},l={}.hasOwnProperty;u=this.taiga,s=this.taiga.mixOf,o=this.taiga.groupBy,n=this.taiga.bindOnce,i=this.taiga.debounce,a=angular.module("taigaWiki"),e=function(t){function e(t,e,r,n,i,o,s,a,u,c,l,p,d,f,h){var m;this.scope=t,this.rootscope=e,this.repo=r,this.model=n,this.confirm=i,this.rs=o,this.params=s,this.q=a,this.location=u,this.filter=c,this.log=l,this.appMetaService=p,this.navUrls=d,this.analytics=f,this.translate=h,this.scope.projectSlug=this.params.pslug,this.scope.wikiSlug=this.params.slug,this.scope.wikiTitle=this.scope.wikiSlug,this.scope.sectionName="Wiki",this.scope.linksVisible=!1,m=this.loadInitialData(),m.then(function(t){return function(){return t._setMeta()}}(this)),m.then(null,this.onInitialDataError.bind(this))}return c(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgModel","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$filter","$log","tgAppMetaService","$tgNavUrls","$tgAnalytics","$translate"],e.prototype._setMeta=function(){var t,e,r,n,i;return i=this.translate.instant("WIKI.PAGE_TITLE",{wikiPageName:this.scope.wikiTitle,projectName:this.scope.project.name}),t=this.translate.instant("WIKI.PAGE_DESCRIPTION",{wikiPageContent:angular.element((null!=(e=this.scope.wiki)?e.html:void 0)||"").text(),totalEditions:(null!=(r=this.scope.wiki)?r.editions:void 0)||0,lastModifiedDate:moment(null!=(n=this.scope.wiki)?n.modified_date:void 0).format(this.translate.instant("WIKI.DATETIME"))}),this.appMetaService.setAll(i,t)},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return e.is_wiki_activated||t.location.path(t.navUrls.resolve("permission-denied")),t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),e}}(this))},e.prototype.loadWiki=function(){var t;return t=this.rs.wiki.getBySlug(this.scope.projectId,this.params.slug),t.then(function(t){return function(e){return t.scope.wiki=e,t.scope.wikiId=e.id,t.scope.wiki}}(this)),t.then(null,function(t){return function(e){var r;return t.scope.wikiId=null,-1===t.scope.project.my_permissions.indexOf("add_wiki_page")?null:(r={project:t.scope.projectId,slug:t.scope.wikiSlug,content:""},t.scope.wiki=t.model.make_model("wiki",r),t.scope.wiki)}}(this))},e.prototype.loadWikiLinks=function(){return this.rs.wiki.listLinks(this.scope.projectId).then(function(t){return function(e){var r,n,i,o,s;for(t.scope.wikiLinks=e,o=t.scope.wikiLinks,r=0,n=o.length;n>r;r++)i=o[r],i.url=t.navUrls.resolve("project-wiki-page",{project:t.scope.projectSlug,slug:i.href});return s=_.find(e,{href:t.scope.wikiSlug}),null!=s?t.scope.wikiTitle=s.title:void 0}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(e){return t.fillUsersAndRoles(e.members,e.roles),t.q.all([t.loadWikiLinks(),t.loadWiki()]).then(t.checkLinksPerms.bind(t))}}(this))},e.prototype.checkLinksPerms=function(){return-1!==this.scope.project.my_permissions.indexOf("modify_wiki_link")||-1!==this.scope.project.my_permissions.indexOf("view_wiki_links")&&this.scope.wikiLinks.length?this.scope.linksVisible=!0:void 0},e.prototype["delete"]=function(){var t,e;return e=this.translate.instant("WIKI.DELETE_LIGHTBOX_TITLE"),t=this.scope.wikiTitle,this.confirm.askOnDelete(e,t).then(function(t){return function(e){var r,n;return n=function(){var r;return e.finish(),r={project:t.scope.projectSlug},t.location.path(t.navUrls.resolve("project-wiki",r)),t.confirm.notify("success")},r=function(){return e.finish(!1),t.confirm.notify("error")},t.repo.remove(t.scope.wiki).then(n,r)}}(this))},e}(s(u.Controller,u.PageMixin)),a.controller("WikiDetailController",e),r=function(t,e,r,n){var i,o;return o=e.get("wiki/wiki-summary.html",!0),i=function(e,i,s,a){var u;return u=function(s){var a,u,c;return null==e.usersById?t.error("WikiSummaryDirective requires userById set in scope."):c=e.usersById[s.last_modifier],c=void 0===c?{name:"unknown",imgUrl:"/"+window._version+"/images/user-noimage.png"}:{name:c.full_name_display,imgUrl:c.photo},a={totalEditions:s.editions,lastModifiedDate:moment(s.modified_date).format(n.instant("WIKI.DATETIME")),user:c},u=o(a),u=r(u)(e),i.html(u)},e.$watch(s.ngModel,function(t){return t?u(t):void 0}),e.$on("$destroy",function(){return i.off()})},{link:i,restrict:"EA",require:"ngModel"}},a.directive("tgWikiSummary",["$log","$tgTemplate","$compile","$translate",r]),t=function(t,e,r,n,o,s,a,u){var c;return c=function(c,l,p,d){var f,h,m,g,v,_,y;return g=function(){return-1!==c.project.my_permissions.indexOf("modify_wiki_page")},_=function(){return l.find(".edit-wiki-content").show(),l.find(".view-wiki-content").hide(),l.find("textarea").focus()},y=function(){return l.find(".edit-wiki-content").hide(),l.find(".view-wiki-content").show()},h=function(){return l.find(".view-wiki-content .edit").remove(),l.find(".edit-wiki-content").remove()},f=function(){return d.$modelValue.id?(d.$modelValue.revert(),y()):void 0},m=function(){return t.getSelection?t.getSelection().toString():e.selection?e.selection.createRange().text:null},v=a.bindAdd(function(t){var e,i,a,u;return a=function(e){return null==t.id&&s.trackEvent("wikipage","create","create wiki page",1),d.$setViewValue(e.clone()),n.notify("success"),y()},i=function(){return n.notify("error")},e=o().target(l.find(".save")).start(),u=null!=t.id?r.save(t).then(a,i):r.create("wiki",t).then(a,i),u["finally"](function(){return e.finish()})}),l.on("click","a",function(t){var e,r;return r=angular.element(t.currentTarget),e=r.attr("href"),0===e.indexOf("#")?(t.preventDefault(),$("body").scrollTop($(e).offset().top)):void 0}),l.on("mousedown",".view-wiki-content",function(t){var e;e=angular.element(t.target),g()&&2===t.button}),l.on("mouseup",".view-wiki-content",function(t){var e;return e=angular.element(t.target),m()||!g()||e.is("a")||e.is("pre")?void 0:_()}),l.on("click",".save",i(2e3,function(){return v(c.wiki)})),l.on("click",".cancel",function(){return c.$apply(f)}),l.on("keydown","textarea",function(t){return 27===t.keyCode?c.$applyAsync(function(){var t,e;return e=u.instant("COMMON.CONFIRM_CLOSE_EDIT_MODE_TITLE"),t=u.instant("COMMON.CONFIRM_CLOSE_EDIT_MODE_MESSAGE"),n.ask(e,null,t).then(function(t){return f(),t.finish()})}):void 0}),c.$watch(p.ngModel,function(t){return t?g()?(l.addClass("editable"),null==t.id||0===$.trim(t.content).length?_():void 0):h():void 0}),c.$on("$destroy",function(){return l.off()})},{link:c,restrict:"EA",require:"ngModel",templateUrl:"wiki/editable-wiki-content.html"}},a.directive("tgEditableWikiContent",["$window","$document","$tgRepo","$tgConfirm","$tgLoading","$tgAnalytics","$tgQqueue","$translate",t])}.call(this),function(){var t,e,r,n,i,o;o=this.taiga,n=this.taiga.mixOf,r=this.taiga.groupBy,e=this.taiga.bindOnce,i=angular.module("taigaWiki"),t=function(t,r,n,i,o,s,a,u,c){var l,p;return p=a.get("wiki/wiki-nav.html",!0),l=function(n,a,l){var d,f;return d=a.controller(),null==l.ngModel?r.error("WikiNavDirective: no ng-model attr is defined"):(f=function(e){var r,l,h;return r=n.project.my_permissions.indexOf("add_wiki_link")>-1,l=n.project.my_permissions.indexOf("delete_wiki_link")>-1,h=p({wikiLinks:e,projectSlug:n.projectSlug,addWikiLinkPermission:r,deleteWikiLinkPermission:l}),h=u(h)(n),a.off(),a.html(h),a.on("click",".add-button",function(t){return t.preventDefault(),a.find(".new").removeClass("hidden"),a.find(".new input").focus(),a.find(".add-button").hide()}),a.on("click",".js-delete-link",function(e){var r,o,s,a;return e.preventDefault(),e.stopPropagation(),s=angular.element(e.currentTarget),r=s.parents(".wiki-link").data("id"),a=c.instant("WIKI.DELETE_LIGHTBOX_TITLE"),o=n.wikiLinks[r].title,i.askOnDelete(a,o).then(function(e){return function(e){var o;return o=t.remove(n.wikiLinks[r]),o.then(function(){return o=d.loadWikiLinks(),o.then(function(){return e.finish(),f(n.wikiLinks)}),o.then(null,function(){return e.finish()})}),o.then(null,function(){return e.finish(!1),i.notify("error")})}}(this))}),a.on("keyup",".new input",function(e){var r,u,c,l;return e.preventDefault(),13===e.keyCode?(l=angular.element(e.currentTarget),u=l.val(),r=s().target(a.find(".new")).start(),c=t.create("wiki-links",{project:n.projectId,title:u}),c.then(function(){var t;return o.trackEvent("wikilink","create","create wiki link",1),t=d.loadWikiLinks(),t.then(function(){return r.finish(),a.find(".new").addClass("hidden"),a.find(".new input").val(""),a.find(".add-button").show(),f(n.wikiLinks)}),t.then(null,function(){return r.finish(),a.find(".new").addClass("hidden"),a.find(".new input").val(""),a.find(".add-button").show(),i.notify("error","Error loading wiki links")})}),c.then(null,function(t){var e;return r.finish(),a.find(".new input").val(u),a.find(".new input").focus().select(),null!=(null!=t&&null!=(e=t.__all__)?e[0]:void 0)?i.notify("error","The link already exists"):i.notify("error")})):27===e.keyCode?(l=angular.element(e.currentTarget),a.find(".new").addClass("hidden"),a.find(".new input").val(""),a.find(".add-button").show()):void 0})},e(n,l.ngModel,f))},{link:l}},i.directive("tgWikiNav",["$tgRepo","$log","$tgLocation","$tgConfirm","$tgAnalytics","$tgLoading","$tgTemplate","$compile","$translate",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c;c=this.taiga,a=this.taiga.debounce,u=angular.module("taigaKanban"),n=function(){function t(t,e,r,n,i,o){var s;this.scope=t,this.lightboxService=e,this.tgLoader=r,this.confirm=n,this.rs=i,this.rootScope=o,this._defaultMaxInvites=4,this._defaultRole=this.project.roles[0].id,this.form=null,this.submitInvites=!1,this.canAddUsers=!0,this.memberInvites=[],null===this.project.max_memberships?this.membersLimit=this._defaultMaxInvites:(s=Math.max(this.project.max_memberships-this.project.total_memberships,0),this.membersLimit=Math.min(s,this._defaultMaxInvites)),this.addSingleMember()}return t.$inject=["$scope","lightboxService","tgLoader","$tgConfirm","$tgResources","$rootScope"],t.prototype.addSingleMember=function(){return this.memberInvites.push({email:"",role_id:this._defaultRole}),this.memberInvites.length>=this.membersLimit&&(this.canAddUsers=!1),this.showWarningMessage=!this.canAddUsers&&this.project.total_memberships+this.memberInvites.length===this.project.max_memberships},t.prototype.removeSingleMember=function(t){return this.memberInvites.splice(t,1),this.canAddUsers=!0,this.showWarningMessage=1===this.membersLimit},t.prototype.submit=function(){var t;return this.form.initializeFields(),this.form.reset(),this.form.validate()?(this.memberInvites=_.filter(this.memberInvites,function(t){return""!==t.email}),this.submitInvites=!0,t=this.rs.memberships.bulkCreateMemberships(this.project.id,this.memberInvites,this.invitationText),t.then(this._onSuccessInvite.bind(this),this._onErrorInvite.bind(this))):void 0},t.prototype._onSuccessInvite=function(){return this.submitInvites=!1,this.rootScope.$broadcast("membersform:new:success"),this.lightboxService.closeAll(),this.confirm.notify("success")},t.prototype._onErrorInvite=function(t){return this.submitInvites=!1,this.form.setErrors(t.data),t.data._error_message?this.confirm.notify("error",t.data._error_message):void 0},t}(),u.controller("LbAddMembersController",n),i=function(t){var e;return e=function(e,r,n,i){return t.open(r),i.form=r.find("form").checksley()},{scope:{},bindToController:{project:"="},controller:"LbAddMembersController",controllerAs:"vm",templateUrl:"admin/lightbox-add-members.html",link:e}},u.directive("tgLbAddMembers",["lightboxService",i]),o=function(){return{templateUrl:"admin/lightbox-add-members-no-more=memberships-warning-message.html",scope:{project:"="}}},u.directive("tgLightboxAddMembersWarningMessage",[o]),r=function(t,e,r,n){return{link:function(i,o){return t.open(o),i.request=function(){return i.loading=!0,e.projects.transferRequest(i.projectId).then(function(){return i.loading=!1,t.close(o),r.notify("success",n.instant("ADMIN.PROJECT_PROFILE.REQUEST_OWNERSHIP_SUCCESS"))})}},templateUrl:"common/lightbox/lightbox-request-ownership.html"}},u.directive("tgLbRequestOwnership",["lightboxService","tgResources","$tgConfirm","$translate",r]),t=function(){function t(t,e,r,n){this.rs=t,this.lightboxService=e,this.confirm=r,this.translate=n,this.users=[],this.q="",this.commentOpen=!1}return t.prototype.limit=3,t.prototype.normalizeString=function(t){return t=t.replace("","A").replace("","A").replace("","A"),t=t.replace("","E").replace("","E").replace("","E"),t=t.replace("","I").replace("","I").replace("","I"),t=t.replace("","O").replace("","O").replace("","O"),t=t.replace("","U").replace("","U").replace("","U")},t.prototype.filterUsers=function(t){var e,r;return r=t.full_name_display.toUpperCase(),r=this.normalizeString(r),e=this.q.toUpperCase(),e=this.normalizeString(e),_.includes(r,e)},t.prototype.getUsers=function(){var t;return t=this.users.length||this.q.length?this.users:this.activeUsers,t=t.slice(0,this.limit),t=_.reject(t,{selected:!0}),_.reject(t,{id:this.currentOwnerId})},t.prototype.userSearch=function(){return this.users=this.activeUsers,this.selected=_.find(this.users,{selected:!0}),this.q?this.users=_.filter(this.users,this.filterUsers.bind(this)):void 0},t.prototype.selectUser=function(t){return this.activeUsers=_.map(this.activeUsers,function(t){return t.selected=!1,t}),t.selected=!0,this.userSearch()},t.prototype.submit=function(){return this.loading=!0,this.rs.projects.transferStart(this.projectId,this.selected.id,this.comment).then(function(t){return function(){var e,r;return t.loading=!1,t.lightboxService.closeAll(),r=t.translate.instant("ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_TITLE"),e=t.translate.instant("ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_DESC"),t.confirm.success(r,e,{type:"svg",name:"icon-speak-up"})}}(this))},t}(),t.$inject=["tgResources","lightboxService","$tgConfirm","$translate"],u.controller("ChangeOwnerLightbox",t),e=function(t,e,r,n){var i;return i=function(e,r){return t.open(r)},{scope:!0,controller:"ChangeOwnerLightbox",controllerAs:"vm",bindToController:{currentOwnerId:"=",projectId:"=",activeUsers:"="},templateUrl:"common/lightbox/lightbox-change-owner.html",link:i}},u.directive("tgLbChangeOwner",["lightboxService","lightboxKeyboardNavigationService","$tgTemplate","$compile",e]),s=function(t){var e;return e=function(e,r){return e.close=function(){return t.close(r)},t.open(r)},{templateUrl:"common/lightbox/lightbox-transfer-project-start-success.html",link:e}},u.directive("tgLbTransferProjectStartSuccess",["lightboxService",s])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p=function(t,e){function r(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},d={}.hasOwnProperty;l=this.taiga,u=this.taiga.mixOf,a=this.taiga.bindMethods,c=angular.module("taigaAdmin"),t=function(t){function e(t,e,r,n,i,o,s,u,c,l,p,d,f,h){var m;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=u,this.navUrls=c,this.analytics=l,this.appMetaService=p,this.translate=d,this.auth=f,this.lightboxFactory=h,a(this),this.scope.project={},this.scope.filters={},m=this.loadInitialData(),m.then(function(t){return function(){var e,r;return r=t.translate.instant("ADMIN.MEMBERSHIPS.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(r,e)}}(this)),m.then(null,this.onInitialDataError.bind(this)),this.scope.$on("membersform:new:success",function(t){return function(){return t.loadInitialData(),t.analytics.trackEvent("membership","create","create memberships on admin",1)}}(this))}return p(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAnalytics","tgAppMetaService","$translate","$tgAuth","tgLightboxFactory"],e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return e.i_am_admin||t.location.path(t.navUrls.resolve("permission-denied")),t.scope.projectId=e.id,t.scope.project=e,t.scope.canAddUsers=null===e.max_memberships||e.max_memberships>e.total_memberships,t.scope.$emit("project:loaded",e),e}}(this));
},e.prototype.loadMembers=function(){var t;return t=this.getUrlFilters(),this.rs.memberships.list(this.scope.projectId,t).then(function(t){return function(e){return t.scope.memberships=_.filter(e.models,function(t){return null===t.user||t.is_user_active}),t.scope.page=e.current,t.scope.count=e.count,t.scope.paginatedBy=e.paginatedBy,e}}(this))},e.prototype.loadInitialData=function(){return this.loadProject().then(function(t){return function(){return t.q.all([t.loadMembers(),t.auth.refresh()])}}(this))},e.prototype.getUrlFilters=function(){var t;return t=_.pick(this.location.search(),"page"),t.page||(t.page=1),t},e.prototype.addNewMembers=function(){return this.lightboxFactory.create("tg-lb-add-members",{"class":"lightbox lightbox-add-member",project:"project"},{project:this.scope.project})},e.prototype.showLimitUsersWarningMessage=function(){var t,e,r;return r=this.translate.instant("ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING"),e=this.translate.instant("ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING_MESSAGE",{members:this.scope.project.max_memberships}),t="/"+window._version+"/svg/icons/team-question.svg",this.confirm.success(r,e,{name:t,type:"img"})},e}(u(l.Controller,l.PageMixin,l.FiltersMixin)),c.controller("MembershipsController",t),e=function(t,e){var r,n,i;return i=t.get("admin/admin-membership-paginator.html",!0),n=function(t,r,n,o){var s,a,u,c,l,p,d;return a=2,l=4,u=2,c=2,s=r.find(".memberships-paginator"),p=function(){var e;return e=t.count/t.paginatedBy,e=parseInt(e,10)<e?parseInt(e,10)+1:parseInt(e,10)},d=function(){var r,n,o,d,f,h,m,g;if(f=p(),1>=f)return void s.hide();for(m=[],h={},h.pages=m,h.showPrevious=t.page>1,h.showNext=!(t.page===f),r=t.page,o=d=1,g=f;g>=1?g>=d:d>=g;o=g>=1?++d:--d)o===r+a&&f>r+a+c?m.push({classes:"dots",type:"dots"}):o===r-l&&r>u+l?m.push({classes:"dots",type:"dots"}):o>r+a&&f-c>=o||r-l>o&&o>u||(o===r?m.push({classes:"active",num:o,type:"page-active"}):m.push({classes:"page",num:o,type:"page"}));return n=i(h),n=e(n)(t),s.html(n),s.show()},t.$watch("memberships",function(t){return t?d():void 0}),r.on("click",".memberships-paginator a.next",function(e){return e.preventDefault(),t.$apply(function(){return o.selectFilter("page",t.page+1),o.loadMembers()})}),r.on("click",".memberships-paginator a.previous",function(e){return e.preventDefault(),t.$apply(function(){return o.selectFilter("page",t.page-1),o.loadMembers()})}),r.on("click",".memberships-paginator li.page > a",function(e){var r,n;return e.preventDefault(),n=angular.element(e.currentTarget),r=n.data("pagenum"),t.$apply(function(){return o.selectFilter("page",r),o.loadMembers()})})},r=function(t,e,r){var i;return i=e.controller(),n(t,e,r,i),t.$on("$destroy",function(){return e.off()})},{link:r}},c.directive("tgMemberships",["$tgTemplate","$compile",e]),i=function(t,e,r,n){var i,o;return o=e.get("admin/memberships-row-avatar.html",!0),i=function(e,i,s){var a,u,c;return u=r.instant("ADMIN.MEMBERSHIP.STATUS_PENDING"),c=function(t){var r,s;return r={full_name:t.full_name?t.full_name:"",email:t.user_email?t.user_email:t.email,imgurl:t.photo?t.photo:"/"+window._version+"/images/unnamed.png",pending:t.is_user_active?"":u,isOwner:t.is_owner},s=o(r),s=n(s)(e),i.html(s)},null==s.tgMembershipsRowAvatar?t.error("MembershipsRowAvatarDirective: the directive need a member"):(a=e.$eval(s.tgMembershipsRowAvatar),c(a),e.$on("$destroy",function(){return i.off()}))},{link:i}},c.directive("tgMembershipsRowAvatar",["$log","$tgTemplate","$translate","$compile",i]),n=function(t,e,r,n,i){var o,s;return s=n.get("admin/admin-memberships-row-checkbox.html",!0),o=function(n,o,a){var u,c,l;return n.$on("$destroy",function(){return o.off()}),null==a.tgMembershipsRowAdminCheckbox?t.error("MembershipsRowAdminCheckboxDirective: the directive need a member"):(c=n.$eval(a.tgMembershipsRowAdminCheckbox),c.is_owner?void o.find(".js-check").remove():(l=function(t){var e,r;return e={inputId:"is-admin-"+t.id},r=s(e),r=i(r)(n),o.html(r)},o.on("click",":checkbox",function(t){return function(t){var n,i,s;return i=function(){return r.notify("success")},n=function(t){return c.revert(),o.find(":checkbox").prop("checked",c.is_admin),r.notify("error",t.is_admin[0])},s=angular.element(t.currentTarget),c.is_admin=s.prop("checked"),e.save(c).then(i,n)}}(this)),u=l(c),c.is_admin?o.find(":checkbox").prop("checked",!0):void 0))},{link:o}},c.directive("tgMembershipsRowAdminCheckbox",["$log","$tgRepo","$tgConfirm","$tgTemplate","$compile",n]),o=function(t,e,r){var n,i;return i=_.template('<select>\n    <% _.each(roleList, function(role) { %>\n    <option value="<%- role.id %>" <% if(selectedRole === role.id){ %>selected="selected"<% } %>>\n        <%- role.name %>\n    </option>\n    <% }); %>\n</select>'),n=function(n,o,s){var a,u,c,l;return l=function(t){var e,r;return e={roleList:n.project.roles,selectedRole:t.role},r=i(e),o.html(r)},null==s.tgMembershipsRowRoleSelector?t.error("MembershipsRowRoleSelectorDirective: the directive need a member"):(a=o.controller(),c=n.$eval(s.tgMembershipsRowRoleSelector),u=l(c),o.on("change","select",function(t){return function(t){var n,i,o,s;return o=function(){return r.notify("success")},i=function(){return r.notify("error")},s=angular.element(t.currentTarget),n=parseInt(s.val(),10),c.role!==n?(c.role=n,e.save(c).then(o,i)):void 0}}(this)),n.$on("$destroy",function(){return o.off()}))},{link:n}},c.directive("tgMembershipsRowRoleSelector",["$log","$tgRepo","$tgConfirm",o]),r=function(t,e,r,n,i,o,s,a,u){var c,l,p;return c='<div class="active"\n     translate="ADMIN.MEMBERSHIP.STATUS_ACTIVE">\n</div>\n<a class="delete" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.DELETE_MEMBER\' | translate }}">\n    <tg-svg svg-icon="icon-trash"></tg-svg>\n</a>',p='<a class="resend js-resend" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.RESEND\' | translate }}"\n   translate="ADMIN.MEMBERSHIP.RESEND">\n</a>\n<a class="delete" href=""\n   title="{{ \'ADMIN.MEMBERSHIP.DELETE_MEMBER\' | translate }}">\n    <tg-svg svg-icon="icon-trash"></tg-svg>\n</a>',l=function(l,d,f){var h,m,g,v;return v=function(t){var e;return e=t.user?i(c)(l):i(p)(l),d.html(e)},null==f.tgMembershipsRowActions?t.error("MembershipsRowActionsDirective: the directive need a member"):(h=d.controller(),g=l.$eval(f.tgMembershipsRowActions),v(g),d.on("click",".js-resend",function(t){var e,i;return t.preventDefault(),i=function(){var t;return t=o.instant("ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION",{email:l.member.email}),n.notify("success",t)},e=function(){var t;return t=o.instant("ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION"),n.notify("error",t)},r.memberships.resendInvitation(l.member.id).then(i,e)}),m=function(){var t,r,i;return i=o.instant("ADMIN.MEMBERSHIP.DELETE_MEMBER"),t=o.instant("ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE",{email:g.email}),r=g.user?g.full_name:t,n.askOnDelete(i,r).then(function(t){var i,u;return u=function(e){return function(){var e;return t.finish(),g.user!==l.user.id?(l.page>1&&l.count-1<=l.paginatedBy&&h.selectFilter("page",l.page-1),h.loadInitialData()):s.path(a.resolve("home")),e=o.instant("ADMIN.MEMBERSHIP.SUCCESS_DELETE",{message:r}),n.notify("success",e,null,5e3)}}(this),i=function(e){return function(){var e;return t.finish(!1),e=o.instant("ADMIN.MEMBERSHIP.ERROR_DELETE",{message:r}),n.notify("error",e)}}(this),e.remove(g).then(u,i)})},d.on("click",".delete",function(t){var e;return t.preventDefault(),l.project.owner.id===g.user?(e=l.user.id===g.user,u.create("tg-lightbox-leave-project-warning",{"class":"lightbox lightbox-leave-project-warning"},{isCurrentUser:e,project:l.project})):m()}),l.$on("$destroy",function(){return d.off()}))},{link:l}},c.directive("tgMembershipsRowActions",["$log","$tgRepo","$tgResources","$tgConfirm","$compile","$translate","$tgLocation","$tgNavUrls","tgLightboxFactory",r]),s=function(){return{templateUrl:"admin/no-more-memberships-explanation.html",scope:{project:"="}}},c.directive("tgNoMoreMembershipsExplanation",[s])}.call(this),function(){var t,e;t=function(){var t;return t=function(t,e,r){var n;return n=r.tgAdminNavigation,e.find(".active").removeClass("active"),e.find("#adminmenu-"+n+" a").addClass("active"),t.$on("$destroy",function(){return e.off()})},{link:t}},e=angular.module("taigaAdmin"),e.directive("tgAdminNavigation",t)}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m,g,v,y,b,$,S,k,j,I,T,E=function(t,e){function r(){this.constructor=t}for(var n in e)C.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},C={}.hasOwnProperty,O=function(t,e){return function(){return t.apply(e,arguments)}};j=this.taiga,S=this.taiga.mixOf,T=this.taiga.trim,I=this.taiga.toString,$=this.taiga.joinStr,b=this.taiga.groupBy,v=this.taiga.bindOnce,y=this.taiga.debounce,k=angular.module("taigaAdmin"),m=function(t){function e(t,e,r,n,i,o,s,a,u,c,l,p,d){var f;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=u,this.appMetaService=c,this.translate=l,this.tgAuth=p,this.currentUserService=d,this.scope.project={},f=this.loadInitialData(),f.then(function(t){return function(){var e,r,n;return r=t.translate.instant(t.scope.sectionName),n=t.translate.instant("ADMIN.PROJECT_PROFILE.PAGE_TITLE",{sectionName:r,projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(n,e),t.fillUsersAndRoles(t.scope.project.members,t.scope.project.roles)}}(this)),f.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:loaded",function(t){return function(){var e,r,n;return r=t.translate.instant(t.scope.sectionName),n=t.translate.instant("ADMIN.PROJECT_PROFILE.PAGE_TITLE",{sectionName:r,projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(n,e)}}(this))}return E(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate","$tgAuth","tgCurrentUserService"],e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return e.i_am_admin||t.location.path(t.navUrls.resolve("permission-denied")),t.scope.projectId=e.id,t.scope.project=e,t.scope.pointsList=_.sortBy(e.points,"order"),t.scope.usStatusList=_.sortBy(e.us_statuses,"order"),t.scope.taskStatusList=_.sortBy(e.task_statuses,"order"),t.scope.prioritiesList=_.sortBy(e.priorities,"order"),t.scope.severitiesList=_.sortBy(e.severities,"order"),t.scope.issueTypesList=_.sortBy(e.issue_types,"order"),t.scope.issueStatusList=_.sortBy(e.issue_statuses,"order"),t.scope.$emit("project:loaded",e),e}}(this))},e.prototype.loadInitialData=function(){return this.q.all([this.loadProject(),this.tgAuth.refresh()])},e.prototype.openDeleteLightbox=function(){return this.rootscope.$broadcast("deletelightbox:new",this.scope.project)},e}(S(j.Controller,j.PageMixin)),k.controller("ProjectProfileController",m),g=function(t,e,r,n,i,o,s){var a;return a=function(a,u,c){var l,p,d,f;return l=u.controller(),p=u.find("form").checksley({onlyOneErrorElement:!0}),d=y(2e3,function(u){return function(u){var c,d;return u.preventDefault(),p.validate()?(c=r().target(f).start(),d=t.save(a.project),d.then(function(){var t;return c.finish(),e.notify("success"),t=n.resolve("project-admin-project-profile-details",{project:a.project.slug}),i.path(t),l.loadInitialData(),o.fetchProject(),s.loadProjects()}),d.then(null,function(t){return c.finish(),p.setErrors(t),t._error_message?e.notify("error",t._error_message):void 0})):void 0}}(this)),f=u.find(".submit-button"),u.on("submit","form",d)},{link:a}},k.directive("tgProjectProfile",["$tgRepo","$tgConfirm","$tgLoading","$tgNavUrls","$tgLocation","tgProjectService","tgCurrentUserService",g]),l=function(t,e,r){var n;return n=function(n,i,o){var s,a,u;return s=i.find("form").checksley({onlyOneErrorElement:!0}),a=y(2e3,function(i){return function(i){var o,a;return i.preventDefault(),s.validate()?(o=r().target(u).start(),a=t.save(n.project),a.then(function(){return o.finish(),e.notify("success")}),a.then(null,function(t){return o.finish(),s.setErrors(t),t._error_message?e.notify("error",t._error_message):void 0})):void 0}}(this)),u=i.find(".submit-button"),i.on("submit","form",a),n.$on("$destroy",function(){return i.off()})},{link:n}},k.directive("tgProjectDefaultValues",["$tgRepo","$tgConfirm","$tgLoading",l]),h=function(t,e,r,n){var i;return i=function(r,i,o){var s;return s=function(o){return function(){var o,s;return o=i.find("form").checksley(),o.initializeFields(),o.reset(),o.validate()?(s=t.save(r.project),s.then(function(){return r.$emit("project:loaded",r.project),e.notify("success"),n.fetchProject()}),s.then(null,function(t){return o.setErrors(t),t._error_message?e.notify("error",t._error_message):void 0})):void 0}}(this),i.on("change",".module-activation.module-direct-active input",function(t){return t.preventDefault(),s()}),i.on("submit","form",function(t){return t.preventDefault(),s()}),i.on("click",".save",function(t){return t.preventDefault(),s()}),i.on("keydown",".videoconference-attributes input",function(t){return 32!==t.which}),r.$watch("project.videoconferences",function(t,e){return null!=t&&null!=e&&t!==e?r.project.videoconferences_extra_data="":void 0}),r.$watch("isVideoconferenceActivated",function(t,e){return t===!1&&(r.project.videoconferences=null,r.project.videoconferences_extra_data="",e===!0)?s():void 0}),r.$watch("project",function(t){return null!=t.videoconferences?r.isVideoconferenceActivated=!0:r.isVideoconferenceActivated=!1})},{link:i}},k.directive("tgProjectModules",["$tgRepo","$tgConfirm","$tgLoading","tgProjectService",h]),p=function(t,e,r,n){var i;return i=function(i,o,s){var a,u,c,l,p,d,f,h,m,g,v,_,b,$,S,k,j,I,T,E,C,O,w,A,P,M;return u=o.find(".admin-project-export-buttons"),I=function(){return u.removeClass("hidden")},l=function(){return u.addClass("hidden")},m=o.find(".admin-project-export-result"),w=function(){return m.removeClass("hidden")},p=function(){return m.addClass("hidden")},P=o.find(".spin"),A=function(){return P.removeClass("hidden")},d=function(){return P.addClass("hidden")},v=o.find(".result-title"),h=n.instant("ADMIN.PROJECT_EXPORT.LOADING_TITLE"),f=n.instant("ADMIN.PROJECT_EXPORT.LOADING_MESSAGE"),c=function(){return v.html(n.instant("ADMIN.PROJECT_EXPORT.DUMP_READY"))},a=function(){return v.html(n.instant("ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE"))},M=function(t){return v.html(n.instant("ADMIN.PROJECT_EXPORT.SYNC_MESSAGE",{url:t}))},S=function(){return v.html(h)},b=function(){return v.html(f)},j=function(){return v.html(c)},g=o.find(".result-message "),$=function(){return g.html(f)},_=function(){return g.html(a)},k=function(t){return g.html(M(t))},O=function(){return A(),S(),$(),l(),w()},E=function(){return d(),b(),_()},C=function(t){return d(),j(),k(t)},T=function(){return d(),p(),I()},o.on("click","a.button-export",y(2e3,function(o){return function(o){var s,a;return o.preventDefault(),a=function(e){var r;return 202===e.status?E():(r=e.data.url,C(r),t.open(r,"_blank"))},s=function(t){var e,i;return T(),e=n.instant("ADMIN.PROJECT_EXPORT.ERROR"),429===t.status?e=n.instant("ADMIN.PROJECT_EXPORT.ERROR_BUSY"):(null!=(i=t.data)?i._error_message:void 0)&&(e=n.instant("ADMIN.PROJECT_EXPORT.ERROR_BUSY",{message:t.data._error_message})),r.notify("error",e)},O(),e.projects["export"](i.projectId).then(a,s)}}(this)))},{link:i}},k.directive("tgProjectExport",["$window","$tgResources","$tgConfirm","$translate",p]),n=function(t){function e(t,e,r,n,i,o){this.scope=t,this.rootscope=e,this.urls=r,this.confirm=n,this.rs=i,this.translate=o,this._generateUuid=O(this._generateUuid,this),this.setCsvUuid=O(this.setCsvUuid,this),this.rootscope.$on("project:loaded",this.setCsvUuid),this.scope.$watch("csvUuid",function(t){return function(e){return e?t.scope.csvUrl=t.urls.resolveAbsolute(t.type+"-csv",e):t.scope.csvUrl=""}}(this))}return E(e,t),e.$inject=["$scope","$rootScope","$tgUrls","$tgConfirm","$tgResources","$translate"],e.prototype.setCsvUuid=function(){return this.scope.csvUuid=this.scope.project[this.type+"_csv_uuid"]},e.prototype._generateUuid=function(t){var e;return null==t&&(t=null),e=this.rs.projects["regenerate_"+this.type+"_csv_uuid"](this.scope.projectId),e.then(function(t){return function(e){var r;return t.scope.csvUuid=null!=(r=e.data)?r.uuid:void 0}}(this)),e.then(null,function(t){return function(){return t.confirm.notify("error")}}(this)),e["finally"](function(){return t?t.finish():void 0}),e},e.prototype.regenerateUuid=function(){var t,e;return this.scope.csvUuid?(e=this.translate.instant("ADMIN.REPORTS.REGENERATE_TITLE"),t=this.translate.instant("ADMIN.REPORTS.REGENERATE_SUBTITLE"),this.confirm.ask(e,t).then(this._generateUuid)):this._generateUuid()},e}(j.Controller),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return E(e,t),e.prototype.type="userstories",e}(n),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return E(e,t),e.prototype.type="tasks",e}(n),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return E(e,t),e.prototype.type="issues",e}(n),k.controller("CsvExporterUserstoriesController",s),k.controller("CsvExporterTasksController",o),k.controller("CsvExporterIssuesController",i),c=function(t){var e;return e=function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_US"},{controller:"CsvExporterUserstoriesController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:e,scope:!0}},k.directive("tgCsvUs",["$translate",c]),u=function(t){var e;return e=function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_TASK"},{controller:"CsvExporterTasksController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:e,scope:!0}},k.directive("tgCsvTask",["$translate",u]),a=function(t){var e;return e=function(t){return t.sectionTitle="ADMIN.CSV.SECTION_TITLE_ISSUE"},{controller:"CsvExporterIssuesController",controllerAs:"ctrl",templateUrl:"admin/project-csv.html",link:e,scope:!0}},k.directive("tgCsvIssue",["$translate",a]),d=function(t,e,r,n){var i;return i=function(t,i,o){var s,a,u;return u=function(){return i.find(".size-info").addClass("active")},a=function(r){var o;return o=e.make_model("projects",r.data),t.project=o,i.find(".loading-overlay").removeClass("active"),n.notify("success")},s=function(t){return 413===t.status&&u(),i.find(".loading-overlay").removeClass("active"),n.notify("error",t.data._error_message)},i.on("click",".js-change-logo",function(){return i.find("#logo-field").click()}),i.on("change","#logo-field",function(e){return t.logoAttachment?(i.find(".loading-overlay").addClass("active"),r.projects.changeLogo(t.project.id,t.logoAttachment).then(a,s)):void 0}),i.on("click","a.js-use-default-logo",function(e){return i.find(".loading-overlay").addClass("active"),r.projects.removeLogo(t.project.id).then(a,s)}),t.$on("$destroy",function(){return i.off()})},{link:i}},k.directive("tgProjectLogo",["$tgAuth","$tgModel","$tgResources","$tgConfirm",d]),f=function(t){var e;return e=function(e,r,n){var i,o;return i=t(n.tgProjectLogoModel),o=i.assign,r.bind("change",function(){return e.$apply(function(){return o(e,r[0].files[0])})})},{link:e}},k.directive("tgProjectLogoModel",["$parse",f]),r=function(){return{scope:{project:"="},templateUrl:"admin/admin-project-restrictions.html"}},k.directive("tgAdminProjectRestrictions",[r]),e=function(t){return{link:function(e){return e.requestOwnership=function(){return t.create("tg-lb-request-ownership",{"class":"lightbox lightbox-request-ownership"},{projectId:e.projectId})}},scope:{projectId:"=",owner:"="},templateUrl:"admin/admin-project-request-ownership.html"}},k.directive("tgAdminProjectRequestOwnership",["tgLightboxFactory",e]),t=function(t){return{link:function(e){return e.changeOwner=function(){return t.create("tg-lb-change-owner",{"class":"lightbox lightbox-select-user","project-id":"projectId","active-users":"activeUsers","current-owner-id":"currentOwnerId"},{projectId:e.projectId,activeUsers:e.activeUsers,currentOwnerId:e.owner.id,members:e.members})}},scope:{activeUsers:"=",projectId:"=",owner:"=",members:"="},templateUrl:"admin/admin-project-change-owner.html"}},k.directive("tgAdminProjectChangeOwner",["tgLightboxFactory",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m,g,v,y,b,S=function(t,e){function r(){this.constructor=t}for(var n in e)k.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},k={}.hasOwnProperty,j=function(t,e){return function(){return t.apply(e,arguments)}};v=this.taiga,m=this.taiga.mixOf,b=this.taiga.trim,y=this.taiga.toString,h=this.taiga.joinStr,f=this.taiga.groupBy,p=this.taiga.bindOnce,d=this.taiga.debounce,g=angular.module("taigaAdmin"),a=function(t){function e(t,e,r,n,i,o,s,a,u,c,l){var p;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=u,this.appMetaService=c,this.translate=l,this.scope.project={},p=this.loadInitialData(),p.then(function(t){return function(){var e,r,n;return r=t.translate.instant(t.scope.sectionName),n=t.translate.instant("ADMIN.PROJECT_VALUES.PAGE_TITLE",{sectionName:r,projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(n,e)}}(this)),p.then(null,this.onInitialDataError.bind(this))}return S(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return e.i_am_admin||t.location.path(t.navUrls.resolve("permission-denied")),t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),e}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject()},e}(m(v.Controller,v.PageMixin)),g.controller("ProjectValuesSectionController",a),o=function(t){function e(t,e,r,n,i){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.moveValue=j(this.moveValue,this),this.loadValues=j(this.loadValues,this),this.scope.$on("admin:project-values:move",this.moveValue),this.rootscope.$on("project:loaded",this.loadValues)}return S(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources"],e.prototype.loadValues=function(){return this.rs[this.scope.resource].listValues(this.scope.projectId,this.scope.type).then(function(t){return function(e){return t.scope.values=e,t.scope.maxValueOrder=_.maxBy(e,"order").order,e}}(this))},e.prototype.moveValue=function(t,e,r){var n,i;return i=this.scope.values,n=i.indexOf(e),i.splice(n,1),i.splice(r,0,e),_.each(i,function(t,e){return t.order=e}),this.repo.saveAll(i)},e}(v.Controller),g.controller("ProjectValuesController",o),s=function(t,e,r,n,i,o,s){var a,u,c;return u=function(t,e,r){var n,i,o,s,a,u;return s=null,o=null,i=null,u=e.find(".sortable"),n=dragula([u[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:u[0],moves:function(t){return $(t).is("div[tg-bind-scope]")}}),n.on("dragend",function(e){var r,n;return i=$(e),n=i.scope().value,r=i.index(),t.$broadcast("admin:project-values:move",n,r)}),a=autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&n.dragging}}),t.$on("$destroy",function(){return e.off(),n.destroy()})},c=function(t,n,i){var a,u,c,l,p,f,h,m,g;return a=n.controller(),g=i.type,f=i.objname,l=function(){return t.newValue={name:"",is_closed:!1,is_archived:!1}},p=function(){return t.addNewElementText=o.instant("ADMIN.PROJECT_VALUES_"+f.toUpperCase()+".ACTION_ADD")},l(),p(),s.$on("$translateChangeEnd",function(){return t.$evalAsync(p)}),c=function(t){return function(t){var e;return null==t&&(t=!1),e=n.find(".table-main"),$(document.body).scrollTop(e.offset().top+e.height()),t?n.find(".new-value input:visible").first().focus():void 0}}(this),m=function(t){var r,n,i,o;return n=t.parents("form"),r=n.checksley(),r.validate()?(o=n.scope().value,i=e.save(o),i.then(function(e){return function(){var e;return e=t.parents(".row.table-main"),e.addClass("hidden"),e.siblings(".visualization").removeClass("hidden")}}(this)),i.then(null,function(t){return r.setErrors(t)})):void 0},h=function(r){var n,i,o;return i=r.parents("form"),n=i.checksley(),n.validate()?(t.newValue.project=t.project.id,t.newValue.order=t.maxValueOrder?t.maxValueOrder+1:1,o=e.create(g,t.newValue),o.then(function(e){return function(e){return r.addClass("hidden"),t.values.push(e),t.maxValueOrder=e.order,l()}}(this)),o.then(null,function(t){return n.setErrors(t)})):void 0},u=function(e){var r,n,i;return n=e.parents(".row.table-main"),r=e.parents("form"),i=r.scope().value,t.$apply(function(){return n.addClass("hidden"),i.revert(),n.siblings(".visualization").removeClass("hidden")})},n.on("click",".show-add-new",function(t){return t.preventDefault(),n.find(".new-value").removeClass("hidden"),c(!0)}),n.on("click",".add-new",d(2e3,function(t){var e;return t.preventDefault(),e=n.find(".new-value"),h(e)})),n.on("click",".delete-new",function(t){return t.preventDefault(),n.find(".new-value").addClass("hidden"),l()}),n.on("click",".edit-value",function(t){var e,r,n;return t.preventDefault(),n=angular.element(t.currentTarget),r=n.parents(".row.table-main"),r.addClass("hidden"),e=r.siblings(".edition"),e.removeClass("hidden"),e.find("input:visible").first().focus().select()}),n.on("keyup",".edition input",function(t){var e;return 13===t.keyCode?(e=angular.element(t.currentTarget),m(e)):27===t.keyCode?(e=angular.element(t.currentTarget),u(e)):void 0}),n.on("keyup",".new-value input",function(t){var e;return 13===t.keyCode?(e=n.find(".new-value"),h(e)):27===t.keyCode?(n.find(".new-value").addClass("hidden"),l()):void 0}),n.on("click",".save",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),m(e)}),n.on("click",".cancel",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),u(e)}),n.on("click",".delete-value",function(n){var i,s,u,c,l,p,d;return n.preventDefault(),c=angular.element(n.currentTarget),s=c.parents("form"),d=s.scope().value,i={},_.each(t.values,function(t){return d.id!==t.id?i[t.id]=t.name:void 0}),u=d.name,0===_.keys(i).length?r.error(o.instant("ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL")):(p=o.instant("ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE"),l=o.instant("ADMIN.PROJECT_VALUES.REPLACEMENT"),r.askChoice(p,u,i,l).then(function(t){var n,i;return i=function(){return a.loadValues()["finally"](function(){return t.finish()})},n=function(){return r.notify("error")},e.remove(d,{moveTo:t.selected}).then(i,n)}))})},a=function(t,e,r){return u(t,e,r),c(t,e,r),t.$on("$destroy",function(){return e.off()})},{link:a}},g.directive("tgProjectValues",["$log","$tgRepo","$tgConfirm","$tgLocation","animationFrame","$translate","$rootScope",s]),t=function(){var t;return t=function(t,e,r,n){var i;return i=e.controller(),t.$watch(r.ngModel,function(e){return t.color=e.color}),e.on("click",".current-color",function(t){var r,n;return t.preventDefault(),t.stopPropagation(),n=angular.element(t.currentTarget),e.find(".select-color").hide(),n.siblings(".select-color").show(),r=angular.element("body"),r.on("click",function(t){return function(t){return 0===angular.element(t.target).parent(".select-color").length?(e.find(".select-color").hide(),r.unbind("click")):void 0}}(this))}),e.on("click",".select-color .color",function(r){var i;return r.preventDefault(),i=angular.element(r.currentTarget),t.$apply(function(){return n.$modelValue.color=i.data("color")}),e.find(".select-color").hide()}),e.on("click",".select-color .selected-color",function(r){return r.preventDefault(),t.$apply(function(){return n.$modelValue.color=t.color}),e.find(".select-color").hide()}),t.$on("$destroy",function(){return e.off()})},{link:t,require:"ngModel"}},g.directive("tgColorSelection",t),u="text",r="multiline",e="date",l="url",c=[{key:u,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT"},{key:r,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI"},{key:e,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE"},{key:l,name:"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL"}],n=function(t){function e(t,e,r,n,i,o,s,a,u,l){this.scope=t,this.rootscope=e,this.repo=r,this.rs=n,this.params=i,this.q=o,this.location=s,this.navUrls=a,this.appMetaService=u,this.translate=l,this.moveCustomAttributes=j(this.moveCustomAttributes,this),this.deleteCustomAttribute=j(this.deleteCustomAttribute,this),this.saveCustomAttribute=j(this.saveCustomAttribute,this),this.createCustomAttribute=j(this.createCustomAttribute,this),this.loadCustomAttributes=j(this.loadCustomAttributes,this),this.scope.TYPE_CHOICES=c,this.scope.project={},this.rootscope.$on("project:loaded",function(t){return function(){var e,r,n;return t.loadCustomAttributes(),r=t.translate.instant(t.scope.sectionName),n=t.translate.instant("ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE",{sectionName:r,projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(n,e)}}(this))}return S(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],e.prototype.loadCustomAttributes=function(){return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then(function(t){return function(e){var r;return t.scope.customAttributes=e,t.scope.maxOrder=null!=(r=_.maxBy(e,"order"))?r.order:void 0,e}}(this))},e.prototype.createCustomAttribute=function(t){return this.repo.create("custom-attributes/"+this.scope.type,t)},e.prototype.saveCustomAttribute=function(t){return this.repo.save(t)},e.prototype.deleteCustomAttribute=function(t){return this.repo.remove(t)},e.prototype.moveCustomAttributes=function(t,e){var r,n;return r=this.scope.customAttributes,n=r.indexOf(t),r.splice(n,1),r.splice(e,0,t),_.each(r,function(t,e){return t.order=e}),this.repo.saveAll(r)},e}(m(v.Controller,v.PageMixin)),g.controller("ProjectCustomAttributesController",n),i=function(t,e,r,n){var i;return i=function(t,r,i){var o,s,a,u,c,l,p,f,h,m,g,v,_,y,b,S,k,j;return o=r.controller(),t.$on("$destroy",function(){return r.off()}),k=r.find(".js-sortable"),l=dragula([k[0]],{direction:"vertical",copySortSource:!1,copy:!1,mirrorContainer:k[0],moves:function(t){return $(t).is("div[tg-bind-scope]")}}),l.on("dragend",function(t){var e,r,n;return r=$(t),e=r.scope().attr,n=r.index(),o.moveCustomAttributes(e,n)}),b=function(){return r.find(".js-new-custom-field").removeClass("hidden"),r.find(".js-new-custom-field input:visible").first().focus()},h=function(){return r.find(".js-new-custom-field").addClass("hidden")},_=function(){return r.find(".js-add-custom-field-button").removeClass("hidden")},p=function(){return r.find(".js-add-custom-field-button").addClass("hidden")},y=function(){return r.find(".js-cancel-new-custom-field-button").removeClass("hidden")},f=function(){return r.find(".js-cancel-new-custom-field-button").addClass("hidden")},g=function(){return t.newAttr={}},u=function(r){var n,i,s,a;return i=r.checksley(),i.validate()?(a=function(t){return function(){return o.loadCustomAttributes(),h(),g(),e.notify("success")}}(this),s=function(t){return function(t){return i.setErrors(t)}}(this),n=t.newAttr,n.project=t.projectId,n.order=t.maxOrder?t.maxOrder+1:1,o.createCustomAttribute(n).then(a,s)):void 0},s=function(){return h(),g()},t.$watch("customAttributes",function(t){return t?0===t.length?(f(),p(),b()):(h(),_(),y()):void 0}),r.on("click",".js-add-custom-field-button",function(t){return t.preventDefault(),b()}),r.on("click",".js-create-custom-field-button",d(2e3,function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=r.closest("form"),u(e)})),r.on("click",".js-cancel-new-custom-field-button",function(t){return t.preventDefault(),s()}),r.on("keyup",".js-new-custom-field input",function(t){var e,r;return 13===t.keyCode?(r=angular.element(t.currentTarget),e=r.closest("form"),u(e)):27===t.keyCode?s():void 0}),S=function(t){return t.find(".js-view-custom-field").addClass("hidden"),
t.find(".js-edit-custom-field").removeClass("hidden"),t.find(".js-edit-custom-field input:visible").first().focus().select()},m=function(t){return t.find(".js-edit-custom-field").addClass("hidden"),t.find(".js-view-custom-field").removeClass("hidden")},v=function(e){return t.$apply(function(){return e.scope().attr.revert()})},j=function(t){var r,n,i,s;return n=t.checksley(),n.validate()?(s=function(r){return function(){return o.loadCustomAttributes(),m(t),e.notify("success")}}(this),i=function(t){return function(t){return n.setErrors(t)}}(this),r=t.scope().attr,o.saveCustomAttribute(r).then(s,i)):void 0},a=function(t){return m(t),v(t)},r.on("click",".js-edit-custom-field-button",function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=r.closest("form"),S(e)}),r.on("click",".js-update-custom-field-button",d(2e3,function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=r.closest("form"),j(e)})),r.on("click",".js-cancel-edit-custom-field-button",function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=r.closest("form"),a(e)}),r.on("keyup",".js-edit-custom-field input",function(t){var e,r;return 13===t.keyCode?(r=angular.element(t.currentTarget),e=r.closest("form"),j(e)):27===t.keyCode?(r=angular.element(t.currentTarget),e=r.closest("form"),a(e)):void 0}),c=function(t){var r,i,s,a;return r=t.scope().attr,i=r.name,a=n.instant("COMMON.CUSTOM_ATTRIBUTES.DELETE"),s=n.instant("COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE"),e.ask(a,s,i).then(function(t){var n,s;return s=function(){return o.loadCustomAttributes()["finally"](function(){return t.finish()})},n=function(){return e.notify("error",null,"We have not been able to delete '"+i+"'.")},o.deleteCustomAttribute(r).then(s,n)})},r.on("click",".js-delete-custom-field-button",d(2e3,function(t){var e,r;return t.preventDefault(),r=angular.element(t.currentTarget),e=r.closest("form"),c(e)}))},{link:i}},g.directive("tgProjectCustomAttributes",["$log","$tgConfirm","animationFrame","$translate",i])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p=function(t,e){return function(){return t.apply(e,arguments)}},d=function(t,e){function r(){this.constructor=t}for(var n in e)f.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},f={}.hasOwnProperty,h=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};l=this.taiga,u=this.taiga.mixOf,s=this.taiga.bindOnce,a=this.taiga.debounce,o=this.taiga.bindMethods,c=angular.module("taigaAdmin"),n=function(t){function e(t,e,r,n,i,s,a,u,c,l,d){var f;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=s,this.q=a,this.location=u,this.navUrls=c,this.appMetaService=l,this.translate=d,this._disableComputable=p(this._disableComputable,this),this._enableComputable=p(this._enableComputable,this),o(this),this.scope.sectionName="ADMIN.MENU.PERMISSIONS",this.scope.project={},this.scope.anyComputableRole=!0,f=this.loadInitialData(),f.then(function(t){return function(){var e,r;return r=t.translate.instant("ADMIN.ROLES.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(r,e)}}(this)),f.then(null,this.onInitialDataError.bind(this))}return d(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return e.i_am_admin||t.location.path(t.navUrls.resolve("permission-denied")),t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),t.scope.anyComputableRole=_.some(_.map(e.roles,function(t){return t.computable})),e}}(this))},e.prototype.loadRoles=function(){return this.rs.roles.list(this.scope.projectId).then(function(t){return function(e){var r;return e=e.map(function(t){return t.external_user=!1,t}),r={name:t.translate.instant("ADMIN.ROLES.EXTERNAL_USER"),permissions:t.scope.project.public_permissions,external_user:!0},e.push(r),t.scope.roles=e,t.scope.role=t.scope.roles[0],e}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(){return t.loadRoles()}}(this)),t},e.prototype.setRole=function(t){return this.scope.role=t,this.scope.$broadcast("role:changed",this.scope.role)},e.prototype["delete"]=function(){var t,e,r,n,i,o,s,a,u;for(t={},n=this.scope.roles,e=0,r=n.length;r>e;e++)o=n[e],o.id!==this.scope.role.id&&(t[o.id]=o.name);return 0===_.keys(t).length?this.confirm.error(this.translate.instant("ADMIN.ROLES.ERROR_DELETE_ALL")):(a=this.translate.instant("ADMIN.ROLES.TITLE_DELETE_ROLE"),s=this.scope.role.name,i=this.translate.instant("ADMIN.ROLES.REPLACEMENT_ROLE"),u=this.translate.instant("ADMIN.ROLES.WARNING_DELETE_ROLE"),this.confirm.askChoice(a,s,t,i,u).then(function(t){return function(e){var r,n;return n=function(){return t.loadProject(),t.loadRoles()["finally"](function(){return e.finish()})},r=function(){return t.confirm.notify("error")},t.repo.remove(t.scope.role,{moveTo:e.selected}).then(n,r)}}(this)))},e.prototype._enableComputable=function(){var t,e;return e=function(t){return function(){return t.confirm.notify("success"),t.loadProject()}}(this),t=function(t){return function(){return t.confirm.notify("error"),t.scope.role.revert()}}(this),this.repo.save(this.scope.role).then(e,t)},e.prototype._disableComputable=function(){var t,e,r,n;return e=function(t){return function(e){var r,n;return n=function(){return e.finish(),t.confirm.notify("success"),t.loadProject()},r=function(){return e.finish(),t.confirm.notify("error"),t.scope.role.revert()},t.repo.save(t.scope.role).then(n,r)}}(this),t=function(t){return function(e){return t.scope.role.revert()}}(this),n=this.translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE"),r=this.translate.instant("ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE",{roleName:this.scope.role.name}),this.confirm.ask(n,r,"").then(e,t)},e.prototype.toggleComputable=a(2e3,function(){return this.scope.role.computable?this._enableComputable():this._disableComputable()}),e}(u(l.Controller,l.PageMixin,l.FiltersMixin)),c.controller("RolesController",n),t=function(t,e){var r;return r=function(r,n,i){var o,s;return s=function(){return n.find(".total").toggle(),n.find(".edit-role").toggle()},o=function(){var i;return r.role.name=n.find("input").val(),i=t.save(r.role),i.then(function(){return e.notify("success")}),i.then(null,function(t){return e.notify("error")}),s()},n.on("click",".edit-value",function(){return s(),n.find("input").focus(),n.find("input").val(r.role.name)}),n.on("click","a.save",o),n.on("keyup","input",function(t){return 13===t.keyCode?o():27===t.keyCode?s():void 0}),r.$on("role:changed",function(){return n.find(".edit-role").is(":visible")?s():void 0}),r.$on("$destroy",function(){return n.off()})},{link:r}},c.directive("tgEditRole",["$tgRepo","$tgConfirm",t]),i=function(){var t;return t=function(t,e,r){var n;return n=e.controller(),t.$on("$destroy",function(){return e.off()})},{link:t}},c.directive("tgRoles",i),e=function(t,e){var r,n;return r=["view_project","view_milestones","view_us","view_tasks","view_issues"],n=function(n,i,o){var s;return s=i.controller(),n.$on("$destroy",function(){return i.off()}),i.on("click","a.add-button",function(t){return t.preventDefault(),i.find(".new").removeClass("hidden"),i.find(".new").focus(),i.find(".add-button").hide()}),i.on("keyup",".new",function(o){var a,u,c,l;return o.preventDefault(),13===o.keyCode?(l=angular.element(o.currentTarget),a={project:n.projectId,name:l.val(),permissions:r,order:_.maxBy(n.roles,function(t){return t.order}).order+1,computable:!1},i.find(".new").addClass("hidden"),i.find(".new").val(""),c=function(t){var e;return e=n.roles.length-1,n.roles.splice(e,0,t),s.setRole(t),i.find(".add-button").show(),s.loadProject()},u=function(){return e.notify("error")},t.create("roles",a).then(c,u)):27===o.keyCode?(l=angular.element(o.currentTarget),i.find(".new").addClass("hidden"),i.find(".new").val(""),i.find(".add-button").show()):void 0})},{link:n}},c.directive("tgNewRole",["$tgRepo","$tgConfirm",e]),r=function(t,e,r,n){var i,o,a,u;return u=_.template('<div class="resume-title" translate="<%- category.name %>"></div>\n<div class="summary-role">\n    <div class="count"><%- category.activePermissions %>/<%- category.permissions.length %></div>\n    <% _.each(category.permissions, function(permission) { %>\n        <div class="role-summary-single <% if(permission.active) { %>active<% } %>"\n             title="{{ \'<%- permission.name %>\' | translate }}"></div>\n    <% }) %>\n</div>\n<tg-svg svg-icon="icon-arrow-right"></tg-svg>'),o=_.template('<div class="category-config" data-id="<%- index %>">\n    <div class="resume">\n    </div>\n    <div class="category-items">\n        <div class="items-container">\n        <% _.each(category.permissions, function(permission) { %>\n            <div class="category-item" data-id="<%- permission.key %>">\n                <span translate="<%- permission.name %>"></span>\n                <div class="check">\n                    <input type="checkbox"\n                           <% if(!permission.editable) { %> disabled="disabled" <% } %>\n                           <% if(permission.active) { %> checked="checked" <% } %>/>\n                    <div></div>\n                    <span class="check-text check-yes" translate="COMMON.YES"></span>\n                    <span class="check-text check-no" translate="COMMON.NO"></span>\n                </div>\n            </div>\n        <% }) %>\n        </div>\n    </div>\n</div>'),i=_.template('<div class="category-config-list"></div>'),a=function(a,c,l){var p,d,f,m,g;return p=c.controller(),d=function(t){var e,r,n,i,o,s,u,c,l;return o=function(e){return _.map(e,function(e){var r;return _.extend({},e,{active:(r=e.key,h.call(t.permissions,r)>=0)})})},r=function(t,e,r){return!e.external_user||r.is_private||0!==t.key.indexOf("view_")},s=function(e){return _.map(e,function(e){return e.permissions=e.permissions.map(function(e){return e.editable=r(e,t,a.project),e}),_.extend({},e,{activePermissions:_.filter(e.permissions,"active").length})})},e=[],i=[{key:"view_milestones",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS"},{key:"add_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS"},{key:"modify_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS"},{key:"delete_milestone",name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS"}],e.push({name:"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME",permissions:o(i)}),c=[{key:"view_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES"},{key:"add_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES"},{key:"modify_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES"},{key:"delete_us",name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES"}],e.push({name:"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME",permissions:o(c)}),u=[{key:"view_tasks",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS"},{key:"add_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS"},{key:"modify_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS"},{key:"delete_task",name:"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS"}],e.push({name:"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME",permissions:o(u)}),n=[{key:"view_issues",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES"},{key:"add_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES"},{key:"modify_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES"},{key:"delete_issue",name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES"}],e.push({name:"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME",permissions:o(n)}),l=[{key:"view_wiki_pages",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES"},{key:"add_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES"},{key:"modify_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES"},{key:"delete_wiki_page",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES"},{key:"view_wiki_links",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS"},{key:"add_wiki_link",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS"},{key:"delete_wiki_link",name:"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS"}],e.push({name:"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME",permissions:o(l)}),s(e)},g=function(t,e){return t.find(".resume").html(n(u({category:e}))(a))},f=function(t,e){var r;return r=o({category:t,index:e}),r=angular.element(r),g(r,t),n(r)(a)},m=function(){var n;return c.off(),n=i(),_.each(d(a.role),function(t,e){return n=angular.element(n).append(f(t,e))}),c.html(n),c.on("click",".resume",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),e.toggleClass("open-drawer"),e.next().toggleClass("open")}),c.on("change",".category-item input",function(n){var i,o,s,u;return i=function(){var t;return t=_.filter(c.find(".category-item input"),function(t){return angular.element(t).is(":checked")}),t=_.sortBy(_.map(t,function(t){var e;return e=angular.element(t).parents(".category-item").data("id")})),t.length&&t.push("view_project"),t},u=angular.element(n.currentTarget),a.role.permissions=i(),s=function(){var e,n;return e=d(a.role),n=u.parents(".category-config").data("id"),g(u.parents(".category-config"),e[n]),t.$broadcast("projects:reload"),r.notify("success"),p.loadProject()},o=function(){return r.notify("error"),u.prop("checked",!u.prop("checked")),a.role.permissions=i()},a.role.external_user?(a.project.public_permissions=a.role.permissions,a.project.anon_permissions=a.role.permissions.filter(function(t){return 0===t.indexOf("view_")}),e.save(a.project).then(s,o)):e.save(a.role).then(s,o)})},a.$on("$destroy",function(){return c.off()}),a.$on("role:changed",function(){return m()}),s(a,l.ngModel,m)},{link:a}},c.directive("tgRolePermissions",["$rootScope","$tgRepo","$tgConfirm","$compile",r])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l,p,d,f,h,m,g,v=function(t,e){function r(){this.constructor=t}for(var n in e)y.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},y={}.hasOwnProperty;m=this.taiga,f=this.taiga.mixOf,p=this.taiga.bindMethods,d=this.taiga.debounce,g=this.taiga.timeout,h=angular.module("taigaAdmin"),l=function(t){function e(t,e,r,n,i,o,s,a){var u;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.location=i,this.navUrls=o,this.appMetaService=s,this.translate=a,p(this),this.scope.sectionName="ADMIN.WEBHOOKS.SECTION_NAME",this.scope.project={},u=this.loadInitialData(),u.then(function(t){return function(){var e,r;return r=t.translate.instant("ADMIN.WEBHOOKS.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(r,e)}}(this)),u.then(null,this.onInitialDataError.bind(this)),this.scope.$on("webhooks:reload",this.loadWebhooks)}return v(e,t),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],e.prototype.loadWebhooks=function(){return this.rs.webhooks.list(this.scope.projectId).then(function(t){return function(e){return t.scope.webhooks=e}}(this))},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return e.i_am_admin||t.location.path(t.navUrls.resolve("permission-denied")),t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),e}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(){return t.loadWebhooks()}}(this)),t},e}(f(m.Controller,m.PageMixin,m.FiltersMixin)),h.controller("WebhooksController",l),c=function(t,e,r,n,i){var o;return o=function(n,o,s){var a,u,c,l,p,f,h,m;return m=n.$eval(s.tgWebhook),f=function(){var e;return e=i.instant("ADMIN.WEBHOOKS.DATE"),t.webhooklogs.list(m.id).then(function(t){return function(t){var r,n,i,o;for(r=0,n=t.length;n>r;r++)i=t[r],i.validStatus=200<=(o=i.status)&&300>o,i.prettySentHeaders=_.map(_.toPairs(i.request_headers),function(t){var e,r;return e=t[0],r=t[1],e+": "+r}).join("\n"),i.prettySentData=JSON.stringify(i.request_data),i.prettyDate=moment(i.created).format(e);return m.logs_counter=t.length,m.logs=t,h()}}(this))},h=function(){var t,e,r,n;return r=o.find(".toggle-history"),t=r.parents(".single-webhook-wrapper").find(".webhooks-history"),t.hasClass("open")?(e=i.instant("ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY"),n=i.instant("ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE")):(e=i.instant("ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY"),n=i.instant("ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE")),r.text(e),r.prop("title",n)},p=function(){return o.find(".edition-mode").addClass("hidden"),o.find(".visualization-mode").removeClass("hidden")},l=function(){return o.find(".visualization-mode").addClass("hidden"),o.find(".edition-mode").removeClass("hidden")},u=function(){return o.find(".webhooks-history").addClass("open")},a=function(){return p(),n.$apply(function(){return m.revert()})},c=d(2e3,function(t){var n,i;return n=t.parents("form").checksley(),n.validate()?(i=e.save(m),i.then(function(t){return function(){return p()}}(this)),i.then(null,function(t){return r.notify("error"),n.setErrors(t)})):void 0}),o.on("click",".test-webhook",function(){return u(),t.webhooks.test(m.id).then(function(t){return function(){return f()}}(this))}),o.on("click",".edit-webhook",function(){return l()}),o.on("click",".cancel-existing",function(){return a()}),o.on("click",".edit-existing",function(t){var e;return t.preventDefault(),e=angular.element(t.currentTarget),c(e)}),o.on("keyup",".edition-mode input",function(t){var e;return 13===t.keyCode?(e=angular.element(t.currentTarget),c(e)):27===t.keyCode?(e=angular.element(t.currentTarget),a(e)):void 0}),o.on("click",".delete-webhook",function(){var t,o;return o=i.instant("ADMIN.WEBHOOKS.DELETE"),t=i.instant("ADMIN.WEBHOOKS.WEBHOOK_NAME",{name:m.name}),r.askOnDelete(o,t).then(function(t){return function(t){var i,o;return o=function(){return t.finish(),n.$emit("webhooks:reload")},i=function(){return t.finish(!1),r.notify("error")},e.remove(m).then(o,i)}}(this))}),o.on("click",".toggle-history",function(t){var e;return e=angular.element(t.currentTarget),null==m.logs||0===m.logs.length?f().then(function(){return g(0,function(){return o.find(".webhooks-history").toggleClass("open"),h()})}):(o.find(".webhooks-history").toggleClass("open"),n.$apply(function(){return h()}))}),o.on("click",".history-single",function(t){var e;return e=angular.element(t.currentTarget),e.toggleClass("history-single-open"),e.siblings(".history-single-response").toggleClass("open")}),o.on("click",".resend-request",function(e){var r,n;return n=angular.element(e.currentTarget),r=n.data("log"),t.webhooklogs.resend(r).then(function(t){return function(){return f()}}(this))})},{link:o}},h.directive("tgWebhook",["$tgResources","$tgRepo","$tgConfirm","$tgLoading","$translate",c]),s=function(t,e,r,n){var i;return i=function(t,n,i){var o,s,a,u,c;return c=t.$eval(i.tgWebhook),s=n.find(".new-webhook-form"),o=n.find(".add-webhook"),a=function(){return t.newValue={name:"",url:"",key:""}},a(),t.$watch("webhooks",function(t){return null!=t?0===t.length?(s.removeClass("hidden"),o.addClass("hidden"),s.find("input")[0].focus()):(s.addClass("hidden"),o.removeClass("hidden")):void 0}),u=d(2e3,function(){var n,i;return n=s.checksley(),n.validate()?(t.newValue.project=t.project.id,i=e.create("webhooks",t.newValue),i.then(function(e){return function(){return t.$emit("webhooks:reload"),a()}}(this)),i.then(null,function(t){return r.notify("error"),n.setErrors(t)})):void 0}),s.on("click",".add-new",function(t){return t.preventDefault(),u()}),s.on("keyup","input",function(t){return 13===t.keyCode?u():void 0}),s.on("click",".cancel-new",function(e){return t.$apply(function(){return a(),t.webhooks.length>=1?s.addClass("hidden"):void 0})}),o.on("click",function(t){return s.removeClass("hidden"),s.find("input")[0].focus()})},{link:i}},h.directive("tgNewWebhook",["$tgResources","$tgRepo","$tgConfirm","$tgLoading",s]),r=function(t){function e(t,e,r,n,i,o){var s;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,p(this),this.scope.sectionName=this.translate.instant("ADMIN.GITHUB.SECTION_NAME"),this.scope.project={},s=this.loadInitialData(),s.then(function(t){return function(){var e,r;return r=t.translate.instant("ADMIN.GITHUB.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(r,e)}}(this)),s.then(null,this.onInitialDataError.bind(this))}return v(e,t),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate"],e.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"github").then(function(t){return function(e){return t.scope.github=e}}(this))},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),e}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(){return t.loadModules()}}(this)),t},e}(f(m.Controller,m.PageMixin,m.FiltersMixin)),h.controller("GithubController",r),i=function(t){function e(t,e,r,n,i,o){var s;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,p(this),this.scope.sectionName=this.translate.instant("ADMIN.GITLAB.SECTION_NAME"),this.scope.project={},s=this.loadInitialData(),s.then(function(t){return function(){var e,r;return r=t.translate.instant("ADMIN.GITLAB.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(r,e)}}(this)),s.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:modules:reload",function(t){return function(){return t.loadModules()}}(this))}return v(e,t),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate"],e.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"gitlab").then(function(t){return function(e){return t.scope.gitlab=e}}(this))},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),e}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(){return t.loadModules()}}(this)),t},e}(f(m.Controller,m.PageMixin,m.FiltersMixin)),h.controller("GitlabController",i),t=function(t){function e(t,e,r,n,i,o){var s;this.scope=t,this.repo=e,this.rs=r,this.params=n,this.appMetaService=i,this.translate=o,p(this),this.scope.sectionName=this.translate.instant("ADMIN.BITBUCKET.SECTION_NAME"),this.scope.project={},s=this.loadInitialData(),s.then(function(t){return function(){var e,r;return r=t.translate.instant("ADMIN.BITBUCKET.PAGE_TITLE",{projectName:t.scope.project.name}),e=t.scope.project.description,t.appMetaService.setAll(r,e)}}(this)),s.then(null,this.onInitialDataError.bind(this)),this.scope.$on("project:modules:reload",function(t){return function(){return t.loadModules()}}(this))}return v(e,t),e.$inject=["$scope","$tgRepo","$tgResources","$routeParams","tgAppMetaService","$translate"],e.prototype.loadModules=function(){return this.rs.modules.list(this.scope.projectId,"bitbucket").then(function(t){return function(e){return t.scope.bitbucket=e}}(this))},e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),e}}(this))},e.prototype.loadInitialData=function(){var t;return t=this.loadProject(),t.then(function(t){return function(){return t.loadModules()}}(this)),t},e}(f(m.Controller,m.PageMixin,m.FiltersMixin)),h.controller("BitbucketController",t),a=function(){var t;return t=function(t,e,r){return e.on("click",".select-input-content",function(){return e.find("input").select(),e.find(".help-copy").addClass("visible")})},{link:t}},h.directive("tgSelectInputText",a),n=function(t,e,r){var n;return n=function(n,i,o){var s,a,u;return s=i.find("form").checksley({onlyOneErrorElement:!0}),a=d(2e3,function(i){return function(i){var o,a;return i.preventDefault(),s.validate()?(o=r().target(u).start(),a=t.saveAttribute(n.github,"github"),a.then(function(){return o.finish(),e.notify("success")}),a.then(null,function(t){return o.finish(),s.setErrors(t),t._error_message?e.notify("error",t._error_message):void 0})):void 0}}(this)),u=i.find(".submit-button"),i.on("submit","form",a)},{link:n}},h.directive("tgGithubWebhooks",["$tgRepo","$tgConfirm","$tgLoading",n]),o=function(t,e,r){var n;return n=function(n,i,o){var s,a,u;return s=i.find("form").checksley({onlyOneErrorElement:!0}),a=d(2e3,function(i){return function(i){var o,a;return i.preventDefault(),s.validate()?(o=r().target(u).start(),a=t.saveAttribute(n.gitlab,"gitlab"),a.then(function(){return o.finish(),e.notify("success"),n.$emit("project:modules:reload")}),a.then(null,function(t){return o.finish(),s.setErrors(t),t._error_message?e.notify("error",t._error_message):void 0})):void 0}}(this)),u=i.find(".submit-button"),i.on("submit","form",a)},{link:n}},h.directive("tgGitlabWebhooks",["$tgRepo","$tgConfirm","$tgLoading",o]),e=function(t,e,r){var n;return n=function(n,i,o){var s,a,u;return s=i.find("form").checksley({onlyOneErrorElement:!0}),a=d(2e3,function(i){return function(i){var o,a;return i.preventDefault(),s.validate()?(o=r().target(u).start(),a=t.saveAttribute(n.bitbucket,"bitbucket"),a.then(function(){return o.finish(),e.notify("success"),n.$emit("project:modules:reload")}),a.then(null,function(t){return o.finish(),s.setErrors(t),t._error_message?e.notify("error",t._error_message):void 0})):void 0}}(this)),u=i.find(".submit-button"),i.on("submit","form",a)},{link:n}},h.directive("tgBitbucketWebhooks",["$tgRepo","$tgConfirm","$tgLoading",e]),u=function(){var t;return t=function(t,e,r,n){return n.$parsers.push(function(t){return t=$.trim(t),""===t?[]:t.split(",")})},{link:t,restrict:"EA",require:"ngModel"}},h.directive("tgValidOriginIps",u)}.call(this),function(){var t,e;e=angular.module("taigaProject"),t=function(){return{templateUrl:"project/wizard-restrictions.html"}},e.directive("tgCreateProjectRestriction",[t])}.call(this),function(){var t,e,r,n,i,o,s;o=this.taiga,r=this.taiga.bindOnce,s=this.taiga.timeout,n=this.taiga.debounce,i=angular.module("taigaProject"),t=function(t,e,r,n,i,o,s,a,u,c,l,p,d){var f,h;return h=function(i,f,h){var m,g,v,y,b,$,S;return i.data={},i.templates=[],m=null,g=f.find("form").checksley({onlyOneErrorElement:!0}),y=function(e){return c.get("$http").removeAll(),m.finish(),t.$broadcast("projects:reload"),r.notify("success",l.instant("COMMON.SAVE")),n.url(s.get(e)),u.close(f),p.loadProjects()},v=function(t){var e,r,n,i,o,s;for(m.finish(),g.setErrors(t),s=[],i=_.keys(t),o=[],r=0,n=i.length;n>r;r++)e=i[r],o.push(s.push("[name="+e+"]"));return o},$=function(t){return function(t){var r;return t.preventDefault(),g.validate()?(m=a().target(S).start(),r=e.create("projects",i.data),r.then(y,v)):void 0}}(this),b=function(){return i.data={is_private:!1},i.templates.length?i.data.creation_template=_.head(_.filter(i.templates,function(t){return"scrum"===t.slug})).id:o.projects.templates().then(function(t){return function(t){return i.templates=t,i.data.creation_template=_.head(_.filter(i.templates,function(t){return"scrum"===t.slug})).id}}(this)),i.canCreatePrivateProjects=p.canCreatePrivateProjects(),i.canCreatePublicProjects=p.canCreatePublicProjects(),u.open(f)},S=f.find(".submit-button"),f.on("submit","form",$),f.on("click",".close",function(t){return t.preventDefault(),u.close(f)}),i.$on("$destroy",function(){return f.off()}),d.refresh().then(function(){return b()})},f={link:h,templateUrl:"project/wizard-create-project.html",scope:{}}},i.directive("tgLbCreateProject",["$rootScope","$tgRepo","$tgConfirm","$location","$tgNavUrls","$tgResources","$projectUrl","$tgLoading","lightboxService","$cacheFactory","$translate","tgCurrentUserService","$tgAuth",t]),e=function(t,e,r,n,i,o,s,a,u){var c;return c=function(r,c,l){var p,d;return p=null,r.$on("deletelightbox:new",function(t,e){return s.open(c),p=e}),r.$on("$destroy",function(){return c.off()}),d=function(){var r;return a.start(),s.close(c),r=t.remove(p),r.then(function(t){return a.pageLoaded(),e.$broadcast("projects:reload"),n.path(i.resolve("home")),o.notify("success"),u.loadProjects()}),r.then(null,function(){return o.notify("error"),s.close(c)})},c.on("click",".button-red",function(t){return t.preventDefault(),s.close(c)}),c.on("click",".button-green",function(t){return t.preventDefault(),d()})},{link:c}},i.directive("tgLbDeleteProject",["$tgRepo","$rootScope","$tgAuth","$tgLocation","$tgNavUrls","$tgConfirm","lightboxService","tgLoader","tgCurrentUserService",e])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c,l;c=this.taiga.bindOnce,r=function(){var t;return t=function(t,e,r){return c(t,r.tgBoBind,function(t){return e.text(t)})},{link:t}},i=function(){var t;return t=function(t,e,r){return c(t,r.tgBoHtml,function(t){return e.html(t)})},{link:t}},o=function(){var t;return t=function(t,e,r){return c(t,r.tgBoRef,function(t){return e.html("#"+t+" ")})},{link:t}},s=function(){var t;return t=function(t,e,r){return c(t,r.tgBoSrc,function(t){return e.attr("src",t)})},{link:t}},n=function(){var t;return t=function(t,e,r){return c(t,r.tgBoHref,function(t){return e.attr("href",t)})},{link:t}},e=function(){var t;return t=function(t,e,r){return c(t,r.tgBoAlt,function(t){return e.attr("alt",t)})},{link:t}},a=function(){var t;return t=function(t,e,r){return c(t,r.tgBoTitle,function(t){return e.attr("title",t)})},{link:t}},u=function(){var t;return t=function(t,e,r){return t.$watch(r.tgTitleHtml,function(t){return null!=t?e.attr("title",t):void 0})},{link:t}},t=function(){var t;return t=function(t,e,r){return t.$watch(r.tgBindHtml,function(t){return null!=t?e.html(t):void 0})},{link:t}},l=angular.module("taigaBase"),l.directive("tgBoBind",r),l.directive("tgBoHtml",i),l.directive("tgBoRef",o),l.directive("tgBoSrc",s),l.directive("tgBoHref",n),l.directive("tgBoAlt",e),l.directive("tgBoTitle",a),l.directive("tgBindTitle",u),l.directive("tgBindHtml",t)}.call(this),function(){var t,e;t=function(){function t(){this.config=window.taigaConfig}return t.prototype.get=function(t,e){return null==e&&(e=null),_.has(this.config,t)?this.config[t]:e},t}(),e=angular.module("taigaBase"),e.service("$tgConfig",t)}.call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;r=angular.module("taigaBase"),t=function(t){function e(t,e,r,n,i,o){var s;this.rootScope=t,this.scope=e,this.params=r,this.repo=n,this.rs=i,this.confirm=o,this.scope.currentPlugin=_.head(_.filter(this.rootScope.adminPlugins,{slug:this.params.plugin})),this.scope.projectSlug=this.params.pslug,s=this.loadInitialData(),s.then(null,function(t){return function(){return t.confirm.notify("error")}}(this))}return n(e,t),e.$inject=["$rootScope","$scope","$routeParams","$tgRepo","$tgResources","$tgConfirm"],e.prototype.loadProject=function(){return this.rs.projects.getBySlug(this.params.pslug).then(function(t){return function(e){return t.scope.projectId=e.id,t.scope.project=e,t.scope.$emit("project:loaded",e),t.scope.$broadcast("project:loaded",e),e}}(this))},e.prototype.loadInitialData=function(){return this.loadProject()},e}(taiga.Controller),r.controller("ContribController",t),e=function(t){function e(t,e,r){this.rootScope=t,this.scope=e,this.params=r,this.scope.currentPlugin=_.head(_.filter(this.rootScope.userSettingsPlugins,{
slug:this.params.plugin}))}return n(e,t),e.$inject=["$rootScope","$scope","$routeParams"],e}(taiga.Controller),r.controller("ContribUserSettingsController",e)}.call(this),function(){var t,e,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;e=this.taiga,t=function(t){function e(t,e){this.storage=t,this.params=e}return r(e,t),e.$inject=["$tgStorage","$routeParams"],e.prototype.generateHash=function(t){return null==t&&(t=[]),t=_.map(t,function(t){return JSON.stringify(t)}),hex_sha1(t.join(":"))},e}(e.Service)}.call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;r=this.taiga,t=function(t){function e(t,r,n,i,o,s){this.http=t,this.q=r,this.storage=n,this.rootScope=i,this.cacheFactory=o,this.translate=s,e.__super__.constructor.call(this),this.cache=this.cacheFactory("httpget")}return n(e,t),e.$inject=["$http","$q","$tgStorage","$rootScope","$cacheFactory","$translate"],e.prototype.headers=function(){var t,e,r;return t={},r=this.storage.get("token"),r&&(t.Authorization="Bearer "+r),e=this.translate.preferredLanguage(),e&&(t["Accept-Language"]=e),t},e.prototype.request=function(t){return t.headers=_.assign({},t.headers||{},this.headers()),this.http(t)},e.prototype.get=function(t,e,r){return r=_.assign({method:"GET",url:t},r),e&&(r.params=e),r.cache=this.cache,this.request(r)["finally"](function(t){return function(e){return t.cache.removeAll()}}(this))},e.prototype.post=function(t,e,r,n){return n=_.assign({method:"POST",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},e.prototype.put=function(t,e,r,n){return n=_.assign({method:"PUT",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},e.prototype.patch=function(t,e,r,n){return n=_.assign({method:"PATCH",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},e.prototype["delete"]=function(t,e,r,n){return n=_.assign({method:"DELETE",url:t},n),e&&(n.data=e),r&&(n.params=r),this.request(n)},e}(r.Service),e=angular.module("taigaBase"),e.service("$tgHttp",t)}.call(this),function(){var t,e;t=function(t,e,r){return t.noreload=function(r){var n,i;return n=e.current,i=r.$on("$locationChangeSuccess",function(){return e.current=n,i()}),t},t.isInCurrentRouteParams=function(e,r){var n;return n=t.search()||{},n[e]===r},t},e=angular.module("taigaBase"),e.factory("$tgLocation",["$location","$route","$rootScope",t])}.call(this),function(){var t,e,r,n,i,o=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},s=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;t=function(){function t(t,e,r){this._attrs=e,this._name=t,this._dataTypes=r,this.setAttrs(e),this.initialize()}return t.prototype.clone=function(){var e;return e=new t(this._name,this._attrs,this._dataTypes),e._modifiedAttrs=this._modifiedAttrs,e._isModified=this._isModified,e},t.prototype.applyCasts=function(){var t,e,r,n,i;n=this._dataTypes,i=[];for(t in n)r=n[t],e=service.casts[r],e&&i.push(this._attrs[t]=e(this._attrs[t]));return i},t.prototype.getIdAttrName=function(){return"id"},t.prototype.getName=function(){return this._name},t.prototype.getAttrs=function(t){return null==t&&(t=!1),null!=this._attrs.version&&(this._modifiedAttrs.version=this._attrs.version),t?_.extend({},this._modifiedAttrs):_.extend({},this._attrs,this._modifiedAttrs)},t.prototype.setAttrs=function(t){return this._attrs=t,this._modifiedAttrs={},this.applyCasts(),this._isModified=!1},t.prototype.setAttr=function(t,e){return this._modifiedAttrs[t]=e,this._isModified=!0},t.prototype.initialize=function(){var t,e,r;return e=this,t=function(t){return function(){return"string"==typeof t&&"__"===t.substr(0,2)?e[t]:o.call(_.keys(e._modifiedAttrs),t)<0?e._attrs[t]:e._modifiedAttrs[t]}},r=function(t){return function(r){return"string"==typeof t&&"__"===t.substr(0,2)?void(e[t]=r):void(e._attrs[t]!==r?(e._modifiedAttrs[t]=r,e._isModified=!0):delete e._modifiedAttrs[t])}},_.each(this._attrs,function(n,i){var o;return o={get:t(i),set:r(i),enumerable:!0,configurable:!0},Object.defineProperty(e,i,o)})},t.prototype.serialize=function(){var t;return t={data:_.clone(this._attrs),name:this._name},JSON.stringify(t)},t.prototype.isModified=function(){return this._isModified},t.prototype.isAttributeModified=function(t){return null!=this._modifiedAttrs[t]},t.prototype.markSaved=function(){return this._isModified=!1,this._attrs=this.getAttrs(),this._modifiedAttrs={}},t.prototype.revert=function(){return this._modifiedAttrs={},this._isModified=!1},t.desSerialize=function(e){var r,n;return r=JSON.parse(e),n=new t(r.url,r.data)},t}(),i=this.taiga,e=function(t){function e(t,r,n,i){this.q=t,this.urls=r,this.storage=n,this.http=i,e.__super__.constructor.call(this)}return s(e,t),e.$inject=["$q","$tgUrls","$tgStorage","$tgHttp"],e}(i.Service),n=function(e,r,n,i){var o;return o={},o.make_model=function(e,r,n,i){return null==n&&(n=t),null==i&&(i={}),new n(e,r,i)},o.cls=t,o.casts={"int":function(t){return parseInt(t,10)},"float":function(t){return parseFloat(t,10)}},o},r=angular.module("taigaBase"),r.factory("$tgModel",["$q","$http","$tgUrls","$tgStorage",n])}.call(this),function(){var t,e,r,n,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=this.taiga,o=this.taiga.trim,r=this.taiga.bindOnce,n=angular.module("taigaBase"),e=function(t){function e(){this.urls={}}return s(e,t),e.prototype.update=function(t){return this.urls=_.merge({},this.urls,t||{})},e.prototype.formatUrl=function(t,e){var r;return null==e&&(e={}),r=function(t){return t=o(t,":"),e[t]||"undefined"},t.replace(/(:\w+)/g,r)},e.prototype.resolve=function(t,e){var r;return r=this.urls[t],r?e?this.formatUrl(r,e):r:""},e}(i.Service),n.service("$tgNavUrls",e),t=function(t,e,n,i,s){var a,u,c;return a=function(t,e){var i;return i=n.defer(),r(t,e,function(t){return i.resolve(t)}),i.promise},c=function(t,e){var r,i,s,u,c,l,p,d;if(l=_.map(t.split(":"),o),i=l[0],u=l[1],u)for(p=u.split(/(\w+)=/),p=_.filter(p,function(t){return t.length}),p=_.map(p,function(t){return o(t.replace(/,$/g,""))}),u=[],r=0;r<p.length;)s={},s[p[r]]=p[r+1],u.push(s),r+=2;else u=[];return d=_.map(u,function(t){return _.values(t)[0]}),c=_.map(d,function(t){return a(e,t)}),n.all(c).then(function(){var t,r,n,o,s,a;for(o={},t=0,n=u.length;n>t;t++)s=u[t],r=Object.keys(s)[0],a=s[r],o[r]=e.$eval(a);return[i,o]})},u=function(r,n,o){return n.is("a")&&n.attr("href","#"),n.on("mouseenter",function(a){var u;return u=$(a.currentTarget),u.data("fullUrl")&&o.tgNavGetParams===u.data("params")?void 0:c(o.tgNav,r).then(function(a){var c,l,p,d,f,h,m;return d=a[0],f=a[1],m=e.getUser(),m&&(f.user=m.username),h=t.resolve(d),c=t.formatUrl(h,f),o.tgNavGetParams&&(l=JSON.parse(o.tgNavGetParams),p=$.param(l),c=c+"?"+p,u.data("params",o.tgNavGetParams)),u.data("fullUrl",c),u.is("a")&&u.attr("href",c),n.on("click",function(t){if(!t.metaKey&&!t.ctrlKey&&(t.preventDefault(),u=$(t.currentTarget),!u.hasClass("noclick"))){switch(c=u.data("fullUrl"),t.which){case 1:i.url(c),r.$apply();break;case 2:window.open(c)}return s.closeAll()}})})}),r.$on("$destroy",function(){return n.off()})},{link:u}},n.directive("tgNav",["$tgNavUrls","$tgAuth","$q","$tgLocation","lightboxService",t])}.call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;r=this.taiga,t=function(t){function e(t,r,n,i,o){this.q=t,this.model=r,this.storage=n,this.http=i,this.urls=o,e.__super__.constructor.call(this)}return n(e,t),e.$inject=["$q","$tgModel","$tgStorage","$tgHttp","$tgUrls"],e.prototype.resolveUrlForModel=function(t){var e;return e=t.getIdAttrName(),this.urls.resolve(t.getName())+"/"+t[e]},e.prototype.resolveUrlForAttributeModel=function(t){return this.urls.resolve(t.getName(),t.parent)},e.prototype.create=function(t,e,r,n){var i,o,s;return null==r&&(r={}),null==n&&(n={}),i=this.q.defer(),s=this.urls.resolve(t),o=this.http.post(s,JSON.stringify(e)),o.success(function(e){return function(n,o){return i.resolve(e.model.make_model(t,n,null,r))}}(this)),o.error(function(t){return function(t,e){return i.reject(t)}}(this)),i.promise},e.prototype.remove=function(t,e){var r,n,i;return null==e&&(e={}),r=this.q.defer(),i=this.resolveUrlForModel(t),n=this.http["delete"](i,{},e),n.success(function(e,n){return r.resolve(t)}),n.error(function(e,n){return r.reject(t)}),r.promise},e.prototype.saveAll=function(t,e){var r;return null==e&&(e=!0),r=_.map(t,function(t){return function(e){return t.save(e,!0)}}(this)),this.q.all(r)},e.prototype.save=function(t,e){var r,n,i,o;return null==e&&(e=!0),n=this.q.defer(),!t.isModified()&&e?(n.resolve(t),n.promise):(o=this.resolveUrlForModel(t),r=JSON.stringify(t.getAttrs(e)),i=e?this.http.patch(o,r):this.http.put(o,r),i.success(function(e){return function(e,r){return t._isModified=!1,t._attrs=_.extend(t.getAttrs(),e),t._modifiedAttrs={},t.applyCasts(),n.resolve(t)}}(this)),i.error(function(t,e){return n.reject(t)}),n.promise)},e.prototype.saveAttribute=function(t,e,r){var n,i,o,s;return null==r&&(r=!0),i=this.q.defer(),!t.isModified()&&r?(i.resolve(t),i.promise):(s=this.resolveUrlForAttributeModel(t),n={},n[e]=t.getAttrs(),o=r?this.http.patch(s,n):this.http.put(s,n),o.success(function(e){return function(e,r){return t._isModified=!1,t._attrs=_.extend(t.getAttrs(),e),t._modifiedAttrs={},t.applyCasts(),i.resolve(t)}}(this)),o.error(function(t,e){return i.reject(t)}),i.promise)},e.prototype.refresh=function(t){var e,r,n;return e=this.q.defer(),n=this.resolveUrlForModel(t),r=this.http.get(n),r.success(function(r,n){return t._modifiedAttrs={},t._attrs=r,t._isModified=!1,t.applyCasts(),e.resolve(t)}),r.error(function(t,r){return e.reject(t)}),e.promise},e.prototype.queryMany=function(t,e,r,n){var i,o;return null==r&&(r={}),null==n&&(n=!1),o=this.urls.resolve(t),i={headers:{}},r.enablePagination||(i.headers["x-disable-pagination"]="1"),this.http.get(o,e,i).then(function(e){return function(r){var i;return i=_.map(r.data,function(r){return e.model.make_model(t,r)}),n?[i,r.headers]:i}}(this))},e.prototype.queryOneAttribute=function(t,e,r,n,i){var o,s;return null==i&&(i={}),s=this.urls.resolve(t,e),o={headers:{}},i.enablePagination||(o.headers["x-disable-pagination"]="1"),this.http.get(s,n,o).then(function(n){return function(i){var o;return o=n.model.make_model(t,i.data[r]),o.parent=e,o}}(this))},e.prototype.queryOne=function(t,e,r,n){var i,o;return null==n&&(n={}),o=this.urls.resolve(t),e&&(o=o+"/"+e),i={headers:{}},n.enablePagination||(i.headers["x-disable-pagination"]="1"),this.http.get(o,r,i).then(function(e){return function(r){return e.model.make_model(t,r.data)}}(this))},e.prototype.queryOneRaw=function(t,e,r,n){var i,o;return null==n&&(n={}),o=this.urls.resolve(t),e&&(o=o+"/"+e),i=_.merge({headers:{}},n),n.enablePagination||(i.headers["x-disable-pagination"]="1"),this.http.get(o,r,i).then(function(t){return function(t){return t.data}}(this))},e.prototype.queryPaginated=function(t,e,r){var n,i;return null==r&&(r={}),i=this.urls.resolve(t),n=_.merge({headers:{}},r),this.http.get(i,e,n).then(function(e){return function(r){var n,i;return n=r.headers(),i={},i.models=_.map(r.data,function(r){return e.model.make_model(t,r)}),i.count=parseInt(n["x-pagination-count"],10),i.current=parseInt(n["x-pagination-current"]||1,10),i.paginatedBy=parseInt(n["x-paginated-by"],10),i}}(this))},e.prototype.queryOnePaginatedRaw=function(t,e,r,n){var i,o;return null==n&&(n={}),o=this.urls.resolve(t),e&&(o=o+"/"+e),i=_.merge({headers:{}},n),this.http.get(o,r,i).then(function(t){return function(t){var e,r;return e=t.headers(),r={},r.data=t.data,r.count=parseInt(e["x-pagination-count"],10),r.current=parseInt(e["x-pagination-current"]||1,10),r.paginatedBy=parseInt(e["x-paginated-by"],10),r}}(this))},e.prototype.resolve=function(t){var e,r;return r={},null!=t.pslug&&(r.project=t.pslug),null!=t.usref&&(r.us=t.usref),null!=t.taskref&&(r.task=t.taskref),null!=t.issueref&&(r.issue=t.issueref),null!=t.sslug&&(r.milestone=t.sslug),null!=t.wikipage&&(r.wikipage=t.wikipage),e=!(t.wikipage||t.sslug),this.queryOneRaw("resolver",null,r,{cache:e})},e}(r.Service),e=angular.module("taigaBase"),e.service("$tgRepo",t)}.call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;r=this.taiga,t=function(t){function e(t){e.__super__.constructor.call(this)}return n(e,t),e.$inject=["$rootScope"],e.prototype.get=function(t,e){var r;return r=localStorage.getItem(t),null===r?e||null:JSON.parse(r)},e.prototype.set=function(t,e){return _.isObject(t)?_.each(t,function(t){return function(e,r){return t.set(r,e)}}(this)):localStorage.setItem(t,JSON.stringify(e))},e.prototype.contains=function(t){var e;return e=this.get(t),null!==e},e.prototype.remove=function(t){return localStorage.removeItem(t)},e.prototype.clear=function(){return localStorage.clear()},e}(r.Service),e=angular.module("taigaBase"),e.service("$tgStorage",t)}.call(this),function(){var t,e,r,n,i=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o={}.hasOwnProperty;e=function(t,e){return e=_.clone(e),t.replace(/%s/g,function(t){return String(e.shift())})},n=this.taiga,t=function(t){function r(t){this.config=t,this.urls={},this.mainUrl=this.config.get("api")}return i(r,t),r.$inject=["$tgConfig"],r.prototype.update=function(t){return this.urls=_.merge(this.urls,t)},r.prototype.resolve=function(){var t,r,n;if(t=_.toArray(arguments),0===t.length)throw Error("wrong arguments to setUrls");return r=t.slice(0,1)[0],n=e(this.urls[r],t.slice(1)),e("%s/%s",[_.trimEnd(this.mainUrl,"/"),_.trimStart(n,"/")])},r.prototype.resolveAbsolute=function(){var t;return t=this.resolve.apply(this,arguments),/^https?:\/\//i.test(t)?t:/^\//.test(t)?window.location.protocol+"//"+window.location.host+t:window.location.protocol+"//"+window.location.host+"/"+t},r}(n.Service),r=angular.module("taigaBase"),r.service("$tgUrls",t)}.call(this),function(){var t,e,r;r=this.taiga,e=function(t){var e,r;return e=function(e,r){return t.queryOne(r,e)},r={userstory:{get:function(t){return e(t,"custom-attributes-values/userstory")}},task:{get:function(t){return e(t,"custom-attributes-values/task")}},issue:{get:function(t){return e(t,"custom-attributes-values/issue")}}},function(t){return t.customAttributesValues=r}},t=angular.module("taigaResources"),t.factory("$tgCustomAttributesValuesResourcesProvider",["$tgRepo",e])}.call(this),function(){var t,e,r,n;n=this.taiga,r=this.taiga.sizeFormat,e=function(t){var e,r;return e=function(e,r){return t.queryMany(r,{project:e})},r={userstory:{list:function(t){return e(t,"custom-attributes/userstory")}},task:{list:function(t){return e(t,"custom-attributes/task")}},issue:{list:function(t){return e(t,"custom-attributes/issue")}}},function(t){return t.customAttributes=r}},t=angular.module("taigaResources"),t.factory("$tgCustomAttributesResourcesProvider",["$tgRepo",e])}.call(this),function(){var t,e,r;r=this.taiga,e=function(t,e,r){var n;return n={},n.get=function(e,r){return t.queryOneRaw("history/"+e,r)},n.deleteComment=function(t,n,i){var o,s;return s=r.resolve("history/"+t),s=s+"/"+n+"/delete_comment",o={id:i},e.post(s,null,o).then(function(t){return function(t){return t.data}}(this))},n.undeleteComment=function(t,n,i){var o,s;return s=r.resolve("history/"+t),s=s+"/"+n+"/undelete_comment",o={id:i},e.post(s,null,o).then(function(t){return function(t){return t.data}}(this))},function(t){return t.history=n}},t=angular.module("taigaResources"),t.factory("$tgHistoryResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",e])}.call(this),function(){var t,e,r;r=this.taiga,e=function(t){var e;return e={},e.get=function(e){return t.queryOne("invitations",e)},function(t){return t.invitations=e}},t=angular.module("taigaResources"),t.factory("$tgInvitationsResourcesProvider",["$tgRepo",e])}.call(this),function(){var t,e,r,n;n=this.taiga,t=n.generateHash,r=function(e,r,n,i,o){var s,a,u,c;return c={},a="issues-queryparams",s="issues-filters",u="issues-my-filters",c.get=function(t,r){var n;return n=c.getQueryParams(t),n.project=t,e.queryOne("issues",r,n)},c.getByRef=function(t,r){var n;return n=c.getQueryParams(t),n.project=t,n.ref=r,e.queryOne("issues","by_ref",n)},c.listInAllProjects=function(t){return e.queryMany("issues",t)},c.list=function(t,r,n){var i;return i={project:t},i=_.extend({},i,r||{}),c.storeQueryParams(t,i),e.queryPaginated("issues",i,n)},c.bulkCreate=function(t,e){var i,o;return o=n.resolve("bulk-create-issues"),i={project_id:t,bulk_issues:e},r.post(o,i)},c.upvote=function(t){var e;return e=n.resolve("issue-upvote",t),r.post(e)},c.downvote=function(t){var e;return e=n.resolve("issue-downvote",t),r.post(e)},c.watch=function(t){var e;return e=n.resolve("issue-watch",t),r.post(e)},c.unwatch=function(t){var e;return e=n.resolve("issue-unwatch",t),r.post(e)},c.stats=function(t){return e.queryOneRaw("projects",t+"/issues_stats")},c.filtersData=function(t){return e.queryOneRaw("issues-filters",null,t)},c.listValues=function(t,r){var n;return n={project:t},c.storeQueryParams(t,n),e.queryMany(r,n)},c.storeQueryParams=function(e,r){var n,o;return o=e+":"+a,n=t([e,o]),i.set(n,r)},c.getQueryParams=function(e){var r,n;return n=e+":"+a,r=t([e,n]),i.get(r)||{}},c.storeFilters=function(e,r){var n,o;return o=e+":"+s,n=t([e,o]),i.set(n,r)},c.getFilters=function(e){var r,n;return n=e+":"+s,r=t([e,n]),i.get(r)||{}},c.storeMyFilters=function(e,i){var s,a,c,l,p;return s=o.defer(),p=n.resolve("user-storage"),c=e+":"+u,a=t([e,c]),_.isEmpty(i)?(l=r["delete"](p+"/"+a,{key:a,value:i}),l.then(function(){return s.resolve()}),l.then(null,function(){return s.reject()})):(l=r.put(p+"/"+a,{key:a,value:i}),l.then(function(t){return s.resolve()}),l.then(null,function(t){var e;return e=r.post(""+p,{key:a,value:i}),e.then(function(){return s.resolve()}),e.then(null,function(){return s.reject()})})),s.promise},c.getMyFilters=function(e){var i,s,a,c,l;return i=o.defer(),l=n.resolve("user-storage"),a=e+":"+u,s=t([e,a]),c=r.get(l+"/"+s),c.then(function(t){return i.resolve(t.data.value)}),c.then(null,function(t){return i.resolve({})}),i.promise},function(t){return t.issues=c}},e=angular.module("taigaResources"),e.factory("$tgIssuesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage","$q",r])}.call(this),function(){var t,e,r,n;n=this.taiga,t=n.generateHash,r=function(e){var r,n,i;return i={},n="kanban-statusviewmodels",r="kanban-statuscolumnmodels",i.storeStatusViewModes=function(r,i){var o,s;return s=r+":"+n,o=t([r,s]),e.set(o,i)},i.getStatusViewModes=function(r){var i,o;return o=r+":"+n,i=t([r,o]),e.get(i)||{}},i.storeStatusColumnModes=function(n,i){var o,s;return s=n+":"+r,o=t([n,s]),e.set(o,i)},i.getStatusColumnModes=function(n){var i,o;return o=n+":"+r,i=t([n,o]),e.get(i)||{}},function(t){return t.kanban=i}},e=angular.module("taigaResources"),e.factory("$tgKanbanResourcesProvider",["$tgStorage",r])}.call(this),function(){var t,e,r,n;n=this.taiga,r=this.taiga.sizeFormat,e=function(t){var e;return e={list:function(){return t.queryMany("locales")}},function(t){return t.locales=e}},t=angular.module("taigaResources"),t.factory("$tgLocalesResourcesProvider",["$tgRepo",e])}.call(this),function(){var t,e,r;r=this.taiga,e=function(t,e,r){var n;return n={},n.render=function(t,n){var i,o;return null!=n&&""!==n||(n=" "),i={project_id:t,content:n},o=e.resolve("wiki"),r.post(o+"/render",i).then(function(t){return function(t){return t.data}}(this))},function(t){return t.mdrender=n}},t=angular.module("taigaResources"),t.factory("$tgMdRenderResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",e])}.call(this),function(){var t,e,r;r=this.taiga,e=function(t,e,r){var n;return n={},n.get=function(e){return t.queryOne("memberships",e)},n.list=function(e,r,n){var i,o;return null==n&&(n=!0),o={project:e},o=_.extend({},o,r||{}),n?t.queryPaginated("memberships",o):t.queryMany("memberships",o,i={enablePagination:n})},n.listByUser=function(e,r){var n;return n={user:e},n=_.extend({},n,r||{}),t.queryPaginated("memberships",n)},n.resendInvitation=function(t){var n;return n=r.resolve("memberships"),e.post(n+"/"+t+"/resend_invitation",{})},n.bulkCreateMemberships=function(t,n,i){var o,s;return s=r.resolve("bulk-create-memberships"),o={project_id:t,bulk_memberships:n,invitation_extra_text:i},e.post(s,o)},function(t){return t.memberships=n}},t=angular.module("taigaResources"),t.factory("$tgMembershipsResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",e])}.call(this),function(){var t,e;e=function(t){var e;return e={},e.list=function(e,r){return t.queryOneAttribute("project-modules",e,r)},function(t){return t.modules=e}},t=angular.module("taigaResources"),t.factory("$tgModulesResourcesProvider",["$tgRepo",e])}.call(this),function(){var t,e,r;r=this.taiga,e=function(t,e,r){var n;return n={},n.get=function(e){return t.queryOne("notify-policies",e)},n.list=function(e){var r;return r=_.extend({},r,e||{}),t.queryMany("notify-policies",r)},function(t){return t.notifyPolicies=n}},t=angular.module("taigaResources"),t.factory("$tgNotifyPoliciesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",e])}.call(this),function(){var t,e,r,n;n=this.taiga,r=this.taiga.sizeFormat,e=function(t,e,n,i,o,s,a){var u;return u={},u.get=function(t){return e.queryOne("projects",t)},u.getBySlug=function(t){return e.queryOne("projects","by_slug?slug="+t)},u.list=function(){return e.queryMany("projects")},u.listByMember=function(t){var r;return r={member:t,order_by:"memberships__user_order"},e.queryMany("projects",r)},u.templates=function(){return e.queryMany("project-templates")},u.usersList=function(t){var r;return r={project:t},e.queryMany("users",r)},u.rolesList=function(t){var r;return r={project:t},e.queryMany("roles",r)},u.stats=function(t){return e.queryOneRaw("projects",t+"/stats")},u.bulkUpdateOrder=function(t){var e;return e=i.resolve("bulk-update-projects-order"),n.post(e,t)},u.regenerate_userstories_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/regenerate_userstories_csv_uuid",n.post(e)},u.regenerate_issues_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/regenerate_issues_csv_uuid",n.post(e)},u.regenerate_tasks_csv_uuid=function(t){var e;return e=i.resolve("projects")+"/"+t+"/regenerate_tasks_csv_uuid",n.post(e)},u.leave=function(t){var e;return e=i.resolve("projects")+"/"+t+"/leave",n.post(e)},u.memberStats=function(t){return e.queryOneRaw("projects",t+"/member_stats")},u.tagsColors=function(t){return e.queryOne("projects",t+"/tags_colors")},u["export"]=function(t){var e;return e=i.resolve("exporter")+"/"+t,n.get(e)},u["import"]=function(e,n){var u,c,l,p,d,f,h,m,g,v,_;return l=s.defer(),f=t.get("maxUploadFileSize",null),f&&e.size>f?(p=a.instant("PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED",{fileName:e.name,fileSize:r(e.size),maxFileSize:r(f)}),h={status:413,data:{_error_message:p}},l.reject(h),l.promise):(v=function(t){return function(t){var e,i;return i=Math.round(t.loaded/t.total*100),e=a.instant("PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE",{uploadedSize:r(t.loaded),totalSize:r(t.total)}),n("in-progress",null,e,i)}}(this),m=function(t){return function(t){return n("done",a.instant("PROJECT.IMPORT.TITLE"),a.instant("PROJECT.IMPORT.DESCRIPTION"))}}(this),g=function(t){return function(t){return n("error")}}(this),u=function(t){return function(t){var e;h={};try{h.data=JSON.parse(t.target.responseText)}catch(r){h.data={}}return h.status=t.target.status,t.target.getResponseHeader("Taiga-Info-Project-Is-Private")&&(h.headers={isPrivate:"True"===t.target.getResponseHeader("Taiga-Info-Project-Is-Private"),memberships:parseInt(t.target.getResponseHeader("Taiga-Info-Project-Memberships"))}),201!==(e=h.status)&&202!==e||l.resolve(h),l.reject(h)}}(this),d=function(t){return function(t){return l.reject("fail")}}(this),c=new FormData,c.append("dump",e),_=new XMLHttpRequest,_.upload.addEventListener("progress",v,!1),_.upload.addEventListener("load",m,!1),_.upload.addEventListener("error",g,!1),_.upload.addEventListener("abort",g,!1),_.addEventListener("load",u,!1),_.addEventListener("error",d,!1),_.open("POST",i.resolve("importer")),_.setRequestHeader("Authorization","Bearer "+o.getToken()),_.setRequestHeader("Accept","application/json"),_.send(c),l.promise)},u.changeLogo=function(e,o){var a,u,c,l,p,d;return c=t.get("maxUploadFileSize",null),c&&o.size>c?(p={status:413,data:{_error_message:"'"+o.name+"' ("+r(o.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+r(c)+")"}},u=s.defer(),u.reject(p),u.promise):(a=new FormData,a.append("logo",o),l={transformRequest:angular.identity,headers:{"Content-Type":void 0}},d=i.resolve("projects")+"/"+e+"/change_logo",n.post(d,a,{},l))},u.removeLogo=function(t){var e;return e=i.resolve("projects")+"/"+t+"/remove_logo",n.post(e)},function(t){return t.projects=u}},t=angular.module("taigaResources"),t.factory("$tgProjectsResourcesProvider",["$tgConfig","$tgRepo","$tgHttp","$tgUrls","$tgAuth","$q","$translate",e])}.call(this),function(){var t,e,r;r=this.taiga,e=function(t,e,r){var n;return n={},n.get=function(e){return t.queryOne("roles",e)},n.list=function(e){return t.queryMany("roles",{project:e})},function(t){return t.roles=n}},t=angular.module("taigaResources"),t.factory("$tgRolesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",e])}.call(this),function(){var t,e,r;r=this.taiga,e=function(t,e,r,n){var i;return i={},i["do"]=function(t,i){var o,s,a,u;return o=n.defer(),u=e.resolve("search"),s={url:u,method:"GET",timeout:o.promise,cancelable:!0,params:{project:t,text:i,get_all:!1}},a=r.request(s).then(function(t){return t.data}),a.abort=function(){return o.resolve()},a["finally"]=function(){return a.abort=angular.noop,o=a=null},a},function(t){return t.search=i}},t=angular.module("taigaResources"),t.factory("$tgSearchResourcesProvider",["$tgRepo","$tgUrls","$tgHttp","$q",e])}.call(this),function(){var t,e,r,n;n=this.taiga,t=n.generateHash,r=function(t,e,r){var n;return n={},n.get=function(r,n){return t.queryOne("milestones",n).then(function(t){var r;return r=t.user_stories,r=_.map(r,function(t){return e.make_model("userstories",t)}),t._attrs.user_stories=r,t})},n.stats=function(e,r){return t.queryOneRaw("milestones",r+"/stats")},n.list=function(r,n){var i;return i={project:r},i=_.extend({},i,n||{}),t.queryMany("milestones",i,{},!0).then(function(t){return function(t){var r,n,i,o,s,a;for(s=t[0],r=t[1],n=0,i=s.length;i>n;n++)o=s[n],a=o.user_stories,a=_.map(a,function(t){return e.make_model("userstories",t)}),o._attrs.user_stories=a;return{milestones:s,closed:parseInt(r("Taiga-Info-Total-Closed-Milestones"),10),open:parseInt(r("Taiga-Info-Total-Opened-Milestones"),10)}}}(this))},function(t){return t.sprints=n}},e=angular.module("taigaResources"),e.factory("$tgSprintsResourcesProvider",["$tgRepo","$tgModel","$tgStorage",r])}.call(this),function(){var t,e,r,n;n=this.taiga,t=n.generateHash,r=function(e,r,n,i){var o,s,a,u;return u={},o="tasks-queryparams",s="tasks-statuscolumnmodels",a="tasks-usrowmodels",u.get=function(t,r){var n;return n=u.getQueryParams(t),n.project=t,e.queryOne("tasks",r,n)},u.getByRef=function(t,r){var n;return n=u.getQueryParams(t),n.project=t,n.ref=r,e.queryOne("tasks","by_ref",n)},u.listInAllProjects=function(t){return e.queryMany("tasks",t)},u.list=function(t,r,n){var i;return null==r&&(r=null),null==n&&(n=null),i={project:t},r&&(i.milestone=r),n&&(i.user_story=n),u.storeQueryParams(t,i),e.queryMany("tasks",i)},u.bulkCreate=function(t,e,i,o){var s,a;return a=n.resolve("bulk-create-tasks"),s={project_id:t,sprint_id:e,us_id:i,bulk_tasks:o},r.post(a,s).then(function(t){return t.data})},u.upvote=function(t){var e;return e=n.resolve("task-upvote",t),r.post(e)},u.downvote=function(t){var e;return e=n.resolve("task-downvote",t),r.post(e)},u.watch=function(t){var e;return e=n.resolve("task-watch",t),r.post(e)},u.unwatch=function(t){var e;return e=n.resolve("task-unwatch",t),r.post(e)},u.bulkUpdateTaskTaskboardOrder=function(t,e){var i,o;return o=n.resolve("bulk-update-task-taskboard-order"),i={project_id:t,bulk_tasks:e},r.post(o,i)},u.listValues=function(t,r){var n;return n={project:t},e.queryMany(r,n)},u.storeQueryParams=function(e,r){var n,s;return s=e+":"+o,n=t([e,s]),i.set(n,r)},u.getQueryParams=function(e){var r,n;return n=e+":"+o,r=t([e,n]),i.get(r)||{}},u.storeStatusColumnModes=function(e,r){var n,o;return o=e+":"+s,n=t([e,o]),i.set(n,r)},u.getStatusColumnModes=function(e){var r,n;return n=e+":"+s,r=t([e,n]),i.get(r)||{}},u.storeUsRowModes=function(e,r,n){var o,s;return s=e+":"+a,o=t([e,r,s]),i.set(o,n)},u.getUsRowModes=function(e,r){var n,o;return o=e+":"+a,n=t([e,r,o]),i.get(n)||{}},function(t){return t.tasks=u}},e=angular.module("taigaResources"),e.factory("$tgTasksResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage",r])}.call(this),function(){var t,e,r,n;n=this.taiga,r=this.taiga.sizeFormat,e=function(t,e,n,i,o){var s;return s={},s.changeAvatar=function(e){var s,a,u,c,l,p;return u=t.get("maxUploadFileSize",null),u&&e.size>u?(l={status:413,data:{_error_message:"'"+e.name+"' ("+r(e.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+r(u)+")"}},a=o.defer(),a.reject(l),a.promise):(s=new FormData,s.append("avatar",e),c={transformRequest:angular.identity,headers:{"Content-Type":void 0}},p=i.resolve("users")+"/change_avatar",n.post(p,s,{},c))},s.removeAvatar=function(){var t;return t=i.resolve("users")+"/remove_avatar",n.post(t)},s.changePassword=function(t,e){var r,o;return o=i.resolve("users")+"/change_password",r={current_password:t,password:e},n.post(o,r)},function(t){return t.userSettings=s}},t=angular.module("taigaResources"),t.factory("$tgUserSettingsResourcesProvider",["$tgConfig","$tgRepo","$tgHttp","$tgUrls","$q",e])}.call(this),function(){var t,e,r,n;n=this.taiga,r=this.taiga.sizeFormat,e=function(t,e){var r;return r={},r.contacts=function(r,n){var i,o;return null==n&&(n={}),o=e.resolve("user-contacts",r),i={headers:{}},n.enablePagination||(i.headers["x-disable-pagination"]="1"),t.get(o,{},i).then(function(t){return t.data})},function(t){return t.users=r}},t=angular.module("taigaResources"),t.factory("$tgUsersResourcesProvider",["$tgHttp","$tgUrls","$q",e])}.call(this),function(){var t,e,r,n;n=this.taiga,t=n.generateHash,r=function(e,r,n,i){var o,s;return s={},o="userstories-queryparams",s.get=function(t,r){var n;return n=s.getQueryParams(t),n.project=t,e.queryOne("userstories",r,n)},s.getByRef=function(t,r){var n;return n=s.getQueryParams(t),n.project=t,n.ref=r,e.queryOne("userstories","by_ref",n)},s.listInAllProjects=function(t){return e.queryMany("userstories",t)},s.filtersData=function(t){return e.queryOneRaw("userstories-filters",null,t)},s.listUnassigned=function(t,r,n){var i;return i={project:t,milestone:"null"},i=_.extend({},i,r||{}),s.storeQueryParams(t,i),e.queryMany("userstories",_.extend(i,{page_size:n}),{enablePagination:!0},!0)},s.listAll=function(t,r){var n;return n={project:t},n=_.extend({},n,r||{}),s.storeQueryParams(t,n),e.queryMany("userstories",n)},s.bulkCreate=function(t,e,i){var o,s;return o={project_id:t,status_id:e,bulk_stories:i},s=n.resolve("bulk-create-us"),r.post(s,o)},s.upvote=function(t){var e;return e=n.resolve("userstory-upvote",t),r.post(e)},s.downvote=function(t){var e;return e=n.resolve("userstory-downvote",t),r.post(e)},s.watch=function(t){var e;return e=n.resolve("userstory-watch",t),
r.post(e)},s.unwatch=function(t){var e;return e=n.resolve("userstory-unwatch",t),r.post(e)},s.bulkUpdateBacklogOrder=function(t,e){var i,o;return o=n.resolve("bulk-update-us-backlog-order"),i={project_id:t,bulk_stories:e},r.post(o,i)},s.bulkUpdateSprintOrder=function(t,e){var i,o;return o=n.resolve("bulk-update-us-sprint-order"),i={project_id:t,bulk_stories:e},r.post(o,i)},s.bulkUpdateKanbanOrder=function(t,e){var i,o;return o=n.resolve("bulk-update-us-kanban-order"),i={project_id:t,bulk_stories:e},r.post(o,i)},s.listValues=function(t,r){var n;return n={project:t},s.storeQueryParams(t,n),e.queryMany(r,n)},s.storeQueryParams=function(e,r){var n,s;return s=e+":"+o,n=t([e,s]),i.set(n,r)},s.getQueryParams=function(e){var r,n;return n=e+":"+o,r=t([e,n]),i.get(r)||{}},s.storeShowTags=function(e,r){var n;return n=t([e,"showTags"]),i.set(n,r)},s.getShowTags=function(e){var r;return r=t([e,"showTags"]),i.get(r)||null},function(t){return t.userstories=s}},e=angular.module("taigaResources"),e.factory("$tgUserstoriesResourcesProvider",["$tgRepo","$tgHttp","$tgUrls","$tgStorage",r])}.call(this),function(){var t,e;e=function(t,e,r){var n;return n={},n.list=function(e){var r;return r={webhook:e},t.queryMany("webhooklogs",r)},n.resend=function(t){var n;return n=e.resolve("webhooklogs-resend",t),r.post(n)},function(t){return t.webhooklogs=n}},t=angular.module("taigaResources"),t.factory("$tgWebhookLogsResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",e])}.call(this),function(){var t,e;e=function(t,e,r){var n;return n={},n.list=function(e){var r;return r={project:e},t.queryMany("webhooks",r)},n.test=function(t){var n;return n=e.resolve("webhooks-test",t),r.post(n)},function(t){return t.webhooks=n}},t=angular.module("taigaResources"),t.factory("$tgWebhooksResourcesProvider",["$tgRepo","$tgUrls","$tgHttp",e])}.call(this),function(){var t,e,r;r=this.taiga,e=function(t,e,r){var n;return n={},n.get=function(e){return t.queryOne("wiki",e)},n.getBySlug=function(e,r){return t.queryOne("wiki","by_slug?project="+e+"&slug="+r)},n.listLinks=function(e){return t.queryMany("wiki-links",{project:e})},function(t){return t.wiki=n}},t=angular.module("taigaResources"),t.factory("$tgWikiResourcesProvider",["$tgRepo","$tgHttp","$tgUrls",e])}.call(this),function(){var t,e,r,n,i,o,s=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=this.taiga,n=this.taiga.mixOf,r=this.taiga.debounce,i=angular.module("taigaUserSettings"),t=function(t){function e(t,e,r,n,i,o,s,a,u,c,l){this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=u,this.auth=c,this.translate=l,this.scope.sectionName=this.translate.instant("CHANGE_PASSWORD.SECTION_NAME"),this.scope.user=this.auth.getUser()}return s(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","$translate"],e}(n(o.Controller,o.PageMixin)),i.controller("UserChangePasswordController",t),e=function(t,e,n,i){var o;return o=function(o,s,a,u){var c,l,p;return c=new checksley.Form(s.find("form")),l=r(2e3,function(r){return function(r){var s,a;return r.preventDefault(),c.validate()?o.newPassword1!==o.newPassword2?void e.notify("error",i.instant("CHANGE_PASSWORD.ERROR_PASSWORD_MATCH")):(s=n().target(p).start(),a=t.userSettings.changePassword(o.currentPassword,o.newPassword1),a.then(function(){return s.finish(),e.notify("success")}),a.then(null,function(t){return s.finish(),e.notify("error",t.data._error_message)})):void 0}}(this)),p=s.find(".submit-button"),s.on("submit","form",l),o.$on("$destroy",function(){return s.off()})},{link:o}},i.directive("tgUserChangePassword",["$tgResources","$tgConfirm","$tgLoading","$translate",e])}.call(this),function(){var t,e,r,n,i;i=this.taiga,e=this.taiga.bindOnce,r=this.taiga.debounce,n=angular.module("taigaUserSettings"),t=function(t,e,n,i,o,s,a){var u;return u=function(e,u,c){var l,p;return e.$on("deletelightbox:new",function(t,e){return s.open(u)}),e.$on("$destroy",function(){return u.off()}),l=function(){var r,c;return r=a().target(p).start(),c=t.remove(e.user),c.then(function(t){return r.finish(),s.close(u),n.logout(),i.path(o.resolve("login"))}),c.then(null,function(){return r.finish(),console.log("FAIL")})},u.on("click",".button-green",function(t){return t.preventDefault(),s.close(u)}),u.on("click",".button-red",r(2e3,function(t){return t.preventDefault(),l()})),p=u.find(".button-red")},{link:u,templateUrl:"user/lightbox/lightbox-delete-account.html"}},n.directive("tgLbDeleteUser",["$tgRepo","$rootScope","$tgAuth","$tgLocation","$tgNavUrls","lightboxService","$tgLoading",t])}.call(this),function(){var t,e,r,n,i,o,s,a,u,c=function(t,e){function r(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},l={}.hasOwnProperty;u=this.taiga,o=this.taiga.mixOf,a=this.taiga.sizeFormat,s=angular.module("taigaUserSettings"),i=this.taiga.debounce,n=function(t){function e(t,e,r,n,i,o,s,u,c,l,p,d){var f,h,m;this.scope=t,this.rootscope=e,this.config=r,this.repo=n,this.confirm=i,this.rs=o,this.params=s,this.q=u,this.location=c,this.navUrls=l,this.auth=p,this.translate=d,this.scope.sectionName="USER_SETTINGS.MENU.SECTION_TITLE",this.scope.project={},this.scope.user=this.auth.getUser(),this.scope.user||(this.location.path(this.navUrls.resolve("permission-denied")),this.location.replace()),this.scope.lang=this.getLan(),this.scope.theme=this.getTheme(),f=this.config.get("maxUploadFileSize",null),f&&(m=this.translate.instant("USER_SETTINGS.AVATAR_MAX_SIZE",{maxFileSize:a(f)}),this.scope.maxFileSizeMsg=m),h=this.loadInitialData(),h.then(null,this.onInitialDataError.bind(this))}return c(e,t),e.$inject=["$scope","$rootScope","$tgConfig","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth","$translate"],e.prototype.loadInitialData=function(){return this.scope.availableThemes=this.config.get("themes",[]),this.rs.locales.list().then(function(t){return function(e){return t.scope.locales=e,e}}(this))},e.prototype.openDeleteLightbox=function(){return this.rootscope.$broadcast("deletelightbox:new",this.scope.user)},e.prototype.getLan=function(){return this.scope.user.lang||this.translate.preferredLanguage()},e.prototype.getTheme=function(){return this.scope.user.theme||this.config.get("defaultTheme")||"taiga"},e}(o(u.Controller,u.PageMixin)),s.controller("UserSettingsController",n),r=function(t,e,r,n){var o;return o=function(o,s,a){var u;return u=i(2e3,function(i){return function(i){var a,u,c,l;return i.preventDefault(),u=s.find("form").checksley(),u.validate()?(a=o.user.isAttributeModified("email"),o.user.lang=o.lang,o.user.theme=o.theme,l=function(r){var i;return e.setUser(r),a?(i=n.instant("USER_PROFILE.CHANGE_EMAIL_SUCCESS"),t.success(i)):t.notify("success")},c=function(e){return u.setErrors(e),t.notify("error",e._error_message)},r.save(o.user).then(l,c)):void 0}}(this)),s.on("submit","form",u),o.$on("$destroy",function(){return s.off()})},{link:o}},s.directive("tgUserProfile",["$tgConfirm","$tgAuth","$tgRepo","$translate",r]),e=function(t,e,r,n){var i;return i=function(i,o,s){var a,u,c;return c=function(){return o.find(".size-info").removeClass("hidden")},u=function(r){var s;return s=e.make_model("users",r.data),t.setUser(s),i.user=s,o.find(".loading-overlay").removeClass("active"),n.notify("success")},a=function(t){return 413===t.status&&c(),o.find(".loading-overlay").removeClass("active"),n.notify("error",t.data._error_message)},o.on("click",".js-change-avatar",function(){return o.find("#avatar-field").click()}),o.on("change","#avatar-field",function(t){return i.avatarAttachment?(o.find(".loading-overlay").addClass("active"),r.userSettings.changeAvatar(i.avatarAttachment).then(u,a)):void 0}),o.on("click","a.js-use-gravatar",function(t){return o.find(".loading-overlay").addClass("active"),r.userSettings.removeAvatar().then(u,a)}),i.$on("$destroy",function(){return o.off()})},{link:i}},s.directive("tgUserAvatar",["$tgAuth","$tgModel","$tgResources","$tgConfirm",e]),t=function(t){var e;return e=function(e,r,n){var i,o;return i=t(n.tgAvatarModel),o=i.assign,r.bind("change",function(){return e.$apply(function(){return o(e,r[0].files[0])})})},{link:e}},s.directive("tgAvatarModel",["$parse",t])}.call(this),function(){var t,e;t=function(){var t;return t=function(t,e,r){var n;return n=r.tgUserSettingsNavigation,e.find(".active").removeClass("active"),e.find("#usersettingsmenu-"+n+" a").addClass("active"),t.$on("$destroy",function(){return e.off()})},{link:t}},e=angular.module("taigaUserSettings"),e.directive("tgUserSettingsNavigation",t)}.call(this),function(){var t,e,r,n,i,o,s,a=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;s=this.taiga,i=this.taiga.mixOf,n=this.taiga.bindOnce,o=angular.module("taigaUserSettings"),t=function(t){function e(t,e,r,n,i,o,s,a,u,c){var l;this.scope=t,this.rootscope=e,this.repo=r,this.confirm=n,this.rs=i,this.params=o,this.q=s,this.location=a,this.navUrls=u,this.auth=c,this.scope.sectionName="USER_SETTINGS.NOTIFICATIONS.SECTION_NAME",this.scope.user=this.auth.getUser(),l=this.loadInitialData(),l.then(null,this.onInitialDataError.bind(this))}return a(e,t),e.$inject=["$scope","$rootScope","$tgRepo","$tgConfirm","$tgResources","$routeParams","$q","$tgLocation","$tgNavUrls","$tgAuth"],e.prototype.loadInitialData=function(){return this.rs.notifyPolicies.list().then(function(t){return function(e){return t.scope.notifyPolicies=e,e}}(this))},e}(i(s.Controller,s.PageMixin)),o.controller("UserNotificationsController",t),e=function(){var t;return t=function(t,e,r){return t.$on("$destroy",function(){return e.off()})},{link:t}},o.directive("tgUserNotifications",e),r=function(t,e,r){var i,o;return o=_.template('<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\n<div class="policy-table-row" data-index="<%- index %>">\n  <div class="policy-table-project"><span><%- notifyPolicy.project_name %></span></div>\n  <div class="policy-table-all">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-all-<%- notifyPolicy.id %>"\n             value="2" <% if (notifyPolicy.notify_level == 2) { %>checked="checked"<% } %>/>\n      <label for="policy-all-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_ALL"></label>\n    </fieldset>\n  </div>\n  <div class="policy-table-involved">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-involved-<%- notifyPolicy.id %>"\n             value="1" <% if (notifyPolicy.notify_level == 1) { %>checked="checked"<% } %> />\n      <label for="policy-involved-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED"></label>\n    </fieldset>\n  </div>\n  <div class="policy-table-none">\n    <fieldset>\n      <input type="radio"\n             name="policy-<%- notifyPolicy.id %>" id="policy-none-<%- notifyPolicy.id %>"\n             value="3" <% if (notifyPolicy.notify_level == 3) { %>checked="checked"<% } %> />\n      <label for="policy-none-<%- notifyPolicy.id %>"\n             translate="USER_SETTINGS.NOTIFICATIONS.OPTION_NONE"></label>\n    </fieldset>\n  </div>\n</div>\n<% }) %>'),i=function(i,s,a){var u;return u=function(){var n,a;return s.off(),n={notifyPolicies:i.notifyPolicies},a=o(n),s.html(r(a)(i)),s.on("change","input[type=radio]",function(r){var n,o,s,a,u,c;return c=angular.element(r.currentTarget),a=c.parents(".policy-table-row").data("index"),s=i.notifyPolicies[a],u=s.notify_level,s.notify_level=parseInt(c.val(),10),o=function(){return e.notify("success")},n=function(){return e.notify("error"),c.parents(".policy-table-row").find("input[value="+u+"]").prop("checked",!0)},t.save(s).then(o,n)})},i.$on("$destroy",function(){return s.off()}),n(i,a.ngModel,u)},{link:i}},o.directive("tgUserNotificationsList",["$tgRepo","$tgConfirm","$compile",r])}.call(this),function(){angular.module("taigaComponents",[])}.call(this),function(){var t;t=angular.module("taigaDiscover",[])}.call(this),function(){var t;t=angular.module("taigaExternalApps",[])}.call(this),function(){var t;t=angular.module("taigaHome",[])}.call(this),function(){angular.module("taigaNavigationBar",[])}.call(this),function(){var t;t=angular.module("taigaProfile",[])}.call(this),function(){angular.module("taigaProjects",[])}.call(this),function(){angular.module("taigaResources2",[])}.call(this),function(){angular.module("taigaUserTimeline",[])}.call(this),function(){var t;t=function(t,e){var r;return r=function(r,n,i){var o;return o=t(i.tgAttachmentLink)(r),n.on("click",function(t){return taiga.isImage(o.getIn(["file","name"]))?(t.preventDefault(),r.$apply(function(){return e.create("tg-lb-attachment-preview",{"class":"lightbox lightbox-block"},{file:o.get("file")})})):void 0}),r.$on("$destroy",function(){return n.off()})},{link:r}},t.$inject=["$parse","tgLightboxFactory"],angular.module("taigaComponents").directive("tgAttachmentLink",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r,n){},{scope:{},bindToController:{attachment:"=",onDelete:"&",onUpdate:"&",type:"="},controller:"Attachment",controllerAs:"vm",templateUrl:"components/attachment/attachment-gallery.html",link:t}},t.$inject=[],angular.module("taigaComponents").directive("tgAttachmentGallery",t)}.call(this),function(){var t;t=function(){function t(t,e){this.attachmentsService=t,this.translate=e,this.form={},this.form.description=this.attachment.getIn(["file","description"]),this.form.is_deprecated=this.attachment.get(["file","is_deprecated"]),this.title=this.translate.instant("ATTACHMENT.TITLE",{fileName:this.attachment.get("name"),date:moment(this.attachment.get("created_date")).format(this.translate.instant("ATTACHMENT.DATE"))})}return t.$inject=["tgAttachmentsService","$translate"],t.prototype.editMode=function(t){var e;return e=this.attachment.set("editable",t),this.onUpdate({attachment:e})},t.prototype["delete"]=function(){return this.onDelete({attachment:this.attachment})},t.prototype.save=function(){var t;return t=this.attachment.set("loading",!0),this.onUpdate({attachment:t}),t=this.attachment.merge({editable:!1,loading:!1}),t=t.mergeIn(["file"],{description:this.form.description,is_deprecated:!!this.form.is_deprecated}),this.onUpdate({attachment:t})},t}(),angular.module("taigaComponents").controller("Attachment",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r,n){},{scope:{},bindToController:{attachment:"=",onDelete:"&",onUpdate:"&",type:"="},controller:"Attachment",controllerAs:"vm",templateUrl:"components/attachment/attachment.html",link:t}},t.$inject=[],angular.module("taigaComponents").directive("tgAttachment",t)}.call(this),function(){var t;t=function(t){var e;return e=function(e,r,n){var i;return i=t(n.tgAttachmentsDrop),r.on("dragover",function(t){return t.preventDefault(),!1}),r.on("drop",function(t){var r;return t.stopPropagation(),t.preventDefault(),r=t.dataTransfer||t.originalEvent&&t.originalEvent.dataTransfer,e.$apply(function(){return i(e,{files:r.files})})}),e.$on("$destroy",function(){return r.off()})},{link:e}},t.$inject=["$parse"],angular.module("taigaComponents").directive("tgAttachmentsDrop",t)}.call(this),function(){var t,e;e=this.taiga.sizeFormat,t=function(){function t(t,r,n,i,o,s){this.translate=t,this.confirm=r,this.config=n,this.storage=i,this.attachmentsFullService=o,this.projectService=s,this.mode=this.storage.get("attachment-mode","list"),this.maxFileSize=this.config.get("maxUploadFileSize",null),this.maxFileSize&&(this.maxFileSize=e(this.maxFileSize)),this.maxFileSizeMsg=this.maxFileSize?this.translate.instant("ATTACHMENT.MAX_UPLOAD_SIZE",{maxFileSize:this.maxFileSize}):"",taiga.defineImmutableProperty(this,"attachments",function(t){return function(){return t.attachmentsFullService.attachments}}(this)),taiga.defineImmutableProperty(this,"deprecatedsCount",function(t){return function(){return t.attachmentsFullService.deprecatedsCount}}(this)),taiga.defineImmutableProperty(this,"attachmentsVisible",function(t){return function(){return t.attachmentsFullService.attachmentsVisible}}(this)),taiga.defineImmutableProperty(this,"deprecatedsVisible",function(t){return function(){return t.attachmentsFullService.deprecatedsVisible}}(this))}return t.$inject=["$translate","$tgConfirm","$tgConfig","$tgStorage","tgAttachmentsFullService","tgProjectService"],t.prototype.uploadingAttachments=function(){return this.attachmentsFullService.uploadingAttachments},t.prototype.addAttachment=function(t){var e;return e="list"===this.mode,this.attachmentsFullService.addAttachment(this.projectId,this.objId,this.type,t,e)},t.prototype.setMode=function(t){return this.mode=t,this.storage.set("attachment-mode",t)},t.prototype.toggleDeprecatedsVisible=function(){return this.attachmentsFullService.toggleDeprecatedsVisible()},t.prototype.addAttachments=function(t){return _.forEach(t,function(t){return function(e){return t.addAttachment(e)}}(this))},t.prototype.loadAttachments=function(){return this.attachmentsFullService.loadAttachments(this.type,this.objId,this.projectId)},t.prototype.deleteAttachment=function(t){var e,r;return r=this.translate.instant("ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT"),e=this.translate.instant("ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT",{fileName:t.getIn(["file","name"])}),this.confirm.askOnDelete(r,e).then(function(r){return function(n){var i,o;return i=function(){return e=r.translate.instant("ATTACHMENT.ERROR_DELETE_ATTACHMENT",{errorMessage:e}),r.confirm.notify("error",null,e),n.finish(!1)},o=function(){return n.finish()},r.attachmentsFullService.deleteAttachment(t,r.type).then(o,i)}}(this))},t.prototype.reorderAttachment=function(t,e){return this.attachmentsFullService.reorderAttachment(this.type,t,e)},t.prototype.updateAttachment=function(t){return this.attachmentsFullService.updateAttachment(t,this.type)},t.prototype._isEditable=function(){return this.projectService.project?this.projectService.hasPermission(this.editPermission):!1},t.prototype.showAttachments=function(){return this._isEditable()||this.attachmentsFullService.attachments.size},t}(),angular.module("taigaComponents").controller("AttachmentsFull",t)}.call(this),function(){var t,e;e=this.taiga.bindOnce,t=function(){var t;return t=function(t,r,n,i){return e(t,"vm.objId",function(t){return i.loadAttachments()})},{scope:{},bindToController:{type:"@",objId:"=",projectId:"=",editPermission:"@"},controller:"AttachmentsFull",controllerAs:"vm",templateUrl:"components/attachments-full/attachments-full.html",link:t}},t.$inject=[],angular.module("taigaComponents").directive("tgAttachmentsFull",t)}.call(this),function(){var t,e=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t,e){this.attachmentsService=t,this.rootScope=e,this._attachments=Immutable.List(),this._deprecatedsCount=0,this._attachmentsVisible=Immutable.List(),this._deprecatedsVisible=!1,this.uploadingAttachments=[],taiga.defineImmutableProperty(this,"attachments",function(t){return function(){return t._attachments}}(this)),taiga.defineImmutableProperty(this,"deprecatedsCount",function(t){return function(){return t._deprecatedsCount}}(this)),taiga.defineImmutableProperty(this,"attachmentsVisible",function(t){return function(){return t._attachmentsVisible}}(this)),taiga.defineImmutableProperty(this,"deprecatedsVisible",function(t){return function(){return t._deprecatedsVisible}}(this))}return e(r,t),r.$inject=["tgAttachmentsService","$rootScope"],r.prototype.toggleDeprecatedsVisible=function(){return this._deprecatedsVisible=!this._deprecatedsVisible,this.regenerate()},r.prototype.regenerate=function(){return this._deprecatedsCount=this._attachments.count(function(t){return t.getIn(["file","is_deprecated"])}),this._deprecatedsVisible?this._attachmentsVisible=this._attachments:this._attachmentsVisible=this._attachments.filter(function(t){return!t.getIn(["file","is_deprecated"])})},r.prototype.addAttachment=function(t,e,r,n,i){return null==i&&(i=!0),new Promise(function(o){return function(s,a){var u;return o.attachmentsService.validate(n)?(o.uploadingAttachments.push(n),u=o.attachmentsService.upload(n,e,t,r),u.then(function(t){var e;return o.uploadingAttachments=o.uploadingAttachments.filter(function(e){return e.name!==t.get("name")}),e=Immutable.Map(),e=e.merge({file:t,editable:i,loading:!1}),o._attachments=o._attachments.push(e),o.regenerate(),o.rootScope.$broadcast("attachment:create"),s(e)})):a(n)}}(this))},r.prototype.loadAttachments=function(t,e,r){return this.attachmentsService.list(t,e,r).then(function(t){return function(e){return t._attachments=e.map(function(t){var e;return e=Immutable.Map(),e.merge({loading:!1,editable:!1,file:t})}),t.regenerate()}}(this))},r.prototype.deleteAttachment=function(t,e){var r;return r=function(e){return function(){return e._attachments=e._attachments.filter(function(e){return e!==t}),e.regenerate()}}(this),this.attachmentsService["delete"](e,t.getIn(["file","id"])).then(r)},r.prototype.reorderAttachment=function(t,e,r){var n,i,o;return i=this.attachments.findIndex(function(t){return t===e}),i!==r?(n=this.attachments.remove(i),n=n.splice(r,0,e),n=n.map(function(t,e){return t.setIn(["file","order"],e+1)}),o=[],n.forEach(function(e){return function(r){var n;return n={order:r.getIn(["file","order"])},o.push(e.attachmentsService.patch(r.getIn(["file","id"]),t,n))}}(this)),Promise.all(o).then(function(t){return function(){return t._attachments=n,t.regenerate()}}(this))):void 0},r.prototype.updateAttachment=function(t,e){var r,n,i;return r=this._attachments.findIndex(function(e){return e.getIn(["file","id"])===t.getIn(["file","id"])}),n=this._attachments.get(r),i=taiga.patch(n.get("file"),t.get("file")),t.get("loading")?(this._attachments=this._attachments.set(r,t),this.regenerate()):this.attachmentsService.patch(t.getIn(["file","id"]),e,i).then(function(e){return function(){return e._attachments=e._attachments.set(r,t),e.regenerate()}}(this))},r}(taiga.Service),angular.module("taigaComponents").service("tgAttachmentsFullService",t)}.call(this),function(){var t;t=function(){function t(t){this.attachmentsService=t}return t.$inject=["tgAttachmentsService"],t.prototype.addAttachment=function(t){var e;return e=Immutable.fromJS({file:t,name:t.name,size:t.size}),this.attachmentsService.validate(t)&&(this.attachments=this.attachments.push(e),this.onAdd)?this.onAdd({attachment:e}):void 0},t.prototype.addAttachments=function(t){return _.forEach(t,this.addAttachment.bind(this))},t.prototype.deleteAttachment=function(t){return this.attachments=this.attachments.filter(function(e){return e!==t}),this.onDelete?this.onDelete({attachment:t}):void 0},t}(),angular.module("taigaComponents").controller("AttachmentsSimple",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r,n){},{scope:{},bindToController:{attachments:"=",onAdd:"&",onDelete:"&"},controller:"AttachmentsSimple",controllerAs:"vm",templateUrl:"components/attachments-simple/attachments-simple.html",link:t}},t.$inject=[],angular.module("taigaComponents").directive("tgAttachmentsSimple",t)}.call(this),function(){var t;t=function(t){var e;return e=function(e,r,n){var i,o,s;return i=t(n.tgAttachmentsSortable),o=dragula([r[0]],{copySortSource:!1,copy:!1,mirrorContainer:r[0],moves:function(t){return $(t).is("div[tg-bind-scope]")}}),o.on("dragend",function(t){var r,n;return t=$(t),r=t.scope().attachment,n=t.index(),e.$apply(function(){return i(e,{attachment:r,index:n})})}),s=autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&o.dragging}}),e.$on("$destroy",function(){return r.off(),o.destroy()})},{link:e}},t.$inject=["$parse"],angular.module("taigaComponents").directive("tgAttachmentsSortable",t)}.call(this),function(){var t;t=function(t){return{link:function(e,r){return t(function(){return r[0].select()})}}},t.$inject=["$timeout"],angular.module("taigaComponents").directive("tgAutoSelect",t)}.call(this),function(){var t;t=function(t){var e;return e=function(e,r,n,i){var o;return o=t(n.tgFileChange),r.on("change",function(t){return e.$apply(function(){return o(e,{files:t.currentTarget.files})})}),e.$on("$destroy",function(){return r.off()})},{require:"ngModel",restrict:"A",link:e}},t.$inject=["$parse"],angular.module("taigaComponents").directive("tgFileChange",t)}.call(this),function(){var t,e;e=this.taiga,t=function(t,e,r,n,i){var o;return o=function(n,o,s,a){var u,c,l;return l=null,c=introJs(),c.oncomplete(function(){return $("html,body").scrollTop(0)}),c.onexit(function(){return e.disableJoyRide()}),u=function(t,e){return e[t.joyride]?(c.setOptions({exitOnEsc:!1,exitOnOverlayClick:!1,showStepNumbers:!1,nextLabel:i.instant("JOYRIDE.NAV.NEXT")+" &rarr;",prevLabel:"&larr; "+i.instant("JOYRIDE.NAV.BACK"),skipLabel:i.instant("JOYRIDE.NAV.SKIP"),doneLabel:i.instant("JOYRIDE.NAV.DONE"),disableInteraction:!0}),c.setOption("steps",r.get(t.joyride)),c.start()):void 0},t.$on("$routeChangeSuccess",function(r,n){return n.joyride&&e.isAuthenticated()?(c.oncomplete(function(){return e.disableJoyRide(n.joyride)}),n.loader?l=t.$on("loader:end",function(){return e.loadJoyRideConfig().then(function(t){return u(n,t)}),l()}):e.loadJoyRideConfig().then(function(t){return u(n,t)})):(c.exit(),void(l&&l()))})},{scope:{},link:o}},t.$inject=["$rootScope","tgCurrentUserService","tgJoyRideService","$location","$translate"],angular.module("taigaComponents").directive("tgJoyRide",t)}.call(this),function(){var t,e=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t,e){this.translate=t,this.checkPermissionsService=e}return e(r,t),r.$inject=["$translate","tgCheckPermissionsService"],r.prototype.getConfig=function(){return{dashboard:function(t){return function(){var e;return e=[{element:".project-list > section:not(.ng-hide)",position:"left",joyride:{title:t.translate.instant("JOYRIDE.DASHBOARD.STEP1.TITLE"),text:t.translate.instant("JOYRIDE.DASHBOARD.STEP1.TEXT")}},{element:".working-on-container",position:"right",joyride:{title:t.translate.instant("JOYRIDE.DASHBOARD.STEP2.TITLE"),text:t.translate.instant("JOYRIDE.DASHBOARD.STEP2.TEXT")}},{element:".watching-container",position:"right",joyride:{title:t.translate.instant("JOYRIDE.DASHBOARD.STEP3.TITLE"),text:[t.translate.instant("JOYRIDE.DASHBOARD.STEP3.TEXT1"),t.translate.instant("JOYRIDE.DASHBOARD.STEP3.TEXT2")]}}],$(".project-list .create-project-button").is(":hidden")||e.push({element:".project-list .create-project-button",position:"bottom",joyride:{title:t.translate.instant("JOYRIDE.DASHBOARD.STEP4.TITLE"),text:[t.translate.instant("JOYRIDE.DASHBOARD.STEP4.TEXT1"),t.translate.instant("JOYRIDE.DASHBOARD.STEP4.TEXT2")]}}),e}}(this),backlog:function(t){return function(){var e;return e=[{element:".summary",position:"bottom",joyride:{title:t.translate.instant("JOYRIDE.BACKLOG.STEP1.TITLE"),text:[t.translate.instant("JOYRIDE.BACKLOG.STEP1.TEXT1"),t.translate.instant("JOYRIDE.BACKLOG.STEP1.TEXT2")]}},{element:".backlog-table-empty",position:"bottom",joyride:{title:t.translate.instant("JOYRIDE.BACKLOG.STEP2.TITLE"),text:t.translate.instant("JOYRIDE.BACKLOG.STEP2.TEXT")}},{element:".sprints",position:"left",joyride:{title:t.translate.instant("JOYRIDE.BACKLOG.STEP3.TITLE"),text:t.translate.instant("JOYRIDE.BACKLOG.STEP3.TEXT")}}],t.checkPermissionsService.check("add_us")&&e.push({element:".new-us",position:"rigth",joyride:{title:t.translate.instant("JOYRIDE.BACKLOG.STEP4.TITLE"),text:t.translate.instant("JOYRIDE.BACKLOG.STEP4.TEXT")}}),e}}(this),kanban:function(t){return function(){var e;return e=[{element:".kanban-table-inner",position:"bottom",joyride:{title:t.translate.instant("JOYRIDE.KANBAN.STEP1.TITLE"),text:t.translate.instant("JOYRIDE.KANBAN.STEP1.TEXT")}},{element:".card-placeholder",position:"right",joyride:{title:t.translate.instant("JOYRIDE.KANBAN.STEP2.TITLE"),text:t.translate.instant("JOYRIDE.KANBAN.STEP2.TEXT")}}],t.checkPermissionsService.check("add_us")&&e.push({element:".icon-plus",position:"bottom",joyride:{title:t.translate.instant("JOYRIDE.KANBAN.STEP3.TITLE"),text:[t.translate.instant("JOYRIDE.KANBAN.STEP3.TEXT1"),t.translate.instant("JOYRIDE.KANBAN.STEP3.TEXT2")]}}),e}}(this)}},r.prototype.get=function(t){var e,r;return r=this.getConfig(),e=r[t].call(this),_.map(e,function(t){var e;return e="",t.joyride.title&&(e+="<h3>"+t.joyride.title+"</h3>"),_.isArray(t.joyride.text)?_.forEach(t.joyride.text,function(t){return e+="<p>"+t+"</p>"}):e+="<p>"+t.joyride.text+"</p>",t.intro=e,t})},r}(taiga.Service),angular.module("taigaComponents").service("tgJoyRideService",t)}.call(this),function(){var t;t=function(t){var e;return e=function(t,e,r){},{restrict:"AE",scope:{},controllerAs:"vm",controller:function(){return this.close=function(){return t.open=!1},Object.defineProperties(this,{open:{get:function(){return t.open}},title:{get:function(){return t.title}},desc:{get:function(){return t.desc}}})},link:e,templateUrl:"components/live-announcement/live-announcement.html"}},t.$inject=["tgLiveAnnouncementService"],angular.module("taigaComponents").directive("tgLiveAnnouncement",t)}.call(this),function(){var t,e=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(){this.open=!1,this.title="",this.desc=""}return e(r,t),r.prototype.show=function(t,e){return this.open=!0,this.title=t,this.desc=e},r}(taiga.Service),angular.module("taigaComponents").service("tgLiveAnnouncementService",t)}.call(this),function(){var t;t=function(t){var e;return e=function(e,r,n){return e.$watch("project",function(e){var n,i;return(e=Immutable.fromJS(e))?(i=e.get("logo_big_url"),i?(r.attr("src",i),r.css("background","")):(n=t.getDefaultProjectLogo(e.get("slug"),e.get("id")),r.attr("src",n.src),r.css("background",n.color))):void 0})},{link:e,scope:{project:"=tgProjectLogoBigSrc"}}},t.$inject=["tgProjectLogoService"],angular.module("taigaComponents").directive("tgProjectLogoBigSrc",t)}.call(this),function(){var t;t=function(t){var e;return e=function(e,r,n){return e.$watch("project",function(e){var n,i;return(e=Immutable.fromJS(e))?(i=e.get("logo_small_url"),i?(r.attr("src",i),r.css("background","")):(n=t.getDefaultProjectLogo(e.get("slug"),e.get("id")),r.attr("src",n.src),r.css("background",n.color))):void 0})},{link:e,scope:{project:"=tgProjectLogoSmallSrc"}}},t.$inject=["tgProjectLogoService"],angular.module("taigaComponents").directive("tgProjectLogoSmallSrc",t)}.call(this),function(){var t;t=function(){function t(t,e){this.projectService=t,this.lightboxFactory=e,this.project=null,this.menu=Immutable.Map()}return t.$inject=["tgProjectService","tgLightboxFactory"],t.prototype.show=function(){return this.project=this.projectService.project,this.active=this._getActiveSection(),this._setVideoConference(),this._setMenuPermissions()},t.prototype.hide=function(){return this.project=null,this.menu={}},t.prototype.search=function(){return this.lightboxFactory.create("tg-search-box",{"class":"lightbox lightbox-search"})},t.prototype._setVideoConference=function(){var t;return t=this._videoConferenceUrl(),t?this.project=this.project.set("videoconferenceUrl",t):void 0},t.prototype._setMenuPermissions=function(){return this.menu=Immutable.Map({backlog:!1,kanban:!1,issues:!1,wiki:!1}),this.project.get("is_backlog_activated")&&-1!==this.project.get("my_permissions").indexOf("view_us")&&(this.menu=this.menu.set("backlog",!0)),
this.project.get("is_kanban_activated")&&-1!==this.project.get("my_permissions").indexOf("view_us")&&(this.menu=this.menu.set("kanban",!0)),this.project.get("is_issues_activated")&&-1!==this.project.get("my_permissions").indexOf("view_issues")&&(this.menu=this.menu.set("issues",!0)),this.project.get("is_wiki_activated")&&-1!==this.project.get("my_permissions").indexOf("view_wiki_pages")?this.menu=this.menu.set("wiki",!0):void 0},t.prototype._getActiveSection=function(){var t,e,r,n,i;return n=this.projectService.section,i=this.projectService.sectionsBreadcrumb,t=i.lastIndexOf("backlog"),e=i.lastIndexOf("kanban"),-1===t&&-1===e||(r=-1===e||t>e?"backlog":"kanban"),"backlog-kanban"===n&&("backlog"===r||"kanban"===r?n=r:this.project.get("is_backlog_activated")&&!this.project.get("is_kanban_activated")?n="backlog":!this.project.get("is_backlog_activated")&&this.project.get("is_kanban_activated")&&(n="kanban")),n},t.prototype._videoConferenceUrl=function(){var t,e;if("appear-in"===this.project.get("videoconferences"))t="https://appear.in/";else if("talky"===this.project.get("videoconferences"))t="https://talky.io/";else{if("jitsi"!==this.project.get("videoconferences"))return"custom"===this.project.get("videoconferences")?this.project.get("videoconferences_extra_data"):"";t="https://meet.jit.si/"}return e=this.project.get("videoconferences_extra_data")?this.project.get("slug")+"-"+taiga.slugify(this.project.get("videoconferences_extra_data")):this.project.get("slug"),"jitsi"===this.project.get("videoconferences")&&(e=e.replace(/-/g,"")),t+e},t}(),angular.module("taigaComponents").controller("ProjectMenu",t)}.call(this),function(){var t,e;e=this.taiga,t=function(t,e){var r;return r=function(e,r,n,i){var o;return o=function(){return t.project?i.show():i.hide()},e.$watch(function(){return t.project},o),e.vm.fixed=!1,$(window).on("scroll",function(){var t;return t=$(window).scrollTop(),t>100&&e.vm.fixed===!1?(e.vm.fixed=!0,e.$digest()):100>t&&e.vm.fixed===!0?(e.vm.fixed=!1,e.$digest()):void 0})},{scope:{},controller:"ProjectMenu",controllerAs:"vm",templateUrl:"components/project-menu/project-menu.html",link:r}},t.$inject=["tgProjectService","tgLightboxFactory"],angular.module("taigaComponents").directive("tgProjectMenu",t)}.call(this),function(){var t;t=function(t){var e;return e=function(e,r,n){return e.privacyPolicyUrl=t.get("privacyPolicyUrl"),e.termsOfServiceUrl=t.get("termsOfServiceUrl")},{restrict:"AE",scope:{},link:e,templateUrl:"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html"}},angular.module("taigaComponents").directive("tgTermsOfServiceAndPrivacyPolicyNotice",["$tgConfig",t])}.call(this),function(){var t;t=function(){function t(t){this.currentUserService=t,this.user=this.currentUserService.getUser(),this.isMouseOver=!1,this.loading=!1}return t.$inject=["tgCurrentUserService"],t.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},t.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},t.prototype.toggleVote=function(){var t;return this.loading=!0,t=this.item.is_voter?this._downvote():this._upvote(),t["finally"](function(t){return function(){return t.loading=!1}}(this)),t},t.prototype._upvote=function(){return this.onUpvote().then(function(t){return function(){return t.showTextWhenMouseIsLeave()}}(this))},t.prototype._downvote=function(){return this.onDownvote()},t}(),angular.module("taigaComponents").controller("VoteButton",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"VoteButton",bindToController:{item:"=",onUpvote:"=",onDownvote:"="},controllerAs:"vm",templateUrl:"components/vote-button/vote-button.html"}},angular.module("taigaComponents").directive("tgVoteButton",t)}.call(this),function(){var t;t=function(){function t(t,e){this.currentUserService=t,this.rootScope=e,this.user=this.currentUserService.getUser(),this.isMouseOver=!1,this.loading=!1}return t.$inject=["tgCurrentUserService","$rootScope"],t.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},t.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},t.prototype.openWatchers=function(){return this.rootScope.$broadcast("watcher:add",this.item)},t.prototype.getPerms=function(){var t,e;return this.item?(t=this.item._name,e={userstories:"modify_us",issues:"modify_issue",tasks:"modify_task"},e[t]):""},t.prototype.toggleWatch=function(){var t;return this.loading=!0,t=this.item.is_watcher?this._unwatch():this._watch(),t["finally"](function(t){return function(){return t.loading=!1}}(this)),t},t.prototype._watch=function(){return this.onWatch().then(function(t){return function(){return t.showTextWhenMouseIsLeave()}}(this))},t.prototype._unwatch=function(){return this.onUnwatch()},t}(),angular.module("taigaComponents").controller("WatchButton",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"WatchButton",bindToController:{item:"=",onWatch:"=",onUnwatch:"="},controllerAs:"vm",templateUrl:function(t,e){return"components/watch-button/watch-button-"+e.environment+".html"}}},angular.module("taigaComponents").directive("tgWatchButton",t)}.call(this),function(){var t;t=function(){function t(t){this.translate=t,this.is_open=!1,this.texts={week:this.translate.instant("DISCOVER.FILTERS.WEEK"),month:this.translate.instant("DISCOVER.FILTERS.MONTH"),year:this.translate.instant("DISCOVER.FILTERS.YEAR"),all:this.translate.instant("DISCOVER.FILTERS.ALL_TIME")}}return t.$inject=["$translate"],t.prototype.currentText=function(){return this.texts[this.currentOrderBy]},t.prototype.open=function(){return this.is_open=!0},t.prototype.close=function(){return this.is_open=!1},t.prototype.orderBy=function(t){return this.currentOrderBy=t,this.is_open=!1,this.onChange({orderBy:this.currentOrderBy})},t}(),angular.module("taigaDiscover").controller("DiscoverHomeOrderBy",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r){},{controller:"DiscoverHomeOrderBy",controllerAs:"vm",bindToController:!0,templateUrl:"discover/components/discover-home-order-by/discover-home-order-by.html",scope:{currentOrderBy:"=orderBy",onChange:"&"},link:t}},t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverHomeOrderBy",t)}.call(this),function(){var t;t=function(){function t(t){this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"projects",function(t){return function(){return t.discoverProjectsService.projectsCount}}(this)),this.discoverProjectsService.fetchStats()}return t.$inject=["tgDiscoverProjectsService"],t.prototype.selectFilter=function(t){return this.onChange({filter:t,q:this.q})},t.prototype.submitFilter=function(){return this.onChange({filter:this.filter,q:this.q})},t}(),angular.module("taigaDiscover").controller("DiscoverSearchBar",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r,n){},{controller:"DiscoverSearchBar",controllerAs:"vm",templateUrl:"discover/components/discover-search-bar/discover-search-bar.html",bindToController:!0,scope:{q:"=",filter:"=",onChange:"&"},link:t}},t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearchBar",t)}.call(this),function(){var t;t=function(){function t(){this.like_is_open=0===this.orderBy.indexOf("-total_fans"),this.activity_is_open=0===this.orderBy.indexOf("-total_activity")}return t.$inject=[],t.prototype.openLike=function(){return this.like_is_open=!0,this.activity_is_open=!1,this.setOrderBy("-total_fans_last_week")},t.prototype.openActivity=function(){return this.activity_is_open=!0,this.like_is_open=!1,this.setOrderBy("-total_activity_last_week")},t.prototype.setOrderBy=function(t){return null==t&&(t=""),t||(this.like_is_open=!1,this.activity_is_open=!1),this.onChange({orderBy:t})},t}(),angular.module("taigaDiscover").controller("DiscoverSearchListHeader",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r){},{controller:"DiscoverSearchListHeader",controllerAs:"vm",bindToController:!0,templateUrl:"discover/components/discover-search-list-header/discover-search-list-header.html",scope:{onChange:"&",orderBy:"="},link:t}},t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearchListHeader",t)}.call(this),function(){var t;t=function(){function t(t){this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"featured",function(t){return function(){return t.discoverProjectsService.featured}}(this)),this.discoverProjectsService.fetchFeatured()}return t.$inject=["tgDiscoverProjectsService"],t}(),angular.module("taigaDiscover").controller("FeaturedProjects",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r){},{controller:"FeaturedProjects",controllerAs:"vm",templateUrl:"discover/components/featured-projects/featured-projects.html",scope:{},link:t}},t.$inject=[],angular.module("taigaDiscover").directive("tgFeaturedProjects",t)}.call(this),function(){var t;t=function(){return{templateUrl:"discover/components/highlighted/highlighted.html",scope:{loading:"=",highlighted:"=",orderBy:"="}}},t.$inject=[],angular.module("taigaDiscover").directive("tgHighlighted",t)}.call(this),function(){var t;t=function(){function t(t){this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"highlighted",function(t){return function(){return t.discoverProjectsService.mostActive}}(this)),this.currentOrderBy="week",this.order_by=this.getOrderBy()}return t.$inject=["tgDiscoverProjectsService"],t.prototype.fetch=function(){return this.loading=!0,this.order_by=this.getOrderBy(),this.discoverProjectsService.fetchMostActive({order_by:this.order_by}).then(function(t){return function(){return t.loading=!1}}(this))},t.prototype.orderBy=function(t){return this.currentOrderBy=t,this.fetch()},t.prototype.getOrderBy=function(t){return"all"===this.currentOrderBy?"-total_activity":"-total_activity_last_"+this.currentOrderBy},t}(),angular.module("taigaDiscover").controller("MostActive",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r,n){return n.fetch()},{controller:"MostActive",controllerAs:"vm",templateUrl:"discover/components/most-active/most-active.html",scope:{},link:t}},t.$inject=[],angular.module("taigaDiscover").directive("tgMostActive",t)}.call(this),function(){var t;t=function(){function t(t){this.discoverProjectsService=t,taiga.defineImmutableProperty(this,"highlighted",function(t){return function(){return t.discoverProjectsService.mostLiked}}(this)),this.currentOrderBy="week",this.order_by=this.getOrderBy()}return t.$inject=["tgDiscoverProjectsService"],t.prototype.fetch=function(){return this.loading=!0,this.order_by=this.getOrderBy(),this.discoverProjectsService.fetchMostLiked({order_by:this.order_by}).then(function(t){return function(){return t.loading=!1}}(this))},t.prototype.orderBy=function(t){return this.currentOrderBy=t,this.fetch()},t.prototype.getOrderBy=function(){return"all"===this.currentOrderBy?"-total_fans":"-total_fans_last_"+this.currentOrderBy},t}(),angular.module("taigaDiscover").controller("MostLiked",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r,n){return n.fetch()},{controller:"MostLiked",controllerAs:"vm",templateUrl:"discover/components/most-liked/most-liked.html",scope:{},link:t}},t.$inject=[],angular.module("taigaDiscover").directive("tgMostLiked",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n){var i,o;this.location=t,this.navUrls=e,this.appMetaService=r,this.translate=n,o=this.translate.instant("DISCOVER.PAGE_TITLE"),i=this.translate.instant("DISCOVER.PAGE_DESCRIPTION"),this.appMetaService.setAll(o,i)}return t.$inject=["$tgLocation","$tgNavUrls","tgAppMetaService","$translate"],t.prototype.onSubmit=function(t){var e;return e=this.navUrls.resolve("discover-search"),this.location.search("text",t).path(e)},t}(),angular.module("taigaDiscover").controller("DiscoverHome",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n,i){var o,s;this.routeParams=t,this.discoverProjectsService=e,this.route=r,this.appMetaService=n,this.translate=i,this.page=1,taiga.defineImmutableProperty(this,"searchResult",function(t){return function(){return t.discoverProjectsService.searchResult}}(this)),taiga.defineImmutableProperty(this,"nextSearchPage",function(t){return function(){return t.discoverProjectsService.nextSearchPage}}(this)),this.q=this.routeParams.text,this.filter=this.routeParams.filter||"all",this.orderBy=this.routeParams.order_by||"",this.loadingGlobal=!1,this.loadingList=!1,this.loadingPagination=!1,s=this.translate.instant("DISCOVER.SEARCH.PAGE_TITLE"),o=this.translate.instant("DISCOVER.SEARCH.PAGE_DESCRIPTION"),this.appMetaService.setAll(s,o)}return t.$inject=["$routeParams","tgDiscoverProjectsService","$route","tgAppMetaService","$translate"],t.prototype.fetch=function(){return this.page=1,this.discoverProjectsService.resetSearchList(),this.search()},t.prototype.fetchByGlobalSearch=function(){return this.loadingGlobal?void 0:(this.loadingGlobal=!0,this.fetch().then(function(t){return function(){return t.loadingGlobal=!1}}(this)))},t.prototype.fetchByOrderBy=function(){return this.loadingList?void 0:(this.loadingList=!0,this.fetch().then(function(t){return function(){return t.loadingList=!1}}(this)))},t.prototype.showMore=function(){return this.loadingPagination?void 0:(this.loadingPagination=!0,this.page++,this.search().then(function(t){return function(){return t.loadingPagination=!1}}(this)))},t.prototype.search=function(){var t,e;return t=this.getFilter(),e={page:this.page,q:this.q,order_by:this.orderBy},_.assign(e,t),this.discoverProjectsService.fetchSearch(e)},t.prototype.getFilter=function(){return"people"===this.filter?{is_looking_for_people:!0}:"scrum"===this.filter?{is_backlog_activated:!0}:"kanban"===this.filter?{is_kanban_activated:!0}:{}},t.prototype.onChangeFilter=function(t,e){return this.filter=t,this.q=e,this.route.updateParams({filter:this.filter,text:this.q}),this.fetchByGlobalSearch()},t.prototype.onChangeOrder=function(t){return this.orderBy=t,this.route.updateParams({order_by:t}),this.fetchByOrderBy()},t}(),angular.module("taigaDiscover").controller("DiscoverSearch",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r,n){return n.fetch()},{controller:"DiscoverSearch",controllerAs:"vm",link:t}},t.$inject=[],angular.module("taigaDiscover").directive("tgDiscoverSearch",t)}.call(this),function(){var t,e,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;e=this.taiga,t=function(t){function n(t,r){this.rs=t,this.projectsService=r,this._mostLiked=Immutable.List(),this._mostActive=Immutable.List(),this._featured=Immutable.List(),this._searchResult=Immutable.List(),this._projectsCount=0,this.decorate=this.projectsService._decorate.bind(this.projectsService),e.defineImmutableProperty(this,"mostLiked",function(t){return function(){return t._mostLiked}}(this)),e.defineImmutableProperty(this,"mostActive",function(t){return function(){return t._mostActive}}(this)),e.defineImmutableProperty(this,"featured",function(t){return function(){return t._featured}}(this)),e.defineImmutableProperty(this,"searchResult",function(t){return function(){return t._searchResult}}(this)),e.defineImmutableProperty(this,"nextSearchPage",function(t){return function(){return t._nextSearchPage}}(this)),e.defineImmutableProperty(this,"projectsCount",function(t){return function(){return t._projectsCount}}(this))}var i;return r(n,t),n.$inject=["tgResources","tgProjectsService"],i={discover_mode:!0},n.prototype.fetchMostLiked=function(t){var e;return e=_.extend({},i,t),this.rs.projects.getProjects(e,!1).then(function(t){return function(e){var r,n;return r=e.data.slice(0,5),n=Immutable.fromJS(r),n=n.map(t.decorate),t._mostLiked=n}}(this))},n.prototype.fetchMostActive=function(t){var e;return e=_.extend({},i,t),this.rs.projects.getProjects(e,!1).then(function(t){return function(e){var r,n;return r=e.data.slice(0,5),n=Immutable.fromJS(r),n=n.map(t.decorate),t._mostActive=n}}(this))},n.prototype.fetchFeatured=function(){var t;return t=_.extend({},i),t.is_featured=!0,this.rs.projects.getProjects(t,!1).then(function(t){return function(e){var r,n;return r=e.data.slice(0,4),n=Immutable.fromJS(r),n=n.map(t.decorate),t._featured=n}}(this))},n.prototype.resetSearchList=function(){return this._searchResult=Immutable.List()},n.prototype.fetchStats=function(){return this.rs.stats.discover().then(function(t){return function(e){return t._projectsCount=e.getIn(["projects","total"])}}(this))},n.prototype.fetchSearch=function(t){var e;return e=_.extend({},i,t),this.rs.projects.getProjects(e).then(function(t){return function(e){var r;return t._nextSearchPage=!!e.headers("X-Pagination-Next"),r=Immutable.fromJS(e.data),r=r.map(t.decorate),t._searchResult=t._searchResult.concat(r)}}(this))},n}(e.Service),angular.module("taigaDiscover").service("tgDiscoverProjectsService",t)}.call(this),function(){var t,e,r=function(t,e){return function(){return t.apply(e,arguments)}},n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=this.taiga,t=function(t){function i(t,n,i,o,s,a,u,c){var l,p;this.routeParams=t,this.externalAppsService=n,this.window=i,this.currentUserService=o,this.location=s,this.navUrls=a,this.xhrError=u,this.loader=c,this.createApplicationToken=r(this.createApplicationToken,this),this._getApplicationToken=r(this._getApplicationToken,this),this._redirect=r(this._redirect,this),this.loader.start(!1),this._applicationId=this.routeParams.application,this._state=this.routeParams.state,this._getApplicationToken(),this._user=this.currentUserService.getUser(),this._application=null,p=encodeURIComponent(this.location.url()),l=this.navUrls.resolve("login"),this.loginWithAnotherUserUrl=l+"?next="+p,e.defineImmutableProperty(this,"user",function(t){return function(){return t._user}}(this)),e.defineImmutableProperty(this,"application",function(t){return function(){return t._application}}(this))}return n(i,t),i.$inject=["$routeParams","tgExternalAppsService","$window","tgCurrentUserService","$location","$tgNavUrls","tgXhrErrorService","tgLoader"],i.prototype._redirect=function(t){var e;return e=t.get("next_url"),this.window.open(e,"_self")},i.prototype._getApplicationToken=function(){return this.externalAppsService.getApplicationToken(this._applicationId,this._state).then(function(t){return function(e){return t._application=e.get("application"),e.get("auth_code")?t._redirect(e):t.loader.pageLoaded()}}(this))["catch"](function(t){return function(e){return t.loader.pageLoaded(),t.xhrError.response(e)}}(this))},i.prototype.cancel=function(){return this.window.history.back()},i.prototype.createApplicationToken=function(){return this.externalAppsService.authorizeApplicationToken(this._applicationId,this._state).then(function(t){return function(e){return t._redirect(e)}}(this))["catch"](function(t){return function(e){return t.xhrError.response(e)}}(this))},i}(e.Controller),angular.module("taigaExternalApps").controller("ExternalApp",t)}.call(this),function(){var t,e=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t){this.rs=t}return e(r,t),r.$inject=["tgResources"],r.prototype.getApplicationToken=function(t,e){return this.rs.externalapps.getApplicationToken(t,e)},r.prototype.authorizeApplicationToken=function(t,e){return this.rs.externalapps.authorizeApplicationToken(t,e)},r}(taiga.Service),angular.module("taigaExternalApps").service("tgExternalAppsService",t)}.call(this),function(){var t,e=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t){this.lightboxFactory=t}return e(r,t),r.$inject=["tgLightboxFactory"],r.prototype.sendFeedback=function(){return this.lightboxFactory.create("tg-lb-feedback",{"class":"lightbox lightbox-feedback lightbox-generic-form"})},r}(taiga.Service),angular.module("taigaFeedback").service("tgFeedbackService",t)}.call(this),function(){var t;t=function(t,e){var r;return r=function(t,r,n,i){return t.vm={},t.vm.duty=t.duty,t.vm.getDutyType=function(){if(t.vm.duty){if("userstories"===t.vm.duty.get("_name"))return e.instant("COMMON.USER_STORY");if("tasks"===t.vm.duty.get("_name"))return e.instant("COMMON.TASK");if("issues"===t.vm.duty.get("_name"))return e.instant("COMMON.ISSUE")}}},{templateUrl:"home/duties/duty.html",scope:{duty:"=tgDuty"},link:r}},t.$inject=["$tgNavUrls","$translate"],angular.module("taigaHome").directive("tgDuty",t)}.call(this),function(){var t;t=function(){function t(t,e,r){this.currentUserService=t,this.location=e,this.navUrls=r,this.currentUserService.getUser()||this.location.path(this.navUrls.resolve("discover"))}return t.$inject=["tgCurrentUserService","$location","$tgNavUrls"],t}(),angular.module("taigaHome").controller("Home",t)}.call(this),function(){var t,e,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;e=this.taiga.groupBy,t=function(t){function n(t,e,r){this.navurls=t,this.rs=e,this.projectsService=r}return r(n,t),n.$inject=["$tgNavUrls","tgResources","tgProjectsService"],n.prototype._attachProjectInfoToWorkInProgress=function(t,e){var r,n,i,o,s;return r=function(t){return function(r,n){var i,o,s;return o=e.get(String(r.get("project"))),i={project:o.get("slug"),ref:r.get("ref")},s=t.navurls.resolve("project-"+n+"-detail",i),r=r.set("url",s),r=r.set("projectName",o.get("name")),r=r.set("blockedProject",o.get("blocked_code")),r=r.set("_name",n)}}(this),i=function(t,n){return t=t.filter(function(t){return e.get(String(t.get("project")))}),t=t.map(function(t){return r(t,n)})},o=t.get("assignedTo"),o.get("userStories")&&(n=i(o.get("userStories"),"userstories"),o=o.set("userStories",n)),o.get("tasks")&&(n=i(o.get("tasks"),"tasks"),o=o.set("tasks",n)),o.get("issues")&&(n=i(o.get("issues"),"issues"),o=o.set("issues",n)),s=t.get("watching"),s.get("userStories")&&(n=i(s.get("userStories"),"userstories"),s=s.set("userStories",n)),s.get("tasks")&&(n=i(s.get("tasks"),"tasks"),s=s.set("tasks",n)),s.get("issues")&&(n=i(s.get("issues"),"issues"),s=s.set("issues",n)),t=t.set("assignedTo",o),t=t.set("watching",s)},n.prototype.getWorkInProgress=function(t){var r,n,i,o,s,a,u,c,l,p,d,f,h;return u=Immutable.Map(),c=this.projectsService.getProjectsByUserId(t).then(function(t){return u=Immutable.fromJS(e(t.toJS(),function(t){return t.id}))}),i=Immutable.Map(),s={status__is_closed:!1,assigned_to:t},a={is_closed:!1,assigned_to:t},o=this.rs.userstories.listInAllProjects(a).then(function(t){return i=i.set("userStories",t)}),n=this.rs.tasks.listInAllProjects(s).then(function(t){return i=i.set("tasks",t)}),r=this.rs.issues.listInAllProjects(s).then(function(t){return i=i.set("issues",t)}),s={status__is_closed:!1,watchers:t},a={is_closed:!1,watchers:t},l=Immutable.Map(),f=this.rs.userstories.listInAllProjects(a).then(function(t){return l=l.set("userStories",t)}),d=this.rs.tasks.listInAllProjects(s).then(function(t){return l=l.set("tasks",t)}),p=this.rs.issues.listInAllProjects(s).then(function(t){return l=l.set("issues",t)}),h=Immutable.Map(),Promise.all([c,o,n,r,f,d,p]).then(function(t){return function(){return h=h.set("assignedTo",i),h=h.set("watching",l),h=t._attachProjectInfoToWorkInProgress(h,u)}}(this))},n}(taiga.Service),angular.module("taigaHome").service("tgHomeService",t)}.call(this),function(){var t;t=function(t,e){var r,n;return n=function(r,n,i,o){return r.vm={},taiga.defineImmutableProperty(r.vm,"projects",function(){return t.projects.get("recents")}),r.vm.newProject=function(){return e.newProject()}},r={templateUrl:"home/projects/home-project-list.html",scope:{},link:n}},t.$inject=["tgCurrentUserService","tgProjectsService"],angular.module("taigaHome").directive("tgHomeProjectList",t)}.call(this),function(){var t;t=function(){function t(t){this.homeService=t,this.assignedTo=Immutable.Map(),this.watching=Immutable.Map()}return t.$inject=["tgHomeService"],t.prototype._setAssignedTo=function(t){var e,r,n;return n=t.get("assignedTo").get("userStories"),r=t.get("assignedTo").get("tasks"),e=t.get("assignedTo").get("issues"),this.assignedTo=n.concat(r).concat(e),this.assignedTo.size>0?this.assignedTo=this.assignedTo.sortBy(function(t){return t.get("modified_date")}).reverse():void 0},t.prototype._setWatching=function(t){var e,r,n;return n=t.get("watching").get("userStories"),r=t.get("watching").get("tasks"),e=t.get("watching").get("issues"),this.watching=n.concat(r).concat(e),this.watching.size>0?this.watching=this.watching.sortBy(function(t){return t.get("modified_date")}).reverse():void 0},t.prototype.getWorkInProgress=function(t){return this.homeService.getWorkInProgress(t).then(function(t){return function(e){return t._setAssignedTo(e),t._setWatching(e)}}(this))},t}(),angular.module("taigaHome").controller("WorkingOn",t)}.call(this),function(){var t;t=function(t,e){var r;return r=function(t,r,n,i){var o,s;return o=e.getUser(),o?(s=o.get("id"),i.getWorkInProgress(s)):void 0},{controller:"WorkingOn",controllerAs:"vm",templateUrl:"home/working-on/working-on.html",scope:{},link:r}},t.$inject=["tgHomeService","tgCurrentUserService"],angular.module("taigaHome").directive("tgWorkingOn",t)}.call(this),function(){var t;t=function(t,e){var r,n;return n=function(r,n,i,o){return r.vm={},taiga.defineImmutableProperty(r.vm,"projects",function(){return t.projects.get("recents")}),r.vm.newProject=function(){return e.newProject()}},r={templateUrl:"navigation-bar/dropdown-project-list/dropdown-project-list.html",scope:{},link:n}},t.$inject=["tgCurrentUserService","tgProjectsService"],angular.module("taigaNavigationBar").directive("tgDropdownProjectList",t)}.call(this),function(){var t;t=function(t,e,r,n,i,o){var s,a;return a=function(s,a,u,c){return s.vm={},s.vm.isFeedbackEnabled=e.get("feedbackEnabled"),taiga.defineImmutableProperty(s.vm,"user",function(){return t.userData}),s.vm.logout=function(){return t.logout(),r.url(n.resolve("discover")),r.search({})},s.vm.sendFeedback=function(){return i.sendFeedback()},s.vm.userSettingsPlugins=_.filter(o.userSettingsPlugins,{userMenu:!0})},s={templateUrl:"navigation-bar/dropdown-user/dropdown-user.html",scope:{},link:a}},t.$inject=["$tgAuth","$tgConfig","$tgLocation","$tgNavUrls","tgFeedbackService","$rootScope"],angular.module("taigaNavigationBar").directive("tgDropdownUser",t)}.call(this),function(){var t;t=function(t,e,r,n,i){var o,s;return s=function(o,s,a,u){return o.vm={},taiga.defineImmutableProperty(o.vm,"projects",function(){return t.projects.get("recents")}),taiga.defineImmutableProperty(o.vm,"isAuthenticated",function(){return t.isAuthenticated()}),taiga.defineImmutableProperty(o.vm,"isEnabledHeader",function(){return e.isEnabledHeader()}),o.vm.publicRegisterEnabled=i.get("publicRegisterEnabled"),o.vm.login=function(){var t;return t=encodeURIComponent(r.url()),r.url(n.resolve("login")),r.search({next:t})},o.vm.register=function(){var t;return t=encodeURIComponent(r.url()),r.url(n.resolve("register")),r.search({next:t})},o.$on("$routeChangeSuccess",function(){return"/"===r.path()?o.vm.active=!0:o.vm.active=!1})},o={templateUrl:"navigation-bar/navigation-bar.html",scope:{},link:s}},t.$inject=["tgCurrentUserService","tgNavigationBarService","$tgLocation","$tgNavUrls","$tgConfig"],angular.module("taigaNavigationBar").directive("tgNavigationBar",t)}.call(this),function(){var t,e=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(){this.disableHeader()}return e(r,t),r.prototype.enableHeader=function(){return this.enabledHeader=!0},r.prototype.disableHeader=function(){return this.enabledHeader=!1},r.prototype.isEnabledHeader=function(){return this.enabledHeader},r}(taiga.Service),angular.module("taigaNavigationBar").service("tgNavigationBarService",t)}.call(this),function(){var t;t=function(){function t(t){this.userService=t,this.loadStats()}return t.$inject=["tgUserService"],t.prototype.loadStats=function(){return this.userService.getStats(this.user.get("id")).then(function(t){return function(e){return t.stats=e}}(this))},t}(),angular.module("taigaProfile").controller("ProfileBar",t)}.call(this),function(){var t;t=function(){return{templateUrl:"profile/profile-bar/profile-bar.html",controller:"ProfileBar",controllerAs:"vm",scope:{user:"=user",isCurrentUser:"=iscurrentuser"},bindToController:!0}},angular.module("taigaProfile").directive("tgProfileBar",t)}.call(this),function(){var t;t=function(){function t(t,e){this.userService=t,this.currentUserService=e,this.currentUser=this.currentUserService.getUser(),this.isCurrentUser=!1,this.currentUser&&this.currentUser.get("id")===this.user.get("id")&&(this.isCurrentUser=!0)}return t.$inject=["tgUserService","tgCurrentUserService"],t.prototype.loadContacts=function(){return this.userService.getContacts(this.user.get("id")).then(function(t){return function(e){return t.contacts=e}}(this))},t}(),angular.module("taigaProfile").controller("ProfileContacts",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r,n){return n.loadContacts()},{templateUrl:"profile/profile-contacts/profile-contacts.html",scope:{user:"="},controllerAs:"vm",controller:"ProfileContacts",link:t,bindToController:!0}},angular.module("taigaProfile").directive("tgProfileContacts",t)}.call(this),function(){var t;t=function(){var t,e;return t=function(t,e,r,n){return t.vm={item:t.item}},e=function(t,e){return"project"===e.itemType?"profile/profile-favs/items/project.html":"profile/profile-favs/items/ticket.html"},{scope:{item:"=tgFavItem"},link:t,templateUrl:e}},angular.module("taigaProfile").directive("tgFavItem",t)}.call(this),function(){var t,e,r,n,i,o=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;i=this.taiga.debounceLeading,t=function(){function t(){this._init()}return t.prototype._init=function(){return this.enableFilterByAll=!0,this.enableFilterByProjects=!0,this.enableFilterByUserStories=!0,this.enableFilterByTasks=!0,this.enableFilterByIssues=!0,this.enableFilterByTextQuery=!0,this._resetList(),this.q=null,this.type=null},t.prototype._resetList=function(){return this.items=Immutable.List(),this.scrollDisabled=!1,this._page=1},t.prototype._enableLoadingSpinner=function(){return this.isLoading=!0},t.prototype._disableLoadingSpinner=function(){return this.isLoading=!1},t.prototype._enableScroll=function(){return this.scrollDisabled=!1},t.prototype._disableScroll=function(){return this.scrollDisabled=!0},t.prototype._checkIfHasMorePages=function(t){return t?(this._page+=1,this._enableScroll()):this._disableScroll()},t.prototype._checkIfHasNoResults=function(){return this.hasNoResults=0===this.items.size},t.prototype.loadItems=function(){return this._enableLoadingSpinner(),this._disableScroll(),this._getItems(this.user.get("id"),this._page,this.type,this.q).then(function(t){return function(e){return t.items=t.items.concat(e.get("data")),t._checkIfHasMorePages(e.get("next")),t._checkIfHasNoResults(),t._disableLoadingSpinner(),t.items}}(this))["catch"](function(t){return function(){return t._disableLoadingSpinner(),t.items}}(this))},t.prototype.filterByTextQuery=i(500,function(){return this._resetList(),this.loadItems()}),t.prototype.showAll=function(){return null!==this.type?(this.type=null,this._resetList(),this.loadItems()):void 0},t.prototype.showProjectsOnly=function(){
return"project"!==this.type?(this.type="project",this._resetList(),this.loadItems()):void 0},t.prototype.showUserStoriesOnly=function(){return"userstory"!==this.type?(this.type="userstory",this._resetList(),this.loadItems()):void 0},t.prototype.showTasksOnly=function(){return"task"!==this.type?(this.type="task",this._resetList(),this.loadItems()):void 0},t.prototype.showIssuesOnly=function(){return"issue"!==this.type?(this.type="issue",this._resetList(),this.loadItems()):void 0},t}(),e=function(t){function e(t){this.userService=t,e.__super__.constructor.call(this),this.enableFilterByAll=!1,this.enableFilterByProjects=!1,this.enableFilterByUserStories=!1,this.enableFilterByTasks=!1,this.enableFilterByIssues=!1,this.enableFilterByTextQuery=!0,this._getItems=this.userService.getLiked}return o(e,t),e.$inject=["tgUserService"],e}(t),angular.module("taigaProfile").controller("ProfileLiked",e),r=function(t){function e(t){this.userService=t,e.__super__.constructor.call(this),this.enableFilterByAll=!0,this.enableFilterByProjects=!1,this.enableFilterByUserStories=!0,this.enableFilterByTasks=!0,this.enableFilterByIssues=!0,this.enableFilterByTextQuery=!0,this._getItems=this.userService.getVoted}return o(e,t),e.$inject=["tgUserService"],e}(t),angular.module("taigaProfile").controller("ProfileVoted",r),n=function(t){function e(t){this.userService=t,e.__super__.constructor.call(this),this._getItems=this.userService.getWatched}return o(e,t),e.$inject=["tgUserService"],e}(t),angular.module("taigaProfile").controller("ProfileWatched",n)}.call(this),function(){var t,e,r,n;n={scope:{},bindToController:{user:"=",type:"@",q:"@",scrollDisabled:"@",isLoading:"@",hasNoResults:"@"},controller:null,controllerAs:"vm",templateUrl:"profile/profile-favs/profile-favs.html"},t=function(){return _.extend({},n,{controller:"ProfileLiked"})},angular.module("taigaProfile").directive("tgProfileLiked",t),e=function(){return _.extend({},n,{controller:"ProfileVoted"})},angular.module("taigaProfile").directive("tgProfileVoted",e),r=function(){return _.extend({},n,{controller:"ProfileWatched"})},angular.module("taigaProfile").directive("tgProfileWatched",r)}.call(this),function(){var t;t=function(){function t(t){var e;this.translate=t,e=Math.floor(Math.random()*this.HINTS.length)+1,this.hint=this.HINTS[e-1],this.hint.linkText=this.hint.linkText||"HINTS.LINK",this.hint.title=this.translate.instant("HINTS.HINT"+e+"_TITLE"),this.hint.text=this.translate.instant("HINTS.HINT"+e+"_TEXT")}return t.prototype.HINTS=[{url:"https://tree.taiga.io/support/admin/import-export-projects/"},{url:"https://tree.taiga.io/support/admin/custom-fields/"},{},{}],t}(),t.$inject=["$translate"],angular.module("taigaProfile").controller("ProfileHints",t)}.call(this),function(){var t;t=function(t){return{scope:{},controller:"ProfileHints",controllerAs:"vm",templateUrl:"profile/profile-hints/profile-hints.html"}},t.$inject=["$translate"],angular.module("taigaProfile").directive("tgProfileHints",t)}.call(this),function(){var t;t=function(){function t(t,e){this.projectsService=t,this.userService=e}return t.$inject=["tgProjectsService","tgUserService"],t.prototype.loadProjects=function(){return this.projectsService.getProjectsByUserId(this.user.get("id")).then(function(t){return function(e){return t.userService.attachUserContactsToProjects(t.user.get("id"),e)}}(this)).then(function(t){return function(e){return t.projects=e}}(this))},t}(),angular.module("taigaProfile").controller("ProfileProjects",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r,n){return n.loadProjects()},{templateUrl:"profile/profile-projects/profile-projects.html",scope:{user:"="},link:t,bindToController:!0,controllerAs:"vm",controller:"ProfileProjects"}},angular.module("taigaProfile").directive("tgProfileProjects",t)}.call(this),function(){var t;t=function(){var t;return t=function(t,e,r,n,i){return t.tab={},r.$observe("tgProfileTab",function(e){return t.tab.name=e}),r.$observe("tabTitle",function(e){return t.tab.title=e}),t.tab.icon=r.tabIcon,t.tab.active=!!r.tabActive,t.$eval(r.tabDisabled)!==!0?n.addTab(t.tab):void 0},{templateUrl:"profile/profile-tab/profile-tab.html",scope:{},require:"^tgProfileTabs",link:t,transclude:!0}},angular.module("taigaProfile").directive("tgProfileTab",t)}.call(this),function(){var t;t=function(){function t(){this.tabs=[]}return t.prototype.addTab=function(t){return this.tabs.push(t)},t.prototype.toggleTab=function(t){return _.map(this.tabs,function(t){return t.active=!1}),t.active=!0},t}(),angular.module("taigaProfile").controller("ProfileTabs",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"ProfileTabs",controllerAs:"vm",templateUrl:"profile/profile-tabs/profile-tabs.html",transclude:!0}},angular.module("taigaProfile").directive("tgProfileTabs",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n,i,o){this.appMetaService=t,this.currentUserService=e,this.routeParams=r,this.userService=n,this.xhrError=i,this.translate=o,this.isCurrentUser=!1,this.routeParams.slug?this.userService.getUserByUserName(this.routeParams.slug).then(function(t){return function(e){return e.get("is_active")?(t.user=e,t.isCurrentUser=!1,t._setMeta(t.user),e):t.xhrError.notFound()}}(this))["catch"](function(t){return function(e){return t.xhrError.response(e)}}(this)):(this.user=this.currentUserService.getUser(),this.isCurrentUser=!0,this._setMeta(this.user))}return t.$inject=["tgAppMetaService","tgCurrentUserService","$routeParams","tgUserService","tgXhrErrorService","$translate"],t.prototype._setMeta=function(t){var e,r,n;return e={userFullName:t.get("full_name_display"),userUsername:t.get("username")},n=this.translate.instant("USER.PROFILE.PAGE_TITLE",e),r=t.get("bio"),this.appMetaService.setAll(n,r)},t}(),angular.module("taigaProfile").controller("Profile",t)}.call(this),function(){var t;t=function(){return{templateUrl:"projects/project/blocked-project-explanation.html"}},angular.module("taigaProjects").directive("tgBlockedProjectExplanation",t)}.call(this),function(){var t;t=function(){function t(t,e){this.confirm=t,this.likeButtonService=e,this.isMouseOver=!1,this.loading=!1}return t.$inject=["$tgConfirm","tgLikeProjectButtonService"],t.prototype.showTextWhenMouseIsOver=function(){return this.isMouseOver=!0},t.prototype.showTextWhenMouseIsLeave=function(){return this.isMouseOver=!1},t.prototype.toggleLike=function(){var t;return this.loading=!0,t=this.project.get("is_fan")?this._unlike():this._like(),t["finally"](function(t){return function(){return t.loading=!1}}(this)),t},t.prototype._like=function(){return this.likeButtonService.like(this.project.get("id")).then(function(t){return function(){return t.showTextWhenMouseIsLeave()}}(this))["catch"](function(t){return function(){return t.confirm.notify("error")}}(this))},t.prototype._unlike=function(){return this.likeButtonService.unlike(this.project.get("id"))["catch"](function(t){return function(){return t.confirm.notify("error")}}(this))},t}(),angular.module("taigaProjects").controller("LikeProjectButton",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"LikeProjectButton",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/like-project-button/like-project-button.html"}},angular.module("taigaProjects").directive("tgLikeProjectButton",t)}.call(this),function(){var t,e,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;e=this.taiga,t=function(t){function e(t,e,r){this.rs=t,this.currentUserService=e,this.projectService=r}return r(e,t),e.$inject=["tgResources","tgCurrentUserService","tgProjectService"],e.prototype._getProjectIndex=function(t){return this.currentUserService.projects.get("all").findIndex(function(e){return e.get("id")===t})},e.prototype._updateProjects=function(t,e){var r,n;return r=this._getProjectIndex(t),-1!==r?(n=this.currentUserService.projects.get("all").update(r,function(t){var r;return r=t.get("total_fans"),e?r++:r--,t.merge({is_fan:e,total_fans:r})}),this.currentUserService.setProjects(n)):void 0},e.prototype._updateCurrentProject=function(t){var e,r;return r=this.projectService.project.get("total_fans"),t?r++:r--,e=this.projectService.project.merge({is_fan:t,total_fans:r}),this.projectService.setProject(e)},e.prototype.like=function(t){return this.rs.projects.likeProject(t).then(function(e){return function(){return e._updateProjects(t,!0),e._updateCurrentProject(!0)}}(this))},e.prototype.unlike=function(t){return this.rs.projects.unlikeProject(t).then(function(e){return function(){return e._updateProjects(t,!1),e._updateCurrentProject(!1)}}(this))},e}(e.Service),angular.module("taigaProjects").service("tgLikeProjectButtonService",t)}.call(this),function(){var t;t=function(t){var e,r;return r=function(e,r,n,i){var o,s,a;return s=null,o=dragula([r[0]],{copySortSource:!1,copy:!1,mirrorContainer:r[0],moves:function(t){return $(t).hasClass("list-itemtype-project")}}),o.on("dragend",function(r){var n,i,o,a,u,c,l;for(s=$(r),a=s.scope().project,i=s.index(),c=_.map(e.projects.toJS(),function(t){return t.id}),c=_.without(c,a.get("id")),c.splice(i,0,a.get("id")),u=[],i=n=0,o=c.length;o>n;i=++n)l=c[i],u.push({project_id:l,order:i});return t.bulkUpdateProjectsOrder(u)}),a=autoScroll(window,{margin:20,pixels:30,scrollWhenOutside:!0,autoScroll:function(){return this.down&&o.dragging}}),e.$on("$destroy",function(){return r.off(),o.destroy()})},e={scope:{projects:"=tgSortProjects"},link:r}},angular.module("taigaProjects").directive("tgSortProjects",["tgCurrentUserService",t])}.call(this),function(){var t;t=function(){function t(t,e){this.confirm=t,this.watchButtonService=e,this.showWatchOptions=!1,this.loading=!1}return t.$inject=["$tgConfirm","tgWatchProjectButtonService"],t.prototype.toggleWatcherOptions=function(){return this.showWatchOptions=!this.showWatchOptions},t.prototype.closeWatcherOptions=function(){return this.showWatchOptions=!1},t.prototype.watch=function(t){return t!==this.project.get("notify_level")?(this.loading=!0,this.closeWatcherOptions(),this.watchButtonService.watch(this.project.get("id"),t)["catch"](function(t){return function(){return t.confirm.notify("error")}}(this))["finally"](function(t){return function(){return t.loading=!1}}(this))):void 0},t.prototype.unwatch=function(){return this.loading=!0,this.closeWatcherOptions(),this.watchButtonService.unwatch(this.project.get("id"))["catch"](function(t){return function(){return t.confirm.notify("error")}}(this))["finally"](function(t){return function(){return t.loading=!1}}(this))},t}(),angular.module("taigaProjects").controller("WatchProjectButton",t)}.call(this),function(){var t;t=function(){return{scope:{},controller:"WatchProjectButton",bindToController:{project:"="},controllerAs:"vm",templateUrl:"projects/components/watch-project-button/watch-project-button.html"}},angular.module("taigaProjects").directive("tgWatchProjectButton",t)}.call(this),function(){var t,e,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;e=this.taiga,t=function(t){function e(t,e,r){this.rs=t,this.currentUserService=e,this.projectService=r}return r(e,t),e.$inject=["tgResources","tgCurrentUserService","tgProjectService"],e.prototype._getProjectIndex=function(t){return this.currentUserService.projects.get("all").findIndex(function(e){return e.get("id")===t})},e.prototype._updateProjects=function(t,e,r){var n,i;return n=this._getProjectIndex(t),-1!==n?(i=this.currentUserService.projects.get("all").update(n,function(t){return function(n){var i;return i=n.get("total_watchers"),!t.projectService.project.get("is_watcher")&&r?i++:t.projectService.project.get("is_watcher")&&!r&&i--,n.merge({is_watcher:r,total_watchers:i,notify_level:e})}}(this)),this.currentUserService.setProjects(i)):void 0},e.prototype._updateCurrentProject=function(t,e){var r,n;return n=this.projectService.project.get("total_watchers"),!this.projectService.project.get("is_watcher")&&e?n++:this.projectService.project.get("is_watcher")&&!e&&n--,r=this.projectService.project.merge({is_watcher:e,notify_level:t,total_watchers:n}),this.projectService.setProject(r)},e.prototype.watch=function(t,e){return this.rs.projects.watchProject(t,e).then(function(r){return function(){return r._updateProjects(t,e,!0),r._updateCurrentProject(e,!0)}}(this))},e.prototype.unwatch=function(t){return this.rs.projects.unwatchProject(t).then(function(e){return function(){return e._updateProjects(t,null,!1),e._updateCurrentProject(null,!1)}}(this))},e}(e.Service),angular.module("taigaProjects").service("tgWatchProjectButtonService",t)}.call(this),function(){var t;t=function(){function t(t,e){this.currentUserService=t,this.projectsService=e,taiga.defineImmutableProperty(this,"projects",function(t){return function(){return t.currentUserService.projects.get("all")}}(this))}return t.$inject=["tgCurrentUserService","tgProjectsService"],t.prototype.newProject=function(){return this.projectsService.newProject()},t}(),angular.module("taigaProjects").controller("ProjectsListing",t)}.call(this),function(){var t;t=function(){function t(t,e,r,n,i){var o;this.routeParams=t,this.appMetaService=e,this.auth=r,this.translate=n,this.projectService=i,o=this.routeParams.pslug,this.user=this.auth.userData,taiga.defineImmutableProperty(this,"project",function(t){return function(){return t.projectService.project}}(this)),taiga.defineImmutableProperty(this,"members",function(t){return function(){return t.projectService.activeMembers}}(this)),this.appMetaService.setfn(this._setMeta.bind(this))}return t.$inject=["$routeParams","tgAppMetaService","$tgAuth","$translate","tgProjectService"],t.prototype._setMeta=function(t){var e,r;return this.project?(r={},e={projectName:this.project.get("name")},r.title=this.translate.instant("PROJECT.PAGE_TITLE",e),r.description=this.project.get("description"),r):null},t}(),angular.module("taigaProjects").controller("Project",t)}.call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;r=this.taiga,e=this.taiga.groupBy,t=function(t){function e(t,e,r){this.rs=t,this.projectUrl=e,this.lightboxFactory=r}return n(e,t),e.$inject=["tgResources","$projectUrl","tgLightboxFactory"],e.prototype.getProjectBySlug=function(t){return this.rs.projects.getProjectBySlug(t).then(function(t){return function(e){return t._decorate(e)}}(this))},e.prototype.getProjectStats=function(t){return this.rs.projects.getProjectStats(t)},e.prototype.getProjectsByUserId=function(t,e){return this.rs.projects.getProjectsByUserId(t,e).then(function(t){return function(e){return e.map(t._decorate.bind(t))}}(this))},e.prototype._decorate=function(t){var e,r,n;return n=this.projectUrl.get(t.toJS()),t=t.set("url",n),e=[],t.get("tags")&&(r=t.get("tags").sort(),e=r.map(function(e){var r;return r=t.get("tags_colors").get(e),Immutable.fromJS({name:e,color:r})}),t=t.set("colorized_tags",e)),t},e.prototype.newProject=function(){return this.lightboxFactory.create("tg-lb-create-project",{"class":"wizard-create-project lightbox"})},e.prototype.bulkUpdateProjectsOrder=function(t){return this.rs.projects.bulkUpdateOrder(t)},e.prototype.transferValidateToken=function(t,e){return this.rs.projects.transferValidateToken(t,e)},e.prototype.transferAccept=function(t,e,r){return this.rs.projects.transferAccept(t,e,r)},e.prototype.transferReject=function(t,e,r){return this.rs.projects.transferReject(t,e,r)},e}(r.Service),angular.module("taigaProjects").service("tgProjectsService",t)}.call(this),function(){var t;t=function(){return{templateUrl:"projects/transfer/cant-own-project-explanation.html"}},angular.module("taigaProjects").directive("tgCantOwnProjectExplanation",t)}.call(this),function(){var t,e;e=angular.module("taigaProjects"),t=function(){function t(t,e,r,n,i,o,s,a){this.routeParams=t,this.projectService=e,this.location=r,this.authService=n,this.currentUserService=i,this.navUrls=o,this.translate=s,this.confirmService=a}return t.$inject=["$routeParams","tgProjectsService","$location","$tgAuth","tgCurrentUserService","$tgNavUrls","$translate","$tgConfirm"],t.prototype.initialize=function(){return this.projectId=this.project.get("id"),this.token=this.routeParams.token,this.showAddComment=!1,this._refreshUserData()},t.prototype._validateToken=function(){return this.projectService.transferValidateToken(this.projectId,this.token).then(null,function(t){return function(e,r){return t.location.path(t.navUrls.resolve("not-found"))}}(this))},t.prototype._refreshUserData=function(){return this.authService.refresh().then(function(t){return function(){return t._validateToken(),t._setProjectData(),t._checkOwnerData()}}(this))},t.prototype._setProjectData=function(){return this.canBeOwnedByUser=this.currentUserService.canOwnProject(this.project)},t.prototype._checkOwnerData=function(){var t,e;return t=this.currentUserService.getUser(),this.project.get("is_private")?(this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE",this.maxProjects=t.get("max_private_projects"),null===this.maxProjects&&(this.maxProjects=this.translate.instant("ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS")),this.currentProjects=t.get("total_private_projects"),e=t.get("max_memberships_private_projects")):(this.ownerMessage="ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC",this.maxProjects=t.get("max_public_projects"),null===this.maxProjects&&(this.maxProjects=this.translate.instant("ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS")),this.currentProjects=t.get("total_public_projects"),e=t.get("max_memberships_public_projects")),this.validNumberOfMemberships=null===e||this.project.get("total_memberships")<=e},t.prototype.transferAccept=function(t,e){return this.loadingAccept=!0,this.projectService.transferAccept(this.project.get("id"),t,e).then(function(t){return function(){var e;e=t.navUrls.resolve("project-admin-project-profile-details",{project:t.project.get("slug")}),t.loadingAccept=!1,t.location.path(e),t.confirmService.notify("success",t.translate.instant("ADMIN.PROJECT_TRANSFER.ACCEPTED_PROJECT_OWNERNSHIP"),"",5e3)}}(this))},t.prototype.transferReject=function(t,e){return this.loadingReject=!0,this.projectService.transferReject(this.project.get("id"),t,e).then(function(t){return function(){var e;e=t.navUrls.resolve("home",{project:t.project.get("slug")}),t.loadingReject=!1,t.location.path(e),t.confirmService.notify("success",t.translate.instant("ADMIN.PROJECT_TRANSFER.REJECTED_PROJECT_OWNERNSHIP"),"",5e3)}}(this))},t.prototype.addComment=function(){return this.showAddComment=!0},t.prototype.hideComment=function(){return this.showAddComment=!1,this.reason=""},t}(),e.controller("TransferProjectController",t)}.call(this),function(){var t,e;e=angular.module("taigaProjects"),t=function(){var t;return t=function(t,e,r,n){return n.initialize()},{link:t,scope:{},bindToController:{project:"="},templateUrl:"projects/transfer/transfer-project.html",controller:"TransferProjectController",controllerAs:"vm"}},e.directive("tgTransferProject",t)}.call(this),function(){var t,e,r,n;n=this.taiga,r=this.taiga.sizeFormat,t=function(t,e,n,i,o,s){var a;return a={},a.list=function(r,n,i){var o,s,a,u;return u="attachments/"+r,s={object_id:n,project:i},o={headers:{"x-disable-pagination":"1"}},a=t.resolve(u),e.get(a,s,o).then(function(t){return Immutable.fromJS(t.data)})},a["delete"]=function(r,n){var i,o;return o="attachments/"+r,i=t.resolve(o)+("/"+n),e["delete"](i)},a.patch=function(r,n,i){var o,s;return s="attachments/"+r,o=t.resolve(s)+("/"+n),e.patch(o,i)},a.create=function(e,a,u,c){var l,p,d,f,h,m,g,v,_,y,b;return y="attachments/"+e,_=t.resolve(y),p=o.defer(),void 0===c?(p.reject(null),p.promise):(d=n.get("maxUploadFileSize",null),d&&c.size>d?(f={status:413,data:{_error_message:"'"+c.name+"' ("+r(c.size)+") is too heavy for our oompa loompas, try it with a smaller than ("+r(d)+")"}},p.reject(f),p.promise):(v=function(t){return function(t){return i.$apply(function(){return c.status="in-progress",c.size=r(t.total),c.progressMessage="upload "+r(t.loaded)+" of "+r(t.total),c.progressPercent=Math.round(t.loaded/t.total*100)+"%"})}}(this),m=function(t){return function(t){return i.$apply(function(){var e,r,n;c.status="done",n=t.target.status;try{e=JSON.parse(t.target.responseText)}catch(i){e={}}return n>=200&&400>n?(e=Immutable.fromJS(e),p.resolve(e)):(f={status:n,data:{_error_message:null!=(r=l.attached_file)?r[0]:void 0}},p.reject(f))})}}(this),g=function(t){return function(t){return i.$apply(function(){return c.status="error",p.reject("fail")})}}(this),l=new FormData,l.append("project",a),l.append("object_id",u),l.append("attached_file",c),b=new XMLHttpRequest,b.upload.addEventListener("progress",v,!1),b.addEventListener("load",m,!1),b.addEventListener("error",g,!1),h=s.get("token"),b.open("POST",_),b.setRequestHeader("Authorization","Bearer "+h),b.setRequestHeader("Accept","application/json"),b.send(l),p.promise))},function(){return{attachments:a}}},t.$inject=["$tgUrls","$tgHttp","$tgConfig","$rootScope","$q","$tgStorage"],e=angular.module("taigaResources2"),e.factory("tgAttachmentsResource",t)}.call(this),function(){var t,e;t=function(t,e){var r;return r={},r.getApplicationToken=function(r,n){var i;return i=t.resolve("applications"),i=i+"/"+r+"/token?state="+n,e.get(i).then(function(t){return Immutable.fromJS(t.data)})},r.authorizeApplicationToken=function(r,n){var i,o;return o=t.resolve("application-tokens"),o+="/authorize",i={state:n,application:r},e.post(o,i).then(function(t){return Immutable.fromJS(t.data)})},function(){return{externalapps:r}}},t.$inject=["$tgUrls","$tgHttp"],e=angular.module("taigaResources2"),e.factory("tgExternalAppsResource",t)}.call(this),function(){var t,e;t=function(t,e){var r;return r={},r.listInAllProjects=function(r){var n,i;return i=t.resolve("issues"),n={headers:{"x-disable-pagination":"1"}},e.get(i,r,n).then(function(t){return Immutable.fromJS(t.data)})},function(){return{issues:r}}},t.$inject=["$tgUrls","$tgHttp"],e=angular.module("taigaResources2"),e.factory("tgIssuesResource",t)}.call(this),function(){var t,e,r;r=function(){},t=function(t,e,r){var n;return n={},n.getProjects=function(r,n){var i,o;return null==r&&(r={}),null==n&&(n=!0),o=t.resolve("projects"),i={},n||(i={headers:{"x-lazy-pagination":!0}}),e.get(o,r,i)},n.getProjectBySlug=function(r){var n;return n=t.resolve("projects"),n=n+"/by_slug?slug="+r,e.get(n).then(function(t){return Immutable.fromJS(t.data)})},n.getProjectsByUserId=function(r,n){var i,o,s;return null==n&&(n=!1),s=t.resolve("projects"),i={},n||(i.headers={"x-disable-pagination":"1"}),o={member:r,order_by:"memberships__user_order"},e.get(s,o,i).then(function(t){return Immutable.fromJS(t.data)})},n.getProjectStats=function(r){var n;return n=t.resolve("projects"),n=n+"/"+r,e.get(n).then(function(t){return Immutable.fromJS(t.data)})},n.bulkUpdateOrder=function(r){var n;return n=t.resolve("bulk-update-projects-order"),e.post(n,r)},n.getTimeline=function(n,i){var o,s;return o={page:i,only_relevant:!0},s=t.resolve("timeline-project"),s=s+"/"+n,e.get(s,o,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.likeProject=function(r){var n;return n=t.resolve("project-like",r),e.post(n)},n.unlikeProject=function(r){var n;return n=t.resolve("project-unlike",r),e.post(n)},n.watchProject=function(r,n){var i,o;return i={notify_level:n},o=t.resolve("project-watch",r),e.post(o,i)},n.unwatchProject=function(r){var n;return n=t.resolve("project-unwatch",r),e.post(n)},n.transferValidateToken=function(r,n){var i,o;return i={token:n},o=t.resolve("project-transfer-validate-token",r),e.post(o,i)},n.transferAccept=function(r,n,i){var o,s;return o={token:n,reason:i},s=t.resolve("project-transfer-accept",r),e.post(s,o)},n.transferReject=function(r,n,i){var o,s;return o={token:n,reason:i},s=t.resolve("project-transfer-reject",r),e.post(s,o)},n.transferRequest=function(r){var n;return n=t.resolve("project-transfer-request",r),e.post(n)},n.transferStart=function(r,n,i){var o,s;return o={user:n,reason:i},s=t.resolve("project-transfer-start",r),e.post(s,o)},function(){return{projects:n}}},t.$inject=["$tgUrls","$tgHttp","tgPaginateResponseService"],e=angular.module("taigaResources2"),e.factory("tgProjectsResources",t)}.call(this),function(){var t,e;e=["tgProjectsResources","tgUserResources","tgUsersResources","tgUserstoriesResource","tgTasksResource","tgIssuesResource","tgExternalAppsResource","tgAttachmentsResource","tgStatsResource"],t=function(t){var r,n,i,o,s,a,u,c,l;for(r=0,i=e.length;i>r;r++)for(c=e[r],u=t.get(c),a=t.invoke(u),s=Object.keys(a),n=0,o=s.length;o>n;n++)l=s[n],this[l]&&console.warm("repeated resource "+l),this[l]=a[l];return this},t.$inject=["$injector"],angular.module("taigaResources2").service("tgResources",t)}.call(this),function(){var t,e;t=function(t,e){var r;return r={},r.discover=function(r,n){var i;return i=t.resolve("stats-discover"),e.get(i).then(function(t){return Immutable.fromJS(t.data)})},function(){return{stats:r}}},t.$inject=["$tgUrls","$tgHttp"],e=angular.module("taigaResources2"),e.factory("tgStatsResource",t)}.call(this),function(){var t,e;t=function(t,e){var r;return r={},r.listInAllProjects=function(r){var n,i;return i=t.resolve("tasks"),n={headers:{"x-disable-pagination":"1"}},e.get(i,r,n).then(function(t){return Immutable.fromJS(t.data)})},function(){return{tasks:r}}},t.$inject=["$tgUrls","$tgHttp"],e=angular.module("taigaResources2"),e.factory("tgTasksResource",t)}.call(this),function(){var t,e;t=function(t,e,r){var n;return n={},n.getUserStorage=function(r){var n,i;return i=t.resolve("user-storage"),r&&(i+="/"+r),n={},e.get(i,{}).then(function(t){return t.data.value})},n.setUserStorage=function(r,n){var i,o;return o=t.resolve("user-storage")+"/"+r,i={key:r,value:n},e.put(o,i)},n.createUserStorage=function(r,n){var i,o;return o=t.resolve("user-storage"),i={key:r,value:n},e.post(o,i)},function(){return{user:n}}},t.$inject=["$tgUrls","$tgHttp"],e=angular.module("taigaResources2"),e.factory("tgUserResources",t)}.call(this),function(){var t,e;t=function(t,e,r){var n;return n={},n.getUserByUsername=function(r){var n,i,o;return o=t.resolve("by_username"),n={headers:{"x-disable-pagination":"1"}},i={username:r},e.get(o,i,n).then(function(t){return Immutable.fromJS(t.data)})},n.getStats=function(r){var n,i;return i=t.resolve("user-stats",r),n={headers:{"x-disable-pagination":"1"}},e.get(i,{},n).then(function(t){return Immutable.fromJS(t.data)})},n.getContacts=function(r){var n,i;return i=t.resolve("user-contacts",r),n={headers:{"x-disable-pagination":"1"}},e.get(i,{},n).then(function(t){return Immutable.fromJS(t.data)})},n.getLiked=function(n,i,o,s){var a,u;return u=t.resolve("user-liked",n),a={},null!=i&&(a.page=i),null!=o&&(a.type=o),null!=s&&(a.q=s),a.only_relevant=!0,e.get(u,a,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.getVoted=function(n,i,o,s){var a,u;return u=t.resolve("user-voted",n),a={},null!=i&&(a.page=i),null!=o&&(a.type=o),null!=s&&(a.q=s),e.get(u,a,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.getWatched=function(n,i,o,s){var a,u;return u=t.resolve("user-watched",n),a={},null!=i&&(a.page=i),null!=o&&(a.type=o),null!=s&&(a.q=s),e.get(u,a,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.getProfileTimeline=function(n,i){var o,s;return o={page:i},s=t.resolve("timeline-profile"),s=s+"/"+n,e.get(s,o,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},n.getUserTimeline=function(n,i){var o,s;return o={page:i,only_relevant:!0},s=t.resolve("timeline-user"),s=s+"/"+n,e.get(s,o,{headers:{"x-lazy-pagination":!0}}).then(function(t){return t=Immutable.fromJS(t),r(t)})},function(){return{users:n}}},t.$inject=["$tgUrls","$tgHttp","tgPaginateResponseService"],e=angular.module("taigaResources2"),e.factory("tgUsersResources",t)}.call(this),function(){var t,e;t=function(t,e){var r;return r={},r.listInAllProjects=function(r){var n,i;return i=t.resolve("userstories"),n={headers:{"x-disable-pagination":"1"}},e.get(i,r,n).then(function(t){return Immutable.fromJS(t.data)})},function(){return{userstories:r}}},t.$inject=["$tgUrls","$tgHttp"],e=angular.module("taigaResources2"),e.factory("tgUserstoriesResource",t)}.call(this),function(){var t,e,r;e=this.taiga,r=e.truncate,t=function(){function t(t){this.rootScope=t}return t.$inject=["$rootScope"],t.prototype._set=function(t,e){var r;if(t)return"title"===t?(r=$("head title"),0===r.length&&(r=$("<title></title>"),$("head").append(r)),r.text(e||"")):0===t.indexOf("og:")?(r=$("head meta[property='"+t+"']"),0===r.length&&(r=$("<meta property='"+t+"'/>"),$("head").append(r)),r.attr("content",e||"")):(r=$("head meta[name='"+t+"']"),0===r.length&&(r=$("<meta name='"+t+"'/>"),$("head").append(r)),r.attr("content",e||""))},t.prototype.setTitle=function(t){return this._set("title",t)},t.prototype.setDescription=function(t){return this._set("description",r(t,250))},t.prototype.setTwitterMetas=function(t,e){return this._set("twitter:card","summary"),this._set("twitter:site","@taigaio"),this._set("twitter:title",t),this._set("twitter:description",r(e,300)),this._set("twitter:image",window.location.origin+"/"+window._version+"/images/logo-color.png")},t.prototype.setOpenGraphMetas=function(t,e){return this._set("og:type","object"),this._set("og:site_name","Taiga - Love your projects"),this._set("og:title",t),this._set("og:description",r(e,300)),this._set("og:image",window.location.origin+"/"+window._version+"/images/logo-color.png"),this._set("og:url",window.location.href)},t.prototype.setAll=function(t,e){return this.setTitle(t),this.setDescription(e),this.setTwitterMetas(t,e),this.setOpenGraphMetas(t,e)},t.prototype.addMobileViewport=function(){return $("head").append('<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">')},t.prototype.removeMobileViewport=function(){return $('head meta[name="viewport"]').remove()},t.prototype.setfn=function(t){return this.listener&&this._listener(),this._listener=this.rootScope.$watchCollection(t,function(t){return function(e){return e?(t.setAll(e.title,e.description),t._listener()):void 0}}(this))},t}(),angular.module("taigaCommon").service("tgAppMetaService",t)}.call(this),function(){var t,e;e=this.taiga.sizeFormat,t=function(){function t(t,r,n,i){this.confirm=t,this.config=r,this.translate=n,this.rs=i,this.maxFileSize=this.getMaxFileSize(),this.maxFileSize&&(this.maxFileSizeFormated=e(this.maxFileSize))}return t.$inject=["$tgConfirm","$tgConfig","$translate","tgResources"],t.prototype.sizeError=function(t){var r;return r=this.translate.instant("ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED",{fileName:t.name,fileSize:e(t.size),maxFileSize:this.maxFileSizeFormated}),this.confirm.notify("error",r)},t.prototype.validate=function(t){return this.maxFileSize&&t.size>this.maxFileSize?(this.sizeError(t),!1):!0},t.prototype.getMaxFileSize=function(){return this.config.get("maxUploadFileSize",null)},t.prototype.list=function(t,e,r){return this.rs.attachments.list(t,e,r).then(function(t){return function(t){return t.sortBy(function(t){return t.get("order")})}}(this))},t.prototype["delete"]=function(t,e){return this.rs.attachments["delete"](t,e)},t.prototype.saveError=function(t,e){var r;return r="",t&&(r=this.translate.instant("ATTACHMENT.ERROR_UPLOAD_ATTACHMENT",{fileName:t.name,errorMessage:e.data._error_message})),this.confirm.notify("error",r)},t.prototype.upload=function(t,e,r,n){var i;return i=this.rs.attachments.create(n,r,e,t),i.then(null,this.saveError.bind(this,t)),i},t.prototype.patch=function(t,e,r){var n;return n=this.rs.attachments.patch(e,t,r),n.then(null,this.saveError.bind(this,null)),
n},t}(),angular.module("taigaCommon").service("tgAttachmentsService",t)}.call(this),function(){var t,e;e=this.taiga,t=function(){function t(t){this.projectService=t}return t.$inject=["tgProjectService"],t.prototype.check=function(t){return this.projectService.project?-1!==this.projectService.project.get("my_permissions").indexOf(t):!1},t}(),angular.module("taigaCommon").service("tgCheckPermissionsService",t)}.call(this),function(){var t,e,r;r=this.taiga,e=this.taiga.groupBy,t=function(){function t(t,e,n){this.projectsService=t,this.storageService=e,this.rs=n,this._user=null,this._projects=Immutable.Map(),this._projectsById=Immutable.Map(),this._joyride=null,r.defineImmutableProperty(this,"projects",function(t){return function(){return t._projects}}(this)),r.defineImmutableProperty(this,"projectsById",function(t){return function(){return t._projectsById}}(this))}return t.$inject=["tgProjectsService","$tgStorage","tgResources"],t.prototype.isAuthenticated=function(){return null!==this.getUser()},t.prototype.getUser=function(){var t;return this._user||(t=this.storageService.get("userInfo"),t&&(t=Immutable.fromJS(t),this.setUser(t))),this._user},t.prototype.removeUser=function(){return this._user=null,this._projects=Immutable.Map(),this._projectsById=Immutable.Map(),this._joyride=null},t.prototype.setUser=function(t){return this._user=t,this._loadUserInfo()},t.prototype.bulkUpdateProjectsOrder=function(t){return this.projectsService.bulkUpdateProjectsOrder(t).then(function(t){return function(){return t.loadProjects()}}(this))},t.prototype.loadProjects=function(){return this.projectsService.getProjectsByUserId(this._user.get("id")).then(function(t){return function(e){return t.setProjects(e)}}(this))},t.prototype.disableJoyRide=function(t){return t?this._joyride[t]=!1:this._joyride={backlog:!1,kanban:!1,dashboard:!1},this.rs.user.setUserStorage("joyride",this._joyride)},t.prototype.loadJoyRideConfig=function(){return new Promise(function(t){return function(e){return null!==t._joyride?void e(t._joyride):t.rs.user.getUserStorage("joyride").then(function(r){return t._joyride=r,e(t._joyride)})["catch"](function(){return t._joyride={backlog:!0,kanban:!0,dashboard:!0},t.rs.user.createUserStorage("joyride",t._joyride),e(t._joyride)})}}(this))},t.prototype._loadUserInfo=function(){return Promise.all([this.loadProjects()])},t.prototype.setProjects=function(t){return this._projects=this._projects.set("all",t),this._projects=this._projects.set("recents",t.slice(0,10)),this._projectsById=Immutable.fromJS(e(t.toJS(),function(t){return t.id})),this.projects},t.prototype.canCreatePrivateProjects=function(){var t;return t=this.getUser(),null!==t.get("max_private_projects")&&t.get("total_private_projects")>=t.get("max_private_projects")?{valid:!1,reason:"max_private_projects",type:"private_project"}:{valid:!0}},t.prototype.canCreatePublicProjects=function(){var t;return t=this.getUser(),null!==t.get("max_public_projects")&&t.get("total_public_projects")>=t.get("max_public_projects")?{valid:!1,reason:"max_public_projects",type:"public_project"}:{valid:!0}},t.prototype.canOwnProject=function(t){var e,r;if(r=this.getUser(),t.get("is_private")){if(e=this.canCreatePrivateProjects(),!e.valid)return e;if(null!==r.get("max_memberships_private_projects")&&t.get("total_memberships")>r.get("max_memberships_private_projects"))return{valid:!1,reason:"max_members_private_projects",type:"private_project"}}else{if(e=this.canCreatePublicProjects(),!e.valid)return e;if(null!==r.get("max_memberships_public_projects")&&t.get("total_memberships")>r.get("max_memberships_public_projects"))return{valid:!1,reason:"max_members_public_projects",type:"public_project"}}return{valid:!0}},t}(),angular.module("taigaCommon").service("tgCurrentUserService",t)}.call(this),function(){var t;t=function(){function t(t,e){this.rootScope=t,this.compile=e}return t.$inject=["$rootScope","$compile"],t.prototype.create=function(t,e,r){var n,i,o;o=this.rootScope.$new(),o=_.merge(o,r),n=$("<div>").attr(t,!0).attr("tg-bind-scope",!0),e&&n.attr(e),n.addClass("remove-on-close"),i=this.compile(n)(o),$(document.body).append(i)},t}(),angular.module("taigaCommon").service("tgLightboxFactory",t)}.call(this),function(){var t;t=function(){return function(t){var e;return e=Immutable.Map({data:t.get("data"),next:!!t.get("headers")("x-pagination-next"),prev:!!t.get("headers")("x-pagination-prev"),current:t.get("headers")("x-pagination-current"),count:t.get("headers")("x-pagination-count")})}},angular.module("taigaCommon").factory("tgPaginateResponseService",t)}.call(this),function(){var t,e=function(t,e){return(+t%(e=+e)+e)%e};t=function(){function t(){var t,e;e=["/"+window._version+"/images/project-logos/project-logo-01.png","/"+window._version+"/images/project-logos/project-logo-02.png","/"+window._version+"/images/project-logos/project-logo-03.png","/"+window._version+"/images/project-logos/project-logo-04.png","/"+window._version+"/images/project-logos/project-logo-05.png"],t=["rgba( 153,  214, 220, 1 )","rgba( 213,  156,  156, 1 )","rgba( 214, 161, 212,  1 )","rgba( 164, 162, 219, 1 )","rgba( 152, 224, 168,  1 )"],this.logos=_.cartesianProduct(e,t)}return t.prototype.getDefaultProjectLogo=function(t,r){var n,i,o;return i=t+"-"+r,n=e(murmurhash3_32_gc(i,42),this.logos.length),o=this.logos[n],{src:o[0],color:o[1]}},t}(),angular.module("taigaCommon").service("tgProjectLogoService",t)}.call(this),function(){var t,e;e=this.taiga,t=function(){function t(t,r){this.projectsService=t,this.xhrError=r,this._project=null,this._section=null,this._sectionsBreadcrumb=Immutable.List(),this._activeMembers=Immutable.List(),e.defineImmutableProperty(this,"project",function(t){return function(){return t._project}}(this)),e.defineImmutableProperty(this,"section",function(t){return function(){return t._section}}(this)),e.defineImmutableProperty(this,"sectionsBreadcrumb",function(t){return function(){return t._sectionsBreadcrumb}}(this)),e.defineImmutableProperty(this,"activeMembers",function(t){return function(){return t._activeMembers}}(this))}return t.$inject=["tgProjectsService","tgXhrErrorService"],t.prototype.setSection=function(t){return this._section=t,t?this._sectionsBreadcrumb=this._sectionsBreadcrumb.push(this._section):this._sectionsBreadcrumb=Immutable.List()},t.prototype.setProjectBySlug=function(t){return new Promise(function(e){return function(r,n){return e.project&&e.project.get("slug")===t?r():e.projectsService.getProjectBySlug(t).then(function(t){return e.setProject(t),r()})["catch"](function(t){return e.xhrError.response(t)})}}(this))},t.prototype.setProject=function(t){return this._project=t,this._activeMembers=this._project.get("members").filter(function(t){return t.get("is_active")})},t.prototype.cleanProject=function(){return this._project=null,this._activeMembers=Immutable.List(),this._section=null,this._sectionsBreadcrumb=Immutable.List()},t.prototype.hasPermission=function(t){return-1!==this._project.get("my_permissions").indexOf(t)},t.prototype.fetchProject=function(){var t;return t=this.project.get("slug"),this.projectsService.getProjectBySlug(t).then(function(t){return function(e){return t.setProject(e)}}(this))},t}(),angular.module("taigaCommon").service("tgProjectService",t)}.call(this),function(){var t,e,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;e=this.taiga,t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e}(e.Service=function(){return{use:function(t){var e;return e=$("link[rel='stylesheet']:first"),0===e.length&&(e=$("<link rel='stylesheet' href='' type='text/css'>"),$("head").append(e)),e.attr("href","/"+window._version+"/styles/theme-"+t+".css")}}}),angular.module("taigaCommon").service("tgThemeService",t)}.call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;r=this.taiga,e=r.bindMethods,t=function(t){function r(t){this.rs=t,e(this)}return n(r,t),r.$inject=["tgResources"],r.prototype.getUserByUserName=function(t){return this.rs.users.getUserByUsername(t)},r.prototype.getContacts=function(t){return this.rs.users.getContacts(t)},r.prototype.getLiked=function(t,e,r,n){return this.rs.users.getLiked(t,e,r,n)},r.prototype.getVoted=function(t,e,r,n){return this.rs.users.getVoted(t,e,r,n)},r.prototype.getWatched=function(t,e,r,n){return this.rs.users.getWatched(t,e,r,n)},r.prototype.getStats=function(t){return this.rs.users.getStats(t)},r.prototype.attachUserContactsToProjects=function(t,e){return this.getContacts(t).then(function(t){return e=e.map(function(e){var r;return r=t.filter(function(t){var r;return r=t.get("id"),-1!==e.get("members").indexOf(r)}),e=e.set("contacts",r)})})},r}(r.Service),angular.module("taigaCommon").service("tgUserService",t)}.call(this),function(){var t,e=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},r={}.hasOwnProperty;t=function(t){function r(t,e,r){this.q=t,this.location=e,this.navUrls=r}return e(r,t),r.$inject=["$q","$location","$tgNavUrls"],r.prototype.notFound=function(){return this.location.path(this.navUrls.resolve("not-found")),this.location.replace()},r.prototype.permissionDenied=function(){return this.location.path(this.navUrls.resolve("permission-denied")),this.location.replace()},r.prototype.response=function(t){return t&&(404===t.status?this.notFound():403===t.status&&this.permissionDenied()),this.q.reject(t)},r}(taiga.Service),angular.module("taigaCommon").service("tgXhrErrorService",t)}.call(this),function(){var t;t=function(t,e){var r,n,i;return i=[".jpg",".jpeg",".bmp",".gif",".png"],r=function(t){return t=t.toLowerCase(),_.some(i,function(e){return-1!==t.indexOf(e,t-e.length)})},n=function(n,i){var o,s;return o=r(n.attachment.get("url")),s=o?t.get("user-timeline/user-timeline-attachment/user-timeline-attachment-image.html"):t.get("user-timeline/user-timeline-attachment/user-timeline-attachment.html"),i.html(s),e(i.contents())(n),i.find("img").error(function(){return this.remove()})},{link:n,scope:{attachment:"=tgUserTimelineAttachment"}}},t.$inject=["$tgTemplate","$compile"],angular.module("taigaUserTimeline").directive("tgUserTimelineAttachment",t)}.call(this),function(){var t,e;e=this.taiga.unslugify,t=function(){function t(t,e){this.translate=t,this.sce=e}return t.$inject=["$translate","$sce"],t.prototype._fieldTranslationKey={status:"COMMON.FIELDS.STATUS",subject:"COMMON.FIELDS.SUBJECT",description_diff:"COMMON.FIELDS.DESCRIPTION",points:"COMMON.FIELDS.POINTS",assigned_to:"COMMON.FIELDS.ASSIGNED_TO",severity:"ISSUES.FIELDS.SEVERITY",priority:"ISSUES.FIELDS.PRIORITY",type:"ISSUES.FIELDS.TYPE",is_iocaine:"TASK.FIELDS.IS_IOCAINE",is_blocked:"COMMON.FIELDS.IS_BLOCKED"},t.prototype._params={username:function(t,e){var r,n,i;return i=t.getIn(["data","user"]),i.get("is_profile_visible")?(r=this.translate.instant("COMMON.SEE_USER_PROFILE",{username:i.get("username")}),n="user-profile:username=timeline.getIn(['data', 'user', 'username'])",this._getLink(n,i.get("name"),r)):this._getUsernameSpan(i.get("name"))},field_name:function(t,e){var r;return r=t.getIn(["data","value_diff","key"]),this.translate.instant(this._fieldTranslationKey[r])},project_name:function(t,e){var r;return r="project:project=timeline.getIn(['data', 'project', 'slug'])",this._getLink(r,t.getIn(["data","project","name"]))},new_value:function(t,e){var r,n;return _.isArray(t.getIn(["data","value_diff","value"]).toJS())?(n=t.getIn(["data","value_diff","value"]).get(1),null===n&&"assigned_to"===t.getIn(["data","value_diff","key"])&&(n=this.translate.instant("ACTIVITY.VALUES.UNASSIGNED")),r=n):r=t.getIn(["data","value_diff","value"]).first().get(1),_.escape(r)},sprint_name:function(t,e){var r;return r="project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])",this._getLink(r,t.getIn(["data","milestone","name"]))},us_name:function(t,e){var r,n,i,o;return n=this._getTimelineObj(t,e).get("userstory"),r={obj:"parent_userstory"},o=this._getDetailObjUrl(r),i="#"+n.get("ref")+" "+n.get("subject"),this._getLink(o,i)},obj_name:function(t,r){var n,i,o;return n=this._getTimelineObj(t,r),o=this._getDetailObjUrl(r),i="wikipage"===r.obj?e(n.get("slug")):"milestone"===r.obj?n.get("name"):"#"+n.get("ref")+" "+n.get("subject"),this._getLink(o,i)},role_name:function(t,e){return _.escape(t.getIn(["data","value_diff","value"]).keySeq().first())}},t.prototype._translateTitleParams=function(t,e,r){return this._params[t].call(this,e,r)},t.prototype._getTimelineObj=function(t,e){return t.getIn(["data",e.obj])},t.prototype._getDetailObjUrl=function(t){var e;return e={issue:["project-issues-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],wikipage:["project-wiki-page",":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])"],task:["project-tasks-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],userstory:["project-userstories-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])"],parent_userstory:["project-userstories-detail",":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])"],milestone:["project-taskboard",":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])"]},e[t.obj][0]+e[t.obj][1]},t.prototype._getLink=function(t,e,r){return r=r||e,$("<a>").attr("tg-nav",t).text(e).attr("title",r).prop("outerHTML")},t.prototype._getUsernameSpan=function(t){var e;return e=e||t,$("<span>").addClass("username").text(t).prop("outerHTML")},t.prototype._getParams=function(t,e,r){var n;return n={},r.translate_params.forEach(function(r){return function(i){return n[i]=r._translateTitleParams(i,t,e)}}(this)),n},t.prototype.getTitle=function(t,e,r){var n,i,o;return n=this._getParams(t,e,r),i={},Object.keys(n).forEach(function(t){return i[t]="{{"+t+"}}"}),o=this.translate.instant(r.key,i),Object.keys(n).forEach(function(t){var e;return e="{{"+t+"}}",o=o.replace(new RegExp(e,"g"),n[t])}),o},t}(),angular.module("taigaUserTimeline").service("tgUserTimelineItemTitle",t)}.call(this),function(){var t,e;e=function(t,e){var r;return r=[{check:function(t,e){return"membership"===e.obj},key:"TIMELINE.NEW_MEMBER",translate_params:["project_name"],member:function(t){return Immutable.Map({user:t.getIn(["data","user"]),role:t.getIn(["data","role"])})}},{check:function(t,e){return"project"===e.obj&&"create"===e.type},key:"TIMELINE.NEW_PROJECT",translate_params:["username","project_name"],description:function(t){return t.getIn(["data","project","description"])}},{check:function(t,e){return"change"===e.type&&t.hasIn(["data","value_diff"])&&"attachments"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.UPLOAD_ATTACHMENT",translate_params:["username","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"create"===e.type},key:"TIMELINE.US_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"issue"===e.obj&&"create"===e.type},key:"TIMELINE.ISSUE_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"wikipage"===e.obj&&"create"===e.type},key:"TIMELINE.WIKI_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"create"===e.type&&!t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"create"===e.type&&t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_CREATED_WITH_US",translate_params:["username","project_name","obj_name","us_name"]},{check:function(t,e){return"milestone"===e.obj&&"create"===e.type},key:"TIMELINE.MILESTONE_CREATED",translate_params:["username","project_name","obj_name"]},{check:function(t,e){return t.getIn(["data","comment"])&&"userstory"===e.obj},key:"TIMELINE.NEW_COMMENT_US",translate_params:["username","obj_name"],description:function(t){var e;return e=t.getIn(["data","comment_html"]),$($.parseHTML(e)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"issue"===e.obj},key:"TIMELINE.NEW_COMMENT_ISSUE",translate_params:["username","obj_name"],description:function(t){var e;return e=t.getIn(["data","comment_html"]),$($.parseHTML(e)).text()}},{check:function(t,e){return t.getIn(["data","comment"])&&"task"===e.obj},key:"TIMELINE.NEW_COMMENT_TASK",translate_params:["username","obj_name"],description:function(t){var e;return e=t.getIn(["data","comment_html"]),$($.parseHTML(e)).text()}},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"moveInBacklog"===t.getIn(["data","value_diff","key"])&&t.hasIn(["data","value_diff","value","backlog_order"])&&"change"===e.type},key:"TIMELINE.US_MOVED",translate_params:["username","obj_name"]},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"moveInBacklog"===t.getIn(["data","value_diff","key"])&&"change"===e.type&&"userstory"===e.obj?null===t.getIn(["data","value_diff","value","milestone"]).get(1):!1},key:"TIMELINE.US_REMOVED_FROM_MILESTONE",translate_params:["username","obj_name"]},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"moveInBacklog"===t.getIn(["data","value_diff","key"])&&"change"===e.type&&"userstory"===e.obj},key:"TIMELINE.US_ADDED_MILESTONE",translate_params:["username","obj_name","sprint_name"]},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"blocked"===t.getIn(["data","value_diff","key"])&&"change"===e.type?t.getIn(["data","value_diff","value","is_blocked"]).get(1)===!0:!1},key:"TIMELINE.BLOCKED",translate_params:["username","obj_name"],description:function(t){var e;return t.hasIn(["data","value_diff","value","blocked_note_html"])?(e=t.getIn(["data","value_diff","value","blocked_note_html"]).get(1),$($.parseHTML(e)).text()):!1}},{check:function(t,e){return t.hasIn(["data","value_diff"])&&"blocked"===t.getIn(["data","value_diff","key"])&&"change"===e.type?t.getIn(["data","value_diff","value","is_blocked"]).get(1)===!1:!1},key:"TIMELINE.UNBLOCKED",translate_params:["username","obj_name"]},{check:function(t,e){return"milestone"===e.obj&&"change"===e.type},key:"TIMELINE.MILESTONE_UPDATED",translate_params:["username","obj_name"]},{check:function(t,e){return"wikipage"===e.obj&&"change"===e.type},key:"TIMELINE.WIKI_UPDATED",translate_params:["username","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"points"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.US_UPDATED_POINTS",translate_params:["username","field_name","obj_name","new_value","role_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.US_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"userstory"===e.obj&&"change"===e.type},key:"TIMELINE.US_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"issue"===e.obj&&"change"===e.type&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.ISSUE_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"issue"===e.obj&&"change"===e.type},key:"TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&!t.getIn(["data","task","userstory"])&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.TASK_UPDATED",translate_params:["username","field_name","obj_name"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&t.getIn(["data","task","userstory"])&&t.hasIn(["data","value_diff"])&&"description_diff"===t.getIn(["data","value_diff","key"])},key:"TIMELINE.TASK_UPDATED_WITH_US",translate_params:["username","field_name","obj_name","us_name"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&!t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_UPDATED_WITH_NEW_VALUE",translate_params:["username","field_name","obj_name","new_value"]},{check:function(t,e){return"task"===e.obj&&"change"===e.type&&t.getIn(["data","task","userstory"])},key:"TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE",translate_params:["username","field_name","obj_name","us_name","new_value"]},{check:function(t,e){return"user"===e.obj&&"create"===e.type},key:"TIMELINE.NEW_USER",translate_params:["username"]}],_.find(r,function(r){return r.check(t,e)})},t=function(){function t(){}return t.prototype.getType=function(t,r){return e(t,r)},t}(),angular.module("taigaUserTimeline").service("tgUserTimelineItemType",t)}.call(this),function(){var t;t=function(){return{templateUrl:"user-timeline/user-timeline-item/user-timeline-item.html",scope:{timeline:"=tgUserTimelineItem"}}},angular.module("taigaUserTimeline").directive("tgUserTimelineItem",t)}.call(this),function(){var t;t=function(){var t;return t={},t.generate=function(t){var e,r,n,i;return i=1,r=Immutable.List(),t.minItems=t.minItems||20,n=function(){return r=Immutable.List(),e()},e=function(){return t.fetch(i).then(function(n){var o;return i++,o=n.get("data"),t.filter&&(o=t.filter(o)),t.map&&(o=o.map(t.map)),r=r.concat(o),r.size<t.minItems&&n.get("next")?e():Immutable.Map({items:r,next:n.get("next")})})},{next:function(){return n()}}},t},angular.module("taigaUserTimeline").factory("tgUserTimelinePaginationSequenceService",t)}.call(this),function(){var t,e,r,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},i={}.hasOwnProperty;r=this.taiga,e=this.taiga.mixOf,t=function(t){function e(t){this.userTimelineService=t,this.timelineList=Immutable.List(),this.scrollDisabled=!1,this.timeline=null,this.projectId?this.timeline=this.userTimelineService.getProjectTimeline(this.projectId):this.currentUser?this.timeline=this.userTimelineService.getProfileTimeline(this.user.get("id")):this.timeline=this.userTimelineService.getUserTimeline(this.user.get("id"))}return n(e,t),e.$inject=["tgUserTimelineService"],e.prototype.loadTimeline=function(){return this.scrollDisabled=!0,this.timeline.next().then(function(t){return function(e){return t.timelineList=t.timelineList.concat(e.get("items")),e.get("next")&&(t.scrollDisabled=!1),t.timelineList}}(this))},e}(e(r.Controller,r.PageMixin,r.FiltersMixin)),angular.module("taigaUserTimeline").controller("UserTimeline",t)}.call(this),function(){var t;t=function(){return{templateUrl:"user-timeline/user-timeline/user-timeline.html",controller:"UserTimeline",controllerAs:"vm",scope:{projectId:"=projectid",user:"=",currentUser:"="},bindToController:!0}},angular.module("taigaProfile").directive("tgUserTimeline",t)}.call(this),function(){var t,e,r=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},n={}.hasOwnProperty;e=this.taiga,t=function(t){function e(t,e,r,n){this.rs=t,this.userTimelinePaginationSequenceService=e,this.userTimelineItemType=r,this.userTimelineItemTitle=n}return r(e,t),e.$inject=["tgResources","tgUserTimelinePaginationSequenceService","tgUserTimelineItemType","tgUserTimelineItemTitle"],e.prototype._valid_fields=["status","subject","description_diff","assigned_to","points","severity","priority","type","attachments","is_iocaine","content_diff","name","estimated_finish","estimated_start","blocked","moveInBacklog","milestone"],e.prototype._invalid=[{check:function(t){var e,r;if(r=t.get("data").get("value_diff")){if(e=r.get("key"),-1===this._valid_fields.indexOf(e))return!0;if("attachments"===e&&0===r.get("value").get("new").size)return!0}return!1}},{check:function(t){var e,r;return e=t.get("event_type").split("."),r=t.get("data").get("value_diff"),"change"===e[2]&&void 0===r}},{check:function(t){var e;return e=t.get("event_type").split("."),"delete"===e[2]}},{check:function(t){var e;return e=t.get("event_type").split("."),"project"===e[1]&&"change"===e[2]}},{check:function(t){return!!t.get("data").get("comment_deleted")}},{check:function(t){var e,r;return e=t.get("event_type").split("."),r=t.get("data").get("value_diff"),r&&"task"===e[1]&&"change"===e[2]&&"milestone"===r.get("key")?t.get("data").get("value_diff").get("value"):!1}}],e.prototype._isInValidTimeline=function(t){return _.some(this._invalid,function(e){return function(r){return r.check.call(e,t)}}(this))},e.prototype._parseEventType=function(t){return t=t.split("."),{section:t[0],obj:t[1],type:t[2]}},e.prototype._getTimelineObject=function(t,e){return t.get("data").get(e.obj)?t.get("data").get(e.obj):void 0},e.prototype._attachExtraInfoToTimelineEntry=function(t,e,r){var n;return n=this.userTimelineItemTitle.getTitle(t,e,r),t=t.set("title_html",n),t=t.set("obj",this._getTimelineObject(t,e)),r.description&&(t=t.set("description",r.description(t))),r.member&&(t=t.set("member",r.member(t))),"attachments"===t.getIn(["data","value_diff","key"])&&t.hasIn(["data","value_diff","value","new"])&&(t=t.set("attachments",t.getIn(["data","value_diff","value","new"]))),t},e.prototype._parseTimeline=function(t){var e;return e=Immutable.List(),t.get("data").forEach(function(t){return function(r){var n,i,o,s;return i=t._parseEventType(r.get("event_type")),n=r.get("data"),s=n.get("values_diff"),s&&s.count()?(s.has("is_blocked")&&(s=Immutable.Map({blocked:s})),s.has("milestone")?s="userstory"===i.obj?Immutable.Map({moveInBacklog:s}):s.deleteIn(["values_diff","milestone"]):"milestone"===i.obj&&(s=Immutable.Map({milestone:s})),s.forEach(function(t,n){var i,o;return o=Immutable.Map({key:n,value:t}),i=r.setIn(["data","value_diff"],o),i=i.deleteIn(["data","values_diff"]),e=e.push(i)})):(o=r.deleteIn(["data","values_diff"]),e=e.push(o))}}(this)),t.set("data",e)},e.prototype._addEntyAttributes=function(t){var e,r;return e=this._parseEventType(t.get("event_type")),r=this.userTimelineItemType.getType(t,e),this._attachExtraInfoToTimelineEntry(t,e,r)},e.prototype.getProfileTimeline=function(t){var e;return e={},e.fetch=function(e){return function(r){return e.rs.users.getProfileTimeline(t,r).then(function(t){return e._parseTimeline(t)})}}(this),e.map=function(t){return function(e){return t._addEntyAttributes(e)}}(this),e.filter=function(t){return function(e){return e.filterNot(function(e){return t._isInValidTimeline(e)})}}(this),this.userTimelinePaginationSequenceService.generate(e)},e.prototype.getUserTimeline=function(t){var e;return e={},e.fetch=function(e){return function(r){return e.rs.users.getUserTimeline(t,r).then(function(t){return e._parseTimeline(t)})}}(this),e.map=function(t){return function(e){return t._addEntyAttributes(e)}}(this),e.filter=function(t){return function(e){return e.filterNot(function(e){return t._isInValidTimeline(e)})}}(this),this.userTimelinePaginationSequenceService.generate(e)},e.prototype.getProjectTimeline=function(t){var e;return e={},e.fetch=function(e){return function(r){return e.rs.projects.getTimeline(t,r).then(function(t){return e._parseTimeline(t)})}}(this),e.map=function(t){return function(e){return t._addEntyAttributes(e)}}(this),e.filter=function(t){return function(e){return e.filterNot(function(e){return t._isInValidTimeline(e)})}}(this),this.userTimelinePaginationSequenceService.generate(e)},e}(e.Service),angular.module("taigaUserTimeline").service("tgUserTimelineService",t)}.call(this);
//# sourceMappingURL=maps/app.js.map
