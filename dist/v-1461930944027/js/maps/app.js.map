{"version":3,"sources":["app.js"],"names":["configure","i18nInit","init","module","modules","pluginsWithModule","taiga","this","taigaContribPlugins","window","generateHash","components","_","map","x","JSON","stringify","hex_sha1","join","generateUniqueSessionIdentifier","date","randomNumber","Date","getTime","Math","floor","random","sessionId","$routeProvider","$locationProvider","$httpProvider","$provide","$tgEventsProvider","$compileProvider","$translateProvider","$translatePartialLoaderProvider","$animateProvider","authHttpIntercept","blockingIntercept","decorators","defaultHeaders","loaderIntercept","originalWhen","preferedLangCode","userInfo","versionCheckHttpIntercept","classNameFilter","when","path","route","resolve","angular","extend","languageLoad","$q","$translate","deferred","defer","then","promise","call","templateUrl","controller","controllerAs","loader","title","description","joyride","reloadOnSearch","access","requiresLogin","section","redirectTo","params","pslug","disableHeader","mobileViewport","otherwise","html5Mode","enabled","requireBase","Content-Type","Accept-Language","taigaConfig","defaultLanguage","X-Session-Id","defaults","headers","patch","post","put","get","useApplyAsync","setSessionId","$location","$navUrls","$lightboxService","httpResponseError","response","nextUrl","status","config","cancelable","closeAll","replace","url","indexOf","encodeURIComponent","search","reject","responseError","factory","interceptors","push","loaderService","request","logRequest","requestError","rejection","logResponse","$injector","data","version","element","injector","invoke","_this","$confirm","versionErrorMsg","instant","notify","$routeParams","redirectToBlockedPage","responseOk","blockedUrl","currentUrl","project","blocked_code","debugInfoEnabled","debugInfo","localStorage","parse","lang","addPart","useLoader","urlTemplate","_version","useSanitizeValueStrategy","addInterpolation","preferredLanguage","fallbackLanguage","getDecorators","each","decorator","provider","messages","moment","locale","ljs","load","defaultMessage","type","email","urlstrict","number","digits","dateIso","alphanum","phone","notnull","notblank","required","regexp","min","max","range","minlength","maxlength","rangelength","mincheck","maxcheck","rangecheck","equalto","linewidth","pikaday","checksley","updateMessages","$log","$rootscope","$auth","$events","$analytics","appMetaService","projectService","navigationBarService","un","user","validators","debug","$on","refresh","val","width","lines","valid","nl2br","split","every","line","length","prettyDate","isValid","updateValidators","contribPlugins","adminPlugins","filter","userSettingsPlugins","e","ctx","language","Promise","setScheduler","cb","$evalAsync","setupConnection","isAuthenticated","getUser","initialize","event","next","start","setSection","setProjectBySlug","cleanProject","setAll","addMobileViewport","removeMobileViewport","enableHeader","plugin","value","concat","run","TaigaBase","TaigaController","TaigaService","child","parent","ctor","constructor","key","hasProp","prototype","__super__","hasOwnProperty","bind","fn","me","apply","arguments","superClass","onInitialDataError","xhr","location","navUrls","q","Base","Service","Controller","addClass","bindMethods","bindOnce","cancelTimeout","debounce","debounceLeading","defineImmutableProperty","groupBy","isImage","joinStr","mixOf","replaceTags","scopeDefer","sizeFormat","slugify","startswith","stripTags","timeout","toString","toggleText","trim","truncate","unslugify","item","i","l","slice","el","className","classList","add","str","breakTag","object","dependencies","methods","keys","forIn","bindAll","scope","attr","continuation","delBind","$eval","$watch","Mixed","base","method","mixin","mixins","name","ref","char","toLowerCase","capitalize","texts","nextTextPosition","text","coll","pred","len","result","wait","setTimeout","timeoutVar","clearTimeout","func","$apply","isNumber","isString","isPlainObject","isUndefined","leading","trailing","str1","str2","startsWith","maxLength","suffix","out","String","substring","lastIndexOf","input","precision","size","units","isNaN","parseFloat","isFinite","log","pow","toFixed","exception","pattern","RegExp","tags","obj","Object","defineProperty","fn_result","isFunction","isObject","removeKeys","chain","flatten","reduce","cartesianProduct","reduceRight","a","b","y","match","oldImmutable","newImmutable","pathObj","forEach","newValue","toJS","FiltersMixin","PageMixin","fillUsersAndRoles","users","roles","activeUsers","computableRoles","is_active","sortBy","activeUsersById","id","usersById","members","uniq","includes","loadUsersAndRoles","all","rs","projects","usersList","projectId","rolesList","results","selectFilter","existing","compact","isInCurrentRouteParams","noreload","replaceFilter","replaceAllFilters","filters","unselectFilter","newValues","parsedValues","isEmpty","AuthService","CancelAccountDirective","ChangeEmailDirective","ChangePasswordFromRecoveryDirective","ForgotPasswordDirective","InvitationDirective","LoginDirective","LoginPage","PublicRegisterMessageDirective","RegisterDirective","currentUserService","$inject","rootscope","storage","model","http","urls","translate","currentUserService1","themeService","userModel","_currentTheme","_getUserTheme","setUserdata","userData","Immutable","fromJS","getAttrs","setUser","theme","_setTheme","newTheme","use","_setLocales","make_model","auth","set","clear","remove","setToken","token","getToken","removeToken","auth_token","login","clone","logout","removeUser","register","getInvitation","invitations","acceptInvitiationWithNewUser","acceptInvitiationWithExistingUser","forgotPassword","changePasswordFromRecovery","changeEmail","cancelAccount","service","$config","templates","template","templateFn","publicRegisterEnabled","restrict","directive","link","$scope","$el","$attrs","form","onError","onSuccess","submit","Form","find","decodeURIComponent","onKeyUp","target","currentTarget","iscapsLockActivated","loginFormType","preventDefault","validate","username","password","on","prerenderReady","off","onErrorSubmit","onSuccessSubmit","onlyOneErrorElement","trackEvent","_error_message","error","setErrors","message","success","$params","tokenInParams","loginForm","onErrorSubmitLogin","onErrorSubmitRegister","onSuccessSubmitLogin","onSuccessSubmitRegister","registerForm","submitLogin","submitRegister","invitation","dataLogin","project_slug","project_name","dataRegister","escape","$repo","$model","email_token","queryOne","cancel_token","TaigaMainDirective","$window","onresize","$broadcast","home","not-found","permission-denied","discover","discover-search","forgot-password","change-password","change-email","cancel-account","create-project","profile","user-profile","blocked-project","project-backlog","project-taskboard","project-kanban","project-issues","project-search","project-userstories-detail","project-tasks-detail","project-issues-detail","project-wiki","project-wiki-page","project-team","project-admin-home","project-admin-project-profile-details","project-admin-project-profile-default-values","project-admin-project-profile-modules","project-admin-project-profile-export","project-admin-project-profile-reports","project-admin-project-values-status","project-admin-project-values-points","project-admin-project-values-priorities","project-admin-project-values-severities","project-admin-project-values-types","project-admin-project-values-custom-fields","project-admin-memberships","project-admin-roles","project-admin-third-parties-webhooks","project-admin-third-parties-github","project-admin-third-parties-gitlab","project-admin-third-parties-bitbucket","project-admin-contrib","user-settings-user-profile","user-settings-user-change-password","user-settings-user-avatar","user-settings-mail-notifications","user-settings-contrib","$navurls","update","AnimationFrame","Capslock","CheckPermissionDirective","ClassPermissionDirective","DataPickerConfig","LightboxClose","ProjectUrl","Qqueue","SelectedText","Svg","Template","ToggleCommentDirective","i18n","previousMonth","nextMonth","months","weekdays","weekdaysShort","isRTL","firstDay","parseInt","format","$document","getSelection","selection","createRange","render","permission","removeClass","unObserve","unwatch","tgCheckPermission","$observe","checkPermissions","tgClassPermissionWatchAction","unbindWatcher","negation","my_permissions","classes","animationFrame","performAnimation","tail","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","time","shift","slug","is_backlog_activated","is_kanban_activated","is_wiki_activated","is_issues_activated","lastPromise","qqueue","bindAdd","args","$templateCache","lodash","tmp","svgIcon","svgTitle","svgTitleTranslate","svgTitleTranslateValues","EventsProvider","EventsService","win","liveAnnouncementService1","rootScope","liveAnnouncementService","processMessage","subscriptions","connected","pendingMessages","missedHeartbeats","heartbeatInterval","WebSocket","info","loc","scheme","stopExistingConnection","protocol","trimStart","host","ws","addEventListener","onOpen","onMessage","onClose","removeEventListener","stopHeartBeatMessages","close","notifications","subscribe","show","desc","$digest","startHeartBeatMessages","heartbeatIntervalTime","maxMissedHeartbeats","setInterval","error1","Error","sendMessage","cmd","clearInterval","processHeartBeatPongMessage","serialize","msg","send","routingKey","subscription","routing_key","callback","unsubscribe","$get","$win","$conf","$rootScope","FeedbackDirective","$loading","feedbackService","openLightbox","submitButton","currentLoading","create","feedback","finish","open","focus","RelatedTaskAssignedToInlineEditionDirective","RelatedTaskCreateButtonDirective","RelatedTaskCreateFormDirective","RelatedTaskRowDirective","RelatedTasksDirective","$compile","$template","templateEdit","templateView","renderEdit","renderView","saveTask","task","subject","save","html","keyCode","$modelValue","perms","modify_task","delete_task","select","askOnDelete","askResponse","$emit","ngModel","require","$tgmodel","newTask","assigned_to","createTask","reset","default_task_status","openNewRelatedTask","us","$rs","_isEditable","_isVisible","loadTasks","tasks","list","usId","showRelatedTasks","$ctrl","autoSave","notAutoSave","updateRelatedTask","member","imgurl","photo","full_name_display","tgRelatedTaskAssignedToInlineEdition","unbind","userId","updatedRelatedTask","ResourcesService","initResources","initUrls","auth-register","by_username","users-password-recovery","users-change-password-from-recovery","users-change-password","users-change-email","users-cancel-account","user-stats","user-liked","user-voted","user-watched","user-contacts","user-me","permissions","notify-policies","user-storage","memberships","bulk-create-memberships","resolver","project-templates","project-modules","bulk-update-projects-order","project-like","project-unlike","project-watch","project-unwatch","project-transfer-validate-token","project-transfer-accept","project-transfer-reject","project-transfer-request","project-transfer-start","userstory-statuses","points","task-statuses","issue-statuses","issue-types","priorities","severities","milestones","userstories","bulk-create-us","bulk-update-us-backlog-order","bulk-update-us-sprint-order","bulk-update-us-kanban-order","userstories-filters","userstory-upvote","userstory-downvote","userstory-watch","userstory-unwatch","bulk-create-tasks","bulk-update-task-taskboard-order","task-upvote","task-downvote","task-watch","task-unwatch","issues","bulk-create-issues","issues-filters","issue-upvote","issue-downvote","issue-watch","issue-unwatch","wiki","wiki-restore","wiki-links","history/us","history/issue","history/task","history/wiki","attachments/us","attachments/issue","attachments/task","attachments/wiki_page","custom-attributes/userstory","custom-attributes/issue","custom-attributes/task","custom-attributes-values/userstory","custom-attributes-values/issue","custom-attributes-values/task","webhooks","webhooks-test","webhooklogs","webhooklogs-resend","userstories-csv","tasks-csv","issues-csv","timeline-profile","timeline-user","timeline-project","exporter","importer","locales","applications","application-tokens","stats-discover","$urls","providers","toArray","SearchBoxDirective","SearchController","SearchDirective","scope1","repo","loadSearchData","sectionName","loadInitialData","projectName","projectDescription","searchTerm","t","searchResults","term","loadFilters","defered","loadProject","getBySlug","issueStatusById","issue_statuses","taskStatusById","task_statuses","severityById","priorityById","usStatusById","us_statuses","loading","_loadSearchData","_promise","abort","$route","reload","$templatecache","$routeparams","linkTable","activeSectionName","applyAutoTab","getActiveSection","lastSearchResults","markSectionTabActive","renderFilterTabs","renderTableContent","tabsDom","maxVal","selectedSection","wikipages","oldElements","oldScope","children","$destroy","$new","parseHTML","activeSection","sectionData","searchText","AnalyticsService","doc","conf","initialized","accountId","pageEvent","trackRoutes","ignoreFirstPageLoad","injectAnalytics","ga","getUrl","trackPage","s","o","g","r","m","createElement","getElementsByTagName","async","src","parentNode","insertBefore","document","page","category","action","label","BindScope","jQuery","CompileHtmlDirective","attrs","tgCompileHtml","oldValue","contents","AssignedToDirective","BlockButtonDirective","CreatedByDisplayDirective","DateRangeDirective","DateSelectorDirective","DeleteButtonDirective","EditableDescriptionDirective","EditableSubjectDirective","EditableWysiwyg","ListItemAssignedtoDirective","ListItemIssueStatusDirective","ListItemPriorityDirective","ListItemSeverityDirective","ListItemTaskStatusDirective","ListItemTypeDirective","ListItemUsStatusDirective","SprintProgressBarDirective","TgMainTitleDirective","TgProgressBarDirective","WatchersDirective","renderRange","first","second","endDate","initDate","tgDateRange","valFirst","valSecond","datePickerConfigService","selectedDate","datePickerConfig","merge","field","onSelect","picker","setDate","Pikaday","renderProgress","percentage","visual_percentage","hasClass","css","tgSprintProgressbar","sprint","closedPoints","totalPoints","closed_points","total_points","round","owner","owner_extra_info","created_date","$qqueue","deleteWatcher","isEditable","renderWatchers","ref1","requiredPerm","watchers","$setViewValue","watcherId","revert","watcherIds","pull","$currentUserService","renderAssignedTo","assignedObject","fullName","isIocaine","isUnassigned","assigned_to_extra_info","is_iocaine","fullNameVisible","ask","instance","is_blocked","onDeleteGoToUrl","onDeleteTitle","subtitle","hide","click","$selectedText","noDescriptionMegEditMode","noDescriptionMegReadMode","is","href","$","scrollTop","offset","top","noDescriptionMsg","attachmentsService","attachmentsFullService","isInEditMode","uploadFile","file","addAttachment","getIn","textarea","dataTransfer","promises","stopPropagation","originalEvent","files","markItUp","replaceWith","tgListitemUsStatus","tgListitemTaskStatus","tgListitemAssignedto","issue","tgListitemIssueStatus","issueTypeById","domNode","color","tgListitemType","priority","tgListitemPriority","severity","tgListitemSeverity","tgProgressBar","i18nSectionName","ConfirmService","NOTIFICATION_MSG","light-error","lightboxService","lightboxSelector","ok","askChoice","choices","replacement","warning","choicesField","append","selected","icon","detailImage","svgContainer","useSVG","createElementNS","setAttributeNS","appendChild","prepend","stop","percent","body","selector","tsem","one","CustomAttributeValueDirective","CustomAttributesValuesController","CustomAttributesValuesDirective","DATE_TYPE","MULTILINE_TYPE","TEXT_TYPE","TYPE_CHOICES","URL_TYPE","confirm","objectId","customAttributes","customAttributesValues","loadCustomAttributesValues","getAttributeValue","attribute","attributeValue","attributes_values","updateAttributeValue","attributesValues","$templates","$storage","collapsedHash","$ctrls","collapsed","hash","requiredEditionPerm","setFocusAndSelectOnInputField","edit","editable","tgCustomAttributeValue","EstimationsService","LbUsEstimationDirective","UsEstimationDirective","$tgEstimationsService","estimationProcess","onSelectedPointForRole","roleId","pointId","mainTemplate","calculateTotalPoints","calculateRoles","EstimationProcess","pointsTemplate","$el1","us1","project1","bindClickEvents","pointsById","notNullValues","values","v","k","acc","num","role","pointObj","renderPointsSelector","siblings","popover","horizontalList","maxPointLength","pop","point","some","horizontal","closest","height","clientHeight","defaultFilter","momentFormat","momentFromNow","yesNoFilter","defaultValue","without_suffix","fromNow","HistoryController","HistoryDirective","IGNORED_FIELDS","userstories.userstory","tasks.task","issues.issue","loadHistory","history","changeModel","historyEntry","historyResult","j","len1","values_diff","description_diff","description_html","blocked_note_diff","blocked_note","blocked_note_html","comments","comment","deleteComment","activityId","undeleteComment","checkPermissionsService","templateActivity","templateBase","templateBaseEntries","templateChangeAttachment","templateChangeDiff","templateChangeGeneric","templateChangeList","templateChangePoints","templateDeletedComment","countChanges","formatChange","getHumanizedFieldName","getPrettyDateFormat","renderActivity","renderAttachmentEntry","renderBase","renderChange","renderChangeEntries","renderChangeEntry","renderChangesHelperText","renderComment","renderComments","renderCustomAttributesEntry","renderHistory","rerender","showAllActivity","showAllComments","humanizedFieldNames","content","is_closed","finish_date","milestone","user_story","client_requirement","team_requirement","attachments","is_deprecated","order","backlog_order","sprint_order","kanban_order","taskboard_order","us_order","change","isArray","changes","diff","filename","from","to","outerHTML","customAttrsChanges","added","removed","difference","ref2","delete_comment_date","delete_comment_user","deleteCommentDate","deleteCommentUser","comment_html","canRestoreComment","pk","avatar","userFullName","userProfileUrl","creationDate","created_at","changesText","mode","deleteCommentActionTitle","canDeleteComment","entries","totalEntries","showMore","commentsVisible","historyVisible","check","ngmodel","totalComments","takeRight","totalChanges","parents","toggleClass","ImportProjectButtonDirective","LbImportErrorDirective","$lightboxFactory","$tgAuth","getRestrictionError","errorKey","maxMemberships","membersError","privateError","publicError","isPrivate","canCreatePrivateProjects","canCreatePublicProjects","max_memberships","trigger","loadProjects","errorMsg","restrictionError","class","error_message","AssignedToLightboxDirective","AttachmentPreviewLightboxDirective","BlockLightboxDirective","BlockingMessageInputDirective","CreateBulkUserstoriesDirective","CreateEditUserstoryDirective","LightboxDirective","LightboxKeyboardNavigationService","LightboxLeaveProjectWarningDirective","LightboxService","WatchersLightboxDirective","docEl","lightboxContent","not","firstField","activeElement","blur","code","which","removeAttr","lightboxEl","dispatch","prev","$tgrepo","block","unblock","finishCallback","watch","attachmentsToAdd","attachmentsToDelete","createAttachments","deleteAttachments","resetAttachments","createEditUs","isNew","List","attachment","deleteAttachment","statusList","usStatusList","is_archived","upload","broadcastEvent","keydown","statusId","bulk","bulkCreate","lightboxKeyboardNavigationService","closeLightbox","filterUsers","normalizeString","selectedItem","selectedUser","usersTemplate","string","normalizedString","toUpperCase","partial","assignedToId","searchingText","usersSearch","getFilteredUsers","_filterUsers","Loader","LoaderDirective","tgLoader","onStart","onEnd","autoClose","lastResponseDate","pageLoaded","requestCount","startLoadTime","minTime","force","endTime","timeoutValue","intervalAuto","auto","LoadingDirective","TgLoadingService","spinner","settings","removeClasses","classess","timeoutId","tgLoading","showLoading","RelatedTaskStatusDirective","UsStatusDirective","usStatusDom","usStatusDomParent","tgUsStatus","onUpdate","statuses","selectionTemplate","updateTaskStatus","taskStatusDom","taskStatusDomParent","tgRelatedTaskStatus","closePopover","isVisible","docViewBottom","docViewLeft","docViewRight","docViewTop","docViewWidth","elemBottom","elemLeft","elemRight","elemTop","elemWidth","display","visibility","left","fadeOut","fadeIn","ExceptionHandlerFactory","ravenConfig","Raven","install","cause","captureException","ColorizeTagsDirective","LbTagLineDirective","TagLineDirective","TagsDirective","formatter","parser","$formatters","$parsers","backlog","kanban","taskboard","srcTags","tgColorizeTagsType","sort","tag","tags_colors","tgColorizeTags","COMMA_KEY","ENTER_KEY","autocomplete","templateTags","addValue","deleteValue","hideSaveButton","renderTags","resetInput","saveInputTag","showSaveButton","tagsColors","style","fromCharCode","Awesomplete","ESC_KEY","hideAddTagButton","hideAddTagButtonText","hideInput","renderInReadModeOnly","showAddTagButton","showAddTagButtonText","showInput","MarkitupDirective","previewTemplate","addLine","cancelablePromise","closePreviewMode","markdownTitle","prepareUrlFormatting","preview","previewDomNode","previewInProgress","renderMarkItUp","setCaretPosition","urlFormatting","markItUpDomNode","markdownDomNode","mdrender","markdown","caretPosition","scrollRelation","totalLines","createTextRange","move","selectionStart","setSelectionRange","scrollHeight","nline","cursorPosition","indices","regex","exec","index","donotparse","endIndex","startIndex","heading","n","placeHolder","markdownSettings","nameSpace","onShiftEnter","keepDefault","openWith","onEnter","afterInsert","cursorLine","emptyListItem","lastLine","markdownCaretPositon","newLineContent","markupSet","closeWith","separator","beforeInsert","markItUpRemove","textcomplete","cache","searchProps","searchTypes","prop","res","count","BacklogFiltersDirective","templateSelected","currentFiltersType","getFiltersType","initializeSelectedFilters","reloadUserstories","renderFilters","renderSelectedFilters","selectQFilter","selectedFilters","showCategories","showFilters","toggleFilterSelection","f","loadUserstories","generateFilters","currentFilters","CreateEditSprint","createSprint","getLastSprint","hasErrors","resetSprint","estimated_start","estimated_finish","newSprint","copy","setAttr","sprintsCounter","__all__","milestonesCounter","openSprints","sortedSprints","sprints","closed","estimatedFinish","estimatedStart","lastSprint","lastSprintNameDom","editSprint","BacklogController","BacklogDirective","BurndownBacklogGraphDirective","TgBacklogProgressBarDirective","ToggleBurndownVisibility","UsPointsDirective","UsRolePointsSelectorDirective","params1","events","analytics","rs2","disablePagination","showTags","activeFilters","showGraphPlaceholder","initializeEventHandlers","getShowTags","loadProjectStats","loadSprints","loadClosedSprints","findIndex","moveUs","unloadClosedSprints","initializeSubscription","routingKey1","routingKey2","toggleShowTags","storeShowTags","toggleActiveFilters","stats","defined_points","completedPercentage","total_milestones","closedSprints","totalClosedMilestones","user_stories","closedSprintsById","totalMilestones","totalOpenMilestones","reverse","sprintsById","currentSprint","findCurrentSprint","restoreFilters","selectedStatuses","selectedTags","oldSelectedTags","oldSelectedStatuses","filtersQ","filtersQOld","filterGrp","resetFilters","resetPagination","loadingUserstories","httpParams","getUrlFilters","storeQueryParams","listUnassigned","header","setSearchDataFilters","loadBacklog","closedMilestones","total_closed_milestones","prepareBulkUpdateData","uses","us_id","resortUserStories","items","isModified","usList","newUsIndex","newSprintId","len2","len3","movedFromClosedSprint","movedToClosedSprint","oldSprintId","splice","Array","bulkUpdateBacklogOrder","bulkUpdateSprintOrder","console","len4","isFilterSelected","searchdata","urlfilters","results1","pick","filtersData","choicesFiltersFormat","tagsFilterFormat","byIdObject","markSelectedFilters","isSelected","omit","updateUserStoryStatus","editUserStory","$event","getByRef","deleteUserStory","without","addNewUs","default_us_status","addNewSprint","currentDate","end","doomLineTemplate","linkDoomLine","linkFilters","linkToolbar","showHideFilter","showHideTags","addDoomLineDom","getUsItems","reloadDoomLine","removeDoomlineDom","current_sum","domElement","assigned_points","before","rowElements","checkSelected","getUsToMove","lastChecked","moveToCurrentSprint","moveToLatestSprint","moveUssToSprint","shiftPressed","ussDom","itemScope","selectedUss","extraPoints","totalExtraPoints","ussCurrent","union","saveAll","moveToSprintDom","selectedUsDom","shiftKey","current","elements","nextAll","prevAll","nextUntil","prevUntil","elm","ussToMove","hideText","showText","sidebar","filtersSearch","numberOfRoles","roleName","rolScope","$tgTemplate","rolesTemplate","bindClickElements","filteringRoleId","renderRolesSelector","selectedRoleId","updatingSelectedRoleId","tgBacklogUsPoints","popRolesDom","firstLoad","toggleGraph","isBurndownGraphCollapsed","redrawChart","dataToDraw","client_increment_line","colors","evolution_line","milestonesRange","optimal_line","options","team_increment_line","zero_line","ml","zip","fillColor","optimal","evolution","grid","borderWidth","right","bottom","borderColor","hoverable","xaxis","ticks","axisLabel","axisLabelUseCanvas","axisLabelFontSizePixels","axisLabelFontFamily","axisLabelPadding","tickFormatter","axis","yaxis","series","shadowSize","fill","radius","lineWidth","tooltip","tooltipOpts","xval","yval","flotItem","seriesIndex","sprintName","abs","empty","plot","adjustPercentaje","projectPointsPercentaje","closedPointsPercentaje","adjusted","tgBacklogProgressBar","definedPoints","BacklogSortableDirective","deleteElement","$tgConfirm","drake","filterError","initIsBacklog","scroll","dragula","copySortSource","isContainer","contains","moves","container","isChecked","dragMultiple","dragMultipleItems","firstElement","isBacklog","sameContainer","itemUs","autoScroll","margin","pixels","scrollWhenOutside","down","dragging","destroy","BacklogSprintDirective","BacklogSprintHeaderDirective","ToggleExcludeClosedSprintsVisualization","slideOptions","sprintTableMinHeight","toggleSprint","duration","easing","sprintArrow","sprintTable","tgBacklogSprint","slideToggle","compiledTemplate","estimatedDateRange","taskboardUrl","templateScope","assign","excludeClosedSprints","loadingElm","after","SprintGraphDirective","days","day","unshift","d","optimal_points","open_points","tickSize","last","daysNames","formattedDate","roundedValue","CreateBulkTasksDirective","CreateEditTaskDirective","sprintId","TaskboardController","TaskboardDirective","TaskboardSquishColumnDirective","TaskboardTaskDirective","TaskboardUserDirective","rs1","_setMeta","startDate","completedPoints","completedPointsSum","totalPointsSum","openTasks","totalTasks","total_tasks","loadTaskboard","taskMove","refreshTagsColors","loadSprintStats","loadSprint","pointsList","roleById","taskStatusList","remainingPointsSum","remainingTasks","completed_points","completed_tasks","usTasks","isPlaceholder","sslug","refreshTasksOrder","resortTasks","bulkUpdateTaskTaskboardOrder","task_id","addNewTask","editTaskAssignedTo","tableBodyDom","tableHeaderDom","scrollLeft","$rs2","editingTask","avatarWidth","maxColumnWidth","getCeilWidth","recalculateStatusColumnWidth","recalculateTaskboardWidth","refreshTaskboardTableWidth","setStatusColumnWidth","statusesFolded","getStatusColumnModes","usFolded","getUsRowModes","foldStatus","storeStatusColumnModes","foldUs","storeUsRowModes","tasksMatrixSize","sqrt","column","columnWidths","columns","totalWidth","outerWidth","total","statusFoldedWidth","clickable","username_label","TaskboardSortableDirective","xx","containers","itemEl","newParentScope","oldParentScope","tdom","mirrorContainer","itemIndex","itemTask","newStatusId","newUsId","oldStatusId","oldUsId","parentEl","st","KanbanArchivedStatusHeaderDirective","KanbanArchivedStatusIntroDirective","KanbanController","KanbanDirective","KanbanSquishColumnDirective","KanbanUserDirective","KanbanUserstoryDirective","KanbanWipLimitDirective","defaultViewMode","viewModes","statusViewModes","onAssignedToChanged","loadUserStoriesForStatus","hideUserStoriesForStatus","changeUsAssignedTo","userid","status__is_archived","listAll","usByStatus","us_archived","loadKanban","generateStatusViewModes","storedStatusViewModes","getStatusViewModes","storeStatusViewModes","updateStatusViewMode","newViewMode","isMaximized","isMinimized","itemsToSave","bulkUpdateKanbanOrder","hideArchivedText","showArchivedText","hidden","tgKanbanArchivedStatusHeader","userStories","hiddenUserStoriexText","updateIntroText","tgKanbanArchivedStatusIntro","isArchived","userStoriesLoaded","editingUserStory","getTemplateUrl","updateTableWidth","folds","redrawWipLimit","tgKanbanWipLimit","wip_limit","wtid","tgKanbanUserAvatar","KanbanSortableDirective","IssueDetailController","IssuePriorityButtonDirective","IssueSeverityButtonDirective","IssueStatusButtonDirective","IssueStatusDisplayDirective","IssueTypeButtonDirective","PromoteIssueToUsButtonDirective","issueRef","issueref","initializeOnDeleteGoToUrl","ref3","issueSubject","issueStatus","statusById","issueType","typeById","issueSeverity","issuePriority","issueDescription","loadIssue","issue_types","typeList","severityList","priorityList","issueId","commentModel","neighbors","previous","previousUrl","onUpvote","upvote","onDownvote","downvote","onWatch","onUnwatch","typees","severityes","priorityes","generated_from_issue","CreateBulkIssuesDirective","CreateIssueDirective","default_issue_status","default_issue_type","default_priority","default_severity","IssueAssignedToInlineEditionDirective","IssueStatusInlineEditionDirective","IssuesController","IssuesDirective","IssuesFiltersDirective","loadIssues","getFilters","storeFilters","issueStatusList","issueTypes","getUrlFilter","loadMyFilters","getMyFilters","removeNotExistingFiltersFromUrl","currentSearch","existingValues","filterName","filterValue","splittedValues","intersection","myFilters","types","assignedTo","createdBy","usersFiltersFormat","unknownOption","reformatedUsers","unknownItem","full_name","u","owners","loadIssuesRequests","urlFilters","models","paginatedBy","saveCurrentFiltersTo","newFilter","storeMyFilters","deleteMyFilter","addNewIssue","addIssuesInBulk","linkOrdering","linkPagination","$pagEl","afterCurrent","atBegin","atEnd","beforeCurrent","getNumPages","renderPagination","numPages","cpage","pages","showPrevious","showNext","pagenum","colHeadElement","currentOrder","finalOrder","newOrder","reloadIssues","unwatchIssues","filterId","customFilterName","loadPromise","currentfilterstype","updateIssueStatus","issueStatusDom","issueStatusDomParent","tgIssueStatusInlineEdition","updateIssue","tgIssueAssignedToInlineEdition","updatedIssue","UsClientRequirementButtonDirective","UsStatusButtonDirective","UsStatusDisplayDirective","UsTeamRequirementButtonDirective","UserStoryDetailController","usRef","usref","closedTasks","progressPercentage","userStoryRef","userStorySubject","userStoryStatus","userStoryPoints","userStoryDescription","userStoryClosedTasks","userStoryTotalTasks","userStoryProgressPercentage","allClosed","loadUs","kanbanStaus","noMilestone","order_by","canEdit","isRequired","TaskDetailController","TaskIsIocaineButtonDirective","TaskStatusButtonDirective","TaskStatusDisplayDirective","taskRef","taskref","taskSubject","taskStatus","taskDescription","loadTask","taskId","loadUserStory","LeaveProjectDirective","TeamController","TeamFiltersDirective","TeamMemberCurrentUserDirective","TeamMemberStatsDirective","TeamMembersDirective","membersFilter","setRole","filtersRole","loadMembers","totals","currentUser","issuesEnabled","tasksEnabled","wikiEnabled","loadMemberStats","memberStats","vals","statsKey","sum","_processStats","_processStat","stat","singleStat","userRoles","lightboxFactory","leaveConfirm","confirm_leave_project_text","leave_project_text","leave","isCurrentUser","EditableWikiContentDirective","WikiDetailController","WikiSummaryDirective","projectSlug","wikiSlug","wikiTitle","linksVisible","wikiPageName","wikiPageContent","totalEditions","editions","lastModifiedDate","modified_date","loadWiki","wikiId","loadWikiLinks","listLinks","wikiLinks","selectedWikiLink","checkLinksPerms","last_modifier","imgUrl","wikiPage","cancelEdition","disableEdition","getSelectedText","switchToEditMode","switchToReadMode","button","WikiNavDirective","addWikiLinkPermission","deleteWikiLinkPermission","linkId","newLink","ChangeOwnerLightboxController","ChangeOwnerLightboxDirective","LbRequestOwnershipDirective","LightboxAddMembersController","LightboxAddMembersDirective","LightboxAddMembersWarningMessageDirective","TransferProjectStartSuccessDirective","lightboxService1","pendingMembersCount","_defaultMaxInvites","_defaultRole","submitInvites","canAddUsers","memberInvites","membersLimit","total_memberships","addSingleMember","role_id","showWarningMessage","removeSingleMember","initializeFields","invites","bulkCreateMemberships","invitationText","_onSuccessInvite","_onErrorInvite","ctrl","bindToController","confirmService","transferRequest","commentOpen","limit","getUsers","currentOwnerId","userSearch","selectUser","transferStart","MembershipsController","MembershipsDirective","MembershipsRowActionsDirective","MembershipsRowAdminCheckboxDirective","MembershipsRowAvatarDirective","MembershipsRowRoleSelectorDirective","NoMoreMembershipsExplanationDirective","lightboxFactory1","i_am_admin","httpFilters","membership","is_user_active","addNewMembers","showLimitUsersWarningMessage","pending","user_email","isOwner","is_owner","tgMembershipsRowAvatar","tgMembershipsRowAdminCheckbox","inputId","is_admin","roleList","selectedRole","tgMembershipsRowRoleSelector","newRole","activedTemplate","pendingTemplate","tgMembershipsRowActions","resendInvitation","defaultMsg","AdminNavigationDirective","tgAdminNavigation","AdminProjectChangeOwnerDirective","AdminProjectRequestOwnershipDirective","AdminProjectRestrictionsDirective","CsvExporterController","CsvExporterIssuesController","CsvExporterTasksController","CsvExporterUserstoriesController","CsvIssueDirective","CsvTaskDirective","CsvUsDirective","ProjectDefaultValuesDirective","ProjectExportDirective","ProjectLogoDirective","ProjectLogoModelDirective","ProjectModulesDirective","ProjectProfileController","ProjectProfileDirective","tgAuth","prioritiesList","severitiesList","issueTypesList","openDeleteLightbox","newUrl","fetchProject","newVal","oldVal","videoconferences_extra_data","videoconferences","isVideoconferenceActivated","asyn_message","buttonsEl","dump_ready_text","hideButtons","hideResult","hideSpinner","loading_msg","loading_title","resultEl","resultMessageEl","resultTitleEl","setAsyncMessage","setAsyncTitle","setLoadingMessage","setLoadingTitle","setSyncMessage","setSyncTitle","showButtons","showErrorMode","showExportResultAsyncMode","showExportResultSyncMode","showLoadingMode","showResult","showSpinner","spinnerEl","syn_message","dumpUrl","_generateUuid","setCsvUuid","csvUrl","resolveAbsolute","csvUuid","uuid","regenerateUuid","sectionTitle","showSizeInfo","logoAttachment","changeLogo","removeLogo","$parse","modelSetter","tgProjectLogoModel","requestOwnership","changeOwner","project-id","active-users","current-owner-id","ColorSelectionDirective","ProjectCustomAttributesController","ProjectCustomAttributesDirective","ProjectValuesController","ProjectValuesDirective","ProjectValuesSectionController","moveValue","loadValues","resource","listValues","maxValueOrder","maxBy","itemValue","linkDragAndDrop","linkValue","direction","cancel","goToBottomList","initializeNewValue","initializeTextTranslations","objName","saveNewValue","saveValue","valueType","objname","addNewElementText","table","formEl","row","editionRow","option","onSucces","moveTo","moveCustomAttributes","deleteCustomAttribute","saveCustomAttribute","createCustomAttribute","loadCustomAttributes","maxOrder","attrValues","attrModel","newIndex","idx","cancelCreate","cancelUpdate","hideAddButton","hideCancelButton","hideCreateForm","hideEditForm","resetNewAttr","revertChangesInCustomAttribute","showAddButton","showCancelButton","showCreateForm","showEditForm","sortableEl","itemAttr","newAttr","EditRoleDirective","NewRoleDirective","RolePermissionsDirective","RolesController","RolesDirective","_disableComputable","_enableComputable","anyComputableRole","computable","loadRoles","public_permission","external_user","public_permissions","askOnError","askOnSuccess","toggleComputable","toggleView","toggle","DEFAULT_PERMISSIONS","insertPosition","baseTemplate","categoryTemplate","resumeTemplate","generateCategoriesFromRole","renderCategory","renderPermissions","renderResume","categories","isPermissionEditable","issuePermissions","milestonePermissions","setActivePermissions","setActivePermissionsPerCategory","taskPermissions","userStoryPermissions","wikiPermissions","active","is_private","cat","activePermissions","getActivePermissions","categoryId","anon_permissions","BitbucketController","BitbucketWebhooksDirective","GithubController","GithubWebhooksDirective","GitlabController","GitlabWebhooksDirective","NewWebhookDirective","SelectInputText","ValidOriginIpsDirective","WebhookDirective","WebhooksController","loadWebhooks","openHistory","showEditMode","showVisualizationMode","updateLogs","updateShowHideHistoryText","webhook","tgWebhook","validStatus","prettySentHeaders","toPairs","request_headers","arg","prettySentData","request_data","created","logs_counter","logs","historyElement","textElement","test","resend","addWebhookDOMNode","formDOMNode","loadModules","github","gitlab","bitbucket","saveAttribute","$ngModel","createProjectRestrictionDirective","CreateProject","DeleteProjectDirective","$projectUrl","$cacheFactory","removeAll","error_field","selectors","creation_template","head","projectToDelete","BindHtmlDirective","BindOnceAltDirective","BindOnceBindDirective","BindOnceHrefDirective","BindOnceHtmlDirective","BindOnceRefDirective","BindOnceSrcDirective","BindOnceTitleDirective","BindTitleDirective","tgBoBind","tgBoHtml","tgBoRef","tgBoSrc","tgBoHref","tgBoAlt","tgBoTitle","tgTitleHtml","tgBindHtml","ConfigurationService","has","ContribController","ContribUserSettingsController","currentPlugin","FiltersStorageService","HttpService","cacheFactory","locationFactory","lastRoute","Model","ModelService","dataTypes","_attrs","_name","_dataTypes","setAttrs","_modifiedAttrs","_isModified","applyCasts","attrName","castMethod","castName","casts","getIdAttrName","getName","getter","self","setter","substr","enumerable","configurable","isAttributeModified","markSaved","desSerialize","sdata","ddata","$http","$gmUrls","$gmStorage","cls","int","float","NavigationUrlsDirective","NavigationUrlsService","formatUrl","replacer","bindOnceP","parseNav","param","tgNavGetParams","tgNav","fullUrl","getURLParams","getURLParamsStr","metaKey","ctrlKey","RepositoryService","model1","resolveUrlForModel","idAttrName","resolveUrlForAttributeModel","extraParams","_data","_status","queryMany","httpOptions","enablePagination","queryOneAttribute","queryOneRaw","queryPaginated","queryOnePaginatedRaw","wikipage","StorageService","_default","serializedValue","getItem","setItem","removeItem","UrlsService","fmt","mainUrl","trimEnd","resourceProvider","_get","userstory","_list","filtersHashSuffix","hashSuffix","myFiltersHashSuffix","getQueryParams","listInAllProjects","project_id","bulk_issues","ns","innerPromise","hashSuffixStatusColumnModes","hashSuffixStatusViewModes","listByUser","invitation_extra_text","bulk_memberships","notifyPolicies","listByMember","memberId","bulkUpdateOrder","bulkData","regenerate_userstories_csv_uuid","regenerate_issues_csv_uuid","regenerate_tasks_csv_uuid","statusUpdater","complete","failed","maxFileSize","uploadComplete","uploadFailed","uploadProgress","fileName","fileSize","evt","loaded","uploadedSize","totalSize","responseText","getResponseHeader","FormData","XMLHttpRequest","setRequestHeader","transformRequest","identity","deferredAbort","get_all","noop","hashSuffixUsRowModes","userStoryId","sprint_id","bulk_tasks","changeAvatar","removeAvatar","changePassword","currentPassword","newPassword","current_password","userSettings","contacts","status_id","bulk_stories","webhookId","webhooklogId","UserChangePasswordController","UserChangePasswordDirective","newPassword1","newPassword2","DeleteUserDirective","TaigaAvatarModelDirective","UserAvatarDirective","UserProfileDirective","UserSettingsController","getLan","getTheme","maxFileSizeMsg","availableThemes","avatarAttachment","tgAvatarModel","UserSettingsNavigationDirective","tgUserSettingsNavigation","UserNotificationsController","UserNotificationsDirective","UserNotificationsListDirective","policy","policyIndex","prev_level","notify_level","AttachmentLinkDirective","tgAttachmentLink","AttachmentGalleryDirective","onDelete","AttachmentController","editMode","mergeIn","AttachmentDirective","AttachmentsDropDirective","eventAttr","tgAttachmentsDrop","AttachmentsFullController","deprecatedsCount","attachmentsVisible","deprecatedsVisible","uploadingAttachments","objId","setMode","toggleDeprecatedsVisible","addAttachments","loadAttachments","toDeleteAttachment","errorMessage","reorderAttachment","updateAttachment","toUpdateAttachment","hasPermission","editPermission","showAttachments","AttachmentsFullDirective","AttachmentsFullService","_attachments","_deprecatedsCount","_attachmentsVisible","_deprecatedsVisible","regenerate","it","uploading","Map","oldIndex","setIn","oldAttachment","AttachmentsSimpleController","onAdd","AttachmentsSimpleDirective","AttachmentSortableDirective","tgAttachmentsSortable","AutoSelectDirective","$timeout","FileChangeDirective","tgFileChange","JoyRideDirective","joyRideService","initJoyrRide","intro","unsuscribe","introJs","oncomplete","onexit","disableJoyRide","setOptions","exitOnEsc","exitOnOverlayClick","showStepNumbers","nextLabel","prevLabel","skipLabel","doneLabel","disableInteraction","setOption","loadJoyRideConfig","exit","JoyRideService","getConfig","dashboard","steps","position","joyRide","joyRides","LiveAnnouncementDirective","defineProperties","LiveAnnouncementService","ProjectLogoBigSrcDirective","projectLogoService","logo","projectLogo","getDefaultProjectLogo","ProjectLogoSmallSrcDirective","ProjectMenuController","menu","_getActiveSection","_setVideoConference","_setMenuPermissions","videoconferenceUrl","_videoConferenceUrl","indexBacklog","indexKanban","oldSectionName","sectionsBreadcrumb","baseUrl","ProjectMenuDirective","projectChange","vm","fixed","TermsOfServiceAndPrivacyPolicyNoticeDirective","privacyPolicyUrl","termsOfServiceUrl","VoteButtonController","isMouseOver","showTextWhenMouseIsOver","showTextWhenMouseIsLeave","toggleVote","is_voter","_downvote","_upvote","VoteButtonDirective","WatchButtonController","openWatchers","getPerms","toggleWatch","is_watcher","_unwatch","_watch","WatchButtonDirective","attributes","environment","DiscoverHomeOrderByController","is_open","week","month","year","currentText","currentOrderBy","orderBy","onChange","DiscoverHomeOrderByDirective","DiscoverSearchBarController","discoverProjectsService","projectsCount","fetchStats","submitFilter","DiscoverSearchBarDirective","DiscoverSearchListHeaderController","like_is_open","activity_is_open","openLike","setOrderBy","openActivity","DiscoverSearchListHeaderDirective","FeaturedProjectsController","featured","fetchFeatured","FeaturedProjectsDirective","HighlightedDirective","highlighted","MostActiveController","mostActive","getOrderBy","fetch","fetchMostActive","MostActiveDirective","MostLikedController","mostLiked","fetchMostLiked","MostLikedDirective","DiscoverHomeController","onSubmit","DiscoverSearchController","routeParams","searchResult","nextSearchPage","loadingGlobal","loadingList","loadingPagination","resetSearchList","fetchByGlobalSearch","fetchByOrderBy","getFilter","fetchSearch","is_looking_for_people","onChangeFilter","updateParams","onChangeOrder","DiscoverSearchDirective","DiscoverProjectsService","projectsService","_mostLiked","_mostActive","_featured","_searchResult","_projectsCount","decorate","_decorate","_nextSearchPage","_discoverParams","discover_mode","_params","getProjects","is_featured","ExternalAppController","externalAppsService","xhrError","loginUrl","createApplicationToken","_getApplicationToken","_redirect","_applicationId","application","_state","state","_user","_application","loginWithAnotherUserUrl","applicationToken","getApplicationToken","back","authorizeApplicationToken","ExternalAppsService","applicationId","externalapps","FeedbackService","sendFeedback","DutyDirective","navurls","duty","getDutyType","HomeController","HomeService","_attachProjectInfoToWorkInProgress","workInProgress","projectsById","_attachProjectInfoToDuty","_duties","watching","objType","getWorkInProgress","assignedIssuesPromise","assignedTasksPromise","assignedUserStoriesPromise","params_us","projectsPromise","watchingIssuesPromise","watchingTasksPromise","watchingUserStoriesPromise","getProjectsByUserId","p","status__is_closed","HomeProjectListDirective","newProject","WorkingOnController","homeService","_setAssignedTo","elem","_setWatching","WorkingOnDirective","DropdownProjectListDirective","DropdownUserDirective","authService","configService","locationService","navUrlsService","isFeedbackEnabled","userMenu","NavigationBarDirective","isEnabledHeader","NavigationBarService","enabledHeader","ProfileBarController","userService","loadStats","getStats","ProfileBarDirective","ProfileContactsController","loadContacts","getContacts","ProfileContactsDirective","FavItemDirective","itemType","FavsBaseController","ProfileLikedController","ProfileVotedController","ProfileWatchedController","_init","enableFilterByAll","enableFilterByProjects","enableFilterByUserStories","enableFilterByTasks","enableFilterByIssues","enableFilterByTextQuery","_resetList","scrollDisabled","_page","_enableLoadingSpinner","isLoading","_disableLoadingSpinner","_enableScroll","_disableScroll","_checkIfHasMorePages","hasNext","_checkIfHasNoResults","hasNoResults","loadItems","_getItems","filterByTextQuery","showAll","showProjectsOnly","showUserStoriesOnly","showTasksOnly","showIssuesOnly","getLiked","getVoted","getWatched","ProfileLikedDirective","ProfileVotedDirective","ProfileWatchedDirective","ProfileHints","hintKey","HINTS","hint","linkText","ProfileProjectsController","attachUserContactsToProjects","ProfileProjectsDirective","ProfileTabDirective","transclude","tab","tabIcon","tabActive","tabDisabled","addTab","ProfileTabsController","tabs","toggleTab","ProfileTabsDirective","ProfileController","getUserByUserName","notFound","userUsername","BlockedProjectExplanationDirective","LikeProjectButtonController","likeButtonService","toggleLike","_unlike","_like","like","unlike","LikeProjectButtonDirective","LikeProjectButtonService","_getProjectIndex","_updateProjects","isFan","projectIndex","totalFans","is_fan","total_fans","setProjects","_updateCurrentProject","setProject","likeProject","unlikeProject","SortProjectsDirective","sortData","sorted_project_ids","bulkUpdateProjectsOrder","WatchProjectButtonController","watchButtonService","showWatchOptions","toggleWatcherOptions","closeWatcherOptions","notifyLevel","WatchProjectButtonDirective","WatchProjectButtonService","isWatcher","totalWatchers","total_watchers","watchProject","unwatchProject","ProjectsListingController","ProjectController","activeMembers","setfn","metas","ProjectsService","projectUrl","getProjectBySlug","getProjectStats","paginate","colorized_tags","transferValidateToken","transferAccept","reason","transferReject","CantOwnProjectExplanationDirective","TransferProject","showAddComment","_refreshUserData","_validateToken","_setProjectData","_checkOwnerData","canBeOwnedByUser","canOwnProject","ownerMessage","maxProjects","currentProjects","validNumberOfMemberships","loadingAccept","loadingReject","addComment","hideComment","TransferProjectDirective","Resource","urlsService","urlname","object_id","x-disable-pagination","progressMessage","progressPercent","pagination","paginateResponseService","x-lazy-pagination","getTimeline","only_relevant","Resources","services","serviceFn","serviceName","serviceProperty","warm","getUserStorage","setUserStorage","createUserStorage","getUserByUsername","getProfileTimeline","getUserTimeline","AppMetaService","_set","meta","setTitle","setDescription","setTwitterMetas","origin","setOpenGraphMetas","listener","_listener","$watchCollection","AttachmentsService","getMaxFileSize","maxFileSizeFormated","sizeError","saveError","ChekcPermissionsService","CurrentUserService","storageService","_projects","_projectsById","_joyride","_loadUserInfo","LightboxFactory","compile","scopeAttrs","PaginateResponse","paginateResponse","ProjectLogoService","modulo","COLORS","IMAGES","logos","murmurhash3_32_gc","ProjectService","_project","_section","_sectionsBreadcrumb","_activeMembers","ThemeService","themeName","stylesheetEl","UserService","pageNumber","objectType","textQuery","contactsFiltered","contact","contactId","permissionDenied","UserTimelineAttachmentDirective","validFileExtensions","extension","is_image","templateHtml","UserTimelineItemTitle","sce","_fieldTranslationKey","timeline","title_attr","_getLink","_getUsernameSpan","field_name","new_value","sprint_name","us_name","event_us","_getTimelineObj","_getDetailObjUrl","obj_name","role_name","keySeq","_translateTitleParams","parent_userstory","_getParams","timeline_type","translate_params","getTitle","paramsKeys","translation","UserTimelineType","timelineType","hasIn","getType","UserTimelineItemDirective","UserTimelinePaginationSequence","generate","getContent","minItems","UserTimelineController","userTimelineService","timelineList","getProjectTimeline","loadTimeline","UserTimelineDirective","UserTimelineService","userTimelinePaginationSequenceService","userTimelineItemType","userTimelineItemTitle","_valid_fields","_invalid","fieldKey","value_diff","_isInValidTimeline","invalid","_parseEventType","event_type","_getTimelineObject","_attachExtraInfoToTimelineEntry","_parseTimeline","newdata","newItem","blocked","moveInBacklog","deleteIn","_addEntyAttributes","filterNot"],"mappings":"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","file":"app.js","sourceRoot":"/source/","sourcesContent":["\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app.coffee\n */\n\n(function() {\n  var configure, i18nInit, init, module, modules, pluginsWithModule, taiga;\n\n  this.taiga = taiga = {};\n\n  this.taigaContribPlugins = this.taigaContribPlugins || window.taigaContribPlugins || [];\n\n  taiga.generateHash = function(components) {\n    if (components == null) {\n      components = [];\n    }\n    components = _.map(components, function(x) {\n      return JSON.stringify(x);\n    });\n    return hex_sha1(components.join(\":\"));\n  };\n\n  taiga.generateUniqueSessionIdentifier = function() {\n    var date, randomNumber;\n    date = (new Date()).getTime();\n    randomNumber = Math.floor(Math.random() * 0x9000000);\n    return taiga.generateHash([date, randomNumber]);\n  };\n\n  taiga.sessionId = taiga.generateUniqueSessionIdentifier();\n\n  configure = function($routeProvider, $locationProvider, $httpProvider, $provide, $tgEventsProvider, $compileProvider, $translateProvider, $translatePartialLoaderProvider, $animateProvider) {\n    var authHttpIntercept, blockingIntercept, decorators, defaultHeaders, loaderIntercept, originalWhen, preferedLangCode, userInfo, versionCheckHttpIntercept;\n    $animateProvider.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/);\n    originalWhen = $routeProvider.when;\n    $routeProvider.when = function(path, route) {\n      route.resolve || (route.resolve = {});\n      angular.extend(route.resolve, {\n        languageLoad: [\n          \"$q\", \"$translate\", function($q, $translate) {\n            var deferred;\n            deferred = $q.defer();\n            $translate().then(function() {\n              return deferred.resolve();\n            });\n            return deferred.promise;\n          }\n        ]\n      });\n      return originalWhen.call($routeProvider, path, route);\n    };\n    $routeProvider.when(\"/\", {\n      templateUrl: \"home/home.html\",\n      controller: \"Home\",\n      controllerAs: \"vm\",\n      loader: true,\n      title: \"HOME.PAGE_TITLE\",\n      loader: true,\n      description: \"HOME.PAGE_DESCRIPTION\",\n      joyride: \"dashboard\"\n    });\n    $routeProvider.when(\"/discover\", {\n      templateUrl: \"discover/discover-home/discover-home.html\",\n      controller: \"DiscoverHome\",\n      controllerAs: \"vm\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true\n    });\n    $routeProvider.when(\"/discover/search\", {\n      templateUrl: \"discover/discover-search/discover-search.html\",\n      title: \"PROJECT.NAVIGATION.DISCOVER\",\n      loader: true,\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      reloadOnSearch: false\n    });\n    $routeProvider.when(\"/projects/\", {\n      templateUrl: \"projects/listing/projects-listing.html\",\n      access: {\n        requiresLogin: true\n      },\n      title: \"PROJECTS.PAGE_TITLE\",\n      description: \"PROJECTS.PAGE_DESCRIPTION\",\n      loader: true,\n      controller: \"ProjectsListing\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/blocked-project/:pslug/\", {\n      templateUrl: \"projects/project/blocked-project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/project/:pslug/\", {\n      templateUrl: \"projects/project/project.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\",\n      section: \"project-timeline\"\n    });\n    $routeProvider.when(\"/project/:pslug/search\", {\n      templateUrl: \"search/search.html\",\n      reloadOnSearch: false,\n      section: \"search\",\n      loader: true\n    });\n    $routeProvider.when(\"/project/:pslug/backlog\", {\n      templateUrl: \"backlog/backlog.html\",\n      loader: true,\n      section: \"backlog\",\n      joyride: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/kanban\", {\n      templateUrl: \"kanban/kanban.html\",\n      loader: true,\n      section: \"kanban\",\n      joyride: \"kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/taskboard/:sslug\", {\n      templateUrl: \"taskboard/taskboard.html\",\n      loader: true,\n      section: \"backlog\"\n    });\n    $routeProvider.when(\"/project/:pslug/us/:usref\", {\n      templateUrl: \"us/us-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/task/:taskref\", {\n      templateUrl: \"task/task-detail.html\",\n      loader: true,\n      section: \"backlog-kanban\"\n    });\n    $routeProvider.when(\"/project/:pslug/wiki\", {\n      redirectTo: function(params) {\n        return \"/project/\" + params.pslug + \"/wiki/home\";\n      }\n    });\n    $routeProvider.when(\"/project/:pslug/wiki/:slug\", {\n      templateUrl: \"wiki/wiki.html\",\n      loader: true,\n      section: \"wiki\"\n    });\n    $routeProvider.when(\"/project/:pslug/team\", {\n      templateUrl: \"team/team.html\",\n      loader: true,\n      section: \"team\"\n    });\n    $routeProvider.when(\"/project/:pslug/issues\", {\n      templateUrl: \"issue/issues.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/issue/:issueref\", {\n      templateUrl: \"issue/issues-detail.html\",\n      loader: true,\n      section: \"issues\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/details\", {\n      templateUrl: \"admin/admin-project-profile.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/default-values\", {\n      templateUrl: \"admin/admin-project-default-values.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/modules\", {\n      templateUrl: \"admin/admin-project-modules.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/export\", {\n      templateUrl: \"admin/admin-project-export.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-profile/reports\", {\n      templateUrl: \"admin/admin-project-reports.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/status\", {\n      templateUrl: \"admin/admin-project-values-status.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/points\", {\n      templateUrl: \"admin/admin-project-values-points.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/priorities\", {\n      templateUrl: \"admin/admin-project-values-priorities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/severities\", {\n      templateUrl: \"admin/admin-project-values-severities.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/types\", {\n      templateUrl: \"admin/admin-project-values-types.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/project-values/custom-fields\", {\n      templateUrl: \"admin/admin-project-values-custom-fields.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/memberships\", {\n      templateUrl: \"admin/admin-memberships.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/roles\", {\n      templateUrl: \"admin/admin-roles.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/webhooks\", {\n      templateUrl: \"admin/admin-third-parties-webhooks.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/github\", {\n      templateUrl: \"admin/admin-third-parties-github.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/gitlab\", {\n      templateUrl: \"admin/admin-third-parties-gitlab.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/third-parties/bitbucket\", {\n      templateUrl: \"admin/admin-third-parties-bitbucket.html\",\n      section: \"admin\"\n    });\n    $routeProvider.when(\"/project/:pslug/admin/contrib/:plugin\", {\n      templateUrl: \"contrib/main.html\"\n    });\n    $routeProvider.when(\"/project/:pslug/transfer/:token\", {\n      templateUrl: \"projects/transfer/transfer-page.html\",\n      loader: true,\n      controller: \"Project\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/user-settings/user-profile\", {\n      templateUrl: \"user/user-profile.html\"\n    });\n    $routeProvider.when(\"/user-settings/user-change-password\", {\n      templateUrl: \"user/user-change-password.html\"\n    });\n    $routeProvider.when(\"/user-settings/mail-notifications\", {\n      templateUrl: \"user/mail-notifications.html\"\n    });\n    $routeProvider.when(\"/change-email/:email_token\", {\n      templateUrl: \"user/change-email.html\"\n    });\n    $routeProvider.when(\"/cancel-account/:cancel_token\", {\n      templateUrl: \"user/cancel-account.html\"\n    });\n    $routeProvider.when(\"/user-settings/contrib/:plugin\", {\n      templateUrl: \"contrib/user-settings.html\"\n    });\n    $routeProvider.when(\"/profile\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      access: {\n        requiresLogin: true\n      },\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/profile/:slug\", {\n      templateUrl: \"profile/profile.html\",\n      loader: true,\n      controller: \"Profile\",\n      controllerAs: \"vm\"\n    });\n    $routeProvider.when(\"/login\", {\n      templateUrl: \"auth/login.html\",\n      title: \"LOGIN.PAGE_TITLE\",\n      description: \"LOGIN.PAGE_DESCRIPTION\",\n      disableHeader: true,\n      controller: \"LoginPage\"\n    });\n    $routeProvider.when(\"/register\", {\n      templateUrl: \"auth/register.html\",\n      title: \"REGISTER.PAGE_TITLE\",\n      description: \"REGISTER.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/forgot-password\", {\n      templateUrl: \"auth/forgot-password.html\",\n      title: \"FORGOT_PASSWORD.PAGE_TITLE\",\n      description: \"FORGOT_PASSWORD.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/change-password/:token\", {\n      templateUrl: \"auth/change-password-from-recovery.html\",\n      title: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      description: \"CHANGE_PASSWORD.PAGE_TITLE\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/invitation/:token\", {\n      templateUrl: \"auth/invitation.html\",\n      title: \"INVITATION.PAGE_TITLE\",\n      description: \"INVITATION.PAGE_DESCRIPTION\",\n      disableHeader: true\n    });\n    $routeProvider.when(\"/external-apps\", {\n      templateUrl: \"external-apps/external-app.html\",\n      title: \"EXTERNAL_APP.PAGE_TITLE\",\n      description: \"EXTERNAL_APP.PAGE_DESCRIPTION\",\n      controller: \"ExternalApp\",\n      controllerAs: \"vm\",\n      disableHeader: true,\n      mobileViewport: true\n    });\n    $routeProvider.when(\"/error\", {\n      templateUrl: \"error/error.html\"\n    });\n    $routeProvider.when(\"/not-found\", {\n      templateUrl: \"error/not-found.html\"\n    });\n    $routeProvider.when(\"/permission-denied\", {\n      templateUrl: \"error/permission-denied.html\"\n    });\n    $routeProvider.otherwise({\n      redirectTo: \"/not-found\"\n    });\n    $locationProvider.html5Mode({\n      enabled: true,\n      requireBase: false\n    });\n    defaultHeaders = {\n      \"Content-Type\": \"application/json\",\n      \"Accept-Language\": window.taigaConfig.defaultLanguage || \"en\",\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.defaults.headers[\"delete\"] = defaultHeaders;\n    $httpProvider.defaults.headers.patch = defaultHeaders;\n    $httpProvider.defaults.headers.post = defaultHeaders;\n    $httpProvider.defaults.headers.put = defaultHeaders;\n    $httpProvider.defaults.headers.get = {\n      \"X-Session-Id\": taiga.sessionId\n    };\n    $httpProvider.useApplyAsync(true);\n    $tgEventsProvider.setSessionId(taiga.sessionId);\n    authHttpIntercept = function($q, $location, $navUrls, $lightboxService) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var nextUrl;\n        if (response.status === 0 || (response.status === -1 && !response.config.cancelable)) {\n          $lightboxService.closeAll();\n          $location.path($navUrls.resolve(\"error\"));\n          $location.replace();\n        } else if (response.status === 401 && $location.url().indexOf('/login') === -1) {\n          nextUrl = encodeURIComponent($location.url());\n          $location.url($navUrls.resolve(\"login\")).search(\"next=\" + nextUrl);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"authHttpIntercept\", [\"$q\", \"$location\", \"$tgNavUrls\", \"lightboxService\", authHttpIntercept]);\n    $httpProvider.interceptors.push(\"authHttpIntercept\");\n    loaderIntercept = function($q, loaderService) {\n      return {\n        request: function(config) {\n          loaderService.logRequest();\n          return config;\n        },\n        requestError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        responseError: function(rejection) {\n          loaderService.logResponse();\n          return $q.reject(rejection);\n        },\n        response: function(response) {\n          loaderService.logResponse();\n          return response;\n        }\n      };\n    };\n    $provide.factory(\"loaderIntercept\", [\"$q\", \"tgLoader\", loaderIntercept]);\n    $httpProvider.interceptors.push(\"loaderIntercept\");\n    versionCheckHttpIntercept = function($q) {\n      var httpResponseError;\n      httpResponseError = function(response) {\n        var $injector;\n        if (response.status === 400 && response.data.version) {\n          $injector = angular.element(\"body\").injector();\n          $injector.invoke([\n            \"$tgConfirm\", \"$translate\", (function(_this) {\n              return function($confirm, $translate) {\n                var versionErrorMsg;\n                versionErrorMsg = $translate.instant(\"ERROR.VERSION_ERROR\");\n                return $confirm.notify(\"error\", versionErrorMsg, null, 10000);\n              };\n            })(this)\n          ]);\n        }\n        return $q.reject(response);\n      };\n      return {\n        responseError: httpResponseError\n      };\n    };\n    $provide.factory(\"versionCheckHttpIntercept\", [\"$q\", versionCheckHttpIntercept]);\n    $httpProvider.interceptors.push(\"versionCheckHttpIntercept\");\n    blockingIntercept = function($q, $routeParams, $location, $navUrls) {\n      var redirectToBlockedPage, responseError, responseOk;\n      redirectToBlockedPage = function() {\n        var blockedUrl, currentUrl, pslug;\n        pslug = $routeParams.pslug;\n        blockedUrl = $navUrls.resolve(\"blocked-project\", {\n          project: pslug\n        });\n        currentUrl = $location.url();\n        if (currentUrl.indexOf(blockedUrl) === -1) {\n          return $location.replace().path(blockedUrl);\n        }\n      };\n      responseOk = function(response) {\n        if (response.data.blocked_code) {\n          redirectToBlockedPage();\n        }\n        return response;\n      };\n      responseError = function(response) {\n        if (response.status === 451) {\n          redirectToBlockedPage();\n        }\n        return $q.reject(response);\n      };\n      return {\n        response: responseOk,\n        responseError: responseError\n      };\n    };\n    $provide.factory(\"blockingIntercept\", [\"$q\", \"$routeParams\", \"$location\", \"$tgNavUrls\", blockingIntercept]);\n    $httpProvider.interceptors.push(\"blockingIntercept\");\n    $compileProvider.debugInfoEnabled(window.taigaConfig.debugInfo || false);\n    if (localStorage.userInfo) {\n      userInfo = JSON.parse(localStorage.userInfo);\n    }\n    preferedLangCode = (userInfo != null ? userInfo.lang : void 0) || window.taigaConfig.defaultLanguage || \"en\";\n    $translatePartialLoaderProvider.addPart('taiga');\n    $translateProvider.useLoader('$translatePartialLoader', {\n      urlTemplate: '/' + window._version + '/locales/{part}/locale-{lang}.json'\n    }).useSanitizeValueStrategy('escapeParameters').addInterpolation('$translateMessageFormatInterpolation').preferredLanguage(preferedLangCode);\n    $translateProvider.fallbackLanguage(preferedLangCode);\n    decorators = window.getDecorators();\n    return _.each(decorators, function(decorator) {\n      return $provide.decorator(decorator.provider, decorator.decorator);\n    });\n  };\n\n  i18nInit = function(lang, $translate) {\n    var messages;\n    moment.locale(lang);\n    if (lang !== 'en') {\n      ljs.load((\"/\" + window._version + \"/locales/moment-locales/\") + lang + \".js\");\n    }\n    messages = {\n      defaultMessage: $translate.instant(\"COMMON.FORM_ERRORS.DEFAULT_MESSAGE\"),\n      type: {\n        email: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_EMAIL\"),\n        url: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URL\"),\n        urlstrict: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_URLSTRICT\"),\n        number: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_NUMBER\"),\n        digits: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DIGITS\"),\n        dateIso: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_DATEISO\"),\n        alphanum: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_ALPHANUM\"),\n        phone: $translate.instant(\"COMMON.FORM_ERRORS.TYPE_PHONE\")\n      },\n      notnull: $translate.instant(\"COMMON.FORM_ERRORS.NOTNULL\"),\n      notblank: $translate.instant(\"COMMON.FORM_ERRORS.NOT_BLANK\"),\n      required: $translate.instant(\"COMMON.FORM_ERRORS.REQUIRED\"),\n      regexp: $translate.instant(\"COMMON.FORM_ERRORS.REGEXP\"),\n      min: $translate.instant(\"COMMON.FORM_ERRORS.MIN\"),\n      max: $translate.instant(\"COMMON.FORM_ERRORS.MAX\"),\n      range: $translate.instant(\"COMMON.FORM_ERRORS.RANGE\"),\n      minlength: $translate.instant(\"COMMON.FORM_ERRORS.MIN_LENGTH\"),\n      maxlength: $translate.instant(\"COMMON.FORM_ERRORS.MAX_LENGTH\"),\n      rangelength: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_LENGTH\"),\n      mincheck: $translate.instant(\"COMMON.FORM_ERRORS.MIN_CHECK\"),\n      maxcheck: $translate.instant(\"COMMON.FORM_ERRORS.MAX_CHECK\"),\n      rangecheck: $translate.instant(\"COMMON.FORM_ERRORS.RANGE_CHECK\"),\n      equalto: $translate.instant(\"COMMON.FORM_ERRORS.EQUAL_TO\"),\n      linewidth: $translate.instant(\"COMMON.FORM_ERRORS.LINEWIDTH\"),\n      pikaday: $translate.instant(\"COMMON.FORM_ERRORS.PIKADAY\")\n    };\n    return checksley.updateMessages('default', messages);\n  };\n\n  init = function($log, $rootscope, $auth, $events, $analytics, $translate, $location, $navUrls, appMetaService, projectService, loaderService, navigationBarService) {\n    var un, user, validators;\n    $log.debug(\"Initialize application\");\n    $rootscope.$on('$translatePartialLoaderStructureChanged', function() {\n      return $translate.refresh();\n    });\n    validators = {\n      linewidth: function(val, width) {\n        var lines, valid;\n        lines = taiga.nl2br(val).split(\"<br />\");\n        valid = _.every(lines, function(line) {\n          return line.length < width;\n        });\n        return valid;\n      },\n      pikaday: function(val) {\n        var prettyDate;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        return moment(val, prettyDate).isValid();\n      }\n    };\n    checksley.updateValidators(validators);\n    $rootscope.contribPlugins = this.taigaContribPlugins;\n    $rootscope.adminPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"admin\"\n    });\n    $rootscope.userSettingsPlugins = _.filter(this.taigaContribPlugins, {\n      \"type\": \"userSettings\"\n    });\n    $rootscope.$on(\"$translateChangeEnd\", function(e, ctx) {\n      var lang;\n      lang = ctx.language;\n      return i18nInit(lang, $translate);\n    });\n    Promise.setScheduler(function(cb) {\n      return $rootscope.$evalAsync(cb);\n    });\n    $events.setupConnection();\n    if ($auth.isAuthenticated()) {\n      user = $auth.getUser();\n    }\n    $analytics.initialize();\n    un = $rootscope.$on('$routeChangeStart', function(event, next) {\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      return un();\n    });\n    return $rootscope.$on('$routeChangeSuccess', function(event, next) {\n      var description, title;\n      if (next.loader) {\n        loaderService.start(true);\n      }\n      if (next.access && next.access.requiresLogin) {\n        if (!$auth.isAuthenticated()) {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n      }\n      projectService.setSection(next.section);\n      if (next.params.pslug) {\n        projectService.setProjectBySlug(next.params.pslug);\n      } else {\n        projectService.cleanProject();\n      }\n      if (next.title || next.description) {\n        title = $translate.instant(next.title || \"\");\n        description = $translate.instant(next.description || \"\");\n        appMetaService.setAll(title, description);\n      }\n      if (next.mobileViewport) {\n        appMetaService.addMobileViewport();\n      } else {\n        appMetaService.removeMobileViewport();\n      }\n      if (next.disableHeader) {\n        return navigationBarService.disableHeader();\n      } else {\n        return navigationBarService.enableHeader();\n      }\n    });\n  };\n\n  pluginsWithModule = _.filter(this.taigaContribPlugins, function(plugin) {\n    return plugin.module;\n  });\n\n  angular.module('infinite-scroll').value('THROTTLE_MILLISECONDS', 500);\n\n  modules = [\"taigaBase\", \"taigaCommon\", \"taigaResources\", \"taigaResources2\", \"taigaAuth\", \"taigaEvents\", \"taigaHome\", \"taigaNavigationBar\", \"taigaProjects\", \"taigaRelatedTasks\", \"taigaBacklog\", \"taigaTaskboard\", \"taigaKanban\", \"taigaIssues\", \"taigaUserStories\", \"taigaTasks\", \"taigaTeam\", \"taigaWiki\", \"taigaSearch\", \"taigaAdmin\", \"taigaProject\", \"taigaUserSettings\", \"taigaFeedback\", \"taigaPlugins\", \"taigaIntegrations\", \"taigaComponents\", \"taigaProfile\", \"taigaHome\", \"taigaUserTimeline\", \"taigaExternalApps\", \"taigaDiscover\", \"templates\", \"ngSanitize\", \"ngRoute\", \"ngAnimate\", \"ngAria\", \"pascalprecht.translate\", \"infinite-scroll\", \"tgRepeat\"].concat(_.map(pluginsWithModule, function(plugin) {\n    return plugin.module;\n  }));\n\n  module = angular.module(\"taiga\", modules);\n\n  module.config([\"$routeProvider\", \"$locationProvider\", \"$httpProvider\", \"$provide\", \"$tgEventsProvider\", \"$compileProvider\", \"$translateProvider\", \"$translatePartialLoaderProvider\", \"$animateProvider\", configure]);\n\n  module.run([\"$log\", \"$rootScope\", \"$tgAuth\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"tgProjectService\", \"tgLoader\", \"tgNavigationBarService\", \"$route\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: classes.coffee\n */\n\n(function() {\n  var TaigaBase, TaigaController, TaigaService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  TaigaBase = (function() {\n    function TaigaBase() {}\n\n    return TaigaBase;\n\n  })();\n\n  TaigaService = (function(superClass) {\n    extend(TaigaService, superClass);\n\n    function TaigaService() {\n      return TaigaService.__super__.constructor.apply(this, arguments);\n    }\n\n    return TaigaService;\n\n  })(TaigaBase);\n\n  TaigaController = (function(superClass) {\n    extend(TaigaController, superClass);\n\n    function TaigaController() {\n      this.onInitialDataError = bind(this.onInitialDataError, this);\n      return TaigaController.__super__.constructor.apply(this, arguments);\n    }\n\n    TaigaController.prototype.onInitialDataError = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.location.path(this.navUrls.resolve(\"not-found\"));\n          this.location.replace();\n        } else if (xhr.status === 403) {\n          this.location.path(this.navUrls.resolve(\"permission-denied\"));\n          this.location.replace();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return TaigaController;\n\n  })(TaigaBase);\n\n  this.taiga.Base = TaigaBase;\n\n  this.taiga.Service = TaigaService;\n\n  this.taiga.Controller = TaigaController;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: utils.coffee\n */\n\n(function() {\n  var addClass, bindMethods, bindOnce, cancelTimeout, debounce, debounceLeading, defineImmutableProperty, groupBy, isImage, joinStr, mixOf, nl2br, patch, replaceTags, scopeDefer, sizeFormat, slugify, startswith, stripTags, taiga, timeout, toString, toggleText, trim, truncate, unslugify,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    slice = [].slice,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  addClass = function(el, className) {\n    if (el.classList) {\n      return el.classList.add(className);\n    } else {\n      return el.className += ' ' + className;\n    }\n  };\n\n  nl2br = (function(_this) {\n    return function(str) {\n      var breakTag;\n      breakTag = '<br />';\n      return (str + '').replace(/([^>\\r\\n]?)(\\r\\n|\\n\\r|\\r|\\n)/g, '$1' + breakTag + '$2');\n    };\n  })(this);\n\n  bindMethods = (function(_this) {\n    return function(object) {\n      var dependencies, methods;\n      dependencies = _.keys(object);\n      methods = [];\n      _.forIn(object, function(value, key) {\n        if (indexOf.call(dependencies, key) < 0) {\n          return methods.push(key);\n        }\n      });\n      return _.bindAll(object, methods);\n    };\n  })(this);\n\n  bindOnce = (function(_this) {\n    return function(scope, attr, continuation) {\n      var delBind, val;\n      val = scope.$eval(attr);\n      if (val !== void 0) {\n        return continuation(val);\n      }\n      delBind = null;\n      return delBind = scope.$watch(attr, function(val) {\n        if (val === void 0) {\n          return;\n        }\n        continuation(val);\n        if (delBind) {\n          return delBind();\n        }\n      });\n    };\n  })(this);\n\n  mixOf = function() {\n    var Mixed, base, i, method, mixin, mixins, name, ref;\n    base = arguments[0], mixins = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    Mixed = (function(superClass) {\n      extend(Mixed, superClass);\n\n      function Mixed() {\n        return Mixed.__super__.constructor.apply(this, arguments);\n      }\n\n      return Mixed;\n\n    })(base);\n    for (i = mixins.length - 1; i >= 0; i += -1) {\n      mixin = mixins[i];\n      ref = mixin.prototype;\n      for (name in ref) {\n        method = ref[name];\n        Mixed.prototype[name] = method;\n      }\n    }\n    return Mixed;\n  };\n\n  trim = function(data, char) {\n    return _.trim(data, char);\n  };\n\n  slugify = function(data) {\n    return data.toString().toLowerCase().trim().replace(/\\s+/g, '-').replace(/&/g, '-and-').replace(/[^\\w\\-]+/g, '').replace(/\\-\\-+/g, '-');\n  };\n\n  unslugify = function(data) {\n    if (data) {\n      return _.capitalize(data.replace(/-/g, ' '));\n    }\n    return data;\n  };\n\n  toggleText = function(element, texts) {\n    var nextTextPosition, text;\n    nextTextPosition = element.data('nextTextPosition');\n    if ((nextTextPosition == null) || nextTextPosition >= texts.length) {\n      nextTextPosition = 0;\n    }\n    text = texts[nextTextPosition];\n    element.data('nextTextPosition', nextTextPosition + 1);\n    return element.text(text);\n  };\n\n  groupBy = function(coll, pred) {\n    var i, item, len, result;\n    result = {};\n    for (i = 0, len = coll.length; i < len; i++) {\n      item = coll[i];\n      result[pred(item)] = item;\n    }\n    return result;\n  };\n\n  timeout = function(wait, continuation) {\n    return window.setTimeout(continuation, wait);\n  };\n\n  cancelTimeout = function(timeoutVar) {\n    return window.clearTimeout(timeoutVar);\n  };\n\n  scopeDefer = function(scope, func) {\n    return _.defer((function(_this) {\n      return function() {\n        return scope.$apply(func);\n      };\n    })(this));\n  };\n\n  toString = function(value) {\n    if (_.isNumber(value)) {\n      return value + \"\";\n    } else if (_.isString(value)) {\n      return value;\n    } else if (_.isPlainObject(value)) {\n      return JSON.stringify(value);\n    } else if (_.isUndefined(value)) {\n      return \"\";\n    }\n    return value.toString();\n  };\n\n  joinStr = function(str, coll) {\n    return coll.join(str);\n  };\n\n  debounce = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: true,\n      trailing: false\n    });\n  };\n\n  debounceLeading = function(wait, func) {\n    return _.debounce(func, wait, {\n      leading: false,\n      trailing: true\n    });\n  };\n\n  startswith = function(str1, str2) {\n    return _.startsWith(str1, str2);\n  };\n\n  truncate = function(str, maxLength, suffix) {\n    var out;\n    if (suffix == null) {\n      suffix = \"...\";\n    }\n    if ((typeof str !== \"string\") && !(str instanceof String)) {\n      return str;\n    }\n    out = str.slice(0);\n    if (out.length > maxLength) {\n      out = out.substring(0, maxLength + 1);\n      out = out.substring(0, Math.min(out.length, out.lastIndexOf(\" \")));\n      out = out + suffix;\n    }\n    return out;\n  };\n\n  sizeFormat = function(input, precision) {\n    var number, size, units;\n    if (precision == null) {\n      precision = 1;\n    }\n    if (isNaN(parseFloat(input)) || !isFinite(input)) {\n      return \"-\";\n    }\n    if (input === 0) {\n      return \"0 bytes\";\n    }\n    units = [\"bytes\", \"KB\", \"MB\", \"GB\", \"TB\", \"PB\"];\n    number = Math.floor(Math.log(input) / Math.log(1024));\n    if (number > 5) {\n      number = 5;\n    }\n    size = (input / Math.pow(1024, number)).toFixed(precision);\n    return size + \" \" + units[number];\n  };\n\n  stripTags = function(str, exception) {\n    var pattern;\n    if (exception) {\n      pattern = new RegExp('<(?!' + exception + '\\s*\\/?)[^>]+>', 'gi');\n      return String(str).replace(pattern, '');\n    } else {\n      return String(str).replace(/<\\/?[^>]+>/g, '');\n    }\n  };\n\n  replaceTags = function(str, tags, replace) {\n    var pattern;\n    pattern = new RegExp('<(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '<' + replace + '>');\n    pattern = new RegExp('<\\/(' + tags + ')>', 'gi');\n    str = str.replace(pattern, '</' + replace + '>');\n    return str;\n  };\n\n  defineImmutableProperty = (function(_this) {\n    return function(obj, name, fn) {\n      return Object.defineProperty(obj, name, {\n        get: function() {\n          var fn_result;\n          if (!_.isFunction(fn)) {\n            throw \"defineImmutableProperty third param must be a function\";\n          }\n          fn_result = fn();\n          if (fn_result && _.isObject(fn_result)) {\n            if (fn_result.size === void 0) {\n              throw \"defineImmutableProperty must return immutable data\";\n            }\n          }\n          return fn_result;\n        }\n      });\n    };\n  })(this);\n\n  _.mixin({\n    removeKeys: function(obj, keys) {\n      return _.chain([keys]).flatten().reduce(function(obj, key) {\n        delete obj[key];\n        return obj;\n      }, obj).value();\n    },\n    cartesianProduct: function() {\n      return _.reduceRight(arguments, function(a, b) {\n        return _.flatten(_.map(a, function(x) {\n          return _.map(b, function(y) {\n            return [y].concat(x);\n          });\n        }), true);\n      }, [[]]);\n    }\n  });\n\n  isImage = function(name) {\n    return name.match(/\\.(jpe?g|png|gif|gifv|webm)/i) !== null;\n  };\n\n  patch = function(oldImmutable, newImmutable) {\n    var pathObj;\n    pathObj = {};\n    newImmutable.forEach(function(newValue, key) {\n      if (newValue !== oldImmutable.get(key)) {\n        if (newValue.toJS) {\n          return pathObj[key] = newValue.toJS();\n        } else {\n          return pathObj[key] = newValue;\n        }\n      }\n    });\n    return pathObj;\n  };\n\n  taiga = this.taiga;\n\n  taiga.addClass = addClass;\n\n  taiga.nl2br = nl2br;\n\n  taiga.bindMethods = bindMethods;\n\n  taiga.bindOnce = bindOnce;\n\n  taiga.mixOf = mixOf;\n\n  taiga.trim = trim;\n\n  taiga.slugify = slugify;\n\n  taiga.unslugify = unslugify;\n\n  taiga.toggleText = toggleText;\n\n  taiga.groupBy = groupBy;\n\n  taiga.timeout = timeout;\n\n  taiga.cancelTimeout = cancelTimeout;\n\n  taiga.scopeDefer = scopeDefer;\n\n  taiga.toString = toString;\n\n  taiga.joinStr = joinStr;\n\n  taiga.truncate = truncate;\n\n  taiga.debounce = debounce;\n\n  taiga.debounceLeading = debounceLeading;\n\n  taiga.startswith = startswith;\n\n  taiga.sizeFormat = sizeFormat;\n\n  taiga.stripTags = stripTags;\n\n  taiga.replaceTags = replaceTags;\n\n  taiga.defineImmutableProperty = defineImmutableProperty;\n\n  taiga.isImage = isImage;\n\n  taiga.patch = patch;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/controllerMixins.coffee\n */\n\n(function() {\n  var FiltersMixin, PageMixin, groupBy, joinStr, taiga, toString, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  joinStr = this.taiga.joinStr;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  PageMixin = (function() {\n    function PageMixin() {}\n\n    PageMixin.prototype.fillUsersAndRoles = function(users, roles) {\n      var activeUsers, computableRoles;\n      activeUsers = _.filter(users, (function(_this) {\n        return function(user) {\n          return user.is_active;\n        };\n      })(this));\n      this.scope.activeUsers = _.sortBy(activeUsers, \"full_name_display\");\n      this.scope.activeUsersById = groupBy(this.scope.activeUsers, function(e) {\n        return e.id;\n      });\n      this.scope.users = _.sortBy(users, \"full_name_display\");\n      this.scope.usersById = groupBy(this.scope.users, function(e) {\n        return e.id;\n      });\n      this.scope.roles = _.sortBy(roles, \"order\");\n      computableRoles = _(this.scope.project.members).map(\"role\").uniq().value();\n      return this.scope.computableRoles = _(roles).filter(\"computable\").filter(function(x) {\n        return _.includes(computableRoles, x.id);\n      }).value();\n    };\n\n    PageMixin.prototype.loadUsersAndRoles = function() {\n      var promise;\n      promise = this.q.all([this.rs.projects.usersList(this.scope.projectId), this.rs.projects.rolesList(this.scope.projectId)]);\n      return promise.then((function(_this) {\n        return function(results) {\n          var roles, users;\n          users = results[0], roles = results[1];\n          _this.fillUsersAndRoles(users, roles);\n          return results;\n        };\n      })(this));\n    };\n\n    return PageMixin;\n\n  })();\n\n  taiga.PageMixin = PageMixin;\n\n  FiltersMixin = (function() {\n    function FiltersMixin() {}\n\n    FiltersMixin.prototype.selectFilter = function(name, value, load) {\n      var existing, location, params;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] !== void 0 && name !== \"page\") {\n        existing = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n          return trim(x);\n        });\n        existing.push(taiga.toString(value));\n        existing = _.compact(existing);\n        value = joinStr(\",\", _.uniq(existing));\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceFilter = function(name, value, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      if (!this.location.isInCurrentRouteParams(name, value)) {\n        location = load ? this.location : this.location.noreload(this.scope);\n        return location.search(name, value);\n      }\n    };\n\n    FiltersMixin.prototype.replaceAllFilters = function(filters, load) {\n      var location;\n      if (load == null) {\n        load = false;\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(filters);\n    };\n\n    FiltersMixin.prototype.unselectFilter = function(name, value, load) {\n      var location, newValues, params, parsedValues;\n      if (load == null) {\n        load = false;\n      }\n      params = this.location.search();\n      if (params[name] === void 0) {\n        return;\n      }\n      if (value === void 0 || value === null) {\n        delete params[name];\n      }\n      parsedValues = _.map(taiga.toString(params[name]).split(\",\"), function(x) {\n        return trim(x);\n      });\n      newValues = _.reject(parsedValues, function(x) {\n        return x === taiga.toString(value);\n      });\n      newValues = _.compact(newValues);\n      if (_.isEmpty(newValues)) {\n        value = null;\n      } else {\n        value = joinStr(\",\", _.uniq(newValues));\n      }\n      location = load ? this.location : this.location.noreload(this.scope);\n      return location.search(name, value);\n    };\n\n    return FiltersMixin;\n\n  })();\n\n  taiga.FiltersMixin = FiltersMixin;\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaAdmin\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/auth.coffee\n */\n\n(function() {\n  var AuthService, CancelAccountDirective, ChangeEmailDirective, ChangePasswordFromRecoveryDirective, ForgotPasswordDirective, InvitationDirective, LoginDirective, LoginPage, PublicRegisterMessageDirective, RegisterDirective, debounce, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAuth\", [\"taigaResources\"]);\n\n  LoginPage = (function() {\n    LoginPage.$inject = ['tgCurrentUserService', '$location', '$tgNavUrls', '$routeParams'];\n\n    function LoginPage(currentUserService, $location, $navUrls, $routeParams) {\n      var url;\n      if (currentUserService.isAuthenticated()) {\n        url = $navUrls.resolve(\"home\");\n        if ($routeParams['next']) {\n          url = $routeParams['next'];\n          $location.search('next', null);\n        }\n        $location.path(url);\n      }\n    }\n\n    return LoginPage;\n\n  })();\n\n  module.controller('LoginPage', LoginPage);\n\n  AuthService = (function(superClass) {\n    extend(AuthService, superClass);\n\n    AuthService.$inject = [\"$rootScope\", \"$tgStorage\", \"$tgModel\", \"$tgResources\", \"$tgHttp\", \"$tgUrls\", \"$tgConfig\", \"$translate\", \"tgCurrentUserService\", \"tgThemeService\"];\n\n    function AuthService(rootscope, storage, model, rs, http, urls, config, translate, currentUserService1, themeService) {\n      var userModel;\n      this.rootscope = rootscope;\n      this.storage = storage;\n      this.model = model;\n      this.rs = rs;\n      this.http = http;\n      this.urls = urls;\n      this.config = config;\n      this.translate = translate;\n      this.currentUserService = currentUserService1;\n      this.themeService = themeService;\n      AuthService.__super__.constructor.call(this);\n      userModel = this.getUser();\n      this._currentTheme = this._getUserTheme();\n      this.setUserdata(userModel);\n    }\n\n    AuthService.prototype.setUserdata = function(userModel) {\n      if (userModel) {\n        this.userData = Immutable.fromJS(userModel.getAttrs());\n        return this.currentUserService.setUser(this.userData);\n      } else {\n        return this.userData = null;\n      }\n    };\n\n    AuthService.prototype._getUserTheme = function() {\n      var ref;\n      return ((ref = this.rootscope.user) != null ? ref.theme : void 0) || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    AuthService.prototype._setTheme = function() {\n      var newTheme;\n      newTheme = this._getUserTheme();\n      if (this._currentTheme !== newTheme) {\n        this._currentTheme = newTheme;\n        return this.themeService.use(this._currentTheme);\n      }\n    };\n\n    AuthService.prototype._setLocales = function() {\n      var lang, ref;\n      lang = ((ref = this.rootscope.user) != null ? ref.lang : void 0) || this.config.get(\"defaultLanguage\") || \"en\";\n      this.translate.preferredLanguage(lang);\n      return this.translate.use(lang);\n    };\n\n    AuthService.prototype.getUser = function() {\n      var user, userData;\n      if (this.rootscope.user) {\n        return this.rootscope.user;\n      }\n      userData = this.storage.get(\"userInfo\");\n      if (userData) {\n        user = this.model.make_model(\"users\", userData);\n        this.rootscope.user = user;\n        this._setLocales();\n        this._setTheme();\n        return user;\n      } else {\n        this._setTheme();\n      }\n      return null;\n    };\n\n    AuthService.prototype.setUser = function(user) {\n      this.rootscope.auth = user;\n      this.storage.set(\"userInfo\", user.getAttrs());\n      this.rootscope.user = user;\n      this.setUserdata(user);\n      this._setLocales();\n      return this._setTheme();\n    };\n\n    AuthService.prototype.clear = function() {\n      this.rootscope.auth = null;\n      this.rootscope.user = null;\n      return this.storage.remove(\"userInfo\");\n    };\n\n    AuthService.prototype.setToken = function(token) {\n      return this.storage.set(\"token\", token);\n    };\n\n    AuthService.prototype.getToken = function() {\n      return this.storage.get(\"token\");\n    };\n\n    AuthService.prototype.removeToken = function() {\n      return this.storage.remove(\"token\");\n    };\n\n    AuthService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    AuthService.prototype.refresh = function() {\n      var url;\n      url = this.urls.resolve(\"user-me\");\n      return this.http.get(url).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = data.data;\n          user.token = _this.getUser().auth_token;\n          user = _this.model.make_model(\"users\", user);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.login = function(data, type) {\n      var url;\n      url = this.urls.resolve(\"auth\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"normal\";\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(data, status) {\n          var user;\n          user = _this.model.make_model(\"users\", data.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.logout = function() {\n      this.removeToken();\n      this.clear();\n      this.currentUserService.removeUser();\n      this._setTheme();\n      return this._setLocales();\n    };\n\n    AuthService.prototype.register = function(data, type, existing) {\n      var url;\n      url = this.urls.resolve(\"auth-register\");\n      data = _.clone(data, false);\n      data.type = type ? type : \"public\";\n      if (type === \"private\") {\n        data.existing = existing ? existing : false;\n      }\n      this.removeToken();\n      return this.http.post(url, data).then((function(_this) {\n        return function(response) {\n          var user;\n          user = _this.model.make_model(\"users\", response.data);\n          _this.setToken(user.auth_token);\n          _this.setUser(user);\n          return user;\n        };\n      })(this));\n    };\n\n    AuthService.prototype.getInvitation = function(token) {\n      return this.rs.invitations.get(token);\n    };\n\n    AuthService.prototype.acceptInvitiationWithNewUser = function(data) {\n      return this.register(data, \"private\", false);\n    };\n\n    AuthService.prototype.acceptInvitiationWithExistingUser = function(data) {\n      return this.register(data, \"private\", true);\n    };\n\n    AuthService.prototype.forgotPassword = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-password-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changePasswordFromRecovery = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-password-from-recovery\");\n      data = _.clone(data, false);\n      this.removeToken();\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.changeEmail = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-change-email\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    AuthService.prototype.cancelAccount = function(data) {\n      var url;\n      url = this.urls.resolve(\"users-cancel-account\");\n      data = _.clone(data, false);\n      return this.http.post(url, data);\n    };\n\n    return AuthService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAuth\", AuthService);\n\n  PublicRegisterMessageDirective = function($config, $navUrls, $routeParams, templates) {\n    var template, templateFn;\n    template = templates.get(\"auth/login-text.html\", true);\n    templateFn = function() {\n      var nextUrl, publicRegisterEnabled, url;\n      publicRegisterEnabled = $config.get(\"publicRegisterEnabled\");\n      if (!publicRegisterEnabled) {\n        return \"\";\n      }\n      url = $navUrls.resolve(\"register\");\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"register\")) {\n        nextUrl = encodeURIComponent($routeParams['next']);\n        url += \"?next=\" + nextUrl;\n      }\n      return template({\n        url: url\n      });\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgPublicRegisterMessage\", [\"$tgConfig\", \"$tgNavUrls\", \"$routeParams\", \"$tgTemplate\", PublicRegisterMessageDirective]);\n\n  LoginDirective = function($auth, $confirm, $location, $config, $routeParams, $navUrls, $events, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onError, onSuccess, submit;\n      form = new checksley.Form($el.find(\"form.login-form\"));\n      if ($routeParams['next'] && $routeParams['next'] !== $navUrls.resolve(\"login\")) {\n        $scope.nextUrl = decodeURIComponent($routeParams['next']);\n      } else {\n        $scope.nextUrl = $navUrls.resolve(\"home\");\n      }\n      onSuccess = function(response) {\n        $events.setupConnection();\n        return $location.url($scope.nextUrl);\n      };\n      onError = function(response) {\n        return $confirm.notify(\"light-error\", $translate.instant(\"LOGIN_FORM.ERROR_AUTH_INCORRECT\"));\n      };\n      $scope.onKeyUp = function(event) {\n        var target, value;\n        target = angular.element(event.currentTarget);\n        value = target.val();\n        $scope.iscapsLockActivated = false;\n        if (value !== value.toLowerCase()) {\n          return $scope.iscapsLockActivated = true;\n        }\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var data, loginFormType, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          data = {\n            \"username\": $el.find(\"form.login-form input[name=username]\").val(),\n            \"password\": $el.find(\"form.login-form input[name=password]\").val()\n          };\n          loginFormType = $config.get(\"loginFormType\", \"normal\");\n          promise = $auth.login(data, loginFormType);\n          return promise.then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      window.prerenderReady = true;\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLogin\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgConfig\", \"$routeParams\", \"$tgNavUrls\", \"$tgEvents\", \"$translate\", LoginDirective]);\n\n  RegisterDirective = function($auth, $confirm, $location, $navUrls, $config, $routeParams, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      if (!$config.get(\"publicRegisterEnabled\")) {\n        $location.path($navUrls.resolve(\"not-found\"));\n        $location.replace();\n      }\n      $scope.data = {};\n      form = $el.find(\"form\").checksley({\n        onlyOneErrorElement: true\n      });\n      $scope.nextUrl = $navUrls.resolve(\"home\");\n      onSuccessSubmit = function(response) {\n        $analytics.trackEvent(\"auth\", \"register\", \"user registration\", 1);\n        return $location.url($scope.nextUrl);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return form.setErrors(response.data);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.register($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRegister\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\", \"$routeParams\", \"$tgAnalytics\", \"$translate\", RegisterDirective]);\n\n  ForgotPasswordDirective = function($auth, $confirm, $location, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var message, title;\n        $location.path($navUrls.resolve(\"login\"));\n        title = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TITLE\");\n        message = $translate.instant(\"FORGOT_PASSWORD_FORM.SUCCESS_TEXT\");\n        return $confirm.success(title, message);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"FORGOT_PASSWORD_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.forgotPassword($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return window.prerenderReady = true;\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgForgotPassword\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$tgNavUrls\", \"$translate\", ForgotPasswordDirective]);\n\n  ChangePasswordFromRecoveryDirective = function($auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit, text;\n      $scope.data = {};\n      if ($params.token != null) {\n        $scope.tokenInParams = true;\n        $scope.data.token = $params.token;\n      } else {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        $confirm.notify(\"light-error\", text);\n      }\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        text = $translate.instant(\"CHANGE_PASSWORD_RECOVERY_FORM.ERROR\");\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.changePasswordFromRecovery($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangePasswordFromRecovery\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangePasswordFromRecoveryDirective]);\n\n  InvitationDirective = function($auth, $confirm, $location, $params, $navUrls, $analytics, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var loginForm, onErrorSubmitLogin, onErrorSubmitRegister, onSuccessSubmitLogin, onSuccessSubmitRegister, promise, registerForm, submitLogin, submitRegister, token;\n      token = $params.token;\n      promise = $auth.getInvitation(token);\n      promise.then(function(invitation) {\n        return $scope.invitation = invitation;\n      });\n      promise.then(null, function(response) {\n        var text;\n        $location.path($navUrls.resolve(\"login\"));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.NOT_FOUND\");\n        return $confirm.notify(\"light-error\", text);\n      });\n      $scope.dataLogin = {\n        token: token\n      };\n      loginForm = $el.find(\"form.login-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitLogin = function(response) {\n        var text;\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with existing user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        text = $translate.instant(\"INVITATION_LOGIN_FORM.SUCCESS\", {\n          \"project_name\": $scope.invitation.project_name\n        });\n        return $confirm.notify(\"success\", text);\n      };\n      onErrorSubmitLogin = function(response) {\n        return $confirm.notify(\"light-error\", response.data._error_message);\n      };\n      submitLogin = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!loginForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithExistingUser($scope.dataLogin);\n          return promise.then(onSuccessSubmitLogin, onErrorSubmitLogin);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.login-form\", submitLogin);\n      $el.on(\"click\", \".button-login\", submitLogin);\n      $scope.dataRegister = {\n        token: token\n      };\n      registerForm = $el.find(\"form.register-form\").checksley({\n        onlyOneErrorElement: true\n      });\n      onSuccessSubmitRegister = function(response) {\n        $analytics.trackEvent(\"auth\", \"invitationAccept\", \"invitation accept with new user\", 1);\n        $location.path($navUrls.resolve(\"project\", {\n          project: $scope.invitation.project_slug\n        }));\n        return $confirm.notify(\"success\", \"You've successfully joined this project\", \"Welcome to \" + (_.escape($scope.invitation.project_name)));\n      };\n      onErrorSubmitRegister = function(response) {\n        var text;\n        if (response.data._error_message) {\n          text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n            error: response.data._error_message\n          });\n          $confirm.notify(\"light-error\", text);\n        }\n        return registerForm.setErrors(response.data);\n      };\n      submitRegister = debounce(2000, (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          if (!registerForm.validate()) {\n            return;\n          }\n          promise = $auth.acceptInvitiationWithNewUser($scope.dataRegister);\n          return promise.then(onSuccessSubmitRegister, onErrorSubmitRegister);\n        };\n      })(this));\n      $el.on(\"submit\", \"form.register-form\", submitRegister);\n      $el.on(\"click\", \".button-register\", submitRegister);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgInvitation\", [\"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\", InvitationDirective]);\n\n  ChangeEmailDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.email_token = $params.email_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        if ($auth.isAuthenticated()) {\n          $repo.queryOne(\"users\", $auth.getUser().id).then((function(_this) {\n            return function(data) {\n              $auth.setUser(data);\n              return $location.path($navUrls.resolve(\"home\"));\n            };\n          })(this));\n        } else {\n          $location.path($navUrls.resolve(\"login\"));\n        }\n        text = $translate.instant(\"CHANGE_EMAIL_FORM.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"light-error\", text);\n      };\n      submit = function() {\n        var promise;\n        if (!form.validate()) {\n          return;\n        }\n        promise = $auth.changeEmail($scope.data);\n        return promise.then(onSuccessSubmit, onErrorSubmit);\n      };\n      $el.on(\"submit\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \"a.button-change-email\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgChangeEmail\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", \"$translate\", ChangeEmailDirective]);\n\n  CancelAccountDirective = function($repo, $model, $auth, $confirm, $location, $params, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, onErrorSubmit, onSuccessSubmit, submit;\n      $scope.data = {};\n      $scope.data.cancel_token = $params.cancel_token;\n      form = $el.find(\"form\").checksley();\n      onSuccessSubmit = function(response) {\n        var text;\n        $auth.logout();\n        $location.path($navUrls.resolve(\"home\"));\n        text = $translate.instant(\"CANCEL_ACCOUNT.SUCCESS\");\n        return $confirm.success(text);\n      };\n      onErrorSubmit = function(response) {\n        var text;\n        text = $translate.instant(\"COMMON.GENERIC_ERROR\", {\n          error: response.data._error_message\n        });\n        return $confirm.notify(\"error\", text);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $auth.cancelAccount($scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgCancelAccount\", [\"$tgRepo\", \"$tgModel\", \"$tgAuth\", \"$tgConfirm\", \"$tgLocation\", \"$routeParams\", \"$tgNavUrls\", CancelAccountDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaBacklog\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base.coffee\n */\n\n(function() {\n  var TaigaMainDirective, bindOnce, groupBy, init, module, taiga, urls;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\", []);\n\n  TaigaMainDirective = function($rootscope, $window) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $window.onresize = function() {\n        return $rootscope.$broadcast(\"resize\");\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMain\", [\"$rootScope\", \"$window\", TaigaMainDirective]);\n\n  urls = {\n    \"home\": \"/\",\n    \"projects\": \"/projects\",\n    \"error\": \"/error\",\n    \"not-found\": \"/not-found\",\n    \"permission-denied\": \"/permission-denied\",\n    \"discover\": \"/discover\",\n    \"discover-search\": \"/discover/search\",\n    \"login\": \"/login\",\n    \"forgot-password\": \"/forgot-password\",\n    \"change-password\": \"/change-password/:token\",\n    \"change-email\": \"/change-email/:token\",\n    \"cancel-account\": \"/cancel-account/:token\",\n    \"register\": \"/register\",\n    \"invitation\": \"/invitation/:token\",\n    \"create-project\": \"/create-project\",\n    \"profile\": \"/profile\",\n    \"user-profile\": \"/profile/:username\",\n    \"blocked-project\": \"/blocked-project/:project\",\n    \"project\": \"/project/:project\",\n    \"project-backlog\": \"/project/:project/backlog\",\n    \"project-taskboard\": \"/project/:project/taskboard/:sprint\",\n    \"project-kanban\": \"/project/:project/kanban\",\n    \"project-issues\": \"/project/:project/issues\",\n    \"project-search\": \"/project/:project/search\",\n    \"project-userstories-detail\": \"/project/:project/us/:ref\",\n    \"project-tasks-detail\": \"/project/:project/task/:ref\",\n    \"project-issues-detail\": \"/project/:project/issue/:ref\",\n    \"project-wiki\": \"/project/:project/wiki\",\n    \"project-wiki-page\": \"/project/:project/wiki/:slug\",\n    \"project-team\": \"/project/:project/team\",\n    \"project-admin-home\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-details\": \"/project/:project/admin/project-profile/details\",\n    \"project-admin-project-profile-default-values\": \"/project/:project/admin/project-profile/default-values\",\n    \"project-admin-project-profile-modules\": \"/project/:project/admin/project-profile/modules\",\n    \"project-admin-project-profile-export\": \"/project/:project/admin/project-profile/export\",\n    \"project-admin-project-profile-reports\": \"/project/:project/admin/project-profile/reports\",\n    \"project-admin-project-values-status\": \"/project/:project/admin/project-values/status\",\n    \"project-admin-project-values-points\": \"/project/:project/admin/project-values/points\",\n    \"project-admin-project-values-priorities\": \"/project/:project/admin/project-values/priorities\",\n    \"project-admin-project-values-severities\": \"/project/:project/admin/project-values/severities\",\n    \"project-admin-project-values-types\": \"/project/:project/admin/project-values/types\",\n    \"project-admin-project-values-custom-fields\": \"/project/:project/admin/project-values/custom-fields\",\n    \"project-admin-memberships\": \"/project/:project/admin/memberships\",\n    \"project-admin-roles\": \"/project/:project/admin/roles\",\n    \"project-admin-third-parties-webhooks\": \"/project/:project/admin/third-parties/webhooks\",\n    \"project-admin-third-parties-github\": \"/project/:project/admin/third-parties/github\",\n    \"project-admin-third-parties-gitlab\": \"/project/:project/admin/third-parties/gitlab\",\n    \"project-admin-third-parties-bitbucket\": \"/project/:project/admin/third-parties/bitbucket\",\n    \"project-admin-contrib\": \"/project/:project/admin/contrib/:plugin\",\n    \"user-settings-user-profile\": \"/user-settings/user-profile\",\n    \"user-settings-user-change-password\": \"/user-settings/user-change-password\",\n    \"user-settings-user-avatar\": \"/user-settings/user-avatar\",\n    \"user-settings-mail-notifications\": \"/user-settings/mail-notifications\",\n    \"user-settings-contrib\": \"/user-settings/contrib/:plugin\"\n  };\n\n  init = function($log, $navurls) {\n    $log.debug(\"Initialize navigation urls\");\n    return $navurls.update(urls);\n  };\n\n  module.run([\"$log\", \"$tgNavUrls\", init]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common.coffee\n */\n\n(function() {\n  var AnimationFrame, Capslock, CheckPermissionDirective, ClassPermissionDirective, DataPickerConfig, LightboxClose, ProjectUrl, Qqueue, SelectedText, Svg, Template, ToggleCommentDirective, module, taiga,\n    slice = [].slice;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\", []);\n\n  DataPickerConfig = function($translate) {\n    return {\n      get: function() {\n        return {\n          i18n: {\n            previousMonth: $translate.instant(\"COMMON.PICKERDATE.PREV_MONTH\"),\n            nextMonth: $translate.instant(\"COMMON.PICKERDATE.NEXT_MONTH\"),\n            months: [$translate.instant(\"COMMON.PICKERDATE.MONTHS.JAN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.FEB\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.APR\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.MAY\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUN\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.JUL\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.AUG\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.SEP\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.OCT\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.NOV\"), $translate.instant(\"COMMON.PICKERDATE.MONTHS.DEC\")],\n            weekdays: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS.SAT\")],\n            weekdaysShort: [$translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SUN\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.MON\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.TUE\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.WED\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.THU\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.FRI\"), $translate.instant(\"COMMON.PICKERDATE.WEEK_DAYS_SHORT.SAT\")]\n          },\n          isRTL: $translate.instant(\"COMMON.PICKERDATE.IS_RTL\") === \"true\",\n          firstDay: parseInt($translate.instant(\"COMMON.PICKERDATE.FIRST_DAY_OF_WEEK\"), 10),\n          format: $translate.instant(\"COMMON.PICKERDATE.FORMAT\")\n        };\n      }\n    };\n  };\n\n  module.factory(\"tgDatePickerConfigService\", [\"$translate\", DataPickerConfig]);\n\n  SelectedText = function($window, $document) {\n    var get;\n    get = function() {\n      if ($window.getSelection) {\n        return $window.getSelection().toString();\n      } else if ($document.selection) {\n        return $document.selection.createRange().text;\n      }\n      return \"\";\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$selectedText\", [\"$window\", \"$document\", SelectedText]);\n\n  CheckPermissionDirective = function(projectService) {\n    var link, render;\n    render = function($el, project, permission) {\n      if (project && permission) {\n        if (project.get('my_permissions').indexOf(permission) > -1) {\n          return $el.removeClass('hidden');\n        }\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var permission, unObserve, unwatch;\n      $el.addClass('hidden');\n      permission = $attrs.tgCheckPermission;\n      unwatch = $scope.$watch(function() {\n        return projectService.project;\n      }, function() {\n        if (!projectService.project) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unwatch();\n      });\n      unObserve = $attrs.$observe(\"tgCheckPermission\", function(permission) {\n        if (!permission) {\n          return;\n        }\n        render($el, projectService.project, permission);\n        return unObserve();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CheckPermissionDirective.$inject = [\"tgProjectService\"];\n\n  module.directive(\"tgCheckPermission\", CheckPermissionDirective);\n\n  ClassPermissionDirective = function() {\n    var link, name;\n    name = \"tgClassPermission\";\n    link = function($scope, $el, $attrs) {\n      var checkPermissions, tgClassPermissionWatchAction, unbindWatcher;\n      checkPermissions = function(project, className, permission) {\n        var negation;\n        negation = permission[0] === \"!\";\n        if (negation) {\n          permission = permission.slice(1);\n        }\n        if (negation && project.my_permissions.indexOf(permission) === -1) {\n          return $el.addClass(className);\n        } else if (!negation && project.my_permissions.indexOf(permission) !== -1) {\n          return $el.addClass(className);\n        } else {\n          return $el.removeClass(className);\n        }\n      };\n      tgClassPermissionWatchAction = function(project) {\n        var className, classes, permission, results;\n        if (project) {\n          unbindWatcher();\n          classes = $scope.$eval($attrs[name]);\n          results = [];\n          for (className in classes) {\n            permission = classes[className];\n            results.push(checkPermissions(project, className, permission));\n          }\n          return results;\n        }\n      };\n      return unbindWatcher = $scope.$watch(\"project\", tgClassPermissionWatchAction);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgClassPermission\", ClassPermissionDirective);\n\n  AnimationFrame = function() {\n    var add, animationFrame, performAnimation, tail;\n    animationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame;\n    performAnimation = (function(_this) {\n      return function(time) {\n        var fn;\n        fn = tail.shift();\n        fn();\n        if (tail.length) {\n          return animationFrame(performAnimation);\n        }\n      };\n    })(this);\n    tail = [];\n    add = function() {\n      var fn, i, len, results;\n      results = [];\n      for (i = 0, len = arguments.length; i < len; i++) {\n        fn = arguments[i];\n        tail.push(fn);\n        if (tail.length === 1) {\n          results.push(animationFrame(performAnimation));\n        } else {\n          results.push(void 0);\n        }\n      }\n      return results;\n    };\n    return {\n      add: add\n    };\n  };\n\n  module.factory(\"animationFrame\", AnimationFrame);\n\n  ToggleCommentDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.find(\"textarea\").on(\"focus\", function() {\n        return $el.addClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleComment\", ToggleCommentDirective);\n\n  ProjectUrl = function($navurls) {\n    var get;\n    get = function(project) {\n      var ctx;\n      ctx = {\n        project: project.slug\n      };\n      if (project.is_backlog_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-backlog\", ctx);\n      }\n      if (project.is_kanban_activated && project.my_permissions.indexOf(\"view_us\") > -1) {\n        return $navurls.resolve(\"project-kanban\", ctx);\n      }\n      if (project.is_wiki_activated && project.my_permissions.indexOf(\"view_wiki_pages\") > -1) {\n        return $navurls.resolve(\"project-wiki\", ctx);\n      }\n      if (project.is_issues_activated && project.my_permissions.indexOf(\"view_issues\") > -1) {\n        return $navurls.resolve(\"project-issues\", ctx);\n      }\n      return $navurls.resolve(\"project\", ctx);\n    };\n    return {\n      get: get\n    };\n  };\n\n  module.factory(\"$projectUrl\", [\"$tgNavUrls\", ProjectUrl]);\n\n  Qqueue = function($q) {\n    var deferred, lastPromise, qqueue;\n    deferred = $q.defer();\n    deferred.resolve();\n    lastPromise = deferred.promise;\n    qqueue = {\n      bindAdd: (function(_this) {\n        return function(fn) {\n          return function() {\n            var args;\n            args = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n            return lastPromise = lastPromise.then(function() {\n              return fn.apply(_this, args);\n            });\n          };\n          return qqueue;\n        };\n      })(this),\n      add: (function(_this) {\n        return function(fn) {\n          if (!lastPromise) {\n            lastPromise = fn();\n          } else {\n            lastPromise = lastPromise.then(fn);\n          }\n          return qqueue;\n        };\n      })(this)\n    };\n    return qqueue;\n  };\n\n  module.factory(\"$tgQqueue\", [\"$q\", Qqueue]);\n\n  Template = function($templateCache) {\n    return {\n      get: (function(_this) {\n        return function(name, lodash) {\n          var tmp;\n          if (lodash == null) {\n            lodash = false;\n          }\n          tmp = $templateCache.get(name);\n          if (lodash) {\n            tmp = _.template(tmp);\n          }\n          return tmp;\n        };\n      })(this)\n    };\n  };\n\n  module.factory(\"$tgTemplate\", [\"$templateCache\", Template]);\n\n  Capslock = function() {\n    var template;\n    template = \"<tg-svg class=\\\"capslock\\\" ng-if=\\\"capslockIcon && iscapsLockActivated\\\" svg-icon='icon-capslock' svg-title='COMMON.CAPSLOCK_WARNING'></tg-svg>\";\n    return {\n      template: template\n    };\n  };\n\n  module.directive(\"tgCapslock\", [Capslock]);\n\n  LightboxClose = function() {\n    var template;\n    template = \"<a class=\\\"close\\\" href=\\\"\\\" title=\\\"{{'COMMON.CLOSE' | translate}}\\\">\\n    <tg-svg svg-icon=\\\"icon-close\\\"></tg-svg>\\n</a>\";\n    return {\n      template: template\n    };\n  };\n\n  module.directive(\"tgLightboxClose\", [LightboxClose]);\n\n  Svg = function() {\n    var template;\n    template = \"<svg class=\\\"{{ 'icon ' + svgIcon }}\\\">\\n    <use xlink:href=\\\"\\\" ng-attr-xlink:href=\\\"{{ '#' + svgIcon }}\\\">\\n        <title ng-if=\\\"svgTitle\\\">{{svgTitle}}</title>\\n        <title\\n            ng-if=\\\"svgTitleTranslate\\\"\\n            translate=\\\"{{svgTitleTranslate}}\\\"\\n            translate-values=\\\"{{svgTitleTranslateValues}}\\\"\\n            ></title>\\n    </use>\\n</svg>\";\n    return {\n      scope: {\n        svgIcon: \"@\",\n        svgTitle: \"@\",\n        svgTitleTranslate: \"@\",\n        svgTitleTranslateValues: \"=\"\n      },\n      template: template\n    };\n  };\n\n  module.directive(\"tgSvg\", [Svg]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/events.coffee\n */\n\n(function() {\n  var EventsProvider, EventsService, bindMethods, module, startswith, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  startswith = this.taiga.startswith;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaEvents\", []);\n\n  EventsService = (function() {\n    function EventsService(win, log, config, auth, liveAnnouncementService1, rootScope) {\n      this.win = win;\n      this.log = log;\n      this.config = config;\n      this.auth = auth;\n      this.liveAnnouncementService = liveAnnouncementService1;\n      this.rootScope = rootScope;\n      this.processMessage = bind(this.processMessage, this);\n      bindMethods(this);\n    }\n\n    EventsService.prototype.initialize = function(sessionId) {\n      this.sessionId = sessionId;\n      this.subscriptions = {};\n      this.connected = false;\n      this.error = false;\n      this.pendingMessages = [];\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = null;\n      if (this.win.WebSocket === void 0) {\n        return this.log.info(\"WebSockets not supported on your browser\");\n      }\n    };\n\n    EventsService.prototype.setupConnection = function() {\n      var loc, path, scheme, url;\n      this.stopExistingConnection();\n      url = this.config.get(\"eventsUrl\");\n      if (!url) {\n        return;\n      }\n      if (!startswith(url, \"ws:\") && !startswith(url, \"wss:\")) {\n        loc = this.win.location;\n        scheme = loc.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n        path = _.trimStart(url, \"/\");\n        url = scheme + \"//\" + loc.host + \"/\" + path;\n      }\n      this.ws = new this.win.WebSocket(url);\n      this.ws.addEventListener(\"open\", this.onOpen);\n      this.ws.addEventListener(\"message\", this.onMessage);\n      this.ws.addEventListener(\"error\", this.onError);\n      return this.ws.addEventListener(\"close\", this.onClose);\n    };\n\n    EventsService.prototype.stopExistingConnection = function() {\n      if (this.ws === void 0) {\n        return;\n      }\n      this.ws.removeEventListener(\"open\", this.onOpen);\n      this.ws.removeEventListener(\"close\", this.onClose);\n      this.ws.removeEventListener(\"error\", this.onError);\n      this.ws.removeEventListener(\"message\", this.onMessage);\n      this.stopHeartBeatMessages();\n      this.ws.close();\n      return delete this.ws;\n    };\n\n    EventsService.prototype.notifications = function() {\n      return this.subscribe(null, 'notifications', (function(_this) {\n        return function(data) {\n          _this.liveAnnouncementService.show(data.title, data.desc);\n          return _this.rootScope.$digest();\n        };\n      })(this));\n    };\n\n    EventsService.prototype.startHeartBeatMessages = function() {\n      var heartbeatIntervalTime, maxMissedHeartbeats;\n      if (this.heartbeatInterval) {\n        return;\n      }\n      maxMissedHeartbeats = this.config.get(\"eventsMaxMissedHeartbeats\", 5);\n      heartbeatIntervalTime = this.config.get(\"eventsHeartbeatIntervalTime\", 60000);\n      this.missedHeartbeats = 0;\n      this.heartbeatInterval = setInterval((function(_this) {\n        return function() {\n          var e, error1;\n          try {\n            if (_this.missedHeartbeats >= maxMissedHeartbeats) {\n              throw new Error(\"Too many missed heartbeats PINGs.\");\n            }\n            _this.missedHeartbeats++;\n            _this.sendMessage({\n              cmd: \"ping\"\n            });\n            return _this.log.debug(\"HeartBeat send PING\");\n          } catch (error1) {\n            e = error1;\n            _this.log.error(\"HeartBeat error: \" + e.message);\n            return _this.stopHeartBeatMessages();\n          }\n        };\n      })(this), heartbeatIntervalTime);\n      return this.log.debug(\"HeartBeat enabled\");\n    };\n\n    EventsService.prototype.stopHeartBeatMessages = function() {\n      if (!this.heartbeatInterval) {\n        return;\n      }\n      clearInterval(this.heartbeatInterval);\n      this.heartbeatInterval = null;\n      return this.log.debug(\"HeartBeat disabled\");\n    };\n\n    EventsService.prototype.processHeartBeatPongMessage = function(data) {\n      this.missedHeartbeats = 0;\n      return this.log.debug(\"HeartBeat recived PONG\");\n    };\n\n    EventsService.prototype.serialize = function(message) {\n      if (_.isObject(message)) {\n        return JSON.stringify(message);\n      }\n      return message;\n    };\n\n    EventsService.prototype.sendMessage = function(message) {\n      var i, len, messages, msg, results;\n      this.pendingMessages.push(message);\n      if (!this.connected) {\n        return;\n      }\n      messages = _.map(this.pendingMessages, this.serialize);\n      this.pendingMessages = [];\n      results = [];\n      for (i = 0, len = messages.length; i < len; i++) {\n        msg = messages[i];\n        results.push(this.ws.send(msg));\n      }\n      return results;\n    };\n\n    EventsService.prototype.processMessage = function(data) {\n      var routingKey, subscription;\n      routingKey = data.routing_key;\n      if (this.subscriptions[routingKey] == null) {\n        return;\n      }\n      subscription = this.subscriptions[routingKey];\n      if (subscription.scope) {\n        return subscription.scope.$apply(function() {\n          return subscription.callback(data.data);\n        });\n      } else {\n        return subscription.callback(data.data);\n      }\n    };\n\n    EventsService.prototype.subscribe = function(scope, routingKey, callback) {\n      var message, subscription;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Subscribe to: \" + routingKey);\n      subscription = {\n        scope: scope,\n        routingKey: routingKey,\n        callback: _.debounce(callback, 500, {\n          \"leading\": true,\n          \"trailing\": false\n        })\n      };\n      message = {\n        \"cmd\": \"subscribe\",\n        \"routing_key\": routingKey\n      };\n      this.subscriptions[routingKey] = subscription;\n      this.sendMessage(message);\n      if (scope) {\n        return scope.$on(\"$destroy\", (function(_this) {\n          return function() {\n            return _this.unsubscribe(routingKey);\n          };\n        })(this));\n      }\n    };\n\n    EventsService.prototype.unsubscribe = function(routingKey) {\n      var message;\n      if (this.error) {\n        return;\n      }\n      this.log.debug(\"Unsubscribe from: \" + routingKey);\n      message = {\n        \"cmd\": \"unsubscribe\",\n        \"routing_key\": routingKey\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onOpen = function() {\n      var message, token;\n      this.connected = true;\n      this.startHeartBeatMessages();\n      this.notifications();\n      this.log.debug(\"WebSocket connection opened\");\n      token = this.auth.getToken();\n      message = {\n        cmd: \"auth\",\n        data: {\n          token: token,\n          sessionId: this.sessionId\n        }\n      };\n      return this.sendMessage(message);\n    };\n\n    EventsService.prototype.onMessage = function(event) {\n      var data;\n      this.log.debug(\"WebSocket message received: \" + event.data);\n      data = JSON.parse(event.data);\n      if (data.cmd === \"pong\") {\n        return this.processHeartBeatPongMessage(data);\n      } else {\n        return this.processMessage(data);\n      }\n    };\n\n    EventsService.prototype.onError = function(error) {\n      this.log.error(\"WebSocket error: \" + error);\n      return this.error = true;\n    };\n\n    EventsService.prototype.onClose = function() {\n      this.log.debug(\"WebSocket closed.\");\n      this.connected = false;\n      return this.stopHeartBeatMessages();\n    };\n\n    return EventsService;\n\n  })();\n\n  EventsProvider = (function() {\n    function EventsProvider() {}\n\n    EventsProvider.prototype.setSessionId = function(sessionId) {\n      return this.sessionId = sessionId;\n    };\n\n    EventsProvider.prototype.$get = function($win, $log, $conf, $auth, liveAnnouncementService, $rootScope) {\n      var service;\n      service = new EventsService($win, $log, $conf, $auth, liveAnnouncementService, $rootScope);\n      service.initialize(this.sessionId);\n      return service;\n    };\n\n    EventsProvider.prototype.$get.$inject = [\"$window\", \"$log\", \"$tgConfig\", \"$tgAuth\", \"tgLiveAnnouncementService\", \"$rootScope\"];\n\n    return EventsProvider;\n\n  })();\n\n  module.provider(\"$tgEvents\", EventsProvider);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/feedback.coffee\n */\n\n(function() {\n  var FeedbackDirective, bindOnce, debounce, groupBy, mixOf, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  trim = this.taiga.trim;\n\n  module = angular.module(\"taigaFeedback\", []);\n\n  FeedbackDirective = function($lightboxService, $repo, $confirm, $loading, feedbackService) {\n    var directive, link;\n    link = function($scope, $el, $attrs) {\n      var form, openLightbox, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"feedback\", $scope.feedback);\n          promise.then(function(data) {\n            currentLoading.finish();\n            $lightboxService.close($el);\n            return $confirm.notify(\"success\", \"\\\\o/ we'll be happy to read your\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      openLightbox = function() {\n        $scope.feedback = {};\n        $lightboxService.open($el);\n        return $el.find(\"textarea\").focus();\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return openLightbox();\n    };\n    directive = {\n      link: link,\n      templateUrl: \"common/lightbox-feedback.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbFeedback\", [\"lightboxService\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgFeedbackService\", FeedbackDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/integrations.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIntegrations\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaIssues\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaKanban\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaPlugins\", [\"ngRoute\"]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/projects.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProject\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/related-tasks.coffee\n */\n\n(function() {\n  var RelatedTaskAssignedToInlineEditionDirective, RelatedTaskCreateButtonDirective, RelatedTaskCreateFormDirective, RelatedTaskRowDirective, RelatedTasksDirective, debounce, module, taiga, trim;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaRelatedTasks\", []);\n\n  RelatedTaskRowDirective = function($repo, $compile, $confirm, $rootscope, $loading, $template, $translate) {\n    var link, templateEdit, templateView;\n    templateView = $template.get(\"task/related-task-row.html\", true);\n    templateEdit = $template.get(\"task/related-task-row-edit.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var renderEdit, renderView, saveTask;\n      saveTask = debounce(2000, function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.save(task);\n        promise.then((function(_this) {\n          return function() {\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"related-tasks:update\");\n          };\n        })(this));\n        promise.then(null, (function(_this) {\n          return function() {\n            currentLoading.finish();\n            $el.find('input').val(task.subject);\n            return $confirm.notify(\"error\");\n          };\n        })(this));\n        return promise;\n      });\n      renderEdit = function(task) {\n        $el.html($compile(templateEdit({\n          task: task\n        }))($scope));\n        $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return saveTask($model.$modelValue).then(function() {\n              return renderView($model.$modelValue);\n            });\n          } else if (event.keyCode === 27) {\n            return renderView($model.$modelValue);\n          }\n        });\n        $el.on(\"click\", \".save-task\", function(event) {\n          return saveTask($model.$modelValue).then(function() {\n            return renderView($model.$modelValue);\n          });\n        });\n        return $el.on(\"click\", \".cancel-edit\", function(event) {\n          return renderView($model.$modelValue);\n        });\n      };\n      renderView = function(task) {\n        var perms;\n        $el.off();\n        perms = {\n          modify_task: $scope.project.my_permissions.indexOf(\"modify_task\") !== -1,\n          delete_task: $scope.project.my_permissions.indexOf(\"delete_task\") !== -1\n        };\n        $el.html($compile(templateView({\n          task: task,\n          perms: perms\n        }))($scope));\n        $el.on(\"click\", \".edit-task\", function() {\n          renderEdit($model.$modelValue);\n          return $el.find('input').focus().select();\n        });\n        return $el.on(\"click\", \".delete-task\", function(event) {\n          var message, title;\n          title = $translate.instant(\"TASK.TITLE_DELETE_ACTION\");\n          task = $model.$modelValue;\n          message = task.subject;\n          return $confirm.askOnDelete(title, message).then(function(askResponse) {\n            var promise;\n            promise = $repo.remove(task);\n            promise.then(function() {\n              askResponse.finish();\n              return $scope.$emit(\"related-tasks:delete\");\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          });\n        });\n      };\n      $scope.$watch($attrs.ngModel, function(val) {\n        if (!val) {\n          return;\n        }\n        return renderView(val);\n      });\n      $scope.$on(\"related-tasks:assigned-to-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      $scope.$on(\"related-tasks:status-changed\", function() {\n        return $rootscope.$broadcast(\"related-tasks:update\");\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgRelatedTaskRow\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", RelatedTaskRowDirective]);\n\n  RelatedTaskCreateFormDirective = function($repo, $compile, $confirm, $tgmodel, $loading, $analytics) {\n    var link, newTask;\n    newTask = {\n      subject: \"\",\n      assigned_to: null\n    };\n    link = function($scope, $el, $attrs) {\n      var close, createTask, render, reset;\n      createTask = function(task) {\n        var currentLoading, promise;\n        task.subject = $el.find('input').val();\n        task.assigned_to = $scope.newTask.assigned_to;\n        task.status = $scope.newTask.status;\n        $scope.newTask.status = $scope.project.default_task_status;\n        $scope.newTask.assigned_to = null;\n        currentLoading = $loading().target($el.find('.task-name')).start();\n        promise = $repo.create(\"tasks\", task);\n        promise.then(function() {\n          $analytics.trackEvent(\"task\", \"create\", \"create task on userstory\", 1);\n          currentLoading.finish();\n          return $scope.$emit(\"related-tasks:add\");\n        });\n        promise.then(null, function() {\n          $el.find('input').val(task.subject);\n          currentLoading.finish();\n          return $confirm.notify(\"error\");\n        });\n        return promise;\n      };\n      close = function() {\n        $el.off();\n        return $scope.openNewRelatedTask = false;\n      };\n      reset = function() {\n        newTask = {\n          subject: \"\",\n          assigned_to: null\n        };\n        newTask[\"status\"] = $scope.project.default_task_status;\n        newTask[\"project\"] = $scope.project.id;\n        newTask[\"user_story\"] = $scope.us.id;\n        return $scope.newTask = $tgmodel.make_model(\"tasks\", newTask);\n      };\n      render = function() {\n        $scope.openNewRelatedTask = true;\n        return $el.on(\"keyup\", \"input\", function(event) {\n          if (event.keyCode === 13) {\n            return createTask(newTask).then(function() {\n              reset();\n              return $el.find('input').focus();\n            });\n          } else if (event.keyCode === 27) {\n            return $scope.$apply(function() {\n              return close();\n            });\n          }\n        });\n      };\n      $scope.save = function() {\n        return createTask(newTask).then(function() {\n          return close();\n        });\n      };\n      taiga.bindOnce($scope, \"us\", reset);\n      $scope.$on(\"related-tasks:show-form\", function() {\n        return $scope.$apply(render);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      scope: true,\n      link: link,\n      templateUrl: 'task/related-task-create-form.html'\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateForm\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgLoading\", \"$tgAnalytics\", RelatedTaskCreateFormDirective]);\n\n  RelatedTaskCreateButtonDirective = function($repo, $compile, $confirm, $tgmodel, $template) {\n    var link, template;\n    template = $template.get(\"common/components/add-button.html\", true);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch(\"project\", function(val) {\n        if (!val) {\n          return;\n        }\n        $el.off();\n        if ($scope.project.my_permissions.indexOf(\"add_task\") !== -1) {\n          $el.html($compile(template())($scope));\n        } else {\n          $el.html(\"\");\n        }\n        return $el.on(\"click\", \".add-button\", function(event) {\n          return $scope.$emit(\"related-tasks:add-new-clicked\");\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskCreateButton\", [\"$tgRepo\", \"$compile\", \"$tgConfirm\", \"$tgModel\", \"$tgTemplate\", RelatedTaskCreateButtonDirective]);\n\n  RelatedTasksDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var _isEditable, _isVisible, loadTasks;\n      loadTasks = function() {\n        return $rs.tasks.list($scope.projectId, null, $scope.usId).then((function(_this) {\n          return function(tasks) {\n            $scope.tasks = _.sortBy(tasks, 'ref');\n            return tasks;\n          };\n        })(this));\n      };\n      _isVisible = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"view_tasks\") !== -1;\n        }\n        return false;\n      };\n      _isEditable = function() {\n        if ($scope.project) {\n          return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n        }\n        return false;\n      };\n      $scope.showRelatedTasks = function() {\n        var ref;\n        return _isVisible() && (_isEditable() || ((ref = $scope.tasks) != null ? ref.length : void 0));\n      };\n      $scope.$on(\"related-tasks:add\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:delete\", function() {\n        return loadTasks().then(function() {\n          return $rootscope.$broadcast(\"related-tasks:update\");\n        });\n      });\n      $scope.$on(\"related-tasks:add-new-clicked\", function() {\n        return $scope.$broadcast(\"related-tasks:show-form\");\n      });\n      taiga.bindOnce($scope, \"us\", function(val) {\n        return loadTasks();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", RelatedTasksDirective]);\n\n  RelatedTaskAssignedToInlineEditionDirective = function($repo, $rootscope, $translate) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task, updateRelatedTask;\n      updateRelatedTask = function(task) {\n        var ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[task.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".task-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $scope.$watch($attrs.tgRelatedTaskAssignedToInlineEdition, function() {\n        task = $scope.$eval($attrs.tgRelatedTaskAssignedToInlineEdition);\n        return updateRelatedTask(task);\n      });\n      updateRelatedTask(task);\n      $el.on(\"click\", \".task-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", task);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", debounce(2000, (function(_this) {\n        return function(ctx, userId, updatedRelatedTask) {\n          if (updatedRelatedTask.id === task.id) {\n            updatedRelatedTask.assigned_to = userId;\n            if (autoSave) {\n              $repo.save(updatedRelatedTask).then(function() {\n                return $scope.$emit(\"related-tasks:assigned-to-changed\");\n              });\n            }\n            return updateRelatedTask(updatedRelatedTask);\n          }\n        };\n      })(this)));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", RelatedTaskAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources.coffee\n */\n\n(function() {\n  var ResourcesService, initResources, initUrls, module, taiga, urls,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ResourcesService = (function(superClass) {\n    extend(ResourcesService, superClass);\n\n    function ResourcesService() {\n      return ResourcesService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ResourcesService;\n\n  })(taiga.Service);\n\n  urls = {\n    \"auth\": \"/auth\",\n    \"auth-register\": \"/auth/register\",\n    \"invitations\": \"/invitations\",\n    \"users\": \"/users\",\n    \"by_username\": \"/users/by_username\",\n    \"users-password-recovery\": \"/users/password_recovery\",\n    \"users-change-password-from-recovery\": \"/users/change_password_from_recovery\",\n    \"users-change-password\": \"/users/change_password\",\n    \"users-change-email\": \"/users/change_email\",\n    \"users-cancel-account\": \"/users/cancel\",\n    \"user-stats\": \"/users/%s/stats\",\n    \"user-liked\": \"/users/%s/liked\",\n    \"user-voted\": \"/users/%s/voted\",\n    \"user-watched\": \"/users/%s/watched\",\n    \"user-contacts\": \"/users/%s/contacts\",\n    \"user-me\": \"/users/me\",\n    \"permissions\": \"/permissions\",\n    \"notify-policies\": \"/notify-policies\",\n    \"user-storage\": \"/user-storage\",\n    \"memberships\": \"/memberships\",\n    \"bulk-create-memberships\": \"/memberships/bulk_create\",\n    \"roles\": \"/roles\",\n    \"permissions\": \"/permissions\",\n    \"resolver\": \"/resolver\",\n    \"projects\": \"/projects\",\n    \"project-templates\": \"/project-templates\",\n    \"project-modules\": \"/projects/%s/modules\",\n    \"bulk-update-projects-order\": \"/projects/bulk_update_order\",\n    \"project-like\": \"/projects/%s/like\",\n    \"project-unlike\": \"/projects/%s/unlike\",\n    \"project-watch\": \"/projects/%s/watch\",\n    \"project-unwatch\": \"/projects/%s/unwatch\",\n    \"project-transfer-validate-token\": \"/projects/%s/transfer_validate_token\",\n    \"project-transfer-accept\": \"/projects/%s/transfer_accept\",\n    \"project-transfer-reject\": \"/projects/%s/transfer_reject\",\n    \"project-transfer-request\": \"/projects/%s/transfer_request\",\n    \"project-transfer-start\": \"/projects/%s/transfer_start\",\n    \"userstory-statuses\": \"/userstory-statuses\",\n    \"points\": \"/points\",\n    \"task-statuses\": \"/task-statuses\",\n    \"issue-statuses\": \"/issue-statuses\",\n    \"issue-types\": \"/issue-types\",\n    \"priorities\": \"/priorities\",\n    \"severities\": \"/severities\",\n    \"milestones\": \"/milestones\",\n    \"userstories\": \"/userstories\",\n    \"bulk-create-us\": \"/userstories/bulk_create\",\n    \"bulk-update-us-backlog-order\": \"/userstories/bulk_update_backlog_order\",\n    \"bulk-update-us-sprint-order\": \"/userstories/bulk_update_sprint_order\",\n    \"bulk-update-us-kanban-order\": \"/userstories/bulk_update_kanban_order\",\n    \"userstories-filters\": \"/userstories/filters_data\",\n    \"userstory-upvote\": \"/userstories/%s/upvote\",\n    \"userstory-downvote\": \"/userstories/%s/downvote\",\n    \"userstory-watch\": \"/userstories/%s/watch\",\n    \"userstory-unwatch\": \"/userstories/%s/unwatch\",\n    \"tasks\": \"/tasks\",\n    \"bulk-create-tasks\": \"/tasks/bulk_create\",\n    \"bulk-update-task-taskboard-order\": \"/tasks/bulk_update_taskboard_order\",\n    \"task-upvote\": \"/tasks/%s/upvote\",\n    \"task-downvote\": \"/tasks/%s/downvote\",\n    \"task-watch\": \"/tasks/%s/watch\",\n    \"task-unwatch\": \"/tasks/%s/unwatch\",\n    \"issues\": \"/issues\",\n    \"bulk-create-issues\": \"/issues/bulk_create\",\n    \"issues-filters\": \"/issues/filters_data\",\n    \"issue-upvote\": \"/issues/%s/upvote\",\n    \"issue-downvote\": \"/issues/%s/downvote\",\n    \"issue-watch\": \"/issues/%s/watch\",\n    \"issue-unwatch\": \"/issues/%s/unwatch\",\n    \"wiki\": \"/wiki\",\n    \"wiki-restore\": \"/wiki/%s/restore\",\n    \"wiki-links\": \"/wiki-links\",\n    \"history/us\": \"/history/userstory\",\n    \"history/issue\": \"/history/issue\",\n    \"history/task\": \"/history/task\",\n    \"history/wiki\": \"/history/wiki\",\n    \"attachments/us\": \"/userstories/attachments\",\n    \"attachments/issue\": \"/issues/attachments\",\n    \"attachments/task\": \"/tasks/attachments\",\n    \"attachments/wiki_page\": \"/wiki/attachments\",\n    \"custom-attributes/userstory\": \"/userstory-custom-attributes\",\n    \"custom-attributes/issue\": \"/issue-custom-attributes\",\n    \"custom-attributes/task\": \"/task-custom-attributes\",\n    \"custom-attributes-values/userstory\": \"/userstories/custom-attributes-values\",\n    \"custom-attributes-values/issue\": \"/issues/custom-attributes-values\",\n    \"custom-attributes-values/task\": \"/tasks/custom-attributes-values\",\n    \"webhooks\": \"/webhooks\",\n    \"webhooks-test\": \"/webhooks/%s/test\",\n    \"webhooklogs\": \"/webhooklogs\",\n    \"webhooklogs-resend\": \"/webhooklogs/%s/resend\",\n    \"userstories-csv\": \"/userstories/csv?uuid=%s\",\n    \"tasks-csv\": \"/tasks/csv?uuid=%s\",\n    \"issues-csv\": \"/issues/csv?uuid=%s\",\n    \"timeline-profile\": \"/timeline/profile\",\n    \"timeline-user\": \"/timeline/user\",\n    \"timeline-project\": \"/timeline/project\",\n    \"search\": \"/search\",\n    \"exporter\": \"/exporter\",\n    \"importer\": \"/importer/load_dump\",\n    \"feedback\": \"/feedback\",\n    \"locales\": \"/locales\",\n    \"applications\": \"/applications\",\n    \"application-tokens\": \"/application-tokens\",\n    \"stats-discover\": \"/stats/discover\"\n  };\n\n  initUrls = function($log, $urls) {\n    $log.debug(\"Initialize api urls\");\n    return $urls.update(urls);\n  };\n\n  initResources = function($log, $rs) {\n    var i, len, provider, providers, results;\n    $log.debug(\"Initialize resources\");\n    providers = _.toArray(arguments).slice(2);\n    results = [];\n    for (i = 0, len = providers.length; i < len; i++) {\n      provider = providers[i];\n      results.push(provider($rs));\n    }\n    return results;\n  };\n\n  module = angular.module(\"taigaResources\", [\"taigaBase\"]);\n\n  module.service(\"$tgResources\", ResourcesService);\n\n  module.run([\"$log\", \"$tgUrls\", initUrls]);\n\n  module.run([\"$log\", \"$tgResources\", \"$tgProjectsResourcesProvider\", \"$tgCustomAttributesResourcesProvider\", \"$tgCustomAttributesValuesResourcesProvider\", \"$tgMembershipsResourcesProvider\", \"$tgNotifyPoliciesResourcesProvider\", \"$tgInvitationsResourcesProvider\", \"$tgRolesResourcesProvider\", \"$tgUserSettingsResourcesProvider\", \"$tgSprintsResourcesProvider\", \"$tgUserstoriesResourcesProvider\", \"$tgTasksResourcesProvider\", \"$tgIssuesResourcesProvider\", \"$tgWikiResourcesProvider\", \"$tgSearchResourcesProvider\", \"$tgMdRenderResourcesProvider\", \"$tgHistoryResourcesProvider\", \"$tgKanbanResourcesProvider\", \"$tgModulesResourcesProvider\", \"$tgWebhooksResourcesProvider\", \"$tgWebhookLogsResourcesProvider\", \"$tgLocalesResourcesProvider\", \"$tgUsersResourcesProvider\", initResources]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/search.coffee\n */\n\n(function() {\n  var SearchBoxDirective, SearchController, SearchDirective, bindOnce, debounce, debounceLeading, groupBy, mixOf, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  mixOf = this.taiga.mixOf;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  trim = this.taiga.trim;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaSearch\", []);\n\n  SearchController = (function(superClass) {\n    extend(SearchController, superClass);\n\n    SearchController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$translate\"];\n\n    function SearchController(scope1, repo, rs, params, q, location, appMetaService, navUrls, translate) {\n      var loadSearchData, promise;\n      this.scope = scope1;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.scope.sectionName = \"Search\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"SEARCH.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"SEARCH.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.searchTerm = null;\n      loadSearchData = debounceLeading(100, (function(_this) {\n        return function(t) {\n          return _this.loadSearchData(t);\n        };\n      })(this));\n      bindOnce(this.scope, \"projectId\", (function(_this) {\n        return function(projectId) {\n          if (!_this.scope.searchResults && _this.scope.searchTerm) {\n            return _this.loadSearchData();\n          }\n        };\n      })(this));\n      this.scope.$watch(\"searchTerm\", (function(_this) {\n        return function(term) {\n          if (term !== void 0 && _this.scope.projectId) {\n            return _this.loadSearchData(term);\n          }\n        };\n      })(this));\n    }\n\n    SearchController.prototype.loadFilters = function() {\n      var defered;\n      defered = this.q.defer();\n      defered.resolve();\n      return defered.promise;\n    };\n\n    SearchController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    SearchController.prototype.loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      this.scope.loading = true;\n      return this._loadSearchData(term).then((function(_this) {\n        return function(data) {\n          _this.scope.searchResults = data;\n          return _this.scope.loading = false;\n        };\n      })(this));\n    };\n\n    SearchController.prototype._loadSearchData = function(term) {\n      if (term == null) {\n        term = \"\";\n      }\n      if (this._promise) {\n        this._promise.abort();\n      }\n      this._promise = this.rs.search[\"do\"](this.scope.projectId, term);\n      return this._promise;\n    };\n\n    SearchController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          return _this.fillUsersAndRoles(project.members, project.roles);\n        };\n      })(this));\n    };\n\n    return SearchController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"SearchController\", SearchController);\n\n  SearchBoxDirective = function(projectService, $lightboxService, $navurls, $location, $route) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var openLightbox, project, submit;\n      project = null;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, text, url;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          text = $el.find(\"#search-text\").val();\n          url = $navurls.resolve(\"project-search\", {\n            project: project.get(\"slug\")\n          });\n          return $scope.$apply(function() {\n            $lightboxService.close($el);\n            $location.path(url);\n            $location.search(\"text\", text).path(url);\n            return $route.reload();\n          });\n        };\n      })(this));\n      openLightbox = function() {\n        project = projectService.project;\n        return $lightboxService.open($el).then(function() {\n          return $el.find(\"#search-text\").focus();\n        });\n      };\n      $el.on(\"submit\", \"form\", submit);\n      return openLightbox();\n    };\n    return {\n      templateUrl: \"search/lightbox-search.html\",\n      link: link\n    };\n  };\n\n  SearchBoxDirective.$inject = [\"tgProjectService\", \"lightboxService\", \"$tgNavUrls\", \"$tgLocation\", \"$route\"];\n\n  module.directive(\"tgSearchBox\", SearchBoxDirective);\n\n  SearchDirective = function($log, $compile, $templatecache, $routeparams, $location) {\n    var link, linkTable;\n    linkTable = function($scope, $el, $attrs, $ctrl) {\n      var activeSectionName, applyAutoTab, getActiveSection, lastSearchResults, markSectionTabActive, renderFilterTabs, renderTableContent, tabsDom, templates;\n      applyAutoTab = true;\n      activeSectionName = \"userstories\";\n      tabsDom = $el.find(\".search-filter\");\n      lastSearchResults = null;\n      getActiveSection = function(data) {\n        var i, len, maxVal, name, ref, selectedSection, value;\n        maxVal = 0;\n        selectedSection = {};\n        selectedSection.name = \"userstories\";\n        selectedSection.value = [];\n        if (!applyAutoTab) {\n          selectedSection.name = activeSectionName;\n          selectedSection.value = data[activeSectionName];\n          return selectedSection;\n        }\n        if (data) {\n          ref = [\"userstories\", \"issues\", \"tasks\", \"wikipages\"];\n          for (i = 0, len = ref.length; i < len; i++) {\n            name = ref[i];\n            value = data[name];\n            if (value.length > maxVal) {\n              maxVal = value.length;\n              selectedSection.name = name;\n              selectedSection.value = value;\n              break;\n            }\n          }\n        }\n        if (maxVal === 0) {\n          return selectedSection;\n        }\n        return selectedSection;\n      };\n      renderFilterTabs = function(data) {\n        var name, results, value;\n        results = [];\n        for (name in data) {\n          value = data[name];\n          tabsDom.find(\"li.\" + name).show();\n          results.push(tabsDom.find(\"li.\" + name + \" .num\").html(value.length));\n        }\n        return results;\n      };\n      markSectionTabActive = function(section) {\n        tabsDom.find(\"a.active\").removeClass(\"active\");\n        tabsDom.find(\"li.\" + section.name + \" a\").addClass(\"active\");\n        applyAutoTab = false;\n        return activeSectionName = section.name;\n      };\n      templates = {\n        issues: $templatecache.get(\"search-issues\"),\n        tasks: $templatecache.get(\"search-tasks\"),\n        userstories: $templatecache.get(\"search-userstories\"),\n        wikipages: $templatecache.get(\"search-wikipages\")\n      };\n      renderTableContent = function(section) {\n        var element, oldElements, oldScope, scope, template;\n        oldElements = $el.find(\".search-result-table\").children();\n        oldScope = oldElements.scope();\n        if (oldScope) {\n          oldScope.$destroy();\n          oldElements.remove();\n        }\n        scope = $scope.$new();\n        scope[section.name] = section.value;\n        template = angular.element.parseHTML(trim(templates[section.name]));\n        element = $compile(template)(scope);\n        return $el.find(\".search-result-table\").html(element);\n      };\n      $scope.$watch(\"searchResults\", function(data) {\n        var activeSection;\n        lastSearchResults = data;\n        if (!lastSearchResults) {\n          return;\n        }\n        activeSection = getActiveSection(data);\n        renderFilterTabs(data);\n        renderTableContent(activeSection);\n        return markSectionTabActive(activeSection);\n      });\n      $scope.$watch(\"searchTerm\", function(searchTerm) {\n        if (searchTerm !== void 0) {\n          return $location.search(\"text\", searchTerm);\n        }\n      });\n      return $el.on(\"click\", \".search-filter li > a\", function(event) {\n        var section, sectionData, sectionName, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        sectionName = target.parent().data(\"name\");\n        sectionData = !lastSearchResults ? [] : lastSearchResults[sectionName];\n        section = {\n          name: sectionName,\n          value: sectionData\n        };\n        return $scope.$apply(function() {\n          renderTableContent(section);\n          return markSectionTabActive(section);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, searchText;\n      $ctrl = $el.controller();\n      linkTable($scope, $el, $attrs, $ctrl);\n      searchText = $routeparams.text;\n      return $scope.$watch(\"projectId\", function(projectId) {\n        if (projectId != null) {\n          return $scope.searchTerm = searchText;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSearch\", [\"$log\", \"$compile\", \"$templateCache\", \"$routeParams\", \"$tgLocation\", SearchDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTaskboard\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTasks\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaTeam\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserSettings\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaUserStories\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaWiki\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/analytics.coffee\n */\n\n(function() {\n  var AnalyticsService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  AnalyticsService = (function(superClass) {\n    extend(AnalyticsService, superClass);\n\n    AnalyticsService.$inject = [\"$rootScope\", \"$log\", \"$tgConfig\", \"$window\", \"$document\", \"$location\"];\n\n    function AnalyticsService(rootscope, log, config, win, doc, location) {\n      var conf;\n      this.rootscope = rootscope;\n      this.log = log;\n      this.config = config;\n      this.win = win;\n      this.doc = doc;\n      this.location = location;\n      this.initialized = false;\n      conf = this.config.get(\"analytics\", {});\n      this.accountId = conf.accountId;\n      this.pageEvent = conf.pageEvent || \"$routeChangeSuccess\";\n      this.trackRoutes = conf.trackRoutes || true;\n      this.ignoreFirstPageLoad = conf.ignoreFirstPageLoad || false;\n    }\n\n    AnalyticsService.prototype.initialize = function() {\n      if (!this.accountId) {\n        this.log.debug(\"Analytics: no acount id provided. Disabling.\");\n        return;\n      }\n      this.injectAnalytics();\n      this.win.ga(\"create\", this.accountId, \"auto\");\n      this.win.ga(\"require\", \"displayfeatures\");\n      if (this.trackRoutes && (!this.ignoreFirstPageLoad)) {\n        this.win.ga(\"send\", \"pageview\", this.getUrl());\n      }\n      if (this.trackRoutes) {\n        this.rootscope.$on(this.pageEvent, (function(_this) {\n          return function() {\n            return _this.trackPage(_this.getUrl(), \"Taiga\");\n          };\n        })(this));\n      }\n      return this.initialized = true;\n    };\n\n    AnalyticsService.prototype.getUrl = function() {\n      return this.location.path();\n    };\n\n    AnalyticsService.prototype.injectAnalytics = function() {\n      var fn;\n      fn = (function(i,s,o,g,r,a,m){i[\"GoogleAnalyticsObject\"]=r;i[r]=i[r]||function(){\n              (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),\n              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);});\n      return fn(window, document, \"script\", \"//www.google-analytics.com/analytics.js\", \"ga\");\n    };\n\n    AnalyticsService.prototype.trackPage = function(url, title) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      title = title || this.doc[0].title;\n      return this.win.ga(\"send\", \"pageview\", {\n        \"page\": url,\n        \"title\": title\n      });\n    };\n\n    AnalyticsService.prototype.trackEvent = function(category, action, label, value) {\n      if (!this.initialized) {\n        return;\n      }\n      if (!this.win.ga) {\n        return;\n      }\n      return this.win.ga(\"send\", \"event\", category, action, label, value);\n    };\n\n    return AnalyticsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgAnalytics\", AnalyticsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: bind-scope.coffee\n */\n\n(function() {\n  var BindScope, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  BindScope = function(config) {\n    var link;\n    if (!config.debugInfo) {\n      jQuery.fn.scope = function() {\n        return this.data('scope');\n      };\n    }\n    link = function($scope, $el) {\n      if (!config.debugInfo) {\n        return $el.data('scope', $scope).addClass('tg-scope');\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBindScope\", [\"$tgConfig\", BindScope]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: compile-html.directive.coffee\n */\n\n(function() {\n  var CompileHtmlDirective;\n\n  CompileHtmlDirective = function($compile) {\n    var link;\n    link = function(scope, element, attrs) {\n      return scope.$watch(attrs.tgCompileHtml, function(newValue, oldValue) {\n        element.html(newValue);\n        return $compile(element.contents())(scope);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CompileHtmlDirective.$inject = [\"$compile\"];\n\n  angular.module(\"taigaCommon\").directive(\"tgCompileHtml\", CompileHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/components.coffee\n */\n\n(function() {\n  var AssignedToDirective, BlockButtonDirective, CreatedByDisplayDirective, DateRangeDirective, DateSelectorDirective, DeleteButtonDirective, EditableDescriptionDirective, EditableSubjectDirective, EditableWysiwyg, ListItemAssignedtoDirective, ListItemIssueStatusDirective, ListItemPriorityDirective, ListItemSeverityDirective, ListItemTaskStatusDirective, ListItemTypeDirective, ListItemUsStatusDirective, SprintProgressBarDirective, TgMainTitleDirective, TgProgressBarDirective, WatchersDirective, bindOnce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  DateRangeDirective = function($translate) {\n    var link, renderRange;\n    renderRange = function($el, first, second) {\n      var endDate, initDate, prettyDate;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      initDate = moment(first).format(prettyDate);\n      endDate = moment(second).format(prettyDate);\n      return $el.html(initDate + \"-\" + endDate);\n    };\n    link = function($scope, $el, $attrs) {\n      var first, ref, second;\n      ref = $attrs.tgDateRange.split(\",\"), first = ref[0], second = ref[1];\n      return bindOnce($scope, first, function(valFirst) {\n        return bindOnce($scope, second, function(valSecond) {\n          return renderRange($el, valFirst, valSecond);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgDateRange\", [\"$translate\", DateRangeDirective]);\n\n  DateSelectorDirective = function($rootscope, datePickerConfigService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var initialize, selectedDate, unbind;\n      selectedDate = null;\n      initialize = function() {\n        var datePickerConfig;\n        datePickerConfig = datePickerConfigService.get();\n        _.merge(datePickerConfig, {\n          field: $el[0],\n          onSelect: (function(_this) {\n            return function(date) {\n              return selectedDate = date;\n            };\n          })(this),\n          onOpen: (function(_this) {\n            return function() {\n              if (selectedDate != null) {\n                return $el.picker.setDate(selectedDate);\n              }\n            };\n          })(this)\n        });\n        return $el.picker = new Pikaday(datePickerConfig);\n      };\n      unbind = $rootscope.$on(\"$translateChangeEnd\", (function(_this) {\n        return function(ctx) {\n          return initialize();\n        };\n      })(this));\n      $scope.$watch($attrs.ngModel, function(val) {\n        if ((val != null) && !$el.picker) {\n          initialize();\n        }\n        if (val != null) {\n          return $el.picker.setDate(val);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgDateSelector\", [\"$rootScope\", \"tgDatePickerConfigService\", DateSelectorDirective]);\n\n  SprintProgressBarDirective = function() {\n    var link, renderProgress;\n    renderProgress = function($el, percentage, visual_percentage) {\n      if ($el.hasClass(\".current-progress\")) {\n        return $el.css(\"width\", percentage + \"%\");\n      } else {\n        $el.find(\".current-progress\").css(\"width\", visual_percentage + \"%\");\n        return $el.find(\".number\").html(percentage + \" %\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.tgSprintProgressbar, function(sprint) {\n        var closedPoints, percentage, totalPoints, visual_percentage;\n        closedPoints = sprint.closed_points;\n        totalPoints = sprint.total_points;\n        percentage = 0;\n        if (totalPoints !== 0) {\n          percentage = Math.round(100 * (closedPoints / totalPoints));\n        }\n        visual_percentage = 0;\n        if (totalPoints !== 0) {\n          visual_percentage = Math.round(98 * (closedPoints / totalPoints));\n        }\n        return renderProgress($el, percentage, visual_percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintProgressbar\", SprintProgressBarDirective);\n\n  CreatedByDisplayDirective = function($template, $compile, $translate, $navUrls) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        var ref;\n        if (model != null) {\n          $scope.owner = model.owner_extra_info || {\n            full_name_display: $translate.instant(\"COMMON.EXTERNAL_USER\"),\n            photo: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n          $scope.url = ((ref = $scope.owner) != null ? ref.is_active : void 0) ? $navUrls.resolve(\"user-profile\", {\n            username: $scope.owner.username\n          }) : \"\";\n          return $scope.date = moment(model.created_date).format($translate.instant(\"COMMON.DATETIME\"));\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      scope: true,\n      templateUrl: \"common/components/created-by.html\"\n    };\n  };\n\n  module.directive(\"tgCreatedByDisplay\", [\"$tgTemplate\", \"$compile\", \"$translate\", \"$tgNavUrls\", CreatedByDisplayDirective]);\n\n  WatchersDirective = function($rootscope, $confirm, $repo, $qqueue, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/watchers.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var deleteWatcher, isEditable, renderWatchers, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(watchers) {\n          var item, promise;\n          item = $model.$modelValue.clone();\n          item.watchers = watchers;\n          $model.$setViewValue(item);\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            watchers = _.map(watchers, function(watcherId) {\n              return $scope.usersById[watcherId];\n            });\n            renderWatchers(watchers);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            $model.$modelValue.revert();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      deleteWatcher = $qqueue.bindAdd((function(_this) {\n        return function(watcherIds) {\n          var item, promise;\n          item = $model.$modelValue.clone();\n          item.watchers = watcherIds;\n          $model.$setViewValue(item);\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            var watchers;\n            watchers = _.map(item.watchers, function(watcherId) {\n              return $scope.usersById[watcherId];\n            });\n            renderWatchers(watchers);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            item.revert();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      renderWatchers = function(watchers) {\n        var ctx, html;\n        ctx = {\n          watchers: watchers,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".js-delete-watcher\", function(event) {\n        var message, target, title, watcherId;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        watcherId = target.data(\"watcher-id\");\n        title = $translate.instant(\"COMMON.WATCHERS.TITLE_LIGHTBOX_DELETE_WARTCHER\");\n        message = $scope.usersById[watcherId].full_name_display;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var watcherIds;\n            askResponse.finish();\n            watcherIds = _.clone($model.$modelValue.watchers, false);\n            watcherIds = _.pull(watcherIds, watcherId);\n            return deleteWatcher(watcherIds);\n          };\n        })(this));\n      });\n      $scope.$on(\"watcher:added\", function(ctx, watcherId) {\n        var watchers;\n        watchers = _.clone($model.$modelValue.watchers, false);\n        watchers.push(watcherId);\n        watchers = _.uniq(watchers);\n        return save(watchers);\n      });\n      $scope.$watch($attrs.ngModel, function(item) {\n        var watchers;\n        if (item == null) {\n          return;\n        }\n        watchers = _.map(item.watchers, function(watcherId) {\n          return $scope.usersById[watcherId];\n        });\n        return renderWatchers(watchers);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWatchers\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", \"$translate\", WatchersDirective]);\n\n  AssignedToDirective = function($rootscope, $confirm, $repo, $loading, $qqueue, $template, $translate, $compile, $currentUserService) {\n    var link, template;\n    template = $template.get(\"common/components/assigned-to.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, renderAssignedTo, save;\n      isEditable = function() {\n        var ref, ref1;\n        return ((ref = $scope.project) != null ? (ref1 = ref.my_permissions) != null ? ref1.indexOf($attrs.requiredPerm) : void 0 : void 0) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(userId) {\n          var currentLoading, promise;\n          $model.$modelValue.assigned_to = userId;\n          currentLoading = $loading().target($el).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            currentLoading.finish();\n            renderAssignedTo($model.$modelValue);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            $model.$modelValue.revert();\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          });\n          return promise;\n        };\n      })(this));\n      renderAssignedTo = function(assignedObject) {\n        var ctx, fullName, html, isIocaine, isUnassigned, photo;\n        if ((assignedObject != null ? assignedObject.assigned_to : void 0) != null) {\n          fullName = assignedObject.assigned_to_extra_info.full_name_display;\n          photo = assignedObject.assigned_to_extra_info.photo;\n          isUnassigned = false;\n        } else {\n          fullName = $translate.instant(\"COMMON.ASSIGNED_TO.ASSIGN\");\n          photo = \"/\" + window._version + \"/images/unnamed.png\";\n          isUnassigned = true;\n        }\n        isIocaine = assignedObject != null ? assignedObject.is_iocaine : void 0;\n        ctx = {\n          fullName: fullName,\n          photo: photo,\n          isUnassigned: isUnassigned,\n          isEditable: isEditable(),\n          isIocaine: isIocaine,\n          fullNameVisible: !(isUnassigned && !$currentUserService.isAuthenticated())\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \".user-assigned\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        return $scope.$apply(function() {\n          return $rootscope.$broadcast(\"assigned-to:add\", $model.$modelValue);\n        });\n      });\n      $el.on(\"click\", \".assign-to-me\", function(event) {\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        $model.$modelValue.assigned_to = $currentUserService.getUser().get('id');\n        return save($currentUserService.getUser().get('id'));\n      });\n      $el.on(\"click\", \".remove-user\", function(event) {\n        var title;\n        event.preventDefault();\n        if (!isEditable()) {\n          return;\n        }\n        title = $translate.instant(\"COMMON.ASSIGNED_TO.CONFIRM_UNASSIGNED\");\n        return $confirm.ask(title).then((function(_this) {\n          return function(response) {\n            response.finish();\n            $model.$modelValue.assigned_to = null;\n            return save(null);\n          };\n        })(this));\n      });\n      $scope.$on(\"assigned-to:added\", function(ctx, userId, item) {\n        if (item.id !== $model.$modelValue.id) {\n          return;\n        }\n        return save(userId);\n      });\n      $scope.$watch($attrs.ngModel, function(instance) {\n        return renderAssignedTo(instance);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgAssignedTo\", [\"$rootScope\", \"$tgConfirm\", \"$tgRepo\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$translate\", \"$compile\", \"tgCurrentUserService\", AssignedToDirective]);\n\n  BlockButtonDirective = function($rootscope, $loading, $template) {\n    var link, template;\n    template = $template.get(\"common/components/block-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      $scope.$watch($attrs.ngModel, function(item) {\n        if (!item) {\n          return;\n        }\n        if (isEditable()) {\n          $el.find('.item-block').addClass('editable');\n        }\n        if (item.is_blocked) {\n          $el.find('.item-block').removeClass('is-active');\n          return $el.find('.item-unblock').addClass('is-active');\n        } else {\n          $el.find('.item-block').addClass('is-active');\n          return $el.find('.item-unblock').removeClass('is-active');\n        }\n      });\n      $el.on(\"click\", \".item-block\", function(event) {\n        event.preventDefault();\n        return $rootscope.$broadcast(\"block\", $model.$modelValue);\n      });\n      $el.on(\"click\", \".item-unblock\", function(event) {\n        var currentLoading, finish;\n        event.preventDefault();\n        currentLoading = $loading().target($el.find(\".item-unblock\")).start();\n        finish = function() {\n          return currentLoading.finish();\n        };\n        return $rootscope.$broadcast(\"unblock\", $model.$modelValue, finish);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgBlockButton\", [\"$rootScope\", \"$tgLoading\", \"$tgTemplate\", BlockButtonDirective]);\n\n  DeleteButtonDirective = function($log, $repo, $confirm, $location, $template) {\n    var link, template;\n    template = $template.get(\"common/components/delete-button.html\");\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.onDeleteGoToUrl) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-go-to-url set in scope.\");\n      }\n      if (!$attrs.onDeleteTitle) {\n        return $log.error(\"DeleteButtonDirective requires on-delete-title set in scope.\");\n      }\n      $el.on(\"click\", \".button-delete\", function(event) {\n        var subtitle, title;\n        title = $attrs.onDeleteTitle;\n        subtitle = $model.$modelValue.subject;\n        return $confirm.askOnDelete(title, subtitle).then((function(_this) {\n          return function(askResponse) {\n            var promise;\n            promise = $repo.remove($model.$modelValue);\n            promise.then(function() {\n              var url;\n              askResponse.finish();\n              url = $scope.$eval($attrs.onDeleteGoToUrl);\n              return $location.path(url);\n            });\n            return promise.then(null, function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            });\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgDeleteButton\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgTemplate\", DeleteButtonDirective]);\n\n  EditableSubjectDirective = function($rootscope, $repo, $confirm, $loading, $qqueue, $template) {\n    var link, template;\n    template = $template.get(\"common/components/editable-subject.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-subject').hide();\n        return $el.find('.view-subject').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(subject) {\n          var currentLoading, promise;\n          $model.$modelValue.subject = subject;\n          currentLoading = $loading().target($el.find('.save-container')).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-subject').hide();\n            return $el.find('.view-subject').show();\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n          return promise;\n        };\n      })(this));\n      $el.click(function() {\n        if (!isEditable()) {\n          return;\n        }\n        $el.find('.edit-subject').show();\n        $el.find('.view-subject').hide();\n        return $el.find('input').focus();\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var subject;\n        e.preventDefault();\n        subject = $scope.item.subject;\n        return save(subject);\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        var subject;\n        if (event.keyCode === 13) {\n          subject = $scope.item.subject;\n          return save(subject);\n        } else if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $model.$modelValue.revert();\n            };\n          })(this));\n          $el.find('.edit-subject').hide();\n          return $el.find('.view-subject').show();\n        }\n      });\n      $el.find('.edit-subject').hide();\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (!isEditable()) {\n          return $el.find('.view-subject .edit').remove();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableSubject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", EditableSubjectDirective]);\n\n  EditableDescriptionDirective = function($rootscope, $repo, $confirm, $compile, $loading, $selectedText, $qqueue, $template) {\n    var link, noDescriptionMegEditMode, noDescriptionMegReadMode, template;\n    template = $template.get(\"common/components/editable-description.html\");\n    noDescriptionMegEditMode = $template.get(\"common/components/editable-description-msg-edit-mode.html\");\n    noDescriptionMegReadMode = $template.get(\"common/components/editable-description-msg-read-mode.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, save;\n      $el.find('.edit-description').hide();\n      $el.find('.view-description .edit').hide();\n      $scope.$on(\"object:updated\", function() {\n        $el.find('.edit-description').hide();\n        return $el.find('.view-description').show();\n      });\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(description) {\n          var currentLoading, promise;\n          $model.$modelValue.description = description;\n          currentLoading = $loading().target($el.find('.save-container')).start();\n          promise = $repo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $el.find('.edit-description').hide();\n            return $el.find('.view-description').show();\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          return promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n      $el.on(\"mouseup\", \".view-description\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        $el.find('.edit-description').show();\n        $el.find('.view-description').hide();\n        return $el.find('textarea').focus();\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".save\", function(e) {\n        var description;\n        e.preventDefault();\n        description = $scope.item.description;\n        return save(description);\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode === 27) {\n          $scope.$apply((function(_this) {\n            return function() {\n              return $scope.item.revert();\n            };\n          })(this));\n          $el.find('.edit-description').hide();\n          return $el.find('.view-description').show();\n        }\n      });\n      $scope.$watch($attrs.ngModel, function(value) {\n        if (!value) {\n          return;\n        }\n        $scope.item = value;\n        if (isEditable()) {\n          $el.find('.view-description .edit').show();\n          $el.find('.view-description .us-content').addClass('editable');\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegEditMode)($scope);\n        } else {\n          return $scope.noDescriptionMsg = $compile(noDescriptionMegReadMode)($scope);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      template: template\n    };\n  };\n\n  module.directive(\"tgEditableDescription\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", \"$tgLoading\", \"$selectedText\", \"$tgQqueue\", \"$tgTemplate\", EditableDescriptionDirective]);\n\n  EditableWysiwyg = function(attachmentsService, attachmentsFullService) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var isInEditMode, uploadFile;\n      isInEditMode = function() {\n        return $el.find('textarea').is(':visible');\n      };\n      uploadFile = function(file, type) {\n        if (!attachmentsService.validate(file)) {\n          return;\n        }\n        return attachmentsFullService.addAttachment($model.$modelValue.project, $model.$modelValue.id, type, file).then(function(result) {\n          if (taiga.isImage(result.getIn(['file', 'name']))) {\n            return '![' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          } else {\n            return '[' + result.getIn(['file', 'name']) + '](' + result.getIn(['file', 'url']) + ')';\n          }\n        });\n      };\n      $el.on('dragover', function(e) {\n        var textarea;\n        textarea = $el.find('textarea').focus();\n        return false;\n      });\n      return $el.on('drop', function(e) {\n        var dataTransfer, promises, textarea, type;\n        e.stopPropagation();\n        e.preventDefault();\n        if (isInEditMode()) {\n          dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n          textarea = $el.find('textarea');\n          textarea.addClass('in-progress');\n          type = $model.$modelValue['_name'];\n          if (type === \"userstories\") {\n            type = \"us\";\n          } else if (type === \"tasks\") {\n            type = \"task\";\n          } else if (type === \"issues\") {\n            type = \"issue\";\n          } else if (type === \"wiki\") {\n            type = \"wiki_page\";\n          }\n          promises = _.map(dataTransfer.files, function(file) {\n            return uploadFile(file, type);\n          });\n          return Promise.all(promises).then(function(result) {\n            textarea = $el.find('textarea');\n            $.markItUp({\n              replaceWith: result.join(' ')\n            });\n            return textarea.removeClass('in-progress');\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgEditableWysiwyg\", [\"tgAttachmentsService\", \"tgAttachmentsFullService\", EditableWysiwyg]);\n\n  ListItemUsStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var us;\n      us = $scope.$eval($attrs.tgListitemUsStatus);\n      return bindOnce($scope, \"usStatusById\", function(usStatusById) {\n        return $el.html(usStatusById[us.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemUsStatus\", ListItemUsStatusDirective);\n\n  ListItemTaskStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var task;\n      task = $scope.$eval($attrs.tgListitemTaskStatus);\n      return bindOnce($scope, \"taskStatusById\", function(taskStatusById) {\n        return $el.html(taskStatusById[task.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemTaskStatus\", ListItemTaskStatusDirective);\n\n  ListItemAssignedtoDirective = function($template, $translate) {\n    var link, template;\n    template = $template.get(\"common/components/list-item-assigned-to-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"usersById\", function(usersById) {\n        var ctx, item, member;\n        item = $scope.$eval($attrs.tgListitemAssignedto);\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = usersById[item.assigned_to];\n        if (member) {\n          ctx.imgurl = member.photo;\n          ctx.name = member.full_name_display;\n        }\n        return $el.html(template(ctx));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemAssignedto\", [\"$tgTemplate\", \"$translate\", ListItemAssignedtoDirective]);\n\n  ListItemIssueStatusDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var issue;\n      issue = $scope.$eval($attrs.tgListitemIssueStatus);\n      return bindOnce($scope, \"issueStatusById\", function(issueStatusById) {\n        return $el.html(issueStatusById[issue.status].name);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgListitemIssueStatus\", ListItemIssueStatusDirective);\n\n  ListItemTypeDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issueTypeById, issue) {\n        var domNode, type;\n        type = issueTypeById[issue.type];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", type.color);\n        return domNode.attr(\"title\", type.name);\n      };\n      bindOnce($scope, \"issueTypeById\", function(issueTypeById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemType);\n        return render(issueTypeById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemType, function(issue) {\n        return render($scope.issueTypeById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemType\", ListItemTypeDirective);\n\n  ListItemPriorityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(priorityById, issue) {\n        var domNode, priority;\n        priority = priorityById[issue.priority];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", priority.color);\n        return domNode.attr(\"title\", priority.name);\n      };\n      bindOnce($scope, \"priorityById\", function(priorityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemPriority);\n        return render(priorityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemPriority, function(issue) {\n        return render($scope.priorityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemPriority\", ListItemPriorityDirective);\n\n  ListItemSeverityDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(severityById, issue) {\n        var domNode, severity;\n        severity = severityById[issue.severity];\n        domNode = $el.find(\".level\");\n        domNode.css(\"background-color\", severity.color);\n        return domNode.attr(\"title\", severity.name);\n      };\n      bindOnce($scope, \"severityById\", function(severityById) {\n        var issue;\n        issue = $scope.$eval($attrs.tgListitemSeverity);\n        return render(severityById, issue);\n      });\n      return $scope.$watch($attrs.tgListitemSeverity, function(issue) {\n        return render($scope.severityById, issue);\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/level.html\"\n    };\n  };\n\n  module.directive(\"tgListitemSeverity\", ListItemSeverityDirective);\n\n  TgProgressBarDirective = function($template) {\n    var link, render, template;\n    template = $template.get(\"common/components/progress-bar.html\", true);\n    render = function(el, percentage) {\n      return el.html(template({\n        percentage: percentage\n      }));\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgProgressBar, function(percentage) {\n        percentage = _.max([0, percentage]);\n        percentage = _.min([100, percentage]);\n        return render($el, percentage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProgressBar\", [\"$tgTemplate\", TgProgressBarDirective]);\n\n  TgMainTitleDirective = function($translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      $attrs.$observe(\"i18nSectionName\", function(i18nSectionName) {\n        return $scope.sectionName = i18nSectionName;\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"common/components/main-title.html\",\n      scope: {\n        projectName: \"=projectName\"\n      }\n    };\n  };\n\n  module.directive(\"tgMainTitle\", [\"$translate\", TgMainTitleDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/confirm.coffee\n */\n\n(function() {\n  var ConfirmService, NOTIFICATION_MSG, bindMethods, cancelTimeout, debounce, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  timeout = this.taiga.timeout;\n\n  cancelTimeout = this.taiga.cancelTimeout;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  NOTIFICATION_MSG = {\n    \"success\": {\n      title: \"NOTIFICATION.OK\",\n      message: \"NOTIFICATION.SAVED\"\n    },\n    \"error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    },\n    \"light-error\": {\n      title: \"NOTIFICATION.WARNING\",\n      message: \"NOTIFICATION.WARNING_TEXT\"\n    }\n  };\n\n  ConfirmService = (function(superClass) {\n    extend(ConfirmService, superClass);\n\n    ConfirmService.$inject = [\"$q\", \"lightboxService\", \"$tgLoading\", \"$translate\"];\n\n    function ConfirmService(q, lightboxService, loading, translate) {\n      this.q = q;\n      this.lightboxService = lightboxService;\n      this.loading = loading;\n      this.translate = translate;\n      bindMethods(this);\n    }\n\n    ConfirmService.prototype.hide = function(el) {\n      if (el) {\n        this.lightboxService.close(el);\n        return el.off(\".confirm-dialog\");\n      }\n    };\n\n    ConfirmService.prototype.ask = function(title, subtitle, message, lightboxSelector) {\n      var defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-generic-ask\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\".title\").text(title);\n      el.find(\".subtitle\").text(subtitle);\n      el.find(\".message\").text(message);\n      el.on(\"click.confirm-dialog\", \".button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.askOnDelete = function(title, message) {\n      return this.ask(title, this.translate.instant(\"NOTIFICATION.ASK_DELETE\"), message);\n    };\n\n    ConfirmService.prototype.askChoice = function(title, subtitle, choices, replacement, warning, lightboxSelector) {\n      var choicesField, defered, el;\n      if (lightboxSelector == null) {\n        lightboxSelector = \".lightbox-ask-choice\";\n      }\n      defered = this.q.defer();\n      el = angular.element(lightboxSelector);\n      el.find(\".title\").text(title);\n      el.find(\".subtitle\").text(subtitle);\n      if (replacement) {\n        el.find(\".replacement\").text(replacement);\n      } else {\n        el.find(\".replacement\").remove();\n      }\n      if (warning) {\n        el.find(\".warning\").text(warning);\n      } else {\n        el.find(\".warning\").remove();\n      }\n      choicesField = el.find(\".choices\");\n      choicesField.html('');\n      _.each(choices, function(value, key) {\n        value = _.escape(value);\n        return choicesField.append(angular.element(\"<option value='\" + key + \"'>\" + value + \"</option>\"));\n      });\n      el.on(\"click.confirm-dialog\", \"a.button-green\", debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          currentLoading = _this.loading().target(target).start();\n          return defered.resolve({\n            selected: choicesField.val(),\n            finish: function(ok) {\n              if (ok == null) {\n                ok = true;\n              }\n              currentLoading.finish();\n              if (ok) {\n                return _this.hide(el);\n              }\n            }\n          });\n        };\n      })(this)));\n      el.on(\"click.confirm-dialog\", \".button-red\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.reject();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.error = function(message) {\n      var defered, el;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-error\");\n      el.find(\".title\").html(message);\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.success = function(title, message, icon) {\n      var defered, detailImage, el, svgContainer, useSVG;\n      defered = this.q.defer();\n      el = angular.element(\".lightbox-generic-success\");\n      el.find(\"img\").remove();\n      el.find(\"svg\").remove();\n      if (icon) {\n        if (icon.type === \"img\") {\n          detailImage = $('<img>').addClass('lb-icon').attr('src', icon.name);\n        } else if (icon.type === \"svg\") {\n          detailImage = document.createElement(\"div\");\n          taiga.addClass(detailImage, \"icon\");\n          taiga.addClass(detailImage, icon.name);\n          taiga.addClass(detailImage, \"lb-icon\");\n          svgContainer = document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n          useSVG = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n          useSVG.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#' + icon.name);\n          detailImage.appendChild(svgContainer).appendChild(useSVG);\n        }\n        if (detailImage) {\n          el.find('section').prepend(detailImage);\n        }\n      }\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      el.on(\"click.confirm-dialog\", \".button-green\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      el.on(\"click.confirm-dialog\", \".close\", (function(_this) {\n        return function(event) {\n          event.preventDefault();\n          defered.resolve();\n          return _this.hide(el);\n        };\n      })(this));\n      this.lightboxService.open(el);\n      return defered.promise;\n    };\n\n    ConfirmService.prototype.loader = function(title, message) {\n      var el;\n      el = angular.element(\".lightbox-generic-loading\");\n      if (title) {\n        el.find(\".title\").html(title);\n      }\n      if (message) {\n        el.find(\".message\").html(message);\n      }\n      return {\n        start: (function(_this) {\n          return function() {\n            return _this.lightboxService.open(el);\n          };\n        })(this),\n        stop: (function(_this) {\n          return function() {\n            return _this.lightboxService.close(el);\n          };\n        })(this),\n        update: (function(_this) {\n          return function(status, title, message, percent) {\n            if (title) {\n              el.find(\".title\").html(title);\n            }\n            if (message) {\n              el.find(\".message\").html(message);\n            }\n            if (percent) {\n              el.find(\".spin\").addClass(\"hidden\");\n              el.find(\".progress-bar-wrapper\").removeClass(\"hidden\");\n              el.find(\".progress-bar-wrapper > .bar\").width(percent + '%');\n              return el.find(\".progress-bar-wrapper > span\").html(percent + '%').css('left', (percent - 9) + '%');\n            } else {\n              el.find(\".spin\").removeClass(\"hidden\");\n              return el.find(\".progress-bar-wrapper\").addClass(\"hidden\");\n            }\n          };\n        })(this)\n      };\n    };\n\n    ConfirmService.prototype.notify = function(type, message, title, time) {\n      var body, el, selector;\n      selector = \".notification-message-\" + type;\n      el = angular.element(selector);\n      if (el.hasClass(\"active\")) {\n        return;\n      }\n      if (title) {\n        el.find(\"h4\").html(title);\n      } else {\n        el.find(\"h4\").html(this.translate.instant(NOTIFICATION_MSG[type].title));\n      }\n      if (message) {\n        el.find(\"p\").html(message);\n      } else {\n        el.find(\"p\").html(this.translate.instant(NOTIFICATION_MSG[type].message));\n      }\n      body = angular.element(\"body\");\n      body.find(\".notification-message .notification-light\").removeClass('active').addClass('inactive');\n      body.find(selector).removeClass('inactive').addClass('active');\n      if (this.tsem) {\n        cancelTimeout(this.tsem);\n      }\n      if (!time) {\n        time = type === 'error' || type === 'light-error' ? 3500 : 1500;\n      }\n      this.tsem = timeout(time, (function(_this) {\n        return function() {\n          body.find(selector).removeClass('active').addClass('inactive').one('animationend', function() {\n            return $(this).removeClass('inactive');\n          });\n          return delete _this.tsem;\n        };\n      })(this));\n      return el.on(\"click\", \".icon-close, .close\", (function(_this) {\n        return function(event) {\n          return body.find(selector).removeClass('active').addClass('inactive');\n        };\n      })(this));\n    };\n\n    return ConfirmService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaCommon\");\n\n  module.service(\"$tgConfirm\", ConfirmService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/custom-field-values.coffee\n */\n\n(function() {\n  var CustomAttributeValueDirective, CustomAttributesValuesController, CustomAttributesValuesDirective, DATE_TYPE, MULTILINE_TYPE, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindMethods, bindOnce, debounce, generateHash, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = this.taiga.bindMethods;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  generateHash = taiga.generateHash;\n\n  module = angular.module(\"taigaCommon\");\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  CustomAttributesValuesController = (function(superClass) {\n    extend(CustomAttributesValuesController, superClass);\n\n    CustomAttributesValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$q\"];\n\n    function CustomAttributesValuesController(scope, rootscope, repo, rs, confirm, q) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.q = q;\n      bindMethods(this);\n      this.type = null;\n      this.objectId = null;\n      this.projectId = null;\n      this.customAttributes = [];\n      this.customAttributesValues = null;\n    }\n\n    CustomAttributesValuesController.prototype.initialize = function(type, objectId) {\n      this.project = this.scope.project;\n      this.type = type;\n      this.objectId = objectId;\n      return this.projectId = this.scope.projectId;\n    };\n\n    CustomAttributesValuesController.prototype.loadCustomAttributesValues = function() {\n      if (!this.objectId) {\n        return this.customAttributesValues;\n      }\n      return this.rs.customAttributesValues[this.type].get(this.objectId).then((function(_this) {\n        return function(customAttributesValues) {\n          _this.customAttributes = _this.project[_this.type + \"_custom_attributes\"];\n          _this.customAttributesValues = customAttributesValues;\n          return customAttributesValues;\n        };\n      })(this));\n    };\n\n    CustomAttributesValuesController.prototype.getAttributeValue = function(attribute) {\n      var attributeValue;\n      attributeValue = _.clone(attribute, false);\n      attributeValue.value = this.customAttributesValues.attributes_values[attribute.id];\n      return attributeValue;\n    };\n\n    CustomAttributesValuesController.prototype.updateAttributeValue = function(attributeValue) {\n      var attributesValues, onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"custom-attributes-values:edit\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function(response) {\n          _this.confirm.notify(\"error\");\n          return _this.q.reject();\n        };\n      })(this);\n      attributesValues = _.clone(this.customAttributesValues.attributes_values, true);\n      attributesValues[attributeValue.id] = attributeValue.value;\n      this.customAttributesValues.attributes_values = attributesValues;\n      this.customAttributesValues.id = this.objectId;\n      return this.repo.save(this.customAttributesValues).then(onSuccess, onError);\n    };\n\n    return CustomAttributesValuesController;\n\n  })(taiga.Controller);\n\n  CustomAttributesValuesDirective = function($templates, $storage) {\n    var collapsedHash, link, template, templateFn;\n    template = $templates.get(\"custom-attributes/custom-attributes-values.html\", true);\n    collapsedHash = function(type) {\n      return generateHash([\"custom-attributes-collapsed\", type]);\n    };\n    link = function($scope, $el, $attrs, $ctrls) {\n      var $ctrl, $model;\n      $ctrl = $ctrls[0];\n      $model = $ctrls[1];\n      bindOnce($scope, $attrs.ngModel, function(value) {\n        $ctrl.initialize($attrs.type, value.id);\n        return $ctrl.loadCustomAttributesValues();\n      });\n      $el.on(\"click\", \".custom-fields-header .collapse\", function() {\n        var collapsed, hash;\n        hash = collapsedHash($attrs.type);\n        collapsed = !($storage.get(hash) || false);\n        $storage.set(hash, collapsed);\n        if (collapsed) {\n          $el.find(\".custom-fields-header .icon\").removeClass(\"open\");\n          return $el.find(\".custom-fields-body\").removeClass(\"open\");\n        } else {\n          $el.find(\".custom-fields-header .icon\").addClass(\"open\");\n          return $el.find(\".custom-fields-body\").addClass(\"open\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    templateFn = function($el, $attrs) {\n      var collapsed;\n      collapsed = $storage.get(collapsedHash($attrs.type)) || false;\n      return template({\n        requiredEditionPerm: $attrs.requiredEditionPerm,\n        collapsed: collapsed\n      });\n    };\n    return {\n      require: [\"tgCustomAttributesValues\", \"ngModel\"],\n      controller: CustomAttributesValuesController,\n      controllerAs: \"ctrl\",\n      restrict: \"AE\",\n      scope: true,\n      link: link,\n      template: templateFn\n    };\n  };\n\n  module.directive(\"tgCustomAttributesValues\", [\"$tgTemplate\", \"$tgStorage\", \"$translate\", CustomAttributesValuesDirective]);\n\n  CustomAttributeValueDirective = function($template, $selectedText, $compile, $translate, datePickerConfigService) {\n    var link, template, templateEdit;\n    template = $template.get(\"custom-attributes/custom-attribute-value.html\", true);\n    templateEdit = $template.get(\"custom-attributes/custom-attribute-value-edit.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var attributeValue, isEditable, prettyDate, render, setFocusAndSelectOnInputField, submit;\n      prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n      render = function(attributeValue, edit) {\n        var ctx, datePickerConfig, editable, html, value;\n        if (edit == null) {\n          edit = false;\n        }\n        if (attributeValue.type === DATE_TYPE && attributeValue.value) {\n          value = moment(attributeValue.value, \"YYYY-MM-DD\").format(prettyDate);\n        } else {\n          value = attributeValue.value;\n        }\n        editable = isEditable();\n        ctx = {\n          id: attributeValue.id,\n          name: attributeValue.name,\n          description: attributeValue.description,\n          value: value,\n          isEditable: editable,\n          type: attributeValue.type\n        };\n        if (editable && (edit || !value)) {\n          html = templateEdit(ctx);\n          html = $compile(html)($scope);\n          $el.html(html);\n          if (attributeValue.type === DATE_TYPE) {\n            datePickerConfig = datePickerConfigService.get();\n            _.merge(datePickerConfig, {\n              field: $el.find(\"input[name=value]\")[0],\n              onSelect: (function(_this) {\n                return function(date) {\n                  var selectedDate;\n                  return selectedDate = date;\n                };\n              })(this),\n              onOpen: (function(_this) {\n                return function() {\n                  if (typeof selectedDate !== \"undefined\" && selectedDate !== null) {\n                    return $el.picker.setDate(selectedDate);\n                  }\n                };\n              })(this)\n            });\n            return $el.picker = new Pikaday(datePickerConfig);\n          }\n        } else {\n          html = template(ctx);\n          html = $compile(html)($scope);\n          return $el.html(html);\n        }\n      };\n      isEditable = function() {\n        var permissions, requiredEditionPerm;\n        permissions = $scope.project.my_permissions;\n        requiredEditionPerm = $attrs.requiredEditionPerm;\n        return permissions.indexOf(requiredEditionPerm) > -1;\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var form, input;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          input = $el.find(\"input[name=value], textarea[name='value']\");\n          attributeValue.value = input.val();\n          if (attributeValue.type === DATE_TYPE) {\n            if (moment(attributeValue.value, prettyDate).isValid()) {\n              attributeValue.value = moment(attributeValue.value, prettyDate).format(\"YYYY-MM-DD\");\n            }\n          }\n          return $scope.$apply(function() {\n            return $ctrl.updateAttributeValue(attributeValue).then(function() {\n              return render(attributeValue, false);\n            });\n          });\n        };\n      })(this));\n      setFocusAndSelectOnInputField = function() {\n        return $el.find(\"input[name='value'], textarea[name='value']\").focus().select();\n      };\n      attributeValue = $scope.$eval($attrs.tgCustomAttributeValue);\n      render(attributeValue);\n      $el.on(\"click\", \".js-value-view-mode span a\", function(event) {\n        return event.stopPropagation();\n      });\n      $el.on(\"click\", \".js-value-view-mode\", function() {\n        if (!isEditable()) {\n          return;\n        }\n        if ($selectedText.get().length) {\n          return;\n        }\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"click\", \".js-edit-description\", function(event) {\n        event.preventDefault();\n        render(attributeValue, true);\n        return setFocusAndSelectOnInputField();\n      });\n      $el.on(\"keyup\", \"input[name=value], textarea[name='value']\", function(event) {\n        if (event.keyCode === 13 && event.currentTarget.type !== \"textarea\") {\n          return submit(event);\n        } else if (event.keyCode === 27) {\n          return render(attributeValue, false);\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".js-save-description\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"^tgCustomAttributesValues\",\n      restrict: \"AE\"\n    };\n  };\n\n  module.directive(\"tgCustomAttributeValue\", [\"$tgTemplate\", \"$selectedText\", \"$compile\", \"$translate\", \"tgDatePickerConfigService\", CustomAttributeValueDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/estimation.coffee\n */\n\n(function() {\n  var EstimationsService, LbUsEstimationDirective, UsEstimationDirective, groupBy, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaCommon\");\n\n  LbUsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return $scope.$apply(function() {\n              return $model.$setViewValue(us);\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgTemplate\", \"$compile\", LbUsEstimationDirective]);\n\n  UsEstimationDirective = function($tgEstimationsService, $rootScope, $repo, $qqueue, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch($attrs.ngModel, function(us) {\n        var estimationProcess;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return this.save(roleId, pointId).then(function() {\n              return $rootScope.$broadcast(\"object:updated\");\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, template;\n            ctx = {\n              totalPoints: this.calculateTotalPoints(),\n              roles: this.calculateRoles(),\n              editable: this.isEditable\n            };\n            mainTemplate = \"common/estimation/us-estimation-points-per-role.html\";\n            template = $template.get(mainTemplate, true);\n            html = template(ctx);\n            html = $compile(html)($scope);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsEstimation\", [\"$tgEstimationsService\", \"$rootScope\", \"$tgRepo\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsEstimationDirective]);\n\n  EstimationsService = function($template, $qqueue, $repo, $confirm, $q) {\n    var EstimationProcess, create, pointsTemplate;\n    pointsTemplate = $template.get(\"common/estimation/us-estimation-points.html\", true);\n    EstimationProcess = (function() {\n      function EstimationProcess($el1, us1, project1) {\n        this.$el = $el1;\n        this.us = us1;\n        this.project = project1;\n        this.bindClickEvents = bind(this.bindClickEvents, this);\n        this.isEditable = this.project.my_permissions.indexOf(\"modify_us\") !== -1;\n        this.roles = this.project.roles;\n        this.points = this.project.points;\n        this.pointsById = groupBy(this.points, function(x) {\n          return x.id;\n        });\n        this.onSelectedPointForRole = function(roleId, pointId) {};\n        this.render = function() {};\n      }\n\n      EstimationProcess.prototype.save = function(roleId, pointId) {\n        var deferred;\n        deferred = $q.defer();\n        $qqueue.add((function(_this) {\n          return function() {\n            var onError, onSuccess;\n            onSuccess = function() {\n              return deferred.resolve();\n            };\n            onError = function() {\n              $confirm.notify(\"error\");\n              _this.us.revert();\n              _this.render();\n              return deferred.reject();\n            };\n            return $repo.save(_this.us).then(onSuccess, onError);\n          };\n        })(this));\n        return deferred.promise;\n      };\n\n      EstimationProcess.prototype.calculateTotalPoints = function() {\n        var notNullValues, values;\n        values = _.map(this.us.points, (function(_this) {\n          return function(v, k) {\n            var ref;\n            return (ref = _this.pointsById[v]) != null ? ref.value : void 0;\n          };\n        })(this));\n        if (values.length === 0) {\n          return \"?\";\n        }\n        notNullValues = _.filter(values, function(v) {\n          return v != null;\n        });\n        if (notNullValues.length === 0) {\n          return \"?\";\n        }\n        return _.reduce(notNullValues, function(acc, num) {\n          return acc + num;\n        });\n      };\n\n      EstimationProcess.prototype.calculateRoles = function() {\n        var computableRoles, roles;\n        computableRoles = _.filter(this.project.roles, \"computable\");\n        roles = _.map(computableRoles, (function(_this) {\n          return function(role) {\n            var pointId, pointObj;\n            pointId = _this.us.points[role.id];\n            pointObj = _this.pointsById[pointId];\n            role = _.clone(role, true);\n            role.points = (pointObj != null) && (pointObj.name != null) ? pointObj.name : \"?\";\n            return role;\n          };\n        })(this));\n        return roles;\n      };\n\n      EstimationProcess.prototype.bindClickEvents = function() {\n        this.$el.on(\"click\", \".total.clickable\", (function(_this) {\n          return function(event) {\n            var roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            _this.renderPointsSelector(roleId, target);\n            target.siblings().removeClass('active');\n            return target.addClass('active');\n          };\n        })(this));\n        return this.$el.on(\"click\", \".point\", (function(_this) {\n          return function(event) {\n            var pointId, points, roleId, target;\n            event.preventDefault();\n            event.stopPropagation();\n            target = angular.element(event.currentTarget);\n            roleId = target.data(\"role-id\");\n            pointId = target.data(\"point-id\");\n            _this.$el.find(\".popover\").popover().close();\n            points = _.clone(_this.us.points, true);\n            points[roleId] = pointId;\n            _this.us.points = points;\n            _this.render();\n            return _this.onSelectedPointForRole(roleId, pointId);\n          };\n        })(this));\n      };\n\n      EstimationProcess.prototype.renderPointsSelector = function(roleId, target) {\n        var horizontalList, html, maxPointLength, points, pop;\n        points = _.map(this.points, (function(_this) {\n          return function(point) {\n            point = _.clone(point, true);\n            point.selected = _this.us.points[roleId] === point.id ? false : true;\n            return point;\n          };\n        })(this));\n        maxPointLength = 5;\n        horizontalList = _.some(points, (function(_this) {\n          return function(point) {\n            return point.name.length > maxPointLength;\n          };\n        })(this));\n        html = pointsTemplate({\n          \"points\": points,\n          roleId: roleId,\n          horizontal: horizontalList\n        });\n        this.$el.find(\".popover\").popover().close();\n        this.$el.find(\".pop-points-open\").remove();\n        if (target != null) {\n          this.$el.find(target).append(html);\n        } else {\n          this.$el.append(html);\n        }\n        this.$el.find(\".pop-points-open\").popover().open(function() {\n          return $(this).removeClass(\"active\").closest(\"li\").removeClass(\"active\");\n        });\n        this.$el.find(\".pop-points-open\").show();\n        pop = this.$el.find(\".pop-points-open\");\n        if (pop.offset().top + pop.height() > document.body.clientHeight) {\n          return pop.addClass('pop-bottom');\n        }\n      };\n\n      return EstimationProcess;\n\n    })();\n    create = function($el, us, project) {\n      var estimationProcess;\n      $el.unbind(\"click\");\n      estimationProcess = new EstimationProcess($el, us, project);\n      if (estimationProcess.isEditable) {\n        estimationProcess.bindClickEvents();\n      }\n      return estimationProcess;\n    };\n    return {\n      create: create\n    };\n  };\n\n  module.factory(\"$tgEstimationsService\", [\"$tgTemplate\", \"$tgQqueue\", \"$tgRepo\", \"$tgConfirm\", \"$q\", EstimationsService]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/filters.coffee\n */\n\n(function() {\n  var defaultFilter, module, momentFormat, momentFromNow, sizeFormat, taiga, unslugify, yesNoFilter;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  defaultFilter = function() {\n    return function(value, defaultValue) {\n      if (value === [null, void 0]) {\n        return defaultValue;\n      }\n      return value;\n    };\n  };\n\n  module.filter(\"default\", defaultFilter);\n\n  yesNoFilter = function($translate) {\n    return function(value) {\n      if (value) {\n        return $translate.instant(\"COMMON.YES\");\n      }\n      return $translate.instant(\"COMMON.NO\");\n    };\n  };\n\n  module.filter(\"yesNo\", [\"$translate\", yesNoFilter]);\n\n  unslugify = function() {\n    return taiga.unslugify;\n  };\n\n  module.filter(\"unslugify\", unslugify);\n\n  momentFormat = function() {\n    return function(input, format) {\n      if (input) {\n        return moment(input).format(format);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFormat\", momentFormat);\n\n  momentFromNow = function() {\n    return function(input, without_suffix) {\n      if (input) {\n        return moment(input).fromNow(without_suffix || false);\n      }\n      return \"\";\n    };\n  };\n\n  module.filter(\"momentFromNow\", momentFromNow);\n\n  sizeFormat = (function(_this) {\n    return function() {\n      return _this.taiga.sizeFormat;\n    };\n  })(this);\n\n  module.filter(\"sizeFormat\", sizeFormat);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/history.coffee\n */\n\n(function() {\n  var HistoryController, HistoryDirective, IGNORED_FIELDS, bindOnce, debounce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  IGNORED_FIELDS = {\n    \"userstories.userstory\": [\"watchers\", \"kanban_order\", \"backlog_order\", \"sprint_order\", \"finish_date\", \"tribe_gig\"],\n    \"tasks.task\": [\"watchers\", \"us_order\", \"taskboard_order\"],\n    \"issues.issue\": [\"watchers\"]\n  };\n\n  HistoryController = (function(superClass) {\n    extend(HistoryController, superClass);\n\n    HistoryController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\"];\n\n    function HistoryController(scope, repo, rs) {\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n    }\n\n    HistoryController.prototype.initialize = function(type, objectId) {\n      this.type = type;\n      return this.objectId = objectId;\n    };\n\n    HistoryController.prototype.loadHistory = function(type, objectId) {\n      return this.rs.history.get(type, objectId).then((function(_this) {\n        return function(history) {\n          var changeModel, historyEntry, historyResult, i, j, len, len1;\n          for (i = 0, len = history.length; i < len; i++) {\n            historyResult = history[i];\n            if (historyResult.values_diff.description_diff != null) {\n              historyResult.values_diff.description = historyResult.values_diff.description_diff;\n            }\n            delete historyResult.values_diff.description_html;\n            delete historyResult.values_diff.description_diff;\n            if (historyResult.values_diff.blocked_note_diff != null) {\n              historyResult.values_diff.blocked_note = historyResult.values_diff.blocked_note_diff;\n            }\n            delete historyResult.values_diff.blocked_note_html;\n            delete historyResult.values_diff.blocked_note_diff;\n          }\n          for (j = 0, len1 = history.length; j < len1; j++) {\n            historyEntry = history[j];\n            changeModel = historyEntry.key.split(\":\")[0];\n            if (IGNORED_FIELDS[changeModel] != null) {\n              historyEntry.values_diff = _.removeKeys(historyEntry.values_diff, IGNORED_FIELDS[changeModel]);\n            }\n          }\n          _this.scope.history = _.filter(history, function(item) {\n            return Object.keys(item.values_diff).length > 0;\n          });\n          return _this.scope.comments = _.filter(history, function(item) {\n            return item.comment !== \"\";\n          });\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.deleteComment = function(type, objectId, activityId) {\n      return this.rs.history.deleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    HistoryController.prototype.undeleteComment = function(type, objectId, activityId) {\n      return this.rs.history.undeleteComment(type, objectId, activityId).then((function(_this) {\n        return function() {\n          return _this.loadHistory(type, objectId);\n        };\n      })(this));\n    };\n\n    return HistoryController;\n\n  })(taiga.Controller);\n\n  HistoryDirective = function($log, $loading, $qqueue, $template, $confirm, $translate, $compile, $navUrls, $rootScope, checkPermissionsService) {\n    var link, templateActivity, templateBase, templateBaseEntries, templateChangeAttachment, templateChangeDiff, templateChangeGeneric, templateChangeList, templateChangePoints, templateDeletedComment;\n    templateChangeDiff = $template.get(\"common/history/history-change-diff.html\", true);\n    templateChangePoints = $template.get(\"common/history/history-change-points.html\", true);\n    templateChangeGeneric = $template.get(\"common/history/history-change-generic.html\", true);\n    templateChangeAttachment = $template.get(\"common/history/history-change-attachment.html\", true);\n    templateChangeList = $template.get(\"common/history/history-change-list.html\", true);\n    templateDeletedComment = $template.get(\"common/history/history-deleted-comment.html\", true);\n    templateActivity = $template.get(\"common/history/history-activity.html\", true);\n    templateBaseEntries = $template.get(\"common/history/history-base-entries.html\", true);\n    templateBase = $template.get(\"common/history/history-base.html\", true);\n    link = function($scope, $el, $attrs, $ctrl) {\n      var countChanges, formatChange, getHumanizedFieldName, getPrettyDateFormat, objectId, renderActivity, renderAttachmentEntry, renderBase, renderChange, renderChangeEntries, renderChangeEntry, renderChangesHelperText, renderComment, renderComments, renderCustomAttributesEntry, renderHistory, rerender, save, showAllActivity, showAllComments, type;\n      type = $attrs.type;\n      objectId = null;\n      showAllComments = false;\n      showAllActivity = false;\n      getPrettyDateFormat = function() {\n        return $translate.instant(\"ACTIVITY.DATETIME\");\n      };\n      bindOnce($scope, $attrs.ngModel, function(model) {\n        type = $attrs.type;\n        objectId = model.id;\n        $ctrl.initialize(type, objectId);\n        return $ctrl.loadHistory(type, objectId);\n      });\n      getHumanizedFieldName = function(field) {\n        var humanizedFieldNames;\n        humanizedFieldNames = {\n          subject: $translate.instant(\"ACTIVITY.FIELDS.SUBJECT\"),\n          name: $translate.instant(\"ACTIVITY.FIELDS.NAME\"),\n          description: $translate.instant(\"ACTIVITY.FIELDS.DESCRIPTION\"),\n          content: $translate.instant(\"ACTIVITY.FIELDS.CONTENT\"),\n          status: $translate.instant(\"ACTIVITY.FIELDS.STATUS\"),\n          is_closed: $translate.instant(\"ACTIVITY.FIELDS.IS_CLOSED\"),\n          finish_date: $translate.instant(\"ACTIVITY.FIELDS.FINISH_DATE\"),\n          type: $translate.instant(\"ACTIVITY.FIELDS.TYPE\"),\n          priority: $translate.instant(\"ACTIVITY.FIELDS.PRIORITY\"),\n          severity: $translate.instant(\"ACTIVITY.FIELDS.SEVERITY\"),\n          assigned_to: $translate.instant(\"ACTIVITY.FIELDS.ASSIGNED_TO\"),\n          watchers: $translate.instant(\"ACTIVITY.FIELDS.WATCHERS\"),\n          milestone: $translate.instant(\"ACTIVITY.FIELDS.MILESTONE\"),\n          user_story: $translate.instant(\"ACTIVITY.FIELDS.USER_STORY\"),\n          project: $translate.instant(\"ACTIVITY.FIELDS.PROJECT\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          points: $translate.instant(\"ACTIVITY.FIELDS.POINTS\"),\n          client_requirement: $translate.instant(\"ACTIVITY.FIELDS.CLIENT_REQUIREMENT\"),\n          team_requirement: $translate.instant(\"ACTIVITY.FIELDS.TEAM_REQUIREMENT\"),\n          is_iocaine: $translate.instant(\"ACTIVITY.FIELDS.IS_IOCAINE\"),\n          tags: $translate.instant(\"ACTIVITY.FIELDS.TAGS\"),\n          attachments: $translate.instant(\"ACTIVITY.FIELDS.ATTACHMENTS\"),\n          is_deprecated: $translate.instant(\"ACTIVITY.FIELDS.IS_DEPRECATED\"),\n          blocked_note: $translate.instant(\"ACTIVITY.FIELDS.BLOCKED_NOTE\"),\n          is_blocked: $translate.instant(\"ACTIVITY.FIELDS.IS_BLOCKED\"),\n          order: $translate.instant(\"ACTIVITY.FIELDS.ORDER\"),\n          backlog_order: $translate.instant(\"ACTIVITY.FIELDS.BACKLOG_ORDER\"),\n          sprint_order: $translate.instant(\"ACTIVITY.FIELDS.SPRINT_ORDER\"),\n          kanban_order: $translate.instant(\"ACTIVITY.FIELDS.KANBAN_ORDER\"),\n          taskboard_order: $translate.instant(\"ACTIVITY.FIELDS.TASKBOARD_ORDER\"),\n          us_order: $translate.instant(\"ACTIVITY.FIELDS.US_ORDER\")\n        };\n        return humanizedFieldNames[field] || field;\n      };\n      countChanges = function(comment) {\n        return _.keys(comment.values_diff).length;\n      };\n      formatChange = function(change) {\n        if (_.isArray(change)) {\n          if (change.length === 0) {\n            return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n          }\n          return change.join(\", \");\n        }\n        if (change === \"\") {\n          return $translate.instant(\"ACTIVITY.VALUES.EMPTY\");\n        }\n        if ((change == null) || change === false) {\n          return $translate.instant(\"ACTIVITY.VALUES.NO\");\n        }\n        if (change === true) {\n          return $translate.instant(\"ACTIVITY.VALUES.YES\");\n        }\n        return change;\n      };\n      renderAttachmentEntry = function(value) {\n        var attachments;\n        attachments = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.NEW_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_ATTACHMENT\"),\n                diff: change.filename\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var diff, name;\n              name = $translate.instant(\"ACTIVITY.UPDATED_ATTACHMENT\", {\n                filename: change.filename\n              });\n              diff = _.map(change.changes, function(values, name) {\n                return {\n                  name: getHumanizedFieldName(name),\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                };\n              });\n              return templateChangeAttachment({\n                name: name,\n                diff: diff\n              });\n            });\n          }\n        });\n        return _.flatten(attachments).join(\"\\n\");\n      };\n      renderCustomAttributesEntry = function(value) {\n        var customAttributes;\n        customAttributes = _.map(value, function(changes, type) {\n          if (type === \"new\") {\n            return _.map(changes, function(change) {\n              var html;\n              html = templateChangeGeneric({\n                name: change.name,\n                from: formatChange(\"\"),\n                to: formatChange(change.value)\n              });\n              html = $compile(html)($scope);\n              return html[0].outerHTML;\n            });\n          } else if (type === \"deleted\") {\n            return _.map(changes, function(change) {\n              return templateChangeDiff({\n                name: $translate.instant(\"ACTIVITY.DELETED_CUSTOM_ATTRIBUTE\"),\n                diff: change.name\n              });\n            });\n          } else {\n            return _.map(changes, function(change) {\n              var customAttrsChanges;\n              customAttrsChanges = _.map(change.changes, function(values) {\n                return templateChangeGeneric({\n                  name: change.name,\n                  from: formatChange(values[0]),\n                  to: formatChange(values[1])\n                });\n              });\n              return _.flatten(customAttrsChanges).join(\"\\n\");\n            });\n          }\n        });\n        return _.flatten(customAttributes).join(\"\\n\");\n      };\n      renderChangeEntry = function(field, value) {\n        var added, from, html, name, removed, to;\n        if (field === \"description\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"description\"),\n            diff: value[1]\n          });\n        } else if (field === \"blocked_note\") {\n          return templateChangeDiff({\n            name: getHumanizedFieldName(\"blocked_note\"),\n            diff: value[1]\n          });\n        } else if (field === \"points\") {\n          html = templateChangePoints({\n            points: value\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"attachments\") {\n          return renderAttachmentEntry(value);\n        } else if (field === \"custom_attributes\") {\n          return renderCustomAttributesEntry(value);\n        } else if (field === \"tags\" || field === \"watchers\") {\n          name = getHumanizedFieldName(field);\n          removed = _.difference(value[0], value[1]);\n          added = _.difference(value[1], value[0]);\n          html = templateChangeList({\n            name: name,\n            removed: removed,\n            added: added\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        } else if (field === \"assigned_to\") {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          to = formatChange(value[1] || $translate.instant(\"ACTIVITY.VALUES.UNASSIGNED\"));\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        } else {\n          name = getHumanizedFieldName(field);\n          from = formatChange(value[0]);\n          to = formatChange(value[1]);\n          return templateChangeGeneric({\n            name: name,\n            from: from,\n            to: to\n          });\n        }\n      };\n      renderChangeEntries = function(change) {\n        return _.map(change.values_diff, function(value, field) {\n          return renderChangeEntry(field, value);\n        });\n      };\n      renderChangesHelperText = function(change) {\n        var size;\n        size = countChanges(change);\n        return $translate.instant(\"ACTIVITY.SIZE_CHANGE\", {\n          size: size\n        }, 'messageformat');\n      };\n      renderComment = function(comment) {\n        var html, ref, ref1, ref2;\n        if (comment.delete_comment_date || ((ref = comment.delete_comment_user) != null ? ref.name : void 0)) {\n          html = templateDeletedComment({\n            deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n            deleteCommentUser: comment.delete_comment_user.name,\n            deleteComment: comment.comment_html,\n            activityId: comment.id,\n            canRestoreComment: $scope.user && (comment.delete_comment_user.pk === $scope.user.id || $scope.project.my_permissions.indexOf(\"modify_project\") > -1)\n          });\n          html = $compile(html)($scope);\n          return html[0].outerHTML;\n        }\n        html = templateActivity({\n          avatar: comment.user.photo,\n          userFullName: comment.user.name,\n          userProfileUrl: comment.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: comment.user.username\n          }) : \"\",\n          creationDate: moment(comment.created_at).format(getPrettyDateFormat()),\n          comment: comment.comment_html,\n          changesText: renderChangesHelperText(comment),\n          changes: renderChangeEntries(comment),\n          mode: \"comment\",\n          deleteCommentActionTitle: $translate.instant(\"COMMENTS.DELETE\"),\n          deleteCommentDate: comment.delete_comment_date ? moment(comment.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref1 = comment.delete_comment_user) != null ? ref1.name : void 0) ? comment.delete_comment_user.name : void 0,\n          activityId: comment.id,\n          canDeleteComment: comment.user.pk === ((ref2 = $scope.user) != null ? ref2.id : void 0) || $scope.project.my_permissions.indexOf(\"modify_project\") > -1\n        });\n        html = $compile(html)($scope);\n        return html[0].outerHTML;\n      };\n      renderChange = function(change) {\n        var ref;\n        return templateActivity({\n          avatar: change.user.photo,\n          userFullName: change.user.name,\n          userProfileUrl: change.user.is_active ? $navUrls.resolve(\"user-profile\", {\n            username: change.user.username\n          }) : \"\",\n          creationDate: moment(change.created_at).format(getPrettyDateFormat()),\n          comment: change.comment_html,\n          changes: renderChangeEntries(change),\n          changesText: \"\",\n          mode: \"activity\",\n          deleteCommentDate: change.delete_comment_date ? moment(change.delete_comment_date).format(getPrettyDateFormat()) : void 0,\n          deleteCommentUser: ((ref = change.delete_comment_user) != null ? ref.name : void 0) ? change.delete_comment_user.name : void 0,\n          activityId: change.id\n        });\n      };\n      renderHistory = function(entries, totalEntries) {\n        var html, showMore;\n        if (entries.length === totalEntries) {\n          showMore = 0;\n        } else {\n          showMore = totalEntries - entries.length;\n        }\n        html = templateBaseEntries({\n          entries: entries,\n          showMore: showMore\n        });\n        html = $compile(html)($scope);\n        return html;\n      };\n      renderBase = function() {\n        var changes, comments, commentsVisible, historyVisible, html;\n        comments = $scope.comments || [];\n        changes = $scope.history || [];\n        historyVisible = !!changes.length;\n        commentsVisible = (!!comments.length) || checkPermissionsService.check('modify_' + $attrs.type);\n        html = templateBase({\n          ngmodel: $attrs.ngModel,\n          type: $attrs.type,\n          mode: $attrs.mode,\n          historyVisible: historyVisible,\n          commentsVisible: commentsVisible\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      rerender = function() {\n        renderBase();\n        renderComments();\n        return renderActivity();\n      };\n      renderComments = function() {\n        var comments, html, totalComments;\n        comments = $scope.comments || [];\n        totalComments = comments.length;\n        if (!showAllComments) {\n          comments = _.takeRight(comments, 4);\n        }\n        comments = _.map(comments, function(x) {\n          return renderComment(x);\n        });\n        html = renderHistory(comments, totalComments);\n        return $el.find(\".comments-list\").html(html);\n      };\n      renderActivity = function() {\n        var changes, html, totalChanges;\n        changes = $scope.history || [];\n        totalChanges = changes.length;\n        if (!showAllActivity) {\n          changes = _.takeRight(changes, 4);\n        }\n        changes = _.map(changes, function(x) {\n          return renderChange(x);\n        });\n        html = renderHistory(changes, totalChanges);\n        return $el.find(\".changes-list\").html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(target) {\n          var currentLoading, model, onError, onSuccess;\n          $scope.$broadcast(\"markdown-editor:submit\");\n          $el.find(\".comment-list\").addClass(\"activeanimation\");\n          currentLoading = $loading().target(target).start();\n          onSuccess = function() {\n            $rootScope.$broadcast(\"comment:new\");\n            return $ctrl.loadHistory(type, objectId)[\"finally\"](function() {\n              return currentLoading.finish();\n            });\n          };\n          onError = function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          };\n          model = $scope.$eval($attrs.ngModel);\n          return $ctrl.repo.save(model).then(onSuccess, onError);\n        };\n      })(this));\n      $scope.$watch(\"comments\", rerender);\n      $scope.$watch(\"history\", rerender);\n      $scope.$on(\"object:updated\", function() {\n        return $ctrl.loadHistory(type, objectId);\n      });\n      $el.on(\"click\", \".add-comment .button-green\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      }));\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.target);\n        href = target.attr('href');\n        if (href && href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"click\", \".show-more\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.parent().is(\".changes-list\")) {\n          showAllActivity = !showAllActivity;\n          return renderActivity();\n        } else {\n          showAllComments = !showAllComments;\n          return renderComments();\n        }\n      });\n      $el.on(\"click\", \".show-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').show();\n        target.parents('.activity-single').find('.show-deleted-comment').hide();\n        return target.parents('.activity-single').find('.comment-body').show();\n      });\n      $el.on(\"click\", \".hide-deleted-comment\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.parents('.activity-single').find('.hide-deleted-comment').hide();\n        target.parents('.activity-single').find('.show-deleted-comment').show();\n        return target.parents('.activity-single').find('.comment-body').hide();\n      });\n      $el.on(\"click\", \".changes-title\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return target.parent().find(\".change-entry\").toggleClass(\"active\");\n      });\n      $el.on(\"focus\", \".add-comment textarea\", function(event) {\n        return $(this).addClass('active');\n      });\n      $el.on(\"click\", \".history-tabs a\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        $el.find(\".history-tabs li\").removeClass(\"active\");\n        target.parent().addClass(\"active\");\n        $el.find(\".history section\").addClass(\"hidden\");\n        return $el.find(\".history section.\" + (target.data('section-class'))).removeClass(\"hidden\");\n      });\n      $el.on(\"click\", \".comment-delete\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.deleteComment(type, objectId, activityId);\n      }));\n      $el.on(\"click\", \".comment-restore\", debounce(2000, function(event) {\n        var activityId, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        activityId = target.data('activity-id');\n        return $ctrl.undeleteComment(type, objectId, activityId);\n      }));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return renderBase();\n    };\n    return {\n      controller: HistoryController,\n      restrict: \"AE\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgHistory\", [\"$log\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$tgConfirm\", \"$translate\", \"$compile\", \"$tgNavUrls\", \"$rootScope\", \"tgCheckPermissionsService\", HistoryDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/importer.coffee\n */\n\n(function() {\n  var ImportProjectButtonDirective, LbImportErrorDirective, module;\n\n  module = angular.module(\"taigaCommon\");\n\n  ImportProjectButtonDirective = function($rs, $confirm, $location, $navUrls, $translate, $lightboxFactory, currentUserService, $tgAuth) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var getRestrictionError;\n      getRestrictionError = function(result) {\n        var errorKey, maxMemberships, membersError, privateError, publicError, user;\n        if (result.headers) {\n          errorKey = '';\n          user = currentUserService.getUser();\n          maxMemberships = 0;\n          if (result.headers.isPrivate) {\n            privateError = !currentUserService.canCreatePrivateProjects().valid;\n            maxMemberships = null;\n            if (user.get('max_memberships_private_projects') !== null && result.headers.memberships >= user.get('max_memberships_private_projects')) {\n              membersError = true;\n            } else {\n              membersError = false;\n            }\n            if (privateError && membersError) {\n              errorKey = 'private-space-members';\n              maxMemberships = user.get('max_memberships_private_projects');\n            } else if (privateError) {\n              errorKey = 'private-space';\n            } else if (membersError) {\n              errorKey = 'private-members';\n              maxMemberships = user.get('max_memberships_private_projects');\n            }\n          } else {\n            publicError = !currentUserService.canCreatePublicProjects().valid;\n            if (user.get('max_memberships_public_projects') !== null && result.headers.memberships >= user.get('max_memberships_public_projects')) {\n              membersError = true;\n            } else {\n              membersError = false;\n            }\n            if (publicError && membersError) {\n              errorKey = 'public-space-members';\n              maxMemberships = user.get('max_memberships_public_projects');\n            } else if (publicError) {\n              errorKey = 'public-space';\n            } else if (membersError) {\n              errorKey = 'public-members';\n              maxMemberships = user.get('max_memberships_public_projects');\n            }\n          }\n          return {\n            key: errorKey,\n            values: {\n              max_memberships: maxMemberships,\n              members: result.headers.memberships\n            }\n          };\n        } else {\n          return false;\n        }\n      };\n      $el.on(\"click\", \".import-project-button\", function(event) {\n        event.preventDefault();\n        $el.find(\"input.import-file\").val(\"\");\n        return $el.find(\"input.import-file\").trigger(\"click\");\n      });\n      return $el.on(\"change\", \"input.import-file\", function(event) {\n        var file, loader, onError, onSuccess;\n        event.preventDefault();\n        file = event.target.files[0];\n        if (!file) {\n          return;\n        }\n        loader = $confirm.loader($translate.instant(\"PROJECT.IMPORT.UPLOADING_FILE\"));\n        onSuccess = function(result) {\n          return currentUserService.loadProjects().then(function() {\n            var ctx, message, msg, title;\n            loader.stop();\n            if (result.status === 202) {\n              title = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_TITLE\");\n              message = $translate.instant(\"PROJECT.IMPORT.ASYNC_IN_PROGRESS_MESSAGE\");\n              return $confirm.success(title, message);\n            } else {\n              ctx = {\n                project: result.data.slug\n              };\n              $location.path($navUrls.resolve(\"project-admin-project-profile-details\", ctx));\n              msg = $translate.instant(\"PROJECT.IMPORT.SYNC_SUCCESS\");\n              return $confirm.notify(\"success\", msg);\n            }\n          });\n        };\n        onError = function(result) {\n          return $tgAuth.refresh().then(function() {\n            var errorMsg, ref, restrictionError;\n            restrictionError = getRestrictionError(result);\n            loader.stop();\n            if (restrictionError) {\n              return $lightboxFactory.create('tg-lb-import-error', {\n                \"class\": 'lightbox lightbox-import-error'\n              }, restrictionError);\n            } else {\n              errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR\");\n              if (result.status === 429) {\n                errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_TOO_MANY_REQUEST\");\n              } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n                errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MESSAGE\", {\n                  error_message: result.data._error_message\n                });\n              }\n              return $confirm.notify(\"error\", errorMsg);\n            }\n          });\n        };\n        loader.start();\n        return $rs.projects[\"import\"](file, loader.update).then(onSuccess, onError);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgImportProjectButton\", [\"$tgResources\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", \"$tgAuth\", ImportProjectButtonDirective]);\n\n  LbImportErrorDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs) {\n      lightboxService.open(el);\n      return scope.close = function() {\n        lightboxService.close(el);\n      };\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-import-error.html\",\n      link: link\n    };\n  };\n\n  LbImportErrorDirective.$inject = [\"lightboxService\"];\n\n  module.directive(\"tgLbImportError\", LbImportErrorDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/lightboxes.coffee\n */\n\n(function() {\n  var AssignedToLightboxDirective, AttachmentPreviewLightboxDirective, BlockLightboxDirective, BlockingMessageInputDirective, CreateBulkUserstoriesDirective, CreateEditUserstoryDirective, LightboxDirective, LightboxKeyboardNavigationService, LightboxLeaveProjectWarningDirective, LightboxService, WatchersLightboxDirective, bindOnce, debounce, module, sizeFormat, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaCommon\");\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  LightboxService = (function(superClass) {\n    extend(LightboxService, superClass);\n\n    function LightboxService(animationFrame, q) {\n      this.animationFrame = animationFrame;\n      this.q = q;\n    }\n\n    LightboxService.prototype.open = function($el) {\n      var defered, docEl, lightboxContent;\n      if (_.isString($el)) {\n        $el = $($el);\n      }\n      defered = this.q.defer();\n      lightboxContent = $el.children().not(\".close\");\n      lightboxContent.hide();\n      this.animationFrame.add(function() {\n        return $el.css('display', 'flex');\n      });\n      this.animationFrame.add(function() {\n        $el.addClass(\"open\");\n        return $el.one(\"transitionend\", (function(_this) {\n          return function() {\n            var firstField;\n            firstField = $el.find('input,textarea').first();\n            if (firstField.length) {\n              return $el.find('input,textarea').first().focus();\n            } else if (document.activeElement) {\n              return $(document.activeElement).blur();\n            }\n          };\n        })(this));\n      });\n      this.animationFrame.add((function(_this) {\n        return function() {\n          lightboxContent.show();\n          return defered.resolve();\n        };\n      })(this));\n      docEl = angular.element(document);\n      docEl.on(\"keydown.lightbox\", (function(_this) {\n        return function(e) {\n          var code;\n          code = e.keyCode ? e.keyCode : e.which;\n          if (code === 27) {\n            return _this.close($el);\n          }\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    LightboxService.prototype.close = function($el) {\n      var docEl, scope;\n      if (_.isString($el)) {\n        $el = $($el);\n      }\n      docEl = angular.element(document);\n      docEl.off(\".lightbox\");\n      docEl.off(\".keyboard-navigation\");\n      $el.one(\"transitionend\", (function(_this) {\n        return function() {\n          $el.removeAttr('style');\n          return $el.removeClass(\"open\").removeClass('close');\n        };\n      })(this));\n      this.animationFrame.add(function() {\n        return $el.addClass('close');\n      });\n      if ($el.hasClass(\"remove-on-close\")) {\n        scope = $el.data(\"scope\");\n        if (scope) {\n          scope.$destroy();\n        }\n        return $el.remove();\n      }\n    };\n\n    LightboxService.prototype.closeAll = function() {\n      var docEl, i, len, lightboxEl, ref, results;\n      docEl = angular.element(document);\n      ref = docEl.find(\".lightbox.open\");\n      results = [];\n      for (i = 0, len = ref.length; i < len; i++) {\n        lightboxEl = ref[i];\n        results.push(this.close($(lightboxEl)));\n      }\n      return results;\n    };\n\n    return LightboxService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxService\", [\"animationFrame\", \"$q\", LightboxService]);\n\n  LightboxKeyboardNavigationService = (function(superClass) {\n    extend(LightboxKeyboardNavigationService, superClass);\n\n    function LightboxKeyboardNavigationService() {\n      return LightboxKeyboardNavigationService.__super__.constructor.apply(this, arguments);\n    }\n\n    LightboxKeyboardNavigationService.prototype.stop = function() {\n      var docEl;\n      docEl = angular.element(document);\n      return docEl.off(\".keyboard-navigation\");\n    };\n\n    LightboxKeyboardNavigationService.prototype.dispatch = function($el, code) {\n      var activeElement, next, prev;\n      activeElement = $el.find(\".selected\");\n      if (code === 13) {\n        if ($el.find(\".user-list-single\").length === 1) {\n          return $el.find('.user-list-single:first').trigger(\"click\");\n        } else {\n          return activeElement.trigger(\"click\");\n        }\n      } else if (code === 40) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:not(\".is-active\"):first').addClass('selected');\n        } else {\n          next = activeElement.next('.user-list-single');\n          if (next.length) {\n            activeElement.removeClass('selected');\n            return next.addClass('selected');\n          }\n        }\n      } else if (code === 38) {\n        if (!activeElement.length) {\n          return $el.find('.user-list-single:last').addClass('selected');\n        } else {\n          prev = activeElement.prev('.user-list-single:not(\".is-active\")');\n          if (prev.length) {\n            activeElement.removeClass('selected');\n            return prev.addClass('selected');\n          }\n        }\n      }\n    };\n\n    LightboxKeyboardNavigationService.prototype.init = function($el) {\n      var docEl;\n      this.stop();\n      docEl = angular.element(document);\n      return docEl.on(\"keydown.keyboard-navigation\", (function(_this) {\n        return function(event) {\n          var code;\n          code = event.keyCode ? event.keyCode : event.which;\n          if (code === 40 || code === 38 || code === 13) {\n            event.preventDefault();\n            return _this.dispatch($el, code);\n          }\n        };\n      })(this));\n    };\n\n    return LightboxKeyboardNavigationService;\n\n  })(taiga.Service);\n\n  module.service(\"lightboxKeyboardNavigationService\", LightboxKeyboardNavigationService);\n\n  LightboxDirective = function(lightboxService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n    };\n    return {\n      restrict: \"C\",\n      link: link\n    };\n  };\n\n  module.directive(\"lightbox\", [\"lightboxService\", LightboxDirective]);\n\n  BlockLightboxDirective = function($rootscope, $tgrepo, $confirm, lightboxService, $loading, $qqueue, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var block, title, unblock;\n      title = $translate.instant($attrs.title);\n      $el.find(\"h2.title\").text(title);\n      unblock = $qqueue.bindAdd((function(_this) {\n        return function(item, finishCallback) {\n          var promise;\n          promise = $tgrepo.save(item);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            $rootscope.$broadcast(\"object:updated\");\n            $model.$setViewValue(item);\n            return finishCallback();\n          });\n          promise.then(null, function() {\n            $confirm.notify(\"error\");\n            item.revert();\n            return $model.$setViewValue(item);\n          });\n          promise[\"finally\"](function() {\n            return finishCallback();\n          });\n          return promise;\n        };\n      })(this));\n      block = $qqueue.bindAdd((function(_this) {\n        return function(item) {\n          var currentLoading, promise;\n          $model.$setViewValue(item);\n          currentLoading = $loading().target($el.find(\".button-green\")).start();\n          promise = $tgrepo.save($model.$modelValue);\n          promise.then(function() {\n            $confirm.notify(\"success\");\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            $confirm.notify(\"error\");\n            item.revert();\n            return $model.$setViewValue(item);\n          });\n          return promise[\"finally\"](function() {\n            currentLoading.finish();\n            return lightboxService.close($el);\n          });\n        };\n      })(this));\n      $scope.$on(\"block\", function() {\n        $el.find(\".reason\").val($model.$modelValue.blocked_note);\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"unblock\", (function(_this) {\n        return function(event, model, finishCallback) {\n          var item;\n          item = $model.$modelValue.clone();\n          item.is_blocked = false;\n          item.blocked_note = \"\";\n          return unblock(item, finishCallback);\n        };\n      })(this));\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        var item;\n        event.preventDefault();\n        item = $model.$modelValue.clone();\n        item.is_blocked = true;\n        item.blocked_note = $el.find(\".reason\").val();\n        return block(item);\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-block.html\",\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgLbBlock\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"lightboxService\", \"$tgLoading\", \"$tgQqueue\", \"$translate\", BlockLightboxDirective]);\n\n  BlockingMessageInputDirective = function($log, $template, $compile) {\n    var link, template, templateFn;\n    template = $template.get(\"common/lightbox/lightbox-blocking-message-input.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      if (!$attrs.watch) {\n        return $log.error(\"No watch attribute on tg-blocking-message-input directive\");\n      }\n      return $scope.$watch($attrs.watch, function(value) {\n        if (value === !void 0 && value === true) {\n          return $el.find(\".blocked-note\").removeClass(\"hidden\");\n        } else {\n          return $el.find(\".blocked-note\").addClass(\"hidden\");\n        }\n      });\n    };\n    templateFn = function($el, $attrs) {\n      return template({\n        ngmodel: $attrs.ngModel\n      });\n    };\n    return {\n      template: templateFn,\n      link: link,\n      require: \"ngModel\",\n      restrict: \"EA\"\n    };\n  };\n\n  module.directive(\"tgBlockingMessageInput\", [\"$log\", \"$tgTemplate\", \"$compile\", BlockingMessageInputDirective]);\n\n  CreateEditUserstoryDirective = function($repo, $model, $rs, $rootScope, lightboxService, $loading, $translate, $confirm, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, form, resetAttachments, submit, submitButton;\n      form = null;\n      $scope.createEditUs = {};\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToDelete = attachmentsToDelete.push(attachment);\n      };\n      $scope.$on(\"usform:new\", function(ctx, projectId, status, statusList) {\n        if (form) {\n          form.reset();\n        }\n        $scope.isNew = true;\n        $scope.usStatusList = statusList;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        $scope.us = $model.make_model(\"userstories\", {\n          project: projectId,\n          points: {},\n          status: status,\n          is_archived: false,\n          tags: []\n        });\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.CREATE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.NEW_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        $el.find(\".blocked-note\").addClass(\"hidden\");\n        $el.find(\"label.blocked\").removeClass(\"selected\");\n        $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"usform:edit\", function(ctx, us, attachments) {\n        if (form) {\n          form.reset();\n        }\n        $scope.us = us;\n        $scope.attachments = Immutable.fromJS(attachments);\n        $scope.isNew = false;\n        resetAttachments();\n        $el.find(\".button-green\").html($translate.instant(\"COMMON.SAVE\"));\n        $el.find(\".title\").html($translate.instant(\"LIGHTBOX.CREATE_EDIT_US.EDIT_US\"));\n        $el.find(\".tag-input\").val(\"\");\n        if (us.is_blocked) {\n          $el.find(\".blocked-note\").removeClass(\"hidden\");\n          $el.find(\"label.blocked\").addClass(\"selected\");\n        } else {\n          $el.find(\".blocked-note\").addClass(\"hidden\");\n          $el.find(\"label.blocked\").removeClass(\"selected\");\n        }\n        if (us.team_requirement) {\n          $el.find(\"label.team-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.team-requirement\").removeClass(\"selected\");\n        }\n        if (us.client_requirement) {\n          $el.find(\"label.client-requirement\").addClass(\"selected\");\n        } else {\n          $el.find(\"label.client-requirement\").removeClass(\"selected\");\n        }\n        return lightboxService.open($el);\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.us.project, 'us');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"us\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          if ($scope.isNew) {\n            promise = $repo.create(\"userstories\", $scope.us);\n            broadcastEvent = \"usform:new:success\";\n          } else {\n            promise = $repo.save($scope.us);\n            broadcastEvent = \"usform:edit:success\";\n          }\n          promise.then(function(data) {\n            deleteAttachments(data).then((function(_this) {\n              return function() {\n                return createAttachments(data);\n              };\n            })(this));\n            return data;\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootScope.$broadcast(broadcastEvent, data);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $scope.us.revert();\n        });\n        return lightboxService.close($el);\n      });\n      $el.keydown(function(event) {\n        var code;\n        code = event.keyCode ? event.keyCode : event.which;\n        if (code === 27) {\n          lightboxService.close($el);\n          return $scope.$apply(function() {\n            return $scope.us.revert();\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditUserstory\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", \"$tgConfirm\", \"$q\", \"tgAttachmentsService\", CreateEditUserstoryDirective]);\n\n  CreateBulkUserstoriesDirective = function($repo, $rs, $rootscope, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"usform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        $scope[\"new\"] = {\n          projectId: projectId,\n          statusId: status,\n          bulk: \"\"\n        };\n        return lightboxService.open($el);\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley({\n            onlyOneErrorElement: true\n          });\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userstories.bulkCreate($scope[\"new\"].projectId, $scope[\"new\"].statusId, $scope[\"new\"].bulk);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"usform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkUserstories\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", CreateBulkUserstoriesDirective]);\n\n  AssignedToLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, filterUsers, normalizeString, render, selectedItem, selectedUser, usersTemplate;\n      selectedUser = null;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      normalizeString = function(string) {\n        var normalizedString;\n        normalizedString = string;\n        normalizedString = normalizedString.replace(\"\", \"A\").replace(\"\", \"A\").replace(\"\", \"A\");\n        normalizedString = normalizedString.replace(\"\", \"E\").replace(\"\", \"E\").replace(\"\", \"E\");\n        normalizedString = normalizedString.replace(\"\", \"I\").replace(\"\", \"I\").replace(\"\", \"I\");\n        normalizedString = normalizedString.replace(\"\", \"O\").replace(\"\", \"O\").replace(\"\", \"O\");\n        normalizedString = normalizedString.replace(\"\", \"U\").replace(\"\", \"U\").replace(\"\", \"U\");\n        return normalizedString;\n      };\n      filterUsers = function(text, user) {\n        var username;\n        username = user.full_name_display.toUpperCase();\n        username = normalizeString(username);\n        text = text.toUpperCase();\n        text = normalizeString(text);\n        return _.includes(username, text);\n      };\n      render = function(selected, text) {\n        var ctx, html, users;\n        users = _.clone($scope.activeUsers, true);\n        if (selected != null) {\n          users = _.reject(users, {\n            \"id\": selected.id\n          });\n        }\n        if (text != null) {\n          users = _.filter(users, _.partial(filterUsers, text));\n        }\n        ctx = {\n          selected: selected,\n          users: _.slice(users, 0, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".assigned-to-list\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"assigned-to:add\", function(ctx, item) {\n        var assignedToId;\n        selectedItem = item;\n        assignedToId = item.assigned_to;\n        selectedUser = $scope.usersById[assignedToId];\n        render(selectedUser);\n        return lightboxService.open($el).then(function() {\n          $el.find('input').focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        if (searchingText != null) {\n          render(selectedUser, searchingText);\n          return $el.find('input').focus();\n        }\n      });\n      $el.on(\"click\", \".user-list-single\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.$broadcast(\"assigned-to:added\", target.data(\"user-id\"), selectedItem);\n          return $scope.usersSearch = null;\n        });\n      });\n      $el.on(\"click\", \".remove-assigned-to\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        closeLightbox();\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"assigned-to:added\", null, selectedItem);\n        });\n      });\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-assigned-to.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAssignedto\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", AssignedToLightboxDirective]);\n\n  WatchersLightboxDirective = function($repo, lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var closeLightbox, getFilteredUsers, render, selectedItem, usersTemplate;\n      selectedItem = null;\n      usersTemplate = $template.get(\"common/lightbox/lightbox-assigned-to-users.html\", true);\n      getFilteredUsers = function(text) {\n        var _filterUsers, users;\n        if (text == null) {\n          text = \"\";\n        }\n        _filterUsers = function(text, user) {\n          var username;\n          if (selectedItem && _.find(selectedItem.watchers, function(x) {\n            return x === user.id;\n          })) {\n            return false;\n          }\n          username = user.full_name_display.toUpperCase();\n          text = text.toUpperCase();\n          return _.includes(username, text);\n        };\n        users = _.clone($scope.activeUsers, true);\n        users = _.filter(users, _.partial(_filterUsers, text));\n        return users;\n      };\n      render = function(users) {\n        var ctx, html;\n        ctx = {\n          selected: false,\n          users: _.slice(users, 0, 5),\n          showMore: users.length > 5\n        };\n        html = usersTemplate(ctx);\n        html = $compile(html)($scope);\n        return $el.find(\".ticket-watchers\").html(html);\n      };\n      closeLightbox = function() {\n        lightboxKeyboardNavigationService.stop();\n        return lightboxService.close($el);\n      };\n      $scope.$on(\"watcher:add\", function(ctx, item) {\n        var users;\n        selectedItem = item;\n        users = getFilteredUsers();\n        render(users);\n        return lightboxService.open($el).then(function() {\n          $el.find(\"input\").focus();\n          return lightboxKeyboardNavigationService.init($el);\n        });\n      });\n      $scope.$watch(\"usersSearch\", function(searchingText) {\n        var users;\n        if (searchingText == null) {\n          return;\n        }\n        users = getFilteredUsers(searchingText);\n        render(users);\n        return $el.find(\"input\").focus();\n      });\n      $el.on(\"click\", \".user-list-single\", debounce(2000, function(event) {\n        var target;\n        closeLightbox();\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return $scope.$apply(function() {\n          $scope.usersSearch = null;\n          return $scope.$broadcast(\"watcher:added\", target.data(\"user-id\"));\n        });\n      }));\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        closeLightbox();\n        return $scope.$apply(function() {\n          return $scope.usersSearch = null;\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-users.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbWatchers\", [\"$tgRepo\", \"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", WatchersLightboxDirective]);\n\n  AttachmentPreviewLightboxDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-attachment-preview.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLbAttachmentPreview\", [\"lightboxService\", \"$tgTemplate\", \"$compile\", AttachmentPreviewLightboxDirective]);\n\n  LightboxLeaveProjectWarningDirective = function(lightboxService, $template, $compile) {\n    var link;\n    link = function($scope, $el, attrs) {\n      return lightboxService.open($el);\n    };\n    return {\n      templateUrl: 'common/lightbox/lightbox-leave-project-warning.html',\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgLightboxLeaveProjectWarning\", [\"lightboxService\", LightboxLeaveProjectWarningDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/loader.coffee\n */\n\n(function() {\n  var Loader, LoaderDirective, module, sizeFormat, taiga, timeout;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaCommon\");\n\n  LoaderDirective = function(tgLoader, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      tgLoader.onStart(function() {\n        $(document.body).addClass(\"loader-active\");\n        return $el.addClass(\"active\");\n      });\n      return tgLoader.onEnd(function() {\n        $(document.body).removeClass(\"loader-active\");\n        return $el.removeClass(\"active\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoader\", [\"tgLoader\", \"$rootScope\", LoaderDirective]);\n\n  Loader = function($rootscope) {\n    var autoClose, config, lastResponseDate, open, pageLoaded, requestCount, start, startLoadTime;\n    config = {\n      minTime: 300\n    };\n    open = false;\n    startLoadTime = 0;\n    requestCount = 0;\n    lastResponseDate = 0;\n    pageLoaded = function(force) {\n      var diff, endTime, timeoutValue;\n      if (force == null) {\n        force = false;\n      }\n      if (startLoadTime) {\n        timeoutValue = 0;\n        if (!force) {\n          endTime = new Date().getTime();\n          diff = endTime - startLoadTime;\n          if (diff < config.minTime) {\n            timeoutValue = config.minTime - diff;\n          }\n        }\n        timeout(timeoutValue, function() {\n          $rootscope.$broadcast(\"loader:end\");\n          open = false;\n          return window.prerenderReady = true;\n        });\n      }\n      startLoadTime = 0;\n      requestCount = 0;\n      return lastResponseDate = 0;\n    };\n    autoClose = function() {\n      var intervalAuto;\n      return intervalAuto = setInterval((function() {\n        if (lastResponseDate && requestCount === 0) {\n          pageLoaded();\n          return clearInterval(intervalAuto);\n        }\n      }), 50);\n    };\n    start = function() {\n      startLoadTime = new Date().getTime();\n      $rootscope.$broadcast(\"loader:start\");\n      return open = true;\n    };\n    return {\n      pageLoaded: pageLoaded,\n      start: function(auto) {\n        if (auto == null) {\n          auto = false;\n        }\n        if (!open) {\n          start();\n          if (auto) {\n            return autoClose();\n          }\n        }\n      },\n      onStart: function(fn) {\n        return $rootscope.$on(\"loader:start\", fn);\n      },\n      onEnd: function(fn) {\n        return $rootscope.$on(\"loader:end\", fn);\n      },\n      logRequest: function() {\n        return requestCount++;\n      },\n      logResponse: function() {\n        requestCount--;\n        return lastResponseDate = new Date().getTime();\n      }\n    };\n  };\n\n  Loader.$inject = [\"$rootScope\"];\n\n  module.factory(\"tgLoader\", Loader);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/lightboxes.coffee\n */\n\n(function() {\n  var LoadingDirective, TgLoadingService, module,\n    slice = [].slice;\n\n  module = angular.module(\"taigaCommon\");\n\n  TgLoadingService = function($compile) {\n    var spinner;\n    spinner = \"<img class='loading-spinner' src='/\" + window._version + \"/svg/spinner-circle.svg' alt='loading...' />\";\n    return function() {\n      var service;\n      service = {\n        settings: {\n          target: null,\n          scope: null,\n          classes: [],\n          timeout: 0,\n          template: null\n        },\n        target: function(target) {\n          service.settings.target = target;\n          return service;\n        },\n        scope: function(scope) {\n          service.settings.scope = scope;\n          return service;\n        },\n        template: function(template) {\n          service.settings.template = template;\n          return service;\n        },\n        removeClasses: function() {\n          var classess;\n          classess = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n          service.settings.classes = classess;\n          return service;\n        },\n        timeout: function(timeout) {\n          service.settings.timeout = timeout;\n          return service;\n        },\n        start: function() {\n          var target, timeoutId;\n          target = service.settings.target;\n          service.settings.classes.map(function(className) {\n            return target.removeClass(className);\n          });\n          if (!target.hasClass('loading') && !service.settings.template) {\n            service.settings.template = target.html();\n          }\n          timeoutId = setTimeout((function() {\n            if (!target.hasClass('loading')) {\n              target.addClass('loading');\n              return target.html(spinner);\n            }\n          }), service.settings.timeout);\n          service.settings.timeoutId = timeoutId;\n          return service;\n        },\n        finish: function() {\n          var removeClasses, target, timeoutId;\n          target = service.settings.target;\n          timeoutId = service.settings.timeoutId;\n          if (timeoutId) {\n            clearTimeout(timeoutId);\n            removeClasses = service.settings.classes;\n            removeClasses.map(function(className) {\n              return service.settings.target.addClass(className);\n            });\n            target.html(service.settings.template);\n            target.removeClass('loading');\n            if (service.settings.scope) {\n              $compile(target.contents())(service.settings.scope);\n            }\n          }\n          return service;\n        }\n      };\n      return service;\n    };\n  };\n\n  TgLoadingService.$inject = [\"$compile\"];\n\n  module.factory(\"$tgLoading\", TgLoadingService);\n\n  LoadingDirective = function($loading) {\n    var link;\n    link = function($scope, $el, attr) {\n      var currentLoading, template;\n      currentLoading = null;\n      template = $el.html();\n      return $scope.$watch(attr.tgLoading, (function(_this) {\n        return function(showLoading) {\n          if (showLoading) {\n            return currentLoading = $loading().target($el).timeout(100).template(template).scope($scope).start();\n          } else if (currentLoading) {\n            return currentLoading.finish();\n          }\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLoading\", [\"$tgLoading\", LoadingDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/popovers.coffee\n */\n\n(function() {\n  var RelatedTaskStatusDirective, UsStatusDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaCommon\");\n\n  UsStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a US and a popover to change it.\n    - tg-us-status: The user story\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-us-status=\"us\" on-update=\"ctrl.loadSprintState()\")\n        a.us-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'usStatusById' and 'project'.\n     */\n    var link, template;\n    template = $template.get(\"common/popover/popover-us-status.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render, us;\n      $ctrl = $el.controller();\n      render = function(us) {\n        var usStatusById, usStatusDom, usStatusDomParent;\n        usStatusDomParent = $el.find(\".us-status\");\n        usStatusDom = $el.find(\".us-status .us-status-bind\");\n        usStatusById = $scope.usStatusById;\n        if (usStatusById[us.status]) {\n          usStatusDom.text(usStatusById[us.status].name);\n          return usStatusDomParent.css(\"color\", usStatusById[us.status].color);\n        }\n      };\n      $el.on(\"click\", \".us-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target, us;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        us = $scope.$eval($attrs.tgUsStatus);\n        us.status = target.data(\"status-id\");\n        render(us);\n        $el.find(\".pop-status\").popover().close();\n        return $scope.$apply(function() {\n          return $repo.save(us).then(function() {\n            return $scope.$eval($attrs.onUpdate);\n          });\n        });\n      }));\n      $scope.$on(\"userstories:loaded\", function() {\n        return render($scope.$eval($attrs.tgUsStatus));\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      us = $scope.$eval($attrs.tgUsStatus);\n      render(us);\n      return bindOnce($scope, \"project\", function(project) {\n        var html;\n        html = template({\n          \"statuses\": project.us_statuses\n        });\n        $el.append(html);\n        if ($scope.project.my_permissions.indexOf(\"modify_us\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsStatus\", [\"$tgRepo\", \"$tgTemplate\", UsStatusDirective]);\n\n  RelatedTaskStatusDirective = function($repo, $template) {\n\n    /*\n    Print the status of a related task and a popover to change it.\n    - tg-related-task-status: The related task\n    - on-update: Method call after US is updated\n    \n    Example:\n    \n      div.status(tg-related-task-status=\"task\" on-update=\"ctrl.loadSprintState()\")\n        a.task-status(href=\"\", title=\"Status Name\")\n    \n    NOTE: This directive need 'taskStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateTaskStatus;\n    selectionTemplate = $template.get(\"common/popover/popover-related-task-status.html\", true);\n    updateTaskStatus = function($el, task, taskStatusById) {\n      var taskStatusDom, taskStatusDomParent;\n      taskStatusDomParent = $el.find(\".us-status\");\n      taskStatusDom = $el.find(\".task-status .task-status-bind\");\n      if (taskStatusById[task.status]) {\n        taskStatusDom.text(taskStatusById[task.status].name);\n        return taskStatusDomParent.css('color', taskStatusById[task.status].color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, autoSave, notAutoSave, task;\n      $ctrl = $el.controller();\n      task = $scope.$eval($attrs.tgRelatedTaskStatus);\n      notAutoSave = $scope.$eval($attrs.notAutoSave);\n      autoSave = !notAutoSave;\n      $el.on(\"click\", \".task-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        task.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (autoSave) {\n          return $scope.$apply(function() {\n            return $repo.save(task).then(function() {\n              $scope.$eval($attrs.onUpdate);\n              return $scope.$emit(\"related-tasks:status-changed\");\n            });\n          });\n        }\n      }));\n      $scope.$watch($attrs.tgRelatedTaskStatus, function() {\n        task = $scope.$eval($attrs.tgRelatedTaskStatus);\n        return updateTaskStatus($el, task, $scope.taskStatusById);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.task_statuses\n        }));\n        updateTaskStatus($el, task, $scope.taskStatusById);\n        if (project.my_permissions.indexOf(\"modify_task\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRelatedTaskStatus\", [\"$tgRepo\", \"$tgTemplate\", RelatedTaskStatusDirective]);\n\n  $.fn.popover = function() {\n    var $el, close, closeAll, closePopover, isVisible, open;\n    $el = this;\n    isVisible = (function(_this) {\n      return function() {\n        var docViewBottom, docViewLeft, docViewRight, docViewTop, docViewWidth, elemBottom, elemLeft, elemRight, elemTop, elemWidth;\n        $el.css({\n          \"display\": \"block\",\n          \"visibility\": \"hidden\"\n        });\n        docViewTop = $(window).scrollTop();\n        docViewBottom = docViewTop + $(window).height();\n        docViewWidth = $(window).width();\n        docViewRight = docViewWidth;\n        docViewLeft = 0;\n        elemTop = $el.offset().top;\n        elemBottom = elemTop + $el.height();\n        elemWidth = $el.width();\n        elemLeft = $el.offset().left;\n        elemRight = $el.offset().left + elemWidth;\n        $el.css({\n          \"display\": \"none\",\n          \"visibility\": \"visible\"\n        });\n        return (elemBottom <= docViewBottom) && (elemTop >= docViewTop) && (elemLeft >= docViewLeft) && (elemRight <= docViewRight);\n      };\n    })(this);\n    closePopover = (function(_this) {\n      return function(onClose) {\n        if (onClose) {\n          onClose.call($el);\n        }\n        $el.fadeOut(function() {\n          return $el.removeClass(\"active\").removeClass(\"fix\");\n        });\n        return $el.off(\"popup:close\");\n      };\n    })(this);\n    closeAll = (function(_this) {\n      return function() {\n        return $(\".popover.active\").each(function() {\n          return $(this).trigger(\"popup:close\");\n        });\n      };\n    })(this);\n    open = (function(_this) {\n      return function(onClose) {\n        if ($el.hasClass(\"active\")) {\n          return close();\n        } else {\n          closeAll();\n          if (!isVisible()) {\n            $el.addClass(\"fix\");\n          }\n          $el.fadeIn(function() {\n            $el.addClass(\"active\");\n            $(document.body).off(\"popover\");\n            return $(document.body).one(\"click.popover\", function() {\n              return closeAll();\n            });\n          });\n          return $el.on(\"popup:close\", function(e) {\n            return closePopover(onClose);\n          });\n        }\n      };\n    })(this);\n    close = (function(_this) {\n      return function() {\n        return $el.trigger(\"popup:close\");\n      };\n    })(this);\n    return {\n      open: open,\n      close: close,\n      closeAll: closeAll\n    };\n  };\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/raven-logger.coffee\n */\n\n(function() {\n  var ExceptionHandlerFactory, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaCommon\");\n\n  ExceptionHandlerFactory = function($log, config) {\n    var ravenConfig;\n    this.config = config;\n    ravenConfig = this.config.get(\"ravenConfig\", null);\n    if (ravenConfig) {\n      $log.debug(\"Using the RavenJS exception handler.\");\n      Raven.config(ravenConfig).install();\n      return function(exception, cause) {\n        $log.error.apply($log, arguments);\n        return Raven.captureException(exception);\n      };\n    } else {\n      $log.debug(\"Using the default logging exception handler.\");\n      return function(exception, cause) {\n        return $log.error.apply($log, arguments);\n      };\n    }\n  };\n\n  module.factory(\"$exceptionHandler\", [\"$log\", \"$tgConfig\", ExceptionHandlerFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/tags.coffee\n */\n\n(function() {\n  var ColorizeTagsDirective, LbTagLineDirective, TagLineDirective, TagsDirective, bindOnce, module, taiga, trim,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  TagsDirective = function() {\n    var formatter, link, parser;\n    formatter = function(v) {\n      if (_.isArray(v)) {\n        return v.join(\", \");\n      }\n      return \"\";\n    };\n    parser = function(v) {\n      var result;\n      if (!v) {\n        return [];\n      }\n      result = _(v.split(\",\")).map(function(x) {\n        return _.trim(x);\n      });\n      return result.value();\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      $ctrl.$formatters.push(formatter);\n      $ctrl.$parsers.push(parser);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgTags\", TagsDirective);\n\n  ColorizeTagsDirective = function() {\n    var link, templates;\n    templates = {\n      backlog: _.template(\"<% _.each(tags, function(tag) { %>\\n    <span class=\\\"tag\\\" style=\\\"border-left: 5px solid <%- tag.color %>\\\"><%- tag.name %></span>\\n<% }) %>\"),\n      kanban: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"kanban-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\"),\n      taskboard: _.template(\"<% _.each(tags, function(tag) { %>\\n    <a class=\\\"taskboard-tag\\\" href=\\\"\\\" style=\\\"border-color: <%- tag.color %>\\\" title=\\\"<%- tag.name %>\\\" />\\n<% }) %>\")\n    };\n    link = function($scope, $el, $attrs, $ctrl) {\n      var render;\n      render = function(srcTags) {\n        var html, tags, template;\n        template = templates[$attrs.tgColorizeTagsType];\n        srcTags.sort();\n        tags = _.map(srcTags, function(tag) {\n          var color;\n          color = $scope.project.tags_colors[tag];\n          return {\n            name: tag,\n            color: color\n          };\n        });\n        html = template({\n          tags: tags\n        });\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.tgColorizeTags, function(tags) {\n        if (tags != null) {\n          return render(tags);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgColorizeTags\", ColorizeTagsDirective);\n\n  LbTagLineDirective = function($rs, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, autocomplete, link, templateTags;\n    ENTER_KEY = 13;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/lb-tag-line-tags.html\", true);\n    autocomplete = null;\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, deleteValue, hideSaveButton, renderTags, resetInput, saveInputTag, showSaveButton;\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          })\n        };\n        _.map(ctx.tags, (function(_this) {\n          return function(tag) {\n            if (tag.color) {\n              return tag.style = \"border-left: 5px solid \" + tag.color;\n            }\n          };\n        })(this));\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\".tags-container\").html(html);\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return autocomplete.close();\n      };\n      addValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n        return hideSaveButton();\n      };\n      deleteValue = function(value) {\n        var tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue, false);\n        tags = _.pull(tags, value);\n        return $scope.$apply(function() {\n          return $model.$setViewValue(tags);\n        });\n      };\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          event.preventDefault();\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".remove-tag\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project\", function(project) {\n        var input;\n        input = $el.find(\"input\");\n        autocomplete = new Awesomplete(input[0], {\n          list: _.keys(project.tags_colors)\n        });\n        return input.on(\"awesomplete-selectcomplete\", function() {\n          addValue(input.val());\n          return input.val(\"\");\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(tags) {\n        var ref, tagsColors;\n        tagsColors = ((ref = $scope.project) != null ? ref.tags_colors : void 0) || [];\n        return renderTags(tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/lb-tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgLbTagLine\", [\"$tgResources\", \"$tgTemplate\", \"$compile\", LbTagLineDirective]);\n\n  TagLineDirective = function($rootScope, $repo, $rs, $confirm, $qqueue, $template, $compile) {\n    var COMMA_KEY, ENTER_KEY, ESC_KEY, link, templateTags;\n    ENTER_KEY = 13;\n    ESC_KEY = 27;\n    COMMA_KEY = 188;\n    templateTags = $template.get(\"common/tag/tags-line-tags.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addValue, autocomplete, deleteValue, hideAddTagButton, hideAddTagButtonText, hideInput, hideSaveButton, isEditable, renderInReadModeOnly, renderTags, resetInput, saveInputTag, showAddTagButton, showAddTagButtonText, showInput, showSaveButton;\n      autocomplete = null;\n      isEditable = function() {\n        if ($attrs.requiredPerm != null) {\n          return $scope.project.my_permissions.indexOf($attrs.requiredPerm) !== -1;\n        }\n        return true;\n      };\n      renderTags = function(tags, tagsColors) {\n        var ctx, html;\n        ctx = {\n          tags: _.map(tags, function(t) {\n            return {\n              name: t,\n              color: tagsColors[t]\n            };\n          }),\n          isEditable: isEditable()\n        };\n        html = $compile(templateTags(ctx))($scope);\n        return $el.find(\"div.tags-container\").html(html);\n      };\n      renderInReadModeOnly = function() {\n        $el.find(\".add-tag\").remove();\n        $el.find(\"input\").remove();\n        return $el.find(\".save\").remove();\n      };\n      showAddTagButton = function() {\n        return $el.find(\".add-tag\").removeClass(\"hidden\");\n      };\n      hideAddTagButton = function() {\n        return $el.find(\".add-tag\").addClass(\"hidden\");\n      };\n      showAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").removeClass(\"hidden\");\n      };\n      hideAddTagButtonText = function() {\n        return $el.find(\".add-tag-text\").addClass(\"hidden\");\n      };\n      showSaveButton = function() {\n        return $el.find(\".save\").removeClass(\"hidden\");\n      };\n      hideSaveButton = function() {\n        return $el.find(\".save\").addClass(\"hidden\");\n      };\n      showInput = function() {\n        return $el.find(\"input\").removeClass(\"hidden\").focus();\n      };\n      hideInput = function() {\n        return $el.find(\"input\").addClass(\"hidden\").blur();\n      };\n      resetInput = function() {\n        $el.find(\"input\").val(\"\");\n        return autocomplete.close();\n      };\n      addValue = $qqueue.bindAdd(function(value) {\n        var model, onError, onSuccess, tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue.tags, false);\n        if (tags == null) {\n          tags = [];\n        }\n        if (indexOf.call(tags, value) < 0) {\n          tags.push(value);\n        }\n        model = $model.$modelValue.clone();\n        model.tags = tags;\n        $model.$setViewValue(model);\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          model.revert();\n          return $model.$setViewValue(model);\n        };\n        hideSaveButton();\n        return $repo.save(model).then(onSuccess, onError);\n      });\n      deleteValue = $qqueue.bindAdd(function(value) {\n        var model, onError, onSuccess, tags;\n        value = trim(value.toLowerCase());\n        if (value.length === 0) {\n          return;\n        }\n        tags = _.clone($model.$modelValue.tags, false);\n        tags = _.pull(tags, value);\n        model = $model.$modelValue.clone();\n        model.tags = tags;\n        $model.$setViewValue(model);\n        onSuccess = function() {\n          return $rootScope.$broadcast(\"object:updated\");\n        };\n        onError = function() {\n          $confirm.notify(\"error\");\n          model.revert();\n          return $model.$setViewValue(model);\n        };\n        return $repo.save(model).then(onSuccess, onError);\n      });\n      saveInputTag = function() {\n        var value;\n        value = $el.find(\"input\").val();\n        addValue(value);\n        return resetInput();\n      };\n      $el.on(\"keypress\", \"input\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if (event.keyCode === ENTER_KEY) {\n          return saveInputTag();\n        } else if (String.fromCharCode(event.keyCode) === ',') {\n          event.preventDefault();\n          return saveInputTag();\n        } else {\n          if (target.val().length) {\n            return showSaveButton();\n          } else {\n            return hideSaveButton();\n          }\n        }\n      });\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === ESC_KEY) {\n          resetInput();\n          hideInput();\n          hideSaveButton();\n          return showAddTagButton();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return saveInputTag();\n      });\n      $el.on(\"click\", \".add-tag\", function(event) {\n        event.preventDefault();\n        hideAddTagButton();\n        return showInput();\n      });\n      $el.on(\"click\", \".remove-tag\", function(event) {\n        var target, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        value = target.siblings(\".tag-name\").text();\n        return deleteValue(value);\n      });\n      bindOnce($scope, \"project.tags_colors\", function(tags_colors) {\n        var input;\n        if (!isEditable()) {\n          renderInReadModeOnly();\n          return;\n        }\n        showAddTagButton();\n        input = $el.find(\"input\");\n        autocomplete = new Awesomplete(input[0], {\n          list: _.keys(tags_colors)\n        });\n        return input.on(\"awesomplete-selectcomplete\", function() {\n          addValue(input.val());\n          return input.val(\"\");\n        });\n      });\n      $scope.$watch($attrs.ngModel, function(model) {\n        var ref, ref1, tagsColors;\n        if (!model) {\n          return;\n        }\n        if ((ref = model.tags) != null ? ref.length : void 0) {\n          hideAddTagButtonText();\n        } else {\n          showAddTagButtonText();\n        }\n        tagsColors = ((ref1 = $scope.project) != null ? ref1.tags_colors : void 0) || [];\n        return renderTags(model.tags, tagsColors);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\",\n      templateUrl: \"common/tag/tag-line.html\"\n    };\n  };\n\n  module.directive(\"tgTagLine\", [\"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", TagLineDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/wisiwyg.coffee\n */\n\n(function() {\n  var MarkitupDirective, bindOnce, module, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaCommon\");\n\n  MarkitupDirective = function($rootscope, $rs, $selectedText, $template, $compile, $translate) {\n    var link, previewTemplate;\n    previewTemplate = $template.get(\"common/wysiwyg/wysiwyg-markitup-preview.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var addLine, cancelablePromise, closePreviewMode, element, markdownTitle, prepareUrlFormatting, preview, previewDomNode, previewInProgress, renderMarkItUp, setCaretPosition, unbind, urlFormatting;\n      element = angular.element($el);\n      previewDomNode = $(\"<div/>\", {\n        \"class\": \"preview\"\n      });\n      closePreviewMode = function() {\n        element.parents(\".markdown\").find(\".preview\").remove();\n        return element.parents(\".markItUp\").show();\n      };\n      $scope.$on(\"markdown-editor:submit\", function() {\n        return closePreviewMode();\n      });\n      cancelablePromise = null;\n      previewInProgress = false;\n      preview = function() {\n        var markItUpDomNode, markdownDomNode;\n        if (previewInProgress) {\n          return;\n        }\n        previewInProgress = true;\n        markdownDomNode = element.parents(\".markdown\");\n        markItUpDomNode = element.parents(\".markItUp\");\n        return $rs.mdrender.render($scope.projectId, $model.$modelValue).then(function(data) {\n          var html, markdown;\n          html = previewTemplate({\n            data: data.data\n          });\n          html = $compile(html)($scope);\n          markdownDomNode.append(html);\n          markItUpDomNode.hide();\n          previewInProgress = false;\n          markdown = element.closest(\".markdown\");\n          return markdown.on(\"mouseup.preview\", \".preview\", function(event) {\n            var target;\n            event.preventDefault();\n            target = angular.element(event.target);\n            if (!target.is('a') && $selectedText.get().length) {\n              return;\n            }\n            markdown.off(\".preview\");\n            return closePreviewMode();\n          });\n        });\n      };\n      setCaretPosition = function(textarea, caretPosition) {\n        var line, range, scrollRelation, totalLines;\n        if (textarea.createTextRange) {\n          range = textarea.createTextRange();\n          range.move(\"character\", caretPosition);\n          range.select();\n        } else if (textarea.selectionStart) {\n          textarea.focus();\n          textarea.setSelectionRange(caretPosition, caretPosition);\n        }\n        totalLines = textarea.value.split(\"\\n\").length;\n        line = textarea.value.slice(0, +(caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n        scrollRelation = line / totalLines;\n        return $el.scrollTop((scrollRelation * $el[0].scrollHeight) - ($el.height() / 2));\n      };\n      addLine = function(textarea, nline, replace) {\n        var cursorPosition, j, key, len, line, lines;\n        lines = textarea.value.split(\"\\n\");\n        if (replace) {\n          lines[nline] = replace + lines[nline];\n        } else {\n          lines[nline] = \"\";\n        }\n        cursorPosition = 0;\n        for (key = j = 0, len = lines.length; j < len; key = ++j) {\n          line = lines[key];\n          cursorPosition += line.length + 1 || 1;\n          if (key === nline) {\n            break;\n          }\n        }\n        textarea.value = lines.join(\"\\n\");\n        if (replace) {\n          return cursorPosition - lines[nline].length + replace.length - 1;\n        } else {\n          return cursorPosition;\n        }\n      };\n      prepareUrlFormatting = function(markItUp) {\n        var indices, regex, result;\n        regex = /(<<<|>>>)/gi;\n        result = 0;\n        indices = [];\n        while ((result = regex.exec(markItUp.textarea.value))) {\n          indices.push(result.index);\n        }\n        return markItUp.donotparse = indices;\n      };\n      urlFormatting = function(markItUp) {\n        var endIndex, ref, ref1, regex, result, startIndex, url, value;\n        regex = /<<</gi;\n        result = 0;\n        startIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref = result.index, indexOf.call(markItUp.donotparse, ref) < 0) {\n            startIndex = result.index;\n            break;\n          }\n        }\n        if (!result) {\n          return;\n        }\n        regex = />>>/gi;\n        endIndex = 0;\n        while (true) {\n          result = regex.exec(markItUp.textarea.value);\n          if (!result) {\n            break;\n          }\n          if (ref1 = result.index, indexOf.call(markItUp.donotparse, ref1) < 0) {\n            endIndex = result.index;\n            break;\n          }\n        }\n        value = markItUp.textarea.value;\n        url = value.substring(startIndex, endIndex).replace('<<<', '').replace('>>>', '');\n        url = url.replace('(', '%28').replace(')', '%29');\n        url = url.replace('[', '%5B').replace(']', '%5D');\n        value = value.substring(0, startIndex) + url + value.substring(endIndex + 3, value.length);\n        markItUp.textarea.value = value;\n        return markItUp.donotparse = void 0;\n      };\n      markdownTitle = function(markItUp, char) {\n        var heading, i, j, n, ref;\n        heading = \"\";\n        n = $.trim(markItUp.selection || markItUp.placeHolder).length;\n        for (i = j = 0, ref = n - 1; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {\n          heading += char;\n        }\n        return \"\\n\" + heading + \"\\n\";\n      };\n      renderMarkItUp = function() {\n        var markdownSettings;\n        markdownSettings = {\n          nameSpace: \"markdown\",\n          onShiftEnter: {\n            keepDefault: false,\n            openWith: \"\\n\\n\"\n          },\n          onEnter: {\n            keepDefault: false,\n            replaceWith: function() {\n              if (!$('.textcomplete-dropdown').is(':visible')) {\n                return \"\\n\";\n              }\n            },\n            afterInsert: function(data) {\n              var cursorLine, emptyListItem, lastLine, lines, markdownCaretPositon, match, newLineContent, nline, replace;\n              lines = data.textarea.value.split(\"\\n\");\n              if (data.caretPosition > 0) {\n                cursorLine = data.textarea.value.slice(0, +(data.caretPosition - 1) + 1 || 9e9).split(\"\\n\").length;\n              } else {\n                cursorLine = 1;\n              }\n              newLineContent = data.textarea.value.slice(data.caretPosition).split(\"\\n\")[0];\n              lastLine = lines[cursorLine - 1];\n              match = lastLine.match(/^(\\s*- ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)\\-\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*\\* ).*/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*\\* )$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = \"\" + match[1];\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              match = lastLine.match(/^(\\s*)(\\d+)\\.\\s/);\n              if (match) {\n                emptyListItem = lastLine.match(/^(\\s*)(\\d+)\\.\\s$/);\n                if (emptyListItem) {\n                  nline = cursorLine - 1;\n                  replace = null;\n                } else {\n                  nline = cursorLine;\n                  replace = (match[1] + (parseInt(match[2], 10) + 1)) + \". \";\n                }\n                markdownCaretPositon = addLine(data.textarea, nline, replace);\n              }\n              if (markdownCaretPositon) {\n                return setCaretPosition(data.textarea, markdownCaretPositon);\n              }\n            }\n          },\n          markupSet: [\n            {\n              name: $translate.instant(\"COMMON.WYSIWYG.H1_BUTTON\"),\n              key: \"1\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H1_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"=\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H2_BUTTON\"),\n              key: \"2\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H2_SAMPLE_TEXT\"),\n              closeWith: function(markItUp) {\n                return markdownTitle(markItUp, \"-\");\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.H3_BUTTON\"),\n              key: \"3\",\n              openWith: \"### \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.H3_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON\"),\n              key: \"B\",\n              openWith: \"**\",\n              closeWith: \"**\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BOLD_BUTTON_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\"),\n              key: \"I\",\n              openWith: \"_\",\n              closeWith: \"_\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.ITALIC_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.STRIKE_BUTTON\"),\n              key: \"S\",\n              openWith: \"~~\",\n              closeWith: \"~~\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.STRIKE_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_BUTTON\"),\n              openWith: \"- \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.BULLETED_LIST_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_BUTTON\"),\n              openWith: function(markItUp) {\n                return markItUp.line + \". \";\n              },\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.NUMERIC_LIST_SAMPLE_TEXT\")\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PICTURE_BUTTON\"),\n              key: \"P\",\n              openWith: \"![\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.PICTURE_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.LINK_BUTTON\"),\n              key: \"L\",\n              openWith: \"[\",\n              closeWith: '](<<<[![Url:!:http://]!]>>> \"[![Title]!]\")',\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.LINK_SAMPLE_TEXT\"),\n              beforeInsert: function(markItUp) {\n                return prepareUrlFormatting(markItUp);\n              },\n              afterInsert: function(markItUp) {\n                return urlFormatting(markItUp);\n              }\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_BUTTON\"),\n              openWith: \"> \",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.QUOTE_BLOCK_SAMPLE_TEXT\")\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_BUTTON\"),\n              openWith: \"```\\n\",\n              placeHolder: $translate.instant(\"COMMON.WYSIWYG.CODE_BLOCK_SAMPLE_TEXT\"),\n              closeWith: \"\\n```\"\n            }, {\n              separator: \"---------------\"\n            }, {\n              name: $translate.instant(\"COMMON.WYSIWYG.PREVIEW_BUTTON\"),\n              call: preview,\n              className: \"preview-icon\"\n            }\n          ],\n          afterInsert: function(event) {\n            var target;\n            target = angular.element(event.textarea);\n            return $model.$setViewValue(target.val());\n          }\n        };\n        return element.markItUpRemove().markItUp(markdownSettings).textcomplete([\n          {\n            cache: true,\n            match: /(^|\\s)#([a-z0-9]+)$/i,\n            search: function(term, callback) {\n              var filter, searchProps, searchTypes;\n              term = taiga.slugify(term);\n              searchTypes = ['issues', 'tasks', 'userstories'];\n              searchProps = ['ref', 'subject'];\n              filter = (function(_this) {\n                return function(item) {\n                  var j, len, prop;\n                  for (j = 0, len = searchProps.length; j < len; j++) {\n                    prop = searchProps[j];\n                    if (taiga.slugify(item[prop]).indexOf(term) >= 0) {\n                      return true;\n                    }\n                  }\n                  return false;\n                };\n              })(this);\n              if (cancelablePromise) {\n                cancelablePromise.abort();\n              }\n              cancelablePromise = $rs.search[\"do\"]($scope.projectId, term);\n              cancelablePromise.then((function(_this) {\n                return function(res) {\n                  var j, len, results, type;\n                  if (res.count < 1 || res.count === res.wikipages.length) {\n                    return callback([]);\n                  } else {\n                    results = [];\n                    for (j = 0, len = searchTypes.length; j < len; j++) {\n                      type = searchTypes[j];\n                      if (res[type] && res[type].length > 0) {\n                        results.push(callback(res[type].filter(filter), true));\n                      } else {\n                        results.push(void 0);\n                      }\n                    }\n                    return results;\n                  }\n                };\n              })(this));\n              return callback([]);\n            },\n            replace: function(res) {\n              return \"$1\\#\" + res.ref + \" \";\n            },\n            template: function(res, term) {\n              return \"\\#\" + res.ref + \" - \" + res.subject;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)@([a-z0-9\\-\\._]{2,})$/i,\n            search: function(term, callback) {\n              var searchProps, username;\n              username = taiga.slugify(term);\n              searchProps = ['username', 'full_name', 'full_name_display'];\n              if ($scope.project.members.length < 1) {\n                return callback([]);\n              } else {\n                return callback($scope.project.members.filter((function(_this) {\n                  return function(user) {\n                    var j, len, prop;\n                    for (j = 0, len = searchProps.length; j < len; j++) {\n                      prop = searchProps[j];\n                      if (taiga.slugify(user[prop]).indexOf(username) >= 0) {\n                        return true;\n                      }\n                    }\n                    return false;\n                  };\n                })(this)));\n              }\n            },\n            replace: function(user) {\n              return \"$1@\" + user.username + \" \";\n            },\n            template: function(user) {\n              return user.username + \" - \" + user.full_name_display;\n            }\n          }, {\n            cache: true,\n            match: /(^|\\s)\\[\\[([a-z0-9\\-]+)$/i,\n            search: function(term, callback) {\n              term = taiga.slugify(term);\n              return $rs.search[\"do\"]($scope.projectId, term).then((function(_this) {\n                return function(res) {\n                  if (res.count < 1) {\n                    callback([]);\n                  }\n                  if (res.count < 1 || !res.wikipages || res.wikipages.length <= 0) {\n                    callback([]);\n                  } else {\n                    callback(res.wikipages.filter(function(page) {\n                      return taiga.slugify(page['slug']).indexOf(term) >= 0;\n                    }), true);\n                  }\n                  return callback([]);\n                };\n              })(this));\n            },\n            replace: function(res) {\n              return \"$1[[\" + res.slug + \"]]\";\n            },\n            template: function(res, term) {\n              return res.slug;\n            }\n          }\n        ], {\n          debounce: 200\n        });\n      };\n      renderMarkItUp();\n      unbind = $rootscope.$on(\"$translateChangeEnd\", renderMarkItUp);\n      element.on(\"keypress\", function(event) {\n        return $scope.$apply();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return unbind();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgMarkitup\", [\"$rootScope\", \"$tgResources\", \"$selectedText\", \"$tgTemplate\", \"$compile\", \"$translate\", MarkitupDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogFiltersDirective, bindOnce, debounceLeading, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogFiltersDirective = function($q, $log, $location, $template, $compile) {\n    var link, template, templateSelected;\n    template = $template.get(\"backlog/filters.html\", true);\n    templateSelected = $template.get(\"backlog/filter-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, currentFiltersType, getFiltersType, initializeSelectedFilters, reloadUserstories, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection;\n      currentFiltersType = '';\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\"h2.breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 a.subfilter span.title\").html(title);\n        $el.find(\"h2 a.subfilter span.title\").prop(\"data-type\", type);\n        return currentFiltersType = getFiltersType();\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\"h2.breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function() {\n        var i, len, name, ref, val, values;\n        showCategories();\n        selectedFilters = [];\n        ref = $scope.filters;\n        for (name in ref) {\n          values = ref[name];\n          for (i = 0, len = values.length; i < len; i++) {\n            val = values[i];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters();\n      };\n      renderSelectedFilters = function() {\n        var html;\n        _.map(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filters-applied\").html(html);\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.map(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\"h2 a.subfilter span.title\").prop('data-type');\n      };\n      reloadUserstories = function() {\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadUserstories(true), $ctrl.generateFilters()]).then(function() {\n          var currentFilters;\n          currentFilters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(currentFilters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var filter, filters;\n        currentFiltersType = getFiltersType();\n        filters = $scope.filters[type];\n        filter = _.find(filters, {\n          id: id\n        });\n        filter.selected = !filter.selected;\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $scope.$apply(function() {\n            return $ctrl.selectFilter(type, id);\n          });\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(selected) {\n            return filter.type === selected.type && filter.id === selected.id;\n          });\n          $ctrl.unselectFilter(type, id);\n        }\n        renderSelectedFilters(selectedFilters);\n        if (type === currentFiltersType) {\n          renderFilters(_.reject(filters, \"selected\"));\n        }\n        return reloadUserstories();\n      };\n      selectQFilter = debounceLeading(100, function(value) {\n        if (value === void 0) {\n          return;\n        }\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n        }\n        return reloadUserstories();\n      });\n      $scope.$watch(\"filtersQ\", selectQFilter);\n      $scope.$on(\"backlog:loaded\", function(ctx) {\n        return initializeSelectedFilters();\n      });\n      $scope.$on(\"filters:update\", function(ctx) {\n        return $ctrl.generateFilters().then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          if (currentFiltersType) {\n            return renderFilters(_.reject(filters, \"selected\"));\n          }\n        });\n      });\n      $el.on(\"click\", \".filters-cats > ul > li > a\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data('type'));\n      });\n      $el.on(\"click\", \".filters-inner > .filters-step-cat > .breadcrumb > .back\", function(event) {\n        event.preventDefault();\n        return showCategories();\n      });\n      $el.on(\"click\", \".remove-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget).parent();\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      return $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        if (target.hasClass(\"active\")) {\n          target.removeClass(\"active\");\n        } else {\n          target.addClass(\"active\");\n        }\n        id = target.data(\"id\");\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", BacklogFiltersDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/lightboxes.coffee\n */\n\n(function() {\n  var CreateEditSprint, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaBacklog\");\n\n  CreateEditSprint = function($repo, $confirm, $rs, $rootscope, lightboxService, $loading, $translate) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var createSprint, form, getLastSprint, hasErrors, remove, resetSprint, submit;\n      hasErrors = false;\n      createSprint = true;\n      form = null;\n      resetSprint = function() {\n        if (form) {\n          form.reset();\n        }\n        return $scope.sprint = {\n          project: null,\n          name: null,\n          estimated_start: null,\n          estimated_finish: null\n        };\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, newSprint, prettyDate, promise, submitButton, target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n          submitButton = $el.find(\".submit-button\");\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            hasErrors = true;\n            $el.find(\".last-sprint-name\").addClass(\"disappear\");\n            return;\n          }\n          hasErrors = false;\n          newSprint = angular.copy($scope.sprint);\n          broadcastEvent = null;\n          if (createSprint) {\n            newSprint.estimated_start = moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\");\n            newSprint.estimated_finish = moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\");\n            promise = $repo.create(\"milestones\", newSprint);\n            broadcastEvent = \"sprintform:create:success\";\n          } else {\n            newSprint.setAttr(\"estimated_start\", moment(newSprint.estimated_start, prettyDate).format(\"YYYY-MM-DD\"));\n            newSprint.setAttr(\"estimated_finish\", moment(newSprint.estimated_finish, prettyDate).format(\"YYYY-MM-DD\"));\n            promise = $repo.save(newSprint);\n            broadcastEvent = \"sprintform:edit:success\";\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise.then(function(data) {\n            currentLoading.finish();\n            if (createSprint) {\n              $scope.sprintsCounter += 1;\n            }\n            $rootscope.$broadcast(broadcastEvent, data);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"light-error\", data._error_message);\n            } else if (data.__all__) {\n              return $confirm.notify(\"light-error\", data.__all__[0]);\n            }\n          });\n        };\n      })(this));\n      remove = function() {\n        var message, title;\n        title = $translate.instant(\"LIGHTBOX.DELETE_SPRINT.TITLE\");\n        message = $scope.sprint.name;\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSuccess;\n            onSuccess = function() {\n              askResponse.finish();\n              $scope.milestonesCounter -= 1;\n              lightboxService.close($el);\n              return $rootscope.$broadcast(\"sprintform:remove:success\", $scope.sprint);\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove($scope.sprint).then(onSuccess, onError);\n          };\n        })(this));\n      };\n      getLastSprint = function() {\n        var openSprints, sortedSprints;\n        openSprints = _.filter($scope.sprints, function(sprint) {\n          return !sprint.closed;\n        });\n        sortedSprints = _.sortBy(openSprints, function(sprint) {\n          return moment(sprint.estimated_finish, 'YYYY-MM-DD').format('X');\n        });\n        return sortedSprints[sortedSprints.length - 1];\n      };\n      $scope.$on(\"sprintform:create\", function(event, projectId) {\n        var estimatedFinish, estimatedStart, lastSprint, lastSprintNameDom, prettyDate, text;\n        resetSprint();\n        form = $el.find(\"form\").checksley();\n        form.reset();\n        createSprint = true;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.sprint.project = projectId;\n        $scope.sprint.name = null;\n        $scope.sprint.slug = null;\n        lastSprint = getLastSprint();\n        estimatedStart = moment();\n        if (lastSprint) {\n          estimatedStart = moment(lastSprint.estimated_finish);\n        } else if ($scope.sprint.estimated_start) {\n          estimatedStart = moment($scope.sprint.estimated_start);\n        }\n        $scope.sprint.estimated_start = estimatedStart.format(prettyDate);\n        estimatedFinish = moment().add(2, \"weeks\");\n        if (lastSprint) {\n          estimatedFinish = moment(lastSprint.estimated_finish).add(2, \"weeks\");\n        } else if ($scope.sprint.estimated_finish) {\n          estimatedFinish = moment($scope.sprint.estimated_finish);\n        }\n        $scope.sprint.estimated_finish = estimatedFinish.format(prettyDate);\n        lastSprintNameDom = $el.find(\".last-sprint-name\");\n        if ((lastSprint != null ? lastSprint.name : void 0) != null) {\n          text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.LAST_SPRINT_NAME\", {\n            lastSprint: lastSprint.name\n          });\n          lastSprintNameDom.html(text);\n        }\n        $el.find(\".delete-sprint\").addClass(\"hidden\");\n        text = $translate.instant(\"LIGHTBOX.ADD_EDIT_SPRINT.TITLE\");\n        $el.find(\".title\").text(text);\n        text = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").text(text);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus();\n        return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n      });\n      $scope.$on(\"sprintform:edit\", function(ctx, sprint) {\n        var editSprint, prettyDate, save;\n        resetSprint();\n        createSprint = false;\n        prettyDate = $translate.instant(\"COMMON.PICKERDATE.FORMAT\");\n        $scope.$apply(function() {\n          $scope.sprint = sprint;\n          $scope.sprint.estimated_start = moment($scope.sprint.estimated_start).format(prettyDate);\n          return $scope.sprint.estimated_finish = moment($scope.sprint.estimated_finish).format(prettyDate);\n        });\n        $el.find(\".delete-sprint\").removeClass(\"hidden\");\n        editSprint = $translate.instant(\"BACKLOG.EDIT_SPRINT\");\n        $el.find(\".title\").text(editSprint);\n        save = $translate.instant(\"COMMON.SAVE\");\n        $el.find(\".button-green\").text(save);\n        lightboxService.open($el);\n        $el.find(\".sprint-name\").focus().select();\n        return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n      });\n      $el.on(\"keyup\", \".sprint-name\", function(event) {\n        if ($el.find(\".sprint-name\").val().length > 0 || hasErrors) {\n          return $el.find(\".last-sprint-name\").addClass(\"disappear\");\n        } else {\n          return $el.find(\".last-sprint-name\").removeClass(\"disappear\");\n        }\n      });\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".delete-sprint\", function(event) {\n        event.preventDefault();\n        return remove();\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return resetSprint();\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateEditSprint\", [\"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$translate\", CreateEditSprint]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/main.coffee\n */\n\n(function() {\n  var BacklogController, BacklogDirective, BurndownBacklogGraphDirective, TgBacklogProgressBarDirective, ToggleBurndownVisibility, UsPointsDirective, UsRolePointsSelectorDirective, bindMethods, bindOnce, generateHash, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  generateHash = this.taiga.generateHash;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogController = (function(superClass) {\n    extend(BacklogController, superClass);\n\n    BacklogController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\", \"$tgLoading\", \"tgResources\"];\n\n    function BacklogController(scope1, rootscope, repo, confirm, rs, params1, q, location, appMetaService, navUrls, events, analytics, translate, loading, rs2) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loading = loading;\n      this.rs2 = rs2;\n      bindMethods(this);\n      this.page = 1;\n      this.disablePagination = false;\n      this.scope.userstories = [];\n      this.scope.sectionName = this.translate.instant(\"BACKLOG.SECTION_NAME\");\n      this.showTags = false;\n      this.activeFilters = false;\n      this.scope.showGraphPlaceholder = null;\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"BACKLOG.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"BACKLOG.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          _this.appMetaService.setAll(title, description);\n          if (_this.rs.userstories.getShowTags(_this.scope.projectId)) {\n            _this.showTags = true;\n            return _this.scope.$broadcast(\"showTags\", _this.showTags);\n          }\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    BacklogController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories(true);\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:create:success\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          return _this.analytics.trackEvent(\"sprint\", \"create\", \"create sprint on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories(true);\n          _this.loadProjectStats();\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on backlog\", 1);\n        };\n      })(this));\n      this.scope.$on(\"sprintform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"sprintform:remove:success\", (function(_this) {\n        return function(event, sprint) {\n          _this.loadSprints();\n          _this.loadProjectStats();\n          _this.loadUserstories(true);\n          if (sprint.closed) {\n            _this.loadClosedSprints();\n          }\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function(event, data) {\n          var index;\n          index = _.findIndex(_this.scope.userstories, function(us) {\n            return us.id === data.id;\n          });\n          _this.scope.userstories[index] = data;\n          return _this.rootscope.$broadcast(\"filters:update\");\n        };\n      })(this));\n      this.scope.$on(\"sprint:us:move\", this.moveUs);\n      this.scope.$on(\"sprint:us:moved\", (function(_this) {\n        return function() {\n          _this.loadSprints();\n          return _this.loadProjectStats();\n        };\n      })(this));\n      this.scope.$on(\"backlog:load-closed-sprints\", this.loadClosedSprints);\n      return this.scope.$on(\"backlog:unload-closed-sprints\", this.unloadClosedSprints);\n    };\n\n    BacklogController.prototype.initializeSubscription = function() {\n      var routingKey1, routingKey2;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.loadUserstories();\n          return _this.loadSprints();\n        };\n      })(this));\n      routingKey2 = \"changes.project.\" + this.scope.projectId + \".milestones\";\n      return this.events.subscribe(this.scope, routingKey2, (function(_this) {\n        return function(message) {\n          return _this.loadSprints();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleShowTags = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.showTags = !_this.showTags;\n          return _this.rs.userstories.storeShowTags(_this.scope.projectId, _this.showTags);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.toggleActiveFilters = function() {\n      return this.activeFilters = !this.activeFilters;\n    };\n\n    BacklogController.prototype.loadProjectStats = function() {\n      return this.rs.projects.stats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totalPoints;\n          _this.scope.stats = stats;\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          if (totalPoints) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.closed_points / totalPoints);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.showGraphPlaceholder = !((stats.total_points != null) && (stats.total_milestones != null));\n          return stats;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.unloadClosedSprints = function() {\n      return this.scope.$apply((function(_this) {\n        return function() {\n          _this.scope.closedSprints = [];\n          return _this.rootscope.$broadcast(\"closed-sprints:reloaded\", []);\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadClosedSprints = function() {\n      var params;\n      params = {\n        closed: true\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalClosedMilestones = result.closed;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.closedSprints = sprints;\n          _this.scope.closedSprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"closed-sprints:reloaded\", sprints);\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadSprints = function() {\n      var params;\n      params = {\n        closed: false\n      };\n      return this.rs.sprints.list(this.scope.projectId, params).then((function(_this) {\n        return function(result) {\n          var j, len, sprint, sprints;\n          sprints = result.milestones;\n          _this.scope.totalMilestones = sprints;\n          _this.scope.totalClosedMilestones = result.closed;\n          _this.scope.totalOpenMilestones = result.open;\n          _this.scope.totalMilestones = _this.scope.totalOpenMilestones + _this.scope.totalClosedMilestones;\n          for (j = 0, len = sprints.length; j < len; j++) {\n            sprint = sprints[j];\n            sprint.user_stories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          }\n          _this.scope.sprints = sprints;\n          _this.scope.openSprints = _.filter(sprints, function(sprint) {\n            return !sprint.closed;\n          }).reverse();\n          if (!_this.scope.closedSprints) {\n            _this.scope.closedSprints = [];\n          }\n          _this.scope.sprintsCounter = sprints.length;\n          _this.scope.sprintsById = groupBy(sprints, function(x) {\n            return x.id;\n          });\n          _this.rootscope.$broadcast(\"sprints:loaded\", sprints);\n          _this.scope.currentSprint = _this.findCurrentSprint();\n          return sprints;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.restoreFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = this.scope.oldSelectedTags;\n      selectedStatuses = this.scope.oldSelectedStatuses;\n      if (!selectedStatuses && !selectedStatuses) {\n        return;\n      }\n      this.scope.filtersQ = this.scope.filtersQOld;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = true;\n            return _this.selectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.resetFilters = function() {\n      var selectedStatuses, selectedTags;\n      selectedTags = _.filter(this.scope.filters.tags, \"selected\");\n      selectedStatuses = _.filter(this.scope.filters.status, \"selected\");\n      this.scope.oldSelectedTags = selectedTags;\n      this.scope.oldSelectedStatuses = selectedStatuses;\n      this.scope.filtersQOld = this.scope.filtersQ;\n      this.scope.filtersQ = void 0;\n      this.replaceFilter(\"q\", this.scope.filtersQ);\n      _.each([selectedTags, selectedStatuses], (function(_this) {\n        return function(filterGrp) {\n          return _.each(filterGrp, function(item) {\n            var filter, filters;\n            filters = _this.scope.filters[item.type];\n            filter = _.find(filters, {\n              id: item.id\n            });\n            filter.selected = false;\n            return _this.unselectFilter(item.type, item.id);\n          });\n        };\n      })(this));\n      return this.loadUserstories();\n    };\n\n    BacklogController.prototype.loadUserstories = function(resetPagination) {\n      var promise;\n      if (resetPagination == null) {\n        resetPagination = false;\n      }\n      this.loadingUserstories = true;\n      this.disablePagination = true;\n      this.scope.httpParams = this.getUrlFilters();\n      this.rs.userstories.storeQueryParams(this.scope.projectId, this.scope.httpParams);\n      if (resetPagination) {\n        this.page = 1;\n      }\n      this.scope.httpParams.page = this.page;\n      promise = this.rs.userstories.listUnassigned(this.scope.projectId, this.scope.httpParams);\n      return promise.then((function(_this) {\n        return function(result) {\n          var header, userstories;\n          userstories = result[0];\n          header = result[1];\n          if (resetPagination) {\n            _this.scope.userstories = [];\n          }\n          _this.scope.userstories = _this.scope.userstories.concat(_.sortBy(userstories, \"backlog_order\"));\n          _this.setSearchDataFilters();\n          _this.loadingUserstories = false;\n          if (header('x-pagination-next')) {\n            _this.disablePagination = false;\n            _this.page++;\n          }\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\");\n          });\n          return userstories;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadBacklog = function() {\n      return this.q.all([this.loadProjectStats(), this.loadSprints(), this.loadUserstories()]);\n    };\n\n    BacklogController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.closedMilestones = !!project.total_closed_milestones;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"id\");\n          return project;\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.initializeSubscription();\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadBacklog();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.generateFilters();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.scope.$emit(\"backlog:loaded\");\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    BacklogController.prototype.resortUserStories = function(uses, field) {\n      var index, item, items, j, len;\n      if (field == null) {\n        field = \"backlog_order\";\n      }\n      items = [];\n      for (index = j = 0, len = uses.length; j < len; index = ++j) {\n        item = uses[index];\n        item[field] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    BacklogController.prototype.moveUs = function(ctx, usList, newUsIndex, newSprintId) {\n      var args, data, items, j, key, l, len, len1, len2, len3, m, movedFromClosedSprint, movedToClosedSprint, n, newSprint, oldSprintId, project, promise, promises, r, sprint, us, userstories;\n      oldSprintId = usList[0].milestone;\n      project = usList[0].project;\n      movedFromClosedSprint = false;\n      movedToClosedSprint = false;\n      sprint = this.scope.sprintsById[oldSprintId];\n      if (!sprint && this.scope.closedSprintsById) {\n        sprint = this.scope.closedSprintsById[oldSprintId];\n        if (sprint) {\n          movedFromClosedSprint = true;\n        }\n      }\n      newSprint = this.scope.sprintsById[newSprintId];\n      if (!newSprint && newSprintId) {\n        newSprint = this.scope.closedSprintsById[newSprintId];\n        if (newSprint) {\n          movedToClosedSprint = true;\n        }\n      }\n      if (newSprintId === oldSprintId) {\n        items = null;\n        userstories = null;\n        if (newSprintId === null) {\n          userstories = this.scope.userstories;\n        } else {\n          userstories = newSprint.user_stories;\n        }\n        this.scope.$apply(function() {\n          var args, j, key, len, r, us;\n          for (key = j = 0, len = usList.length; j < len; key = ++j) {\n            us = usList[key];\n            r = userstories.indexOf(us);\n            userstories.splice(r, 1);\n          }\n          args = [newUsIndex, 0].concat(usList);\n          return Array.prototype.splice.apply(userstories, args);\n        });\n        if (newSprintId === null) {\n          items = this.resortUserStories(userstories, \"backlog_order\");\n          data = this.prepareBulkUpdateData(items, \"backlog_order\");\n          this.rs.userstories.bulkUpdateBacklogOrder(project, data).then((function(_this) {\n            return function() {\n              return _this.rootscope.$broadcast(\"sprint:us:moved\");\n            };\n          })(this));\n        } else {\n          items = this.resortUserStories(userstories, \"sprint_order\");\n          data = this.prepareBulkUpdateData(items, \"sprint_order\");\n          this.rs.userstories.bulkUpdateSprintOrder(project, data).then((function(_this) {\n            return function() {\n              return _this.rootscope.$broadcast(\"sprint:us:moved\");\n            };\n          })(this));\n        }\n        return promise;\n      }\n      if (newSprintId === null) {\n        for (j = 0, len = usList.length; j < len; j++) {\n          us = usList[j];\n          us.milestone = null;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var args, key, l, len1, r, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(_this.scope.userstories, args);\n            results = [];\n            for (key = l = 0, len1 = usList.length; l < len1; key = ++l) {\n              us = usList[key];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n        promise = this.repo.save(us);\n        promise = promise.then((function(_this) {\n          return function() {\n            items = _this.resortUserStories(_this.scope.userstories, \"backlog_order\");\n            data = _this.prepareBulkUpdateData(items, \"backlog_order\");\n            return _this.rs.userstories.bulkUpdateBacklogOrder(us.project, data).then(function() {\n              _this.rootscope.$broadcast(\"sprint:us:moved\");\n              if (movedFromClosedSprint) {\n                return _this.rootscope.$broadcast(\"backlog:load-closed-sprints\");\n              }\n            });\n          };\n        })(this));\n        promise.then(null, function() {\n          return console.log(\"FAIL\");\n        });\n        return promise;\n      }\n      if (oldSprintId === null) {\n        for (l = 0, len1 = usList.length; l < len1; l++) {\n          us = usList[l];\n          us.milestone = newSprintId;\n        }\n        args = [newUsIndex, 0].concat(usList);\n        Array.prototype.splice.apply(newSprint.user_stories, args);\n        for (key = m = 0, len2 = usList.length; m < len2; key = ++m) {\n          us = usList[key];\n          r = this.scope.userstories.indexOf(us);\n          this.scope.userstories.splice(r, 1);\n        }\n      } else {\n        for (n = 0, len3 = usList.length; n < len3; n++) {\n          us = usList[n];\n          us.milestone = newSprintId;\n        }\n        this.scope.$apply((function(_this) {\n          return function() {\n            var len4, o, results;\n            args = [newUsIndex, 0].concat(usList);\n            Array.prototype.splice.apply(newSprint.user_stories, args);\n            results = [];\n            for (o = 0, len4 = usList.length; o < len4; o++) {\n              us = usList[o];\n              r = sprint.user_stories.indexOf(us);\n              results.push(sprint.user_stories.splice(r, 1));\n            }\n            return results;\n          };\n        })(this));\n      }\n      promises = _.map(usList, (function(_this) {\n        return function(us) {\n          return _this.repo.save(us);\n        };\n      })(this));\n      promise = this.q.all(promises).then((function(_this) {\n        return function() {\n          items = _this.resortUserStories(newSprint.user_stories, \"sprint_order\");\n          data = _this.prepareBulkUpdateData(items, \"sprint_order\");\n          _this.rs.userstories.bulkUpdateSprintOrder(project, data).then(function(result) {\n            return _this.rootscope.$broadcast(\"sprint:us:moved\");\n          });\n          _this.rs.userstories.bulkUpdateBacklogOrder(project, data).then(function() {\n            return _this.rootscope.$broadcast(\"sprint:us:moved\");\n          });\n          if (movedToClosedSprint || movedFromClosedSprint) {\n            return _this.scope.$broadcast(\"backlog:load-closed-sprints\");\n          }\n        };\n      })(this));\n      promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n      return promise;\n    };\n\n    BacklogController.prototype.isFilterSelected = function(type, id) {\n      if ((this.searchdata[type] != null) && this.searchdata[type][id]) {\n        return true;\n      }\n      return false;\n    };\n\n    BacklogController.prototype.setSearchDataFilters = function() {\n      var name, results, urlfilters, val, value;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = this.scope.filtersQ || urlfilters.q;\n      }\n      this.searchdata = {};\n      results = [];\n      for (name in urlfilters) {\n        value = urlfilters[name];\n        if (this.searchdata[name] == null) {\n          this.searchdata[name] = {};\n        }\n        results.push((function() {\n          var j, len, ref1, results1;\n          ref1 = taiga.toString(value).split(\",\");\n          results1 = [];\n          for (j = 0, len = ref1.length; j < len; j++) {\n            val = ref1[j];\n            results1.push(this.searchdata[name][val] = true);\n          }\n          return results1;\n        }).call(this));\n      }\n      return results;\n    };\n\n    BacklogController.prototype.getUrlFilters = function() {\n      return _.pick(this.location.search(), \"status\", \"tags\", \"q\");\n    };\n\n    BacklogController.prototype.generateFilters = function() {\n      var loadFilters, urlfilters;\n      urlfilters = this.getUrlFilters();\n      this.scope.filters = {};\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.milestone = 'null';\n      return this.rs.userstories.filtersData(loadFilters).then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, selectedStatuses, selectedTags, tagsFilterFormat;\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.usStatusById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          selectedTags = _.filter(_this.scope.filters.tags, \"selected\");\n          selectedTags = _.map(selectedTags, \"id\");\n          selectedStatuses = _.filter(_this.scope.filters.status, \"selected\");\n          selectedStatuses = _.map(selectedStatuses, \"id\");\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rs.userstories.storeQueryParams(_this.scope.projectId, {\n            \"status\": selectedStatuses,\n            \"tags\": selectedTags,\n            \"project\": _this.scope.projectId,\n            \"milestone\": null\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref1, ref2, results, searchdata, val, value;\n      searchdata = {};\n      ref1 = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref1) {\n        value = ref1[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref2 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref2.length; j < len; j++) {\n          val = ref2[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var l, len1, results1;\n          results1 = [];\n          for (l = 0, len1 = value.length; l < len1; l++) {\n            obj = value[l];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    BacklogController.prototype.updateUserStoryStatus = function() {\n      this.setSearchDataFilters();\n      return this.generateFilters().then((function(_this) {\n        return function() {\n          _this.rootscope.$broadcast(\"filters:update\");\n          return _this.loadProjectStats();\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.editUserStory = function(projectId, ref, $event) {\n      var currentLoading, target;\n      target = $($event.target);\n      currentLoading = this.loading().target(target).removeClasses(\"edit-story\").timeout(200).start();\n      return this.rs.userstories.getByRef(projectId, ref).then((function(_this) {\n        return function(us) {\n          return _this.rs2.attachments.list(\"us\", us.id, projectId).then(function(attachments) {\n            _this.rootscope.$broadcast(\"usform:edit\", us, attachments.toJS());\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.deleteUserStory = function(us) {\n      var message, title;\n      title = this.translate.instant(\"US.TITLE_DELETE_ACTION\");\n      message = us.subject;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var promise;\n          _this.scope.userstories = _.without(_this.scope.userstories, us);\n          promise = _this.repo.remove(us);\n          promise.then(function() {\n            askResponse.finish();\n            return _this.q.all([_this.loadProjectStats(), _this.loadSprints()]);\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          });\n        };\n      })(this));\n    };\n\n    BacklogController.prototype.addNewUs = function(type) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, this.scope.project.default_us_status, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, this.scope.project.default_us_status);\n      }\n    };\n\n    BacklogController.prototype.addNewSprint = function() {\n      return this.rootscope.$broadcast(\"sprintform:create\", this.scope.projectId);\n    };\n\n    BacklogController.prototype.findCurrentSprint = function() {\n      var currentDate;\n      currentDate = new Date().getTime();\n      return _.find(this.scope.sprints, function(sprint) {\n        var end, start;\n        start = moment(sprint.estimated_start, 'YYYY-MM-DD').format('x');\n        end = moment(sprint.estimated_finish, 'YYYY-MM-DD').format('x');\n        return currentDate >= start && currentDate <= end;\n      });\n    };\n\n    return BacklogController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BacklogController\", BacklogController);\n\n  BacklogDirective = function($repo, $rootscope, $translate) {\n    var doomLineTemplate, link, linkDoomLine, linkFilters, linkToolbar, showHideFilter, showHideTags;\n    doomLineTemplate = _.template(\"<div class=\\\"doom-line\\\"><span><%- text %></span></div>\");\n    linkDoomLine = function($scope, $el, $attrs, $ctrl) {\n      var addDoomLineDom, getUsItems, reloadDoomLine, removeDoomlineDom;\n      reloadDoomLine = function() {\n        var current_sum, domElement, i, j, len, ref1, results, stats, total_points, us;\n        if (($scope.stats != null) && ($scope.stats.total_points != null) && $scope.stats.total_points !== 0) {\n          removeDoomlineDom();\n          stats = $scope.stats;\n          total_points = stats.total_points;\n          current_sum = stats.assigned_points;\n          if (!$scope.userstories) {\n            return;\n          }\n          ref1 = $scope.userstories;\n          results = [];\n          for (i = j = 0, len = ref1.length; j < len; i = ++j) {\n            us = ref1[i];\n            current_sum += us.total_points;\n            if (current_sum > total_points) {\n              domElement = $el.find('.backlog-table-body .us-item-row')[i];\n              addDoomLineDom(domElement);\n              break;\n            } else {\n              results.push(void 0);\n            }\n          }\n          return results;\n        }\n      };\n      removeDoomlineDom = function() {\n        return $el.find(\".doom-line\").remove();\n      };\n      addDoomLineDom = function(element) {\n        var text;\n        text = $translate.instant(\"BACKLOG.DOOMLINE\");\n        return $(element).before(doomLineTemplate({\n          \"text\": text\n        }));\n      };\n      getUsItems = function() {\n        var rowElements;\n        rowElements = $el.find('.backlog-table-body .us-item-row');\n        return _.map(rowElements, function(x) {\n          return angular.element(x);\n        });\n      };\n      $scope.$on(\"userstories:loaded\", reloadDoomLine);\n      return $scope.$watch(\"stats\", reloadDoomLine);\n    };\n    linkToolbar = function($scope, $el, $attrs, $ctrl) {\n      var checkSelected, getUsToMove, lastChecked, moveToCurrentSprint, moveToLatestSprint, moveUssToSprint, shiftPressed;\n      getUsToMove = function() {\n        var ussDom;\n        ussDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        return _.map(ussDom, function(item) {\n          var itemScope;\n          item = $(item).closest('.tg-scope');\n          itemScope = item.scope();\n          itemScope.us.milestone = $scope.sprints[0].id;\n          return itemScope.us;\n        });\n      };\n      moveUssToSprint = function(selectedUss, sprint) {\n        var extraPoints, totalExtraPoints, ussCurrent;\n        ussCurrent = _($scope.userstories);\n        $scope.userstories = ussCurrent.without.apply(ussCurrent, selectedUss).value();\n        extraPoints = _.map(selectedUss, function(v, k) {\n          return v.total_points;\n        });\n        totalExtraPoints = _.reduce(extraPoints, function(acc, num) {\n          return acc + num;\n        });\n        sprint.user_stories = _.union(sprint.user_stories, selectedUss);\n        sprint.total_points += totalExtraPoints;\n        $repo.saveAll(selectedUss).then(function() {\n          $ctrl.loadSprints();\n          return $ctrl.loadProjectStats();\n        });\n        return $el.find(\".move-to-sprint\").hide();\n      };\n      moveToCurrentSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.currentSprint);\n      };\n      moveToLatestSprint = function(selectedUss) {\n        return moveUssToSprint(selectedUss, $scope.sprints[0]);\n      };\n      shiftPressed = false;\n      lastChecked = null;\n      checkSelected = function(target) {\n        var moveToSprintDom, selectedUsDom;\n        lastChecked = target.closest(\".us-item-row\");\n        target.closest('.us-item-row').toggleClass('ui-multisortable-multiple');\n        moveToSprintDom = $el.find(\".move-to-sprint\");\n        selectedUsDom = $el.find(\".backlog-table-body input:checkbox:checked\");\n        if (selectedUsDom.length > 0 && $scope.sprints.length > 0) {\n          return moveToSprintDom.show();\n        } else {\n          return moveToSprintDom.hide();\n        }\n      };\n      $(window).on(\"keydown.shift-pressed keyup.shift-pressed\", function(event) {\n        shiftPressed = !!event.shiftKey;\n        return true;\n      });\n      $el.on(\"change\", \".backlog-table-body input:checkbox\", function(event) {\n        var current, elements, nextAll, prevAll, target;\n        if (lastChecked && shiftPressed) {\n          elements = [];\n          current = $(event.currentTarget).closest(\".us-item-row\");\n          nextAll = lastChecked.nextAll();\n          prevAll = lastChecked.prevAll();\n          if (_.some(nextAll, function(next) {\n            return next === current[0];\n          })) {\n            elements = lastChecked.nextUntil(current);\n          } else if (_.some(prevAll, function(prev) {\n            return prev === current[0];\n          })) {\n            elements = lastChecked.prevUntil(current);\n          }\n          _.map(elements, function(elm) {\n            var input;\n            input = $(elm).find(\"input:checkbox\");\n            input.prop('checked', true);\n            return checkSelected(input);\n          });\n        }\n        target = angular.element(event.currentTarget);\n        target.closest(\".us-item-row\").toggleClass('is-checked');\n        return checkSelected(target);\n      });\n      $el.on(\"click\", \"#move-to-latest-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToLatestSprint, ussToMove));\n        };\n      })(this));\n      $el.on(\"click\", \"#move-to-current-sprint\", (function(_this) {\n        return function(event) {\n          var ussToMove;\n          ussToMove = getUsToMove();\n          return $scope.$apply(_.partial(moveToCurrentSprint, ussToMove));\n        };\n      })(this));\n      return $el.on(\"click\", \"#show-tags\", function(event) {\n        event.preventDefault();\n        $ctrl.toggleShowTags();\n        return showHideTags($ctrl);\n      });\n    };\n    showHideTags = function($ctrl) {\n      var elm, text;\n      elm = angular.element(\"#show-tags\");\n      if ($ctrl.showTags) {\n        elm.addClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.HIDE\");\n        return elm.text(text);\n      } else {\n        elm.removeClass(\"active\");\n        text = $translate.instant(\"BACKLOG.TAGS.SHOW\");\n        return elm.text(text);\n      }\n    };\n    showHideFilter = function($scope, $el, $ctrl) {\n      var hideText, showText, sidebar, target;\n      sidebar = $el.find(\"sidebar.filters-bar\");\n      sidebar.one(\"transitionend\", function() {\n        return timeout(150, function() {\n          $rootscope.$broadcast(\"resize\");\n          return $('.burndown').css(\"visibility\", \"visible\");\n        });\n      });\n      target = angular.element(\"#show-filters-button\");\n      $('.burndown').css(\"visibility\", \"hidden\");\n      sidebar.toggleClass(\"active\");\n      target.toggleClass(\"active\");\n      hideText = $translate.instant(\"BACKLOG.FILTERS.HIDE\");\n      showText = $translate.instant(\"BACKLOG.FILTERS.SHOW\");\n      toggleText(target, [hideText, showText]);\n      if (!sidebar.hasClass(\"active\")) {\n        $ctrl.resetFilters();\n      } else {\n        $ctrl.restoreFilters();\n      }\n      return $ctrl.toggleActiveFilters();\n    };\n    linkFilters = function($scope, $el, $attrs, $ctrl) {\n      $scope.filtersSearch = {};\n      return $el.on(\"click\", \"#show-filters-button\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          return showHideFilter($scope, $el, $ctrl);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs, $rootscope) {\n      var $ctrl, filters;\n      $ctrl = $el.controller();\n      linkToolbar($scope, $el, $attrs, $ctrl);\n      linkFilters($scope, $el, $attrs, $ctrl);\n      linkDoomLine($scope, $el, $attrs, $ctrl);\n      filters = $ctrl.getUrlFilters();\n      if (filters.status || filters.tags || filters.q) {\n        showHideFilter($scope, $el, $ctrl);\n      }\n      $scope.$on(\"showTags\", function() {\n        return showHideTags($ctrl);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return $(window).off(\".shift-pressed\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklog\", [\"$tgRepo\", \"$rootScope\", \"$translate\", BacklogDirective]);\n\n  UsRolePointsSelectorDirective = function($rootscope, $template, $compile, $translate) {\n    var link, selectionTemplate;\n    selectionTemplate = $template.get(\"backlog/us-role-points-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      bindOnce($scope, \"project\", function(project) {\n        var numberOfRoles, roles;\n        roles = _.filter(project.roles, \"computable\");\n        numberOfRoles = _.size(roles);\n        if (numberOfRoles > 1) {\n          return $el.append($compile(selectionTemplate({\n            \"roles\": roles\n          }))($scope));\n        } else {\n          $el.find(\".icon-arrow-down\").remove();\n          return $el.find(\".header-points\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        $el.find(\".popover\").popover().close();\n        return $el.find(\".header-points\").html(roleName + \"/<span>Total</span>\");\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx, roleId) {\n        var text;\n        $el.find(\".popover\").popover().close();\n        text = $translate.instant(\"COMMON.FIELDS.POINTS\");\n        return $el.find(\".header-points\").text(text);\n      });\n      $el.on(\"click\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (target.is(\"span\") || target.is(\"div\")) {\n          event.stopPropagation();\n        }\n        return $el.find(\".popover\").popover().open();\n      });\n      $el.on(\"click\", \".clear-selection\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $rootscope.$broadcast(\"uspoints:clear-selection\");\n      });\n      $el.on(\"click\", \".role\", function(event) {\n        var rolScope, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        rolScope = target.scope();\n        return $rootscope.$broadcast(\"uspoints:select\", target.data(\"role-id\"), target.text());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUsRolePointsSelector\", [\"$rootScope\", \"$tgTemplate\", \"$compile\", \"$translate\", UsRolePointsSelectorDirective]);\n\n  UsPointsDirective = function($tgEstimationsService, $repo, $tgTemplate) {\n    var link, rolesTemplate;\n    rolesTemplate = $tgTemplate.get(\"common/estimation/us-points-roles-popover.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, bindClickElements, estimationProcess, filteringRoleId, renderRolesSelector, selectedRoleId, updatingSelectedRoleId;\n      $ctrl = $el.controller();\n      updatingSelectedRoleId = null;\n      selectedRoleId = null;\n      filteringRoleId = null;\n      estimationProcess = null;\n      $scope.$on(\"uspoints:select\", function(ctx, roleId, roleName) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = roleId;\n        return estimationProcess.render();\n      });\n      $scope.$on(\"uspoints:clear-selection\", function(ctx) {\n        var us;\n        us = $scope.$eval($attrs.tgBacklogUsPoints);\n        selectedRoleId = null;\n        return estimationProcess.render();\n      });\n      $scope.$watch($attrs.tgBacklogUsPoints, function(us) {\n        var roles;\n        if (us) {\n          estimationProcess = $tgEstimationsService.create($el, us, $scope.project);\n          roles = estimationProcess.calculateRoles();\n          if (roles.length === 0) {\n            $el.find(\".icon-arrow-bottom\").remove();\n            $el.find(\"a.us-points\").addClass(\"not-clickable\");\n          } else if (roles.length === 1) {\n            selectedRoleId = _.keys(us.points)[0];\n          }\n          if (estimationProcess.isEditable) {\n            bindClickElements();\n          }\n          estimationProcess.onSelectedPointForRole = function(roleId, pointId) {\n            return this.save(roleId, pointId).then(function() {\n              return $ctrl.loadProjectStats();\n            });\n          };\n          estimationProcess.render = function() {\n            var ctx, html, mainTemplate, pointId, pointObj, template, text, title, totalPoints;\n            totalPoints = this.calculateTotalPoints();\n            if ((selectedRoleId == null) || roles.length === 1) {\n              text = totalPoints;\n              title = totalPoints;\n            } else {\n              pointId = this.us.points[selectedRoleId];\n              pointObj = this.pointsById[pointId];\n              text = pointObj.name + \" / <span>\" + totalPoints + \"</span>\";\n              title = pointObj.name + \" / \" + totalPoints;\n            }\n            ctx = {\n              totalPoints: totalPoints,\n              roles: this.calculateRoles(),\n              editable: this.isEditable,\n              text: text,\n              title: title\n            };\n            mainTemplate = \"common/estimation/us-estimation-total.html\";\n            template = $tgTemplate.get(mainTemplate, true);\n            html = template(ctx);\n            return this.$el.html(html);\n          };\n          return estimationProcess.render();\n        }\n      });\n      renderRolesSelector = function() {\n        var html, roles;\n        roles = estimationProcess.calculateRoles();\n        html = rolesTemplate({\n          \"roles\": roles\n        });\n        $el.append(html);\n        return $el.find(\".pop-role\").popover().open(function() {\n          return $(this).remove();\n        });\n      };\n      bindClickElements = function() {\n        $el.on(\"click\", \"a.us-points\", function(event) {\n          var us;\n          event.preventDefault();\n          event.stopPropagation();\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = selectedRoleId;\n          if (selectedRoleId != null) {\n            return estimationProcess.renderPointsSelector(selectedRoleId);\n          } else {\n            return renderRolesSelector();\n          }\n        });\n        return $el.on(\"click\", \".role\", function(event) {\n          var popRolesDom, target, us;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          us = $scope.$eval($attrs.tgBacklogUsPoints);\n          updatingSelectedRoleId = target.data(\"role-id\");\n          popRolesDom = $el.find(\".pop-role\");\n          popRolesDom.find(\"a\").removeClass(\"active\");\n          popRolesDom.find(\"a[data-role-id='\" + updatingSelectedRoleId + \"']\").addClass(\"active\");\n          return estimationProcess.renderPointsSelector(updatingSelectedRoleId);\n        });\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogUsPoints\", [\"$tgEstimationsService\", \"$tgRepo\", \"$tgTemplate\", UsPointsDirective]);\n\n  ToggleBurndownVisibility = function($storage) {\n    var hide, link, show;\n    hide = function() {\n      $(\".js-burndown-graph\").removeClass(\"shown\");\n      $(\".js-toggle-burndown-visibility-button\").removeClass(\"active\");\n      return $(\".js-burndown-graph\").removeClass(\"open\");\n    };\n    show = function(firstLoad) {\n      $(\".js-toggle-burndown-visibility-button\").addClass(\"active\");\n      if (firstLoad) {\n        return $(\".js-burndown-graph\").addClass(\"shown\");\n      } else {\n        return $(\".js-burndown-graph\").addClass(\"open\");\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var firstLoad, hash, toggleGraph;\n      firstLoad = true;\n      hash = generateHash([\"is-burndown-grpahs-collapsed\"]);\n      $scope.isBurndownGraphCollapsed = $storage.get(hash) || false;\n      toggleGraph = function() {\n        if ($scope.isBurndownGraphCollapsed) {\n          hide(firstLoad);\n        } else {\n          show(firstLoad);\n        }\n        return firstLoad = false;\n      };\n      $scope.$watch(\"showGraphPlaceholder\", function() {\n        if ($scope.showGraphPlaceholder != null) {\n          $scope.isBurndownGraphCollapsed = $scope.isBurndownGraphCollapsed || $scope.showGraphPlaceholder;\n          return toggleGraph();\n        }\n      });\n      $el.on(\"click\", \".js-toggle-burndown-visibility-button\", function() {\n        $scope.isBurndownGraphCollapsed = !$scope.isBurndownGraphCollapsed;\n        $storage.set(hash, $scope.isBurndownGraphCollapsed);\n        return toggleGraph();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgToggleBurndownVisibility\", [\"$tgStorage\", ToggleBurndownVisibility]);\n\n  BurndownBacklogGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var client_increment_line, colors, data, evolution_line, j, milestonesRange, optimal_line, options, ref1, results, team_increment_line, width, zero_line;\n      width = element.width();\n      element.height(width / 6);\n      milestonesRange = (function() {\n        results = [];\n        for (var j = 0, ref1 = dataToDraw.milestones.length - 1; 0 <= ref1 ? j <= ref1 : j >= ref1; 0 <= ref1 ? j++ : j--){ results.push(j); }\n        return results;\n      }).apply(this);\n      data = [];\n      zero_line = _.map(dataToDraw.milestones, function(ml) {\n        return 0;\n      });\n      data.push({\n        data: _.zip(milestonesRange, zero_line),\n        lines: {\n          fillColor: \"rgba(0,0,0,0)\"\n        },\n        points: {\n          show: false\n        }\n      });\n      optimal_line = _.map(dataToDraw.milestones, function(ml) {\n        return ml.optimal;\n      });\n      data.push({\n        data: _.zip(milestonesRange, optimal_line),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      evolution_line = _.filter(_.map(dataToDraw.milestones, function(ml) {\n        return ml.evolution;\n      }), function(evolution) {\n        return evolution != null;\n      });\n      data.push({\n        data: _.zip(milestonesRange, evolution_line),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      client_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"] - ml[\"client-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, client_increment_line),\n        lines: {\n          fillColor: \"rgba(255,51,51,0.3)\"\n        }\n      });\n      team_increment_line = _.map(dataToDraw.milestones, function(ml) {\n        return -ml[\"team-increment\"];\n      });\n      data.push({\n        data: _.zip(milestonesRange, team_increment_line),\n        lines: {\n          fillColor: \"rgba(153,51,51,0.3)\"\n        }\n      });\n      colors = [\"rgba(0,0,0,1)\", \"rgba(120,120,120,0.2)\", \"rgba(102,153,51,1)\", \"rgba(153,51,51,1)\", \"rgba(255,51,51,1)\"];\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: \"#ccc\",\n          hoverable: true\n        },\n        xaxis: {\n          ticks: dataToDraw.milestones.length,\n          axisLabel: $translate.instant(\"BACKLOG.CHART.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5,\n          tickFormatter: function(val, axis) {\n            return \"\";\n          }\n        },\n        yaxis: {\n          axisLabel: $translate.instant(\"BACKLOG.CHART.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: \"Verdana, Arial, Helvetica, Tahoma, sans-serif\",\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: colors,\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var ctx;\n            if (flotItem.seriesIndex === 1) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.OPTIMAL\", ctx);\n            } else if (flotItem.seriesIndex === 2) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.REAL\", ctx);\n            } else if (flotItem.seriesIndex === 3) {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_CLIENT\", ctx);\n            } else {\n              ctx = {\n                sprintName: dataToDraw.milestones[xval].name,\n                value: Math.abs(yval)\n              };\n              return $translate.instant(\"BACKLOG.CHART.INCREMENT_TEAM\", ctx);\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch(\"stats\", function(value) {\n        if ($scope.stats != null) {\n          redrawChart(element, $scope.stats);\n          return $scope.$on(\"resize\", function() {\n            return redrawChart(element, $scope.stats);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBurndownBacklogGraph\", [\"$translate\", BurndownBacklogGraphDirective]);\n\n  TgBacklogProgressBarDirective = function($template, $compile) {\n    var adjustPercentaje, link, render, template;\n    template = $template.get(\"backlog/progress-bar.html\", true);\n    render = function(scope, el, projectPointsPercentaje, closedPointsPercentaje) {\n      var html;\n      html = template({\n        projectPointsPercentaje: projectPointsPercentaje,\n        closedPointsPercentaje: closedPointsPercentaje\n      });\n      html = $compile(html)(scope);\n      return el.html(html);\n    };\n    adjustPercentaje = function(percentage) {\n      var adjusted;\n      adjusted = _.max([0, percentage]);\n      adjusted = _.min([100, adjusted]);\n      return Math.round(adjusted);\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$watch($attrs.tgBacklogProgressBar, function(stats) {\n        var closedPoints, closedPointsPercentaje, definedPoints, projectPointsPercentaje, totalPoints;\n        if (stats != null) {\n          totalPoints = stats.total_points ? stats.total_points : stats.defined_points;\n          definedPoints = stats.defined_points;\n          closedPoints = stats.closed_points;\n          if (definedPoints > totalPoints) {\n            projectPointsPercentaje = totalPoints * 100 / definedPoints;\n            closedPointsPercentaje = closedPoints * 100 / definedPoints;\n          } else {\n            projectPointsPercentaje = 100;\n            closedPointsPercentaje = closedPoints * 100 / totalPoints;\n          }\n          projectPointsPercentaje = adjustPercentaje(projectPointsPercentaje - 3);\n          closedPointsPercentaje = adjustPercentaje(closedPointsPercentaje - 3);\n          return render($scope, $el, projectPointsPercentaje, closedPointsPercentaje);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogProgressBar\", [\"$tgTemplate\", \"$compile\", TgBacklogProgressBarDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sortable.coffee\n */\n\n(function() {\n  var BacklogSortableDirective, bindOnce, deleteElement, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  deleteElement = function(el) {\n    $(el).scope().$destroy();\n    $(el).off();\n    return $(el).remove();\n  };\n\n  BacklogSortableDirective = function($repo, $rs, $rootscope, $tgConfirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        var drake, filterError, initIsBacklog, scroll;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        initIsBacklog = false;\n        filterError = function() {\n          var text;\n          text = $translate.instant(\"BACKLOG.SORTABLE_FILTER_ERROR\");\n          return $tgConfirm.notify(\"error\", text);\n        };\n        drake = dragula([$el[0], $('.empty-backlog')[0]], {\n          copySortSource: false,\n          copy: false,\n          isContainer: function(el) {\n            return el.classList.contains('sprint-table');\n          },\n          moves: function(item) {\n            var parent;\n            if (!$(item).hasClass('row')) {\n              return false;\n            }\n            parent = $(item).parent();\n            initIsBacklog = parent.hasClass('backlog-table-body');\n            if (initIsBacklog && $el.hasClass(\"active-filters\")) {\n              filterError();\n              return false;\n            }\n            return true;\n          }\n        });\n        drake.on('drag', function(item, container) {\n          var isChecked, parent;\n          parent = $(item).parent();\n          initIsBacklog = parent.hasClass('backlog-table-body');\n          $(document.body).addClass(\"drag-active\");\n          isChecked = $(item).find(\"input[type='checkbox']\").is(\":checked\");\n          return window.dragMultiple.start(item, container);\n        });\n        drake.on('cloned', function(item) {\n          return $(item).addClass('backlog-us-mirror');\n        });\n        drake.on('dragend', function(item) {\n          var dragMultipleItems, firstElement, index, isBacklog, items, parent, sameContainer, sprint, usList;\n          $('.doom-line').remove();\n          parent = $(item).parent();\n          isBacklog = parent.hasClass('backlog-table-body') || parent.hasClass('empty-backlog');\n          sameContainer = initIsBacklog === isBacklog;\n          dragMultipleItems = window.dragMultiple.stop();\n          $(document.body).removeClass(\"drag-active\");\n          items = $(item).parent().find('.row');\n          sprint = null;\n          firstElement = dragMultipleItems.length ? dragMultipleItems[0] : item;\n          if (isBacklog) {\n            index = $(firstElement).index(\".backlog-table-body .row\");\n          } else {\n            index = $(firstElement).index();\n            sprint = parent.scope().sprint.id;\n          }\n          if (!sameContainer) {\n            if (dragMultipleItems.length) {\n              usList = _.map(dragMultipleItems, function(item) {\n                return item = $(item).scope().us;\n              });\n            } else {\n              usList = [$(item).scope().us];\n            }\n            if (dragMultipleItems.length) {\n              _.each(dragMultipleItems, function(item) {\n                return deleteElement(item);\n              });\n            } else {\n              deleteElement(item);\n            }\n          } else {\n            if (dragMultipleItems.length) {\n              usList = _.map(dragMultipleItems, function(item) {\n                return item = $(item).scope().us;\n              });\n            } else {\n              usList = _.map(items, function(item) {\n                var itemUs;\n                item = $(item);\n                itemUs = item.scope().us;\n                return itemUs;\n              });\n            }\n          }\n          return $scope.$emit(\"sprint:us:move\", usList, index, sprint);\n        });\n        scroll = autoScroll([window], {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgConfirm\", \"$translate\", BacklogSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/backlog/sprints.coffee\n */\n\n(function() {\n  var BacklogSprintDirective, BacklogSprintHeaderDirective, ToggleExcludeClosedSprintsVisualization, module, taiga;\n\n  taiga = this.taiga;\n\n  module = angular.module(\"taigaBacklog\");\n\n  BacklogSprintDirective = function($repo, $rootscope) {\n    var link, slideOptions, sprintTableMinHeight, toggleSprint;\n    sprintTableMinHeight = 50;\n    slideOptions = {\n      duration: 500,\n      easing: 'linear'\n    };\n    toggleSprint = (function(_this) {\n      return function($el) {\n        var sprintArrow, sprintTable;\n        sprintTable = $el.find(\".sprint-table\");\n        sprintArrow = $el.find(\".compact-sprint\");\n        sprintArrow.toggleClass('active');\n        return sprintTable.toggleClass('open');\n      };\n    })(this);\n    link = function($scope, $el, $attrs) {\n      $scope.$watch($attrs.tgBacklogSprint, function(sprint) {\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        if (sprint.closed) {\n          return $el.addClass(\"sprint-closed\");\n        } else {\n          return toggleSprint($el);\n        }\n      });\n      $el.on(\"click\", \".sprint-name > .compact-sprint\", function(event) {\n        event.preventDefault();\n        toggleSprint($el);\n        return $el.find(\".sprint-table\").slideToggle(slideOptions);\n      });\n      $el.on(\"click\", \".edit-sprint\", function(event) {\n        var sprint;\n        event.preventDefault();\n        sprint = $scope.$eval($attrs.tgBacklogSprint);\n        return $rootscope.$broadcast(\"sprintform:edit\", sprint);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogSprint\", [\"$tgRepo\", \"$rootScope\", BacklogSprintDirective]);\n\n  BacklogSprintHeaderDirective = function($navUrls, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"backlog/sprint-header.html\");\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, isVisible, prettyDate, render;\n      prettyDate = $translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_milestone\") !== -1;\n      };\n      isVisible = function() {\n        return $scope.project.my_permissions.indexOf(\"view_milestones\") !== -1;\n      };\n      render = function(sprint) {\n        var compiledTemplate, ctx, estimatedDateRange, finish, start, taskboardUrl, templateScope;\n        taskboardUrl = $navUrls.resolve(\"project-taskboard\", {\n          project: $scope.project.slug,\n          sprint: sprint.slug\n        });\n        start = moment(sprint.estimated_start).format(prettyDate);\n        finish = moment(sprint.estimated_finish).format(prettyDate);\n        estimatedDateRange = start + \"-\" + finish;\n        ctx = {\n          name: sprint.name,\n          taskboardUrl: taskboardUrl,\n          estimatedDateRange: estimatedDateRange,\n          closedPoints: sprint.closed_points || 0,\n          totalPoints: sprint.total_points || 0,\n          isVisible: isVisible(),\n          isEditable: isEditable()\n        };\n        templateScope = $scope.$new();\n        _.assign(templateScope, ctx);\n        compiledTemplate = $compile(template)(templateScope);\n        return $el.html(compiledTemplate);\n      };\n      $scope.$watch($attrs.ngModel, function(sprint) {\n        return render(sprint);\n      });\n      $scope.$on(\"sprintform:edit:success\", function() {\n        return render($model.$modelValue);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgBacklogSprintHeader\", [\"$tgNavUrls\", \"$tgTemplate\", \"$compile\", \"$translate\", BacklogSprintHeaderDirective]);\n\n  ToggleExcludeClosedSprintsVisualization = function($rootscope, $loading, $translate) {\n    var excludeClosedSprints, link;\n    excludeClosedSprints = true;\n    link = function($scope, $el, $attrs) {\n      var currentLoading, loadingElm;\n      loadingElm = $(\"<div>\");\n      $el.after(loadingElm);\n      currentLoading = null;\n      $el.on(\"click\", function(event) {\n        event.preventDefault();\n        excludeClosedSprints = !excludeClosedSprints;\n        currentLoading = $loading().target(loadingElm).start();\n        if (excludeClosedSprints) {\n          return $rootscope.$broadcast(\"backlog:unload-closed-sprints\");\n        } else {\n          return $rootscope.$broadcast(\"backlog:load-closed-sprints\");\n        }\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $scope.$on(\"closed-sprints:reloaded\", (function(_this) {\n        return function(ctx, sprints) {\n          var key, text;\n          currentLoading.finish();\n          if (sprints.length > 0) {\n            key = \"BACKLOG.SPRINTS.ACTION_HIDE_CLOSED_SPRINTS\";\n          } else {\n            key = \"BACKLOG.SPRINTS.ACTION_SHOW_CLOSED_SPRINTS\";\n          }\n          text = $translate.instant(key);\n          return $el.find(\".text\").text(text);\n        };\n      })(this));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBacklogToggleClosedSprintsVisualization\", [\"$rootScope\", \"$tgLoading\", \"$translate\", ToggleExcludeClosedSprintsVisualization]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/charts.coffee\n */\n\n(function() {\n  var SprintGraphDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  SprintGraphDirective = function($translate) {\n    var link, redrawChart;\n    redrawChart = function(element, dataToDraw) {\n      var data, days, options, width;\n      width = element.width();\n      element.height(240);\n      days = _.map(dataToDraw, function(x) {\n        return moment(x.day);\n      });\n      data = [];\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.optimal_points;\n        })),\n        lines: {\n          fillColor: \"rgba(120,120,120,0.2)\"\n        }\n      });\n      data.unshift({\n        data: _.zip(days, _.map(dataToDraw, function(d) {\n          return d.open_points;\n        })),\n        lines: {\n          fillColor: \"rgba(102,153,51,0.3)\"\n        }\n      });\n      options = {\n        grid: {\n          borderWidth: {\n            top: 0,\n            right: 1,\n            left: 0,\n            bottom: 0\n          },\n          borderColor: '#ccc',\n          hoverable: true\n        },\n        xaxis: {\n          tickSize: [1, \"day\"],\n          min: days[0],\n          max: _.last(days),\n          mode: \"time\",\n          daysNames: days,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.XAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        yaxis: {\n          min: 0,\n          axisLabel: $translate.instant(\"TASKBOARD.CHARTS.YAXIS_LABEL\"),\n          axisLabelUseCanvas: true,\n          axisLabelFontSizePixels: 12,\n          axisLabelFontFamily: 'Verdana, Arial, Helvetica, Tahoma, sans-serif',\n          axisLabelPadding: 5\n        },\n        series: {\n          shadowSize: 0,\n          lines: {\n            show: true,\n            fill: true\n          },\n          points: {\n            show: true,\n            fill: true,\n            radius: 4,\n            lineWidth: 2\n          }\n        },\n        colors: [\"rgba(102,153,51,1)\", \"rgba(120,120,120,0.2)\"],\n        tooltip: true,\n        tooltipOpts: {\n          content: function(label, xval, yval, flotItem) {\n            var formattedDate, roundedValue;\n            formattedDate = moment(xval).format($translate.instant(\"TASKBOARD.CHARTS.DATE\"));\n            roundedValue = Math.round(yval);\n            if (flotItem.seriesIndex === 1) {\n              return $translate.instant(\"TASKBOARD.CHARTS.OPTIMAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            } else {\n              return $translate.instant(\"TASKBOARD.CHARTS.REAL\", {\n                formattedDate: formattedDate,\n                roundedValue: roundedValue\n              });\n            }\n          }\n        }\n      };\n      element.empty();\n      return element.plot(data, options).data(\"plot\");\n    };\n    link = function($scope, $el, $attrs) {\n      var element;\n      element = angular.element($el);\n      $scope.$on(\"resize\", function() {\n        if ($scope.stats) {\n          return redrawChart(element, $scope.stats.days);\n        }\n      });\n      $scope.$on(\"taskboard:graph:toggle-visibility\", function() {\n        $el.parent().toggleClass('open');\n        return timeout(100, function() {\n          if ($scope.stats) {\n            return redrawChart(element, $scope.stats.days);\n          }\n        });\n      });\n      $scope.$watch('stats', function(value) {\n        if ($scope.stats == null) {\n          return;\n        }\n        return redrawChart(element, $scope.stats.days);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSprintGraph\", [\"$translate\", SprintGraphDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkTasksDirective, CreateEditTaskDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  CreateEditTaskDirective = function($repo, $model, $rs, $rootscope, $loading, lightboxService, $translate, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var attachmentsToAdd, attachmentsToDelete, createAttachments, deleteAttachments, resetAttachments, submit, submitButton;\n      $scope.isNew = true;\n      attachmentsToAdd = Immutable.List();\n      attachmentsToDelete = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return attachmentsToDelete = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      $scope.deleteAttachment = function(attachment) {\n        return attachmentsToDelete = attachmentsToDelete.push(attachment);\n      };\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.task.project, 'task');\n        });\n        return $q.all(promises);\n      };\n      deleteAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToDelete.toJS(), function(attachment) {\n          return attachmentsService[\"delete\"](\"task\", attachment.id);\n        });\n        return $q.all(promises);\n      };\n      $scope.$on(\"taskform:new\", function(ctx, sprintId, usId) {\n        var create, newTask;\n        $scope.task = {\n          project: $scope.projectId,\n          milestone: sprintId,\n          user_story: usId,\n          is_archived: false,\n          status: $scope.project.default_task_status,\n          assigned_to: null,\n          tags: []\n        };\n        $scope.isNew = true;\n        $scope.attachments = Immutable.List();\n        resetAttachments();\n        create = $translate.instant(\"COMMON.CREATE\");\n        $el.find(\".button-green\").html(create);\n        newTask = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.TITLE\");\n        $el.find(\".title\").html(newTask + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"taskform:edit\", function(ctx, task, attachments) {\n        var edit, save;\n        $scope.task = task;\n        $scope.isNew = false;\n        $scope.attachments = Immutable.fromJS(attachments);\n        resetAttachments();\n        save = $translate.instant(\"COMMON.SAVE\");\n        edit = $translate.instant(\"LIGHTBOX.CREATE_EDIT_TASK.ACTION_EDIT\");\n        $el.find(\".button-green\").html(save);\n        $el.find(\".title\").html(edit + \"  \");\n        $el.find(\".tag-input\").val(\"\");\n        return lightboxService.open($el);\n      });\n      submitButton = $el.find(\".submit-button\");\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var broadcastEvent, currentLoading, form, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.isNew) {\n            promise = $repo.create(\"tasks\", $scope.task);\n            broadcastEvent = \"taskform:new:success\";\n          } else {\n            promise = $repo.save($scope.task);\n            broadcastEvent = \"taskform:edit:success\";\n          }\n          promise.then(function(data) {\n            createAttachments(data);\n            deleteAttachments(data);\n            return data;\n          });\n          currentLoading = $loading().target(submitButton).start();\n          return promise.then(function(data) {\n            currentLoading.finish();\n            lightboxService.close($el);\n            return $rootscope.$broadcast(broadcastEvent, data);\n          });\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  CreateBulkTasksDirective = function($repo, $rs, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var submit, submitButton;\n      $scope.form = {\n        data: \"\",\n        usId: null\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, form, projectId, promise, sprintId, usId;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope.form.data;\n          projectId = $scope.projectId;\n          sprintId = $scope.form.sprintId;\n          usId = $scope.form.usId;\n          promise = $rs.tasks.bulkCreate(projectId, sprintId, usId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"taskform:bulk:success\", result);\n            return lightboxService.close($el);\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n      $scope.$on(\"taskform:bulk\", function(ctx, sprintId, usId) {\n        lightboxService.open($el);\n        return $scope.form = {\n          data: \"\",\n          sprintId: sprintId,\n          usId: usId\n        };\n      });\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaTaskboard\");\n\n  module.directive(\"tgLbCreateEditTask\", [\"$tgRepo\", \"$tgModel\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", \"$translate\", \"$q\", \"tgAttachmentsService\", CreateEditTaskDirective]);\n\n  module.directive(\"tgLbCreateBulkTasks\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkTasksDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard.coffee\n */\n\n(function() {\n  var TaskboardController, TaskboardDirective, TaskboardSquishColumnDirective, TaskboardTaskDirective, TaskboardUserDirective, bindMethods, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  toggleText = this.taiga.toggleText;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTaskboard\");\n\n  TaskboardController = (function(superClass) {\n    extend(TaskboardController, superClass);\n\n    TaskboardController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"tgAppMetaService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function TaskboardController(scope, rootscope, repo, confirm, rs1, params1, q, appMetaService, location, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.appMetaService = appMetaService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"TASKBOARD.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskboardController.prototype._setMeta = function() {\n      var description, prettyDate, title;\n      prettyDate = this.translate.instant(\"BACKLOG.SPRINTS.DATE\");\n      title = this.translate.instant(\"TASKBOARD.PAGE_TITLE\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name\n      });\n      description = this.translate.instant(\"TASKBOARD.PAGE_DESCRIPTION\", {\n        projectName: this.scope.project.name,\n        sprintName: this.scope.sprint.name,\n        startDate: moment(this.scope.sprint.estimated_start).format(prettyDate),\n        endDate: moment(this.scope.sprint.estimated_finish).format(prettyDate),\n        completedPercentage: this.scope.stats.completedPercentage || \"0\",\n        completedPoints: this.scope.stats.completedPointsSum || \"--\",\n        totalPoints: this.scope.stats.totalPointsSum || \"--\",\n        openTasks: this.scope.stats.openTasks || \"--\",\n        totalTasks: this.scope.stats.total_tasks || \"--\"\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskboardController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"taskform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"bulk create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:new:success\", (function(_this) {\n        return function() {\n          _this.loadTaskboard();\n          return _this.analytics.trackEvent(\"task\", \"create\", \"create task on taskboard\", 1);\n        };\n      })(this));\n      this.scope.$on(\"taskform:edit:success\", (function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      this.scope.$on(\"taskboard:task:move\", this.taskMove);\n      return this.scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, task) {\n          var promise;\n          task.assigned_to = userId;\n          promise = _this.repo.save(task);\n          return promise.then(null, function() {\n            return console.log(\"FAIL\");\n          });\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.initializeSubscription = function() {\n      var routingKey, routingKey1;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".tasks\";\n      this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadTaskboard();\n        };\n      })(this));\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          _this.refreshTagsColors();\n          _this.loadSprintStats();\n          return _this.loadSprint();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadProject = function() {\n      return this.rs.projects.get(this.scope.projectId).then((function(_this) {\n        return function(project) {\n          if (!project.is_backlog_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(e) {\n            return e.id;\n          });\n          _this.scope.roleById = groupBy(project.roles, function(e) {\n            return e.id;\n          });\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(e) {\n            return e.id;\n          });\n          _this.scope.$emit('project:loaded', project);\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return project;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprintStats = function() {\n      return this.rs.sprints.stats(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(stats) {\n          var completedPointsSum, remainingPointsSum, remainingTasks, totalPointsSum;\n          totalPointsSum = _.reduce(_.values(stats.total_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          completedPointsSum = _.reduce(_.values(stats.completed_points), (function(res, n) {\n            return res + n;\n          }), 0);\n          remainingPointsSum = totalPointsSum - completedPointsSum;\n          remainingTasks = stats.total_tasks - stats.completed_tasks;\n          _this.scope.stats = stats;\n          _this.scope.stats.totalPointsSum = totalPointsSum;\n          _this.scope.stats.completedPointsSum = completedPointsSum;\n          _this.scope.stats.remainingPointsSum = remainingPointsSum;\n          _this.scope.stats.remainingTasks = remainingTasks;\n          if (stats.totalPointsSum) {\n            _this.scope.stats.completedPercentage = Math.round(100 * stats.completedPointsSum / stats.totalPointsSum);\n          } else {\n            _this.scope.stats.completedPercentage = 0;\n          }\n          _this.scope.stats.openTasks = stats.total_tasks - stats.completed_tasks;\n          return stats;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadSprint = function() {\n      return this.rs.sprints.get(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(sprint) {\n          _this.scope.sprint = sprint;\n          _this.scope.userstories = _.sortBy(sprint.user_stories, \"sprint_order\");\n          return sprint;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, this.scope.sprintId).then((function(_this) {\n        return function(tasks) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, task, us, usId;\n          _this.scope.tasks = _.sortBy(tasks, 'taskboard_order');\n          _this.scope.usTasks = {};\n          ref = _.union(_this.scope.userstories, [\n            {\n              id: null\n            }\n          ]);\n          for (i = 0, len = ref.length; i < len; i++) {\n            us = ref[i];\n            _this.scope.usTasks[us.id] = {};\n            ref1 = _this.scope.taskStatusList;\n            for (j = 0, len1 = ref1.length; j < len1; j++) {\n              status = ref1[j];\n              _this.scope.usTasks[us.id][status.id] = [];\n            }\n          }\n          ref2 = _this.scope.tasks;\n          for (k = 0, len2 = ref2.length; k < len2; k++) {\n            task = ref2[k];\n            if ((_this.scope.usTasks[task.user_story] != null) && (_this.scope.usTasks[task.user_story][task.status] != null)) {\n              _this.scope.usTasks[task.user_story][task.status].push(task);\n            }\n          }\n          if (tasks.length === 0) {\n            if (_this.scope.userstories.length > 0) {\n              usId = _this.scope.userstories[0].id;\n            } else {\n              usId = null;\n            }\n            _this.scope.usTasks[usId][_this.scope.taskStatusList[0].id].push({\n              isPlaceholder: true\n            });\n          }\n          return tasks;\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.loadTaskboard = function() {\n      return this.q.all([\n        this.refreshTagsColors(), this.loadSprintStats(), this.loadSprint().then((function(_this) {\n          return function() {\n            return _this.loadTasks();\n          };\n        })(this))\n      ]);\n    };\n\n    TaskboardController.prototype.loadInitialData = function() {\n      var params, promise;\n      params = {\n        pslug: this.params.pslug,\n        sslug: this.params.sslug\n      };\n      promise = this.repo.resolve(params).then((function(_this) {\n        return function(data) {\n          _this.scope.projectId = data.project;\n          _this.scope.sprintId = data.milestone;\n          _this.initializeSubscription();\n          return data;\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function() {\n          return _this.loadProject();\n        };\n      })(this)).then((function(_this) {\n        return function() {\n          return _this.loadTaskboard();\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.refreshTasksOrder = function(tasks) {\n      var data, items;\n      items = this.resortTasks(tasks);\n      data = this.prepareBulkUpdateData(items);\n      return this.rs.tasks.bulkUpdateTaskTaskboardOrder(this.scope.project.id, data);\n    };\n\n    TaskboardController.prototype.resortTasks = function(tasks) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = tasks.length; i < len; index = ++i) {\n        item = tasks[index];\n        item[\"taskboard_order\"] = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    TaskboardController.prototype.prepareBulkUpdateData = function(uses) {\n      return _.map(uses, function(x) {\n        return {\n          \"task_id\": x.id,\n          \"order\": x[\"taskboard_order\"]\n        };\n      });\n    };\n\n    TaskboardController.prototype.taskMove = function(ctx, task, usId, statusId, order) {\n      var promise, r, tasks;\n      r = this.scope.usTasks[task.user_story][task.status].indexOf(task);\n      this.scope.usTasks[task.user_story][task.status].splice(r, 1);\n      tasks = this.scope.usTasks[usId][statusId];\n      tasks.splice(order, 0, task);\n      task.user_story = usId;\n      task.status = statusId;\n      task.taskboard_order = order;\n      promise = this.repo.save(task);\n      this.rootscope.$broadcast(\"sprint:task:moved\", task);\n      promise.then((function(_this) {\n        return function() {\n          _this.refreshTasksOrder(tasks);\n          return _this.loadSprintStats();\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function() {\n          return console.log(\"FAIL TASK SAVE\");\n        };\n      })(this));\n    };\n\n    TaskboardController.prototype.addNewTask = function(type, us) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"taskform:new\", this.scope.sprintId, us != null ? us.id : void 0);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"taskform:bulk\", this.scope.sprintId, us != null ? us.id : void 0);\n      }\n    };\n\n    TaskboardController.prototype.editTaskAssignedTo = function(task) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", task);\n    };\n\n    return TaskboardController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskboardController\", TaskboardController);\n\n  TaskboardDirective = function($rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, tableBodyDom;\n      $ctrl = $el.controller();\n      $el.on(\"click\", \".toggle-analytics-visibility\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass('active');\n        return $rootscope.$broadcast(\"taskboard:graph:toggle-visibility\");\n      });\n      tableBodyDom = $el.find(\".taskboard-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".taskboard-table-header .taskboard-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboard\", [\"$rootScope\", TaskboardDirective]);\n\n  TaskboardTaskDirective = function($rootscope, $loading, $rs, $rs2) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch(\"task\", function(task) {\n        if (task.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!task.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      return $el.find(\".edit-task\").on(\"click\", function(event) {\n        if ($el.find('.edit-task').hasClass('noclick')) {\n          return;\n        }\n        return $scope.$apply(function() {\n          var currentLoading, target, task;\n          target = $(event.target);\n          currentLoading = $loading().target(target).timeout(200).start();\n          task = $scope.task;\n          return $rs.tasks.getByRef(task.project, task.ref).then((function(_this) {\n            return function(editingTask) {\n              return $rs2.attachments.list(\"task\", editingTask.id, editingTask.project).then(function(attachments) {\n                $rootscope.$broadcast(\"taskform:edit\", editingTask, attachments.toJS());\n                return currentLoading.finish();\n              });\n            };\n          })(this));\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardTask\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", \"tgResources\", TaskboardTaskDirective]);\n\n  TaskboardSquishColumnDirective = function(rs) {\n    var avatarWidth, link, maxColumnWidth;\n    avatarWidth = 40;\n    maxColumnWidth = 300;\n    link = function($scope, $el, $attrs) {\n      var getCeilWidth, recalculateStatusColumnWidth, recalculateTaskboardWidth, refreshTaskboardTableWidth, setStatusColumnWidth;\n      $scope.$on(\"sprint:task:moved\", (function(_this) {\n        return function() {\n          return recalculateTaskboardWidth();\n        };\n      })(this));\n      bindOnce($scope, \"usTasks\", function(project) {\n        $scope.statusesFolded = rs.tasks.getStatusColumnModes($scope.project.id);\n        $scope.usFolded = rs.tasks.getUsRowModes($scope.project.id, $scope.sprintId);\n        return recalculateTaskboardWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.statusesFolded[status.id] = !!!$scope.statusesFolded[status.id];\n        rs.tasks.storeStatusColumnModes($scope.projectId, $scope.statusesFolded);\n        return recalculateTaskboardWidth();\n      };\n      $scope.foldUs = function(us) {\n        if (!us) {\n          $scope.usFolded[null] = !!!$scope.usFolded[null];\n        } else {\n          $scope.usFolded[us.id] = !!!$scope.usFolded[us.id];\n        }\n        rs.tasks.storeUsRowModes($scope.projectId, $scope.sprintId, $scope.usFolded);\n        return recalculateTaskboardWidth();\n      };\n      getCeilWidth = (function(_this) {\n        return function(usId, statusId) {\n          var tasks, tasksMatrixSize, width;\n          tasks = $scope.usTasks[usId][statusId].length;\n          if ($scope.statusesFolded[statusId]) {\n            if (tasks && $scope.usFolded[usId]) {\n              tasksMatrixSize = Math.round(Math.sqrt(tasks));\n              width = avatarWidth * tasksMatrixSize;\n            } else {\n              width = avatarWidth;\n            }\n            return width;\n          }\n          return 0;\n        };\n      })(this);\n      setStatusColumnWidth = (function(_this) {\n        return function(statusId, width) {\n          var column;\n          column = $el.find(\".squish-status-\" + statusId);\n          if (width) {\n            return column.css('max-width', width);\n          } else {\n            return column.css(\"max-width\", maxColumnWidth);\n          }\n        };\n      })(this);\n      refreshTaskboardTableWidth = (function(_this) {\n        return function() {\n          var columnWidths, columns, totalWidth;\n          columnWidths = [];\n          columns = $el.find(\".task-colum-name\");\n          columnWidths = _.map(columns, function(column) {\n            return $(column).outerWidth(true);\n          });\n          totalWidth = _.reduce(columnWidths, function(total, width) {\n            return total + width;\n          });\n          return $el.find('.taskboard-table-inner').css(\"width\", totalWidth);\n        };\n      })(this);\n      recalculateStatusColumnWidth = (function(_this) {\n        return function(statusId) {\n          var statusFoldedWidth;\n          statusFoldedWidth = getCeilWidth(null, statusId);\n          _.forEach($scope.userstories, function(us) {\n            var width;\n            width = getCeilWidth(us.id, statusId);\n            if (width > statusFoldedWidth) {\n              return statusFoldedWidth = width;\n            }\n          });\n          return setStatusColumnWidth(statusId, statusFoldedWidth);\n        };\n      })(this);\n      return recalculateTaskboardWidth = (function(_this) {\n        return function() {\n          _.forEach($scope.taskStatusList, function(status) {\n            return recalculateStatusColumnWidth(status.id);\n          });\n          refreshTaskboardTableWidth();\n        };\n      })(this);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSquishColumn\", [\"$tgResources\", TaskboardSquishColumnDirective]);\n\n  TaskboardUserDirective = function($log, $translate) {\n    var clickable, link;\n    clickable = false;\n    link = function($scope, $el, $attrs) {\n      var username_label;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      $scope.$watch('task.assigned_to', function(assigned_to) {\n        var user;\n        user = $scope.usersById[assigned_to];\n        if (user === void 0) {\n          _.assign($scope, {\n            name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          });\n        } else {\n          _.assign($scope, {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          });\n        }\n        return username_label.text($scope.name);\n      });\n      return bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_task\") > -1) {\n          clickable = true;\n          $el.find(\".avatar-assigned-to\").on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl;\n              if ($el.find('a').hasClass('noclick')) {\n                return;\n              }\n              $ctrl = $el.controller();\n              return $ctrl.editTaskAssignedTo($scope.task);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl;\n            if ($el.find('a').hasClass('noclick')) {\n              return;\n            }\n            $ctrl = $el.controller();\n            return $ctrl.editTaskAssignedTo($scope.task);\n          });\n        }\n      });\n    };\n    return {\n      link: link,\n      templateUrl: \"taskboard/taskboard-user.html\",\n      scope: {\n        \"usersById\": \"=users\",\n        \"project\": \"=\",\n        \"task\": \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgTaskboardUserAvatar\", [\"$log\", \"$translate\", TaskboardUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/taskboard/sortable.coffee\n */\n\n(function() {\n  var TaskboardSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  module = angular.module(\"taigaBacklog\");\n\n  TaskboardSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"tasks\", function(xx) {\n        var containers, deleteElement, drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n        if (!($scope.project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        containers = _.map($el.find('.task-column'), function(item) {\n          return item;\n        });\n        drake = dragula(containers, {\n          copySortSource: false,\n          copy: false,\n          mirrorContainer: $el[0],\n          moves: function(item) {\n            return $(item).hasClass('taskboard-task');\n          }\n        });\n        drake.on('drag', function(item) {\n          return oldParentScope = $(item).parent().scope();\n        });\n        drake.on('dragend', function(item) {\n          var itemIndex, itemTask, newStatusId, newUsId, oldStatusId, oldUsId, parentEl;\n          parentEl = $(item).parent();\n          itemEl = $(item);\n          itemTask = itemEl.scope().task;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          oldUsId = oldParentScope.us ? oldParentScope.us.id : null;\n          oldStatusId = oldParentScope.st.id;\n          newUsId = newParentScope.us ? newParentScope.us.id : null;\n          newStatusId = newParentScope.st.id;\n          if (newStatusId !== oldStatusId || newUsId !== oldUsId) {\n            deleteElement(itemEl);\n          }\n          return $scope.$apply(function() {\n            return $rootscope.$broadcast(\"taskboard:task:move\", itemTask, newUsId, newStatusId, itemIndex);\n          });\n        });\n        scroll = autoScroll(containers, {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgTaskboardSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", TaskboardSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/main.coffee\n */\n\n(function() {\n  var KanbanArchivedStatusHeaderDirective, KanbanArchivedStatusIntroDirective, KanbanController, KanbanDirective, KanbanSquishColumnDirective, KanbanUserDirective, KanbanUserstoryDirective, KanbanWipLimitDirective, bindMethods, bindOnce, defaultViewMode, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText, viewModes,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaKanban\");\n\n  defaultViewMode = \"maximized\";\n\n  viewModes = [\"maximized\", \"minimized\"];\n\n  KanbanController = (function(superClass) {\n    extend(KanbanController, superClass);\n\n    KanbanController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function KanbanController(scope, rootscope, repo, confirm, rs1, params1, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.params = params1;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"KANBAN.SECTION_NAME\");\n      this.scope.statusViewModes = {};\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"KANBAN.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"KANBAN.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    KanbanController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"usform:new:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          _this.refreshTagsColors();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:bulk:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.analytics.trackEvent(\"userstory\", \"create\", \"bulk create userstory on kanban\", 1);\n        };\n      })(this));\n      this.scope.$on(\"usform:edit:success\", (function(_this) {\n        return function() {\n          _this.loadUserstories();\n          return _this.refreshTagsColors();\n        };\n      })(this));\n      this.scope.$on(\"assigned-to:added\", this.onAssignedToChanged);\n      this.scope.$on(\"kanban:us:move\", this.moveUs);\n      this.scope.$on(\"kanban:show-userstories-for-status\", this.loadUserStoriesForStatus);\n      return this.scope.$on(\"kanban:hide-userstories-for-status\", this.hideUserStoriesForStatus);\n    };\n\n    KanbanController.prototype.addNewUs = function(type, statusId) {\n      switch (type) {\n        case \"standard\":\n          return this.rootscope.$broadcast(\"usform:new\", this.scope.projectId, statusId, this.scope.usStatusList);\n        case \"bulk\":\n          return this.rootscope.$broadcast(\"usform:bulk\", this.scope.projectId, statusId);\n      }\n    };\n\n    KanbanController.prototype.changeUsAssignedTo = function(us) {\n      return this.rootscope.$broadcast(\"assigned-to:add\", us);\n    };\n\n    KanbanController.prototype.onAssignedToChanged = function(ctx, userid, us) {\n      var promise;\n      us.assigned_to = userid;\n      promise = this.repo.save(us);\n      return promise.then(null, function() {\n        return console.log(\"FAIL\");\n      });\n    };\n\n    KanbanController.prototype.refreshTagsColors = function() {\n      return this.rs.projects.tagsColors(this.scope.projectId).then((function(_this) {\n        return function(tags_colors) {\n          return _this.scope.project.tags_colors = tags_colors;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadUserstories = function() {\n      var params, promise;\n      params = {\n        status__is_archived: false\n      };\n      promise = this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          var i, j, k, len, len1, len2, ref, ref1, ref2, status, us, usByStatus, us_archived;\n          _this.scope.userstories = userstories;\n          usByStatus = _.groupBy(userstories, \"status\");\n          us_archived = [];\n          ref = _this.scope.usStatusList;\n          for (i = 0, len = ref.length; i < len; i++) {\n            status = ref[i];\n            if (usByStatus[status.id] == null) {\n              usByStatus[status.id] = [];\n            }\n            if (_this.scope.usByStatus != null) {\n              ref1 = _this.scope.usByStatus[status.id];\n              for (j = 0, len1 = ref1.length; j < len1; j++) {\n                us = ref1[j];\n                if (us.status !== status.id) {\n                  us_archived.push(us);\n                }\n              }\n            }\n            if (status.is_archived && (_this.scope.usByStatus != null) && _this.scope.usByStatus[status.id].length !== 0) {\n              ref2 = _this.scope.usByStatus[status.id].concat(us_archived);\n              for (k = 0, len2 = ref2.length; k < len2; k++) {\n                us = ref2[k];\n                if (us.status === status.id) {\n                  usByStatus[status.id].push(us);\n                }\n              }\n            }\n            usByStatus[status.id] = _.sortBy(usByStatus[status.id], \"kanban_order\");\n          }\n          if (userstories.length === 0) {\n            status = _this.scope.usStatusList[0];\n            usByStatus[status.id].push({\n              isPlaceholder: true\n            });\n          }\n          _this.scope.usByStatus = usByStatus;\n          scopeDefer(_this.scope, function() {\n            return _this.scope.$broadcast(\"userstories:loaded\", userstories);\n          });\n          return userstories;\n        };\n      })(this));\n      promise.then((function(_this) {\n        return function() {\n          return _this.scope.$broadcast(\"redraw:wip\");\n        };\n      })(this));\n      return promise;\n    };\n\n    KanbanController.prototype.loadUserStoriesForStatus = function(ctx, statusId) {\n      var params;\n      params = {\n        status: statusId\n      };\n      return this.rs.userstories.listAll(this.scope.projectId, params).then((function(_this) {\n        return function(userstories) {\n          _this.scope.usByStatus[statusId] = _.sortBy(userstories, \"kanban_order\");\n          _this.scope.$broadcast(\"kanban:shown-userstories-for-status\", statusId, userstories);\n          return userstories;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.hideUserStoriesForStatus = function(ctx, statusId) {\n      this.scope.usByStatus[statusId] = [];\n      return this.scope.$broadcast(\"kanban:hidden-userstories-for-status\", statusId);\n    };\n\n    KanbanController.prototype.loadKanban = function() {\n      return this.q.all([this.refreshTagsColors(), this.loadUserstories()]);\n    };\n\n    KanbanController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_kanban_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.projectId = project.id;\n          _this.scope.points = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(project.points, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.generateStatusViewModes();\n          _this.scope.$emit(\"project:loaded\", project);\n          return project;\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.initializeSubscription = function() {\n      var routingKey1;\n      routingKey1 = \"changes.project.\" + this.scope.projectId + \".userstories\";\n      return this.events.subscribe(this.scope, routingKey1, (function(_this) {\n        return function(message) {\n          return _this.loadUserstories();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          return _this.loadKanban();\n        };\n      })(this));\n    };\n\n    KanbanController.prototype.generateStatusViewModes = function() {\n      var i, len, mode, ref, status, storedStatusViewModes;\n      storedStatusViewModes = this.rs.kanban.getStatusViewModes(this.scope.projectId);\n      this.scope.statusViewModes = {};\n      ref = this.scope.usStatusList;\n      for (i = 0, len = ref.length; i < len; i++) {\n        status = ref[i];\n        mode = storedStatusViewModes[status.id] || defaultViewMode;\n        this.scope.statusViewModes[status.id] = mode;\n      }\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.storeStatusViewModes = function() {\n      return this.rs.kanban.storeStatusViewModes(this.scope.projectId, this.scope.statusViewModes);\n    };\n\n    KanbanController.prototype.updateStatusViewMode = function(statusId, newViewMode) {\n      this.scope.statusViewModes[statusId] = newViewMode;\n      return this.storeStatusViewModes();\n    };\n\n    KanbanController.prototype.isMaximized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'maximized';\n    };\n\n    KanbanController.prototype.isMinimized = function(statusId) {\n      var mode;\n      mode = this.scope.statusViewModes[statusId] || defaultViewMode;\n      return mode === 'minimized';\n    };\n\n    KanbanController.prototype.prepareBulkUpdateData = function(uses, field) {\n      if (field == null) {\n        field = \"kanban_order\";\n      }\n      return _.map(uses, function(x) {\n        return {\n          \"us_id\": x.id,\n          \"order\": x[field]\n        };\n      });\n    };\n\n    KanbanController.prototype.resortUserStories = function(uses) {\n      var i, index, item, items, len;\n      items = [];\n      for (index = i = 0, len = uses.length; i < len; index = ++i) {\n        item = uses[index];\n        item.kanban_order = index;\n        if (item.isModified()) {\n          items.push(item);\n        }\n      }\n      return items;\n    };\n\n    KanbanController.prototype.moveUs = function(ctx, us, oldStatusId, newStatusId, index) {\n      var itemsToSave, promise, r;\n      if (oldStatusId !== newStatusId) {\n        r = this.scope.usByStatus[oldStatusId].indexOf(us);\n        this.scope.usByStatus[oldStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n        us.status = newStatusId;\n      } else {\n        r = this.scope.usByStatus[newStatusId].indexOf(us);\n        this.scope.usByStatus[newStatusId].splice(r, 1);\n        this.scope.usByStatus[newStatusId].splice(index, 0, us);\n      }\n      itemsToSave = this.resortUserStories(this.scope.usByStatus[newStatusId]);\n      this.scope.usByStatus[newStatusId] = _.sortBy(this.scope.usByStatus[newStatusId], \"kanban_order\");\n      promise = this.repo.save(us);\n      promise = promise.then((function(_this) {\n        return function() {\n          var data;\n          itemsToSave = _.reject(itemsToSave, {\n            \"id\": us.id\n          });\n          data = _this.prepareBulkUpdateData(itemsToSave);\n          return _this.rs.userstories.bulkUpdateKanbanOrder(us.project, data).then(function() {\n            return itemsToSave;\n          });\n        };\n      })(this));\n      return promise;\n    };\n\n    return KanbanController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"KanbanController\", KanbanController);\n\n  KanbanDirective = function($repo, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var tableBodyDom;\n      tableBodyDom = $el.find(\".kanban-table-body\");\n      tableBodyDom.on(\"scroll\", function(event) {\n        var tableHeaderDom, target;\n        target = angular.element(event.currentTarget);\n        tableHeaderDom = $el.find(\".kanban-table-header .kanban-table-inner\");\n        return tableHeaderDom.css(\"left\", -1 * target.scrollLeft());\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanban\", [\"$tgRepo\", \"$rootScope\", KanbanDirective]);\n\n  KanbanArchivedStatusHeaderDirective = function($rootscope, $translate) {\n    var hideArchivedText, link, showArchivedText;\n    showArchivedText = $translate.instant(\"KANBAN.ACTION_SHOW_ARCHIVED\");\n    hideArchivedText = $translate.instant(\"KANBAN.ACTION_HIDE_ARCHIVED\");\n    link = function($scope, $el, $attrs) {\n      var hidden, status;\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusHeader);\n      hidden = true;\n      $scope[\"class\"] = \"icon-watch\";\n      $scope.title = showArchivedText;\n      $el.on(\"click\", function(event) {\n        hidden = !hidden;\n        return $scope.$apply(function() {\n          if (hidden) {\n            $scope[\"class\"] = \"icon-watch\";\n            $scope.title = showArchivedText;\n            return $rootscope.$broadcast(\"kanban:hide-userstories-for-status\", status.id);\n          } else {\n            $scope[\"class\"] = \"icon-unwatch\";\n            $scope.title = hideArchivedText;\n            return $rootscope.$broadcast(\"kanban:show-userstories-for-status\", status.id);\n          }\n        });\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusHeader\", [\"$rootScope\", \"$translate\", KanbanArchivedStatusHeaderDirective]);\n\n  KanbanArchivedStatusIntroDirective = function($translate) {\n    var link, userStories;\n    userStories = [];\n    link = function($scope, $el, $attrs) {\n      var hiddenUserStoriexText, status, updateIntroText;\n      hiddenUserStoriexText = $translate.instant(\"KANBAN.HIDDEN_USER_STORIES\");\n      status = $scope.$eval($attrs.tgKanbanArchivedStatusIntro);\n      $el.text(hiddenUserStoriexText);\n      updateIntroText = function() {\n        if (userStories.length > 0) {\n          return $el.text(\"\");\n        } else {\n          return $el.text(hiddenUserStoriexText);\n        }\n      };\n      $scope.$on(\"kanban:us:move\", function(ctx, itemUs, oldStatusId, newStatusId, itemIndex) {\n        var r;\n        if (status.id === newStatusId) {\n          if (status.id === oldStatusId) {\n            r = userStories.indexOf(itemUs);\n            userStories.splice(r, 1);\n            userStories.splice(itemIndex, 0, itemUs);\n          } else {\n            itemUs.isArchived = true;\n            userStories.splice(itemIndex, 0, itemUs);\n          }\n        } else if (status.id === oldStatusId) {\n          itemUs.isArchived = false;\n          r = userStories.indexOf(itemUs);\n          userStories.splice(r, 1);\n        }\n        return updateIntroText();\n      });\n      $scope.$on(\"kanban:shown-userstories-for-status\", function(ctx, statusId, userStoriesLoaded) {\n        if (statusId === status.id) {\n          userStories = _.filter(userStoriesLoaded, function(us) {\n            return us.status === status.id;\n          });\n          return updateIntroText();\n        }\n      });\n      $scope.$on(\"kanban:hidden-userstories-for-status\", function(ctx, statusId) {\n        if (statusId === status.id) {\n          userStories = [];\n          return updateIntroText();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanArchivedStatusIntro\", [\"$translate\", KanbanArchivedStatusIntroDirective]);\n\n  KanbanUserstoryDirective = function($rootscope, $loading, $rs, $rs2) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      $scope.$watch(\"us\", function(us) {\n        if (us.is_blocked && !$el.hasClass(\"blocked\")) {\n          return $el.addClass(\"blocked\");\n        } else if (!us.is_blocked && $el.hasClass(\"blocked\")) {\n          return $el.removeClass(\"blocked\");\n        }\n      });\n      $el.on('click', '.edit-us', function(event) {\n        var currentLoading, target, us;\n        if ($el.find(\".icon-edit\").hasClass(\"noclick\")) {\n          return;\n        }\n        target = $(event.target);\n        currentLoading = $loading().target(target).timeout(200).removeClasses(\"icon-edit\").start();\n        us = $model.$modelValue;\n        return $rs.userstories.getByRef(us.project, us.ref).then((function(_this) {\n          return function(editingUserStory) {\n            return $rs2.attachments.list(\"us\", us.id, us.project).then(function(attachments) {\n              $rootscope.$broadcast(\"usform:edit\", editingUserStory, attachments.toJS());\n              return currentLoading.finish();\n            });\n          };\n        })(this));\n      });\n      $scope.getTemplateUrl = function() {\n        if ($scope.us.isPlaceholder) {\n          return \"common/components/kanban-placeholder.html\";\n        } else {\n          return \"kanban/kanban-task.html\";\n        }\n      };\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      template: '<ng-include src=\"getTemplateUrl()\"/>',\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserstory\", [\"$rootScope\", \"$tgLoading\", \"$tgResources\", \"tgResources\", KanbanUserstoryDirective]);\n\n  KanbanSquishColumnDirective = function(rs) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var updateTableWidth;\n      $scope.$on(\"project:loaded\", function(event, project) {\n        $scope.folds = rs.kanban.getStatusColumnModes(project.id);\n        return updateTableWidth();\n      });\n      $scope.foldStatus = function(status) {\n        $scope.folds[status.id] = !!!$scope.folds[status.id];\n        rs.kanban.storeStatusColumnModes($scope.projectId, $scope.folds);\n        updateTableWidth();\n      };\n      return updateTableWidth = function() {\n        var columnWidths, totalWidth;\n        columnWidths = _.map($scope.usStatusList, function(status) {\n          if ($scope.folds[status.id]) {\n            return 40;\n          } else {\n            return 310;\n          }\n        });\n        totalWidth = _.reduce(columnWidths, function(total, width) {\n          return total + width;\n        });\n        return $el.find('.kanban-table-inner').css(\"width\", totalWidth);\n      };\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSquishColumn\", [\"$tgResources\", KanbanSquishColumnDirective]);\n\n  KanbanWipLimitDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var redrawWipLimit, status;\n      status = $scope.$eval($attrs.tgKanbanWipLimit);\n      redrawWipLimit = (function(_this) {\n        return function() {\n          $el.find(\".kanban-wip-limit\").remove();\n          return timeout(200, function() {\n            var element;\n            element = $el.find(\".kanban-task\")[status.wip_limit];\n            if (element) {\n              return angular.element(element).before(\"<div class='kanban-wip-limit'></div>\");\n            }\n          });\n        };\n      })(this);\n      if (status && !status.is_archived) {\n        $scope.$on(\"redraw:wip\", redrawWipLimit);\n        $scope.$on(\"kanban:us:move\", redrawWipLimit);\n        $scope.$on(\"usform:new:success\", redrawWipLimit);\n        $scope.$on(\"usform:bulk:success\", redrawWipLimit);\n      }\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanWipLimit\", KanbanWipLimitDirective);\n\n  KanbanUserDirective = function($log, $compile, $translate) {\n    var clickable, link, template;\n    template = _.template(\"<figure class=\\\"avatar\\\">\\n    <a href=\\\"#\\\" title=\\\"{{'US.ASSIGN' | translate}}\\\" <% if (!clickable) {%>class=\\\"not-clickable\\\"<% } %>>\\n        <img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\" class=\\\"avatar\\\">\\n    </a>\\n</figure>\");\n    clickable = false;\n    link = function($scope, $el, $attrs, $model) {\n      var render, username_label, wtid;\n      username_label = $el.parent().find(\"a.task-assigned\");\n      username_label.addClass(\"not-clickable\");\n      if (!$attrs.tgKanbanUserAvatar) {\n        return $log.error(\"KanbanUserDirective: no attr is defined\");\n      }\n      wtid = $scope.$watch($attrs.tgKanbanUserAvatar, function(v) {\n        var user;\n        if ($scope.usersById == null) {\n          $log.error(\"KanbanUserDirective requires userById set in scope.\");\n          return wtid();\n        } else {\n          user = $scope.usersById[v];\n          return render(user);\n        }\n      });\n      render = function(user) {\n        var ctx, html;\n        if (user === void 0) {\n          ctx = {\n            name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n            imgurl: \"/\" + window._version + \"/images/unnamed.png\",\n            clickable: clickable\n          };\n        } else {\n          ctx = {\n            name: user.full_name_display,\n            imgurl: user.photo,\n            clickable: clickable\n          };\n        }\n        html = $compile(template(ctx))($scope);\n        $el.html(html);\n        return username_label.text(ctx.name);\n      };\n      bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_us\") > -1) {\n          clickable = true;\n          $el.on(\"click\", (function(_this) {\n            return function(event) {\n              var $ctrl, us;\n              if ($el.find(\"a\").hasClass(\"noclick\")) {\n                return;\n              }\n              us = $model.$modelValue;\n              $ctrl = $el.controller();\n              return $ctrl.changeUsAssignedTo(us);\n            };\n          })(this));\n          username_label.removeClass(\"not-clickable\");\n          return username_label.on(\"click\", function(event) {\n            var $ctrl, us;\n            if ($el.find(\"a\").hasClass(\"noclick\")) {\n              return;\n            }\n            us = $model.$modelValue;\n            $ctrl = $el.controller();\n            return $ctrl.changeUsAssignedTo(us);\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgKanbanUserAvatar\", [\"$log\", \"$compile\", \"$translate\", KanbanUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/kanban/sortable.coffee\n */\n\n(function() {\n  var KanbanSortableDirective, bindOnce, groupBy, mixOf, module, scopeDefer, taiga, timeout, toggleText;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toggleText = this.taiga.toggleText;\n\n  scopeDefer = this.taiga.scopeDefer;\n\n  bindOnce = this.taiga.bindOnce;\n\n  groupBy = this.taiga.groupBy;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaKanban\");\n\n  KanbanSortableDirective = function($repo, $rs, $rootscope) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, \"project\", function(project) {\n        var containers, deleteElement, drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n        if (!(project.my_permissions.indexOf(\"modify_us\") > -1)) {\n          return;\n        }\n        oldParentScope = null;\n        newParentScope = null;\n        itemEl = null;\n        tdom = $el;\n        deleteElement = function(itemEl) {\n          itemEl.scope().$destroy();\n          itemEl.off();\n          return itemEl.remove();\n        };\n        containers = _.map($el.find('.task-column'), function(item) {\n          return item;\n        });\n        drake = dragula(containers, {\n          copySortSource: false,\n          copy: false,\n          mirrorContainer: tdom[0],\n          moves: function(item) {\n            return $(item).hasClass('kanban-task');\n          }\n        });\n        drake.on('drag', function(item) {\n          return oldParentScope = $(item).parent().scope();\n        });\n        drake.on('dragend', function(item) {\n          var itemIndex, itemUs, newStatusId, oldStatusId, parentEl;\n          parentEl = $(item).parent();\n          itemEl = $(item);\n          itemUs = itemEl.scope().us;\n          itemIndex = itemEl.index();\n          newParentScope = parentEl.scope();\n          newStatusId = newParentScope.s.id;\n          oldStatusId = oldParentScope.s.id;\n          if (newStatusId !== oldStatusId) {\n            deleteElement(itemEl);\n          }\n          return $scope.$apply(function() {\n            return $rootscope.$broadcast(\"kanban:us:move\", itemUs, itemUs.status, newStatusId, itemIndex);\n          });\n        });\n        scroll = autoScroll(containers, {\n          margin: 20,\n          pixels: 30,\n          scrollWhenOutside: true,\n          autoScroll: function() {\n            return this.down && drake.dragging;\n          }\n        });\n        return $scope.$on(\"$destroy\", function() {\n          $el.off();\n          return drake.destroy();\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgKanbanSortable\", [\"$tgRepo\", \"$tgResources\", \"$rootScope\", KanbanSortableDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/detail.coffee\n */\n\n(function() {\n  var IssueDetailController, IssuePriorityButtonDirective, IssueSeverityButtonDirective, IssueStatusButtonDirective, IssueStatusDisplayDirective, IssueTypeButtonDirective, PromoteIssueToUsButtonDirective, bindMethods, bindOnce, groupBy, joinStr, mixOf, module, taiga, toString,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssueDetailController = (function(superClass) {\n    extend(IssueDetailController, superClass);\n\n    IssueDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgAnalytics\", \"$tgNavUrls\", \"$translate\"];\n\n    function IssueDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, analytics, navUrls, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.analytics = analytics;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.issueRef = this.params.issueref;\n      this.scope.sectionName = this.translate.instant(\"ISSUES.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    IssueDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, ref3, title;\n      title = this.translate.instant(\"ISSUE.PAGE_TITLE\", {\n        issueRef: \"#\" + this.scope.issue.ref,\n        issueSubject: this.scope.issue.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"ISSUE.PAGE_DESCRIPTION\", {\n        issueStatus: ((ref = this.scope.statusById[this.scope.issue.status]) != null ? ref.name : void 0) || \"--\",\n        issueType: ((ref1 = this.scope.typeById[this.scope.issue.type]) != null ? ref1.name : void 0) || \"--\",\n        issueSeverity: ((ref2 = this.scope.severityById[this.scope.issue.severity]) != null ? ref2.name : void 0) || \"--\",\n        issuePriority: ((ref3 = this.scope.priorityById[this.scope.issue.priority]) != null ? ref3.name : void 0) || \"--\",\n        issueDescription: angular.element(this.scope.issue.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    IssueDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on issue\", 1);\n        };\n      })(this));\n      this.scope.$on(\"promote-issue-to-us:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"promoteToUserstory\", \"promote issue to userstory\", 1);\n          _this.rootscope.$broadcast(\"object:updated\");\n          return _this.loadIssue();\n        };\n      })(this));\n      this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadIssue();\n        };\n      })(this));\n      return this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      if (this.scope.project.is_issues_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-issues\", ctx);\n      } else {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      }\n    };\n\n    IssueDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.issue_statuses;\n          _this.scope.statusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.typeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          _this.scope.typeList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.severityList = project.severities;\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = project.priorities;\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadIssue = function() {\n      return this.rs.issues.getByRef(this.scope.projectId, this.params.issueref).then((function(_this) {\n        return function(issue) {\n          var ctx, ref, ref1;\n          _this.scope.issue = issue;\n          _this.scope.issueId = issue.id;\n          _this.scope.commentModel = issue;\n          if (((ref = _this.scope.issue.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.issue.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.issue.neighbors.next.ref\n            };\n            return _this.scope.nextUrl = _this.navUrls.resolve(\"project-issues-detail\", ctx);\n          }\n        };\n      })(this));\n    };\n\n    IssueDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadIssue();\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    IssueDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.upvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.downvote(this.scope.issueId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    IssueDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.watch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    IssueDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadIssue();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.issues.unwatch(this.scope.issueId).then(onSuccess, onError);\n    };\n\n    return IssueDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"IssueDetailController\", IssueDetailController);\n\n  IssueStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(issue) {\n        var html, status;\n        status = $scope.statusById[issue.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue != null) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusDisplay\", [\"$tgTemplate\", \"$compile\", IssueStatusDisplayDirective]);\n\n  IssueStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issues-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, status;\n          status = $scope.statusById[issue.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(statusId) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.status = statusId;\n          currentLoading = $loading().target($el).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueStatusButtonDirective]);\n\n  IssueTypeButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-type-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, type;\n          type = $scope.typeById[issue.type];\n          html = template({\n            type: type,\n            typees: $scope.typeList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(type) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.type = type;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".type-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-type\").popover().open();\n      });\n      $el.on(\"click\", \".type\", function(event) {\n        var target, type;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        type = target.data(\"type-id\");\n        return save(type);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueTypeButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueTypeButtonDirective]);\n\n  IssueSeverityButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-severity-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, severity;\n          severity = $scope.severityById[issue.severity];\n          html = template({\n            severity: severity,\n            severityes: $scope.severityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(severity) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.severity = severity;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".severity-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-severity\").popover().open();\n      });\n      $el.on(\"click\", \".severity\", function(event) {\n        var severity, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        severity = target.data(\"severity-id\");\n        return save(severity);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssueSeverityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssueSeverityButtonDirective]);\n\n  IssuePriorityButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"issue/issue-priority-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_issue\") !== -1;\n      };\n      render = (function(_this) {\n        return function(issue) {\n          var html, priority;\n          priority = $scope.priorityById[issue.priority];\n          html = template({\n            priority: priority,\n            priorityes: $scope.priorityList,\n            editable: isEditable()\n          });\n          html = $compile(html)($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(priority) {\n          var currentLoading, issue, onError, onSuccess;\n          $.fn.popover().closeAll();\n          issue = $model.$modelValue.clone();\n          issue.priority = priority;\n          currentLoading = $loading().target($el.find(\".level-name\")).start();\n          onSuccess = function() {\n            $model.$setViewValue(issue);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            issue.revert();\n            $model.$setViewValue(issue);\n            return currentLoading.finish();\n          };\n          return $repo.save(issue).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".priority-data\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-priority\").popover().open();\n      });\n      $el.on(\"click\", \".priority\", function(event) {\n        var priority, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        priority = target.data(\"priority-id\");\n        return save(priority);\n      });\n      $scope.$watch($attrs.ngModel, function(issue) {\n        if (issue) {\n          return render(issue);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgIssuePriorityButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", IssuePriorityButtonDirective]);\n\n  PromoteIssueToUsButtonDirective = function($rootScope, $repo, $confirm, $qqueue, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var save;\n      save = $qqueue.bindAdd((function(_this) {\n        return function(issue, askResponse) {\n          var data, onError, onSuccess;\n          data = {\n            generated_from_issue: issue.id,\n            project: issue.project,\n            subject: issue.subject,\n            description: issue.description,\n            tags: issue.tags,\n            is_blocked: issue.is_blocked,\n            blocked_note: issue.blocked_note\n          };\n          onSuccess = function() {\n            askResponse.finish();\n            $confirm.notify(\"success\");\n            return $rootScope.$broadcast(\"promote-issue-to-us:success\");\n          };\n          onError = function() {\n            askResponse.finish();\n            return $confirm.notify(\"error\");\n          };\n          return $repo.create(\"userstories\", data).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \"a\", function(event) {\n        var issue, message, subtitle, title;\n        event.preventDefault();\n        issue = $model.$modelValue;\n        title = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.TITLE\");\n        message = $translate.instant(\"ISSUES.CONFIRM_PROMOTE.MESSAGE\");\n        subtitle = issue.subject;\n        return $confirm.ask(title, subtitle, message).then((function(_this) {\n          return function(response) {\n            return save(issue, response);\n          };\n        })(this));\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      restrict: \"AE\",\n      require: \"ngModel\",\n      templateUrl: \"issue/promote-issue-to-us-button.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgPromoteIssueToUsButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgQqueue\", \"$translate\", PromoteIssueToUsButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var CreateBulkIssuesDirective, CreateIssueDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaIssues\");\n\n  CreateIssueDirective = function($repo, $confirm, $rootscope, lightboxService, $loading, $q, attachmentsService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var attachmentsToAdd, createAttachments, form, resetAttachments, submit, submitButton;\n      form = $el.find(\"form\").checksley();\n      $scope.issue = {};\n      $scope.attachments = Immutable.List();\n      $scope.$on(\"issueform:new\", function(ctx, project) {\n        form.reset();\n        resetAttachments();\n        $el.find(\".tag-input\").val(\"\");\n        lightboxService.open($el);\n        return $scope.issue = {\n          project: project.id,\n          subject: \"\",\n          status: project.default_issue_status,\n          type: project.default_issue_type,\n          priority: project.default_priority,\n          severity: project.default_severity,\n          tags: []\n        };\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      createAttachments = function(obj) {\n        var promises;\n        promises = _.map(attachmentsToAdd.toJS(), function(attachment) {\n          return attachmentsService.upload(attachment.file, obj.id, $scope.issue.project, 'issue');\n        });\n        return $q.all(promises);\n      };\n      attachmentsToAdd = Immutable.List();\n      resetAttachments = function() {\n        attachmentsToAdd = Immutable.List();\n        return $scope.attachments = Immutable.List();\n      };\n      $scope.addAttachment = function(attachment) {\n        return attachmentsToAdd = attachmentsToAdd.push(attachment);\n      };\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"issues\", $scope.issue);\n          promise.then(function(data) {\n            return createAttachments(data);\n          });\n          promise.then(function(data) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", data);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateIssue\", [\"$tgRepo\", \"$tgConfirm\", \"$rootScope\", \"lightboxService\", \"$tgLoading\", \"$q\", \"tgAttachmentsService\", CreateIssueDirective]);\n\n  CreateBulkIssuesDirective = function($repo, $rs, $confirm, $rootscope, $loading, lightboxService) {\n    var link;\n    link = function($scope, $el, attrs) {\n      var form, submit, submitButton;\n      form = null;\n      $scope.$on(\"issueform:bulk\", function(ctx, projectId, status) {\n        if (form) {\n          form.reset();\n        }\n        lightboxService.open($el);\n        return $scope[\"new\"] = {\n          projectId: projectId,\n          bulk: \"\"\n        };\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, data, projectId, promise;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          data = $scope[\"new\"].bulk;\n          projectId = $scope[\"new\"].projectId;\n          promise = $rs.issues.bulkCreate(projectId, data);\n          promise.then(function(result) {\n            currentLoading.finish();\n            $rootscope.$broadcast(\"issueform:new:success\", result);\n            lightboxService.close($el);\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbCreateBulkIssues\", [\"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$rootScope\", \"$tgLoading\", \"lightboxService\", CreateBulkIssuesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/list.coffee\n */\n\n(function() {\n  var IssueAssignedToInlineEditionDirective, IssueStatusInlineEditionDirective, IssuesController, IssuesDirective, IssuesFiltersDirective, bindOnce, debounceLeading, groupBy, joinStr, mixOf, module, startswith, taiga, toString, trim,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  startswith = this.taiga.startswith;\n\n  module = angular.module(\"taigaIssues\");\n\n  IssuesController = (function(superClass) {\n    extend(IssuesController, superClass);\n\n    IssuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$tgUrls\", \"$routeParams\", \"$q\", \"$tgLocation\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgEvents\", \"$tgAnalytics\", \"$translate\"];\n\n    function IssuesController(scope, rootscope, repo, confirm, rs, urls, params, q, location, appMetaService, navUrls, events, analytics, translate) {\n      var filters, promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.urls = urls;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.events = events;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.loadIssues = bind(this.loadIssues, this);\n      this.scope.sectionName = \"Issues\";\n      this.scope.filters = {};\n      if (_.isEmpty(this.location.search())) {\n        filters = this.rs.issues.getFilters(this.params.pslug);\n        filters.page = 1;\n        this.location.search(filters);\n        this.location.replace();\n        return;\n      }\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ISSUES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"ISSUES.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"issueform:new:success\", (function(_this) {\n        return function() {\n          _this.analytics.trackEvent(\"issue\", \"create\", \"create issue on issues list\", 1);\n          return _this.loadIssues();\n        };\n      })(this));\n    }\n\n    IssuesController.prototype.initializeSubscription = function() {\n      var routingKey;\n      routingKey = \"changes.project.\" + this.scope.projectId + \".issues\";\n      return this.events.subscribe(this.scope, routingKey, (function(_this) {\n        return function(message) {\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.storeFilters = function() {\n      return this.rs.issues.storeFilters(this.params.pslug, this.location.search());\n    };\n\n    IssuesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_issues_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issueStatusById = groupBy(project.issue_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.severityById = groupBy(project.severities, function(x) {\n            return x.id;\n          });\n          _this.scope.severityList = _.sortBy(project.severities, \"order\");\n          _this.scope.priorityById = groupBy(project.priorities, function(x) {\n            return x.id;\n          });\n          _this.scope.priorityList = _.sortBy(project.priorities, \"order\");\n          _this.scope.issueTypes = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueTypeById = groupBy(project.issue_types, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\", \"tags\", \"status\", \"types\", \"q\", \"severities\", \"priorities\", \"assignedTo\", \"createdBy\", \"orderBy\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    IssuesController.prototype.getUrlFilter = function(name) {\n      var filters;\n      filters = _.pick(this.location.search(), name);\n      return filters[name];\n    };\n\n    IssuesController.prototype.loadMyFilters = function() {\n      return this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          return _.map(filters, function(value, key) {\n            return {\n              id: key,\n              name: key,\n              type: \"myFilters\",\n              selected: false\n            };\n          });\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.removeNotExistingFiltersFromUrl = function() {\n      var currentSearch, existingValues, filterName, filterValue, splittedValues, urlfilters;\n      currentSearch = this.location.search();\n      urlfilters = this.getUrlFilters();\n      for (filterName in urlfilters) {\n        filterValue = urlfilters[filterName];\n        if (filterName === \"page\" || filterName === \"orderBy\" || filterName === \"q\") {\n          continue;\n        }\n        if (filterName === \"tags\") {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"));\n        } else {\n          splittedValues = _.map((\"\" + filterValue).split(\",\"), function(x) {\n            if (x === \"null\") {\n              return null;\n            } else {\n              return parseInt(x);\n            }\n          });\n        }\n        existingValues = _.intersection(splittedValues, _.map(this.scope.filters[filterName], \"id\"));\n        if (splittedValues.length !== existingValues.length) {\n          this.location.search(filterName, existingValues.join());\n        }\n      }\n      if (currentSearch !== this.location.search()) {\n        return this.location.replace();\n      }\n    };\n\n    IssuesController.prototype.markSelectedFilters = function(filters, urlfilters) {\n      var isSelected, j, key, len, name, obj, ref, ref1, results, searchdata, val, value;\n      searchdata = {};\n      ref = _.omit(urlfilters, \"page\", \"orderBy\");\n      for (name in ref) {\n        value = ref[name];\n        if (searchdata[name] == null) {\n          searchdata[name] = {};\n        }\n        ref1 = (\"\" + value).split(\",\");\n        for (j = 0, len = ref1.length; j < len; j++) {\n          val = ref1[j];\n          searchdata[name][val] = true;\n        }\n      }\n      isSelected = function(type, id) {\n        if ((searchdata[type] != null) && searchdata[type][id]) {\n          return true;\n        }\n        return false;\n      };\n      results = [];\n      for (key in filters) {\n        value = filters[key];\n        results.push((function() {\n          var k, len1, results1;\n          results1 = [];\n          for (k = 0, len1 = value.length; k < len1; k++) {\n            obj = value[k];\n            results1.push(obj.selected = isSelected(obj.type, obj.id) ? true : void 0);\n          }\n          return results1;\n        })());\n      }\n      return results;\n    };\n\n    IssuesController.prototype.loadFilters = function() {\n      var loadFilters, promise, urlfilters;\n      urlfilters = this.getUrlFilters();\n      if (urlfilters.q) {\n        this.scope.filtersQ = urlfilters.q;\n      }\n      promise = this.loadMyFilters().then((function(_this) {\n        return function(myFilters) {\n          _this.scope.filters.myFilters = myFilters;\n          return myFilters;\n        };\n      })(this));\n      loadFilters = {};\n      loadFilters.project = this.scope.projectId;\n      loadFilters.tags = urlfilters.tags;\n      loadFilters.status = urlfilters.status;\n      loadFilters.q = urlfilters.q;\n      loadFilters.types = urlfilters.types;\n      loadFilters.severities = urlfilters.severities;\n      loadFilters.priorities = urlfilters.priorities;\n      loadFilters.assigned_to = urlfilters.assignedTo;\n      loadFilters.owner = urlfilters.createdBy;\n      promise = promise.then((function(_this) {\n        return function() {\n          return _this.rs.issues.filtersData(loadFilters);\n        };\n      })(this));\n      return promise.then((function(_this) {\n        return function(data) {\n          var choicesFiltersFormat, tagsFilterFormat, usersFiltersFormat;\n          usersFiltersFormat = function(users, type, unknownOption) {\n            var reformatedUsers, unknownItem;\n            reformatedUsers = _.map(users, function(t) {\n              t.type = type;\n              t.name = t.full_name ? t.full_name : unknownOption;\n              return t;\n            });\n            unknownItem = _.remove(reformatedUsers, function(u) {\n              return !u.id;\n            });\n            reformatedUsers = _.sortBy(reformatedUsers, function(u) {\n              return u.name.toUpperCase();\n            });\n            if (unknownItem.length > 0) {\n              reformatedUsers.unshift(unknownItem[0]);\n            }\n            return reformatedUsers;\n          };\n          choicesFiltersFormat = function(choices, type, byIdObject) {\n            return _.map(choices, function(t) {\n              t.type = type;\n              return t;\n            });\n          };\n          tagsFilterFormat = function(tags) {\n            return _.map(tags, function(t) {\n              t.id = t.name;\n              t.type = 'tags';\n              return t;\n            });\n          };\n          _this.scope.filters.status = choicesFiltersFormat(data.statuses, \"status\", _this.scope.issueStatusById);\n          _this.scope.filters.severities = choicesFiltersFormat(data.severities, \"severities\", _this.scope.severityById);\n          _this.scope.filters.priorities = choicesFiltersFormat(data.priorities, \"priorities\", _this.scope.priorityById);\n          _this.scope.filters.assignedTo = usersFiltersFormat(data.assigned_to, \"assignedTo\", \"Unassigned\");\n          _this.scope.filters.createdBy = usersFiltersFormat(data.owners, \"createdBy\", \"Unknown\");\n          _this.scope.filters.types = choicesFiltersFormat(data.types, \"types\", _this.scope.issueTypeById);\n          _this.scope.filters.tags = tagsFilterFormat(data.tags);\n          _this.removeNotExistingFiltersFromUrl();\n          _this.markSelectedFilters(_this.scope.filters, urlfilters);\n          return _this.rootscope.$broadcast(\"filters:loaded\", _this.scope.filters);\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.loadIssuesRequests = 0;\n\n    IssuesController.prototype.loadIssues = function() {\n      var name, promise, ref, values;\n      this.scope.urlFilters = this.getUrlFilters();\n      this.scope.httpParams = {};\n      ref = this.scope.urlFilters;\n      for (name in ref) {\n        values = ref[name];\n        if (name === \"severities\") {\n          name = \"severity\";\n        } else if (name === \"orderBy\") {\n          name = \"order_by\";\n        } else if (name === \"priorities\") {\n          name = \"priority\";\n        } else if (name === \"assignedTo\") {\n          name = \"assigned_to\";\n        } else if (name === \"createdBy\") {\n          name = \"owner\";\n        } else if (name === \"status\") {\n          name = \"status\";\n        } else if (name === \"types\") {\n          name = \"type\";\n        }\n        this.scope.httpParams[name] = values;\n      }\n      promise = this.rs.issues.list(this.scope.projectId, this.scope.httpParams);\n      this.loadIssuesRequests += 1;\n      promise.index = this.loadIssuesRequests;\n      promise.then((function(_this) {\n        return function(data) {\n          if (promise.index === _this.loadIssuesRequests) {\n            _this.scope.issues = data.models;\n            _this.scope.page = data.current;\n            _this.scope.count = data.count;\n            _this.scope.paginatedBy = data.paginatedBy;\n          }\n          return data;\n        };\n      })(this));\n      return promise;\n    };\n\n    IssuesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.initializeSubscription();\n          _this.loadFilters();\n          return _this.loadIssues();\n        };\n      })(this));\n    };\n\n    IssuesController.prototype.saveCurrentFiltersTo = function(newFilter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          filters[newFilter] = _this.location.search();\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.deleteMyFilter = function(filter) {\n      var deferred;\n      deferred = this.q.defer();\n      this.rs.issues.getMyFilters(this.scope.projectId).then((function(_this) {\n        return function(filters) {\n          delete filters[filter];\n          return _this.rs.issues.storeMyFilters(_this.scope.projectId, filters).then(function() {\n            return deferred.resolve();\n          });\n        };\n      })(this));\n      return deferred.promise;\n    };\n\n    IssuesController.prototype.addNewIssue = function() {\n      return this.rootscope.$broadcast(\"issueform:new\", this.scope.project);\n    };\n\n    IssuesController.prototype.addIssuesInBulk = function() {\n      return this.rootscope.$broadcast(\"issueform:bulk\", this.scope.projectId);\n    };\n\n    return IssuesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"IssuesController\", IssuesController);\n\n  IssuesDirective = function($log, $location, $template, $compile) {\n    var link, linkOrdering, linkPagination, template;\n    template = $template.get(\"issue/issue-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".issues-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        $pagEl.show();\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        return $pagEl.html(html);\n      };\n      $scope.$watch(\"issues\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".issues-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      $el.on(\"click\", \".issues-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadIssues();\n        });\n      });\n      return $el.on(\"click\", \".issues-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadIssues();\n        });\n      });\n    };\n    linkOrdering = function($scope, $el, $attrs, $ctrl) {\n      var colHeadElement, currentOrder, icon;\n      currentOrder = $ctrl.getUrlFilter(\"orderBy\") || \"created_date\";\n      if (currentOrder) {\n        icon = startswith(currentOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n        colHeadElement = $el.find(\".row.title > div[data-fieldname='\" + (trim(currentOrder, \"-\")) + \"']\");\n        colHeadElement.html((colHeadElement.html()) + \"<span class='icon \" + icon + \"'></span>\");\n      }\n      return $el.on(\"click\", \".row.title > div\", function(event) {\n        var finalOrder, newOrder, target;\n        target = angular.element(event.currentTarget);\n        currentOrder = $ctrl.getUrlFilter(\"orderBy\");\n        newOrder = target.data(\"fieldname\");\n        finalOrder = currentOrder === newOrder ? \"-\" + newOrder : newOrder;\n        return $scope.$apply(function() {\n          $ctrl.replaceFilter(\"orderBy\", finalOrder);\n          $ctrl.storeFilters();\n          return $ctrl.loadIssues().then(function() {\n            $el.find(\".row.title > div > span.icon\").remove();\n            icon = startswith(finalOrder, \"-\") ? \"icon-arrow-up\" : \"icon-arrow-bottom\";\n            return target.html((target.html()) + \"<span class='icon \" + icon + \"'></span>\");\n          });\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkOrdering($scope, $el, $attrs, $ctrl);\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssues\", [\"$log\", \"$tgLocation\", \"$tgTemplate\", \"$compile\", IssuesDirective]);\n\n  IssuesFiltersDirective = function($q, $log, $location, $rs, $confirm, $loading, $template, $translate, $compile, $auth) {\n    var link, template, templateSelected;\n    template = $template.get(\"issue/issues-filters.html\", true);\n    templateSelected = $template.get(\"issue/issues-filters-selected.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, getFiltersType, initializeSelectedFilters, reloadIssues, renderFilters, renderSelectedFilters, selectQFilter, selectedFilters, showCategories, showFilters, toggleFilterSelection, unwatchIssues;\n      $ctrl = $el.closest(\".wrapper\").controller();\n      selectedFilters = [];\n      showFilters = function(title, type) {\n        $el.find(\".filters-cats\").hide();\n        $el.find(\".filter-list\").removeClass(\"hidden\");\n        $el.find(\".breadcrumb\").removeClass(\"hidden\");\n        $el.find(\"h2 .subfilter .title\").html(title);\n        return $el.find(\"h2 .subfilter .title\").prop(\"data-type\", type);\n      };\n      showCategories = function() {\n        $el.find(\".filters-cats\").show();\n        $el.find(\".filter-list\").addClass(\"hidden\");\n        return $el.find(\".breadcrumb\").addClass(\"hidden\");\n      };\n      initializeSelectedFilters = function(filters) {\n        var j, len, name, val, values;\n        selectedFilters = [];\n        for (name in filters) {\n          values = filters[name];\n          for (j = 0, len = values.length; j < len; j++) {\n            val = values[j];\n            if (val.selected) {\n              selectedFilters.push(val);\n            }\n          }\n        }\n        return renderSelectedFilters(selectedFilters);\n      };\n      renderSelectedFilters = function(selectedFilters) {\n        var html;\n        _.filter(selectedFilters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = templateSelected({\n          filters: selectedFilters\n        });\n        html = $compile(html)($scope);\n        $el.find(\".filters-applied\").html(html);\n        if ($auth.isAuthenticated() && selectedFilters.length > 0) {\n          return $el.find(\".save-filters\").show();\n        } else {\n          return $el.find(\".save-filters\").hide();\n        }\n      };\n      renderFilters = function(filters) {\n        var html;\n        _.filter(filters, (function(_this) {\n          return function(f) {\n            if (f.color) {\n              return f.style = \"border-left: 3px solid \" + f.color;\n            }\n          };\n        })(this));\n        html = template({\n          filters: filters\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      };\n      getFiltersType = function() {\n        return $el.find(\".subfilter .title\").prop('data-type');\n      };\n      reloadIssues = function() {\n        var currentFiltersType;\n        currentFiltersType = getFiltersType();\n        return $q.all([$ctrl.loadIssues(), $ctrl.loadFilters()]).then(function() {\n          var filters;\n          filters = $scope.filters[currentFiltersType];\n          return renderFilters(_.reject(filters, \"selected\"));\n        });\n      };\n      toggleFilterSelection = function(type, id) {\n        var currentFiltersType, filter, filterId, filters;\n        if (type === \"myFilters\") {\n          $rs.issues.getMyFilters($scope.projectId).then(function(data) {\n            var filters, myFilters;\n            myFilters = data;\n            filters = myFilters[id];\n            filters.page = 1;\n            $ctrl.replaceAllFilters(filters);\n            $ctrl.storeFilters();\n            $ctrl.loadIssues();\n            $ctrl.markSelectedFilters($scope.filters, filters);\n            return initializeSelectedFilters($scope.filters);\n          });\n          return null;\n        }\n        filters = $scope.filters[type];\n        filterId = type === 'tags' ? taiga.toString(id) : id;\n        filter = _.find(filters, {\n          id: filterId\n        });\n        filter.selected = !filter.selected;\n        if (id === null) {\n          id = \"null\";\n        }\n        if (filter.selected) {\n          selectedFilters.push(filter);\n          $ctrl.selectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        } else {\n          selectedFilters = _.reject(selectedFilters, function(f) {\n            return f.id === filter.id && f.type === filter.type;\n          });\n          $ctrl.unselectFilter(type, id);\n          $ctrl.selectFilter(\"page\", 1);\n          $ctrl.storeFilters();\n        }\n        reloadIssues();\n        renderSelectedFilters(selectedFilters);\n        currentFiltersType = getFiltersType();\n        if (type === currentFiltersType) {\n          return renderFilters(_.reject(filters, \"selected\"));\n        }\n      };\n      $scope.$on(\"filters:loaded\", function(ctx, filters) {\n        return initializeSelectedFilters(filters);\n      });\n      $scope.$on(\"filters:issueupdate\", function(ctx, filters) {\n        var html;\n        html = template({\n          filters: filters.status\n        });\n        html = $compile(html)($scope);\n        return $el.find(\".filter-list\").html(html);\n      });\n      selectQFilter = debounceLeading(100, function(value, oldValue) {\n        if (value === void 0 || value === oldValue) {\n          return;\n        }\n        $ctrl.replaceFilter(\"page\", null, true);\n        if (value.length === 0) {\n          $ctrl.replaceFilter(\"q\", null);\n          $ctrl.storeFilters();\n        } else {\n          $ctrl.replaceFilter(\"q\", value);\n          $ctrl.storeFilters();\n        }\n        return reloadIssues();\n      });\n      unwatchIssues = $scope.$watch(\"issues\", function(newValue) {\n        if (!_.isUndefined(newValue)) {\n          $scope.$watch(\"filtersQ\", selectQFilter);\n          return unwatchIssues();\n        }\n      });\n      $el.on(\"click\", \".filters-cat-single\", function(event) {\n        var tags, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        tags = $scope.filters[target.data(\"type\")];\n        renderFilters(_.reject(tags, \"selected\"));\n        return showFilters(target.attr(\"title\"), target.data(\"type\"));\n      });\n      $el.on(\"click\", \".back\", function(event) {\n        event.preventDefault();\n        return showCategories($el);\n      });\n      $el.on(\"click\", \".filters-applied .remove-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget).parent();\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .single-filter\", function(event) {\n        var id, target, type;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"active\");\n        id = target.data(\"id\") || null;\n        type = target.data(\"type\");\n        if (type === \"myFilters\") {\n          target.removeClass(\"active\");\n        }\n        return toggleFilterSelection(type, id);\n      });\n      $el.on(\"click\", \".filter-list .remove-filter\", function(event) {\n        var customFilterName, message, target, title;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        customFilterName = target.parent().data('id');\n        title = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.TITLE\");\n        message = $translate.instant(\"ISSUES.FILTERS.CONFIRM_DELETE.MESSAGE\", {\n          customFilterName: customFilterName\n        });\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var promise;\n          promise = $ctrl.deleteMyFilter(customFilterName);\n          promise.then(function() {\n            promise = $ctrl.loadMyFilters();\n            promise.then(function(filters) {\n              askResponse.finish();\n              $scope.filters.myFilters = filters;\n              return renderFilters($scope.filters.myFilters);\n            });\n            return promise.then(null, function() {\n              return askResponse.finish();\n            });\n          });\n          return promise.then(null, function() {\n            askResponse.finish(false);\n            return $confirm.notify(\"error\");\n          });\n        });\n      });\n      $el.on(\"click\", \".save-filters\", function(event) {\n        event.preventDefault();\n        renderFilters($scope.filters[\"myFilters\"]);\n        showFilters(\"My filters\", \"myFilters\");\n        $el.find('.save-filters').hide();\n        $el.find('.my-filter-name').removeClass(\"hidden\");\n        $el.find('.my-filter-name').focus();\n        return $scope.$apply();\n      });\n      return $el.on(\"keyup\", \".my-filter-name\", function(event) {\n        var currentLoading, newFilter, promise, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newFilter = target.val();\n          currentLoading = $loading().target($el.find(\".new\")).start();\n          promise = $ctrl.saveCurrentFiltersTo(newFilter);\n          promise.then(function() {\n            var loadPromise;\n            loadPromise = $ctrl.loadMyFilters();\n            loadPromise.then(function(filters) {\n              var currentfilterstype;\n              currentLoading.finish();\n              $scope.filters.myFilters = filters;\n              currentfilterstype = $el.find(\"h2 .subfilter .title\").prop('data-type');\n              if (currentfilterstype === \"myFilters\") {\n                renderFilters($scope.filters.myFilters);\n              }\n              $el.find('.my-filter-name').addClass(\"hidden\");\n              return $el.find('.save-filters').show();\n            });\n            return loadPromise.then(null, function() {\n              currentLoading.finish();\n              return $confirm.notify(\"error\", \"Error loading custom filters\");\n            });\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            $el.find(\".my-filter-name\").val(newFilter).focus().select();\n            return $confirm.notify(\"error\", \"Filter not saved\");\n          });\n        } else if (event.keyCode === 27) {\n          $el.find('.my-filter-name').val('');\n          $el.find('.my-filter-name').addClass(\"hidden\");\n          return $el.find('.save-filters').show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssuesFilters\", [\"$q\", \"$log\", \"$tgLocation\", \"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$tgTemplate\", \"$translate\", \"$compile\", \"$tgAuth\", IssuesFiltersDirective]);\n\n  IssueStatusInlineEditionDirective = function($repo, $template, $rootscope) {\n\n    /*\n    Print the status of an Issue and a popover to change it.\n    - tg-issue-status-inline-edition: The issue\n    \n    Example:\n    \n      div.status(tg-issue-status-inline-edition=\"issue\")\n        a.issue-status(href=\"\")\n    \n    NOTE: This directive need 'issueStatusById' and 'project'.\n     */\n    var link, selectionTemplate, updateIssueStatus;\n    selectionTemplate = $template.get(\"issue/issue-status-inline-edition-selection.html\", true);\n    updateIssueStatus = function($el, issue, issueStatusById) {\n      var issueStatusDom, issueStatusDomParent, status;\n      issueStatusDomParent = $el.find(\".issue-status\");\n      issueStatusDom = $el.find(\".issue-status .issue-status-bind\");\n      status = issueStatusById[issue.status];\n      if (status) {\n        issueStatusDom.text(status.name);\n        issueStatusDom.prop(\"title\", status.name);\n        return issueStatusDomParent.css('color', status.color);\n      }\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue;\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueStatusInlineEdition);\n      $el.on(\"click\", \".issue-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var filter, j, len, ref, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        ref = $scope.filters.status;\n        for (j = 0, len = ref.length; j < len; j++) {\n          filter = ref[j];\n          if (filter.id === issue.status) {\n            filter.count--;\n          }\n        }\n        issue.status = target.data(\"status-id\");\n        $el.find(\".pop-status\").popover().close();\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        return $scope.$apply(function() {\n          var k, len1, ref1;\n          $repo.save(issue).then(function() {\n            return $ctrl.loadIssues();\n          });\n          ref1 = $scope.filters.status;\n          for (k = 0, len1 = ref1.length; k < len1; k++) {\n            filter = ref1[k];\n            if (filter.id === issue.status) {\n              filter.count++;\n            }\n          }\n          return $rootscope.$broadcast(\"filters:issueupdate\", $scope.filters);\n        });\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        $el.append(selectionTemplate({\n          'statuses': project.issue_statuses\n        }));\n        updateIssueStatus($el, issue, $scope.issueStatusById);\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$watch($attrs.tgIssueStatusInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssueStatus($el, val, $scope.issueStatusById);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueStatusInlineEdition\", [\"$tgRepo\", \"$tgTemplate\", \"$rootScope\", IssueStatusInlineEditionDirective]);\n\n  IssueAssignedToInlineEditionDirective = function($repo, $rootscope, $translate) {\n    var link, template;\n    template = _.template(\"<img src=\\\"<%- imgurl %>\\\" alt=\\\"<%- name %>\\\"/>\\n<figcaption><%- name %></figcaption>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, issue, updateIssue;\n      updateIssue = function(issue) {\n        var ctx, member;\n        ctx = {\n          name: $translate.instant(\"COMMON.ASSIGNED_TO.NOT_ASSIGNED\"),\n          imgurl: \"/\" + window._version + \"/images/unnamed.png\"\n        };\n        member = $scope.usersById[issue.assigned_to];\n        if (member) {\n          ctx.name = member.full_name_display;\n          ctx.imgurl = member.photo;\n        }\n        $el.find(\".avatar\").html(template(ctx));\n        return $el.find(\".issue-assignedto\").attr('title', ctx.name);\n      };\n      $ctrl = $el.controller();\n      issue = $scope.$eval($attrs.tgIssueAssignedToInlineEdition);\n      updateIssue(issue);\n      $el.on(\"click\", \".issue-assignedto\", function(event) {\n        return $rootscope.$broadcast(\"assigned-to:add\", issue);\n      });\n      taiga.bindOnce($scope, \"project\", function(project) {\n        if (project.my_permissions.indexOf(\"modify_issue\") === -1) {\n          $el.unbind(\"click\");\n          return $el.find(\"a\").addClass(\"not-clickable\");\n        }\n      });\n      $scope.$on(\"assigned-to:added\", (function(_this) {\n        return function(ctx, userId, updatedIssue) {\n          if (updatedIssue.id === issue.id) {\n            updatedIssue.assigned_to = userId;\n            $repo.save(updatedIssue);\n            return updateIssue(updatedIssue);\n          }\n        };\n      })(this));\n      $scope.$watch($attrs.tgIssueAssignedToInlineEdition, (function(_this) {\n        return function(val) {\n          return updateIssue(val);\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgIssueAssignedToInlineEdition\", [\"$tgRepo\", \"$rootScope\", \"$translate\", IssueAssignedToInlineEditionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/userstories/detail.coffee\n */\n\n(function() {\n  var UsClientRequirementButtonDirective, UsStatusButtonDirective, UsStatusDisplayDirective, UsTeamRequirementButtonDirective, UserStoryDetailController, bindMethods, bindOnce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaUserStories\");\n\n  UserStoryDetailController = (function(superClass) {\n    extend(UserStoryDetailController, superClass);\n\n    UserStoryDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function UserStoryDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.usRef = this.params.usref;\n      this.scope.sectionName = this.translate.instant(\"US.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserStoryDetailController.prototype._setMeta = function() {\n      var closedTasks, description, progressPercentage, ref, title, totalTasks;\n      totalTasks = this.scope.tasks.length;\n      closedTasks = _.filter(this.scope.tasks, (function(_this) {\n        return function(t) {\n          return _this.scope.taskStatusById[t.status].is_closed;\n        };\n      })(this)).length;\n      progressPercentage = totalTasks > 0 ? Math.round(100 * closedTasks / totalTasks) : 0;\n      title = this.translate.instant(\"US.PAGE_TITLE\", {\n        userStoryRef: \"#\" + this.scope.us.ref,\n        userStorySubject: this.scope.us.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"US.PAGE_DESCRIPTION\", {\n        userStoryStatus: ((ref = this.scope.statusById[this.scope.us.status]) != null ? ref.name : void 0) || \"--\",\n        userStoryPoints: this.scope.us.total_points,\n        userStoryDescription: angular.element(this.scope.us.description_html || \"\").text(),\n        userStoryClosedTasks: closedTasks,\n        userStoryTotalTasks: totalTasks,\n        userStoryProgressPercentage: progressPercentage\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    UserStoryDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"related-tasks:update\", (function(_this) {\n        return function() {\n          var allClosed;\n          _this.scope.tasks = _.clone(_this.scope.tasks, false);\n          allClosed = _.every(_this.scope.tasks, function(task) {\n            return task.is_closed;\n          });\n          if (_this.scope.us.is_closed !== allClosed) {\n            return _this.loadUs();\n          }\n        };\n      })(this));\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on userstory\", 1);\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadUs();\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.us.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else {\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-backlog\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-kanban\", ctx);\n      }\n    };\n\n    UserStoryDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.us_statuses;\n          _this.scope.statusById = groupBy(project.us_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.taskStatusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.pointsById = groupBy(_this.scope.pointsList, function(e) {\n            return e.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadUs = function() {\n      var httpParams, kanbanStaus, milestone, noMilestone;\n      httpParams = _.pick(this.location.search(), \"milestone\", \"no-milestone\", \"kanban-status\");\n      milestone = httpParams.milestone;\n      if (milestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: milestone,\n          order_by: \"sprint_order\"\n        });\n      }\n      noMilestone = httpParams[\"no-milestone\"];\n      if (noMilestone) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          milestone: \"null\",\n          order_by: \"backlog_order\"\n        });\n      }\n      kanbanStaus = httpParams[\"kanban-status\"];\n      if (kanbanStaus) {\n        this.rs.userstories.storeQueryParams(this.scope.projectId, {\n          status: kanbanStaus,\n          order_by: \"kanban_order\"\n        });\n      }\n      return this.rs.userstories.getByRef(this.scope.projectId, this.params.usref).then((function(_this) {\n        return function(us) {\n          var ctx, ref, ref1;\n          _this.scope.us = us;\n          _this.scope.usId = us.id;\n          _this.scope.commentModel = us;\n          if (((ref = _this.scope.us.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.us.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.us.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-userstories-detail\", ctx);\n          }\n          return us;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadSprint = function() {\n      if (this.scope.us.milestone) {\n        return this.rs.sprints.get(this.scope.us.project, this.scope.us.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    UserStoryDetailController.prototype.loadTasks = function() {\n      return this.rs.tasks.list(this.scope.projectId, null, this.scope.usId).then((function(_this) {\n        return function(tasks) {\n          _this.scope.tasks = tasks;\n          return tasks;\n        };\n      })(this));\n    };\n\n    UserStoryDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadUs().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadTasks()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    UserStoryDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.upvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.downvote(this.scope.usId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    UserStoryDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.watch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    UserStoryDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadUs();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.userstories.unwatch(this.scope.usId).then(onSuccess, onError);\n    };\n\n    return UserStoryDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserStoryDetailController\", UserStoryDetailController);\n\n  UsStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(us) {\n        var html, status;\n        status = $scope.statusById[us.status];\n        html = template({\n          is_closed: us.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us != null) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusDisplay\", [\"$tgTemplate\", \"$compile\", UsStatusDisplayDirective]);\n\n  UsStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $template) {\n    var link, template;\n    template = $template.get(\"us/us-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = (function(_this) {\n        return function(us) {\n          var html, status;\n          status = $scope.statusById[us.status];\n          html = template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          });\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, us;\n          us = $model.$modelValue.clone();\n          us.status = status;\n          $.fn.popover().closeAll();\n          currentLoading = $loading().target($el).start();\n          onSuccess = function() {\n            $model.$setViewValue(us);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return $repo.save(us).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var status, target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        status = target.data(\"status-id\");\n        return save(status);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", UsStatusButtonDirective]);\n\n  UsTeamRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-team-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.team_requirement\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(team_requirement) {\n          var currentLoading, promise, us;\n          us = $model.$modelValue.clone();\n          us.team_requirement = team_requirement;\n          currentLoading = $loading().target($el.find(\"label\")).start();\n          promise = $tgrepo.save(us);\n          promise.then(function() {\n            $model.$setViewValue(us);\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            currentLoading.finish();\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".team-requirement\", function(event) {\n        var team_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        team_requirement = !$model.$modelValue.team_requirement;\n        return save(team_requirement);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsTeamRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsTeamRequirementButtonDirective]);\n\n  UsClientRequirementButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $template, $compile) {\n    var link, template;\n    template = $template.get(\"us/us-client-requirement-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var canEdit, render, save;\n      canEdit = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_us\") !== -1;\n      };\n      render = function(us) {\n        var ctx, html;\n        ctx = {\n          canEdit: canEdit(),\n          isRequired: us.client_requirement\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(client_requirement) {\n          var currentLoading, promise, us;\n          us = $model.$modelValue.clone();\n          us.client_requirement = client_requirement;\n          currentLoading = $loading().target($el.find(\"label\")).start();\n          promise = $tgrepo.save(us);\n          promise.then(function() {\n            $model.$setViewValue(us);\n            currentLoading.finish();\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          return promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".client-requirement\", function(event) {\n        var client_requirement;\n        if (!canEdit()) {\n          return;\n        }\n        client_requirement = !$model.$modelValue.client_requirement;\n        return save(client_requirement);\n      });\n      $scope.$watch($attrs.ngModel, function(us) {\n        if (us) {\n          return render(us);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgUsClientRequirementButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$tgTemplate\", \"$compile\", UsClientRequirementButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/tasks/detail.coffee\n */\n\n(function() {\n  var TaskDetailController, TaskIsIocaineButtonDirective, TaskStatusButtonDirective, TaskStatusDisplayDirective, bindMethods, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaTasks\");\n\n  TaskDetailController = (function(superClass) {\n    extend(TaskDetailController, superClass);\n\n    TaskDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function TaskDetailController(scope, rootscope, repo, confirm, rs, params, q, location, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.taskRef = this.params.taskref;\n      this.scope.sectionName = this.translate.instant(\"TASK.SECTION_NAME\");\n      this.initializeEventHandlers();\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          _this._setMeta();\n          return _this.initializeOnDeleteGoToUrl();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TaskDetailController.prototype._setMeta = function() {\n      var description, ref, title;\n      title = this.translate.instant(\"TASK.PAGE_TITLE\", {\n        taskRef: \"#\" + this.scope.task.ref,\n        taskSubject: this.scope.task.subject,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"TASK.PAGE_DESCRIPTION\", {\n        taskStatus: ((ref = this.scope.statusById[this.scope.task.status]) != null ? ref.name : void 0) || \"--\",\n        taskDescription: angular.element(this.scope.task.description_html || \"\").text()\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    TaskDetailController.prototype.initializeEventHandlers = function() {\n      this.scope.$on(\"attachment:create\", (function(_this) {\n        return function() {\n          return _this.analytics.trackEvent(\"attachment\", \"create\", \"create attachment on task\", 1);\n        };\n      })(this));\n      this.scope.$on(\"custom-attributes-values:edit\", (function(_this) {\n        return function() {\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this));\n      return this.scope.$on(\"comment:new\", (function(_this) {\n        return function() {\n          return _this.loadTask();\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.initializeOnDeleteGoToUrl = function() {\n      var ctx;\n      ctx = {\n        project: this.scope.project.slug\n      };\n      this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project\", ctx);\n      if (this.scope.project.is_backlog_activated) {\n        if (this.scope.task.milestone) {\n          ctx.sprint = this.scope.sprint.slug;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-taskboard\", ctx);\n        } else if (this.scope.task.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      } else if (this.scope.project.is_kanban_activated) {\n        if (this.scope.us) {\n          ctx.ref = this.scope.us.ref;\n          return this.scope.onDeleteGoToUrl = this.navUrls.resolve(\"project-userstories-detail\", ctx);\n        }\n      }\n    };\n\n    TaskDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.statusList = project.task_statuses;\n          _this.scope.statusById = groupBy(project.task_statuses, function(x) {\n            return x.id;\n          });\n          return project;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadTask = function() {\n      return this.rs.tasks.getByRef(this.scope.projectId, this.params.taskref).then((function(_this) {\n        return function(task) {\n          var ctx, ref, ref1;\n          _this.scope.task = task;\n          _this.scope.taskId = task.id;\n          _this.scope.commentModel = task;\n          if (((ref = _this.scope.task.neighbors.previous) != null ? ref.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.previous.ref\n            };\n            _this.scope.previousUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          if (((ref1 = _this.scope.task.neighbors.next) != null ? ref1.ref : void 0) != null) {\n            ctx = {\n              project: _this.scope.project.slug,\n              ref: _this.scope.task.neighbors.next.ref\n            };\n            _this.scope.nextUrl = _this.navUrls.resolve(\"project-tasks-detail\", ctx);\n          }\n          return task;\n        };\n      })(this));\n    };\n\n    TaskDetailController.prototype.loadSprint = function() {\n      if (this.scope.task.milestone) {\n        return this.rs.sprints.get(this.scope.task.project, this.scope.task.milestone).then((function(_this) {\n          return function(sprint) {\n            _this.scope.sprint = sprint;\n            return sprint;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadUserStory = function() {\n      if (this.scope.task.user_story) {\n        return this.rs.userstories.get(this.scope.task.project, this.scope.task.user_story).then((function(_this) {\n          return function(us) {\n            _this.scope.us = us;\n            return us;\n          };\n        })(this));\n      }\n    };\n\n    TaskDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.loadTask().then(function() {\n            return _this.q.all([_this.loadSprint(), _this.loadUserStory()]);\n          });\n        };\n      })(this));\n    };\n\n\n    /*\n     * Note: This methods (onUpvote() and onDownvote()) are related to tg-vote-button.\n     *       See app/modules/components/vote-button for more info\n     */\n\n    TaskDetailController.prototype.onUpvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.upvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onDownvote = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.downvote(this.scope.taskId).then(onSuccess, onError);\n    };\n\n\n    /*\n     * Note: This methods (onWatch() and onUnwatch()) are related to tg-watch-button.\n     *       See app/modules/components/watch-button for more info\n     */\n\n    TaskDetailController.prototype.onWatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.watch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    TaskDetailController.prototype.onUnwatch = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.loadTask();\n          return _this.rootscope.$broadcast(\"object:updated\");\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this);\n      return this.rs.tasks.unwatch(this.scope.taskId).then(onSuccess, onError);\n    };\n\n    return TaskDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TaskDetailController\", TaskDetailController);\n\n  TaskStatusDisplayDirective = function($template, $compile) {\n    var link, template;\n    template = $template.get(\"common/components/status-display.html\", true);\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function(task) {\n        var html, status;\n        status = $scope.statusById[task.status];\n        html = template({\n          is_closed: status.is_closed,\n          status: status\n        });\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task != null) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusDisplay\", [\"$tgTemplate\", \"$compile\", TaskStatusDisplayDirective]);\n\n  TaskStatusButtonDirective = function($rootScope, $repo, $confirm, $loading, $qqueue, $compile, $translate, $template) {\n    var link, template;\n    template = $template.get(\"us/us-status-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = (function(_this) {\n        return function(task) {\n          var html, status;\n          status = $scope.statusById[task.status];\n          html = $compile(template({\n            status: status,\n            statuses: $scope.statusList,\n            editable: isEditable()\n          }))($scope);\n          return $el.html(html);\n        };\n      })(this);\n      save = $qqueue.bindAdd((function(_this) {\n        return function(status) {\n          var currentLoading, onError, onSuccess, task;\n          task = $model.$modelValue.clone();\n          task.status = status;\n          currentLoading = $loading().target($el).start();\n          onSuccess = function() {\n            $model.$setViewValue(task);\n            $rootScope.$broadcast(\"object:updated\");\n            return currentLoading.finish();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return currentLoading.finish();\n          };\n          return $repo.save(task).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"click\", \".js-edit-status\", function(event) {\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        return $el.find(\".pop-status\").popover().open();\n      });\n      $el.on(\"click\", \".status\", function(event) {\n        var target;\n        event.preventDefault();\n        event.stopPropagation();\n        if (!isEditable()) {\n          return;\n        }\n        target = angular.element(event.currentTarget);\n        $.fn.popover().closeAll();\n        return save(target.data(\"status-id\"));\n      });\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskStatusButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$compile\", \"$translate\", \"$tgTemplate\", TaskStatusButtonDirective]);\n\n  TaskIsIocaineButtonDirective = function($rootscope, $tgrepo, $confirm, $loading, $qqueue, $compile, $template) {\n    var link, template;\n    template = $template.get(\"issue/iocaine-button.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var isEditable, render, save;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_task\") !== -1;\n      };\n      render = function(task) {\n        var ctx, html;\n        if (!isEditable() && !task.is_iocaine) {\n          $el.html(\"\");\n          return;\n        }\n        ctx = {\n          isIocaine: task.is_iocaine,\n          isEditable: isEditable()\n        };\n        html = $compile(template(ctx))($scope);\n        return $el.html(html);\n      };\n      save = $qqueue.bindAdd((function(_this) {\n        return function(is_iocaine) {\n          var currentLoading, promise, task;\n          task = $model.$modelValue.clone();\n          task.is_iocaine = is_iocaine;\n          currentLoading = $loading().target($el.find('label')).start();\n          promise = $tgrepo.save(task);\n          promise.then(function() {\n            $model.$setViewValue(task);\n            return $rootscope.$broadcast(\"object:updated\");\n          });\n          promise.then(null, function() {\n            return $confirm.notify(\"error\");\n          });\n          return promise[\"finally\"](function() {\n            return currentLoading.finish();\n          });\n        };\n      })(this));\n      $el.on(\"click\", \".is-iocaine\", function(event) {\n        var is_iocaine;\n        if (!isEditable()) {\n          return;\n        }\n        is_iocaine = !$model.$modelValue.is_iocaine;\n        return save(is_iocaine);\n      });\n      $scope.$watch($attrs.ngModel, function(task) {\n        if (task) {\n          return render(task);\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgTaskIsIocaineButton\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgQqueue\", \"$compile\", \"$tgTemplate\", TaskIsIocaineButtonDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/team/main.coffee\n */\n\n(function() {\n  var LeaveProjectDirective, TeamController, TeamFiltersDirective, TeamMemberCurrentUserDirective, TeamMemberStatsDirective, TeamMembersDirective, membersFilter, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  module = angular.module(\"taigaTeam\");\n\n  TeamController = (function(superClass) {\n    extend(TeamController, superClass);\n\n    TeamController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$location\", \"$tgNavUrls\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function TeamController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, auth, translate, projectService) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      this.scope.sectionName = \"TEAM.SECTION_NAME\";\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"TEAM.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.translate.instant(\"TEAM.PAGE_DESCRIPTION\", {\n            projectName: _this.scope.project.name,\n            projectDescription: _this.scope.project.description\n          });\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    TeamController.prototype.setRole = function(role) {\n      if (role) {\n        return this.scope.filtersRole = role;\n      } else {\n        return this.scope.filtersRole = null;\n      }\n    };\n\n    TeamController.prototype.loadMembers = function() {\n      var i, len, member, ref, user;\n      user = this.auth.getUser();\n      this.scope.totals = {};\n      ref = this.scope.activeUsers;\n      for (i = 0, len = ref.length; i < len; i++) {\n        member = ref[i];\n        this.scope.totals[member.id] = 0;\n      }\n      this.scope.currentUser = _.find(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n      return this.scope.memberships = _.reject(this.scope.activeUsers, {\n        id: user != null ? user.id : void 0\n      });\n    };\n\n    TeamController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.issuesEnabled = project.is_issues_activated;\n          _this.scope.tasksEnabled = project.is_kanban_activated || project.is_backlog_activated;\n          _this.scope.wikiEnabled = project.is_wiki_activated;\n          _this.scope.owner = project.owner.id;\n          return project;\n        };\n      })(this));\n    };\n\n    TeamController.prototype.loadMemberStats = function() {\n      return this.rs.projects.memberStats(this.scope.projectId).then((function(_this) {\n        return function(stats) {\n          var totals;\n          totals = {};\n          _.forEach(_this.scope.totals, function(total, userId) {\n            var vals;\n            vals = _.map(stats, function(memberStats, statsKey) {\n              return memberStats[userId];\n            });\n            total = _.reduce(vals, function(sum, el) {\n              return sum + el;\n            });\n            return _this.scope.totals[userId] = total;\n          });\n          _this.scope.stats = _this._processStats(stats);\n          return _this.scope.stats.totals = _this.scope.totals;\n        };\n      })(this));\n    };\n\n    TeamController.prototype._processStat = function(stat) {\n      var key, max, min, singleStat, value;\n      max = _.max(_.toArray(stat));\n      min = _.min(_.toArray(stat));\n      singleStat = Object();\n      for (key in stat) {\n        if (!hasProp.call(stat, key)) continue;\n        value = stat[key];\n        if (value === min) {\n          singleStat[key] = 0.1;\n        } else if (value === max) {\n          singleStat[key] = 1;\n        } else {\n          singleStat[key] = (value * 0.5) / max;\n        }\n      }\n      return singleStat;\n    };\n\n    TeamController.prototype._processStats = function(stats) {\n      var key, value;\n      for (key in stats) {\n        value = stats[key];\n        stats[key] = this._processStat(value);\n      }\n      return stats;\n    };\n\n    TeamController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          var userRoles;\n          _this.fillUsersAndRoles(project.members, project.roles);\n          _this.loadMembers();\n          userRoles = _.map(_this.scope.users, function(user) {\n            return user.role;\n          });\n          _this.scope.roles = _.filter(_this.scope.roles, function(role) {\n            return userRoles.indexOf(role.id) !== -1;\n          });\n          return _this.loadMemberStats();\n        };\n      })(this));\n    };\n\n    return TeamController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"TeamController\", TeamController);\n\n  TeamFiltersDirective = function() {\n    return {\n      templateUrl: \"team/team-filter.html\"\n    };\n  };\n\n  module.directive(\"tgTeamFilters\", [TeamFiltersDirective]);\n\n  TeamMemberStatsDirective = function() {\n    return {\n      templateUrl: \"team/team-member-stats.html\",\n      scope: {\n        stats: \"=\",\n        userId: \"=user\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMemberStats\", TeamMemberStatsDirective);\n\n  TeamMemberCurrentUserDirective = function() {\n    return {\n      templateUrl: \"team/team-member-current-user.html\",\n      scope: {\n        project: \"=project\",\n        currentUser: \"=currentuser\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamCurrentUser\", TeamMemberCurrentUserDirective);\n\n  TeamMembersDirective = function() {\n    var template;\n    template = \"team/team-members.html\";\n    return {\n      templateUrl: template,\n      scope: {\n        memberships: \"=\",\n        filtersQ: \"=filtersq\",\n        filtersRole: \"=filtersrole\",\n        stats: \"=\",\n        issuesEnabled: \"=issuesenabled\",\n        tasksEnabled: \"=tasksenabled\",\n        wikiEnabled: \"=wikienabled\",\n        owner: \"=owner\"\n      }\n    };\n  };\n\n  module.directive(\"tgTeamMembers\", TeamMembersDirective);\n\n  LeaveProjectDirective = function($repo, $confirm, $location, $rs, $navurls, $translate, lightboxFactory, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var leaveConfirm;\n      leaveConfirm = function() {\n        var confirm_leave_project_text, leave_project_text;\n        leave_project_text = $translate.instant(\"TEAM.ACTION_LEAVE_PROJECT\");\n        confirm_leave_project_text = $translate.instant(\"TEAM.CONFIRM_LEAVE_PROJECT\");\n        return $confirm.ask(leave_project_text, confirm_leave_project_text).then((function(_this) {\n          return function(response) {\n            var promise;\n            promise = $rs.projects.leave($scope.project.id);\n            promise.then(function() {\n              return currentUserService.loadProjects().then(function() {\n                response.finish();\n                $confirm.notify(\"success\");\n                return $location.path($navurls.resolve(\"home\"));\n              });\n            });\n            return promise.then(null, function(response) {\n              response.finish();\n              return $confirm.notify('error', response.data._error_message);\n            });\n          };\n        })(this));\n      };\n      return $scope.leave = function() {\n        if ($scope.project.owner.id === $scope.user.id) {\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: true,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      };\n    };\n    return {\n      scope: {\n        user: \"=\",\n        project: \"=\"\n      },\n      templateUrl: \"team/leave-project.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLeaveProject\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"$tgResources\", \"$tgNavUrls\", \"$translate\", \"tgLightboxFactory\", \"tgCurrentUserService\", LeaveProjectDirective]);\n\n  membersFilter = function() {\n    return function(members, filtersQ, filtersRole) {\n      return _.filter(members, function(m) {\n        return (!filtersRole || m.role === filtersRole.id) && (!filtersQ || m.full_name.search(new RegExp(filtersQ, \"i\")) >= 0);\n      });\n    };\n  };\n\n  module.filter('membersFilter', membersFilter);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var EditableWikiContentDirective, WikiDetailController, WikiSummaryDirective, bindOnce, debounce, groupBy, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiDetailController = (function(superClass) {\n    extend(WikiDetailController, superClass);\n\n    WikiDetailController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgModel\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$filter\", \"$log\", \"tgAppMetaService\", \"$tgNavUrls\", \"$tgAnalytics\", \"$translate\"];\n\n    function WikiDetailController(scope, rootscope, repo, model, confirm, rs, params, q, location, filter, log, appMetaService, navUrls, analytics, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.model = model;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.filter = filter;\n      this.log = log;\n      this.appMetaService = appMetaService;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.translate = translate;\n      this.scope.projectSlug = this.params.pslug;\n      this.scope.wikiSlug = this.params.slug;\n      this.scope.wikiTitle = this.scope.wikiSlug;\n      this.scope.sectionName = \"Wiki\";\n      this.scope.linksVisible = false;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          return _this._setMeta();\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    WikiDetailController.prototype._setMeta = function() {\n      var description, ref, ref1, ref2, title;\n      title = this.translate.instant(\"WIKI.PAGE_TITLE\", {\n        wikiPageName: this.scope.wikiTitle,\n        projectName: this.scope.project.name\n      });\n      description = this.translate.instant(\"WIKI.PAGE_DESCRIPTION\", {\n        wikiPageContent: angular.element(((ref = this.scope.wiki) != null ? ref.html : void 0) || \"\").text(),\n        totalEditions: ((ref1 = this.scope.wiki) != null ? ref1.editions : void 0) || 0,\n        lastModifiedDate: moment((ref2 = this.scope.wiki) != null ? ref2.modified_date : void 0).format(this.translate.instant(\"WIKI.DATETIME\"))\n      });\n      return this.appMetaService.setAll(title, description);\n    };\n\n    WikiDetailController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.is_wiki_activated) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWiki = function() {\n      var promise;\n      promise = this.rs.wiki.getBySlug(this.scope.projectId, this.params.slug);\n      promise.then((function(_this) {\n        return function(wiki) {\n          _this.scope.wiki = wiki;\n          _this.scope.wikiId = wiki.id;\n          return _this.scope.wiki;\n        };\n      })(this));\n      return promise.then(null, (function(_this) {\n        return function(xhr) {\n          var data;\n          _this.scope.wikiId = null;\n          if (_this.scope.project.my_permissions.indexOf(\"add_wiki_page\") === -1) {\n            return null;\n          }\n          data = {\n            project: _this.scope.projectId,\n            slug: _this.scope.wikiSlug,\n            content: \"\"\n          };\n          _this.scope.wiki = _this.model.make_model(\"wiki\", data);\n          return _this.scope.wiki;\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadWikiLinks = function() {\n      return this.rs.wiki.listLinks(this.scope.projectId).then((function(_this) {\n        return function(wikiLinks) {\n          var i, len, link, ref, selectedWikiLink;\n          _this.scope.wikiLinks = wikiLinks;\n          ref = _this.scope.wikiLinks;\n          for (i = 0, len = ref.length; i < len; i++) {\n            link = ref[i];\n            link.url = _this.navUrls.resolve(\"project-wiki-page\", {\n              project: _this.scope.projectSlug,\n              slug: link.href\n            });\n          }\n          selectedWikiLink = _.find(wikiLinks, {\n            href: _this.scope.wikiSlug\n          });\n          if (selectedWikiLink != null) {\n            return _this.scope.wikiTitle = selectedWikiLink.title;\n          }\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise.then((function(_this) {\n        return function(project) {\n          _this.fillUsersAndRoles(project.members, project.roles);\n          return _this.q.all([_this.loadWikiLinks(), _this.loadWiki()]).then(_this.checkLinksPerms.bind(_this));\n        };\n      })(this));\n    };\n\n    WikiDetailController.prototype.checkLinksPerms = function() {\n      if (this.scope.project.my_permissions.indexOf(\"modify_wiki_link\") !== -1 || (this.scope.project.my_permissions.indexOf(\"view_wiki_links\") !== -1 && this.scope.wikiLinks.length)) {\n        return this.scope.linksVisible = true;\n      }\n    };\n\n    WikiDetailController.prototype[\"delete\"] = function() {\n      var message, title;\n      title = this.translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n      message = this.scope.wikiTitle;\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            var ctx;\n            askResponse.finish();\n            ctx = {\n              project: _this.scope.projectSlug\n            };\n            _this.location.path(_this.navUrls.resolve(\"project-wiki\", ctx));\n            return _this.confirm.notify(\"success\");\n          };\n          onError = function() {\n            askResponse.finish(false);\n            return _this.confirm.notify(\"error\");\n          };\n          return _this.repo.remove(_this.scope.wiki).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    return WikiDetailController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"WikiDetailController\", WikiDetailController);\n\n  WikiSummaryDirective = function($log, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-summary.html\", true);\n    link = function($scope, $el, $attrs, $model) {\n      var render;\n      render = function(wiki) {\n        var ctx, html, user;\n        if ($scope.usersById == null) {\n          $log.error(\"WikiSummaryDirective requires userById set in scope.\");\n        } else {\n          user = $scope.usersById[wiki.last_modifier];\n        }\n        if (user === void 0) {\n          user = {\n            name: \"unknown\",\n            imgUrl: \"/\" + window._version + \"/images/user-noimage.png\"\n          };\n        } else {\n          user = {\n            name: user.full_name_display,\n            imgUrl: user.photo\n          };\n        }\n        ctx = {\n          totalEditions: wiki.editions,\n          lastModifiedDate: moment(wiki.modified_date).format($translate.instant(\"WIKI.DATETIME\")),\n          user: user\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        return render(wikiPage);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgWikiSummary\", [\"$log\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiSummaryDirective]);\n\n  EditableWikiContentDirective = function($window, $document, $repo, $confirm, $loading, $analytics, $qqueue) {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var cancelEdition, disableEdition, getSelectedText, isEditable, save, switchToEditMode, switchToReadMode;\n      isEditable = function() {\n        return $scope.project.my_permissions.indexOf(\"modify_wiki_page\") !== -1;\n      };\n      switchToEditMode = function() {\n        $el.find('.edit-wiki-content').show();\n        $el.find('.view-wiki-content').hide();\n        return $el.find('textarea').focus();\n      };\n      switchToReadMode = function() {\n        $el.find('.edit-wiki-content').hide();\n        return $el.find('.view-wiki-content').show();\n      };\n      disableEdition = function() {\n        $el.find(\".view-wiki-content .edit\").remove();\n        return $el.find(\".edit-wiki-content\").remove();\n      };\n      cancelEdition = function() {\n        if (!$model.$modelValue.id) {\n          return;\n        }\n        $scope.$apply((function(_this) {\n          return function() {\n            return $model.$modelValue.revert();\n          };\n        })(this));\n        return switchToReadMode();\n      };\n      getSelectedText = function() {\n        if ($window.getSelection) {\n          return $window.getSelection().toString();\n        } else if ($document.selection) {\n          return $document.selection.createRange().text;\n        }\n        return null;\n      };\n      save = $qqueue.bindAdd(function(wiki) {\n        var currentLoading, onError, onSuccess, promise;\n        onSuccess = function(wikiPage) {\n          if (wiki.id == null) {\n            $analytics.trackEvent(\"wikipage\", \"create\", \"create wiki page\", 1);\n          }\n          $model.$setViewValue(wikiPage.clone());\n          $confirm.notify(\"success\");\n          return switchToReadMode();\n        };\n        onError = function() {\n          return $confirm.notify(\"error\");\n        };\n        currentLoading = $loading().removeClasses(\"icon-floppy\").target($el.find('.icon-floppy')).start();\n        if (wiki.id != null) {\n          promise = $repo.save(wiki).then(onSuccess, onError);\n        } else {\n          promise = $repo.create(\"wiki\", wiki).then(onSuccess, onError);\n        }\n        return promise[\"finally\"](function() {\n          return currentLoading.finish();\n        });\n      });\n      $el.on(\"click\", \"a\", function(event) {\n        var href, target;\n        target = angular.element(event.currentTarget);\n        href = target.attr('href');\n        if (href.indexOf(\"#\") === 0) {\n          event.preventDefault();\n          return $('body').scrollTop($(href).offset().top);\n        }\n      });\n      $el.on(\"mousedown\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (!isEditable()) {\n          return;\n        }\n        if (event.button === 2) {\n\n        }\n      });\n      $el.on(\"mouseup\", \".view-wiki-content\", function(event) {\n        var target;\n        target = angular.element(event.target);\n        if (getSelectedText()) {\n          return;\n        }\n        if (!isEditable()) {\n          return;\n        }\n        if (target.is('a')) {\n          return;\n        }\n        if (target.is('pre')) {\n          return;\n        }\n        return switchToEditMode();\n      });\n      $el.on(\"click\", \".save\", debounce(2000, function() {\n        return save($scope.wiki);\n      }));\n      $el.on(\"click\", \".cancel\", function() {\n        return cancelEdition();\n      });\n      $el.on(\"keydown\", \"textarea\", function(event) {\n        if (event.keyCode === 27) {\n          return cancelEdition();\n        }\n      });\n      $scope.$watch($attrs.ngModel, function(wikiPage) {\n        if (!wikiPage) {\n          return;\n        }\n        if (isEditable()) {\n          $el.addClass('editable');\n          if ((wikiPage.id == null) || $.trim(wikiPage.content).length === 0) {\n            return switchToEditMode();\n          }\n        } else {\n          return disableEdition();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\",\n      templateUrl: \"wiki/editable-wiki-content.html\"\n    };\n  };\n\n  module.directive(\"tgEditableWikiContent\", [\"$window\", \"$document\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgAnalytics\", \"$tgQqueue\", EditableWikiContentDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/wiki/detail.coffee\n */\n\n(function() {\n  var WikiNavDirective, bindOnce, groupBy, mixOf, module, taiga;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaWiki\");\n\n  WikiNavDirective = function($tgrepo, $log, $location, $confirm, $analytics, $loading, $template, $compile, $translate) {\n    var link, template;\n    template = $template.get(\"wiki/wiki-nav.html\", true);\n    link = function($scope, $el, $attrs) {\n      var $ctrl, render;\n      $ctrl = $el.controller();\n      if ($attrs.ngModel == null) {\n        return $log.error(\"WikiNavDirective: no ng-model attr is defined\");\n      }\n      render = function(wikiLinks) {\n        var addWikiLinkPermission, deleteWikiLinkPermission, html;\n        addWikiLinkPermission = $scope.project.my_permissions.indexOf(\"add_wiki_link\") > -1;\n        deleteWikiLinkPermission = $scope.project.my_permissions.indexOf(\"delete_wiki_link\") > -1;\n        html = template({\n          wikiLinks: wikiLinks,\n          projectSlug: $scope.projectSlug,\n          addWikiLinkPermission: addWikiLinkPermission,\n          deleteWikiLinkPermission: deleteWikiLinkPermission\n        });\n        html = $compile(html)($scope);\n        $el.off();\n        $el.html(html);\n        $el.on(\"click\", \".add-button\", function(event) {\n          event.preventDefault();\n          $el.find(\".new\").removeClass(\"hidden\");\n          $el.find(\".new input\").focus();\n          return $el.find(\".add-button\").hide();\n        });\n        $el.on(\"click\", \".js-delete-link\", function(event) {\n          var linkId, message, target, title;\n          event.preventDefault();\n          event.stopPropagation();\n          target = angular.element(event.currentTarget);\n          linkId = target.parents('.wiki-link').data('id');\n          title = $translate.instant(\"WIKI.DELETE_LIGHTBOX_TITLE\");\n          message = $scope.wikiLinks[linkId].title;\n          return $confirm.askOnDelete(title, message).then((function(_this) {\n            return function(askResponse) {\n              var promise;\n              promise = $tgrepo.remove($scope.wikiLinks[linkId]);\n              promise.then(function() {\n                promise = $ctrl.loadWikiLinks();\n                promise.then(function() {\n                  askResponse.finish();\n                  return render($scope.wikiLinks);\n                });\n                return promise.then(null, function() {\n                  return askResponse.finish();\n                });\n              });\n              return promise.then(null, function() {\n                askResponse.finish(false);\n                return $confirm.notify(\"error\");\n              });\n            };\n          })(this));\n        });\n        return $el.on(\"keyup\", \".new input\", function(event) {\n          var currentLoading, newLink, promise, target;\n          event.preventDefault();\n          if (event.keyCode === 13) {\n            target = angular.element(event.currentTarget);\n            newLink = target.val();\n            currentLoading = $loading().target($el.find(\".new\")).start();\n            promise = $tgrepo.create(\"wiki-links\", {\n              project: $scope.projectId,\n              title: newLink\n            });\n            promise.then(function() {\n              var loadPromise;\n              $analytics.trackEvent(\"wikilink\", \"create\", \"create wiki link\", 1);\n              loadPromise = $ctrl.loadWikiLinks();\n              loadPromise.then(function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return render($scope.wikiLinks);\n              });\n              return loadPromise.then(null, function() {\n                currentLoading.finish();\n                $el.find(\".new\").addClass(\"hidden\");\n                $el.find(\".new input\").val('');\n                $el.find(\".add-button\").show();\n                return $confirm.notify(\"error\", \"Error loading wiki links\");\n              });\n            });\n            return promise.then(null, function(error) {\n              var ref;\n              currentLoading.finish();\n              $el.find(\".new input\").val(newLink);\n              $el.find(\".new input\").focus().select();\n              if ((error != null ? (ref = error.__all__) != null ? ref[0] : void 0 : void 0) != null) {\n                return $confirm.notify(\"error\", \"The link already exists\");\n              } else {\n                return $confirm.notify(\"error\");\n              }\n            });\n          } else if (event.keyCode === 27) {\n            target = angular.element(event.currentTarget);\n            $el.find(\".new\").addClass(\"hidden\");\n            $el.find(\".new input\").val('');\n            return $el.find(\".add-button\").show();\n          }\n        });\n      };\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWikiNav\", [\"$tgRepo\", \"$log\", \"$tgLocation\", \"$tgConfirm\", \"$tgAnalytics\", \"$tgLoading\", \"$tgTemplate\", \"$compile\", \"$translate\", WikiNavDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/lightboxes.coffee\n */\n\n(function() {\n  var ChangeOwnerLightboxController, ChangeOwnerLightboxDirective, LbRequestOwnershipDirective, LightboxAddMembersController, LightboxAddMembersDirective, LightboxAddMembersWarningMessageDirective, TransferProjectStartSuccessDirective, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaKanban\");\n\n  LightboxAddMembersController = (function() {\n    LightboxAddMembersController.$inject = [\"$scope\", \"lightboxService\", \"tgLoader\", \"$tgConfirm\", \"$tgResources\", \"$rootScope\"];\n\n    function LightboxAddMembersController(scope1, lightboxService1, tgLoader, confirm, rs1, rootScope) {\n      var pendingMembersCount;\n      this.scope = scope1;\n      this.lightboxService = lightboxService1;\n      this.tgLoader = tgLoader;\n      this.confirm = confirm;\n      this.rs = rs1;\n      this.rootScope = rootScope;\n      this._defaultMaxInvites = 4;\n      this._defaultRole = this.project.roles[0].id;\n      this.form = null;\n      this.submitInvites = false;\n      this.canAddUsers = true;\n      this.memberInvites = [];\n      if (this.project.max_memberships === null) {\n        this.membersLimit = this._defaultMaxInvites;\n      } else {\n        pendingMembersCount = Math.max(this.project.max_memberships - this.project.total_memberships, 0);\n        this.membersLimit = Math.min(pendingMembersCount, this._defaultMaxInvites);\n      }\n      this.addSingleMember();\n    }\n\n    LightboxAddMembersController.prototype.addSingleMember = function() {\n      this.memberInvites.push({\n        email: '',\n        role_id: this._defaultRole\n      });\n      if (this.memberInvites.length >= this.membersLimit) {\n        this.canAddUsers = false;\n      }\n      return this.showWarningMessage = !this.canAddUsers && this.project.total_memberships + this.memberInvites.length === this.project.max_memberships;\n    };\n\n    LightboxAddMembersController.prototype.removeSingleMember = function(index) {\n      this.memberInvites.splice(index, 1);\n      this.canAddUsers = true;\n      return this.showWarningMessage = this.membersLimit === 1;\n    };\n\n    LightboxAddMembersController.prototype.submit = function() {\n      var promise;\n      this.form.initializeFields();\n      this.form.reset();\n      if (!this.form.validate()) {\n        return;\n      }\n      this.memberInvites = _.filter(this.memberInvites, function(invites) {\n        return invites.email !== \"\";\n      });\n      this.submitInvites = true;\n      promise = this.rs.memberships.bulkCreateMemberships(this.project.id, this.memberInvites, this.invitationText);\n      return promise.then(this._onSuccessInvite.bind(this), this._onErrorInvite.bind(this));\n    };\n\n    LightboxAddMembersController.prototype._onSuccessInvite = function() {\n      this.submitInvites = false;\n      this.rootScope.$broadcast(\"membersform:new:success\");\n      this.lightboxService.closeAll();\n      return this.confirm.notify(\"success\");\n    };\n\n    LightboxAddMembersController.prototype._onErrorInvite = function(response) {\n      this.submitInvites = false;\n      this.form.setErrors(response.data);\n      if (response.data._error_message) {\n        return this.confirm.notify(\"error\", response.data._error_message);\n      }\n    };\n\n    return LightboxAddMembersController;\n\n  })();\n\n  module.controller(\"LbAddMembersController\", LightboxAddMembersController);\n\n  LightboxAddMembersDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      lightboxService.open(el);\n      return ctrl.form = el.find(\"form\").checksley();\n    };\n    return {\n      scope: {},\n      bindToController: {\n        project: '='\n      },\n      controller: 'LbAddMembersController',\n      controllerAs: 'vm',\n      templateUrl: 'admin/lightbox-add-members.html',\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbAddMembers\", [\"lightboxService\", LightboxAddMembersDirective]);\n\n  LightboxAddMembersWarningMessageDirective = function() {\n    return {\n      templateUrl: \"admin/lightbox-add-members-no-more=memberships-warning-message.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgLightboxAddMembersWarningMessage\", [LightboxAddMembersWarningMessageDirective]);\n\n  LbRequestOwnershipDirective = function(lightboxService, rs, confirmService, $translate) {\n    return {\n      link: function(scope, el) {\n        lightboxService.open(el);\n        return scope.request = function() {\n          scope.loading = true;\n          return rs.projects.transferRequest(scope.projectId).then(function() {\n            scope.loading = false;\n            lightboxService.close(el);\n            return confirmService.notify(\"success\", $translate.instant(\"ADMIN.PROJECT_PROFILE.REQUEST_OWNERSHIP_SUCCESS\"));\n          });\n        };\n      },\n      templateUrl: \"common/lightbox/lightbox-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgLbRequestOwnership', [\"lightboxService\", \"tgResources\", \"$tgConfirm\", \"$translate\", LbRequestOwnershipDirective]);\n\n  ChangeOwnerLightboxController = (function() {\n    function ChangeOwnerLightboxController(rs1, lightboxService1, confirm, translate) {\n      this.rs = rs1;\n      this.lightboxService = lightboxService1;\n      this.confirm = confirm;\n      this.translate = translate;\n      this.users = [];\n      this.q = \"\";\n      this.commentOpen = false;\n    }\n\n    ChangeOwnerLightboxController.prototype.limit = 3;\n\n    ChangeOwnerLightboxController.prototype.normalizeString = function(normalizedString) {\n      normalizedString = normalizedString.replace(\"\", \"A\").replace(\"\", \"A\").replace(\"\", \"A\");\n      normalizedString = normalizedString.replace(\"\", \"E\").replace(\"\", \"E\").replace(\"\", \"E\");\n      normalizedString = normalizedString.replace(\"\", \"I\").replace(\"\", \"I\").replace(\"\", \"I\");\n      normalizedString = normalizedString.replace(\"\", \"O\").replace(\"\", \"O\").replace(\"\", \"O\");\n      normalizedString = normalizedString.replace(\"\", \"U\").replace(\"\", \"U\").replace(\"\", \"U\");\n      return normalizedString;\n    };\n\n    ChangeOwnerLightboxController.prototype.filterUsers = function(user) {\n      var text, username;\n      username = user.full_name_display.toUpperCase();\n      username = this.normalizeString(username);\n      text = this.q.toUpperCase();\n      text = this.normalizeString(text);\n      return _.includes(username, text);\n    };\n\n    ChangeOwnerLightboxController.prototype.getUsers = function() {\n      var users;\n      if (!this.users.length && !this.q.length) {\n        users = this.activeUsers;\n      } else {\n        users = this.users;\n      }\n      users = users.slice(0, this.limit);\n      users = _.reject(users, {\n        \"selected\": true\n      });\n      return _.reject(users, {\n        \"id\": this.currentOwnerId\n      });\n    };\n\n    ChangeOwnerLightboxController.prototype.userSearch = function() {\n      this.users = this.activeUsers;\n      this.selected = _.find(this.users, {\n        \"selected\": true\n      });\n      if (this.q) {\n        return this.users = _.filter(this.users, this.filterUsers.bind(this));\n      }\n    };\n\n    ChangeOwnerLightboxController.prototype.selectUser = function(user) {\n      this.activeUsers = _.map(this.activeUsers, function(user) {\n        user.selected = false;\n        return user;\n      });\n      user.selected = true;\n      return this.userSearch();\n    };\n\n    ChangeOwnerLightboxController.prototype.submit = function() {\n      this.loading = true;\n      return this.rs.projects.transferStart(this.projectId, this.selected.id, this.comment).then((function(_this) {\n        return function() {\n          var desc, title;\n          _this.loading = false;\n          _this.lightboxService.closeAll();\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_TITLE\");\n          desc = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.CHANGE_OWNER_SUCCESS_DESC\");\n          return _this.confirm.success(title, desc, {\n            type: \"svg\",\n            name: \"icon-speak-up\"\n          });\n        };\n      })(this));\n    };\n\n    return ChangeOwnerLightboxController;\n\n  })();\n\n  ChangeOwnerLightboxController.$inject = [\"tgResources\", \"lightboxService\", \"$tgConfirm\", \"$translate\"];\n\n  module.controller('ChangeOwnerLightbox', ChangeOwnerLightboxController);\n\n  ChangeOwnerLightboxDirective = function(lightboxService, lightboxKeyboardNavigationService, $template, $compile) {\n    var link;\n    link = function(scope, el) {\n      return lightboxService.open(el);\n    };\n    return {\n      scope: true,\n      controller: \"ChangeOwnerLightbox\",\n      controllerAs: \"vm\",\n      bindToController: {\n        currentOwnerId: \"=\",\n        projectId: \"=\",\n        activeUsers: \"=\"\n      },\n      templateUrl: \"common/lightbox/lightbox-change-owner.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbChangeOwner\", [\"lightboxService\", \"lightboxKeyboardNavigationService\", \"$tgTemplate\", \"$compile\", ChangeOwnerLightboxDirective]);\n\n  TransferProjectStartSuccessDirective = function(lightboxService) {\n    var link;\n    link = function(scope, el) {\n      scope.close = function() {\n        return lightboxService.close(el);\n      };\n      return lightboxService.open(el);\n    };\n    return {\n      templateUrl: \"common/lightbox/lightbox-transfer-project-start-success.html\",\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbTransferProjectStartSuccess\", [\"lightboxService\", TransferProjectStartSuccessDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var MembershipsController, MembershipsDirective, MembershipsRowActionsDirective, MembershipsRowAdminCheckboxDirective, MembershipsRowAvatarDirective, MembershipsRowRoleSelectorDirective, NoMoreMembershipsExplanationDirective, bindMethods, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  MembershipsController = (function(superClass) {\n    extend(MembershipsController, superClass);\n\n    MembershipsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAnalytics\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgLightboxFactory\"];\n\n    function MembershipsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, analytics, appMetaService, translate, auth, lightboxFactory1) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.analytics = analytics;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.auth = auth;\n      this.lightboxFactory = lightboxFactory1;\n      bindMethods(this);\n      this.scope.project = {};\n      this.scope.filters = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.MEMBERSHIPS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"membersform:new:success\", (function(_this) {\n        return function() {\n          _this.loadInitialData();\n          return _this.analytics.trackEvent(\"membership\", \"create\", \"create memberships on admin\", 1);\n        };\n      })(this));\n    }\n\n    MembershipsController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.canAddUsers = project.max_memberships === null || project.max_memberships > project.total_memberships;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadMembers = function() {\n      var httpFilters;\n      httpFilters = this.getUrlFilters();\n      return this.rs.memberships.list(this.scope.projectId, httpFilters).then((function(_this) {\n        return function(data) {\n          _this.scope.memberships = _.filter(data.models, function(membership) {\n            return membership.user === null || membership.is_user_active;\n          });\n          _this.scope.page = data.current;\n          _this.scope.count = data.count;\n          _this.scope.paginatedBy = data.paginatedBy;\n          return data;\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.loadInitialData = function() {\n      return this.loadProject().then((function(_this) {\n        return function() {\n          return _this.q.all([_this.loadMembers(), _this.auth.refresh()]);\n        };\n      })(this));\n    };\n\n    MembershipsController.prototype.getUrlFilters = function() {\n      var filters;\n      filters = _.pick(this.location.search(), \"page\");\n      if (!filters.page) {\n        filters.page = 1;\n      }\n      return filters;\n    };\n\n    MembershipsController.prototype.addNewMembers = function() {\n      return this.lightboxFactory.create('tg-lb-add-members', {\n        \"class\": \"lightbox lightbox-add-member\",\n        \"project\": \"project\"\n      }, {\n        \"project\": this.scope.project\n      });\n    };\n\n    MembershipsController.prototype.showLimitUsersWarningMessage = function() {\n      var icon, message, title;\n      title = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING\");\n      message = this.translate.instant(\"ADMIN.MEMBERSHIPS.LIMIT_USERS_WARNING_MESSAGE\", {\n        members: this.scope.project.max_memberships\n      });\n      icon = \"/\" + window._version + \"/svg/icons/team-question.svg\";\n      return this.confirm.success(title, message, {\n        name: icon,\n        type: \"img\"\n      });\n    };\n\n    return MembershipsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"MembershipsController\", MembershipsController);\n\n  MembershipsDirective = function($template, $compile) {\n    var link, linkPagination, template;\n    template = $template.get(\"admin/admin-membership-paginator.html\", true);\n    linkPagination = function($scope, $el, $attrs, $ctrl) {\n      var $pagEl, afterCurrent, atBegin, atEnd, beforeCurrent, getNumPages, renderPagination;\n      afterCurrent = 2;\n      beforeCurrent = 4;\n      atBegin = 2;\n      atEnd = 2;\n      $pagEl = $el.find(\".memberships-paginator\");\n      getNumPages = function() {\n        var numPages;\n        numPages = $scope.count / $scope.paginatedBy;\n        if (parseInt(numPages, 10) < numPages) {\n          numPages = parseInt(numPages, 10) + 1;\n        } else {\n          numPages = parseInt(numPages, 10);\n        }\n        return numPages;\n      };\n      renderPagination = function() {\n        var cpage, html, i, j, numPages, options, pages, ref;\n        numPages = getNumPages();\n        if (numPages <= 1) {\n          $pagEl.hide();\n          return;\n        }\n        pages = [];\n        options = {};\n        options.pages = pages;\n        options.showPrevious = $scope.page > 1;\n        options.showNext = !($scope.page === numPages);\n        cpage = $scope.page;\n        for (i = j = 1, ref = numPages; 1 <= ref ? j <= ref : j >= ref; i = 1 <= ref ? ++j : --j) {\n          if (i === (cpage + afterCurrent) && numPages > (cpage + afterCurrent + atEnd)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i === (cpage - beforeCurrent) && cpage > (atBegin + beforeCurrent)) {\n            pages.push({\n              classes: \"dots\",\n              type: \"dots\"\n            });\n          } else if (i > (cpage + afterCurrent) && i <= (numPages - atEnd)) {\n\n          } else if (i < (cpage - beforeCurrent) && i > atBegin) {\n\n          } else if (i === cpage) {\n            pages.push({\n              classes: \"active\",\n              num: i,\n              type: \"page-active\"\n            });\n          } else {\n            pages.push({\n              classes: \"page\",\n              num: i,\n              type: \"page\"\n            });\n          }\n        }\n        html = template(options);\n        html = $compile(html)($scope);\n        $pagEl.html(html);\n        return $pagEl.show();\n      };\n      $scope.$watch(\"memberships\", function(value) {\n        if (!value) {\n          return;\n        }\n        return renderPagination();\n      });\n      $el.on(\"click\", \".memberships-paginator a.next\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page + 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      $el.on(\"click\", \".memberships-paginator a.previous\", function(event) {\n        event.preventDefault();\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", $scope.page - 1);\n          return $ctrl.loadMembers();\n        });\n      });\n      return $el.on(\"click\", \".memberships-paginator li.page > a\", function(event) {\n        var pagenum, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        pagenum = target.data(\"pagenum\");\n        return $scope.$apply(function() {\n          $ctrl.selectFilter(\"page\", pagenum);\n          return $ctrl.loadMembers();\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      linkPagination($scope, $el, $attrs, $ctrl);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMemberships\", [\"$tgTemplate\", \"$compile\", MembershipsDirective]);\n\n  MembershipsRowAvatarDirective = function($log, $template, $translate, $compile) {\n    var link, template;\n    template = $template.get(\"admin/memberships-row-avatar.html\", true);\n    link = function($scope, $el, $attrs) {\n      var member, pending, render;\n      pending = $translate.instant(\"ADMIN.MEMBERSHIP.STATUS_PENDING\");\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          full_name: member.full_name ? member.full_name : \"\",\n          email: member.user_email ? member.user_email : member.email,\n          imgurl: member.photo ? member.photo : \"/\" + window._version + \"/images/unnamed.png\",\n          pending: !member.is_user_active ? pending : \"\",\n          isOwner: member.is_owner\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowAvatar == null) {\n        return $log.error(\"MembershipsRowAvatarDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAvatar);\n      render(member);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAvatar\", [\"$log\", \"$tgTemplate\", '$translate', \"$compile\", MembershipsRowAvatarDirective]);\n\n  MembershipsRowAdminCheckboxDirective = function($log, $repo, $confirm, $template, $compile) {\n    var link, template;\n    template = $template.get(\"admin/admin-memberships-row-checkbox.html\", true);\n    link = function($scope, $el, $attrs) {\n      var html, member, render;\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      if ($attrs.tgMembershipsRowAdminCheckbox == null) {\n        return $log.error(\"MembershipsRowAdminCheckboxDirective: the directive need a member\");\n      }\n      member = $scope.$eval($attrs.tgMembershipsRowAdminCheckbox);\n      if (member.is_owner) {\n        $el.find(\".js-check\").remove();\n        return;\n      }\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          inputId: \"is-admin-\" + member.id\n        };\n        html = template(ctx);\n        html = $compile(html)($scope);\n        return $el.html(html);\n      };\n      $el.on(\"click\", \":checkbox\", (function(_this) {\n        return function(event) {\n          var onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function(data) {\n            member.revert();\n            $el.find(\":checkbox\").prop(\"checked\", member.is_admin);\n            return $confirm.notify(\"error\", data.is_admin[0]);\n          };\n          target = angular.element(event.currentTarget);\n          member.is_admin = target.prop(\"checked\");\n          return $repo.save(member).then(onSuccess, onError);\n        };\n      })(this));\n      html = render(member);\n      if (member.is_admin) {\n        return $el.find(\":checkbox\").prop(\"checked\", true);\n      }\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowAdminCheckbox\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgTemplate\", \"$compile\", MembershipsRowAdminCheckboxDirective]);\n\n  MembershipsRowRoleSelectorDirective = function($log, $repo, $confirm) {\n    var link, template;\n    template = _.template(\"<select>\\n    <% _.each(roleList, function(role) { %>\\n    <option value=\\\"<%- role.id %>\\\" <% if(selectedRole === role.id){ %>selected=\\\"selected\\\"<% } %>>\\n        <%- role.name %>\\n    </option>\\n    <% }); %>\\n</select>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, html, member, render;\n      render = function(member) {\n        var ctx, html;\n        ctx = {\n          roleList: $scope.project.roles,\n          selectedRole: member.role\n        };\n        html = template(ctx);\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowRoleSelector == null) {\n        return $log.error(\"MembershipsRowRoleSelectorDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowRoleSelector);\n      html = render(member);\n      $el.on(\"change\", \"select\", (function(_this) {\n        return function(event) {\n          var newRole, onError, onSuccess, target;\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          target = angular.element(event.currentTarget);\n          newRole = parseInt(target.val(), 10);\n          if (member.role !== newRole) {\n            member.role = newRole;\n            return $repo.save(member).then(onSuccess, onError);\n          }\n        };\n      })(this));\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowRoleSelector\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", MembershipsRowRoleSelectorDirective]);\n\n  MembershipsRowActionsDirective = function($log, $repo, $rs, $confirm, $compile, $translate, $location, $navUrls, lightboxFactory) {\n    var activedTemplate, link, pendingTemplate;\n    activedTemplate = \"<div class=\\\"active\\\"\\n     translate=\\\"ADMIN.MEMBERSHIP.STATUS_ACTIVE\\\">\\n</div>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <tg-svg svg-icon=\\\"icon-trash\\\"></tg-svg>\\n</a>\";\n    pendingTemplate = \"<a class=\\\"resend js-resend\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.RESEND' | translate }}\\\"\\n   translate=\\\"ADMIN.MEMBERSHIP.RESEND\\\">\\n</a>\\n<a class=\\\"delete\\\" href=\\\"\\\"\\n   title=\\\"{{ 'ADMIN.MEMBERSHIP.DELETE_MEMBER' | translate }}\\\">\\n    <tg-svg svg-icon=\\\"icon-trash\\\"></tg-svg>\\n</a>\";\n    link = function($scope, $el, $attrs) {\n      var $ctrl, leaveConfirm, member, render;\n      render = function(member) {\n        var html;\n        if (member.user) {\n          html = $compile(activedTemplate)($scope);\n        } else {\n          html = $compile(pendingTemplate)($scope);\n        }\n        return $el.html(html);\n      };\n      if ($attrs.tgMembershipsRowActions == null) {\n        return $log.error(\"MembershipsRowActionsDirective: the directive need a member\");\n      }\n      $ctrl = $el.controller();\n      member = $scope.$eval($attrs.tgMembershipsRowActions);\n      render(member);\n      $el.on(\"click\", \".js-resend\", function(event) {\n        var onError, onSuccess;\n        event.preventDefault();\n        onSuccess = function() {\n          var text;\n          text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_SEND_INVITATION\", {\n            email: $scope.member.email\n          });\n          return $confirm.notify(\"success\", text);\n        };\n        onError = function() {\n          var text;\n          text = $translate.instant(\"ADMIM.MEMBERSHIP.ERROR_SEND_INVITATION\");\n          return $confirm.notify(\"error\", text);\n        };\n        return $rs.memberships.resendInvitation($scope.member.id).then(onSuccess, onError);\n      });\n      leaveConfirm = function() {\n        var defaultMsg, message, title;\n        title = $translate.instant(\"ADMIN.MEMBERSHIP.DELETE_MEMBER\");\n        defaultMsg = $translate.instant(\"ADMIN.MEMBERSHIP.DEFAULT_DELETE_MESSAGE\", {\n          email: member.email\n        });\n        message = member.user ? member.full_name : defaultMsg;\n        return $confirm.askOnDelete(title, message).then(function(askResponse) {\n          var onError, onSuccess;\n          onSuccess = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish();\n              if (member.user !== $scope.user.id) {\n                if ($scope.page > 1 && ($scope.count - 1) <= $scope.paginatedBy) {\n                  $ctrl.selectFilter(\"page\", $scope.page - 1);\n                }\n                $ctrl.loadInitialData();\n              } else {\n                $location.path($navUrls.resolve(\"home\"));\n              }\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.SUCCESS_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"success\", text, null, 5000);\n            };\n          })(this);\n          onError = (function(_this) {\n            return function() {\n              var text;\n              askResponse.finish(false);\n              text = $translate.instant(\"ADMIN.MEMBERSHIP.ERROR_DELETE\", {\n                message: message\n              });\n              return $confirm.notify(\"error\", text);\n            };\n          })(this);\n          return $repo.remove(member).then(onSuccess, onError);\n        });\n      };\n      $el.on(\"click\", \".delete\", function(event) {\n        var isCurrentUser;\n        event.preventDefault();\n        if ($scope.project.owner.id === member.user) {\n          isCurrentUser = $scope.user.id === member.user;\n          return lightboxFactory.create(\"tg-lightbox-leave-project-warning\", {\n            \"class\": \"lightbox lightbox-leave-project-warning\"\n          }, {\n            isCurrentUser: isCurrentUser,\n            project: $scope.project\n          });\n        } else {\n          return leaveConfirm();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgMembershipsRowActions\", [\"$log\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\", \"$compile\", \"$translate\", \"$tgLocation\", \"$tgNavUrls\", \"tgLightboxFactory\", MembershipsRowActionsDirective]);\n\n  NoMoreMembershipsExplanationDirective = function() {\n    return {\n      templateUrl: \"admin/no-more-memberships-explanation.html\",\n      scope: {\n        project: \"=\"\n      }\n    };\n  };\n\n  module.directive(\"tgNoMoreMembershipsExplanation\", [NoMoreMembershipsExplanationDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/nav.coffee\n */\n\n(function() {\n  var AdminNavigationDirective, module;\n\n  AdminNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgAdminNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#adminmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaAdmin\");\n\n  module.directive(\"tgAdminNavigation\", AdminNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var AdminProjectChangeOwnerDirective, AdminProjectRequestOwnershipDirective, AdminProjectRestrictionsDirective, CsvExporterController, CsvExporterIssuesController, CsvExporterTasksController, CsvExporterUserstoriesController, CsvIssueDirective, CsvTaskDirective, CsvUsDirective, ProjectDefaultValuesDirective, ProjectExportDirective, ProjectLogoDirective, ProjectLogoModelDirective, ProjectModulesDirective, ProjectProfileController, ProjectProfileDirective, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectProfileController = (function(superClass) {\n    extend(ProjectProfileController, superClass);\n\n    ProjectProfileController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\", \"$tgAuth\", \"tgCurrentUserService\"];\n\n    function ProjectProfileController(scope1, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate, tgAuth, currentUserService1) {\n      var promise;\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.tgAuth = tgAuth;\n      this.currentUserService = currentUserService1;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          _this.appMetaService.setAll(title, description);\n          return _this.fillUsersAndRoles(_this.scope.project.members, _this.scope.project.roles);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_PROFILE.PAGE_TITLE\", {\n            sectionName: sectionName,\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectProfileController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.pointsList = _.sortBy(project.points, \"order\");\n          _this.scope.usStatusList = _.sortBy(project.us_statuses, \"order\");\n          _this.scope.taskStatusList = _.sortBy(project.task_statuses, \"order\");\n          _this.scope.prioritiesList = _.sortBy(project.priorities, \"order\");\n          _this.scope.severitiesList = _.sortBy(project.severities, \"order\");\n          _this.scope.issueTypesList = _.sortBy(project.issue_types, \"order\");\n          _this.scope.issueStatusList = _.sortBy(project.issue_statuses, \"order\");\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectProfileController.prototype.loadInitialData = function() {\n      return this.q.all([this.loadProject(), this.tgAuth.refresh()]);\n    };\n\n    ProjectProfileController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.project);\n    };\n\n    return ProjectProfileController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectProfileController\", ProjectProfileController);\n\n  ProjectProfileDirective = function($repo, $confirm, $loading, $navurls, $location, projectService, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, form, submit, submitButton;\n      $ctrl = $el.controller();\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            var newUrl;\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            newUrl = $navurls.resolve(\"project-admin-project-profile-details\", {\n              project: $scope.project.slug\n            });\n            $location.path(newUrl);\n            $ctrl.loadInitialData();\n            projectService.fetchProject();\n            return currentUserService.loadProjects();\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectProfile\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$tgNavUrls\", \"$tgLocation\", \"tgProjectService\", \"tgCurrentUserService\", ProjectProfileDirective]);\n\n  ProjectDefaultValuesDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectDefaultValues\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", ProjectDefaultValuesDirective]);\n\n  ProjectModulesDirective = function($repo, $confirm, $loading, projectService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = (function(_this) {\n        return function() {\n          var form, promise;\n          form = $el.find(\"form\").checksley();\n          form.initializeFields();\n          form.reset();\n          if (!form.validate()) {\n            return;\n          }\n          promise = $repo.save($scope.project);\n          promise.then(function() {\n            $scope.$emit(\"project:loaded\", $scope.project);\n            $confirm.notify(\"success\");\n            return projectService.fetchProject();\n          });\n          return promise.then(null, function(data) {\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this);\n      $el.on(\"change\", \".module-activation.module-direct-active input\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"submit\", \"form\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n      $el.on(\"keydown\", \".videoconference-attributes input\", function(e) {\n        return e.which !== 32;\n      });\n      $scope.$watch(\"project.videoconferences\", function(newVal, oldVal) {\n        if ((newVal != null) && (oldVal != null) && newVal !== oldVal) {\n          return $scope.project.videoconferences_extra_data = \"\";\n        }\n      });\n      $scope.$watch(\"isVideoconferenceActivated\", function(newValue, oldValue) {\n        if (newValue === false) {\n          $scope.project.videoconferences = null;\n          $scope.project.videoconferences_extra_data = \"\";\n          if (oldValue === true) {\n            return submit();\n          }\n        }\n      });\n      return $scope.$watch(\"project\", function(project) {\n        if (project.videoconferences != null) {\n          return $scope.isVideoconferenceActivated = true;\n        } else {\n          return $scope.isVideoconferenceActivated = false;\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectModules\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"tgProjectService\", ProjectModulesDirective]);\n\n  ProjectExportDirective = function($window, $rs, $confirm, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var asyn_message, buttonsEl, dump_ready_text, hideButtons, hideResult, hideSpinner, loading_msg, loading_title, resultEl, resultMessageEl, resultTitleEl, setAsyncMessage, setAsyncTitle, setLoadingMessage, setLoadingTitle, setSyncMessage, setSyncTitle, showButtons, showErrorMode, showExportResultAsyncMode, showExportResultSyncMode, showLoadingMode, showResult, showSpinner, spinnerEl, syn_message;\n      buttonsEl = $el.find(\".admin-project-export-buttons\");\n      showButtons = function() {\n        return buttonsEl.removeClass(\"hidden\");\n      };\n      hideButtons = function() {\n        return buttonsEl.addClass(\"hidden\");\n      };\n      resultEl = $el.find(\".admin-project-export-result\");\n      showResult = function() {\n        return resultEl.removeClass(\"hidden\");\n      };\n      hideResult = function() {\n        return resultEl.addClass(\"hidden\");\n      };\n      spinnerEl = $el.find(\".spin\");\n      showSpinner = function() {\n        return spinnerEl.removeClass(\"hidden\");\n      };\n      hideSpinner = function() {\n        return spinnerEl.addClass(\"hidden\");\n      };\n      resultTitleEl = $el.find(\".result-title\");\n      loading_title = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_TITLE\");\n      loading_msg = $translate.instant(\"ADMIN.PROJECT_EXPORT.LOADING_MESSAGE\");\n      dump_ready_text = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.DUMP_READY\"));\n      };\n      asyn_message = function() {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.ASYNC_MESSAGE\"));\n      };\n      syn_message = function(url) {\n        return resultTitleEl.html($translate.instant(\"ADMIN.PROJECT_EXPORT.SYNC_MESSAGE\", {\n          url: url\n        }));\n      };\n      setLoadingTitle = function() {\n        return resultTitleEl.html(loading_title);\n      };\n      setAsyncTitle = function() {\n        return resultTitleEl.html(loading_msg);\n      };\n      setSyncTitle = function() {\n        return resultTitleEl.html(dump_ready_text);\n      };\n      resultMessageEl = $el.find(\".result-message \");\n      setLoadingMessage = function() {\n        return resultMessageEl.html(loading_msg);\n      };\n      setAsyncMessage = function() {\n        return resultMessageEl.html(asyn_message);\n      };\n      setSyncMessage = function(url) {\n        return resultMessageEl.html(syn_message(url));\n      };\n      showLoadingMode = function() {\n        showSpinner();\n        setLoadingTitle();\n        setLoadingMessage();\n        hideButtons();\n        return showResult();\n      };\n      showExportResultAsyncMode = function() {\n        hideSpinner();\n        setAsyncTitle();\n        return setAsyncMessage();\n      };\n      showExportResultSyncMode = function(url) {\n        hideSpinner();\n        setSyncTitle();\n        return setSyncMessage(url);\n      };\n      showErrorMode = function() {\n        hideSpinner();\n        hideResult();\n        return showButtons();\n      };\n      return $el.on(\"click\", \"a.button-export\", debounce(2000, (function(_this) {\n        return function(event) {\n          var onError, onSuccess;\n          event.preventDefault();\n          onSuccess = function(result) {\n            var dumpUrl;\n            if (result.status === 202) {\n              return showExportResultAsyncMode();\n            } else {\n              dumpUrl = result.data.url;\n              showExportResultSyncMode(dumpUrl);\n              return $window.open(dumpUrl, \"_blank\");\n            }\n          };\n          onError = function(result) {\n            var errorMsg, ref;\n            showErrorMode();\n            errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR\");\n            if (result.status === 429) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\");\n            } else if ((ref = result.data) != null ? ref._error_message : void 0) {\n              errorMsg = $translate.instant(\"ADMIN.PROJECT_EXPORT.ERROR_BUSY\", {\n                message: result.data._error_message\n              });\n            }\n            return $confirm.notify(\"error\", errorMsg);\n          };\n          showLoadingMode();\n          return $rs.projects[\"export\"]($scope.projectId).then(onSuccess, onError);\n        };\n      })(this)));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectExport\", [\"$window\", \"$tgResources\", \"$tgConfirm\", \"$translate\", ProjectExportDirective]);\n\n  CsvExporterController = (function(superClass) {\n    extend(CsvExporterController, superClass);\n\n    CsvExporterController.$inject = [\"$scope\", \"$rootScope\", \"$tgUrls\", \"$tgConfirm\", \"$tgResources\", \"$translate\"];\n\n    function CsvExporterController(scope1, rootscope, urls, confirm, rs, translate) {\n      this.scope = scope1;\n      this.rootscope = rootscope;\n      this.urls = urls;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.translate = translate;\n      this._generateUuid = bind(this._generateUuid, this);\n      this.setCsvUuid = bind(this.setCsvUuid, this);\n      this.rootscope.$on(\"project:loaded\", this.setCsvUuid);\n      this.scope.$watch(\"csvUuid\", (function(_this) {\n        return function(value) {\n          if (value) {\n            return _this.scope.csvUrl = _this.urls.resolveAbsolute(_this.type + \"-csv\", value);\n          } else {\n            return _this.scope.csvUrl = \"\";\n          }\n        };\n      })(this));\n    }\n\n    CsvExporterController.prototype.setCsvUuid = function() {\n      return this.scope.csvUuid = this.scope.project[this.type + \"_csv_uuid\"];\n    };\n\n    CsvExporterController.prototype._generateUuid = function(response) {\n      var promise;\n      if (response == null) {\n        response = null;\n      }\n      promise = this.rs.projects[\"regenerate_\" + this.type + \"_csv_uuid\"](this.scope.projectId);\n      promise.then((function(_this) {\n        return function(data) {\n          var ref;\n          return _this.scope.csvUuid = (ref = data.data) != null ? ref.uuid : void 0;\n        };\n      })(this));\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n      promise[\"finally\"](function() {\n        if (response) {\n          return response.finish();\n        }\n      });\n      return promise;\n    };\n\n    CsvExporterController.prototype.regenerateUuid = function() {\n      var subtitle, title;\n      if (this.scope.csvUuid) {\n        title = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_TITLE\");\n        subtitle = this.translate.instant(\"ADMIN.REPORTS.REGENERATE_SUBTITLE\");\n        return this.confirm.ask(title, subtitle).then(this._generateUuid);\n      } else {\n        return this._generateUuid();\n      }\n    };\n\n    return CsvExporterController;\n\n  })(taiga.Controller);\n\n  CsvExporterUserstoriesController = (function(superClass) {\n    extend(CsvExporterUserstoriesController, superClass);\n\n    function CsvExporterUserstoriesController() {\n      return CsvExporterUserstoriesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterUserstoriesController.prototype.type = \"userstories\";\n\n    return CsvExporterUserstoriesController;\n\n  })(CsvExporterController);\n\n  CsvExporterTasksController = (function(superClass) {\n    extend(CsvExporterTasksController, superClass);\n\n    function CsvExporterTasksController() {\n      return CsvExporterTasksController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterTasksController.prototype.type = \"tasks\";\n\n    return CsvExporterTasksController;\n\n  })(CsvExporterController);\n\n  CsvExporterIssuesController = (function(superClass) {\n    extend(CsvExporterIssuesController, superClass);\n\n    function CsvExporterIssuesController() {\n      return CsvExporterIssuesController.__super__.constructor.apply(this, arguments);\n    }\n\n    CsvExporterIssuesController.prototype.type = \"issues\";\n\n    return CsvExporterIssuesController;\n\n  })(CsvExporterController);\n\n  module.controller(\"CsvExporterUserstoriesController\", CsvExporterUserstoriesController);\n\n  module.controller(\"CsvExporterTasksController\", CsvExporterTasksController);\n\n  module.controller(\"CsvExporterIssuesController\", CsvExporterIssuesController);\n\n  CsvUsDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_US\";\n    };\n    return {\n      controller: \"CsvExporterUserstoriesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvUs\", [\"$translate\", CsvUsDirective]);\n\n  CsvTaskDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_TASK\";\n    };\n    return {\n      controller: \"CsvExporterTasksController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvTask\", [\"$translate\", CsvTaskDirective]);\n\n  CsvIssueDirective = function($translate) {\n    var link;\n    link = function($scope) {\n      return $scope.sectionTitle = \"ADMIN.CSV.SECTION_TITLE_ISSUE\";\n    };\n    return {\n      controller: \"CsvExporterIssuesController\",\n      controllerAs: \"ctrl\",\n      templateUrl: \"admin/project-csv.html\",\n      link: link,\n      scope: true\n    };\n  };\n\n  module.directive(\"tgCsvIssue\", [\"$translate\", CsvIssueDirective]);\n\n  ProjectLogoDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").addClass(\"active\");\n      };\n      onSuccess = function(response) {\n        var project;\n        project = $model.make_model(\"projects\", response.data);\n        $scope.project = project;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-logo\", function() {\n        return $el.find(\"#logo-field\").click();\n      });\n      $el.on(\"change\", \"#logo-field\", function(event) {\n        if ($scope.logoAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.projects.changeLogo($scope.project.id, $scope.logoAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-default-logo\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.projects.removeLogo($scope.project.id).then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectLogo\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", ProjectLogoDirective]);\n\n  ProjectLogoModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgProjectLogoModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgProjectLogoModel', ['$parse', ProjectLogoModelDirective]);\n\n  AdminProjectRestrictionsDirective = function() {\n    return {\n      scope: {\n        \"project\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-restrictions.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRestrictions', [AdminProjectRestrictionsDirective]);\n\n  AdminProjectRequestOwnershipDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.requestOwnership = function() {\n          return lightboxFactory.create(\"tg-lb-request-ownership\", {\n            \"class\": \"lightbox lightbox-request-ownership\"\n          }, {\n            projectId: scope.projectId\n          });\n        };\n      },\n      scope: {\n        \"projectId\": \"=\",\n        \"owner\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-request-ownership.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectRequestOwnership', [\"tgLightboxFactory\", AdminProjectRequestOwnershipDirective]);\n\n  AdminProjectChangeOwnerDirective = function(lightboxFactory) {\n    return {\n      link: function(scope) {\n        return scope.changeOwner = function() {\n          return lightboxFactory.create(\"tg-lb-change-owner\", {\n            \"class\": \"lightbox lightbox-select-user\",\n            \"project-id\": \"projectId\",\n            \"active-users\": \"activeUsers\",\n            \"current-owner-id\": \"currentOwnerId\"\n          }, {\n            projectId: scope.projectId,\n            activeUsers: scope.activeUsers,\n            currentOwnerId: scope.owner.id,\n            members: scope.members\n          });\n        };\n      },\n      scope: {\n        \"activeUsers\": \"=\",\n        \"projectId\": \"=\",\n        \"owner\": \"=\",\n        \"members\": \"=\"\n      },\n      templateUrl: \"admin/admin-project-change-owner.html\"\n    };\n  };\n\n  module.directive('tgAdminProjectChangeOwner', [\"tgLightboxFactory\", AdminProjectChangeOwnerDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/project-profile.coffee\n */\n\n(function() {\n  var ColorSelectionDirective, DATE_TYPE, MULTILINE_TYPE, ProjectCustomAttributesController, ProjectCustomAttributesDirective, ProjectValuesController, ProjectValuesDirective, ProjectValuesSectionController, TEXT_TYPE, TYPE_CHOICES, URL_TYPE, bindOnce, debounce, groupBy, joinStr, mixOf, module, taiga, toString, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  trim = this.taiga.trim;\n\n  toString = this.taiga.toString;\n\n  joinStr = this.taiga.joinStr;\n\n  groupBy = this.taiga.groupBy;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaAdmin\");\n\n  ProjectValuesSectionController = (function(superClass) {\n    extend(ProjectValuesSectionController, superClass);\n\n    ProjectValuesSectionController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectValuesSectionController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, sectionName, title;\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.PROJECT_VALUES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    ProjectValuesSectionController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ProjectValuesSectionController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      return promise;\n    };\n\n    return ProjectValuesSectionController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectValuesSectionController\", ProjectValuesSectionController);\n\n  ProjectValuesController = (function(superClass) {\n    extend(ProjectValuesController, superClass);\n\n    ProjectValuesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\"];\n\n    function ProjectValuesController(scope, rootscope, repo, confirm, rs) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.moveValue = bind(this.moveValue, this);\n      this.loadValues = bind(this.loadValues, this);\n      this.scope.$on(\"admin:project-values:move\", this.moveValue);\n      this.rootscope.$on(\"project:loaded\", this.loadValues);\n    }\n\n    ProjectValuesController.prototype.loadValues = function() {\n      return this.rs[this.scope.resource].listValues(this.scope.projectId, this.scope.type).then((function(_this) {\n        return function(values) {\n          _this.scope.values = values;\n          _this.scope.maxValueOrder = _.maxBy(values, \"order\").order;\n          return values;\n        };\n      })(this));\n    };\n\n    ProjectValuesController.prototype.moveValue = function(ctx, itemValue, itemIndex) {\n      var r, values;\n      values = this.scope.values;\n      r = values.indexOf(itemValue);\n      values.splice(r, 1);\n      values.splice(itemIndex, 0, itemValue);\n      _.each(values, function(value, index) {\n        return value.order = index;\n      });\n      return this.repo.saveAll(values);\n    };\n\n    return ProjectValuesController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ProjectValuesController\", ProjectValuesController);\n\n  ProjectValuesDirective = function($log, $repo, $confirm, $location, animationFrame, $translate, $rootscope) {\n    var link, linkDragAndDrop, linkValue;\n    linkDragAndDrop = function($scope, $el, $attrs) {\n      var drake, itemEl, newParentScope, oldParentScope, scroll, tdom;\n      oldParentScope = null;\n      newParentScope = null;\n      itemEl = null;\n      tdom = $el.find(\".sortable\");\n      drake = dragula([tdom[0]], {\n        direction: 'vertical',\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: tdom[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemIndex, itemValue;\n        itemEl = $(item);\n        itemValue = itemEl.scope().value;\n        itemIndex = itemEl.index();\n        return $scope.$broadcast(\"admin:project-values:move\", itemValue, itemIndex);\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        $el.off();\n        return drake.destroy();\n      });\n    };\n    linkValue = function($scope, $el, $attrs) {\n      var $ctrl, cancel, goToBottomList, initializeNewValue, initializeTextTranslations, objName, saveNewValue, saveValue, valueType;\n      $ctrl = $el.controller();\n      valueType = $attrs.type;\n      objName = $attrs.objname;\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"is_closed\": false,\n          \"is_archived\": false\n        };\n      };\n      initializeTextTranslations = function() {\n        return $scope.addNewElementText = $translate.instant(\"ADMIN.PROJECT_VALUES_\" + (objName.toUpperCase()) + \".ACTION_ADD\");\n      };\n      initializeNewValue();\n      initializeTextTranslations();\n      $rootscope.$on(\"$translateChangeEnd\", function() {\n        return $scope.$evalAsync(initializeTextTranslations);\n      });\n      goToBottomList = (function(_this) {\n        return function(focus) {\n          var table;\n          if (focus == null) {\n            focus = false;\n          }\n          table = $el.find(\".table-main\");\n          $(document.body).scrollTop(table.offset().top + table.height());\n          if (focus) {\n            return $el.find(\".new-value input:visible\").first().focus();\n          }\n        };\n      })(this);\n      saveValue = function(target) {\n        var form, formEl, promise, value;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        value = formEl.scope().value;\n        promise = $repo.save(value);\n        promise.then((function(_this) {\n          return function() {\n            var row;\n            row = target.parents(\".row.table-main\");\n            row.addClass(\"hidden\");\n            return row.siblings(\".visualization\").removeClass('hidden');\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      saveNewValue = function(target) {\n        var form, formEl, promise;\n        formEl = target.parents(\"form\");\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        $scope.newValue.order = $scope.maxValueOrder ? $scope.maxValueOrder + 1 : 1;\n        promise = $repo.create(valueType, $scope.newValue);\n        promise.then((function(_this) {\n          return function(data) {\n            target.addClass(\"hidden\");\n            $scope.values.push(data);\n            $scope.maxValueOrder = data.order;\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          return form.setErrors(data);\n        });\n      };\n      cancel = function(target) {\n        var formEl, row, value;\n        row = target.parents(\".row.table-main\");\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        return $scope.$apply(function() {\n          row.addClass(\"hidden\");\n          value.revert();\n          return row.siblings(\".visualization\").removeClass('hidden');\n        });\n      };\n      $el.on(\"click\", \".show-add-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").removeClass('hidden');\n        return goToBottomList(true);\n      });\n      $el.on(\"click\", \".add-new\", debounce(2000, function(event) {\n        var target;\n        event.preventDefault();\n        target = $el.find(\".new-value\");\n        return saveNewValue(target);\n      }));\n      $el.on(\"click\", \".delete-new\", function(event) {\n        event.preventDefault();\n        $el.find(\".new-value\").addClass(\"hidden\");\n        return initializeNewValue();\n      });\n      $el.on(\"click\", \".edit-value\", function(event) {\n        var editionRow, row, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        row = target.parents(\".row.table-main\");\n        row.addClass(\"hidden\");\n        editionRow = row.siblings(\".edition\");\n        editionRow.removeClass('hidden');\n        return editionRow.find('input:visible').first().focus().select();\n      });\n      $el.on(\"keyup\", \".edition input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return saveValue(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"keyup\", \".new-value input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = $el.find(\".new-value\");\n          return saveNewValue(target);\n        } else if (event.keyCode === 27) {\n          $el.find(\".new-value\").addClass(\"hidden\");\n          return initializeNewValue();\n        }\n      });\n      $el.on(\"click\", \".save\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return saveValue(target);\n      });\n      $el.on(\"click\", \".cancel\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return cancel(target);\n      });\n      return $el.on(\"click\", \".delete-value\", function(event) {\n        var choices, formEl, subtitle, target, text, title, value;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.parents(\"form\");\n        value = formEl.scope().value;\n        choices = {};\n        _.each($scope.values, function(option) {\n          if (value.id !== option.id) {\n            return choices[option.id] = option.name;\n          }\n        });\n        subtitle = value.name;\n        if (_.keys(choices).length === 0) {\n          return $confirm.error($translate.instant(\"ADMIN.PROJECT_VALUES.ERROR_DELETE_ALL\"));\n        }\n        title = $translate.instant(\"ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE\");\n        text = $translate.instant(\"ADMIN.PROJECT_VALUES.REPLACEMENT\");\n        return $confirm.askChoice(title, subtitle, choices, text).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadValues()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $repo.remove(value, {\n            \"moveTo\": response.selected\n          }).then(onSucces, onError);\n        });\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      linkDragAndDrop($scope, $el, $attrs);\n      linkValue($scope, $el, $attrs);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectValues\", [\"$log\", \"$tgRepo\", \"$tgConfirm\", \"$tgLocation\", \"animationFrame\", \"$translate\", \"$rootScope\", ProjectValuesDirective]);\n\n  ColorSelectionDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $model) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$watch($attrs.ngModel, function(element) {\n        return $scope.color = element.color;\n      });\n      $el.on(\"click\", \".current-color\", function(event) {\n        var body, target;\n        event.preventDefault();\n        event.stopPropagation();\n        target = angular.element(event.currentTarget);\n        $el.find(\".select-color\").hide();\n        target.siblings(\".select-color\").show();\n        body = angular.element(\"body\");\n        return body.on(\"click\", (function(_this) {\n          return function(event) {\n            if (angular.element(event.target).parent(\".select-color\").length === 0) {\n              $el.find(\".select-color\").hide();\n              return body.unbind(\"click\");\n            }\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".select-color .color\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        $scope.$apply(function() {\n          return $model.$modelValue.color = target.data(\"color\");\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      $el.on(\"click\", \".select-color .selected-color\", function(event) {\n        event.preventDefault();\n        $scope.$apply(function() {\n          return $model.$modelValue.color = $scope.color;\n        });\n        return $el.find(\".select-color\").hide();\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link,\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgColorSelection\", ColorSelectionDirective);\n\n  TEXT_TYPE = \"text\";\n\n  MULTILINE_TYPE = \"multiline\";\n\n  DATE_TYPE = \"date\";\n\n  URL_TYPE = \"url\";\n\n  TYPE_CHOICES = [\n    {\n      key: TEXT_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_TEXT\"\n    }, {\n      key: MULTILINE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_MULTI\"\n    }, {\n      key: DATE_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_DATE\"\n    }, {\n      key: URL_TYPE,\n      name: \"ADMIN.CUSTOM_FIELDS.FIELD_TYPE_URL\"\n    }\n  ];\n\n  ProjectCustomAttributesController = (function(superClass) {\n    extend(ProjectCustomAttributesController, superClass);\n\n    ProjectCustomAttributesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function ProjectCustomAttributesController(scope, rootscope, repo, rs, params, q, location, navUrls, appMetaService, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.moveCustomAttributes = bind(this.moveCustomAttributes, this);\n      this.deleteCustomAttribute = bind(this.deleteCustomAttribute, this);\n      this.saveCustomAttribute = bind(this.saveCustomAttribute, this);\n      this.createCustomAttribute = bind(this.createCustomAttribute, this);\n      this.loadCustomAttributes = bind(this.loadCustomAttributes, this);\n      this.scope.TYPE_CHOICES = TYPE_CHOICES;\n      this.scope.project = {};\n      this.rootscope.$on(\"project:loaded\", (function(_this) {\n        return function() {\n          var description, sectionName, title;\n          _this.loadCustomAttributes();\n          sectionName = _this.translate.instant(_this.scope.sectionName);\n          title = _this.translate.instant(\"ADMIN.CUSTOM_ATTRIBUTES.PAGE_TITLE\", {\n            \"sectionName\": sectionName,\n            \"projectName\": _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n    }\n\n    ProjectCustomAttributesController.prototype.loadCustomAttributes = function() {\n      return this.rs.customAttributes[this.scope.type].list(this.scope.projectId).then((function(_this) {\n        return function(customAttributes) {\n          var ref;\n          _this.scope.customAttributes = customAttributes;\n          _this.scope.maxOrder = (ref = _.maxBy(customAttributes, \"order\")) != null ? ref.order : void 0;\n          return customAttributes;\n        };\n      })(this));\n    };\n\n    ProjectCustomAttributesController.prototype.createCustomAttribute = function(attrValues) {\n      return this.repo.create(\"custom-attributes/\" + this.scope.type, attrValues);\n    };\n\n    ProjectCustomAttributesController.prototype.saveCustomAttribute = function(attrModel) {\n      return this.repo.save(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.deleteCustomAttribute = function(attrModel) {\n      return this.repo.remove(attrModel);\n    };\n\n    ProjectCustomAttributesController.prototype.moveCustomAttributes = function(attrModel, newIndex) {\n      var customAttributes, r;\n      customAttributes = this.scope.customAttributes;\n      r = customAttributes.indexOf(attrModel);\n      customAttributes.splice(r, 1);\n      customAttributes.splice(newIndex, 0, attrModel);\n      _.each(customAttributes, function(val, idx) {\n        return val.order = idx;\n      });\n      return this.repo.saveAll(customAttributes);\n    };\n\n    return ProjectCustomAttributesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"ProjectCustomAttributesController\", ProjectCustomAttributesController);\n\n  ProjectCustomAttributesDirective = function($log, $confirm, animationFrame, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl, cancelCreate, cancelUpdate, create, deleteCustomAttribute, drake, hideAddButton, hideCancelButton, hideCreateForm, hideEditForm, resetNewAttr, revertChangesInCustomAttribute, showAddButton, showCancelButton, showCreateForm, showEditForm, sortableEl, update;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      sortableEl = $el.find(\".js-sortable\");\n      drake = dragula([sortableEl[0]], {\n        direction: 'vertical',\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: sortableEl[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var itemAttr, itemEl, itemIndex;\n        itemEl = $(item);\n        itemAttr = itemEl.scope().attr;\n        itemIndex = itemEl.index();\n        return $ctrl.moveCustomAttributes(itemAttr, itemIndex);\n      });\n      showCreateForm = function() {\n        $el.find(\".js-new-custom-field\").removeClass(\"hidden\");\n        return $el.find(\".js-new-custom-field input:visible\").first().focus();\n      };\n      hideCreateForm = function() {\n        return $el.find(\".js-new-custom-field\").addClass(\"hidden\");\n      };\n      showAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideAddButton = function() {\n        return $el.find(\".js-add-custom-field-button\").addClass(\"hidden\");\n      };\n      showCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").removeClass(\"hidden\");\n      };\n      hideCancelButton = function() {\n        return $el.find(\".js-cancel-new-custom-field-button\").addClass(\"hidden\");\n      };\n      resetNewAttr = function() {\n        return $scope.newAttr = {};\n      };\n      create = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideCreateForm();\n            resetNewAttr();\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = $scope.newAttr;\n        attr.project = $scope.projectId;\n        attr.order = $scope.maxOrder ? $scope.maxOrder + 1 : 1;\n        return $ctrl.createCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelCreate = function() {\n        hideCreateForm();\n        return resetNewAttr();\n      };\n      $scope.$watch(\"customAttributes\", function(customAttributes) {\n        if (!customAttributes) {\n          return;\n        }\n        if (customAttributes.length === 0) {\n          hideCancelButton();\n          hideAddButton();\n          return showCreateForm();\n        } else {\n          hideCreateForm();\n          showAddButton();\n          return showCancelButton();\n        }\n      });\n      $el.on(\"click\", \".js-add-custom-field-button\", function(event) {\n        event.preventDefault();\n        return showCreateForm();\n      });\n      $el.on(\"click\", \".js-create-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return create(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-new-custom-field-button\", function(event) {\n        event.preventDefault();\n        return cancelCreate();\n      });\n      $el.on(\"keyup\", \".js-new-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return create(formEl);\n        } else if (event.keyCode === 27) {\n          return cancelCreate();\n        }\n      });\n      showEditForm = function(formEl) {\n        formEl.find(\".js-view-custom-field\").addClass(\"hidden\");\n        formEl.find(\".js-edit-custom-field\").removeClass(\"hidden\");\n        return formEl.find(\".js-edit-custom-field input:visible\").first().focus().select();\n      };\n      hideEditForm = function(formEl) {\n        formEl.find(\".js-edit-custom-field\").addClass(\"hidden\");\n        return formEl.find(\".js-view-custom-field\").removeClass(\"hidden\");\n      };\n      revertChangesInCustomAttribute = function(formEl) {\n        return $scope.$apply(function() {\n          return formEl.scope().attr.revert();\n        });\n      };\n      update = function(formEl) {\n        var attr, form, onError, onSucces;\n        form = formEl.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        onSucces = (function(_this) {\n          return function() {\n            $ctrl.loadCustomAttributes();\n            hideEditForm(formEl);\n            return $confirm.notify(\"success\");\n          };\n        })(this);\n        onError = (function(_this) {\n          return function(data) {\n            return form.setErrors(data);\n          };\n        })(this);\n        attr = formEl.scope().attr;\n        return $ctrl.saveCustomAttribute(attr).then(onSucces, onError);\n      };\n      cancelUpdate = function(formEl) {\n        hideEditForm(formEl);\n        return revertChangesInCustomAttribute(formEl);\n      };\n      $el.on(\"click\", \".js-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return showEditForm(formEl);\n      });\n      $el.on(\"click\", \".js-update-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return update(formEl);\n      }));\n      $el.on(\"click\", \".js-cancel-edit-custom-field-button\", function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return cancelUpdate(formEl);\n      });\n      $el.on(\"keyup\", \".js-edit-custom-field input\", function(event) {\n        var formEl, target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return update(formEl);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          formEl = target.closest(\"form\");\n          return cancelUpdate(formEl);\n        }\n      });\n      deleteCustomAttribute = function(formEl) {\n        var attr, message, text, title;\n        attr = formEl.scope().attr;\n        message = attr.name;\n        title = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.DELETE\");\n        text = $translate.instant(\"COMMON.CUSTOM_ATTRIBUTES.CONFIRM_DELETE\");\n        return $confirm.ask(title, text, message).then(function(response) {\n          var onError, onSucces;\n          onSucces = function() {\n            return $ctrl.loadCustomAttributes()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return $confirm.notify(\"error\", null, \"We have not been able to delete '\" + message + \"'.\");\n          };\n          return $ctrl.deleteCustomAttribute(attr).then(onSucces, onError);\n        });\n      };\n      return $el.on(\"click\", \".js-delete-custom-field-button\", debounce(2000, function(event) {\n        var formEl, target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        formEl = target.closest(\"form\");\n        return deleteCustomAttribute(formEl);\n      }));\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgProjectCustomAttributes\", [\"$log\", \"$tgConfirm\", \"animationFrame\", \"$translate\", ProjectCustomAttributesDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/memberships.coffee\n */\n\n(function() {\n  var EditRoleDirective, NewRoleDirective, RolePermissionsDirective, RolesController, RolesDirective, bindMethods, bindOnce, debounce, mixOf, module, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  bindMethods = this.taiga.bindMethods;\n\n  module = angular.module(\"taigaAdmin\");\n\n  RolesController = (function(superClass) {\n    extend(RolesController, superClass);\n\n    RolesController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function RolesController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this._disableComputable = bind(this._disableComputable, this);\n      this._enableComputable = bind(this._enableComputable, this);\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.MENU.PERMISSIONS\";\n      this.scope.project = {};\n      this.scope.anyComputableRole = true;\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.ROLES.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    RolesController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.anyComputableRole = _.some(_.map(project.roles, function(point) {\n            return point.computable;\n          }));\n          return project;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadRoles = function() {\n      return this.rs.roles.list(this.scope.projectId).then((function(_this) {\n        return function(roles) {\n          var public_permission;\n          roles = roles.map(function(role) {\n            role.external_user = false;\n            return role;\n          });\n          public_permission = {\n            \"name\": _this.translate.instant(\"ADMIN.ROLES.EXTERNAL_USER\"),\n            \"permissions\": _this.scope.project.public_permissions,\n            \"external_user\": true\n          };\n          roles.push(public_permission);\n          _this.scope.roles = roles;\n          _this.scope.role = _this.scope.roles[0];\n          return roles;\n        };\n      })(this));\n    };\n\n    RolesController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadRoles();\n        };\n      })(this));\n      return promise;\n    };\n\n    RolesController.prototype.setRole = function(role) {\n      this.scope.role = role;\n      return this.scope.$broadcast(\"role:changed\", this.scope.role);\n    };\n\n    RolesController.prototype[\"delete\"] = function() {\n      var choices, i, len, ref, replacement, role, subtitle, title, warning;\n      choices = {};\n      ref = this.scope.roles;\n      for (i = 0, len = ref.length; i < len; i++) {\n        role = ref[i];\n        if (role.id !== this.scope.role.id) {\n          choices[role.id] = role.name;\n        }\n      }\n      if (_.keys(choices).length === 0) {\n        return this.confirm.error(this.translate.instant(\"ADMIN.ROLES.ERROR_DELETE_ALL\"));\n      }\n      title = this.translate.instant(\"ADMIN.ROLES.TITLE_DELETE_ROLE\");\n      subtitle = this.scope.role.name;\n      replacement = this.translate.instant(\"ADMIN.ROLES.REPLACEMENT_ROLE\");\n      warning = this.translate.instant(\"ADMIN.ROLES.WARNING_DELETE_ROLE\");\n      return this.confirm.askChoice(title, subtitle, choices, replacement, warning).then((function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            _this.loadProject();\n            return _this.loadRoles()[\"finally\"](function() {\n              return response.finish();\n            });\n          };\n          onError = function() {\n            return _this.confirm.notify('error');\n          };\n          return _this.repo.remove(_this.scope.role, {\n            moveTo: response.selected\n          }).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    RolesController.prototype._enableComputable = function() {\n      var onError, onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"success\");\n          return _this.loadProject();\n        };\n      })(this);\n      onError = (function(_this) {\n        return function() {\n          _this.confirm.notify(\"error\");\n          return _this.scope.role.revert();\n        };\n      })(this);\n      return this.repo.save(this.scope.role).then(onSuccess, onError);\n    };\n\n    RolesController.prototype._disableComputable = function() {\n      var askOnError, askOnSuccess, subtitle, title;\n      askOnSuccess = (function(_this) {\n        return function(response) {\n          var onError, onSuccess;\n          onSuccess = function() {\n            response.finish();\n            _this.confirm.notify(\"success\");\n            return _this.loadProject();\n          };\n          onError = function() {\n            response.finish();\n            _this.confirm.notify(\"error\");\n            return _this.scope.role.revert();\n          };\n          return _this.repo.save(_this.scope.role).then(onSuccess, onError);\n        };\n      })(this);\n      askOnError = (function(_this) {\n        return function(response) {\n          return _this.scope.role.revert();\n        };\n      })(this);\n      title = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_TITLE\");\n      subtitle = this.translate.instant(\"ADMIN.ROLES.DISABLE_COMPUTABLE_ALERT_SUBTITLE\", {\n        roleName: this.scope.role.name\n      });\n      return this.confirm.ask(title, subtitle, \"\").then(askOnSuccess, askOnError);\n    };\n\n    RolesController.prototype.toggleComputable = debounce(2000, function() {\n      if (!this.scope.role.computable) {\n        return this._disableComputable();\n      } else {\n        return this._enableComputable();\n      }\n    });\n\n    return RolesController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"RolesController\", RolesController);\n\n  EditRoleDirective = function($repo, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, toggleView;\n      toggleView = function() {\n        $el.find('.total').toggle();\n        return $el.find('.edit-role').toggle();\n      };\n      submit = function() {\n        var promise;\n        $scope.role.name = $el.find(\"input\").val();\n        promise = $repo.save($scope.role);\n        promise.then(function() {\n          return $confirm.notify(\"success\");\n        });\n        promise.then(null, function(data) {\n          return $confirm.notify(\"error\");\n        });\n        return toggleView();\n      };\n      $el.on(\"click\", \".edit-value\", function() {\n        toggleView();\n        $el.find(\"input\").focus();\n        return $el.find(\"input\").val($scope.role.name);\n      });\n      $el.on(\"click\", \"a.save\", submit);\n      $el.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return submit();\n        } else if (event.keyCode === 27) {\n          return toggleView();\n        }\n      });\n      $scope.$on(\"role:changed\", function() {\n        if ($el.find('.edit-role').is(\":visible\")) {\n          return toggleView();\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgEditRole\", [\"$tgRepo\", \"$tgConfirm\", EditRoleDirective]);\n\n  RolesDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRoles\", RolesDirective);\n\n  NewRoleDirective = function($tgrepo, $confirm) {\n    var DEFAULT_PERMISSIONS, link;\n    DEFAULT_PERMISSIONS = [\"view_project\", \"view_milestones\", \"view_us\", \"view_tasks\", \"view_issues\"];\n    link = function($scope, $el, $attrs) {\n      var $ctrl;\n      $ctrl = $el.controller();\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $el.on(\"click\", \"a.add-button\", function(event) {\n        event.preventDefault();\n        $el.find(\".new\").removeClass(\"hidden\");\n        $el.find(\".new\").focus();\n        return $el.find(\".add-button\").hide();\n      });\n      return $el.on(\"keyup\", \".new\", function(event) {\n        var newRole, onError, onSuccess, target;\n        event.preventDefault();\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          newRole = {\n            project: $scope.projectId,\n            name: target.val(),\n            permissions: DEFAULT_PERMISSIONS,\n            order: _.maxBy($scope.roles, function(r) {\n              return r.order;\n            }).order + 1,\n            computable: false\n          };\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          onSuccess = function(role) {\n            var insertPosition;\n            insertPosition = $scope.roles.length - 1;\n            $scope.roles.splice(insertPosition, 0, role);\n            $ctrl.setRole(role);\n            $el.find(\".add-button\").show();\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            return $confirm.notify(\"error\");\n          };\n          return $tgrepo.create(\"roles\", newRole).then(onSuccess, onError);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          $el.find(\".new\").addClass(\"hidden\");\n          $el.find(\".new\").val('');\n          return $el.find(\".add-button\").show();\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewRole\", [\"$tgRepo\", \"$tgConfirm\", NewRoleDirective]);\n\n  RolePermissionsDirective = function($rootscope, $repo, $confirm, $compile) {\n    var baseTemplate, categoryTemplate, link, resumeTemplate;\n    resumeTemplate = _.template(\"<div class=\\\"resume-title\\\" translate=\\\"<%- category.name %>\\\"></div>\\n<div class=\\\"summary-role\\\">\\n    <div class=\\\"count\\\"><%- category.activePermissions %>/<%- category.permissions.length %></div>\\n    <% _.each(category.permissions, function(permission) { %>\\n        <div class=\\\"role-summary-single <% if(permission.active) { %>active<% } %>\\\"\\n             title=\\\"{{ '<%- permission.name %>' | translate }}\\\"></div>\\n    <% }) %>\\n</div>\\n<tg-svg svg-icon=\\\"icon-arrow-right\\\"></tg-svg>\");\n    categoryTemplate = _.template(\"<div class=\\\"category-config\\\" data-id=\\\"<%- index %>\\\">\\n    <div class=\\\"resume\\\">\\n    </div>\\n    <div class=\\\"category-items\\\">\\n        <div class=\\\"items-container\\\">\\n        <% _.each(category.permissions, function(permission) { %>\\n            <div class=\\\"category-item\\\" data-id=\\\"<%- permission.key %>\\\">\\n                <span translate=\\\"<%- permission.name %>\\\"></span>\\n                <div class=\\\"check\\\">\\n                    <input type=\\\"checkbox\\\"\\n                           <% if(!permission.editable) { %> disabled=\\\"disabled\\\" <% } %>\\n                           <% if(permission.active) { %> checked=\\\"checked\\\" <% } %>/>\\n                    <div></div>\\n                    <span class=\\\"check-text check-yes\\\" translate=\\\"COMMON.YES\\\"></span>\\n                    <span class=\\\"check-text check-no\\\" translate=\\\"COMMON.NO\\\"></span>\\n                </div>\\n            </div>\\n        <% }) %>\\n        </div>\\n    </div>\\n</div>\");\n    baseTemplate = _.template(\"<div class=\\\"category-config-list\\\"></div>\");\n    link = function($scope, $el, $attrs) {\n      var $ctrl, generateCategoriesFromRole, renderCategory, renderPermissions, renderResume;\n      $ctrl = $el.controller();\n      generateCategoriesFromRole = function(role) {\n        var categories, isPermissionEditable, issuePermissions, milestonePermissions, setActivePermissions, setActivePermissionsPerCategory, taskPermissions, userStoryPermissions, wikiPermissions;\n        setActivePermissions = function(permissions) {\n          return _.map(permissions, function(x) {\n            var ref;\n            return _.extend({}, x, {\n              active: (ref = x[\"key\"], indexOf.call(role.permissions, ref) >= 0)\n            });\n          });\n        };\n        isPermissionEditable = function(permission, role, project) {\n          if (role.external_user && !project.is_private && permission.key.indexOf(\"view_\") === 0) {\n            return false;\n          } else {\n            return true;\n          }\n        };\n        setActivePermissionsPerCategory = function(category) {\n          return _.map(category, function(cat) {\n            cat.permissions = cat.permissions.map(function(permission) {\n              permission.editable = isPermissionEditable(permission, role, $scope.project);\n              return permission;\n            });\n            return _.extend({}, cat, {\n              activePermissions: _.filter(cat[\"permissions\"], \"active\").length\n            });\n          });\n        };\n        categories = [];\n        milestonePermissions = [\n          {\n            key: \"view_milestones\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.VIEW_SPRINTS\"\n          }, {\n            key: \"add_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.ADD_SPRINTS\"\n          }, {\n            key: \"modify_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.MODIFY_SPRINTS\"\n          }, {\n            key: \"delete_milestone\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.DELETE_SPRINTS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.SPRINTS.NAME\",\n          permissions: setActivePermissions(milestonePermissions)\n        });\n        userStoryPermissions = [\n          {\n            key: \"view_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.VIEW_USER_STORIES\"\n          }, {\n            key: \"add_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.ADD_USER_STORIES\"\n          }, {\n            key: \"modify_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.MODIFY_USER_STORIES\"\n          }, {\n            key: \"delete_us\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.DELETE_USER_STORIES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.USER_STORIES.NAME\",\n          permissions: setActivePermissions(userStoryPermissions)\n        });\n        taskPermissions = [\n          {\n            key: \"view_tasks\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.VIEW_TASKS\"\n          }, {\n            key: \"add_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.ADD_TASKS\"\n          }, {\n            key: \"modify_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.MODIFY_TASKS\"\n          }, {\n            key: \"delete_task\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.DELETE_TASKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.TASKS.NAME\",\n          permissions: setActivePermissions(taskPermissions)\n        });\n        issuePermissions = [\n          {\n            key: \"view_issues\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.VIEW_ISSUES\"\n          }, {\n            key: \"add_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.ADD_ISSUES\"\n          }, {\n            key: \"modify_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.MODIFY_ISSUES\"\n          }, {\n            key: \"delete_issue\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.DELETE_ISSUES\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.ISSUES.NAME\",\n          permissions: setActivePermissions(issuePermissions)\n        });\n        wikiPermissions = [\n          {\n            key: \"view_wiki_pages\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_PAGES\"\n          }, {\n            key: \"add_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_PAGES\"\n          }, {\n            key: \"modify_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.MODIFY_WIKI_PAGES\"\n          }, {\n            key: \"delete_wiki_page\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_PAGES\"\n          }, {\n            key: \"view_wiki_links\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.VIEW_WIKI_LINKS\"\n          }, {\n            key: \"add_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.ADD_WIKI_LINKS\"\n          }, {\n            key: \"delete_wiki_link\",\n            name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.DELETE_WIKI_LINKS\"\n          }\n        ];\n        categories.push({\n          name: \"COMMON.PERMISIONS_CATEGORIES.WIKI.NAME\",\n          permissions: setActivePermissions(wikiPermissions)\n        });\n        return setActivePermissionsPerCategory(categories);\n      };\n      renderResume = function(element, category) {\n        return element.find(\".resume\").html($compile(resumeTemplate({\n          category: category\n        }))($scope));\n      };\n      renderCategory = function(category, index) {\n        var html;\n        html = categoryTemplate({\n          category: category,\n          index: index\n        });\n        html = angular.element(html);\n        renderResume(html, category);\n        return $compile(html)($scope);\n      };\n      renderPermissions = function() {\n        var html;\n        $el.off();\n        html = baseTemplate();\n        _.each(generateCategoriesFromRole($scope.role), function(category, index) {\n          return html = angular.element(html).append(renderCategory(category, index));\n        });\n        $el.html(html);\n        $el.on(\"click\", \".resume\", function(event) {\n          var target;\n          event.preventDefault();\n          target = angular.element(event.currentTarget);\n          target.toggleClass(\"open-drawer\");\n          return target.next().toggleClass(\"open\");\n        });\n        return $el.on(\"change\", \".category-item input\", function(event) {\n          var getActivePermissions, onError, onSuccess, target;\n          getActivePermissions = function() {\n            var activePermissions;\n            activePermissions = _.filter($el.find(\".category-item input\"), function(t) {\n              return angular.element(t).is(\":checked\");\n            });\n            activePermissions = _.sortBy(_.map(activePermissions, function(t) {\n              var permission;\n              return permission = angular.element(t).parents(\".category-item\").data(\"id\");\n            }));\n            if (activePermissions.length) {\n              activePermissions.push(\"view_project\");\n            }\n            return activePermissions;\n          };\n          target = angular.element(event.currentTarget);\n          $scope.role.permissions = getActivePermissions();\n          onSuccess = function() {\n            var categories, categoryId;\n            categories = generateCategoriesFromRole($scope.role);\n            categoryId = target.parents(\".category-config\").data(\"id\");\n            renderResume(target.parents(\".category-config\"), categories[categoryId]);\n            $rootscope.$broadcast(\"projects:reload\");\n            $confirm.notify(\"success\");\n            return $ctrl.loadProject();\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            target.prop(\"checked\", !target.prop(\"checked\"));\n            return $scope.role.permissions = getActivePermissions();\n          };\n          if ($scope.role.external_user) {\n            $scope.project.public_permissions = $scope.role.permissions;\n            $scope.project.anon_permissions = $scope.role.permissions.filter(function(permission) {\n              return permission.indexOf(\"view_\") === 0;\n            });\n            return $repo.save($scope.project).then(onSuccess, onError);\n          } else {\n            return $repo.save($scope.role).then(onSuccess, onError);\n          }\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      $scope.$on(\"role:changed\", function() {\n        return renderPermissions();\n      });\n      return bindOnce($scope, $attrs.ngModel, renderPermissions);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgRolePermissions\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$compile\", RolePermissionsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/admin/third-parties.coffee\n */\n\n(function() {\n  var BitbucketController, BitbucketWebhooksDirective, GithubController, GithubWebhooksDirective, GitlabController, GitlabWebhooksDirective, NewWebhookDirective, SelectInputText, ValidOriginIpsDirective, WebhookDirective, WebhooksController, bindMethods, debounce, mixOf, module, taiga, timeout,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindMethods = this.taiga.bindMethods;\n\n  debounce = this.taiga.debounce;\n\n  timeout = this.taiga.timeout;\n\n  module = angular.module(\"taigaAdmin\");\n\n  WebhooksController = (function(superClass) {\n    extend(WebhooksController, superClass);\n\n    WebhooksController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"$tgLocation\", \"$tgNavUrls\", \"tgAppMetaService\", \"$translate\"];\n\n    function WebhooksController(scope, repo, rs, params, location, navUrls, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = \"ADMIN.WEBHOOKS.SECTION_NAME\";\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.WEBHOOKS.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"webhooks:reload\", this.loadWebhooks);\n    }\n\n    WebhooksController.prototype.loadWebhooks = function() {\n      return this.rs.webhooks.list(this.scope.projectId).then((function(_this) {\n        return function(webhooks) {\n          return _this.scope.webhooks = webhooks;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          if (!project.i_am_admin) {\n            _this.location.path(_this.navUrls.resolve(\"permission-denied\"));\n          }\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    WebhooksController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadWebhooks();\n        };\n      })(this));\n      return promise;\n    };\n\n    return WebhooksController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"WebhooksController\", WebhooksController);\n\n  WebhookDirective = function($rs, $repo, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var cancel, openHistory, save, showEditMode, showVisualizationMode, updateLogs, updateShowHideHistoryText, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      updateLogs = function() {\n        var prettyDate;\n        prettyDate = $translate.instant(\"ADMIN.WEBHOOKS.DATE\");\n        return $rs.webhooklogs.list(webhook.id).then((function(_this) {\n          return function(webhooklogs) {\n            var i, len, log, ref;\n            for (i = 0, len = webhooklogs.length; i < len; i++) {\n              log = webhooklogs[i];\n              log.validStatus = (200 <= (ref = log.status) && ref < 300);\n              log.prettySentHeaders = _.map(_.toPairs(log.request_headers), function(arg) {\n                var header, value;\n                header = arg[0], value = arg[1];\n                return header + \": \" + value;\n              }).join(\"\\n\");\n              log.prettySentData = JSON.stringify(log.request_data);\n              log.prettyDate = moment(log.created).format(prettyDate);\n            }\n            webhook.logs_counter = webhooklogs.length;\n            webhook.logs = webhooklogs;\n            return updateShowHideHistoryText();\n          };\n        })(this));\n      };\n      updateShowHideHistoryText = function() {\n        var historyElement, text, textElement, title;\n        textElement = $el.find(\".toggle-history\");\n        historyElement = textElement.parents(\".single-webhook-wrapper\").find(\".webhooks-history\");\n        if (historyElement.hasClass(\"open\")) {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_HIDE_HISTORY_TITLE\");\n        } else {\n          text = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY\");\n          title = $translate.instant(\"ADMIN.WEBHOOKS.ACTION_SHOW_HISTORY_TITLE\");\n        }\n        textElement.text(text);\n        return textElement.prop(\"title\", title);\n      };\n      showVisualizationMode = function() {\n        $el.find(\".edition-mode\").addClass(\"hidden\");\n        return $el.find(\".visualization-mode\").removeClass(\"hidden\");\n      };\n      showEditMode = function() {\n        $el.find(\".visualization-mode\").addClass(\"hidden\");\n        return $el.find(\".edition-mode\").removeClass(\"hidden\");\n      };\n      openHistory = function() {\n        return $el.find(\".webhooks-history\").addClass(\"open\");\n      };\n      cancel = function() {\n        showVisualizationMode();\n        return $scope.$apply(function() {\n          return webhook.revert();\n        });\n      };\n      save = debounce(2000, function(target) {\n        var form, promise;\n        form = target.parents(\"form\").checksley();\n        if (!form.validate()) {\n          return;\n        }\n        promise = $repo.save(webhook);\n        promise.then((function(_this) {\n          return function() {\n            return showVisualizationMode();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      $el.on(\"click\", \".test-webhook\", function() {\n        openHistory();\n        return $rs.webhooks.test(webhook.id).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".edit-webhook\", function() {\n        return showEditMode();\n      });\n      $el.on(\"click\", \".cancel-existing\", function() {\n        return cancel();\n      });\n      $el.on(\"click\", \".edit-existing\", function(event) {\n        var target;\n        event.preventDefault();\n        target = angular.element(event.currentTarget);\n        return save(target);\n      });\n      $el.on(\"keyup\", \".edition-mode input\", function(event) {\n        var target;\n        if (event.keyCode === 13) {\n          target = angular.element(event.currentTarget);\n          return save(target);\n        } else if (event.keyCode === 27) {\n          target = angular.element(event.currentTarget);\n          return cancel(target);\n        }\n      });\n      $el.on(\"click\", \".delete-webhook\", function() {\n        var message, title;\n        title = $translate.instant(\"ADMIN.WEBHOOKS.DELETE\");\n        message = $translate.instant(\"ADMIN.WEBHOOKS.WEBHOOK_NAME\", {\n          name: webhook.name\n        });\n        return $confirm.askOnDelete(title, message).then((function(_this) {\n          return function(askResponse) {\n            var onError, onSucces;\n            onSucces = function() {\n              askResponse.finish();\n              return $scope.$emit(\"webhooks:reload\");\n            };\n            onError = function() {\n              askResponse.finish(false);\n              return $confirm.notify(\"error\");\n            };\n            return $repo.remove(webhook).then(onSucces, onError);\n          };\n        })(this));\n      });\n      $el.on(\"click\", \".toggle-history\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        if ((webhook.logs == null) || webhook.logs.length === 0) {\n          return updateLogs().then(function() {\n            return timeout(0, function() {\n              $el.find(\".webhooks-history\").toggleClass(\"open\");\n              return updateShowHideHistoryText();\n            });\n          });\n        } else {\n          $el.find(\".webhooks-history\").toggleClass(\"open\");\n          return $scope.$apply(function() {\n            return updateShowHideHistoryText();\n          });\n        }\n      });\n      $el.on(\"click\", \".history-single\", function(event) {\n        var target;\n        target = angular.element(event.currentTarget);\n        target.toggleClass(\"history-single-open\");\n        return target.siblings(\".history-single-response\").toggleClass(\"open\");\n      });\n      return $el.on(\"click\", \".resend-request\", function(event) {\n        var log, target;\n        target = angular.element(event.currentTarget);\n        log = target.data(\"log\");\n        return $rs.webhooklogs.resend(log).then((function(_this) {\n          return function() {\n            return updateLogs();\n          };\n        })(this));\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", WebhookDirective]);\n\n  NewWebhookDirective = function($rs, $repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var addWebhookDOMNode, formDOMNode, initializeNewValue, save, webhook;\n      webhook = $scope.$eval($attrs.tgWebhook);\n      formDOMNode = $el.find(\".new-webhook-form\");\n      addWebhookDOMNode = $el.find(\".add-webhook\");\n      initializeNewValue = function() {\n        return $scope.newValue = {\n          \"name\": \"\",\n          \"url\": \"\",\n          \"key\": \"\"\n        };\n      };\n      initializeNewValue();\n      $scope.$watch(\"webhooks\", function(webhooks) {\n        if (webhooks != null) {\n          if (webhooks.length === 0) {\n            formDOMNode.removeClass(\"hidden\");\n            addWebhookDOMNode.addClass(\"hidden\");\n            return formDOMNode.find(\"input\")[0].focus();\n          } else {\n            formDOMNode.addClass(\"hidden\");\n            return addWebhookDOMNode.removeClass(\"hidden\");\n          }\n        }\n      });\n      save = debounce(2000, function() {\n        var form, promise;\n        form = formDOMNode.checksley();\n        if (!form.validate()) {\n          return;\n        }\n        $scope.newValue.project = $scope.project.id;\n        promise = $repo.create(\"webhooks\", $scope.newValue);\n        promise.then((function(_this) {\n          return function() {\n            $scope.$emit(\"webhooks:reload\");\n            return initializeNewValue();\n          };\n        })(this));\n        return promise.then(null, function(data) {\n          $confirm.notify(\"error\");\n          return form.setErrors(data);\n        });\n      });\n      formDOMNode.on(\"click\", \".add-new\", function(event) {\n        event.preventDefault();\n        return save();\n      });\n      formDOMNode.on(\"keyup\", \"input\", function(event) {\n        if (event.keyCode === 13) {\n          return save();\n        }\n      });\n      formDOMNode.on(\"click\", \".cancel-new\", function(event) {\n        return $scope.$apply(function() {\n          initializeNewValue();\n          if ($scope.webhooks.length >= 1) {\n            return formDOMNode.addClass(\"hidden\");\n          }\n        });\n      });\n      return addWebhookDOMNode.on(\"click\", function(event) {\n        formDOMNode.removeClass(\"hidden\");\n        return formDOMNode.find(\"input\")[0].focus();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNewWebhook\", [\"$tgResources\", \"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", NewWebhookDirective]);\n\n  GithubController = (function(superClass) {\n    extend(GithubController, superClass);\n\n    GithubController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GithubController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITHUB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITHUB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    GithubController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"github\").then((function(_this) {\n        return function(github) {\n          return _this.scope.github = github;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GithubController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GithubController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GithubController\", GithubController);\n\n  GitlabController = (function(superClass) {\n    extend(GitlabController, superClass);\n\n    GitlabController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function GitlabController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.GITLAB.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.GITLAB.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    GitlabController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"gitlab\").then((function(_this) {\n        return function(gitlab) {\n          return _this.scope.gitlab = gitlab;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    GitlabController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return GitlabController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"GitlabController\", GitlabController);\n\n  BitbucketController = (function(superClass) {\n    extend(BitbucketController, superClass);\n\n    BitbucketController.$inject = [\"$scope\", \"$tgRepo\", \"$tgResources\", \"$routeParams\", \"tgAppMetaService\", \"$translate\"];\n\n    function BitbucketController(scope, repo, rs, params, appMetaService, translate) {\n      var promise;\n      this.scope = scope;\n      this.repo = repo;\n      this.rs = rs;\n      this.params = params;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      bindMethods(this);\n      this.scope.sectionName = this.translate.instant(\"ADMIN.BITBUCKET.SECTION_NAME\");\n      this.scope.project = {};\n      promise = this.loadInitialData();\n      promise.then((function(_this) {\n        return function() {\n          var description, title;\n          title = _this.translate.instant(\"ADMIN.BITBUCKET.PAGE_TITLE\", {\n            projectName: _this.scope.project.name\n          });\n          description = _this.scope.project.description;\n          return _this.appMetaService.setAll(title, description);\n        };\n      })(this));\n      promise.then(null, this.onInitialDataError.bind(this));\n      this.scope.$on(\"project:modules:reload\", (function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n    }\n\n    BitbucketController.prototype.loadModules = function() {\n      return this.rs.modules.list(this.scope.projectId, \"bitbucket\").then((function(_this) {\n        return function(bitbucket) {\n          return _this.scope.bitbucket = bitbucket;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    BitbucketController.prototype.loadInitialData = function() {\n      var promise;\n      promise = this.loadProject();\n      promise.then((function(_this) {\n        return function() {\n          return _this.loadModules();\n        };\n      })(this));\n      return promise;\n    };\n\n    return BitbucketController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  module.controller(\"BitbucketController\", BitbucketController);\n\n  SelectInputText = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $el.on(\"click\", \".select-input-content\", function() {\n        $el.find(\"input\").select();\n        return $el.find(\".help-copy\").addClass(\"visible\");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgSelectInputText\", SelectInputText);\n\n  GithubWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.github, \"github\");\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify(\"success\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGithubWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GithubWebhooksDirective]);\n\n  GitlabWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.gitlab, \"gitlab\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgGitlabWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", GitlabWebhooksDirective]);\n\n  BitbucketWebhooksDirective = function($repo, $confirm, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var form, submit, submitButton;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.saveAttribute($scope.bitbucket, \"bitbucket\");\n          promise.then(function() {\n            currentLoading.finish();\n            $confirm.notify(\"success\");\n            return $scope.$emit(\"project:modules:reload\");\n          });\n          return promise.then(null, function(data) {\n            currentLoading.finish();\n            form.setErrors(data);\n            if (data._error_message) {\n              return $confirm.notify(\"error\", data._error_message);\n            }\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      return $el.on(\"submit\", \"form\", submit);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgBitbucketWebhooks\", [\"$tgRepo\", \"$tgConfirm\", \"$tgLoading\", BitbucketWebhooksDirective]);\n\n  ValidOriginIpsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs, $ngModel) {\n      return $ngModel.$parsers.push(function(value) {\n        value = $.trim(value);\n        if (value === \"\") {\n          return [];\n        }\n        return value.split(\",\");\n      });\n    };\n    return {\n      link: link,\n      restrict: \"EA\",\n      require: \"ngModel\"\n    };\n  };\n\n  module.directive(\"tgValidOriginIps\", ValidOriginIpsDirective);\n\n}).call(this);\n\n(function() {\n  var createProjectRestrictionDirective, module;\n\n  module = angular.module(\"taigaProject\");\n\n  createProjectRestrictionDirective = function() {\n    return {\n      templateUrl: \"project/wizard-restrictions.html\"\n    };\n  };\n\n  module.directive('tgCreateProjectRestriction', [createProjectRestrictionDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/common/attachments.coffee\n */\n\n(function() {\n  var CreateProject, DeleteProjectDirective, bindOnce, debounce, module, taiga, timeout;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  timeout = this.taiga.timeout;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaProject\");\n\n  CreateProject = function($rootscope, $repo, $confirm, $location, $navurls, $rs, $projectUrl, $loading, lightboxService, $cacheFactory, $translate, currentUserService, $auth) {\n    var directive, link;\n    link = function($scope, $el, attrs) {\n      var currentLoading, form, onErrorSubmit, onSuccessSubmit, openLightbox, submit, submitButton;\n      $scope.data = {};\n      $scope.templates = [];\n      currentLoading = null;\n      form = $el.find(\"form\").checksley({\n        \"onlyOneErrorElement\": true\n      });\n      onSuccessSubmit = function(response) {\n        $cacheFactory.get('$http').removeAll();\n        currentLoading.finish();\n        $rootscope.$broadcast(\"projects:reload\");\n        $confirm.notify(\"success\", $translate.instant(\"COMMON.SAVE\"));\n        $location.url($projectUrl.get(response));\n        lightboxService.close($el);\n        return currentUserService.loadProjects();\n      };\n      onErrorSubmit = function(response) {\n        var error_field, i, len, ref, results, selectors;\n        currentLoading.finish();\n        form.setErrors(response);\n        selectors = [];\n        ref = _.keys(response);\n        results = [];\n        for (i = 0, len = ref.length; i < len; i++) {\n          error_field = ref[i];\n          results.push(selectors.push(\"[name=\" + error_field + \"]\"));\n        }\n        return results;\n      };\n      submit = (function(_this) {\n        return function(event) {\n          var promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $repo.create(\"projects\", $scope.data);\n          return promise.then(onSuccessSubmit, onErrorSubmit);\n        };\n      })(this);\n      openLightbox = function() {\n        $scope.data = {\n          is_private: false\n        };\n        if (!$scope.templates.length) {\n          $rs.projects.templates().then((function(_this) {\n            return function(result) {\n              $scope.templates = result;\n              return $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n                return x.slug === \"scrum\";\n              })).id;\n            };\n          })(this));\n        } else {\n          $scope.data.creation_template = _.head(_.filter($scope.templates, function(x) {\n            return x.slug === \"scrum\";\n          })).id;\n        }\n        $scope.canCreatePrivateProjects = currentUserService.canCreatePrivateProjects();\n        $scope.canCreatePublicProjects = currentUserService.canCreatePublicProjects();\n        return lightboxService.open($el);\n      };\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      $el.on(\"click\", \".close\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return $auth.refresh().then(function() {\n        return openLightbox();\n      });\n    };\n    directive = {\n      link: link,\n      templateUrl: \"project/wizard-create-project.html\",\n      scope: {}\n    };\n    return directive;\n  };\n\n  module.directive(\"tgLbCreateProject\", [\"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$location\", \"$tgNavUrls\", \"$tgResources\", \"$projectUrl\", \"$tgLoading\", \"lightboxService\", \"$cacheFactory\", \"$translate\", \"tgCurrentUserService\", \"$tgAuth\", CreateProject]);\n\n  DeleteProjectDirective = function($repo, $rootscope, $auth, $location, $navUrls, $confirm, lightboxService, tgLoader, currentUserService) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var projectToDelete, submit;\n      projectToDelete = null;\n      $scope.$on(\"deletelightbox:new\", function(ctx, project) {\n        lightboxService.open($el);\n        return projectToDelete = project;\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var promise;\n        tgLoader.start();\n        lightboxService.close($el);\n        promise = $repo.remove(projectToDelete);\n        promise.then(function(data) {\n          tgLoader.pageLoaded();\n          $rootscope.$broadcast(\"projects:reload\");\n          $location.path($navUrls.resolve(\"home\"));\n          $confirm.notify(\"success\");\n          return currentUserService.loadProjects();\n        });\n        return promise.then(null, function() {\n          $confirm.notify(\"error\");\n          return lightboxService.close($el);\n        });\n      };\n      $el.on(\"click\", \".button-red\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      return $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return submit();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgLbDeleteProject\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfirm\", \"lightboxService\", \"tgLoader\", \"tgCurrentUserService\", DeleteProjectDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/bind.coffee\n */\n\n(function() {\n  var BindHtmlDirective, BindOnceAltDirective, BindOnceBindDirective, BindOnceHrefDirective, BindOnceHtmlDirective, BindOnceRefDirective, BindOnceSrcDirective, BindOnceTitleDirective, BindTitleDirective, bindOnce, module;\n\n  bindOnce = this.taiga.bindOnce;\n\n  BindOnceBindDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoBind, function(val) {\n        return $el.text(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHtml, function(val) {\n        return $el.html(val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceRefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoRef, function(val) {\n        return $el.html(\"#\" + val + \" \");\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceSrcDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoSrc, function(val) {\n        return $el.attr(\"src\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceHrefDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoHref, function(val) {\n        return $el.attr(\"href\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceAltDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoAlt, function(val) {\n        return $el.attr(\"alt\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindOnceTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return bindOnce($scope, $attrs.tgBoTitle, function(val) {\n        return $el.attr(\"title\", val);\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindTitleDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgTitleHtml, function(val) {\n        if (val != null) {\n          return $el.attr(\"title\", val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  BindHtmlDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$watch($attrs.tgBindHtml, function(val) {\n        if (val != null) {\n          return $el.html(val);\n        }\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.directive(\"tgBoBind\", BindOnceBindDirective);\n\n  module.directive(\"tgBoHtml\", BindOnceHtmlDirective);\n\n  module.directive(\"tgBoRef\", BindOnceRefDirective);\n\n  module.directive(\"tgBoSrc\", BindOnceSrcDirective);\n\n  module.directive(\"tgBoHref\", BindOnceHrefDirective);\n\n  module.directive(\"tgBoAlt\", BindOnceAltDirective);\n\n  module.directive(\"tgBoTitle\", BindOnceTitleDirective);\n\n  module.directive(\"tgBindTitle\", BindTitleDirective);\n\n  module.directive(\"tgBindHtml\", BindHtmlDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/conf.coffee\n */\n\n(function() {\n  var ConfigurationService, module;\n\n  ConfigurationService = (function() {\n    function ConfigurationService() {\n      this.config = window.taigaConfig;\n    }\n\n    ConfigurationService.prototype.get = function(key, defaultValue) {\n      if (defaultValue == null) {\n        defaultValue = null;\n      }\n      if (_.has(this.config, key)) {\n        return this.config[key];\n      }\n      return defaultValue;\n    };\n\n    return ConfigurationService;\n\n  })();\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgConfig\", ConfigurationService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/contrib.coffee\n */\n\n(function() {\n  var ContribController, ContribUserSettingsController, module,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  module = angular.module(\"taigaBase\");\n\n  ContribController = (function(superClass) {\n    extend(ContribController, superClass);\n\n    ContribController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\", \"$tgRepo\", \"$tgResources\", \"$tgConfirm\"];\n\n    function ContribController(rootScope, scope, params, repo, rs, confirm) {\n      var promise;\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.repo = repo;\n      this.rs = rs;\n      this.confirm = confirm;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.adminPlugins, {\n        \"slug\": this.params.plugin\n      }));\n      this.scope.projectSlug = this.params.pslug;\n      promise = this.loadInitialData();\n      promise.then(null, (function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    }\n\n    ContribController.prototype.loadProject = function() {\n      return this.rs.projects.getBySlug(this.params.pslug).then((function(_this) {\n        return function(project) {\n          _this.scope.projectId = project.id;\n          _this.scope.project = project;\n          _this.scope.$emit('project:loaded', project);\n          _this.scope.$broadcast('project:loaded', project);\n          return project;\n        };\n      })(this));\n    };\n\n    ContribController.prototype.loadInitialData = function() {\n      return this.loadProject();\n    };\n\n    return ContribController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribController\", ContribController);\n\n  ContribUserSettingsController = (function(superClass) {\n    extend(ContribUserSettingsController, superClass);\n\n    ContribUserSettingsController.$inject = [\"$rootScope\", \"$scope\", \"$routeParams\"];\n\n    function ContribUserSettingsController(rootScope, scope, params) {\n      this.rootScope = rootScope;\n      this.scope = scope;\n      this.params = params;\n      this.scope.currentPlugin = _.head(_.filter(this.rootScope.userSettingsPlugins, {\n        \"slug\": this.params.plugin\n      }));\n    }\n\n    return ContribUserSettingsController;\n\n  })(taiga.Controller);\n\n  module.controller(\"ContribUserSettingsController\", ContribUserSettingsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/filters.coffee\n */\n\n(function() {\n  var FiltersStorageService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  FiltersStorageService = (function(superClass) {\n    extend(FiltersStorageService, superClass);\n\n    FiltersStorageService.$inject = [\"$tgStorage\", \"$routeParams\"];\n\n    function FiltersStorageService(storage, params) {\n      this.storage = storage;\n      this.params = params;\n    }\n\n    FiltersStorageService.prototype.generateHash = function(components) {\n      if (components == null) {\n        components = [];\n      }\n      components = _.map(components, function(x) {\n        return JSON.stringify(x);\n      });\n      return hex_sha1(components.join(\":\"));\n    };\n\n    return FiltersStorageService;\n\n  })(taiga.Service);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var HttpService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  HttpService = (function(superClass) {\n    extend(HttpService, superClass);\n\n    HttpService.$inject = [\"$http\", \"$q\", \"$tgStorage\", \"$rootScope\", \"$cacheFactory\", \"$translate\"];\n\n    function HttpService(http, q, storage, rootScope, cacheFactory, translate) {\n      this.http = http;\n      this.q = q;\n      this.storage = storage;\n      this.rootScope = rootScope;\n      this.cacheFactory = cacheFactory;\n      this.translate = translate;\n      HttpService.__super__.constructor.call(this);\n      this.cache = this.cacheFactory(\"httpget\");\n    }\n\n    HttpService.prototype.headers = function() {\n      var headers, lang, token;\n      headers = {};\n      token = this.storage.get('token');\n      if (token) {\n        headers[\"Authorization\"] = \"Bearer \" + token;\n      }\n      lang = this.translate.preferredLanguage();\n      if (lang) {\n        headers[\"Accept-Language\"] = lang;\n      }\n      return headers;\n    };\n\n    HttpService.prototype.request = function(options) {\n      options.headers = _.assign({}, options.headers || {}, this.headers());\n      return this.http(options);\n    };\n\n    HttpService.prototype.get = function(url, params, options) {\n      options = _.assign({\n        method: \"GET\",\n        url: url\n      }, options);\n      if (params) {\n        options.params = params;\n      }\n      options.cache = this.cache;\n      return this.request(options)[\"finally\"]((function(_this) {\n        return function(data) {\n          return _this.cache.removeAll();\n        };\n      })(this));\n    };\n\n    HttpService.prototype.post = function(url, data, params, options) {\n      options = _.assign({\n        method: \"POST\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.put = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PUT\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype.patch = function(url, data, params, options) {\n      options = _.assign({\n        method: \"PATCH\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    HttpService.prototype[\"delete\"] = function(url, data, params, options) {\n      options = _.assign({\n        method: \"DELETE\",\n        url: url\n      }, options);\n      if (data) {\n        options.data = data;\n      }\n      if (params) {\n        options.params = params;\n      }\n      return this.request(options);\n    };\n\n    return HttpService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgHttp\", HttpService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/location.coffee\n */\n\n(function() {\n  var locationFactory, module;\n\n  locationFactory = function($location, $route, $rootscope) {\n    $location.noreload = function(scope) {\n      var lastRoute, un;\n      lastRoute = $route.current;\n      un = scope.$on(\"$locationChangeSuccess\", function() {\n        $route.current = lastRoute;\n        return un();\n      });\n      return $location;\n    };\n    $location.isInCurrentRouteParams = function(name, value) {\n      var params;\n      params = $location.search() || {};\n      return params[name] === value;\n    };\n    return $location;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgLocation\", [\"$location\", \"$route\", \"$rootScope\", locationFactory]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/model.coffee\n */\n\n(function() {\n  var Model, ModelService, module, provider, taiga,\n    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  Model = (function() {\n    function Model(name, data, dataTypes) {\n      this._attrs = data;\n      this._name = name;\n      this._dataTypes = dataTypes;\n      this.setAttrs(data);\n      this.initialize();\n    }\n\n    Model.prototype.clone = function() {\n      var instance;\n      instance = new Model(this._name, this._attrs, this._dataTypes);\n      instance._modifiedAttrs = this._modifiedAttrs;\n      instance._isModified = this._isModified;\n      return instance;\n    };\n\n    Model.prototype.applyCasts = function() {\n      var attrName, castMethod, castName, ref, results;\n      ref = this._dataTypes;\n      results = [];\n      for (attrName in ref) {\n        castName = ref[attrName];\n        castMethod = service.casts[castName];\n        if (!castMethod) {\n          continue;\n        }\n        results.push(this._attrs[attrName] = castMethod(this._attrs[attrName]));\n      }\n      return results;\n    };\n\n    Model.prototype.getIdAttrName = function() {\n      return \"id\";\n    };\n\n    Model.prototype.getName = function() {\n      return this._name;\n    };\n\n    Model.prototype.getAttrs = function(patch) {\n      if (patch == null) {\n        patch = false;\n      }\n      if (this._attrs.version != null) {\n        this._modifiedAttrs.version = this._attrs.version;\n      }\n      if (patch) {\n        return _.extend({}, this._modifiedAttrs);\n      }\n      return _.extend({}, this._attrs, this._modifiedAttrs);\n    };\n\n    Model.prototype.setAttrs = function(attrs) {\n      this._attrs = attrs;\n      this._modifiedAttrs = {};\n      this.applyCasts();\n      return this._isModified = false;\n    };\n\n    Model.prototype.setAttr = function(name, value) {\n      this._modifiedAttrs[name] = value;\n      return this._isModified = true;\n    };\n\n    Model.prototype.initialize = function() {\n      var getter, self, setter;\n      self = this;\n      getter = function(name) {\n        return function() {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            return self[name];\n          }\n          if (indexOf.call(_.keys(self._modifiedAttrs), name) < 0) {\n            return self._attrs[name];\n          }\n          return self._modifiedAttrs[name];\n        };\n      };\n      setter = function(name) {\n        return function(value) {\n          if (typeof name === 'string' && name.substr(0, 2) === \"__\") {\n            self[name] = value;\n            return;\n          }\n          if (self._attrs[name] !== value) {\n            self._modifiedAttrs[name] = value;\n            self._isModified = true;\n          } else {\n            delete self._modifiedAttrs[name];\n          }\n        };\n      };\n      return _.each(this._attrs, function(value, name) {\n        var options;\n        options = {\n          get: getter(name),\n          set: setter(name),\n          enumerable: true,\n          configurable: true\n        };\n        return Object.defineProperty(self, name, options);\n      });\n    };\n\n    Model.prototype.serialize = function() {\n      var data;\n      data = {\n        \"data\": _.clone(this._attrs),\n        \"name\": this._name\n      };\n      return JSON.stringify(data);\n    };\n\n    Model.prototype.isModified = function() {\n      return this._isModified;\n    };\n\n    Model.prototype.isAttributeModified = function(attribute) {\n      return this._modifiedAttrs[attribute] != null;\n    };\n\n    Model.prototype.markSaved = function() {\n      this._isModified = false;\n      this._attrs = this.getAttrs();\n      return this._modifiedAttrs = {};\n    };\n\n    Model.prototype.revert = function() {\n      this._modifiedAttrs = {};\n      return this._isModified = false;\n    };\n\n    Model.desSerialize = function(sdata) {\n      var ddata, model;\n      ddata = JSON.parse(sdata);\n      model = new Model(ddata.url, ddata.data);\n      return model;\n    };\n\n    return Model;\n\n  })();\n\n  taiga = this.taiga;\n\n  ModelService = (function(superClass) {\n    extend(ModelService, superClass);\n\n    ModelService.$inject = [\"$q\", \"$tgUrls\", \"$tgStorage\", \"$tgHttp\"];\n\n    function ModelService(q, urls, storage, http) {\n      this.q = q;\n      this.urls = urls;\n      this.storage = storage;\n      this.http = http;\n      ModelService.__super__.constructor.call(this);\n    }\n\n    return ModelService;\n\n  })(taiga.Service);\n\n  provider = function($q, $http, $gmUrls, $gmStorage) {\n    var service;\n    service = {};\n    service.make_model = function(name, data, cls, dataTypes) {\n      if (cls == null) {\n        cls = Model;\n      }\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      return new cls(name, data, dataTypes);\n    };\n    service.cls = Model;\n    service.casts = {\n      int: function(value) {\n        return parseInt(value, 10);\n      },\n      float: function(value) {\n        return parseFloat(value, 10);\n      }\n    };\n    return service;\n  };\n\n  module = angular.module(\"taigaBase\");\n\n  module.factory(\"$tgModel\", [\"$q\", \"$http\", \"$tgUrls\", \"$tgStorage\", provider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/navurl.coffee\n */\n\n(function() {\n  var NavigationUrlsDirective, NavigationUrlsService, bindOnce, module, taiga, trim,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  trim = this.taiga.trim;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaBase\");\n\n  NavigationUrlsService = (function(superClass) {\n    extend(NavigationUrlsService, superClass);\n\n    function NavigationUrlsService() {\n      this.urls = {};\n    }\n\n    NavigationUrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge({}, this.urls, urls || {});\n    };\n\n    NavigationUrlsService.prototype.formatUrl = function(url, ctx) {\n      var replacer;\n      if (ctx == null) {\n        ctx = {};\n      }\n      replacer = function(match) {\n        match = trim(match, \":\");\n        return ctx[match] || \"undefined\";\n      };\n      return url.replace(/(:\\w+)/g, replacer);\n    };\n\n    NavigationUrlsService.prototype.resolve = function(name, ctx) {\n      var url;\n      url = this.urls[name];\n      if (!url) {\n        return \"\";\n      }\n      if (ctx) {\n        return this.formatUrl(url, ctx);\n      }\n      return url;\n    };\n\n    return NavigationUrlsService;\n\n  })(taiga.Service);\n\n  module.service(\"$tgNavUrls\", NavigationUrlsService);\n\n  NavigationUrlsDirective = function($navurls, $auth, $q, $location, lightboxService) {\n    var bindOnceP, link, parseNav;\n    bindOnceP = function($scope, attr) {\n      var defered;\n      defered = $q.defer();\n      bindOnce($scope, attr, function(v) {\n        return defered.resolve(v);\n      });\n      return defered.promise;\n    };\n    parseNav = function(data, $scope) {\n      var index, name, obj, params, promises, ref, result, values;\n      ref = _.map(data.split(\":\"), trim), name = ref[0], params = ref[1];\n      if (params) {\n        result = params.split(/(\\w+)=/);\n        result = _.filter(result, function(str) {\n          return str.length;\n        });\n        result = _.map(result, function(str) {\n          return trim(str.replace(/,$/g, ''));\n        });\n        params = [];\n        index = 0;\n        while (index < result.length) {\n          obj = {};\n          obj[result[index]] = result[index + 1];\n          params.push(obj);\n          index = index + 2;\n        }\n      } else {\n        params = [];\n      }\n      values = _.map(params, function(param) {\n        return _.values(param)[0];\n      });\n      promises = _.map(values, function(x) {\n        return bindOnceP($scope, x);\n      });\n      return $q.all(promises).then(function() {\n        var i, key, len, options, param, value;\n        options = {};\n        for (i = 0, len = params.length; i < len; i++) {\n          param = params[i];\n          key = Object.keys(param)[0];\n          value = param[key];\n          options[key] = $scope.$eval(value);\n        }\n        return [name, options];\n      });\n    };\n    link = function($scope, $el, $attrs) {\n      if ($el.is(\"a\")) {\n        $el.attr(\"href\", \"#\");\n      }\n      $el.on(\"mouseenter\", function(event) {\n        var target;\n        target = $(event.currentTarget);\n        if (!target.data(\"fullUrl\") || $attrs.tgNavGetParams !== target.data(\"params\")) {\n          return parseNav($attrs.tgNav, $scope).then(function(result) {\n            var fullUrl, getURLParams, getURLParamsStr, name, options, url, user;\n            name = result[0], options = result[1];\n            user = $auth.getUser();\n            if (user) {\n              options.user = user.username;\n            }\n            url = $navurls.resolve(name);\n            fullUrl = $navurls.formatUrl(url, options);\n            if ($attrs.tgNavGetParams) {\n              getURLParams = JSON.parse($attrs.tgNavGetParams);\n              getURLParamsStr = $.param(getURLParams);\n              fullUrl = fullUrl + \"?\" + getURLParamsStr;\n              target.data(\"params\", $attrs.tgNavGetParams);\n            }\n            target.data(\"fullUrl\", fullUrl);\n            if (target.is(\"a\")) {\n              target.attr(\"href\", fullUrl);\n            }\n            return $el.on(\"click\", function(event) {\n              if (event.metaKey || event.ctrlKey) {\n                return;\n              }\n              event.preventDefault();\n              target = $(event.currentTarget);\n              if (target.hasClass('noclick')) {\n                return;\n              }\n              fullUrl = target.data(\"fullUrl\");\n              switch (event.which) {\n                case 1:\n                  $location.url(fullUrl);\n                  $scope.$apply();\n                  break;\n                case 2:\n                  window.open(fullUrl);\n              }\n              return lightboxService.closeAll();\n            });\n          });\n        }\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgNav\", [\"$tgNavUrls\", \"$tgAuth\", \"$q\", \"$tgLocation\", \"lightboxService\", NavigationUrlsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/repository.coffee\n */\n\n(function() {\n  var RepositoryService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  RepositoryService = (function(superClass) {\n    extend(RepositoryService, superClass);\n\n    RepositoryService.$inject = [\"$q\", \"$tgModel\", \"$tgStorage\", \"$tgHttp\", \"$tgUrls\"];\n\n    function RepositoryService(q, model1, storage, http, urls) {\n      this.q = q;\n      this.model = model1;\n      this.storage = storage;\n      this.http = http;\n      this.urls = urls;\n      RepositoryService.__super__.constructor.call(this);\n    }\n\n    RepositoryService.prototype.resolveUrlForModel = function(model) {\n      var idAttrName;\n      idAttrName = model.getIdAttrName();\n      return (this.urls.resolve(model.getName())) + \"/\" + model[idAttrName];\n    };\n\n    RepositoryService.prototype.resolveUrlForAttributeModel = function(model) {\n      return this.urls.resolve(model.getName(), model.parent);\n    };\n\n    RepositoryService.prototype.create = function(name, data, dataTypes, extraParams) {\n      var defered, promise, url;\n      if (dataTypes == null) {\n        dataTypes = {};\n      }\n      if (extraParams == null) {\n        extraParams = {};\n      }\n      defered = this.q.defer();\n      url = this.urls.resolve(name);\n      promise = this.http.post(url, JSON.stringify(data));\n      promise.success((function(_this) {\n        return function(_data, _status) {\n          return defered.resolve(_this.model.make_model(name, _data, null, dataTypes));\n        };\n      })(this));\n      promise.error((function(_this) {\n        return function(data, status) {\n          return defered.reject(data);\n        };\n      })(this));\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.remove = function(model, params) {\n      var defered, promise, url;\n      if (params == null) {\n        params = {};\n      }\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http[\"delete\"](url, {}, params);\n      promise.success(function(data, status) {\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(model);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAll = function(models, patch) {\n      var promises;\n      if (patch == null) {\n        patch = true;\n      }\n      promises = _.map(models, (function(_this) {\n        return function(x) {\n          return _this.save(x, true);\n        };\n      })(this));\n      return this.q.all(promises);\n    };\n\n    RepositoryService.prototype.save = function(model, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForModel(model);\n      data = JSON.stringify(model.getAttrs(patch));\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.saveAttribute = function(model, attribute, patch) {\n      var data, defered, promise, url;\n      if (patch == null) {\n        patch = true;\n      }\n      defered = this.q.defer();\n      if (!model.isModified() && patch) {\n        defered.resolve(model);\n        return defered.promise;\n      }\n      url = this.resolveUrlForAttributeModel(model);\n      data = {};\n      data[attribute] = model.getAttrs();\n      if (patch) {\n        promise = this.http.patch(url, data);\n      } else {\n        promise = this.http.put(url, data);\n      }\n      promise.success((function(_this) {\n        return function(data, status) {\n          model._isModified = false;\n          model._attrs = _.extend(model.getAttrs(), data);\n          model._modifiedAttrs = {};\n          model.applyCasts();\n          return defered.resolve(model);\n        };\n      })(this));\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.refresh = function(model) {\n      var defered, promise, url;\n      defered = this.q.defer();\n      url = this.resolveUrlForModel(model);\n      promise = this.http.get(url);\n      promise.success(function(data, status) {\n        model._modifiedAttrs = {};\n        model._attrs = data;\n        model._isModified = false;\n        model.applyCasts();\n        return defered.resolve(model);\n      });\n      promise.error(function(data, status) {\n        return defered.reject(data);\n      });\n      return defered.promise;\n    };\n\n    RepositoryService.prototype.queryMany = function(name, params, options, headers) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      if (headers == null) {\n        headers = false;\n      }\n      url = this.urls.resolve(name);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var result;\n          result = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          if (headers) {\n            return [result, data.headers];\n          }\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneAttribute = function(name, id, attribute, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name, id);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var model;\n          model = _this.model.make_model(name, data.data[attribute]);\n          model.parent = id;\n          return model;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOne = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return _this.model.make_model(name, data.data);\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOneRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryPaginated = function(name, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.models = _.map(data.data, function(x) {\n            return _this.model.make_model(name, x);\n          });\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.queryOnePaginatedRaw = function(name, id, params, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = this.urls.resolve(name);\n      if (id) {\n        url = url + \"/\" + id;\n      }\n      httpOptions = _.merge({\n        headers: {}\n      }, options);\n      return this.http.get(url, params, httpOptions).then((function(_this) {\n        return function(data) {\n          var headers, result;\n          headers = data.headers();\n          result = {};\n          result.data = data.data;\n          result.count = parseInt(headers[\"x-pagination-count\"], 10);\n          result.current = parseInt(headers[\"x-pagination-current\"] || 1, 10);\n          result.paginatedBy = parseInt(headers[\"x-paginated-by\"], 10);\n          return result;\n        };\n      })(this));\n    };\n\n    RepositoryService.prototype.resolve = function(options) {\n      var cache, params;\n      params = {};\n      if (options.pslug != null) {\n        params.project = options.pslug;\n      }\n      if (options.usref != null) {\n        params.us = options.usref;\n      }\n      if (options.taskref != null) {\n        params.task = options.taskref;\n      }\n      if (options.issueref != null) {\n        params.issue = options.issueref;\n      }\n      if (options.sslug != null) {\n        params.milestone = options.sslug;\n      }\n      if (options.wikipage != null) {\n        params.wikipage = options.wikipage;\n      }\n      cache = !(options.wikipage || options.sslug);\n      return this.queryOneRaw(\"resolver\", null, params, {\n        cache: cache\n      });\n    };\n\n    return RepositoryService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgRepo\", RepositoryService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/storage.coffee\n */\n\n(function() {\n  var StorageService, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  StorageService = (function(superClass) {\n    extend(StorageService, superClass);\n\n    StorageService.$inject = [\"$rootScope\"];\n\n    function StorageService($rootScope) {\n      StorageService.__super__.constructor.call(this);\n    }\n\n    StorageService.prototype.get = function(key, _default) {\n      var serializedValue;\n      serializedValue = localStorage.getItem(key);\n      if (serializedValue === null) {\n        return _default || null;\n      }\n      return JSON.parse(serializedValue);\n    };\n\n    StorageService.prototype.set = function(key, val) {\n      if (_.isObject(key)) {\n        return _.each(key, (function(_this) {\n          return function(val, key) {\n            return _this.set(key, val);\n          };\n        })(this));\n      } else {\n        return localStorage.setItem(key, JSON.stringify(val));\n      }\n    };\n\n    StorageService.prototype.contains = function(key) {\n      var value;\n      value = this.get(key);\n      return value !== null;\n    };\n\n    StorageService.prototype.remove = function(key) {\n      return localStorage.removeItem(key);\n    };\n\n    StorageService.prototype.clear = function() {\n      return localStorage.clear();\n    };\n\n    return StorageService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service(\"$tgStorage\", StorageService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/base/http.coffee\n */\n\n(function() {\n  var UrlsService, format, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  format = function(fmt, obj) {\n    obj = _.clone(obj);\n    return fmt.replace(/%s/g, function(match) {\n      return String(obj.shift());\n    });\n  };\n\n  taiga = this.taiga;\n\n  UrlsService = (function(superClass) {\n    extend(UrlsService, superClass);\n\n    UrlsService.$inject = [\"$tgConfig\"];\n\n    function UrlsService(config) {\n      this.config = config;\n      this.urls = {};\n      this.mainUrl = this.config.get(\"api\");\n    }\n\n    UrlsService.prototype.update = function(urls) {\n      return this.urls = _.merge(this.urls, urls);\n    };\n\n    UrlsService.prototype.resolve = function() {\n      var args, name, url;\n      args = _.toArray(arguments);\n      if (args.length === 0) {\n        throw Error(\"wrong arguments to setUrls\");\n      }\n      name = args.slice(0, 1)[0];\n      url = format(this.urls[name], args.slice(1));\n      return format(\"%s/%s\", [_.trimEnd(this.mainUrl, \"/\"), _.trimStart(url, \"/\")]);\n    };\n\n    UrlsService.prototype.resolveAbsolute = function() {\n      var url;\n      url = this.resolve.apply(this, arguments);\n      if (/^https?:\\/\\//i.test(url)) {\n        return url;\n      }\n      if (/^\\//.test(url)) {\n        return window.location.protocol + \"//\" + window.location.host + url;\n      }\n      return window.location.protocol + \"//\" + window.location.host + \"/\" + url;\n    };\n\n    return UrlsService;\n\n  })(taiga.Service);\n\n  module = angular.module(\"taigaBase\");\n\n  module.service('$tgUrls', UrlsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/custom-field-values.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var _get, service;\n    _get = function(objectId, resource) {\n      return $repo.queryOne(resource, objectId);\n    };\n    service = {\n      userstory: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/userstory\");\n        }\n      },\n      task: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/task\");\n        }\n      },\n      issue: {\n        get: function(objectId) {\n          return _get(objectId, \"custom-attributes-values/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributesValues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesValuesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var _list, service;\n    _list = function(projectId, resource) {\n      return $repo.queryMany(resource, {\n        project: projectId\n      });\n    };\n    service = {\n      userstory: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/userstory\");\n        }\n      },\n      task: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/task\");\n        }\n      },\n      issue: {\n        list: function(projectId) {\n          return _list(projectId, \"custom-attributes/issue\");\n        }\n      }\n    };\n    return function(instance) {\n      return instance.customAttributes = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgCustomAttributesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/history.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(type, objectId) {\n      return $repo.queryOneRaw(\"history/\" + type, objectId);\n    };\n    service.deleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/delete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    service.undeleteComment = function(type, objectId, activityId) {\n      var params, url;\n      url = $urls.resolve(\"history/\" + type);\n      url = url + \"/\" + objectId + \"/undelete_comment\";\n      params = {\n        id: activityId\n      };\n      return $http.post(url, null, params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.history = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgHistoryResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.get = function(token) {\n      return $repo.queryOne(\"invitations\", token);\n    };\n    return function(instance) {\n      return instance.invitations = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgInvitationsResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/issues.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage, $q) {\n    var filtersHashSuffix, hashSuffix, myFiltersHashSuffix, service;\n    service = {};\n    hashSuffix = \"issues-queryparams\";\n    filtersHashSuffix = \"issues-filters\";\n    myFiltersHashSuffix = \"issues-my-filters\";\n    service.get = function(projectId, issueId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"issues\", issueId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"issues\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"issues\", filters);\n    };\n    service.list = function(projectId, filters, options) {\n      var params;\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryPaginated(\"issues\", params, options);\n    };\n    service.bulkCreate = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-issues\");\n      params = {\n        project_id: projectId,\n        bulk_issues: data\n      };\n      return $http.post(url, params);\n    };\n    service.upvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-upvote\", issueId);\n      return $http.post(url);\n    };\n    service.downvote = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-downvote\", issueId);\n      return $http.post(url);\n    };\n    service.watch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-watch\", issueId);\n      return $http.post(url);\n    };\n    service.unwatch = function(issueId) {\n      var url;\n      url = $urls.resolve(\"issue-unwatch\", issueId);\n      return $http.post(url);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/issues_stats\");\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"issues-filters\", null, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeFilters = function(projectSlug, params) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getFilters = function(projectSlug) {\n      var hash, ns;\n      ns = projectSlug + \":\" + filtersHashSuffix;\n      hash = generateHash([projectSlug, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeMyFilters = function(projectId, myFilters) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      if (_.isEmpty(myFilters)) {\n        promise = $http[\"delete\"](url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function() {\n          return deferred.resolve();\n        });\n        promise.then(null, function() {\n          return deferred.reject();\n        });\n      } else {\n        promise = $http.put(url + \"/\" + hash, {\n          key: hash,\n          value: myFilters\n        });\n        promise.then(function(data) {\n          return deferred.resolve();\n        });\n        promise.then(null, function(data) {\n          var innerPromise;\n          innerPromise = $http.post(\"\" + url, {\n            key: hash,\n            value: myFilters\n          });\n          innerPromise.then(function() {\n            return deferred.resolve();\n          });\n          return innerPromise.then(null, function() {\n            return deferred.reject();\n          });\n        });\n      }\n      return deferred.promise;\n    };\n    service.getMyFilters = function(projectId) {\n      var deferred, hash, ns, promise, url;\n      deferred = $q.defer();\n      url = $urls.resolve(\"user-storage\");\n      ns = projectId + \":\" + myFiltersHashSuffix;\n      hash = generateHash([projectId, ns]);\n      promise = $http.get(url + \"/\" + hash);\n      promise.then(function(data) {\n        return deferred.resolve(data.data.value);\n      });\n      promise.then(null, function(data) {\n        return deferred.resolve({});\n      });\n      return deferred.promise;\n    };\n    return function(instance) {\n      return instance.issues = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgIssuesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/kanban.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($storage) {\n    var hashSuffixStatusColumnModes, hashSuffixStatusViewModes, service;\n    service = {};\n    hashSuffixStatusViewModes = \"kanban-statusviewmodels\";\n    hashSuffixStatusColumnModes = \"kanban-statuscolumnmodels\";\n    service.storeStatusViewModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusViewModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusViewModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.kanban = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgKanbanResourcesProvider\", [\"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/locales.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {\n      list: function() {\n        return $repo.queryMany(\"locales\");\n      }\n    };\n    return function(instance) {\n      return instance.locales = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgLocalesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/mdrender.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.render = function(projectId, content) {\n      var params, url;\n      if ((content == null) || content === \"\") {\n        content = ' ';\n      }\n      params = {\n        project_id: projectId,\n        content: content\n      };\n      url = $urls.resolve(\"wiki\");\n      return $http.post(url + \"/render\", params).then((function(_this) {\n        return function(data) {\n          return data.data;\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.mdrender = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMdRenderResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"memberships\", id);\n    };\n    service.list = function(projectId, filters, enablePagination) {\n      var options, params;\n      if (enablePagination == null) {\n        enablePagination = true;\n      }\n      params = {\n        project: projectId\n      };\n      params = _.extend({}, params, filters || {});\n      if (enablePagination) {\n        return $repo.queryPaginated(\"memberships\", params);\n      }\n      return $repo.queryMany(\"memberships\", params, options = {\n        enablePagination: enablePagination\n      });\n    };\n    service.listByUser = function(userId, filters) {\n      var params;\n      params = {\n        user: userId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryPaginated(\"memberships\", params);\n    };\n    service.resendInvitation = function(id) {\n      var url;\n      url = $urls.resolve(\"memberships\");\n      return $http.post(url + \"/\" + id + \"/resend_invitation\", {});\n    };\n    service.bulkCreateMemberships = function(projectId, data, invitation_extra_text) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-memberships\");\n      params = {\n        project_id: projectId,\n        bulk_memberships: data,\n        invitation_extra_text: invitation_extra_text\n      };\n      return $http.post(url, params);\n    };\n    return function(instance) {\n      return instance.memberships = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgMembershipsResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo) {\n    var service;\n    service = {};\n    service.list = function(projectId, module) {\n      return $repo.queryOneAttribute(\"project-modules\", projectId, module);\n    };\n    return function(instance) {\n      return instance.modules = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgModulesResourcesProvider\", [\"$tgRepo\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"notify-policies\", id);\n    };\n    service.list = function(filters) {\n      var params;\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"notify-policies\", params);\n    };\n    return function(instance) {\n      return instance.notifyPolicies = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgNotifyPoliciesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/projects.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $auth, $q, $translate) {\n    var service;\n    service = {};\n    service.get = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId);\n    };\n    service.getBySlug = function(projectSlug) {\n      return $repo.queryOne(\"projects\", \"by_slug?slug=\" + projectSlug);\n    };\n    service.list = function() {\n      return $repo.queryMany(\"projects\");\n    };\n    service.listByMember = function(memberId) {\n      var params;\n      params = {\n        \"member\": memberId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return $repo.queryMany(\"projects\", params);\n    };\n    service.templates = function() {\n      return $repo.queryMany(\"project-templates\");\n    };\n    service.usersList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"users\", params);\n    };\n    service.rolesList = function(projectId) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(\"roles\", params);\n    };\n    service.stats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/stats\");\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = $urls.resolve(\"bulk-update-projects-order\");\n      return $http.post(url, bulkData);\n    };\n    service.regenerate_userstories_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_userstories_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_issues_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_issues_csv_uuid\";\n      return $http.post(url);\n    };\n    service.regenerate_tasks_csv_uuid = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/regenerate_tasks_csv_uuid\";\n      return $http.post(url);\n    };\n    service.leave = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/leave\";\n      return $http.post(url);\n    };\n    service.memberStats = function(projectId) {\n      return $repo.queryOneRaw(\"projects\", projectId + \"/member_stats\");\n    };\n    service.tagsColors = function(projectId) {\n      return $repo.queryOne(\"projects\", projectId + \"/tags_colors\");\n    };\n    service[\"export\"] = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"exporter\")) + \"/\" + projectId;\n      return $http.get(url);\n    };\n    service[\"import\"] = function(file, statusUpdater) {\n      var complete, data, defered, errorMsg, failed, maxFileSize, response, uploadComplete, uploadFailed, uploadProgress, xhr;\n      defered = $q.defer();\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        errorMsg = $translate.instant(\"PROJECT.IMPORT.ERROR_MAX_SIZE_EXCEEDED\", {\n          fileName: file.name,\n          fileSize: sizeFormat(file.size),\n          maxFileSize: sizeFormat(maxFileSize)\n        });\n        response = {\n          status: 413,\n          data: {\n            _error_message: errorMsg\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          var message, percent;\n          percent = Math.round((evt.loaded / evt.total) * 100);\n          message = $translate.instant(\"PROJECT.IMPORT.UPLOAD_IN_PROGRESS_MESSAGE\", {\n            uploadedSize: sizeFormat(evt.loaded),\n            totalSize: sizeFormat(evt.total)\n          });\n          return statusUpdater(\"in-progress\", null, message, percent);\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"done\", $translate.instant(\"PROJECT.IMPORT.TITLE\"), $translate.instant(\"PROJECT.IMPORT.DESCRIPTION\"));\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return statusUpdater(\"error\");\n        };\n      })(this);\n      complete = (function(_this) {\n        return function(evt) {\n          var error, ref;\n          response = {};\n          try {\n            response.data = JSON.parse(evt.target.responseText);\n          } catch (error) {\n            response.data = {};\n          }\n          response.status = evt.target.status;\n          if (evt.target.getResponseHeader('Taiga-Info-Project-Is-Private')) {\n            response.headers = {\n              isPrivate: evt.target.getResponseHeader('Taiga-Info-Project-Is-Private') === 'True',\n              memberships: parseInt(evt.target.getResponseHeader('Taiga-Info-Project-Memberships'))\n            };\n          }\n          if ((ref = response.status) === 201 || ref === 202) {\n            defered.resolve(response);\n          }\n          return defered.reject(response);\n        };\n      })(this);\n      failed = (function(_this) {\n        return function(evt) {\n          return defered.reject(\"fail\");\n        };\n      })(this);\n      data = new FormData();\n      data.append('dump', file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.upload.addEventListener(\"load\", uploadComplete, false);\n      xhr.upload.addEventListener(\"error\", uploadFailed, false);\n      xhr.upload.addEventListener(\"abort\", uploadFailed, false);\n      xhr.addEventListener(\"load\", complete, false);\n      xhr.addEventListener(\"error\", failed, false);\n      xhr.open(\"POST\", $urls.resolve(\"importer\"));\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + ($auth.getToken()));\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    service.changeLogo = function(projectId, file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('logo', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/change_logo\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeLogo = function(projectId) {\n      var url;\n      url = ($urls.resolve(\"projects\")) + \"/\" + projectId + \"/remove_logo\";\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.projects = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgProjectsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgAuth\", \"$q\", \"$translate\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(id) {\n      return $repo.queryOne(\"roles\", id);\n    };\n    service.list = function(projectId) {\n      return $repo.queryMany(\"roles\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.roles = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgRolesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/search.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $urls, $http, $q) {\n    var service;\n    service = {};\n    service[\"do\"] = function(projectId, term) {\n      var deferredAbort, params, request, url;\n      deferredAbort = $q.defer();\n      url = $urls.resolve(\"search\");\n      params = {\n        url: url,\n        method: \"GET\",\n        timeout: deferredAbort.promise,\n        cancelable: true,\n        params: {\n          project: projectId,\n          text: term,\n          get_all: false\n        }\n      };\n      request = $http.request(params).then(function(data) {\n        return data.data;\n      });\n      request.abort = function() {\n        return deferredAbort.resolve();\n      };\n      request[\"finally\"] = function() {\n        request.abort = angular.noop;\n        return deferredAbort = request = null;\n      };\n      return request;\n    };\n    return function(instance) {\n      return instance.search = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSearchResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/sprints.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $model, $storage) {\n    var service;\n    service = {};\n    service.get = function(projectId, sprintId) {\n      return $repo.queryOne(\"milestones\", sprintId).then(function(sprint) {\n        var uses;\n        uses = sprint.user_stories;\n        uses = _.map(uses, function(u) {\n          return $model.make_model(\"userstories\", u);\n        });\n        sprint._attrs.user_stories = uses;\n        return sprint;\n      });\n    };\n    service.stats = function(projectId, sprintId) {\n      return $repo.queryOneRaw(\"milestones\", sprintId + \"/stats\");\n    };\n    service.list = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      return $repo.queryMany(\"milestones\", params, {}, true).then((function(_this) {\n        return function(result) {\n          var headers, i, len, m, milestones, uses;\n          milestones = result[0];\n          headers = result[1];\n          for (i = 0, len = milestones.length; i < len; i++) {\n            m = milestones[i];\n            uses = m.user_stories;\n            uses = _.map(uses, function(u) {\n              return $model.make_model(\"userstories\", u);\n            });\n            m._attrs.user_stories = uses;\n          }\n          return {\n            milestones: milestones,\n            closed: parseInt(headers(\"Taiga-Info-Total-Closed-Milestones\"), 10),\n            open: parseInt(headers(\"Taiga-Info-Total-Opened-Milestones\"), 10)\n          };\n        };\n      })(this));\n    };\n    return function(instance) {\n      return instance.sprints = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgSprintsResourcesProvider\", [\"$tgRepo\", \"$tgModel\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/tasks.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, hashSuffixStatusColumnModes, hashSuffixUsRowModes, service;\n    service = {};\n    hashSuffix = \"tasks-queryparams\";\n    hashSuffixStatusColumnModes = \"tasks-statuscolumnmodels\";\n    hashSuffixUsRowModes = \"tasks-usrowmodels\";\n    service.get = function(projectId, taskId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"tasks\", taskId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"tasks\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"tasks\", filters);\n    };\n    service.list = function(projectId, sprintId, userStoryId) {\n      var params;\n      if (sprintId == null) {\n        sprintId = null;\n      }\n      if (userStoryId == null) {\n        userStoryId = null;\n      }\n      params = {\n        project: projectId\n      };\n      if (sprintId) {\n        params.milestone = sprintId;\n      }\n      if (userStoryId) {\n        params.user_story = userStoryId;\n      }\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"tasks\", params);\n    };\n    service.bulkCreate = function(projectId, sprintId, usId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-create-tasks\");\n      params = {\n        project_id: projectId,\n        sprint_id: sprintId,\n        us_id: usId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params).then(function(result) {\n        return result.data;\n      });\n    };\n    service.upvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-upvote\", taskId);\n      return $http.post(url);\n    };\n    service.downvote = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-downvote\", taskId);\n      return $http.post(url);\n    };\n    service.watch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-watch\", taskId);\n      return $http.post(url);\n    };\n    service.unwatch = function(taskId) {\n      var url;\n      url = $urls.resolve(\"task-unwatch\", taskId);\n      return $http.post(url);\n    };\n    service.bulkUpdateTaskTaskboardOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-task-taskboard-order\");\n      params = {\n        project_id: projectId,\n        bulk_tasks: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeStatusColumnModes = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getStatusColumnModes = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixStatusColumnModes;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeUsRowModes = function(projectId, sprintId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getUsRowModes = function(projectId, sprintId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffixUsRowModes;\n      hash = generateHash([projectId, sprintId, ns]);\n      return $storage.get(hash) || {};\n    };\n    return function(instance) {\n      return instance.tasks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgTasksResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/memberships.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($config, $repo, $http, $urls, $q) {\n    var service;\n    service = {};\n    service.changeAvatar = function(file) {\n      var data, defered, maxFileSize, options, response, url;\n      maxFileSize = $config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered = $q.defer();\n        defered.reject(response);\n        return defered.promise;\n      }\n      data = new FormData();\n      data.append('avatar', file);\n      options = {\n        transformRequest: angular.identity,\n        headers: {\n          'Content-Type': void 0\n        }\n      };\n      url = ($urls.resolve(\"users\")) + \"/change_avatar\";\n      return $http.post(url, data, {}, options);\n    };\n    service.removeAvatar = function() {\n      var url;\n      url = ($urls.resolve(\"users\")) + \"/remove_avatar\";\n      return $http.post(url);\n    };\n    service.changePassword = function(currentPassword, newPassword) {\n      var data, url;\n      url = ($urls.resolve(\"users\")) + \"/change_password\";\n      data = {\n        current_password: currentPassword,\n        password: newPassword\n      };\n      return $http.post(url, data);\n    };\n    return function(instance) {\n      return instance.userSettings = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserSettingsResourcesProvider\", [\"$tgConfig\", \"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/user.coffee\n */\n\n(function() {\n  var module, resourceProvider, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  resourceProvider = function($http, $urls) {\n    var service;\n    service = {};\n    service.contacts = function(userId, options) {\n      var httpOptions, url;\n      if (options == null) {\n        options = {};\n      }\n      url = $urls.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {}\n      };\n      if (!options.enablePagination) {\n        httpOptions.headers[\"x-disable-pagination\"] = \"1\";\n      }\n      return $http.get(url, {}, httpOptions).then(function(result) {\n        return result.data;\n      });\n    };\n    return function(instance) {\n      return instance.users = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUsersResourcesProvider\", [\"$tgHttp\", \"$tgUrls\", \"$q\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/userstories.coffee\n */\n\n(function() {\n  var generateHash, module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  generateHash = taiga.generateHash;\n\n  resourceProvider = function($repo, $http, $urls, $storage) {\n    var hashSuffix, service;\n    service = {};\n    hashSuffix = \"userstories-queryparams\";\n    service.get = function(projectId, usId) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      return $repo.queryOne(\"userstories\", usId, params);\n    };\n    service.getByRef = function(projectId, ref) {\n      var params;\n      params = service.getQueryParams(projectId);\n      params.project = projectId;\n      params.ref = ref;\n      return $repo.queryOne(\"userstories\", \"by_ref\", params);\n    };\n    service.listInAllProjects = function(filters) {\n      return $repo.queryMany(\"userstories\", filters);\n    };\n    service.filtersData = function(params) {\n      return $repo.queryOneRaw(\"userstories-filters\", null, params);\n    };\n    service.listUnassigned = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId,\n        \"milestone\": \"null\"\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params, {\n        enablePagination: true\n      }, true);\n    };\n    service.listAll = function(projectId, filters) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      params = _.extend({}, params, filters || {});\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(\"userstories\", params);\n    };\n    service.bulkCreate = function(projectId, status, bulk) {\n      var data, url;\n      data = {\n        project_id: projectId,\n        status_id: status,\n        bulk_stories: bulk\n      };\n      url = $urls.resolve(\"bulk-create-us\");\n      return $http.post(url, data);\n    };\n    service.upvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-upvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.downvote = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-downvote\", userStoryId);\n      return $http.post(url);\n    };\n    service.watch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-watch\", userStoryId);\n      return $http.post(url);\n    };\n    service.unwatch = function(userStoryId) {\n      var url;\n      url = $urls.resolve(\"userstory-unwatch\", userStoryId);\n      return $http.post(url);\n    };\n    service.bulkUpdateBacklogOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-backlog-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateSprintOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-sprint-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.bulkUpdateKanbanOrder = function(projectId, data) {\n      var params, url;\n      url = $urls.resolve(\"bulk-update-us-kanban-order\");\n      params = {\n        project_id: projectId,\n        bulk_stories: data\n      };\n      return $http.post(url, params);\n    };\n    service.listValues = function(projectId, type) {\n      var params;\n      params = {\n        \"project\": projectId\n      };\n      service.storeQueryParams(projectId, params);\n      return $repo.queryMany(type, params);\n    };\n    service.storeQueryParams = function(projectId, params) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.set(hash, params);\n    };\n    service.getQueryParams = function(projectId) {\n      var hash, ns;\n      ns = projectId + \":\" + hashSuffix;\n      hash = generateHash([projectId, ns]);\n      return $storage.get(hash) || {};\n    };\n    service.storeShowTags = function(projectId, showTags) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.set(hash, showTags);\n    };\n    service.getShowTags = function(projectId) {\n      var hash;\n      hash = generateHash([projectId, 'showTags']);\n      return $storage.get(hash) || null;\n    };\n    return function(instance) {\n      return instance.userstories = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgUserstoriesResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", \"$tgStorage\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooklogs.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(webhookId) {\n      var params;\n      params = {\n        webhook: webhookId\n      };\n      return $repo.queryMany(\"webhooklogs\", params);\n    };\n    service.resend = function(webhooklogId) {\n      var url;\n      url = $urls.resolve(\"webhooklogs-resend\", webhooklogId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooklogs = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhookLogsResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: webhooks.coffee\n */\n\n(function() {\n  var module, resourceProvider;\n\n  resourceProvider = function($repo, $urls, $http) {\n    var service;\n    service = {};\n    service.list = function(projectId) {\n      var params;\n      params = {\n        project: projectId\n      };\n      return $repo.queryMany(\"webhooks\", params);\n    };\n    service.test = function(webhookId) {\n      var url;\n      url = $urls.resolve(\"webhooks-test\", webhookId);\n      return $http.post(url);\n    };\n    return function(instance) {\n      return instance.webhooks = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWebhooksResourcesProvider\", [\"$tgRepo\", \"$tgUrls\", \"$tgHttp\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/resources/wikis.coffee\n */\n\n(function() {\n  var module, resourceProvider, taiga;\n\n  taiga = this.taiga;\n\n  resourceProvider = function($repo, $http, $urls) {\n    var service;\n    service = {};\n    service.get = function(wikiId) {\n      return $repo.queryOne(\"wiki\", wikiId);\n    };\n    service.getBySlug = function(projectId, slug) {\n      return $repo.queryOne(\"wiki\", \"by_slug?project=\" + projectId + \"&slug=\" + slug);\n    };\n    service.listLinks = function(projectId) {\n      return $repo.queryMany(\"wiki-links\", {\n        project: projectId\n      });\n    };\n    return function(instance) {\n      return instance.wiki = service;\n    };\n  };\n\n  module = angular.module(\"taigaResources\");\n\n  module.factory(\"$tgWikiResourcesProvider\", [\"$tgRepo\", \"$tgHttp\", \"$tgUrls\", resourceProvider]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var UserChangePasswordController, UserChangePasswordDirective, debounce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserChangePasswordController = (function(superClass) {\n    extend(UserChangePasswordController, superClass);\n\n    UserChangePasswordController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserChangePasswordController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = this.translate.instant(\"CHANGE_PASSWORD.SECTION_NAME\");\n      this.scope.user = this.auth.getUser();\n    }\n\n    return UserChangePasswordController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserChangePasswordController\", UserChangePasswordController);\n\n  UserChangePasswordDirective = function($rs, $confirm, $loading, $translate) {\n    var link;\n    link = function($scope, $el, $attrs, ctrl) {\n      var form, submit, submitButton;\n      form = new checksley.Form($el.find(\"form\"));\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var currentLoading, promise;\n          event.preventDefault();\n          if (!form.validate()) {\n            return;\n          }\n          if ($scope.newPassword1 !== $scope.newPassword2) {\n            $confirm.notify('error', $translate.instant(\"CHANGE_PASSWORD.ERROR_PASSWORD_MATCH\"));\n            return;\n          }\n          currentLoading = $loading().target(submitButton).start();\n          promise = $rs.userSettings.changePassword($scope.currentPassword, $scope.newPassword1);\n          promise.then(function() {\n            currentLoading.finish();\n            return $confirm.notify('success');\n          });\n          return promise.then(null, function(response) {\n            currentLoading.finish();\n            return $confirm.notify('error', response.data._error_message);\n          });\n        };\n      })(this));\n      submitButton = $el.find(\".submit-button\");\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserChangePassword\", [\"$tgResources\", \"$tgConfirm\", \"$tgLoading\", \"$translate\", UserChangePasswordDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/issues/lightboxes.coffee\n */\n\n(function() {\n  var DeleteUserDirective, bindOnce, debounce, module, taiga;\n\n  taiga = this.taiga;\n\n  bindOnce = this.taiga.bindOnce;\n\n  debounce = this.taiga.debounce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  DeleteUserDirective = function($repo, $rootscope, $auth, $location, $navUrls, lightboxService, $loading) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit, submitButton;\n      $scope.$on(\"deletelightbox:new\", function(ctx, user) {\n        return lightboxService.open($el);\n      });\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      submit = function() {\n        var currentLoading, promise;\n        currentLoading = $loading().target(submitButton).start();\n        promise = $repo.remove($scope.user);\n        promise.then(function(data) {\n          currentLoading.finish();\n          lightboxService.close($el);\n          $auth.logout();\n          return $location.path($navUrls.resolve(\"login\"));\n        });\n        return promise.then(null, function() {\n          currentLoading.finish();\n          return console.log(\"FAIL\");\n        });\n      };\n      $el.on(\"click\", \".button-green\", function(event) {\n        event.preventDefault();\n        return lightboxService.close($el);\n      });\n      $el.on(\"click\", \".button-red\", debounce(2000, function(event) {\n        event.preventDefault();\n        return submit();\n      }));\n      return submitButton = $el.find(\".button-red\");\n    };\n    return {\n      link: link,\n      templateUrl: \"user/lightbox/lightbox-delete-account.html\"\n    };\n  };\n\n  module.directive(\"tgLbDeleteUser\", [\"$tgRepo\", \"$rootScope\", \"$tgAuth\", \"$tgLocation\", \"$tgNavUrls\", \"lightboxService\", \"$tgLoading\", DeleteUserDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/main.coffee\n */\n\n(function() {\n  var TaigaAvatarModelDirective, UserAvatarDirective, UserProfileDirective, UserSettingsController, debounce, mixOf, module, sizeFormat, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  debounce = this.taiga.debounce;\n\n  UserSettingsController = (function(superClass) {\n    extend(UserSettingsController, superClass);\n\n    UserSettingsController.$inject = [\"$scope\", \"$rootScope\", \"$tgConfig\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\", \"$translate\"];\n\n    function UserSettingsController(scope, rootscope, config, repo, confirm, rs, params, q, location, navUrls, auth, translate) {\n      var maxFileSize, promise, text;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.config = config;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.translate = translate;\n      this.scope.sectionName = \"USER_SETTINGS.MENU.SECTION_TITLE\";\n      this.scope.project = {};\n      this.scope.user = this.auth.getUser();\n      if (!this.scope.user) {\n        this.location.path(this.navUrls.resolve(\"permission-denied\"));\n        this.location.replace();\n      }\n      this.scope.lang = this.getLan();\n      this.scope.theme = this.getTheme();\n      maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize) {\n        text = this.translate.instant(\"USER_SETTINGS.AVATAR_MAX_SIZE\", {\n          \"maxFileSize\": sizeFormat(maxFileSize)\n        });\n        this.scope.maxFileSizeMsg = text;\n      }\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserSettingsController.prototype.loadInitialData = function() {\n      this.scope.availableThemes = this.config.get(\"themes\", []);\n      return this.rs.locales.list().then((function(_this) {\n        return function(locales) {\n          _this.scope.locales = locales;\n          return locales;\n        };\n      })(this));\n    };\n\n    UserSettingsController.prototype.openDeleteLightbox = function() {\n      return this.rootscope.$broadcast(\"deletelightbox:new\", this.scope.user);\n    };\n\n    UserSettingsController.prototype.getLan = function() {\n      return this.scope.user.lang || this.translate.preferredLanguage();\n    };\n\n    UserSettingsController.prototype.getTheme = function() {\n      return this.scope.user.theme || this.config.get(\"defaultTheme\") || \"taiga\";\n    };\n\n    return UserSettingsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserSettingsController\", UserSettingsController);\n\n  UserProfileDirective = function($confirm, $auth, $repo, $translate) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var submit;\n      submit = debounce(2000, (function(_this) {\n        return function(event) {\n          var changeEmail, form, onError, onSuccess;\n          event.preventDefault();\n          form = $el.find(\"form\").checksley();\n          if (!form.validate()) {\n            return;\n          }\n          changeEmail = $scope.user.isAttributeModified(\"email\");\n          $scope.user.lang = $scope.lang;\n          $scope.user.theme = $scope.theme;\n          onSuccess = function(data) {\n            var text;\n            $auth.setUser(data);\n            if (changeEmail) {\n              text = $translate.instant(\"USER_PROFILE.CHANGE_EMAIL_SUCCESS\");\n              return $confirm.success(text);\n            } else {\n              return $confirm.notify('success');\n            }\n          };\n          onError = function(data) {\n            form.setErrors(data);\n            return $confirm.notify('error', data._error_message);\n          };\n          return $repo.save($scope.user).then(onSuccess, onError);\n        };\n      })(this));\n      $el.on(\"submit\", \"form\", submit);\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserProfile\", [\"$tgConfirm\", \"$tgAuth\", \"$tgRepo\", \"$translate\", UserProfileDirective]);\n\n  UserAvatarDirective = function($auth, $model, $rs, $confirm) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var onError, onSuccess, showSizeInfo;\n      showSizeInfo = function() {\n        return $el.find(\".size-info\").removeClass(\"hidden\");\n      };\n      onSuccess = function(response) {\n        var user;\n        user = $model.make_model(\"users\", response.data);\n        $auth.setUser(user);\n        $scope.user = user;\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('success');\n      };\n      onError = function(response) {\n        if (response.status === 413) {\n          showSizeInfo();\n        }\n        $el.find('.loading-overlay').removeClass('active');\n        return $confirm.notify('error', response.data._error_message);\n      };\n      $el.on(\"click\", \".js-change-avatar\", function() {\n        return $el.find(\"#avatar-field\").click();\n      });\n      $el.on(\"change\", \"#avatar-field\", function(event) {\n        if ($scope.avatarAttachment) {\n          $el.find('.loading-overlay').addClass(\"active\");\n          return $rs.userSettings.changeAvatar($scope.avatarAttachment).then(onSuccess, onError);\n        }\n      });\n      $el.on(\"click\", \"a.js-use-gravatar\", function(event) {\n        $el.find('.loading-overlay').addClass(\"active\");\n        return $rs.userSettings.removeAvatar().then(onSuccess, onError);\n      });\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserAvatar\", [\"$tgAuth\", \"$tgModel\", \"$tgResources\", \"$tgConfirm\", UserAvatarDirective]);\n\n  TaigaAvatarModelDirective = function($parse) {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var model, modelSetter;\n      model = $parse($attrs.tgAvatarModel);\n      modelSetter = model.assign;\n      return $el.bind('change', function() {\n        return $scope.$apply(function() {\n          return modelSetter($scope, $el[0].files[0]);\n        });\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive('tgAvatarModel', ['$parse', TaigaAvatarModelDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/nav.coffee\n */\n\n(function() {\n  var UserSettingsNavigationDirective, module;\n\n  UserSettingsNavigationDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      var section;\n      section = $attrs.tgUserSettingsNavigation;\n      $el.find(\".active\").removeClass(\"active\");\n      $el.find(\"#usersettingsmenu-\" + section + \" a\").addClass(\"active\");\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module = angular.module(\"taigaUserSettings\");\n\n  module.directive(\"tgUserSettingsNavigation\", UserSettingsNavigationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/user-settings/notifications.coffee\n */\n\n(function() {\n  var UserNotificationsController, UserNotificationsDirective, UserNotificationsListDirective, bindOnce, mixOf, module, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  bindOnce = this.taiga.bindOnce;\n\n  module = angular.module(\"taigaUserSettings\");\n\n  UserNotificationsController = (function(superClass) {\n    extend(UserNotificationsController, superClass);\n\n    UserNotificationsController.$inject = [\"$scope\", \"$rootScope\", \"$tgRepo\", \"$tgConfirm\", \"$tgResources\", \"$routeParams\", \"$q\", \"$tgLocation\", \"$tgNavUrls\", \"$tgAuth\"];\n\n    function UserNotificationsController(scope, rootscope, repo, confirm, rs, params, q, location, navUrls, auth) {\n      var promise;\n      this.scope = scope;\n      this.rootscope = rootscope;\n      this.repo = repo;\n      this.confirm = confirm;\n      this.rs = rs;\n      this.params = params;\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.auth = auth;\n      this.scope.sectionName = \"USER_SETTINGS.NOTIFICATIONS.SECTION_NAME\";\n      this.scope.user = this.auth.getUser();\n      promise = this.loadInitialData();\n      promise.then(null, this.onInitialDataError.bind(this));\n    }\n\n    UserNotificationsController.prototype.loadInitialData = function() {\n      return this.rs.notifyPolicies.list().then((function(_this) {\n        return function(notifyPolicies) {\n          _this.scope.notifyPolicies = notifyPolicies;\n          return notifyPolicies;\n        };\n      })(this));\n    };\n\n    return UserNotificationsController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin));\n\n  module.controller(\"UserNotificationsController\", UserNotificationsController);\n\n  UserNotificationsDirective = function() {\n    var link;\n    link = function($scope, $el, $attrs) {\n      return $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotifications\", UserNotificationsDirective);\n\n  UserNotificationsListDirective = function($repo, $confirm, $compile) {\n    var link, template;\n    template = _.template(\"<% _.each(notifyPolicies, function (notifyPolicy, index) { %>\\n<div class=\\\"policy-table-row\\\" data-index=\\\"<%- index %>\\\">\\n  <div class=\\\"policy-table-project\\\"><span><%- notifyPolicy.project_name %></span></div>\\n  <div class=\\\"policy-table-all\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             value=\\\"2\\\" <% if (notifyPolicy.notify_level == 2) { %>checked=\\\"checked\\\"<% } %>/>\\n      <label for=\\\"policy-all-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_ALL\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-involved\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             value=\\\"1\\\" <% if (notifyPolicy.notify_level == 1) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-involved-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_INVOLVED\\\"></label>\\n    </fieldset>\\n  </div>\\n  <div class=\\\"policy-table-none\\\">\\n    <fieldset>\\n      <input type=\\\"radio\\\"\\n             name=\\\"policy-<%- notifyPolicy.id %>\\\" id=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             value=\\\"3\\\" <% if (notifyPolicy.notify_level == 3) { %>checked=\\\"checked\\\"<% } %> />\\n      <label for=\\\"policy-none-<%- notifyPolicy.id %>\\\"\\n             translate=\\\"USER_SETTINGS.NOTIFICATIONS.OPTION_NONE\\\"></label>\\n    </fieldset>\\n  </div>\\n</div>\\n<% }) %>\");\n    link = function($scope, $el, $attrs) {\n      var render;\n      render = function() {\n        var ctx, html;\n        $el.off();\n        ctx = {\n          notifyPolicies: $scope.notifyPolicies\n        };\n        html = template(ctx);\n        $el.html($compile(html)($scope));\n        return $el.on(\"change\", \"input[type=radio]\", function(event) {\n          var onError, onSuccess, policy, policyIndex, prev_level, target;\n          target = angular.element(event.currentTarget);\n          policyIndex = target.parents(\".policy-table-row\").data('index');\n          policy = $scope.notifyPolicies[policyIndex];\n          prev_level = policy.notify_level;\n          policy.notify_level = parseInt(target.val(), 10);\n          onSuccess = function() {\n            return $confirm.notify(\"success\");\n          };\n          onError = function() {\n            $confirm.notify(\"error\");\n            return target.parents(\".policy-table-row\").find(\"input[value=\" + prev_level + \"]\").prop(\"checked\", true);\n          };\n          return $repo.save(policy).then(onSuccess, onError);\n        });\n      };\n      $scope.$on(\"$destroy\", function() {\n        return $el.off();\n      });\n      return bindOnce($scope, $attrs.ngModel, render);\n    };\n    return {\n      link: link\n    };\n  };\n\n  module.directive(\"tgUserNotificationsList\", [\"$tgRepo\", \"$tgConfirm\", \"$compile\", UserNotificationsListDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: components.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaComponents\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaDiscover\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaExternalApps\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaHome\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaNavigationBar\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.module.coffee\n */\n\n(function() {\n  var module;\n\n  module = angular.module(\"taigaProfile\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaProjects\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaResources2\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.module.coffee\n */\n\n(function() {\n  angular.module(\"taigaUserTimeline\", []);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-link.directive.coffee\n */\n\n(function() {\n  var AttachmentLinkDirective;\n\n  AttachmentLinkDirective = function($parse, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs) {\n      var attachment;\n      attachment = $parse(attrs.tgAttachmentLink)(scope);\n      el.on(\"click\", function(event) {\n        if (taiga.isImage(attachment.getIn(['file', 'name']))) {\n          event.preventDefault();\n          return scope.$apply(function() {\n            return lightboxFactory.create('tg-lb-attachment-preview', {\n              \"class\": 'lightbox lightbox-block'\n            }, {\n              file: attachment.get('file')\n            });\n          });\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentLinkDirective.$inject = [\"$parse\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentLink\", AttachmentLinkDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment-gallery.directive.coffee\n */\n\n(function() {\n  var AttachmentGalleryDirective;\n\n  AttachmentGalleryDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment-gallery.html\",\n      link: link\n    };\n  };\n\n  AttachmentGalleryDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentGallery\", AttachmentGalleryDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchment.controller.coffee\n */\n\n(function() {\n  var AttachmentController;\n\n  AttachmentController = (function() {\n    AttachmentController.$inject = ['tgAttachmentsService', '$translate'];\n\n    function AttachmentController(attachmentsService, translate) {\n      this.attachmentsService = attachmentsService;\n      this.translate = translate;\n      this.form = {};\n      this.form.description = this.attachment.getIn(['file', 'description']);\n      this.form.is_deprecated = this.attachment.get(['file', 'is_deprecated']);\n      this.title = this.translate.instant(\"ATTACHMENT.TITLE\", {\n        fileName: this.attachment.get('name'),\n        date: moment(this.attachment.get('created_date')).format(this.translate.instant(\"ATTACHMENT.DATE\"))\n      });\n    }\n\n    AttachmentController.prototype.editMode = function(mode) {\n      var attachment;\n      attachment = this.attachment.set('editable', mode);\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    AttachmentController.prototype[\"delete\"] = function() {\n      return this.onDelete({\n        attachment: this.attachment\n      });\n    };\n\n    AttachmentController.prototype.save = function() {\n      var attachment;\n      attachment = this.attachment.set('loading', true);\n      this.onUpdate({\n        attachment: attachment\n      });\n      attachment = this.attachment.merge({\n        editable: false,\n        loading: false\n      });\n      attachment = attachment.mergeIn(['file'], {\n        description: this.form.description,\n        is_deprecated: !!this.form.is_deprecated\n      });\n      return this.onUpdate({\n        attachment: attachment\n      });\n    };\n\n    return AttachmentController;\n\n  })();\n\n  angular.module('taigaComponents').controller('Attachment', AttachmentController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachment.directive.coffee\n */\n\n(function() {\n  var AttachmentDirective;\n\n  AttachmentDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachment: \"=\",\n        onDelete: \"&\",\n        onUpdate: \"&\",\n        type: \"=\"\n      },\n      controller: \"Attachment\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachment/attachment.html\",\n      link: link\n    };\n  };\n\n  AttachmentDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachment\", AttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-drop.directive.coffee\n */\n\n(function() {\n  var AttachmentsDropDirective;\n\n  AttachmentsDropDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgAttachmentsDrop);\n      el.on('dragover', function(e) {\n        e.preventDefault();\n        return false;\n      });\n      el.on('drop', function(e) {\n        var dataTransfer;\n        e.stopPropagation();\n        e.preventDefault();\n        dataTransfer = e.dataTransfer || (e.originalEvent && e.originalEvent.dataTransfer);\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: dataTransfer.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentsDropDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsDrop\", AttachmentsDropDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.controller.coffee\n */\n\n(function() {\n  var AttachmentsFullController, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsFullController = (function() {\n    AttachmentsFullController.$inject = [\"$translate\", \"$tgConfirm\", \"$tgConfig\", \"$tgStorage\", \"tgAttachmentsFullService\", \"tgProjectService\"];\n\n    function AttachmentsFullController(translate, confirm, config, storage, attachmentsFullService, projectService) {\n      this.translate = translate;\n      this.confirm = confirm;\n      this.config = config;\n      this.storage = storage;\n      this.attachmentsFullService = attachmentsFullService;\n      this.projectService = projectService;\n      this.mode = this.storage.get('attachment-mode', 'list');\n      this.maxFileSize = this.config.get(\"maxUploadFileSize\", null);\n      if (this.maxFileSize) {\n        this.maxFileSize = sizeFormat(this.maxFileSize);\n      }\n      this.maxFileSizeMsg = this.maxFileSize ? this.translate.instant(\"ATTACHMENT.MAX_UPLOAD_SIZE\", {\n        maxFileSize: this.maxFileSize\n      }) : \"\";\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this.attachmentsFullService.deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullController.prototype.uploadingAttachments = function() {\n      return this.attachmentsFullService.uploadingAttachments;\n    };\n\n    AttachmentsFullController.prototype.addAttachment = function(file) {\n      var editable;\n      editable = this.mode === 'list';\n      return this.attachmentsFullService.addAttachment(this.projectId, this.objId, this.type, file, editable);\n    };\n\n    AttachmentsFullController.prototype.setMode = function(mode) {\n      this.mode = mode;\n      return this.storage.set('attachment-mode', mode);\n    };\n\n    AttachmentsFullController.prototype.toggleDeprecatedsVisible = function() {\n      return this.attachmentsFullService.toggleDeprecatedsVisible();\n    };\n\n    AttachmentsFullController.prototype.addAttachments = function(files) {\n      return _.forEach(files, (function(_this) {\n        return function(file) {\n          return _this.addAttachment(file);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.loadAttachments = function() {\n      return this.attachmentsFullService.loadAttachments(this.type, this.objId, this.projectId);\n    };\n\n    AttachmentsFullController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      var message, title;\n      title = this.translate.instant(\"ATTACHMENT.TITLE_LIGHTBOX_DELETE_ATTACHMENT\");\n      message = this.translate.instant(\"ATTACHMENT.MSG_LIGHTBOX_DELETE_ATTACHMENT\", {\n        fileName: toDeleteAttachment.getIn(['file', 'name'])\n      });\n      return this.confirm.askOnDelete(title, message).then((function(_this) {\n        return function(askResponse) {\n          var onError, onSuccess;\n          onError = function() {\n            message = _this.translate.instant(\"ATTACHMENT.ERROR_DELETE_ATTACHMENT\", {\n              errorMessage: message\n            });\n            _this.confirm.notify(\"error\", null, message);\n            return askResponse.finish(false);\n          };\n          onSuccess = function() {\n            return askResponse.finish();\n          };\n          return _this.attachmentsFullService.deleteAttachment(toDeleteAttachment, _this.type).then(onSuccess, onError);\n        };\n      })(this));\n    };\n\n    AttachmentsFullController.prototype.reorderAttachment = function(attachment, newIndex) {\n      return this.attachmentsFullService.reorderAttachment(this.type, attachment, newIndex);\n    };\n\n    AttachmentsFullController.prototype.updateAttachment = function(toUpdateAttachment) {\n      return this.attachmentsFullService.updateAttachment(toUpdateAttachment, this.type);\n    };\n\n    AttachmentsFullController.prototype._isEditable = function() {\n      if (this.projectService.project) {\n        return this.projectService.hasPermission(this.editPermission);\n      }\n      return false;\n    };\n\n    AttachmentsFullController.prototype.showAttachments = function() {\n      return this._isEditable() || this.attachmentsFullService.attachments.size;\n    };\n\n    return AttachmentsFullController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsFull\", AttachmentsFullController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-full.directive.coffee\n */\n\n(function() {\n  var AttachmentsFullDirective, bindOnce;\n\n  bindOnce = this.taiga.bindOnce;\n\n  AttachmentsFullDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return bindOnce(scope, 'vm.objId', function(value) {\n        return ctrl.loadAttachments();\n      });\n    };\n    return {\n      scope: {},\n      bindToController: {\n        type: \"@\",\n        objId: \"=\",\n        projectId: \"=\",\n        editPermission: \"@\"\n      },\n      controller: \"AttachmentsFull\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-full/attachments-full.html\",\n      link: link\n    };\n  };\n\n  AttachmentsFullDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsFull\", AttachmentsFullDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-full.service.coffee\n */\n\n(function() {\n  var AttachmentsFullService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  AttachmentsFullService = (function(superClass) {\n    extend(AttachmentsFullService, superClass);\n\n    AttachmentsFullService.$inject = [\"tgAttachmentsService\", \"$rootScope\"];\n\n    function AttachmentsFullService(attachmentsService, rootScope) {\n      this.attachmentsService = attachmentsService;\n      this.rootScope = rootScope;\n      this._attachments = Immutable.List();\n      this._deprecatedsCount = 0;\n      this._attachmentsVisible = Immutable.List();\n      this._deprecatedsVisible = false;\n      this.uploadingAttachments = [];\n      taiga.defineImmutableProperty(this, 'attachments', (function(_this) {\n        return function() {\n          return _this._attachments;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsCount', (function(_this) {\n        return function() {\n          return _this._deprecatedsCount;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'attachmentsVisible', (function(_this) {\n        return function() {\n          return _this._attachmentsVisible;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, 'deprecatedsVisible', (function(_this) {\n        return function() {\n          return _this._deprecatedsVisible;\n        };\n      })(this));\n    }\n\n    AttachmentsFullService.prototype.toggleDeprecatedsVisible = function() {\n      this._deprecatedsVisible = !this._deprecatedsVisible;\n      return this.regenerate();\n    };\n\n    AttachmentsFullService.prototype.regenerate = function() {\n      this._deprecatedsCount = this._attachments.count(function(it) {\n        return it.getIn(['file', 'is_deprecated']);\n      });\n      if (this._deprecatedsVisible) {\n        return this._attachmentsVisible = this._attachments;\n      } else {\n        return this._attachmentsVisible = this._attachments.filter(function(it) {\n          return !it.getIn(['file', 'is_deprecated']);\n        });\n      }\n    };\n\n    AttachmentsFullService.prototype.addAttachment = function(projectId, objId, type, file, editable) {\n      if (editable == null) {\n        editable = true;\n      }\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          var promise;\n          if (_this.attachmentsService.validate(file)) {\n            _this.uploadingAttachments.push(file);\n            promise = _this.attachmentsService.upload(file, objId, projectId, type);\n            return promise.then(function(file) {\n              var attachment;\n              _this.uploadingAttachments = _this.uploadingAttachments.filter(function(uploading) {\n                return uploading.name !== file.get('name');\n              });\n              attachment = Immutable.Map();\n              attachment = attachment.merge({\n                file: file,\n                editable: editable,\n                loading: false\n              });\n              _this._attachments = _this._attachments.push(attachment);\n              _this.regenerate();\n              _this.rootScope.$broadcast(\"attachment:create\");\n              return resolve(attachment);\n            });\n          } else {\n            return reject(file);\n          }\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.loadAttachments = function(type, objId, projectId) {\n      return this.attachmentsService.list(type, objId, projectId).then((function(_this) {\n        return function(files) {\n          _this._attachments = files.map(function(file) {\n            var attachment;\n            attachment = Immutable.Map();\n            return attachment.merge({\n              loading: false,\n              editable: false,\n              file: file\n            });\n          });\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.deleteAttachment = function(toDeleteAttachment, type) {\n      var onSuccess;\n      onSuccess = (function(_this) {\n        return function() {\n          _this._attachments = _this._attachments.filter(function(attachment) {\n            return attachment !== toDeleteAttachment;\n          });\n          return _this.regenerate();\n        };\n      })(this);\n      return this.attachmentsService[\"delete\"](type, toDeleteAttachment.getIn(['file', 'id'])).then(onSuccess);\n    };\n\n    AttachmentsFullService.prototype.reorderAttachment = function(type, attachment, newIndex) {\n      var attachments, oldIndex, promises;\n      oldIndex = this.attachments.findIndex(function(it) {\n        return it === attachment;\n      });\n      if (oldIndex === newIndex) {\n        return;\n      }\n      attachments = this.attachments.remove(oldIndex);\n      attachments = attachments.splice(newIndex, 0, attachment);\n      attachments = attachments.map(function(x, i) {\n        return x.setIn(['file', 'order'], i + 1);\n      });\n      promises = [];\n      attachments.forEach((function(_this) {\n        return function(attachment) {\n          var patch;\n          patch = {\n            order: attachment.getIn(['file', 'order'])\n          };\n          return promises.push(_this.attachmentsService.patch(attachment.getIn(['file', 'id']), type, patch));\n        };\n      })(this));\n      return Promise.all(promises).then((function(_this) {\n        return function() {\n          _this._attachments = attachments;\n          return _this.regenerate();\n        };\n      })(this));\n    };\n\n    AttachmentsFullService.prototype.updateAttachment = function(toUpdateAttachment, type) {\n      var index, oldAttachment, patch;\n      index = this._attachments.findIndex(function(attachment) {\n        return attachment.getIn(['file', 'id']) === toUpdateAttachment.getIn(['file', 'id']);\n      });\n      oldAttachment = this._attachments.get(index);\n      patch = taiga.patch(oldAttachment.get('file'), toUpdateAttachment.get('file'));\n      if (toUpdateAttachment.get('loading')) {\n        this._attachments = this._attachments.set(index, toUpdateAttachment);\n        return this.regenerate();\n      } else {\n        return this.attachmentsService.patch(toUpdateAttachment.getIn(['file', 'id']), type, patch).then((function(_this) {\n          return function() {\n            _this._attachments = _this._attachments.set(index, toUpdateAttachment);\n            return _this.regenerate();\n          };\n        })(this));\n      }\n    };\n\n    return AttachmentsFullService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgAttachmentsFullService\", AttachmentsFullService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.controller.coffee\n */\n\n(function() {\n  var AttachmentsSimpleController;\n\n  AttachmentsSimpleController = (function() {\n    AttachmentsSimpleController.$inject = [\"tgAttachmentsService\"];\n\n    function AttachmentsSimpleController(attachmentsService) {\n      this.attachmentsService = attachmentsService;\n    }\n\n    AttachmentsSimpleController.prototype.addAttachment = function(file) {\n      var attachment;\n      attachment = Immutable.fromJS({\n        file: file,\n        name: file.name,\n        size: file.size\n      });\n      if (this.attachmentsService.validate(file)) {\n        this.attachments = this.attachments.push(attachment);\n        if (this.onAdd) {\n          return this.onAdd({\n            attachment: attachment\n          });\n        }\n      }\n    };\n\n    AttachmentsSimpleController.prototype.addAttachments = function(files) {\n      return _.forEach(files, this.addAttachment.bind(this));\n    };\n\n    AttachmentsSimpleController.prototype.deleteAttachment = function(toDeleteAttachment) {\n      this.attachments = this.attachments.filter(function(attachment) {\n        return attachment !== toDeleteAttachment;\n      });\n      if (this.onDelete) {\n        return this.onDelete({\n          attachment: toDeleteAttachment\n        });\n      }\n    };\n\n    return AttachmentsSimpleController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"AttachmentsSimple\", AttachmentsSimpleController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attchments-simple.directive.coffee\n */\n\n(function() {\n  var AttachmentsSimpleDirective;\n\n  AttachmentsSimpleDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      scope: {},\n      bindToController: {\n        attachments: \"=\",\n        onAdd: \"&\",\n        onDelete: \"&\"\n      },\n      controller: \"AttachmentsSimple\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/attachments-simple/attachments-simple.html\",\n      link: link\n    };\n  };\n\n  AttachmentsSimpleDirective.$inject = [];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSimple\", AttachmentsSimpleDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-sortable.directive.coffee\n */\n\n(function() {\n  var AttachmentSortableDirective;\n\n  AttachmentSortableDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs) {\n      var callback, drake, scroll;\n      callback = $parse(attrs.tgAttachmentsSortable);\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).is('div[tg-bind-scope]');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var attachment, newIndex;\n        item = $(item);\n        attachment = item.scope().attachment;\n        newIndex = item.index();\n        return scope.$apply(function() {\n          return callback(scope, {\n            attachment: attachment,\n            index: newIndex\n          });\n        });\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    return {\n      link: link\n    };\n  };\n\n  AttachmentSortableDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgAttachmentsSortable\", AttachmentSortableDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: auto-select.directive.coffee\n */\n\n(function() {\n  var AutoSelectDirective;\n\n  AutoSelectDirective = function($timeout) {\n    return {\n      link: function(scope, elm) {\n        return $timeout(function() {\n          return elm[0].select();\n        });\n      }\n    };\n  };\n\n  AutoSelectDirective.$inject = ['$timeout'];\n\n  angular.module(\"taigaComponents\").directive(\"tgAutoSelect\", AutoSelectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: file-change.directive.coffee\n */\n\n(function() {\n  var FileChangeDirective;\n\n  FileChangeDirective = function($parse) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var eventAttr;\n      eventAttr = $parse(attrs.tgFileChange);\n      el.on('change', function(event) {\n        return scope.$apply(function() {\n          return eventAttr(scope, {\n            files: event.currentTarget.files\n          });\n        });\n      });\n      return scope.$on(\"$destroy\", function() {\n        return el.off();\n      });\n    };\n    return {\n      require: \"ngModel\",\n      restrict: \"A\",\n      link: link\n    };\n  };\n\n  FileChangeDirective.$inject = [\"$parse\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgFileChange\", FileChangeDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.directive.coffee\n */\n\n(function() {\n  var JoyRideDirective, taiga;\n\n  taiga = this.taiga;\n\n  JoyRideDirective = function($rootScope, currentUserService, joyRideService, $location, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var initJoyrRide, intro, unsuscribe;\n      unsuscribe = null;\n      intro = introJs();\n      intro.oncomplete(function() {\n        return $('html,body').scrollTop(0);\n      });\n      intro.onexit(function() {\n        return currentUserService.disableJoyRide();\n      });\n      initJoyrRide = function(next, config) {\n        if (!config[next.joyride]) {\n          return;\n        }\n        intro.setOptions({\n          exitOnEsc: false,\n          exitOnOverlayClick: false,\n          showStepNumbers: false,\n          nextLabel: $translate.instant('JOYRIDE.NAV.NEXT') + ' &rarr;',\n          prevLabel: '&larr; ' + $translate.instant('JOYRIDE.NAV.BACK'),\n          skipLabel: $translate.instant('JOYRIDE.NAV.SKIP'),\n          doneLabel: $translate.instant('JOYRIDE.NAV.DONE'),\n          disableInteraction: true\n        });\n        intro.setOption('steps', joyRideService.get(next.joyride));\n        return intro.start();\n      };\n      return $rootScope.$on('$routeChangeSuccess', function(event, next) {\n        if (!next.joyride || !currentUserService.isAuthenticated()) {\n          intro.exit();\n          if (unsuscribe) {\n            unsuscribe();\n          }\n          return;\n        }\n        intro.oncomplete(function() {\n          return currentUserService.disableJoyRide(next.joyride);\n        });\n        if (next.loader) {\n          return unsuscribe = $rootScope.$on('loader:end', function() {\n            currentUserService.loadJoyRideConfig().then(function(config) {\n              return initJoyrRide(next, config);\n            });\n            return unsuscribe();\n          });\n        } else {\n          return currentUserService.loadJoyRideConfig().then(function(config) {\n            return initJoyrRide(next, config);\n          });\n        }\n      });\n    };\n    return {\n      scope: {},\n      link: link\n    };\n  };\n\n  JoyRideDirective.$inject = [\"$rootScope\", \"tgCurrentUserService\", \"tgJoyRideService\", \"$location\", \"$translate\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgJoyRide\", JoyRideDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: joy-ride.service.coffee\n */\n\n(function() {\n  var JoyRideService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  JoyRideService = (function(superClass) {\n    extend(JoyRideService, superClass);\n\n    JoyRideService.$inject = ['$translate', 'tgCheckPermissionsService'];\n\n    function JoyRideService(translate, checkPermissionsService) {\n      this.translate = translate;\n      this.checkPermissionsService = checkPermissionsService;\n    }\n\n    JoyRideService.prototype.getConfig = function() {\n      return {\n        dashboard: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.project-list > section:not(.ng-hide)',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP1.TEXT')\n                }\n              }, {\n                element: '.working-on-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.DASHBOARD.STEP2.TEXT')\n                }\n              }, {\n                element: '.watching-container',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP3.TEXT2')]\n                }\n              }\n            ];\n            if (!$('.project-list .create-project-button').is(':hidden')) {\n              steps.push({\n                element: '.project-list .create-project-button',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT1'), _this.translate.instant('JOYRIDE.DASHBOARD.STEP4.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        backlog: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.summary',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT1'), _this.translate.instant('JOYRIDE.BACKLOG.STEP1.TEXT2')]\n                }\n              }, {\n                element: '.backlog-table-empty',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP2.TEXT')\n                }\n              }, {\n                element: '.sprints',\n                position: 'left',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP3.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.new-us',\n                position: 'rigth',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.BACKLOG.STEP4.TEXT')\n                }\n              });\n            }\n            return steps;\n          };\n        })(this),\n        kanban: (function(_this) {\n          return function() {\n            var steps;\n            steps = [\n              {\n                element: '.kanban-table-inner',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP1.TEXT')\n                }\n              }, {\n                element: '.card-placeholder',\n                position: 'right',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TITLE'),\n                  text: _this.translate.instant('JOYRIDE.KANBAN.STEP2.TEXT')\n                }\n              }\n            ];\n            if (_this.checkPermissionsService.check('add_us')) {\n              steps.push({\n                element: '.icon-plus',\n                position: 'bottom',\n                joyride: {\n                  title: _this.translate.instant('JOYRIDE.KANBAN.STEP3.TITLE'),\n                  text: [_this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT1'), _this.translate.instant('JOYRIDE.KANBAN.STEP3.TEXT2')]\n                }\n              });\n            }\n            return steps;\n          };\n        })(this)\n      };\n    };\n\n    JoyRideService.prototype.get = function(name) {\n      var joyRide, joyRides;\n      joyRides = this.getConfig();\n      joyRide = joyRides[name].call(this);\n      return _.map(joyRide, function(item) {\n        var html;\n        html = \"\";\n        if (item.joyride.title) {\n          html += \"<h3>\" + item.joyride.title + \"</h3>\";\n        }\n        if (_.isArray(item.joyride.text)) {\n          _.forEach(item.joyride.text, function(text) {\n            return html += \"<p>\" + text + \"</p>\";\n          });\n        } else {\n          html += \"<p>\" + item.joyride.text + \"</p>\";\n        }\n        item.intro = html;\n        return item;\n      });\n    };\n\n    return JoyRideService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgJoyRideService\", JoyRideService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2015 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2015 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: live-announcement.directive.coffee\n */\n\n(function() {\n  var LiveAnnouncementDirective;\n\n  LiveAnnouncementDirective = function(liveAnnouncementService) {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      restrict: \"AE\",\n      scope: {},\n      controllerAs: 'vm',\n      controller: function() {\n        this.close = function() {\n          return liveAnnouncementService.open = false;\n        };\n        return Object.defineProperties(this, {\n          open: {\n            get: function() {\n              return liveAnnouncementService.open;\n            }\n          },\n          title: {\n            get: function() {\n              return liveAnnouncementService.title;\n            }\n          },\n          desc: {\n            get: function() {\n              return liveAnnouncementService.desc;\n            }\n          }\n        });\n      },\n      link: link,\n      templateUrl: \"components/live-announcement/live-announcement.html\"\n    };\n  };\n\n  LiveAnnouncementDirective.$inject = [\"tgLiveAnnouncementService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgLiveAnnouncement\", LiveAnnouncementDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: notification.service.coffee\n */\n\n(function() {\n  var LiveAnnouncementService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  LiveAnnouncementService = (function(superClass) {\n    extend(LiveAnnouncementService, superClass);\n\n    function LiveAnnouncementService() {\n      this.open = false;\n      this.title = \"\";\n      this.desc = \"\";\n    }\n\n    LiveAnnouncementService.prototype.show = function(title, desc) {\n      this.open = true;\n      this.title = title;\n      return this.desc = desc;\n    };\n\n    return LiveAnnouncementService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaComponents\").service(\"tgLiveAnnouncementService\", LiveAnnouncementService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-big-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoBigSrcDirective;\n\n  ProjectLogoBigSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_big_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoBigSrc\"\n      }\n    };\n  };\n\n  ProjectLogoBigSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoBigSrc\", ProjectLogoBigSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo-small-src.directive.coffee\n */\n\n(function() {\n  var ProjectLogoSmallSrcDirective;\n\n  ProjectLogoSmallSrcDirective = function(projectLogoService) {\n    var link;\n    link = function(scope, el, attrs) {\n      return scope.$watch('project', function(project) {\n        var logo, projectLogo;\n        project = Immutable.fromJS(project);\n        if (!project) {\n          return;\n        }\n        projectLogo = project.get('logo_small_url');\n        if (projectLogo) {\n          el.attr('src', projectLogo);\n          return el.css('background', \"\");\n        } else {\n          logo = projectLogoService.getDefaultProjectLogo(project.get('slug'), project.get('id'));\n          el.attr('src', logo.src);\n          return el.css('background', logo.color);\n        }\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        project: \"=tgProjectLogoSmallSrc\"\n      }\n    };\n  };\n\n  ProjectLogoSmallSrcDirective.$inject = [\"tgProjectLogoService\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectLogoSmallSrc\", ProjectLogoSmallSrcDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.controller.coffee\n */\n\n(function() {\n  var ProjectMenuController;\n\n  ProjectMenuController = (function() {\n    ProjectMenuController.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n    function ProjectMenuController(projectService, lightboxFactory) {\n      this.projectService = projectService;\n      this.lightboxFactory = lightboxFactory;\n      this.project = null;\n      this.menu = Immutable.Map();\n    }\n\n    ProjectMenuController.prototype.show = function() {\n      this.project = this.projectService.project;\n      this.active = this._getActiveSection();\n      this._setVideoConference();\n      return this._setMenuPermissions();\n    };\n\n    ProjectMenuController.prototype.hide = function() {\n      this.project = null;\n      return this.menu = {};\n    };\n\n    ProjectMenuController.prototype.search = function() {\n      return this.lightboxFactory.create(\"tg-search-box\", {\n        \"class\": \"lightbox lightbox-search\"\n      });\n    };\n\n    ProjectMenuController.prototype._setVideoConference = function() {\n      var videoconferenceUrl;\n      videoconferenceUrl = this._videoConferenceUrl();\n      if (videoconferenceUrl) {\n        return this.project = this.project.set(\"videoconferenceUrl\", videoconferenceUrl);\n      }\n    };\n\n    ProjectMenuController.prototype._setMenuPermissions = function() {\n      this.menu = Immutable.Map({\n        backlog: false,\n        kanban: false,\n        issues: false,\n        wiki: false\n      });\n      if (this.project.get(\"is_backlog_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"backlog\", true);\n      }\n      if (this.project.get(\"is_kanban_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_us\") !== -1) {\n        this.menu = this.menu.set(\"kanban\", true);\n      }\n      if (this.project.get(\"is_issues_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_issues\") !== -1) {\n        this.menu = this.menu.set(\"issues\", true);\n      }\n      if (this.project.get(\"is_wiki_activated\") && this.project.get(\"my_permissions\").indexOf(\"view_wiki_pages\") !== -1) {\n        return this.menu = this.menu.set(\"wiki\", true);\n      }\n    };\n\n    ProjectMenuController.prototype._getActiveSection = function() {\n      var indexBacklog, indexKanban, oldSectionName, sectionName, sectionsBreadcrumb;\n      sectionName = this.projectService.section;\n      sectionsBreadcrumb = this.projectService.sectionsBreadcrumb;\n      indexBacklog = sectionsBreadcrumb.lastIndexOf(\"backlog\");\n      indexKanban = sectionsBreadcrumb.lastIndexOf(\"kanban\");\n      if (indexBacklog !== -1 || indexKanban !== -1) {\n        if (indexKanban === -1 || indexBacklog > indexKanban) {\n          oldSectionName = \"backlog\";\n        } else {\n          oldSectionName = \"kanban\";\n        }\n      }\n      if (sectionName === \"backlog-kanban\") {\n        if (oldSectionName === \"backlog\" || oldSectionName === \"kanban\") {\n          sectionName = oldSectionName;\n        } else if (this.project.get(\"is_backlog_activated\") && !this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"backlog\";\n        } else if (!this.project.get(\"is_backlog_activated\") && this.project.get(\"is_kanban_activated\")) {\n          sectionName = \"kanban\";\n        }\n      }\n      return sectionName;\n    };\n\n    ProjectMenuController.prototype._videoConferenceUrl = function() {\n      var baseUrl, url;\n      if (this.project.get(\"videoconferences\") === \"appear-in\") {\n        baseUrl = \"https://appear.in/\";\n      } else if (this.project.get(\"videoconferences\") === \"talky\") {\n        baseUrl = \"https://talky.io/\";\n      } else if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        baseUrl = \"https://meet.jit.si/\";\n      } else if (this.project.get(\"videoconferences\") === \"custom\") {\n        return this.project.get(\"videoconferences_extra_data\");\n      } else {\n        return \"\";\n      }\n      if (this.project.get(\"videoconferences_extra_data\")) {\n        url = this.project.get(\"slug\") + \"-\" + taiga.slugify(this.project.get(\"videoconferences_extra_data\"));\n      } else {\n        url = this.project.get(\"slug\");\n      }\n      if (this.project.get(\"videoconferences\") === \"jitsi\") {\n        url = url.replace(/-/g, \"\");\n      }\n      return baseUrl + url;\n    };\n\n    return ProjectMenuController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"ProjectMenu\", ProjectMenuController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-menu.directive.coffee\n */\n\n(function() {\n  var ProjectMenuDirective, taiga;\n\n  taiga = this.taiga;\n\n  ProjectMenuDirective = function(projectService, lightboxFactory) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var projectChange;\n      projectChange = function() {\n        if (projectService.project) {\n          return ctrl.show();\n        } else {\n          return ctrl.hide();\n        }\n      };\n      scope.$watch((function() {\n        return projectService.project;\n      }), projectChange);\n      scope.vm.fixed = false;\n      return $(window).on(\"scroll\", function() {\n        var position;\n        position = $(window).scrollTop();\n        if (position > 100 && scope.vm.fixed === false) {\n          scope.vm.fixed = true;\n          return scope.$digest();\n        } else if (position < 100 && scope.vm.fixed === true) {\n          scope.vm.fixed = false;\n          return scope.$digest();\n        }\n      });\n    };\n    return {\n      scope: {},\n      controller: \"ProjectMenu\",\n      controllerAs: \"vm\",\n      templateUrl: \"components/project-menu/project-menu.html\",\n      link: link\n    };\n  };\n\n  ProjectMenuDirective.$inject = [\"tgProjectService\", \"tgLightboxFactory\"];\n\n  angular.module(\"taigaComponents\").directive(\"tgProjectMenu\", ProjectMenuDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.directive.coffee\n */\n\n(function() {\n  var TermsOfServiceAndPrivacyPolicyNoticeDirective;\n\n  TermsOfServiceAndPrivacyPolicyNoticeDirective = function($config) {\n    var link;\n    link = function(scope, el, attrs) {\n      scope.privacyPolicyUrl = $config.get(\"privacyPolicyUrl\");\n      return scope.termsOfServiceUrl = $config.get(\"termsOfServiceUrl\");\n    };\n    return {\n      restrict: \"AE\",\n      scope: {},\n      link: link,\n      templateUrl: \"components/terms-of-service-and-privacy-policy-notice/terms-of-service-and-privacy-policy-notice.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgTermsOfServiceAndPrivacyPolicyNotice\", [\"$tgConfig\", TermsOfServiceAndPrivacyPolicyNoticeDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.controller.coffee\n */\n\n(function() {\n  var VoteButtonController;\n\n  VoteButtonController = (function() {\n    VoteButtonController.$inject = [\"tgCurrentUserService\"];\n\n    function VoteButtonController(currentUserService) {\n      this.currentUserService = currentUserService;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    VoteButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    VoteButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    VoteButtonController.prototype.toggleVote = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_voter) {\n        promise = this._upvote();\n      } else {\n        promise = this._downvote();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    VoteButtonController.prototype._upvote = function() {\n      return this.onUpvote().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    VoteButtonController.prototype._downvote = function() {\n      return this.onDownvote();\n    };\n\n    return VoteButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"VoteButton\", VoteButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: vote-button.directive.coffee\n */\n\n(function() {\n  var VoteButtonDirective;\n\n  VoteButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"VoteButton\",\n      bindToController: {\n        item: \"=\",\n        onUpvote: \"=\",\n        onDownvote: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"components/vote-button/vote-button.html\"\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgVoteButton\", VoteButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.controller.coffee\n */\n\n(function() {\n  var WatchButtonController;\n\n  WatchButtonController = (function() {\n    WatchButtonController.$inject = [\"tgCurrentUserService\", \"$rootScope\"];\n\n    function WatchButtonController(currentUserService, rootScope) {\n      this.currentUserService = currentUserService;\n      this.rootScope = rootScope;\n      this.user = this.currentUserService.getUser();\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    WatchButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    WatchButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    WatchButtonController.prototype.openWatchers = function() {\n      return this.rootScope.$broadcast(\"watcher:add\", this.item);\n    };\n\n    WatchButtonController.prototype.getPerms = function() {\n      var name, perms;\n      if (!this.item) {\n        return \"\";\n      }\n      name = this.item._name;\n      perms = {\n        userstories: 'modify_us',\n        issues: 'modify_issue',\n        tasks: 'modify_task'\n      };\n      return perms[name];\n    };\n\n    WatchButtonController.prototype.toggleWatch = function() {\n      var promise;\n      this.loading = true;\n      if (!this.item.is_watcher) {\n        promise = this._watch();\n      } else {\n        promise = this._unwatch();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    WatchButtonController.prototype._watch = function() {\n      return this.onWatch().then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this));\n    };\n\n    WatchButtonController.prototype._unwatch = function() {\n      return this.onUnwatch();\n    };\n\n    return WatchButtonController;\n\n  })();\n\n  angular.module(\"taigaComponents\").controller(\"WatchButton\", WatchButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-button.directive.coffee\n */\n\n(function() {\n  var WatchButtonDirective;\n\n  WatchButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchButton\",\n      bindToController: {\n        item: \"=\",\n        onWatch: \"=\",\n        onUnwatch: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: function(item, attributes) {\n        return \"components/watch-button/watch-button-\" + attributes.environment + \".html\";\n      }\n    };\n  };\n\n  angular.module(\"taigaComponents\").directive(\"tgWatchButton\", WatchButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByController;\n\n  DiscoverHomeOrderByController = (function() {\n    DiscoverHomeOrderByController.$inject = ['$translate'];\n\n    function DiscoverHomeOrderByController(translate) {\n      this.translate = translate;\n      this.is_open = false;\n      this.texts = {\n        week: this.translate.instant('DISCOVER.FILTERS.WEEK'),\n        month: this.translate.instant('DISCOVER.FILTERS.MONTH'),\n        year: this.translate.instant('DISCOVER.FILTERS.YEAR'),\n        all: this.translate.instant('DISCOVER.FILTERS.ALL_TIME')\n      };\n    }\n\n    DiscoverHomeOrderByController.prototype.currentText = function() {\n      return this.texts[this.currentOrderBy];\n    };\n\n    DiscoverHomeOrderByController.prototype.open = function() {\n      return this.is_open = true;\n    };\n\n    DiscoverHomeOrderByController.prototype.close = function() {\n      return this.is_open = false;\n    };\n\n    DiscoverHomeOrderByController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      this.is_open = false;\n      return this.onChange({\n        orderBy: this.currentOrderBy\n      });\n    };\n\n    return DiscoverHomeOrderByController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHomeOrderBy\", DiscoverHomeOrderByController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home-order-by.directive.coffee\n */\n\n(function() {\n  var DiscoverHomeOrderByDirective;\n\n  DiscoverHomeOrderByDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverHomeOrderBy\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-home-order-by/discover-home-order-by.html\",\n      scope: {\n        currentOrderBy: \"=orderBy\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverHomeOrderByDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverHomeOrderBy\", DiscoverHomeOrderByDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-bar.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchBarController;\n\n  DiscoverSearchBarController = (function() {\n    DiscoverSearchBarController.$inject = ['tgDiscoverProjectsService'];\n\n    function DiscoverSearchBarController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, 'projects', (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.projectsCount;\n        };\n      })(this));\n      this.discoverProjectsService.fetchStats();\n    }\n\n    DiscoverSearchBarController.prototype.selectFilter = function(filter) {\n      return this.onChange({\n        filter: filter,\n        q: this.q\n      });\n    };\n\n    DiscoverSearchBarController.prototype.submitFilter = function() {\n      return this.onChange({\n        filter: this.filter,\n        q: this.q\n      });\n    };\n\n    return DiscoverSearchBarController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchBar\", DiscoverSearchBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchBarDirective;\n\n  DiscoverSearchBarDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {};\n    return {\n      controller: \"DiscoverSearchBar\",\n      controllerAs: \"vm\",\n      templateUrl: 'discover/components/discover-search-bar/discover-search-bar.html',\n      bindToController: true,\n      scope: {\n        q: \"=\",\n        filter: \"=\",\n        onChange: \"&\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchBarDirective.$inject = [];\n\n  angular.module('taigaDiscover').directive('tgDiscoverSearchBar', DiscoverSearchBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderController;\n\n  DiscoverSearchListHeaderController = (function() {\n    DiscoverSearchListHeaderController.$inject = [];\n\n    function DiscoverSearchListHeaderController() {\n      this.like_is_open = this.orderBy.indexOf('-total_fans') === 0;\n      this.activity_is_open = this.orderBy.indexOf('-total_activity') === 0;\n    }\n\n    DiscoverSearchListHeaderController.prototype.openLike = function() {\n      this.like_is_open = true;\n      this.activity_is_open = false;\n      return this.setOrderBy('-total_fans_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.openActivity = function() {\n      this.activity_is_open = true;\n      this.like_is_open = false;\n      return this.setOrderBy('-total_activity_last_week');\n    };\n\n    DiscoverSearchListHeaderController.prototype.setOrderBy = function(type) {\n      if (type == null) {\n        type = '';\n      }\n      if (!type) {\n        this.like_is_open = false;\n        this.activity_is_open = false;\n      }\n      return this.onChange({\n        orderBy: type\n      });\n    };\n\n    return DiscoverSearchListHeaderController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearchListHeader\", DiscoverSearchListHeaderController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search-list-header.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchListHeaderDirective;\n\n  DiscoverSearchListHeaderDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"DiscoverSearchListHeader\",\n      controllerAs: \"vm\",\n      bindToController: true,\n      templateUrl: \"discover/components/discover-search-list-header/discover-search-list-header.html\",\n      scope: {\n        onChange: \"&\",\n        orderBy: \"=\"\n      },\n      link: link\n    };\n  };\n\n  DiscoverSearchListHeaderDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearchListHeader\", DiscoverSearchListHeaderDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.controller.coffee\n */\n\n(function() {\n  var FeaturedProjectsController;\n\n  FeaturedProjectsController = (function() {\n    FeaturedProjectsController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function FeaturedProjectsController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.featured;\n        };\n      })(this));\n      this.discoverProjectsService.fetchFeatured();\n    }\n\n    return FeaturedProjectsController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"FeaturedProjects\", FeaturedProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: featured-projects.directive.coffee\n */\n\n(function() {\n  var FeaturedProjectsDirective;\n\n  FeaturedProjectsDirective = function() {\n    var link;\n    link = function(scope, el, attrs) {};\n    return {\n      controller: \"FeaturedProjects\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/featured-projects/featured-projects.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  FeaturedProjectsDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgFeaturedProjects\", FeaturedProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: highlighted.directive.coffee\n */\n\n(function() {\n  var HighlightedDirective;\n\n  HighlightedDirective = function() {\n    return {\n      templateUrl: \"discover/components/highlighted/highlighted.html\",\n      scope: {\n        loading: \"=\",\n        highlighted: \"=\",\n        orderBy: \"=\"\n      }\n    };\n  };\n\n  HighlightedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgHighlighted\", HighlightedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.controller.coffee\n */\n\n(function() {\n  var MostActiveController;\n\n  MostActiveController = (function() {\n    MostActiveController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostActiveController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostActive;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostActiveController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostActive({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostActiveController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostActiveController.prototype.getOrderBy = function(type) {\n      if (this.currentOrderBy === 'all') {\n        return '-total_activity';\n      } else {\n        return '-total_activity_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostActiveController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostActive\", MostActiveController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-active.directive.coffee\n */\n\n(function() {\n  var MostActiveDirective;\n\n  MostActiveDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostActive\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-active/most-active.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostActiveDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostActive\", MostActiveDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: msot-liked.controller.coffee\n */\n\n(function() {\n  var MostLikedController;\n\n  MostLikedController = (function() {\n    MostLikedController.$inject = [\"tgDiscoverProjectsService\"];\n\n    function MostLikedController(discoverProjectsService) {\n      this.discoverProjectsService = discoverProjectsService;\n      taiga.defineImmutableProperty(this, \"highlighted\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.mostLiked;\n        };\n      })(this));\n      this.currentOrderBy = 'week';\n      this.order_by = this.getOrderBy();\n    }\n\n    MostLikedController.prototype.fetch = function() {\n      this.loading = true;\n      this.order_by = this.getOrderBy();\n      return this.discoverProjectsService.fetchMostLiked({\n        order_by: this.order_by\n      }).then((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    MostLikedController.prototype.orderBy = function(type) {\n      this.currentOrderBy = type;\n      return this.fetch();\n    };\n\n    MostLikedController.prototype.getOrderBy = function() {\n      if (this.currentOrderBy === 'all') {\n        return '-total_fans';\n      } else {\n        return '-total_fans_last_' + this.currentOrderBy;\n      }\n    };\n\n    return MostLikedController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"MostLiked\", MostLikedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: most-liked.directive.coffee\n */\n\n(function() {\n  var MostLikedDirective;\n\n  MostLikedDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"MostLiked\",\n      controllerAs: \"vm\",\n      templateUrl: \"discover/components/most-liked/most-liked.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  MostLikedDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgMostLiked\", MostLikedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-home.controller.coffee\n */\n\n(function() {\n  var DiscoverHomeController;\n\n  DiscoverHomeController = (function() {\n    DiscoverHomeController.$inject = ['$tgLocation', '$tgNavUrls', 'tgAppMetaService', '$translate'];\n\n    function DiscoverHomeController(location, navUrls, appMetaService, translate) {\n      var description, title;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      title = this.translate.instant(\"DISCOVER.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverHomeController.prototype.onSubmit = function(q) {\n      var url;\n      url = this.navUrls.resolve('discover-search');\n      return this.location.search('text', q).path(url);\n    };\n\n    return DiscoverHomeController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverHome\", DiscoverHomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.controller.coffee\n */\n\n(function() {\n  var DiscoverSearchController;\n\n  DiscoverSearchController = (function() {\n    DiscoverSearchController.$inject = ['$routeParams', 'tgDiscoverProjectsService', '$route', 'tgAppMetaService', '$translate'];\n\n    function DiscoverSearchController(routeParams, discoverProjectsService, route, appMetaService, translate) {\n      var description, title;\n      this.routeParams = routeParams;\n      this.discoverProjectsService = discoverProjectsService;\n      this.route = route;\n      this.appMetaService = appMetaService;\n      this.translate = translate;\n      this.page = 1;\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this.discoverProjectsService.nextSearchPage;\n        };\n      })(this));\n      this.q = this.routeParams.text;\n      this.filter = this.routeParams.filter || 'all';\n      this.orderBy = this.routeParams['order_by'] || '';\n      this.loadingGlobal = false;\n      this.loadingList = false;\n      this.loadingPagination = false;\n      title = this.translate.instant(\"DISCOVER.SEARCH.PAGE_TITLE\");\n      description = this.translate.instant(\"DISCOVER.SEARCH.PAGE_DESCRIPTION\");\n      this.appMetaService.setAll(title, description);\n    }\n\n    DiscoverSearchController.prototype.fetch = function() {\n      this.page = 1;\n      this.discoverProjectsService.resetSearchList();\n      return this.search();\n    };\n\n    DiscoverSearchController.prototype.fetchByGlobalSearch = function() {\n      if (this.loadingGlobal) {\n        return;\n      }\n      this.loadingGlobal = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingGlobal = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.fetchByOrderBy = function() {\n      if (this.loadingList) {\n        return;\n      }\n      this.loadingList = true;\n      return this.fetch().then((function(_this) {\n        return function() {\n          return _this.loadingList = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.showMore = function() {\n      if (this.loadingPagination) {\n        return;\n      }\n      this.loadingPagination = true;\n      this.page++;\n      return this.search().then((function(_this) {\n        return function() {\n          return _this.loadingPagination = false;\n        };\n      })(this));\n    };\n\n    DiscoverSearchController.prototype.search = function() {\n      var filter, params;\n      filter = this.getFilter();\n      params = {\n        page: this.page,\n        q: this.q,\n        order_by: this.orderBy\n      };\n      _.assign(params, filter);\n      return this.discoverProjectsService.fetchSearch(params);\n    };\n\n    DiscoverSearchController.prototype.getFilter = function() {\n      if (this.filter === 'people') {\n        return {\n          is_looking_for_people: true\n        };\n      } else if (this.filter === 'scrum') {\n        return {\n          is_backlog_activated: true\n        };\n      } else if (this.filter === 'kanban') {\n        return {\n          is_kanban_activated: true\n        };\n      }\n      return {};\n    };\n\n    DiscoverSearchController.prototype.onChangeFilter = function(filter, q) {\n      this.filter = filter;\n      this.q = q;\n      this.route.updateParams({\n        filter: this.filter,\n        text: this.q\n      });\n      return this.fetchByGlobalSearch();\n    };\n\n    DiscoverSearchController.prototype.onChangeOrder = function(orderBy) {\n      this.orderBy = orderBy;\n      this.route.updateParams({\n        order_by: orderBy\n      });\n      return this.fetchByOrderBy();\n    };\n\n    return DiscoverSearchController;\n\n  })();\n\n  angular.module(\"taigaDiscover\").controller(\"DiscoverSearch\", DiscoverSearchController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-search.directive.coffee\n */\n\n(function() {\n  var DiscoverSearchDirective;\n\n  DiscoverSearchDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl) {\n      return ctrl.fetch();\n    };\n    return {\n      controller: \"DiscoverSearch\",\n      controllerAs: \"vm\",\n      link: link\n    };\n  };\n\n  DiscoverSearchDirective.$inject = [];\n\n  angular.module(\"taigaDiscover\").directive(\"tgDiscoverSearch\", DiscoverSearchDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: discover-projects.service.coffee\n */\n\n(function() {\n  var DiscoverProjectsService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  DiscoverProjectsService = (function(superClass) {\n    var _discoverParams;\n\n    extend(DiscoverProjectsService, superClass);\n\n    DiscoverProjectsService.$inject = [\"tgResources\", \"tgProjectsService\"];\n\n    _discoverParams = {\n      discover_mode: true\n    };\n\n    function DiscoverProjectsService(rs, projectsService) {\n      this.rs = rs;\n      this.projectsService = projectsService;\n      this._mostLiked = Immutable.List();\n      this._mostActive = Immutable.List();\n      this._featured = Immutable.List();\n      this._searchResult = Immutable.List();\n      this._projectsCount = 0;\n      this.decorate = this.projectsService._decorate.bind(this.projectsService);\n      taiga.defineImmutableProperty(this, \"mostLiked\", (function(_this) {\n        return function() {\n          return _this._mostLiked;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"mostActive\", (function(_this) {\n        return function() {\n          return _this._mostActive;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"featured\", (function(_this) {\n        return function() {\n          return _this._featured;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"searchResult\", (function(_this) {\n        return function() {\n          return _this._searchResult;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"nextSearchPage\", (function(_this) {\n        return function() {\n          return _this._nextSearchPage;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsCount\", (function(_this) {\n        return function() {\n          return _this._projectsCount;\n        };\n      })(this));\n    }\n\n    DiscoverProjectsService.prototype.fetchMostLiked = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostLiked = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchMostActive = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 5);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._mostActive = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchFeatured = function() {\n      var _params;\n      _params = _.extend({}, _discoverParams);\n      _params.is_featured = true;\n      return this.rs.projects.getProjects(_params, false).then((function(_this) {\n        return function(result) {\n          var data, projects;\n          data = result.data.slice(0, 4);\n          projects = Immutable.fromJS(data);\n          projects = projects.map(_this.decorate);\n          return _this._featured = projects;\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.resetSearchList = function() {\n      return this._searchResult = Immutable.List();\n    };\n\n    DiscoverProjectsService.prototype.fetchStats = function() {\n      return this.rs.stats.discover().then((function(_this) {\n        return function(discover) {\n          return _this._projectsCount = discover.getIn(['projects', 'total']);\n        };\n      })(this));\n    };\n\n    DiscoverProjectsService.prototype.fetchSearch = function(params) {\n      var _params;\n      _params = _.extend({}, _discoverParams, params);\n      return this.rs.projects.getProjects(_params).then((function(_this) {\n        return function(result) {\n          var projects;\n          _this._nextSearchPage = !!result.headers('X-Pagination-Next');\n          projects = Immutable.fromJS(result.data);\n          projects = projects.map(_this.decorate);\n          return _this._searchResult = _this._searchResult.concat(projects);\n        };\n      })(this));\n    };\n\n    return DiscoverProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaDiscover\").service(\"tgDiscoverProjectsService\", DiscoverProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.controller.coffee\n */\n\n(function() {\n  var ExternalAppController, taiga,\n    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ExternalAppController = (function(superClass) {\n    extend(ExternalAppController, superClass);\n\n    ExternalAppController.$inject = [\"$routeParams\", \"tgExternalAppsService\", \"$window\", \"tgCurrentUserService\", \"$location\", \"$tgNavUrls\", \"tgXhrErrorService\", \"tgLoader\"];\n\n    function ExternalAppController(routeParams, externalAppsService, window, currentUserService, location, navUrls, xhrError, loader) {\n      var loginUrl, nextUrl;\n      this.routeParams = routeParams;\n      this.externalAppsService = externalAppsService;\n      this.window = window;\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      this.xhrError = xhrError;\n      this.loader = loader;\n      this.createApplicationToken = bind(this.createApplicationToken, this);\n      this._getApplicationToken = bind(this._getApplicationToken, this);\n      this._redirect = bind(this._redirect, this);\n      this.loader.start(false);\n      this._applicationId = this.routeParams.application;\n      this._state = this.routeParams.state;\n      this._getApplicationToken();\n      this._user = this.currentUserService.getUser();\n      this._application = null;\n      nextUrl = encodeURIComponent(this.location.url());\n      loginUrl = this.navUrls.resolve(\"login\");\n      this.loginWithAnotherUserUrl = loginUrl + \"?next=\" + nextUrl;\n      taiga.defineImmutableProperty(this, \"user\", (function(_this) {\n        return function() {\n          return _this._user;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"application\", (function(_this) {\n        return function() {\n          return _this._application;\n        };\n      })(this));\n    }\n\n    ExternalAppController.prototype._redirect = function(applicationToken) {\n      var nextUrl;\n      nextUrl = applicationToken.get(\"next_url\");\n      return this.window.open(nextUrl, \"_self\");\n    };\n\n    ExternalAppController.prototype._getApplicationToken = function() {\n      return this.externalAppsService.getApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          _this._application = data.get(\"application\");\n          if (data.get(\"auth_code\")) {\n            return _this._redirect(data);\n          } else {\n            return _this.loader.pageLoaded();\n          }\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          _this.loader.pageLoaded();\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    ExternalAppController.prototype.cancel = function() {\n      return this.window.history.back();\n    };\n\n    ExternalAppController.prototype.createApplicationToken = function() {\n      return this.externalAppsService.authorizeApplicationToken(this._applicationId, this._state).then((function(_this) {\n        return function(data) {\n          return _this._redirect(data);\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function(xhr) {\n          return _this.xhrError.response(xhr);\n        };\n      })(this));\n    };\n\n    return ExternalAppController;\n\n  })(taiga.Controller);\n\n  angular.module(\"taigaExternalApps\").controller(\"ExternalApp\", ExternalAppController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-app.service.coffee\n */\n\n(function() {\n  var ExternalAppsService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  ExternalAppsService = (function(superClass) {\n    extend(ExternalAppsService, superClass);\n\n    ExternalAppsService.$inject = [\"tgResources\"];\n\n    function ExternalAppsService(rs) {\n      this.rs = rs;\n    }\n\n    ExternalAppsService.prototype.getApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.getApplicationToken(applicationId, state);\n    };\n\n    ExternalAppsService.prototype.authorizeApplicationToken = function(applicationId, state) {\n      return this.rs.externalapps.authorizeApplicationToken(applicationId, state);\n    };\n\n    return ExternalAppsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaExternalApps\").service(\"tgExternalAppsService\", ExternalAppsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: feedback.service.coffee\n */\n\n(function() {\n  var FeedbackService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  FeedbackService = (function(superClass) {\n    extend(FeedbackService, superClass);\n\n    FeedbackService.$inject = [\"tgLightboxFactory\"];\n\n    function FeedbackService(lightboxFactory) {\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    FeedbackService.prototype.sendFeedback = function() {\n      return this.lightboxFactory.create(\"tg-lb-feedback\", {\n        \"class\": \"lightbox lightbox-feedback lightbox-generic-form\"\n      });\n    };\n\n    return FeedbackService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaFeedback\").service(\"tgFeedbackService\", FeedbackService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: duty.directive.coffee\n */\n\n(function() {\n  var DutyDirective;\n\n  DutyDirective = function(navurls, $translate) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.duty = scope.duty;\n      return scope.vm.getDutyType = function() {\n        if (scope.vm.duty) {\n          if (scope.vm.duty.get('_name') === \"userstories\") {\n            return $translate.instant(\"COMMON.USER_STORY\");\n          }\n          if (scope.vm.duty.get('_name') === \"tasks\") {\n            return $translate.instant(\"COMMON.TASK\");\n          }\n          if (scope.vm.duty.get('_name') === \"issues\") {\n            return $translate.instant(\"COMMON.ISSUE\");\n          }\n        }\n      };\n    };\n    return {\n      templateUrl: \"home/duties/duty.html\",\n      scope: {\n        \"duty\": \"=tgDuty\"\n      },\n      link: link\n    };\n  };\n\n  DutyDirective.$inject = [\"$tgNavUrls\", \"$translate\"];\n\n  angular.module(\"taigaHome\").directive(\"tgDuty\", DutyDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.controller.coffee\n */\n\n(function() {\n  var HomeController;\n\n  HomeController = (function() {\n    HomeController.$inject = [\"tgCurrentUserService\", \"$location\", \"$tgNavUrls\"];\n\n    function HomeController(currentUserService, location, navUrls) {\n      this.currentUserService = currentUserService;\n      this.location = location;\n      this.navUrls = navUrls;\n      if (!this.currentUserService.getUser()) {\n        this.location.path(this.navUrls.resolve(\"discover\"));\n      }\n    }\n\n    return HomeController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"Home\", HomeController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home.service.coffee\n */\n\n(function() {\n  var HomeService, groupBy,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  groupBy = this.taiga.groupBy;\n\n  HomeService = (function(superClass) {\n    extend(HomeService, superClass);\n\n    HomeService.$inject = [\"$tgNavUrls\", \"tgResources\", \"tgProjectsService\"];\n\n    function HomeService(navurls, rs, projectsService) {\n      this.navurls = navurls;\n      this.rs = rs;\n      this.projectsService = projectsService;\n    }\n\n    HomeService.prototype._attachProjectInfoToWorkInProgress = function(workInProgress, projectsById) {\n      var _attachProjectInfoToDuty, _duties, assignedTo, watching;\n      _attachProjectInfoToDuty = (function(_this) {\n        return function(duty, objType) {\n          var ctx, project, url;\n          project = projectsById.get(String(duty.get('project')));\n          ctx = {\n            project: project.get('slug'),\n            ref: duty.get('ref')\n          };\n          url = _this.navurls.resolve(\"project-\" + objType + \"-detail\", ctx);\n          duty = duty.set('url', url);\n          duty = duty.set('projectName', project.get('name'));\n          duty = duty.set('blockedProject', project.get('blocked_code'));\n          duty = duty.set(\"_name\", objType);\n          return duty;\n        };\n      })(this);\n      assignedTo = workInProgress.get(\"assignedTo\");\n      if (assignedTo.get(\"userStories\")) {\n        _duties = assignedTo.get(\"userStories\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"userstories\");\n        });\n        assignedTo = assignedTo.set(\"userStories\", _duties);\n      }\n      if (assignedTo.get(\"tasks\")) {\n        _duties = assignedTo.get(\"tasks\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"tasks\");\n        });\n        assignedTo = assignedTo.set(\"tasks\", _duties);\n      }\n      if (assignedTo.get(\"issues\")) {\n        _duties = assignedTo.get(\"issues\").map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"issues\");\n        });\n        assignedTo = assignedTo.set(\"issues\", _duties);\n      }\n      watching = workInProgress.get(\"watching\");\n      if (watching.get(\"userStories\")) {\n        _duties = watching.get(\"userStories\").filter(function(duty) {\n          return !!projectsById.get(String(duty.get('project')));\n        });\n        _duties = _duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"userstories\");\n        });\n        watching = watching.set(\"userStories\", _duties);\n      }\n      if (watching.get(\"tasks\")) {\n        _duties = watching.get(\"tasks\").filter(function(duty) {\n          return !!projectsById.get(String(duty.get('project')));\n        });\n        _duties = _duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"tasks\");\n        });\n        watching = watching.set(\"tasks\", _duties);\n      }\n      if (watching.get(\"issues\")) {\n        _duties = watching.get(\"issues\").filter(function(duty) {\n          return !!projectsById.get(String(duty.get('project')));\n        });\n        _duties = _duties.map(function(duty) {\n          return _attachProjectInfoToDuty(duty, \"issues\");\n        });\n        watching = watching.set(\"issues\", _duties);\n      }\n      workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n      return workInProgress = workInProgress.set(\"watching\", watching);\n    };\n\n    HomeService.prototype.getWorkInProgress = function(userId) {\n      var assignedIssuesPromise, assignedTasksPromise, assignedTo, assignedUserStoriesPromise, params, params_us, projectsById, projectsPromise, watching, watchingIssuesPromise, watchingTasksPromise, watchingUserStoriesPromise, workInProgress;\n      projectsById = Immutable.Map();\n      projectsPromise = this.projectsService.getProjectsByUserId(userId).then(function(projects) {\n        return projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n          return p.id;\n        }));\n      });\n      assignedTo = Immutable.Map();\n      params = {\n        status__is_closed: false,\n        assigned_to: userId\n      };\n      params_us = {\n        is_closed: false,\n        assigned_to: userId\n      };\n      assignedUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return assignedTo = assignedTo.set(\"userStories\", userstories);\n      });\n      assignedTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return assignedTo = assignedTo.set(\"tasks\", tasks);\n      });\n      assignedIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return assignedTo = assignedTo.set(\"issues\", issues);\n      });\n      params = {\n        status__is_closed: false,\n        watchers: userId\n      };\n      params_us = {\n        is_closed: false,\n        watchers: userId\n      };\n      watching = Immutable.Map();\n      watchingUserStoriesPromise = this.rs.userstories.listInAllProjects(params_us).then(function(userstories) {\n        return watching = watching.set(\"userStories\", userstories);\n      });\n      watchingTasksPromise = this.rs.tasks.listInAllProjects(params).then(function(tasks) {\n        return watching = watching.set(\"tasks\", tasks);\n      });\n      watchingIssuesPromise = this.rs.issues.listInAllProjects(params).then(function(issues) {\n        return watching = watching.set(\"issues\", issues);\n      });\n      workInProgress = Immutable.Map();\n      return Promise.all([projectsPromise, assignedUserStoriesPromise, assignedTasksPromise, assignedIssuesPromise, watchingUserStoriesPromise, watchingTasksPromise, watchingIssuesPromise]).then((function(_this) {\n        return function() {\n          workInProgress = workInProgress.set(\"assignedTo\", assignedTo);\n          workInProgress = workInProgress.set(\"watching\", watching);\n          workInProgress = _this._attachProjectInfoToWorkInProgress(workInProgress, projectsById);\n          return workInProgress;\n        };\n      })(this));\n    };\n\n    return HomeService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaHome\").service(\"tgHomeService\", HomeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: home-project-list.directive.coffee\n */\n\n(function() {\n  var HomeProjectListDirective;\n\n  HomeProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"home/projects/home-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  HomeProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgHomeProjectList\", HomeProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.controller.coffee\n */\n\n(function() {\n  var WorkingOnController;\n\n  WorkingOnController = (function() {\n    WorkingOnController.$inject = [\"tgHomeService\"];\n\n    function WorkingOnController(homeService) {\n      this.homeService = homeService;\n      this.assignedTo = Immutable.Map();\n      this.watching = Immutable.Map();\n    }\n\n    WorkingOnController.prototype._setAssignedTo = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"assignedTo\").get(\"userStories\");\n      tasks = workInProgress.get(\"assignedTo\").get(\"tasks\");\n      issues = workInProgress.get(\"assignedTo\").get(\"issues\");\n      this.assignedTo = userStories.concat(tasks).concat(issues);\n      if (this.assignedTo.size > 0) {\n        return this.assignedTo = this.assignedTo.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype._setWatching = function(workInProgress) {\n      var issues, tasks, userStories;\n      userStories = workInProgress.get(\"watching\").get(\"userStories\");\n      tasks = workInProgress.get(\"watching\").get(\"tasks\");\n      issues = workInProgress.get(\"watching\").get(\"issues\");\n      this.watching = userStories.concat(tasks).concat(issues);\n      if (this.watching.size > 0) {\n        return this.watching = this.watching.sortBy(function(elem) {\n          return elem.get(\"modified_date\");\n        }).reverse();\n      }\n    };\n\n    WorkingOnController.prototype.getWorkInProgress = function(userId) {\n      return this.homeService.getWorkInProgress(userId).then((function(_this) {\n        return function(workInProgress) {\n          _this._setAssignedTo(workInProgress);\n          return _this._setWatching(workInProgress);\n        };\n      })(this));\n    };\n\n    return WorkingOnController;\n\n  })();\n\n  angular.module(\"taigaHome\").controller(\"WorkingOn\", WorkingOnController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: working-on.directive.coffee\n */\n\n(function() {\n  var WorkingOnDirective;\n\n  WorkingOnDirective = function(homeService, currentUserService) {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      var user, userId;\n      user = currentUserService.getUser();\n      if (user) {\n        userId = user.get(\"id\");\n        return ctrl.getWorkInProgress(userId);\n      }\n    };\n    return {\n      controller: \"WorkingOn\",\n      controllerAs: \"vm\",\n      templateUrl: \"home/working-on/working-on.html\",\n      scope: {},\n      link: link\n    };\n  };\n\n  WorkingOnDirective.$inject = [\"tgHomeService\", \"tgCurrentUserService\"];\n\n  angular.module(\"taigaHome\").directive(\"tgWorkingOn\", WorkingOnDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-project-list.directive.coffee\n */\n\n(function() {\n  var DropdownProjectListDirective;\n\n  DropdownProjectListDirective = function(currentUserService, projectsService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      return scope.vm.newProject = function() {\n        return projectsService.newProject();\n      };\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-project-list/dropdown-project-list.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownProjectListDirective.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownProjectList\", DropdownProjectListDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: dropdown-user.directive.coffee\n */\n\n(function() {\n  var DropdownUserDirective;\n\n  DropdownUserDirective = function(authService, configService, locationService, navUrlsService, feedbackService, $rootScope) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      scope.vm.isFeedbackEnabled = configService.get(\"feedbackEnabled\");\n      taiga.defineImmutableProperty(scope.vm, \"user\", function() {\n        return authService.userData;\n      });\n      scope.vm.logout = function() {\n        authService.logout();\n        locationService.url(navUrlsService.resolve(\"discover\"));\n        return locationService.search({});\n      };\n      scope.vm.sendFeedback = function() {\n        return feedbackService.sendFeedback();\n      };\n      return scope.vm.userSettingsPlugins = _.filter($rootScope.userSettingsPlugins, {\n        userMenu: true\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/dropdown-user/dropdown-user.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  DropdownUserDirective.$inject = [\"$tgAuth\", \"$tgConfig\", \"$tgLocation\", \"$tgNavUrls\", \"tgFeedbackService\", \"$rootScope\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgDropdownUser\", DropdownUserDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.directive.coffee\n */\n\n(function() {\n  var NavigationBarDirective;\n\n  NavigationBarDirective = function(currentUserService, navigationBarService, locationService, navUrlsService, config) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      scope.vm = {};\n      taiga.defineImmutableProperty(scope.vm, \"projects\", function() {\n        return currentUserService.projects.get(\"recents\");\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isAuthenticated\", function() {\n        return currentUserService.isAuthenticated();\n      });\n      taiga.defineImmutableProperty(scope.vm, \"isEnabledHeader\", function() {\n        return navigationBarService.isEnabledHeader();\n      });\n      scope.vm.publicRegisterEnabled = config.get(\"publicRegisterEnabled\");\n      scope.vm.login = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"login\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      scope.vm.register = function() {\n        var nextUrl;\n        nextUrl = encodeURIComponent(locationService.url());\n        locationService.url(navUrlsService.resolve(\"register\"));\n        return locationService.search({\n          next: nextUrl\n        });\n      };\n      return scope.$on(\"$routeChangeSuccess\", function() {\n        if (locationService.path() === \"/\") {\n          return scope.vm.active = true;\n        } else {\n          return scope.vm.active = false;\n        }\n      });\n    };\n    directive = {\n      templateUrl: \"navigation-bar/navigation-bar.html\",\n      scope: {},\n      link: link\n    };\n    return directive;\n  };\n\n  NavigationBarDirective.$inject = [\"tgCurrentUserService\", \"tgNavigationBarService\", \"$tgLocation\", \"$tgNavUrls\", \"$tgConfig\"];\n\n  angular.module(\"taigaNavigationBar\").directive(\"tgNavigationBar\", NavigationBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: navigation-bar.service.coffee\n */\n\n(function() {\n  var NavigationBarService,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  NavigationBarService = (function(superClass) {\n    extend(NavigationBarService, superClass);\n\n    function NavigationBarService() {\n      this.disableHeader();\n    }\n\n    NavigationBarService.prototype.enableHeader = function() {\n      return this.enabledHeader = true;\n    };\n\n    NavigationBarService.prototype.disableHeader = function() {\n      return this.enabledHeader = false;\n    };\n\n    NavigationBarService.prototype.isEnabledHeader = function() {\n      return this.enabledHeader;\n    };\n\n    return NavigationBarService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaNavigationBar\").service(\"tgNavigationBarService\", NavigationBarService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.controller.coffee\n */\n\n(function() {\n  var ProfileBarController;\n\n  ProfileBarController = (function() {\n    ProfileBarController.$inject = [\"tgUserService\"];\n\n    function ProfileBarController(userService) {\n      this.userService = userService;\n      this.loadStats();\n    }\n\n    ProfileBarController.prototype.loadStats = function() {\n      return this.userService.getStats(this.user.get(\"id\")).then((function(_this) {\n        return function(stats) {\n          return _this.stats = stats;\n        };\n      })(this));\n    };\n\n    return ProfileBarController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileBar\", ProfileBarController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-bar.directive.coffee\n */\n\n(function() {\n  var ProfileBarDirective;\n\n  ProfileBarDirective = function() {\n    return {\n      templateUrl: \"profile/profile-bar/profile-bar.html\",\n      controller: \"ProfileBar\",\n      controllerAs: \"vm\",\n      scope: {\n        user: \"=user\",\n        isCurrentUser: \"=iscurrentuser\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileBar\", ProfileBarDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.controller.coffee\n */\n\n(function() {\n  var ProfileContactsController;\n\n  ProfileContactsController = (function() {\n    ProfileContactsController.$inject = [\"tgUserService\", \"tgCurrentUserService\"];\n\n    function ProfileContactsController(userService, currentUserService) {\n      this.userService = userService;\n      this.currentUserService = currentUserService;\n      this.currentUser = this.currentUserService.getUser();\n      this.isCurrentUser = false;\n      if (this.currentUser && this.currentUser.get(\"id\") === this.user.get(\"id\")) {\n        this.isCurrentUser = true;\n      }\n    }\n\n    ProfileContactsController.prototype.loadContacts = function() {\n      return this.userService.getContacts(this.user.get(\"id\")).then((function(_this) {\n        return function(contacts) {\n          return _this.contacts = contacts;\n        };\n      })(this));\n    };\n\n    return ProfileContactsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileContacts\", ProfileContactsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-contacts.directive.coffee\n */\n\n(function() {\n  var ProfileContactsDirective;\n\n  ProfileContactsDirective = function() {\n    var link;\n    link = function(scope, elm, attrs, ctrl) {\n      return ctrl.loadContacts();\n    };\n    return {\n      templateUrl: \"profile/profile-contacts/profile-contacts.html\",\n      scope: {\n        user: \"=\"\n      },\n      controllerAs: \"vm\",\n      controller: \"ProfileContacts\",\n      link: link,\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileContacts\", ProfileContactsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: items.directive.coffee\n */\n\n(function() {\n  var FavItemDirective;\n\n  FavItemDirective = function() {\n    var link, templateUrl;\n    link = function(scope, el, attrs, ctrl) {\n      return scope.vm = {\n        item: scope.item\n      };\n    };\n    templateUrl = function(el, attrs) {\n      if (attrs.itemType === \"project\") {\n        return \"profile/profile-favs/items/project.html\";\n      } else {\n        return \"profile/profile-favs/items/ticket.html\";\n      }\n    };\n    return {\n      scope: {\n        \"item\": \"=tgFavItem\"\n      },\n      link: link,\n      templateUrl: templateUrl\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgFavItem\", FavItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.controller.coffee\n */\n\n(function() {\n  var FavsBaseController, ProfileLikedController, ProfileVotedController, ProfileWatchedController, debounceLeading,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  debounceLeading = this.taiga.debounceLeading;\n\n  FavsBaseController = (function() {\n    function FavsBaseController() {\n      this._init();\n    }\n\n    FavsBaseController.prototype._init = function() {\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = true;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._resetList();\n      this.q = null;\n      return this.type = null;\n    };\n\n    FavsBaseController.prototype._resetList = function() {\n      this.items = Immutable.List();\n      this.scrollDisabled = false;\n      return this._page = 1;\n    };\n\n    FavsBaseController.prototype._enableLoadingSpinner = function() {\n      return this.isLoading = true;\n    };\n\n    FavsBaseController.prototype._disableLoadingSpinner = function() {\n      return this.isLoading = false;\n    };\n\n    FavsBaseController.prototype._enableScroll = function() {\n      return this.scrollDisabled = false;\n    };\n\n    FavsBaseController.prototype._disableScroll = function() {\n      return this.scrollDisabled = true;\n    };\n\n    FavsBaseController.prototype._checkIfHasMorePages = function(hasNext) {\n      if (hasNext) {\n        this._page += 1;\n        return this._enableScroll();\n      } else {\n        return this._disableScroll();\n      }\n    };\n\n    FavsBaseController.prototype._checkIfHasNoResults = function() {\n      return this.hasNoResults = this.items.size === 0;\n    };\n\n    FavsBaseController.prototype.loadItems = function() {\n      this._enableLoadingSpinner();\n      this._disableScroll();\n      return this._getItems(this.user.get(\"id\"), this._page, this.type, this.q).then((function(_this) {\n        return function(response) {\n          _this.items = _this.items.concat(response.get(\"data\"));\n          _this._checkIfHasMorePages(response.get(\"next\"));\n          _this._checkIfHasNoResults();\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          _this._disableLoadingSpinner();\n          return _this.items;\n        };\n      })(this));\n    };\n\n    FavsBaseController.prototype.filterByTextQuery = debounceLeading(500, function() {\n      this._resetList();\n      return this.loadItems();\n    });\n\n    FavsBaseController.prototype.showAll = function() {\n      if (this.type !== null) {\n        this.type = null;\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showProjectsOnly = function() {\n      if (this.type !== \"project\") {\n        this.type = \"project\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showUserStoriesOnly = function() {\n      if (this.type !== \"userstory\") {\n        this.type = \"userstory\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showTasksOnly = function() {\n      if (this.type !== \"task\") {\n        this.type = \"task\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    FavsBaseController.prototype.showIssuesOnly = function() {\n      if (this.type !== \"issue\") {\n        this.type = \"issue\";\n        this._resetList();\n        return this.loadItems();\n      }\n    };\n\n    return FavsBaseController;\n\n  })();\n\n  ProfileLikedController = (function(superClass) {\n    extend(ProfileLikedController, superClass);\n\n    ProfileLikedController.$inject = [\"tgUserService\"];\n\n    function ProfileLikedController(userService) {\n      this.userService = userService;\n      ProfileLikedController.__super__.constructor.call(this);\n      this.enableFilterByAll = false;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = false;\n      this.enableFilterByTasks = false;\n      this.enableFilterByIssues = false;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getLiked;\n    }\n\n    return ProfileLikedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileLiked\", ProfileLikedController);\n\n  ProfileVotedController = (function(superClass) {\n    extend(ProfileVotedController, superClass);\n\n    ProfileVotedController.$inject = [\"tgUserService\"];\n\n    function ProfileVotedController(userService) {\n      this.userService = userService;\n      ProfileVotedController.__super__.constructor.call(this);\n      this.enableFilterByAll = true;\n      this.enableFilterByProjects = false;\n      this.enableFilterByUserStories = true;\n      this.enableFilterByTasks = true;\n      this.enableFilterByIssues = true;\n      this.enableFilterByTextQuery = true;\n      this._getItems = this.userService.getVoted;\n    }\n\n    return ProfileVotedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileVoted\", ProfileVotedController);\n\n  ProfileWatchedController = (function(superClass) {\n    extend(ProfileWatchedController, superClass);\n\n    ProfileWatchedController.$inject = [\"tgUserService\"];\n\n    function ProfileWatchedController(userService) {\n      this.userService = userService;\n      ProfileWatchedController.__super__.constructor.call(this);\n      this._getItems = this.userService.getWatched;\n    }\n\n    return ProfileWatchedController;\n\n  })(FavsBaseController);\n\n  angular.module(\"taigaProfile\").controller(\"ProfileWatched\", ProfileWatchedController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-favs.directive.coffee\n */\n\n(function() {\n  var ProfileLikedDirective, ProfileVotedDirective, ProfileWatchedDirective, base;\n\n  base = {\n    scope: {},\n    bindToController: {\n      user: \"=\",\n      type: \"@\",\n      q: \"@\",\n      scrollDisabled: \"@\",\n      isLoading: \"@\",\n      hasNoResults: \"@\"\n    },\n    controller: null,\n    controllerAs: \"vm\",\n    templateUrl: \"profile/profile-favs/profile-favs.html\"\n  };\n\n  ProfileLikedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileLiked\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileLiked\", ProfileLikedDirective);\n\n  ProfileVotedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileVoted\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileVoted\", ProfileVotedDirective);\n\n  ProfileWatchedDirective = function() {\n    return _.extend({}, base, {\n      controller: \"ProfileWatched\"\n    });\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileWatched\", ProfileWatchedDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.controller.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = (function() {\n    ProfileHints.prototype.HINTS = [\n      {\n        url: \"https://tree.taiga.io/support/admin/import-export-projects/\"\n      }, {\n        url: \"https://tree.taiga.io/support/admin/custom-fields/\"\n      }, {}, {}\n    ];\n\n    function ProfileHints(translate) {\n      var hintKey;\n      this.translate = translate;\n      hintKey = Math.floor(Math.random() * this.HINTS.length) + 1;\n      this.hint = this.HINTS[hintKey - 1];\n      this.hint.linkText = this.hint.linkText || 'HINTS.LINK';\n      this.hint.title = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TITLE\");\n      this.hint.text = this.translate.instant(\"HINTS.HINT\" + hintKey + \"_TEXT\");\n    }\n\n    return ProfileHints;\n\n  })();\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").controller(\"ProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-hints.directive.coffee\n */\n\n(function() {\n  var ProfileHints;\n\n  ProfileHints = function($translate) {\n    return {\n      scope: {},\n      controller: \"ProfileHints\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-hints/profile-hints.html\"\n    };\n  };\n\n  ProfileHints.$inject = [\"$translate\"];\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileHints\", ProfileHints);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.controller.coffee\n */\n\n(function() {\n  var ProfileProjectsController;\n\n  ProfileProjectsController = (function() {\n    ProfileProjectsController.$inject = [\"tgProjectsService\", \"tgUserService\"];\n\n    function ProfileProjectsController(projectsService, userService) {\n      this.projectsService = projectsService;\n      this.userService = userService;\n    }\n\n    ProfileProjectsController.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this.user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.userService.attachUserContactsToProjects(_this.user.get(\"id\"), projects);\n        };\n      })(this)).then((function(_this) {\n        return function(projects) {\n          return _this.projects = projects;\n        };\n      })(this));\n    };\n\n    return ProfileProjectsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileProjects\", ProfileProjectsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-projects.directive.coffee\n */\n\n(function() {\n  var ProfileProjectsDirective;\n\n  ProfileProjectsDirective = function() {\n    var link;\n    link = function(scope, elm, attr, ctrl) {\n      return ctrl.loadProjects();\n    };\n    return {\n      templateUrl: \"profile/profile-projects/profile-projects.html\",\n      scope: {\n        user: \"=\"\n      },\n      link: link,\n      bindToController: true,\n      controllerAs: \"vm\",\n      controller: \"ProfileProjects\"\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileProjects\", ProfileProjectsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tab.directive.coffee\n */\n\n(function() {\n  var ProfileTabDirective;\n\n  ProfileTabDirective = function() {\n    var link;\n    link = function(scope, element, attrs, ctrl, transclude) {\n      scope.tab = {};\n      attrs.$observe(\"tgProfileTab\", function(name) {\n        return scope.tab.name = name;\n      });\n      attrs.$observe(\"tabTitle\", function(title) {\n        return scope.tab.title = title;\n      });\n      scope.tab.icon = attrs.tabIcon;\n      scope.tab.active = !!attrs.tabActive;\n      if (scope.$eval(attrs.tabDisabled) !== true) {\n        return ctrl.addTab(scope.tab);\n      }\n    };\n    return {\n      templateUrl: \"profile/profile-tab/profile-tab.html\",\n      scope: {},\n      require: \"^tgProfileTabs\",\n      link: link,\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTab\", ProfileTabDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.controller.coffee\n */\n\n(function() {\n  var ProfileTabsController;\n\n  ProfileTabsController = (function() {\n    function ProfileTabsController() {\n      this.tabs = [];\n    }\n\n    ProfileTabsController.prototype.addTab = function(tab) {\n      return this.tabs.push(tab);\n    };\n\n    ProfileTabsController.prototype.toggleTab = function(tab) {\n      _.map(this.tabs, function(tab) {\n        return tab.active = false;\n      });\n      return tab.active = true;\n    };\n\n    return ProfileTabsController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"ProfileTabs\", ProfileTabsController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile-tabs.directive.coffee\n */\n\n(function() {\n  var ProfileTabsDirective;\n\n  ProfileTabsDirective = function() {\n    return {\n      scope: {},\n      controller: \"ProfileTabs\",\n      controllerAs: \"vm\",\n      templateUrl: \"profile/profile-tabs/profile-tabs.html\",\n      transclude: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgProfileTabs\", ProfileTabsDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: profile.controller.coffee\n */\n\n(function() {\n  var ProfileController;\n\n  ProfileController = (function() {\n    ProfileController.$inject = [\"tgAppMetaService\", \"tgCurrentUserService\", \"$routeParams\", \"tgUserService\", \"tgXhrErrorService\", \"$translate\"];\n\n    function ProfileController(appMetaService, currentUserService, routeParams, userService, xhrError, translate) {\n      this.appMetaService = appMetaService;\n      this.currentUserService = currentUserService;\n      this.routeParams = routeParams;\n      this.userService = userService;\n      this.xhrError = xhrError;\n      this.translate = translate;\n      this.isCurrentUser = false;\n      if (this.routeParams.slug) {\n        this.userService.getUserByUserName(this.routeParams.slug).then((function(_this) {\n          return function(user) {\n            if (!user.get('is_active')) {\n              return _this.xhrError.notFound();\n            } else {\n              _this.user = user;\n              _this.isCurrentUser = false;\n              _this._setMeta(_this.user);\n              return user;\n            }\n          };\n        })(this))[\"catch\"]((function(_this) {\n          return function(xhr) {\n            return _this.xhrError.response(xhr);\n          };\n        })(this));\n      } else {\n        this.user = this.currentUserService.getUser();\n        this.isCurrentUser = true;\n        this._setMeta(this.user);\n      }\n    }\n\n    ProfileController.prototype._setMeta = function(user) {\n      var ctx, description, title;\n      ctx = {\n        userFullName: user.get(\"full_name_display\"),\n        userUsername: user.get(\"username\")\n      };\n      title = this.translate.instant(\"USER.PROFILE.PAGE_TITLE\", ctx);\n      description = user.get(\"bio\");\n      return this.appMetaService.setAll(title, description);\n    };\n\n    return ProfileController;\n\n  })();\n\n  angular.module(\"taigaProfile\").controller(\"Profile\", ProfileController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: blocked-project-explanation.directive.coffee\n */\n\n(function() {\n  var BlockedProjectExplanationDirective;\n\n  BlockedProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/project/blocked-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgBlockedProjectExplanation\", BlockedProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.controller.coffee\n */\n\n(function() {\n  var LikeProjectButtonController;\n\n  LikeProjectButtonController = (function() {\n    LikeProjectButtonController.$inject = [\"$tgConfirm\", \"tgLikeProjectButtonService\"];\n\n    function LikeProjectButtonController(confirm, likeButtonService) {\n      this.confirm = confirm;\n      this.likeButtonService = likeButtonService;\n      this.isMouseOver = false;\n      this.loading = false;\n    }\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsOver = function() {\n      return this.isMouseOver = true;\n    };\n\n    LikeProjectButtonController.prototype.showTextWhenMouseIsLeave = function() {\n      return this.isMouseOver = false;\n    };\n\n    LikeProjectButtonController.prototype.toggleLike = function() {\n      var promise;\n      this.loading = true;\n      if (!this.project.get(\"is_fan\")) {\n        promise = this._like();\n      } else {\n        promise = this._unlike();\n      }\n      promise[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n      return promise;\n    };\n\n    LikeProjectButtonController.prototype._like = function() {\n      return this.likeButtonService.like(this.project.get('id')).then((function(_this) {\n        return function() {\n          return _this.showTextWhenMouseIsLeave();\n        };\n      })(this))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    LikeProjectButtonController.prototype._unlike = function() {\n      return this.likeButtonService.unlike(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"LikeProjectButton\", LikeProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.directive.coffee\n */\n\n(function() {\n  var LikeProjectButtonDirective;\n\n  LikeProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"LikeProjectButton\",\n      bindToController: {\n        project: '='\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/like-project-button/like-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgLikeProjectButton\", LikeProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: like-project-button.service.coffee\n */\n\n(function() {\n  var LikeProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  LikeProjectButtonService = (function(superClass) {\n    extend(LikeProjectButtonService, superClass);\n\n    LikeProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function LikeProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    LikeProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    LikeProjectButtonService.prototype._updateProjects = function(projectId, isFan) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, function(project) {\n        var totalFans;\n        totalFans = project.get(\"total_fans\");\n        if (isFan) {\n          totalFans++;\n        } else {\n          totalFans--;\n        }\n        return project.merge({\n          is_fan: isFan,\n          total_fans: totalFans\n        });\n      });\n      return this.currentUserService.setProjects(projects);\n    };\n\n    LikeProjectButtonService.prototype._updateCurrentProject = function(isFan) {\n      var project, totalFans;\n      totalFans = this.projectService.project.get(\"total_fans\");\n      if (isFan) {\n        totalFans++;\n      } else {\n        totalFans--;\n      }\n      project = this.projectService.project.merge({\n        is_fan: isFan,\n        total_fans: totalFans\n      });\n      return this.projectService.setProject(project);\n    };\n\n    LikeProjectButtonService.prototype.like = function(projectId) {\n      return this.rs.projects.likeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, true);\n          return _this._updateCurrentProject(true);\n        };\n      })(this));\n    };\n\n    LikeProjectButtonService.prototype.unlike = function(projectId) {\n      return this.rs.projects.unlikeProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, false);\n          return _this._updateCurrentProject(false);\n        };\n      })(this));\n    };\n\n    return LikeProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgLikeProjectButtonService\", LikeProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: sort-projects.directive.coffee\n */\n\n(function() {\n  var SortProjectsDirective;\n\n  SortProjectsDirective = function(currentUserService) {\n    var directive, link;\n    link = function(scope, el, attrs, ctrl) {\n      var drake, itemEl, scroll;\n      itemEl = null;\n      drake = dragula([el[0]], {\n        copySortSource: false,\n        copy: false,\n        mirrorContainer: el[0],\n        moves: function(item) {\n          return $(item).hasClass('list-itemtype-project');\n        }\n      });\n      drake.on('dragend', function(item) {\n        var i, index, len, project, sortData, sorted_project_ids, value;\n        itemEl = $(item);\n        project = itemEl.scope().project;\n        index = itemEl.index();\n        sorted_project_ids = _.map(scope.projects.toJS(), function(p) {\n          return p.id;\n        });\n        sorted_project_ids = _.without(sorted_project_ids, project.get(\"id\"));\n        sorted_project_ids.splice(index, 0, project.get('id'));\n        sortData = [];\n        for (index = i = 0, len = sorted_project_ids.length; i < len; index = ++i) {\n          value = sorted_project_ids[index];\n          sortData.push({\n            \"project_id\": value,\n            \"order\": index\n          });\n        }\n        return currentUserService.bulkUpdateProjectsOrder(sortData);\n      });\n      scroll = autoScroll(window, {\n        margin: 20,\n        pixels: 30,\n        scrollWhenOutside: true,\n        autoScroll: function() {\n          return this.down && drake.dragging;\n        }\n      });\n      return scope.$on(\"$destroy\", function() {\n        el.off();\n        return drake.destroy();\n      });\n    };\n    directive = {\n      scope: {\n        projects: \"=tgSortProjects\"\n      },\n      link: link\n    };\n    return directive;\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgSortProjects\", [\"tgCurrentUserService\", SortProjectsDirective]);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.controller.coffee\n */\n\n(function() {\n  var WatchProjectButtonController;\n\n  WatchProjectButtonController = (function() {\n    WatchProjectButtonController.$inject = [\"$tgConfirm\", \"tgWatchProjectButtonService\"];\n\n    function WatchProjectButtonController(confirm, watchButtonService) {\n      this.confirm = confirm;\n      this.watchButtonService = watchButtonService;\n      this.showWatchOptions = false;\n      this.loading = false;\n    }\n\n    WatchProjectButtonController.prototype.toggleWatcherOptions = function() {\n      return this.showWatchOptions = !this.showWatchOptions;\n    };\n\n    WatchProjectButtonController.prototype.closeWatcherOptions = function() {\n      return this.showWatchOptions = false;\n    };\n\n    WatchProjectButtonController.prototype.watch = function(notifyLevel) {\n      if (notifyLevel === this.project.get('notify_level')) {\n        return;\n      }\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.watch(this.project.get('id'), notifyLevel)[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    WatchProjectButtonController.prototype.unwatch = function() {\n      this.loading = true;\n      this.closeWatcherOptions();\n      return this.watchButtonService.unwatch(this.project.get('id'))[\"catch\"]((function(_this) {\n        return function() {\n          return _this.confirm.notify(\"error\");\n        };\n      })(this))[\"finally\"]((function(_this) {\n        return function() {\n          return _this.loading = false;\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"WatchProjectButton\", WatchProjectButtonController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.directive.coffee\n */\n\n(function() {\n  var WatchProjectButtonDirective;\n\n  WatchProjectButtonDirective = function() {\n    return {\n      scope: {},\n      controller: \"WatchProjectButton\",\n      bindToController: {\n        project: \"=\"\n      },\n      controllerAs: \"vm\",\n      templateUrl: \"projects/components/watch-project-button/watch-project-button.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgWatchProjectButton\", WatchProjectButtonDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: watch-project-button.service.coffee\n */\n\n(function() {\n  var WatchProjectButtonService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  WatchProjectButtonService = (function(superClass) {\n    extend(WatchProjectButtonService, superClass);\n\n    WatchProjectButtonService.$inject = [\"tgResources\", \"tgCurrentUserService\", \"tgProjectService\"];\n\n    function WatchProjectButtonService(rs, currentUserService, projectService) {\n      this.rs = rs;\n      this.currentUserService = currentUserService;\n      this.projectService = projectService;\n    }\n\n    WatchProjectButtonService.prototype._getProjectIndex = function(projectId) {\n      return this.currentUserService.projects.get('all').findIndex(function(project) {\n        return project.get('id') === projectId;\n      });\n    };\n\n    WatchProjectButtonService.prototype._updateProjects = function(projectId, notifyLevel, isWatcher) {\n      var projectIndex, projects;\n      projectIndex = this._getProjectIndex(projectId);\n      if (projectIndex === -1) {\n        return;\n      }\n      projects = this.currentUserService.projects.get('all').update(projectIndex, (function(_this) {\n        return function(project) {\n          var totalWatchers;\n          totalWatchers = project.get('total_watchers');\n          if (!_this.projectService.project.get('is_watcher') && isWatcher) {\n            totalWatchers++;\n          } else if (_this.projectService.project.get('is_watcher') && !isWatcher) {\n            totalWatchers--;\n          }\n          return project.merge({\n            is_watcher: isWatcher,\n            total_watchers: totalWatchers,\n            notify_level: notifyLevel\n          });\n        };\n      })(this));\n      return this.currentUserService.setProjects(projects);\n    };\n\n    WatchProjectButtonService.prototype._updateCurrentProject = function(notifyLevel, isWatcher) {\n      var project, totalWatchers;\n      totalWatchers = this.projectService.project.get(\"total_watchers\");\n      if (!this.projectService.project.get('is_watcher') && isWatcher) {\n        totalWatchers++;\n      } else if (this.projectService.project.get('is_watcher') && !isWatcher) {\n        totalWatchers--;\n      }\n      project = this.projectService.project.merge({\n        is_watcher: isWatcher,\n        notify_level: notifyLevel,\n        total_watchers: totalWatchers\n      });\n      return this.projectService.setProject(project);\n    };\n\n    WatchProjectButtonService.prototype.watch = function(projectId, notifyLevel) {\n      return this.rs.projects.watchProject(projectId, notifyLevel).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, notifyLevel, true);\n          return _this._updateCurrentProject(notifyLevel, true);\n        };\n      })(this));\n    };\n\n    WatchProjectButtonService.prototype.unwatch = function(projectId) {\n      return this.rs.projects.unwatchProject(projectId).then((function(_this) {\n        return function() {\n          _this._updateProjects(projectId, null, false);\n          return _this._updateCurrentProject(null, false);\n        };\n      })(this));\n    };\n\n    return WatchProjectButtonService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgWatchProjectButtonService\", WatchProjectButtonService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-listing.controller.coffee\n */\n\n(function() {\n  var ProjectsListingController;\n\n  ProjectsListingController = (function() {\n    ProjectsListingController.$inject = [\"tgCurrentUserService\", \"tgProjectsService\"];\n\n    function ProjectsListingController(currentUserService, projectsService) {\n      this.currentUserService = currentUserService;\n      this.projectsService = projectsService;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this.currentUserService.projects.get(\"all\");\n        };\n      })(this));\n    }\n\n    ProjectsListingController.prototype.newProject = function() {\n      return this.projectsService.newProject();\n    };\n\n    return ProjectsListingController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"ProjectsListing\", ProjectsListingController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.controller.coffee\n */\n\n(function() {\n  var ProjectController;\n\n  ProjectController = (function() {\n    ProjectController.$inject = [\"$routeParams\", \"tgAppMetaService\", \"$tgAuth\", \"$translate\", \"tgProjectService\"];\n\n    function ProjectController(routeParams, appMetaService, auth, translate, projectService) {\n      var projectSlug;\n      this.routeParams = routeParams;\n      this.appMetaService = appMetaService;\n      this.auth = auth;\n      this.translate = translate;\n      this.projectService = projectService;\n      projectSlug = this.routeParams.pslug;\n      this.user = this.auth.userData;\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this.projectService.project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"members\", (function(_this) {\n        return function() {\n          return _this.projectService.activeMembers;\n        };\n      })(this));\n      this.appMetaService.setfn(this._setMeta.bind(this));\n    }\n\n    ProjectController.prototype._setMeta = function(project) {\n      var ctx, metas;\n      if (!this.project) {\n        return null;\n      }\n      metas = {};\n      ctx = {\n        projectName: this.project.get(\"name\")\n      };\n      metas.title = this.translate.instant(\"PROJECT.PAGE_TITLE\", ctx);\n      metas.description = this.project.get(\"description\");\n      return metas;\n    };\n\n    return ProjectController;\n\n  })();\n\n  angular.module(\"taigaProjects\").controller(\"Project\", ProjectController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects.service.coffee\n */\n\n(function() {\n  var ProjectsService, groupBy, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  ProjectsService = (function(superClass) {\n    extend(ProjectsService, superClass);\n\n    ProjectsService.$inject = [\"tgResources\", \"$projectUrl\", \"tgLightboxFactory\"];\n\n    function ProjectsService(rs, projectUrl, lightboxFactory) {\n      this.rs = rs;\n      this.projectUrl = projectUrl;\n      this.lightboxFactory = lightboxFactory;\n    }\n\n    ProjectsService.prototype.getProjectBySlug = function(projectSlug) {\n      return this.rs.projects.getProjectBySlug(projectSlug).then((function(_this) {\n        return function(project) {\n          return _this._decorate(project);\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype.getProjectStats = function(projectId) {\n      return this.rs.projects.getProjectStats(projectId);\n    };\n\n    ProjectsService.prototype.getProjectsByUserId = function(userId, paginate) {\n      return this.rs.projects.getProjectsByUserId(userId, paginate).then((function(_this) {\n        return function(projects) {\n          return projects.map(_this._decorate.bind(_this));\n        };\n      })(this));\n    };\n\n    ProjectsService.prototype._decorate = function(project) {\n      var colorized_tags, tags, url;\n      url = this.projectUrl.get(project.toJS());\n      project = project.set(\"url\", url);\n      colorized_tags = [];\n      if (project.get(\"tags\")) {\n        tags = project.get(\"tags\").sort();\n        colorized_tags = tags.map(function(tag) {\n          var color;\n          color = project.get(\"tags_colors\").get(tag);\n          return Immutable.fromJS({\n            name: tag,\n            color: color\n          });\n        });\n        project = project.set(\"colorized_tags\", colorized_tags);\n      }\n      return project;\n    };\n\n    ProjectsService.prototype.newProject = function() {\n      return this.lightboxFactory.create(\"tg-lb-create-project\", {\n        \"class\": \"wizard-create-project lightbox\"\n      });\n    };\n\n    ProjectsService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.rs.projects.bulkUpdateOrder(sortData);\n    };\n\n    ProjectsService.prototype.transferValidateToken = function(projectId, token) {\n      return this.rs.projects.transferValidateToken(projectId, token);\n    };\n\n    ProjectsService.prototype.transferAccept = function(projectId, token, reason) {\n      return this.rs.projects.transferAccept(projectId, token, reason);\n    };\n\n    ProjectsService.prototype.transferReject = function(projectId, token, reason) {\n      return this.rs.projects.transferReject(projectId, token, reason);\n    };\n\n    return ProjectsService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaProjects\").service(\"tgProjectsService\", ProjectsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: cant-own-project-explanation.directive.coffee\n */\n\n(function() {\n  var CantOwnProjectExplanationDirective;\n\n  CantOwnProjectExplanationDirective = function() {\n    return {\n      templateUrl: \"projects/transfer/cant-own-project-explanation.html\"\n    };\n  };\n\n  angular.module(\"taigaProjects\").directive(\"tgCantOwnProjectExplanation\", CantOwnProjectExplanationDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProject, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProject = (function() {\n    TransferProject.$inject = [\"$routeParams\", \"tgProjectsService\", \"$location\", \"$tgAuth\", \"tgCurrentUserService\", \"$tgNavUrls\", \"$translate\", \"$tgConfirm\"];\n\n    function TransferProject(routeParams, projectService, location, authService, currentUserService, navUrls, translate, confirmService) {\n      this.routeParams = routeParams;\n      this.projectService = projectService;\n      this.location = location;\n      this.authService = authService;\n      this.currentUserService = currentUserService;\n      this.navUrls = navUrls;\n      this.translate = translate;\n      this.confirmService = confirmService;\n    }\n\n    TransferProject.prototype.initialize = function() {\n      this.projectId = this.project.get(\"id\");\n      this.token = this.routeParams.token;\n      this.showAddComment = false;\n      return this._refreshUserData();\n    };\n\n    TransferProject.prototype._validateToken = function() {\n      return this.projectService.transferValidateToken(this.projectId, this.token).then(null, (function(_this) {\n        return function(data, status) {\n          return _this.location.path(_this.navUrls.resolve(\"not-found\"));\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._refreshUserData = function() {\n      return this.authService.refresh().then((function(_this) {\n        return function() {\n          _this._validateToken();\n          _this._setProjectData();\n          return _this._checkOwnerData();\n        };\n      })(this));\n    };\n\n    TransferProject.prototype._setProjectData = function() {\n      return this.canBeOwnedByUser = this.currentUserService.canOwnProject(this.project);\n    };\n\n    TransferProject.prototype._checkOwnerData = function() {\n      var currentUser, maxMemberships;\n      currentUser = this.currentUserService.getUser();\n      if (this.project.get('is_private')) {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PRIVATE';\n        this.maxProjects = currentUser.get('max_private_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_private_projects');\n        maxMemberships = currentUser.get('max_memberships_private_projects');\n      } else {\n        this.ownerMessage = 'ADMIN.PROJECT_TRANSFER.OWNER_MESSAGE.PUBLIC';\n        this.maxProjects = currentUser.get('max_public_projects');\n        if (this.maxProjects === null) {\n          this.maxProjects = this.translate.instant('ADMIN.PROJECT_TRANSFER.UNLIMITED_PROJECTS');\n        }\n        this.currentProjects = currentUser.get('total_public_projects');\n        maxMemberships = currentUser.get('max_memberships_public_projects');\n      }\n      return this.validNumberOfMemberships = maxMemberships === null || this.project.get('total_memberships') <= maxMemberships;\n    };\n\n    TransferProject.prototype.transferAccept = function(token, reason) {\n      this.loadingAccept = true;\n      return this.projectService.transferAccept(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"project-admin-project-profile-details\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.loadingAccept = false;\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.ACCEPTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.transferReject = function(token, reason) {\n      this.loadingReject = true;\n      return this.projectService.transferReject(this.project.get(\"id\"), token, reason).then((function(_this) {\n        return function() {\n          var newUrl;\n          newUrl = _this.navUrls.resolve(\"home\", {\n            project: _this.project.get(\"slug\")\n          });\n          _this.loadingReject = false;\n          _this.location.path(newUrl);\n          _this.confirmService.notify(\"success\", _this.translate.instant(\"ADMIN.PROJECT_TRANSFER.REJECTED_PROJECT_OWNERNSHIP\"), '', 5000);\n        };\n      })(this));\n    };\n\n    TransferProject.prototype.addComment = function() {\n      return this.showAddComment = true;\n    };\n\n    TransferProject.prototype.hideComment = function() {\n      this.showAddComment = false;\n      return this.reason = '';\n    };\n\n    return TransferProject;\n\n  })();\n\n  module.controller(\"TransferProjectController\", TransferProject);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: transfer-project.directive.coffee\n */\n\n(function() {\n  var TransferProjectDirective, module;\n\n  module = angular.module('taigaProjects');\n\n  TransferProjectDirective = function() {\n    var link;\n    link = function(scope, el, attrs, ctrl) {\n      return ctrl.initialize();\n    };\n    return {\n      link: link,\n      scope: {},\n      bindToController: {\n        project: \"=\"\n      },\n      templateUrl: \"projects/transfer/transfer-project.html\",\n      controller: 'TransferProjectController',\n      controllerAs: 'vm'\n    };\n  };\n\n  module.directive('tgTransferProject', TransferProjectDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, sizeFormat, taiga;\n\n  taiga = this.taiga;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  Resource = function(urlsService, http, config, $rootScope, $q, storage) {\n    var service;\n    service = {};\n    service.list = function(type, objectId, projectId) {\n      var httpOptions, params, url, urlname;\n      urlname = \"attachments/\" + type;\n      params = {\n        object_id: objectId,\n        project: projectId\n      };\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      url = urlsService.resolve(urlname);\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service[\"delete\"] = function(type, id) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http[\"delete\"](url);\n    };\n    service.patch = function(type, id, patch) {\n      var url, urlname;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname) + (\"/\" + id);\n      return http.patch(url, patch);\n    };\n    service.create = function(type, projectId, objectId, file) {\n      var data, defered, maxFileSize, response, token, uploadComplete, uploadFailed, uploadProgress, url, urlname, xhr;\n      urlname = \"attachments/\" + type;\n      url = urlsService.resolve(urlname);\n      defered = $q.defer();\n      if (file === void 0) {\n        defered.reject(null);\n        return defered.promise;\n      }\n      maxFileSize = config.get(\"maxUploadFileSize\", null);\n      if (maxFileSize && file.size > maxFileSize) {\n        response = {\n          status: 413,\n          data: {\n            _error_message: \"'\" + file.name + \"' (\" + (sizeFormat(file.size)) + \") is too heavy for our oompa loompas, try it with a smaller than (\" + (sizeFormat(maxFileSize)) + \")\"\n          }\n        };\n        defered.reject(response);\n        return defered.promise;\n      }\n      uploadProgress = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"in-progress\";\n            file.size = sizeFormat(evt.total);\n            file.progressMessage = \"upload \" + (sizeFormat(evt.loaded)) + \" of \" + (sizeFormat(evt.total));\n            return file.progressPercent = (Math.round((evt.loaded / evt.total) * 100)) + \"%\";\n          });\n        };\n      })(this);\n      uploadComplete = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            var attachment, error, ref, status;\n            file.status = \"done\";\n            status = evt.target.status;\n            try {\n              attachment = JSON.parse(evt.target.responseText);\n            } catch (error) {\n              attachment = {};\n            }\n            if (status >= 200 && status < 400) {\n              attachment = Immutable.fromJS(attachment);\n              return defered.resolve(attachment);\n            } else {\n              response = {\n                status: status,\n                data: {\n                  _error_message: (ref = data['attached_file']) != null ? ref[0] : void 0\n                }\n              };\n              return defered.reject(response);\n            }\n          });\n        };\n      })(this);\n      uploadFailed = (function(_this) {\n        return function(evt) {\n          return $rootScope.$apply(function() {\n            file.status = \"error\";\n            return defered.reject(\"fail\");\n          });\n        };\n      })(this);\n      data = new FormData();\n      data.append(\"project\", projectId);\n      data.append(\"object_id\", objectId);\n      data.append(\"attached_file\", file);\n      xhr = new XMLHttpRequest();\n      xhr.upload.addEventListener(\"progress\", uploadProgress, false);\n      xhr.addEventListener(\"load\", uploadComplete, false);\n      xhr.addEventListener(\"error\", uploadFailed, false);\n      token = storage.get('token');\n      xhr.open(\"POST\", url);\n      xhr.setRequestHeader(\"Authorization\", \"Bearer \" + token);\n      xhr.setRequestHeader('Accept', 'application/json');\n      xhr.send(data);\n      return defered.promise;\n    };\n    return function() {\n      return {\n        \"attachments\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"$tgConfig\", \"$rootScope\", \"$q\", \"$tgStorage\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgAttachmentsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: external-apps-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.getApplicationToken = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"applications\");\n      url = url + \"/\" + applicationId + \"/token?state=\" + state;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.authorizeApplicationToken = function(applicationId, state) {\n      var data, url;\n      url = urlsService.resolve(\"application-tokens\");\n      url = url + \"/authorize\";\n      data = {\n        \"state\": state,\n        \"application\": applicationId\n      };\n      return http.post(url, data).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"externalapps\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgExternalAppsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: issues-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"issues\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"issues\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgIssuesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: projects-resource.service.coffee\n */\n\n(function() {\n  var Resource, module, pagination;\n\n  pagination = function() {};\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getProjects = function(params, pagination) {\n      var httpOptions, url;\n      if (params == null) {\n        params = {};\n      }\n      if (pagination == null) {\n        pagination = true;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!pagination) {\n        httpOptions = {\n          headers: {\n            \"x-lazy-pagination\": true\n          }\n        };\n      }\n      return http.get(url, params, httpOptions);\n    };\n    service.getProjectBySlug = function(projectSlug) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/by_slug?slug=\" + projectSlug;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectsByUserId = function(userId, paginate) {\n      var httpOptions, params, url;\n      if (paginate == null) {\n        paginate = false;\n      }\n      url = urlsService.resolve(\"projects\");\n      httpOptions = {};\n      if (!paginate) {\n        httpOptions.headers = {\n          \"x-disable-pagination\": \"1\"\n        };\n      }\n      params = {\n        \"member\": userId,\n        \"order_by\": \"memberships__user_order\"\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getProjectStats = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"projects\");\n      url = url + \"/\" + projectId;\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.bulkUpdateOrder = function(bulkData) {\n      var url;\n      url = urlsService.resolve(\"bulk-update-projects-order\");\n      return http.post(url, bulkData);\n    };\n    service.getTimeline = function(projectId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-project\");\n      url = url + \"/\" + projectId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.likeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-like\", projectId);\n      return http.post(url);\n    };\n    service.unlikeProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unlike\", projectId);\n      return http.post(url);\n    };\n    service.watchProject = function(projectId, notifyLevel) {\n      var data, url;\n      data = {\n        notify_level: notifyLevel\n      };\n      url = urlsService.resolve(\"project-watch\", projectId);\n      return http.post(url, data);\n    };\n    service.unwatchProject = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-unwatch\", projectId);\n      return http.post(url);\n    };\n    service.transferValidateToken = function(projectId, token) {\n      var data, url;\n      data = {\n        token: token\n      };\n      url = urlsService.resolve(\"project-transfer-validate-token\", projectId);\n      return http.post(url, data);\n    };\n    service.transferAccept = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-accept\", projectId);\n      return http.post(url, data);\n    };\n    service.transferReject = function(projectId, token, reason) {\n      var data, url;\n      data = {\n        token: token,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-reject\", projectId);\n      return http.post(url, data);\n    };\n    service.transferRequest = function(projectId) {\n      var url;\n      url = urlsService.resolve(\"project-transfer-request\", projectId);\n      return http.post(url);\n    };\n    service.transferStart = function(projectId, userId, reason) {\n      var data, url;\n      data = {\n        user: userId,\n        reason: reason\n      };\n      url = urlsService.resolve(\"project-transfer-start\", projectId);\n      return http.post(url, data);\n    };\n    return function() {\n      return {\n        \"projects\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgProjectsResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: resources.coffee\n */\n\n(function() {\n  var Resources, services;\n\n  services = [\"tgProjectsResources\", \"tgUserResources\", \"tgUsersResources\", \"tgUserstoriesResource\", \"tgTasksResource\", \"tgIssuesResource\", \"tgExternalAppsResource\", \"tgAttachmentsResource\", \"tgStatsResource\"];\n\n  Resources = function($injector) {\n    var i, j, len, len1, ref, service, serviceFn, serviceName, serviceProperty;\n    for (i = 0, len = services.length; i < len; i++) {\n      serviceName = services[i];\n      serviceFn = $injector.get(serviceName);\n      service = $injector.invoke(serviceFn);\n      ref = Object.keys(service);\n      for (j = 0, len1 = ref.length; j < len1; j++) {\n        serviceProperty = ref[j];\n        if (this[serviceProperty]) {\n          console.warm(\"repeated resource \" + serviceProperty);\n        }\n        this[serviceProperty] = service[serviceProperty];\n      }\n    }\n    return this;\n  };\n\n  Resources.$inject = [\"$injector\"];\n\n  angular.module(\"taigaResources2\").service(\"tgResources\", Resources);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: stats-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.discover = function(applicationId, state) {\n      var url;\n      url = urlsService.resolve(\"stats-discover\");\n      return http.get(url).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"stats\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgStatsResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: tasks-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"tasks\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"tasks\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgTasksResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserStorage = function(key) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-storage\");\n      if (key) {\n        url += '/' + key;\n      }\n      httpOptions = {};\n      return http.get(url, {}).then(function(response) {\n        return response.data.value;\n      });\n    };\n    service.setUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\") + '/' + key;\n      params = {\n        key: key,\n        value: value\n      };\n      return http.put(url, params);\n    };\n    service.createUserStorage = function(key, value) {\n      var params, url;\n      url = urlsService.resolve(\"user-storage\");\n      params = {\n        key: key,\n        value: value\n      };\n      return http.post(url, params);\n    };\n    return function() {\n      return {\n        \"user\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: users-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http, paginateResponseService) {\n    var service;\n    service = {};\n    service.getUserByUsername = function(username) {\n      var httpOptions, params, url;\n      url = urlsService.resolve(\"by_username\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      params = {\n        username: username\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getStats = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-stats\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getContacts = function(userId) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"user-contacts\", userId);\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, {}, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    service.getLiked = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-liked\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      params.only_relevant = true;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getVoted = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-voted\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getWatched = function(userId, page, type, q) {\n      var params, url;\n      url = urlsService.resolve(\"user-watched\", userId);\n      params = {};\n      if (page != null) {\n        params.page = page;\n      }\n      if (type != null) {\n        params.type = type;\n      }\n      if (q != null) {\n        params.q = q;\n      }\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getProfileTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page\n      };\n      url = urlsService.resolve(\"timeline-profile\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    service.getUserTimeline = function(userId, page) {\n      var params, url;\n      params = {\n        page: page,\n        only_relevant: true\n      };\n      url = urlsService.resolve(\"timeline-user\");\n      url = url + \"/\" + userId;\n      return http.get(url, params, {\n        headers: {\n          'x-lazy-pagination': true\n        }\n      }).then(function(result) {\n        result = Immutable.fromJS(result);\n        return paginateResponseService(result);\n      });\n    };\n    return function() {\n      return {\n        \"users\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\", \"tgPaginateResponseService\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUsersResources\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: userstories-resource.service.coffee\n */\n\n(function() {\n  var Resource, module;\n\n  Resource = function(urlsService, http) {\n    var service;\n    service = {};\n    service.listInAllProjects = function(params) {\n      var httpOptions, url;\n      url = urlsService.resolve(\"userstories\");\n      httpOptions = {\n        headers: {\n          \"x-disable-pagination\": \"1\"\n        }\n      };\n      return http.get(url, params, httpOptions).then(function(result) {\n        return Immutable.fromJS(result.data);\n      });\n    };\n    return function() {\n      return {\n        \"userstories\": service\n      };\n    };\n  };\n\n  Resource.$inject = [\"$tgUrls\", \"$tgHttp\"];\n\n  module = angular.module(\"taigaResources2\");\n\n  module.factory(\"tgUserstoriesResource\", Resource);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: app-meta.service.coffee\n */\n\n(function() {\n  var AppMetaService, taiga, truncate;\n\n  taiga = this.taiga;\n\n  truncate = taiga.truncate;\n\n  AppMetaService = (function() {\n    AppMetaService.$inject = [\"$rootScope\"];\n\n    function AppMetaService(rootScope) {\n      this.rootScope = rootScope;\n    }\n\n    AppMetaService.prototype._set = function(key, value) {\n      var meta;\n      if (!key) {\n        return;\n      }\n      if (key === \"title\") {\n        meta = $(\"head title\");\n        if (meta.length === 0) {\n          meta = $(\"<title></title>\");\n          $(\"head\").append(meta);\n        }\n        return meta.text(value || \"\");\n      } else if (key.indexOf(\"og:\") === 0) {\n        meta = $(\"head meta[property='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta property='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      } else {\n        meta = $(\"head meta[name='\" + key + \"']\");\n        if (meta.length === 0) {\n          meta = $(\"<meta name='\" + key + \"'/>\");\n          $(\"head\").append(meta);\n        }\n        return meta.attr(\"content\", value || \"\");\n      }\n    };\n\n    AppMetaService.prototype.setTitle = function(title) {\n      return this._set('title', title);\n    };\n\n    AppMetaService.prototype.setDescription = function(description) {\n      return this._set(\"description\", truncate(description, 250));\n    };\n\n    AppMetaService.prototype.setTwitterMetas = function(title, description) {\n      this._set(\"twitter:card\", \"summary\");\n      this._set(\"twitter:site\", \"@taigaio\");\n      this._set(\"twitter:title\", title);\n      this._set(\"twitter:description\", truncate(description, 300));\n      return this._set(\"twitter:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n    };\n\n    AppMetaService.prototype.setOpenGraphMetas = function(title, description) {\n      this._set(\"og:type\", \"object\");\n      this._set(\"og:site_name\", \"Taiga - Love your projects\");\n      this._set(\"og:title\", title);\n      this._set(\"og:description\", truncate(description, 300));\n      this._set(\"og:image\", window.location.origin + \"/\" + window._version + \"/images/logo-color.png\");\n      return this._set(\"og:url\", window.location.href);\n    };\n\n    AppMetaService.prototype.setAll = function(title, description) {\n      this.setTitle(title);\n      this.setDescription(description);\n      this.setTwitterMetas(title, description);\n      return this.setOpenGraphMetas(title, description);\n    };\n\n    AppMetaService.prototype.addMobileViewport = function() {\n      return $(\"head\").append(\"<meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\\\">\");\n    };\n\n    AppMetaService.prototype.removeMobileViewport = function() {\n      return $(\"head meta[name=\\\"viewport\\\"]\").remove();\n    };\n\n    AppMetaService.prototype.setfn = function(fn) {\n      if (this.listener) {\n        this._listener();\n      }\n      return this._listener = this.rootScope.$watchCollection(fn, (function(_this) {\n        return function(metas) {\n          if (metas) {\n            _this.setAll(metas.title, metas.description);\n            return _this._listener();\n          }\n        };\n      })(this));\n    };\n\n    return AppMetaService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAppMetaService\", AppMetaService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: attachments.service.coffee\n */\n\n(function() {\n  var AttachmentsService, sizeFormat;\n\n  sizeFormat = this.taiga.sizeFormat;\n\n  AttachmentsService = (function() {\n    AttachmentsService.$inject = [\"$tgConfirm\", \"$tgConfig\", \"$translate\", \"tgResources\"];\n\n    function AttachmentsService(confirm, config, translate, rs) {\n      this.confirm = confirm;\n      this.config = config;\n      this.translate = translate;\n      this.rs = rs;\n      this.maxFileSize = this.getMaxFileSize();\n      if (this.maxFileSize) {\n        this.maxFileSizeFormated = sizeFormat(this.maxFileSize);\n      }\n    }\n\n    AttachmentsService.prototype.sizeError = function(file) {\n      var message;\n      message = this.translate.instant(\"ATTACHMENT.ERROR_MAX_SIZE_EXCEEDED\", {\n        fileName: file.name,\n        fileSize: sizeFormat(file.size),\n        maxFileSize: this.maxFileSizeFormated\n      });\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.validate = function(file) {\n      if (this.maxFileSize && file.size > this.maxFileSize) {\n        this.sizeError(file);\n        return false;\n      }\n      return true;\n    };\n\n    AttachmentsService.prototype.getMaxFileSize = function() {\n      return this.config.get(\"maxUploadFileSize\", null);\n    };\n\n    AttachmentsService.prototype.list = function(type, objId, projectId) {\n      return this.rs.attachments.list(type, objId, projectId).then((function(_this) {\n        return function(attachments) {\n          return attachments.sortBy(function(attachment) {\n            return attachment.get('order');\n          });\n        };\n      })(this));\n    };\n\n    AttachmentsService.prototype[\"delete\"] = function(type, id) {\n      return this.rs.attachments[\"delete\"](type, id);\n    };\n\n    AttachmentsService.prototype.saveError = function(file, data) {\n      var message;\n      message = \"\";\n      if (file) {\n        message = this.translate.instant(\"ATTACHMENT.ERROR_UPLOAD_ATTACHMENT\", {\n          fileName: file.name,\n          errorMessage: data.data._error_message\n        });\n      }\n      return this.confirm.notify(\"error\", message);\n    };\n\n    AttachmentsService.prototype.upload = function(file, objId, projectId, type) {\n      var promise;\n      promise = this.rs.attachments.create(type, projectId, objId, file);\n      promise.then(null, this.saveError.bind(this, file));\n      return promise;\n    };\n\n    AttachmentsService.prototype.patch = function(id, type, patch) {\n      var promise;\n      promise = this.rs.attachments.patch(type, id, patch);\n      promise.then(null, this.saveError.bind(this, null));\n      return promise;\n    };\n\n    return AttachmentsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgAttachmentsService\", AttachmentsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: check-permissions.service.coffee\n */\n\n(function() {\n  var ChekcPermissionsService, taiga;\n\n  taiga = this.taiga;\n\n  ChekcPermissionsService = (function() {\n    ChekcPermissionsService.$inject = [\"tgProjectService\"];\n\n    function ChekcPermissionsService(projectService) {\n      this.projectService = projectService;\n    }\n\n    ChekcPermissionsService.prototype.check = function(permission) {\n      if (!this.projectService.project) {\n        return false;\n      }\n      return this.projectService.project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    return ChekcPermissionsService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCheckPermissionsService\", ChekcPermissionsService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: current-user.service.coffee\n */\n\n(function() {\n  var CurrentUserService, groupBy, taiga;\n\n  taiga = this.taiga;\n\n  groupBy = this.taiga.groupBy;\n\n  CurrentUserService = (function() {\n    CurrentUserService.$inject = [\"tgProjectsService\", \"$tgStorage\", \"tgResources\"];\n\n    function CurrentUserService(projectsService, storageService, rs) {\n      this.projectsService = projectsService;\n      this.storageService = storageService;\n      this.rs = rs;\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      this._joyride = null;\n      taiga.defineImmutableProperty(this, \"projects\", (function(_this) {\n        return function() {\n          return _this._projects;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"projectsById\", (function(_this) {\n        return function() {\n          return _this._projectsById;\n        };\n      })(this));\n    }\n\n    CurrentUserService.prototype.isAuthenticated = function() {\n      if (this.getUser() !== null) {\n        return true;\n      }\n      return false;\n    };\n\n    CurrentUserService.prototype.getUser = function() {\n      var userData;\n      if (!this._user) {\n        userData = this.storageService.get(\"userInfo\");\n        if (userData) {\n          userData = Immutable.fromJS(userData);\n          this.setUser(userData);\n        }\n      }\n      return this._user;\n    };\n\n    CurrentUserService.prototype.removeUser = function() {\n      this._user = null;\n      this._projects = Immutable.Map();\n      this._projectsById = Immutable.Map();\n      return this._joyride = null;\n    };\n\n    CurrentUserService.prototype.setUser = function(user) {\n      this._user = user;\n      return this._loadUserInfo();\n    };\n\n    CurrentUserService.prototype.bulkUpdateProjectsOrder = function(sortData) {\n      return this.projectsService.bulkUpdateProjectsOrder(sortData).then((function(_this) {\n        return function() {\n          return _this.loadProjects();\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.loadProjects = function() {\n      return this.projectsService.getProjectsByUserId(this._user.get(\"id\")).then((function(_this) {\n        return function(projects) {\n          return _this.setProjects(projects);\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype.disableJoyRide = function(section) {\n      if (section) {\n        this._joyride[section] = false;\n      } else {\n        this._joyride = {\n          backlog: false,\n          kanban: false,\n          dashboard: false\n        };\n      }\n      return this.rs.user.setUserStorage('joyride', this._joyride);\n    };\n\n    CurrentUserService.prototype.loadJoyRideConfig = function() {\n      return new Promise((function(_this) {\n        return function(resolve) {\n          if (_this._joyride !== null) {\n            resolve(_this._joyride);\n            return;\n          }\n          return _this.rs.user.getUserStorage('joyride').then(function(config) {\n            _this._joyride = config;\n            return resolve(_this._joyride);\n          })[\"catch\"](function() {\n            _this._joyride = {\n              backlog: true,\n              kanban: true,\n              dashboard: true\n            };\n            _this.rs.user.createUserStorage('joyride', _this._joyride);\n            return resolve(_this._joyride);\n          });\n        };\n      })(this));\n    };\n\n    CurrentUserService.prototype._loadUserInfo = function() {\n      return Promise.all([this.loadProjects()]);\n    };\n\n    CurrentUserService.prototype.setProjects = function(projects) {\n      this._projects = this._projects.set(\"all\", projects);\n      this._projects = this._projects.set(\"recents\", projects.slice(0, 10));\n      this._projectsById = Immutable.fromJS(groupBy(projects.toJS(), function(p) {\n        return p.id;\n      }));\n      return this.projects;\n    };\n\n    CurrentUserService.prototype.canCreatePrivateProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_private_projects') !== null && user.get('total_private_projects') >= user.get('max_private_projects')) {\n        return {\n          valid: false,\n          reason: 'max_private_projects',\n          type: 'private_project'\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canCreatePublicProjects = function() {\n      var user;\n      user = this.getUser();\n      if (user.get('max_public_projects') !== null && user.get('total_public_projects') >= user.get('max_public_projects')) {\n        return {\n          valid: false,\n          reason: 'max_public_projects',\n          type: 'public_project'\n        };\n      }\n      return {\n        valid: true\n      };\n    };\n\n    CurrentUserService.prototype.canOwnProject = function(project) {\n      var result, user;\n      user = this.getUser();\n      if (project.get('is_private')) {\n        result = this.canCreatePrivateProjects();\n        if (!result.valid) {\n          return result;\n        }\n        if (user.get('max_memberships_private_projects') !== null && project.get('total_memberships') > user.get('max_memberships_private_projects')) {\n          return {\n            valid: false,\n            reason: 'max_members_private_projects',\n            type: 'private_project'\n          };\n        }\n      } else {\n        result = this.canCreatePublicProjects();\n        if (!result.valid) {\n          return result;\n        }\n        if (user.get('max_memberships_public_projects') !== null && project.get('total_memberships') > user.get('max_memberships_public_projects')) {\n          return {\n            valid: false,\n            reason: 'max_members_public_projects',\n            type: 'public_project'\n          };\n        }\n      }\n      return {\n        valid: true\n      };\n    };\n\n    return CurrentUserService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgCurrentUserService\", CurrentUserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: lightbox-factory.service.coffee\n */\n\n(function() {\n  var LightboxFactory;\n\n  LightboxFactory = (function() {\n    LightboxFactory.$inject = [\"$rootScope\", \"$compile\"];\n\n    function LightboxFactory(rootScope, compile) {\n      this.rootScope = rootScope;\n      this.compile = compile;\n    }\n\n    LightboxFactory.prototype.create = function(name, attrs, scopeAttrs) {\n      var elm, html, scope;\n      scope = this.rootScope.$new();\n      scope = _.merge(scope, scopeAttrs);\n      elm = $(\"<div>\").attr(name, true).attr(\"tg-bind-scope\", true);\n      if (attrs) {\n        elm.attr(attrs);\n      }\n      elm.addClass(\"remove-on-close\");\n      html = this.compile(elm)(scope);\n      $(document.body).append(html);\n    };\n\n    return LightboxFactory;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgLightboxFactory\", LightboxFactory);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: paginate-response.service.coffee\n */\n\n(function() {\n  var PaginateResponse;\n\n  PaginateResponse = function() {\n    return function(result) {\n      var paginateResponse;\n      paginateResponse = Immutable.Map({\n        \"data\": result.get(\"data\"),\n        \"next\": !!result.get(\"headers\")(\"x-pagination-next\"),\n        \"prev\": !!result.get(\"headers\")(\"x-pagination-prev\"),\n        \"current\": result.get(\"headers\")(\"x-pagination-current\"),\n        \"count\": result.get(\"headers\")(\"x-pagination-count\")\n      });\n      return paginateResponse;\n    };\n  };\n\n  angular.module(\"taigaCommon\").factory(\"tgPaginateResponseService\", PaginateResponse);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2015 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project-logo.service.coffee\n */\n\n(function() {\n  var ProjectLogoService,\n    modulo = function(a, b) { return (+a % (b = +b) + b) % b; };\n\n  ProjectLogoService = (function() {\n    function ProjectLogoService() {\n      var COLORS, IMAGES;\n      IMAGES = [\"/\" + window._version + \"/images/project-logos/project-logo-01.png\", \"/\" + window._version + \"/images/project-logos/project-logo-02.png\", \"/\" + window._version + \"/images/project-logos/project-logo-03.png\", \"/\" + window._version + \"/images/project-logos/project-logo-04.png\", \"/\" + window._version + \"/images/project-logos/project-logo-05.png\"];\n      COLORS = [\"rgba( 153,  214, 220, 1 )\", \"rgba( 213,  156,  156, 1 )\", \"rgba( 214, 161, 212,  1 )\", \"rgba( 164, 162, 219, 1 )\", \"rgba( 152, 224, 168,  1 )\"];\n      this.logos = _.cartesianProduct(IMAGES, COLORS);\n    }\n\n    ProjectLogoService.prototype.getDefaultProjectLogo = function(slug, id) {\n      var idx, key, logo;\n      key = slug + \"-\" + id;\n      idx = modulo(murmurhash3_32_gc(key, 42), this.logos.length);\n      logo = this.logos[idx];\n      return {\n        src: logo[0],\n        color: logo[1]\n      };\n    };\n\n    return ProjectLogoService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectLogoService\", ProjectLogoService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: project.service.coffee\n */\n\n(function() {\n  var ProjectService, taiga;\n\n  taiga = this.taiga;\n\n  ProjectService = (function() {\n    ProjectService.$inject = [\"tgProjectsService\", \"tgXhrErrorService\"];\n\n    function ProjectService(projectsService, xhrError) {\n      this.projectsService = projectsService;\n      this.xhrError = xhrError;\n      this._project = null;\n      this._section = null;\n      this._sectionsBreadcrumb = Immutable.List();\n      this._activeMembers = Immutable.List();\n      taiga.defineImmutableProperty(this, \"project\", (function(_this) {\n        return function() {\n          return _this._project;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"section\", (function(_this) {\n        return function() {\n          return _this._section;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"sectionsBreadcrumb\", (function(_this) {\n        return function() {\n          return _this._sectionsBreadcrumb;\n        };\n      })(this));\n      taiga.defineImmutableProperty(this, \"activeMembers\", (function(_this) {\n        return function() {\n          return _this._activeMembers;\n        };\n      })(this));\n    }\n\n    ProjectService.prototype.setSection = function(section) {\n      this._section = section;\n      if (section) {\n        return this._sectionsBreadcrumb = this._sectionsBreadcrumb.push(this._section);\n      } else {\n        return this._sectionsBreadcrumb = Immutable.List();\n      }\n    };\n\n    ProjectService.prototype.setProjectBySlug = function(pslug) {\n      return new Promise((function(_this) {\n        return function(resolve, reject) {\n          if (!_this.project || _this.project.get('slug') !== pslug) {\n            return _this.projectsService.getProjectBySlug(pslug).then(function(project) {\n              _this.setProject(project);\n              return resolve();\n            })[\"catch\"](function(xhr) {\n              return _this.xhrError.response(xhr);\n            });\n          } else {\n            return resolve();\n          }\n        };\n      })(this));\n    };\n\n    ProjectService.prototype.setProject = function(project) {\n      this._project = project;\n      return this._activeMembers = this._project.get('members').filter(function(member) {\n        return member.get('is_active');\n      });\n    };\n\n    ProjectService.prototype.cleanProject = function() {\n      this._project = null;\n      this._activeMembers = Immutable.List();\n      this._section = null;\n      return this._sectionsBreadcrumb = Immutable.List();\n    };\n\n    ProjectService.prototype.hasPermission = function(permission) {\n      return this._project.get('my_permissions').indexOf(permission) !== -1;\n    };\n\n    ProjectService.prototype.fetchProject = function() {\n      var pslug;\n      pslug = this.project.get('slug');\n      return this.projectsService.getProjectBySlug(pslug).then((function(_this) {\n        return function(project) {\n          return _this.setProject(project);\n        };\n      })(this));\n    };\n\n    return ProjectService;\n\n  })();\n\n  angular.module(\"taigaCommon\").service(\"tgProjectService\", ProjectService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: theme.service.coffee\n */\n\n(function() {\n  var ThemeService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  ThemeService = (function(superClass) {\n    extend(ThemeService, superClass);\n\n    function ThemeService() {\n      return ThemeService.__super__.constructor.apply(this, arguments);\n    }\n\n    return ThemeService;\n\n  })(taiga.Service = function() {\n    return {\n      use: function(themeName) {\n        var stylesheetEl;\n        stylesheetEl = $(\"link[rel='stylesheet']:first\");\n        if (stylesheetEl.length === 0) {\n          stylesheetEl = $(\"<link rel='stylesheet' href='' type='text/css'>\");\n          $(\"head\").append(stylesheetEl);\n        }\n        return stylesheetEl.attr(\"href\", \"/\" + window._version + \"/styles/theme-\" + themeName + \".css\");\n      }\n    };\n  });\n\n  angular.module(\"taigaCommon\").service(\"tgThemeService\", ThemeService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user.service.coffee\n */\n\n(function() {\n  var UserService, bindMethods, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  bindMethods = taiga.bindMethods;\n\n  UserService = (function(superClass) {\n    extend(UserService, superClass);\n\n    UserService.$inject = [\"tgResources\"];\n\n    function UserService(rs) {\n      this.rs = rs;\n      bindMethods(this);\n    }\n\n    UserService.prototype.getUserByUserName = function(username) {\n      return this.rs.users.getUserByUsername(username);\n    };\n\n    UserService.prototype.getContacts = function(userId) {\n      return this.rs.users.getContacts(userId);\n    };\n\n    UserService.prototype.getLiked = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getLiked(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getVoted = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getVoted(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getWatched = function(userId, pageNumber, objectType, textQuery) {\n      return this.rs.users.getWatched(userId, pageNumber, objectType, textQuery);\n    };\n\n    UserService.prototype.getStats = function(userId) {\n      return this.rs.users.getStats(userId);\n    };\n\n    UserService.prototype.attachUserContactsToProjects = function(userId, projects) {\n      return this.getContacts(userId).then(function(contacts) {\n        projects = projects.map(function(project) {\n          var contactsFiltered;\n          contactsFiltered = contacts.filter(function(contact) {\n            var contactId;\n            contactId = contact.get(\"id\");\n            return project.get('members').indexOf(contactId) !== -1;\n          });\n          project = project.set(\"contacts\", contactsFiltered);\n          return project;\n        });\n        return projects;\n      });\n    };\n\n    return UserService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgUserService\", UserService);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: xhrError.service.coffee\n */\n\n(function() {\n  var xhrError,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  xhrError = (function(superClass) {\n    extend(xhrError, superClass);\n\n    xhrError.$inject = [\"$q\", \"$location\", \"$tgNavUrls\"];\n\n    function xhrError(q, location, navUrls) {\n      this.q = q;\n      this.location = location;\n      this.navUrls = navUrls;\n    }\n\n    xhrError.prototype.notFound = function() {\n      this.location.path(this.navUrls.resolve(\"not-found\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.permissionDenied = function() {\n      this.location.path(this.navUrls.resolve(\"permission-denied\"));\n      return this.location.replace();\n    };\n\n    xhrError.prototype.response = function(xhr) {\n      if (xhr) {\n        if (xhr.status === 404) {\n          this.notFound();\n        } else if (xhr.status === 403) {\n          this.permissionDenied();\n        }\n      }\n      return this.q.reject(xhr);\n    };\n\n    return xhrError;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaCommon\").service(\"tgXhrErrorService\", xhrError);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-attachment.directive.coffee\n */\n\n(function() {\n  var UserTimelineAttachmentDirective;\n\n  UserTimelineAttachmentDirective = function(template, $compile) {\n    var isImage, link, validFileExtensions;\n    validFileExtensions = [\".jpg\", \".jpeg\", \".bmp\", \".gif\", \".png\"];\n    isImage = function(url) {\n      url = url.toLowerCase();\n      return _.some(validFileExtensions, function(extension) {\n        return url.indexOf(extension, url - extension.length) !== -1;\n      });\n    };\n    link = function(scope, el) {\n      var is_image, templateHtml;\n      is_image = isImage(scope.attachment.get('url'));\n      if (is_image) {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment-image.html\");\n      } else {\n        templateHtml = template.get(\"user-timeline/user-timeline-attachment/user-timeline-attachment.html\");\n      }\n      el.html(templateHtml);\n      $compile(el.contents())(scope);\n      return el.find(\"img\").error(function() {\n        return this.remove();\n      });\n    };\n    return {\n      link: link,\n      scope: {\n        attachment: \"=tgUserTimelineAttachment\"\n      }\n    };\n  };\n\n  UserTimelineAttachmentDirective.$inject = [\"$tgTemplate\", \"$compile\"];\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineAttachment\", UserTimelineAttachmentDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-title.service.coffee\n */\n\n(function() {\n  var UserTimelineItemTitle, unslugify;\n\n  unslugify = this.taiga.unslugify;\n\n  UserTimelineItemTitle = (function() {\n    UserTimelineItemTitle.$inject = [\"$translate\", \"$sce\"];\n\n    UserTimelineItemTitle.prototype._fieldTranslationKey = {\n      'status': 'COMMON.FIELDS.STATUS',\n      'subject': 'COMMON.FIELDS.SUBJECT',\n      'description_diff': 'COMMON.FIELDS.DESCRIPTION',\n      'points': 'COMMON.FIELDS.POINTS',\n      'assigned_to': 'COMMON.FIELDS.ASSIGNED_TO',\n      'severity': 'ISSUES.FIELDS.SEVERITY',\n      'priority': 'ISSUES.FIELDS.PRIORITY',\n      'type': 'ISSUES.FIELDS.TYPE',\n      'is_iocaine': 'TASK.FIELDS.IS_IOCAINE',\n      'is_blocked': 'COMMON.FIELDS.IS_BLOCKED'\n    };\n\n    UserTimelineItemTitle.prototype._params = {\n      username: function(timeline, event) {\n        var title_attr, url, user;\n        user = timeline.getIn(['data', 'user']);\n        if (user.get('is_profile_visible')) {\n          title_attr = this.translate.instant('COMMON.SEE_USER_PROFILE', {\n            username: user.get('username')\n          });\n          url = \"user-profile:username=timeline.getIn(['data', 'user', 'username'])\";\n          return this._getLink(url, user.get('name'), title_attr);\n        } else {\n          return this._getUsernameSpan(user.get('name'));\n        }\n      },\n      field_name: function(timeline, event) {\n        var field_name;\n        field_name = timeline.getIn(['data', 'value_diff', 'key']);\n        return this.translate.instant(this._fieldTranslationKey[field_name]);\n      },\n      project_name: function(timeline, event) {\n        var url;\n        url = \"project:project=timeline.getIn(['data', 'project', 'slug'])\";\n        return this._getLink(url, timeline.getIn([\"data\", \"project\", \"name\"]));\n      },\n      new_value: function(timeline, event) {\n        var new_value, value;\n        if (_.isArray(timeline.getIn([\"data\", \"value_diff\", \"value\"]).toJS())) {\n          value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).get(1);\n          if (value === null && timeline.getIn([\"data\", \"value_diff\", \"key\"]) === 'assigned_to') {\n            value = this.translate.instant('ACTIVITY.VALUES.UNASSIGNED');\n          }\n          new_value = value;\n        } else {\n          new_value = timeline.getIn([\"data\", \"value_diff\", \"value\"]).first().get(1);\n        }\n        return _.escape(new_value);\n      },\n      sprint_name: function(timeline, event) {\n        var url;\n        url = \"project-taskboard:project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['data', 'milestone', 'slug'])\";\n        return this._getLink(url, timeline.getIn(['data', 'milestone', 'name']));\n      },\n      us_name: function(timeline, event) {\n        var event_us, obj, text, url;\n        obj = this._getTimelineObj(timeline, event).get('userstory');\n        event_us = {\n          obj: 'parent_userstory'\n        };\n        url = this._getDetailObjUrl(event_us);\n        text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        return this._getLink(url, text);\n      },\n      obj_name: function(timeline, event) {\n        var obj, text, url;\n        obj = this._getTimelineObj(timeline, event);\n        url = this._getDetailObjUrl(event);\n        if (event.obj === 'wikipage') {\n          text = unslugify(obj.get('slug'));\n        } else if (event.obj === 'milestone') {\n          text = obj.get('name');\n        } else {\n          text = '#' + obj.get('ref') + ' ' + obj.get('subject');\n        }\n        return this._getLink(url, text);\n      },\n      role_name: function(timeline, event) {\n        return _.escape(timeline.getIn(['data', 'value_diff', 'value']).keySeq().first());\n      }\n    };\n\n    function UserTimelineItemTitle(translate, sce) {\n      this.translate = translate;\n      this.sce = sce;\n    }\n\n    UserTimelineItemTitle.prototype._translateTitleParams = function(param, timeline, event) {\n      return this._params[param].call(this, timeline, event);\n    };\n\n    UserTimelineItemTitle.prototype._getTimelineObj = function(timeline, event) {\n      return timeline.getIn(['data', event.obj]);\n    };\n\n    UserTimelineItemTitle.prototype._getDetailObjUrl = function(event) {\n      var url;\n      url = {\n        \"issue\": [\"project-issues-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"wikipage\": [\"project-wiki-page\", \":project=timeline.getIn(['data', 'project', 'slug']),slug=timeline.getIn(['obj', 'slug'])\"],\n        \"task\": [\"project-tasks-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'ref'])\"],\n        \"parent_userstory\": [\"project-userstories-detail\", \":project=timeline.getIn(['data', 'project', 'slug']),ref=timeline.getIn(['obj', 'userstory', 'ref'])\"],\n        \"milestone\": [\"project-taskboard\", \":project=timeline.getIn(['data', 'project', 'slug']),sprint=timeline.getIn(['obj', 'slug'])\"]\n      };\n      return url[event.obj][0] + url[event.obj][1];\n    };\n\n    UserTimelineItemTitle.prototype._getLink = function(url, text, title) {\n      title = title || text;\n      return $('<a>').attr('tg-nav', url).text(text).attr('title', title).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getUsernameSpan = function(text) {\n      var title;\n      title = title || text;\n      return $('<span>').addClass('username').text(text).prop('outerHTML');\n    };\n\n    UserTimelineItemTitle.prototype._getParams = function(timeline, event, timeline_type) {\n      var params;\n      params = {};\n      timeline_type.translate_params.forEach((function(_this) {\n        return function(param) {\n          return params[param] = _this._translateTitleParams(param, timeline, event);\n        };\n      })(this));\n      return params;\n    };\n\n    UserTimelineItemTitle.prototype.getTitle = function(timeline, event, type) {\n      var params, paramsKeys, translation;\n      params = this._getParams(timeline, event, type);\n      paramsKeys = {};\n      Object.keys(params).forEach(function(key) {\n        return paramsKeys[key] = '{{' + key + '}}';\n      });\n      translation = this.translate.instant(type.key, paramsKeys);\n      Object.keys(params).forEach(function(key) {\n        var find;\n        find = '{{' + key + '}}';\n        return translation = translation.replace(new RegExp(find, 'g'), params[key]);\n      });\n      return translation;\n    };\n\n    return UserTimelineItemTitle;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemTitle\", UserTimelineItemTitle);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item-type.service.coffee\n */\n\n(function() {\n  var UserTimelineType, timelineType;\n\n  timelineType = function(timeline, event) {\n    var types;\n    types = [\n      {\n        check: function(timeline, event) {\n          return event.obj === 'membership';\n        },\n        key: 'TIMELINE.NEW_MEMBER',\n        translate_params: ['project_name'],\n        member: function(timeline) {\n          return Immutable.Map({\n            user: timeline.getIn(['data', 'user']),\n            role: timeline.getIn(['data', 'role'])\n          });\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'project' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_PROJECT',\n        translate_params: ['username', 'project_name'],\n        description: function(timeline) {\n          return timeline.getIn(['data', 'project', 'description']);\n        }\n      }, {\n        check: function(timeline, event) {\n          return event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'attachments';\n        },\n        key: 'TIMELINE.UPLOAD_ATTACHMENT',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'create';\n        },\n        key: 'TIMELINE.US_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'create';\n        },\n        key: 'TIMELINE.ISSUE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'create';\n        },\n        key: 'TIMELINE.WIKI_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'create' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_CREATED_WITH_US',\n        translate_params: ['username', 'project_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'create';\n        },\n        key: 'TIMELINE.MILESTONE_CREATED',\n        translate_params: ['username', 'project_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.NEW_COMMENT_US',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'issue';\n        },\n        key: 'TIMELINE.NEW_COMMENT_ISSUE',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.getIn(['data', 'comment']) && event.obj === 'task';\n        },\n        key: 'TIMELINE.NEW_COMMENT_TASK',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          text = timeline.getIn(['data', 'comment_html']);\n          return $($.parseHTML(text)).text();\n        }\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && timeline.hasIn(['data', 'value_diff', 'value', 'backlog_order']) && event.type === 'change';\n        },\n        key: 'TIMELINE.US_MOVED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'milestone']).get(1) === null;\n          }\n          return false;\n        },\n        key: 'TIMELINE.US_REMOVED_FROM_MILESTONE',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'moveInBacklog' && event.type === 'change' && event.obj === 'userstory';\n        },\n        key: 'TIMELINE.US_ADDED_MILESTONE',\n        translate_params: ['username', 'obj_name', 'sprint_name']\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === true;\n          }\n          return false;\n        },\n        key: 'TIMELINE.BLOCKED',\n        translate_params: ['username', 'obj_name'],\n        description: function(timeline) {\n          var text;\n          if (timeline.hasIn(['data', 'value_diff', 'value', 'blocked_note_html'])) {\n            text = timeline.getIn(['data', 'value_diff', 'value', 'blocked_note_html']).get(1);\n            return $($.parseHTML(text)).text();\n          } else {\n            return false;\n          }\n        }\n      }, {\n        check: function(timeline, event) {\n          if (timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'blocked' && event.type === 'change') {\n            return timeline.getIn(['data', 'value_diff', 'value', 'is_blocked']).get(1) === false;\n          }\n          return false;\n        },\n        key: 'TIMELINE.UNBLOCKED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'milestone' && event.type === 'change';\n        },\n        key: 'TIMELINE.MILESTONE_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'wikipage' && event.type === 'change';\n        },\n        key: 'TIMELINE.WIKI_UPDATED',\n        translate_params: ['username', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'points';\n        },\n        key: 'TIMELINE.US_UPDATED_POINTS',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value', 'role_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.US_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'userstory' && event.type === 'change';\n        },\n        key: 'TIMELINE.US_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change' && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'issue' && event.type === 'change';\n        },\n        key: 'TIMELINE.ISSUE_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED',\n        translate_params: ['username', 'field_name', 'obj_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']) && timeline.hasIn(['data', 'value_diff']) && timeline.getIn(['data', 'value_diff', 'key']) === 'description_diff';\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && !timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'task' && event.type === 'change' && timeline.getIn(['data', 'task', 'userstory']);\n        },\n        key: 'TIMELINE.TASK_UPDATED_WITH_US_NEW_VALUE',\n        translate_params: ['username', 'field_name', 'obj_name', 'us_name', 'new_value']\n      }, {\n        check: function(timeline, event) {\n          return event.obj === 'user' && event.type === 'create';\n        },\n        key: 'TIMELINE.NEW_USER',\n        translate_params: ['username']\n      }\n    ];\n    return _.find(types, function(obj) {\n      return obj.check(timeline, event);\n    });\n  };\n\n  UserTimelineType = (function() {\n    function UserTimelineType() {}\n\n    UserTimelineType.prototype.getType = function(timeline, event) {\n      return timelineType(timeline, event);\n    };\n\n    return UserTimelineType;\n\n  })();\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineItemType\", UserTimelineType);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-item.directive.coffee\n */\n\n(function() {\n  var UserTimelineItemDirective;\n\n  UserTimelineItemDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline-item/user-timeline-item.html\",\n      scope: {\n        timeline: \"=tgUserTimelineItem\"\n      }\n    };\n  };\n\n  angular.module(\"taigaUserTimeline\").directive(\"tgUserTimelineItem\", UserTimelineItemDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline-pagination-sequence.service.coffee\n */\n\n(function() {\n  var UserTimelinePaginationSequence;\n\n  UserTimelinePaginationSequence = function() {\n    var obj;\n    obj = {};\n    obj.generate = function(config) {\n      var getContent, items, next, page;\n      page = 1;\n      items = Immutable.List();\n      config.minItems = config.minItems || 20;\n      next = function() {\n        items = Immutable.List();\n        return getContent();\n      };\n      getContent = function() {\n        return config.fetch(page).then(function(response) {\n          var data;\n          page++;\n          data = response.get(\"data\");\n          if (config.filter) {\n            data = config.filter(data);\n          }\n          if (config.map) {\n            data = data.map(config.map);\n          }\n          items = items.concat(data);\n          if (items.size < config.minItems && response.get(\"next\")) {\n            return getContent();\n          }\n          return Immutable.Map({\n            items: items,\n            next: response.get(\"next\")\n          });\n        });\n      };\n      return {\n        next: function() {\n          return next();\n        }\n      };\n    };\n    return obj;\n  };\n\n  angular.module(\"taigaUserTimeline\").factory(\"tgUserTimelinePaginationSequenceService\", UserTimelinePaginationSequence);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Andrey Antukh <niwi@niwi.nz>\n * Copyright (C) 2014-2016 Jess Espino Garcia <jespinog@gmail.com>\n * Copyright (C) 2014-2016 David Barragn Merino <bameda@dbarragan.com>\n * Copyright (C) 2014-2016 Alejandro Alonso <alejandro.alonso@kaleidos.net>\n * Copyright (C) 2014-2016 Juan Francisco Alcntara <juanfran.alcantara@kaleidos.net>\n * Copyright (C) 2014-2016 Xavi Julian <xavier.julian@kaleidos.net>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: modules/profile/profile-timeline/profile-timeline.controller.coffee\n */\n\n(function() {\n  var UserTimelineController, mixOf, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  mixOf = this.taiga.mixOf;\n\n  UserTimelineController = (function(superClass) {\n    extend(UserTimelineController, superClass);\n\n    UserTimelineController.$inject = [\"tgUserTimelineService\"];\n\n    function UserTimelineController(userTimelineService) {\n      this.userTimelineService = userTimelineService;\n      this.timelineList = Immutable.List();\n      this.scrollDisabled = false;\n      this.timeline = null;\n      if (this.projectId) {\n        this.timeline = this.userTimelineService.getProjectTimeline(this.projectId);\n      } else if (this.currentUser) {\n        this.timeline = this.userTimelineService.getProfileTimeline(this.user.get(\"id\"));\n      } else {\n        this.timeline = this.userTimelineService.getUserTimeline(this.user.get(\"id\"));\n      }\n    }\n\n    UserTimelineController.prototype.loadTimeline = function() {\n      this.scrollDisabled = true;\n      return this.timeline.next().then((function(_this) {\n        return function(response) {\n          _this.timelineList = _this.timelineList.concat(response.get(\"items\"));\n          if (response.get(\"next\")) {\n            _this.scrollDisabled = false;\n          }\n          return _this.timelineList;\n        };\n      })(this));\n    };\n\n    return UserTimelineController;\n\n  })(mixOf(taiga.Controller, taiga.PageMixin, taiga.FiltersMixin));\n\n  angular.module(\"taigaUserTimeline\").controller(\"UserTimeline\", UserTimelineController);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.directive.coffee\n */\n\n(function() {\n  var UserTimelineDirective;\n\n  UserTimelineDirective = function() {\n    return {\n      templateUrl: \"user-timeline/user-timeline/user-timeline.html\",\n      controller: \"UserTimeline\",\n      controllerAs: \"vm\",\n      scope: {\n        projectId: \"=projectid\",\n        user: \"=\",\n        currentUser: \"=\"\n      },\n      bindToController: true\n    };\n  };\n\n  angular.module(\"taigaProfile\").directive(\"tgUserTimeline\", UserTimelineDirective);\n\n}).call(this);\n\n\n/*\n * Copyright (C) 2014-2016 Taiga Agile LLC <taiga@taiga.io>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n * File: user-timeline.service.coffee\n */\n\n(function() {\n  var UserTimelineService, taiga,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  taiga = this.taiga;\n\n  UserTimelineService = (function(superClass) {\n    extend(UserTimelineService, superClass);\n\n    UserTimelineService.$inject = [\"tgResources\", \"tgUserTimelinePaginationSequenceService\", \"tgUserTimelineItemType\", \"tgUserTimelineItemTitle\"];\n\n    function UserTimelineService(rs, userTimelinePaginationSequenceService, userTimelineItemType, userTimelineItemTitle) {\n      this.rs = rs;\n      this.userTimelinePaginationSequenceService = userTimelinePaginationSequenceService;\n      this.userTimelineItemType = userTimelineItemType;\n      this.userTimelineItemTitle = userTimelineItemTitle;\n    }\n\n    UserTimelineService.prototype._valid_fields = ['status', 'subject', 'description_diff', 'assigned_to', 'points', 'severity', 'priority', 'type', 'attachments', 'is_iocaine', 'content_diff', 'name', 'estimated_finish', 'estimated_start', 'blocked', 'moveInBacklog', 'milestone'];\n\n    UserTimelineService.prototype._invalid = [\n      {\n        check: function(timeline) {\n          var fieldKey, value_diff;\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff) {\n            fieldKey = value_diff.get('key');\n            if (this._valid_fields.indexOf(fieldKey) === -1) {\n              return true;\n            } else if (fieldKey === 'attachments' && value_diff.get('value').get('new').size === 0) {\n              return true;\n            }\n          }\n          return false;\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          return event[2] === 'change' && value_diff === void 0;\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[2] === 'delete';\n        }\n      }, {\n        check: function(timeline) {\n          var event;\n          event = timeline.get('event_type').split(\".\");\n          return event[1] === 'project' && event[2] === 'change';\n        }\n      }, {\n        check: function(timeline) {\n          return !!timeline.get(\"data\").get(\"comment_deleted\");\n        }\n      }, {\n        check: function(timeline) {\n          var event, value_diff;\n          event = timeline.get('event_type').split(\".\");\n          value_diff = timeline.get(\"data\").get(\"value_diff\");\n          if (value_diff && event[1] === \"task\" && event[2] === \"change\" && value_diff.get(\"key\") === \"milestone\") {\n            return timeline.get(\"data\").get(\"value_diff\").get(\"value\");\n          }\n          return false;\n        }\n      }\n    ];\n\n    UserTimelineService.prototype._isInValidTimeline = function(timeline) {\n      return _.some(this._invalid, (function(_this) {\n        return function(invalid) {\n          return invalid.check.call(_this, timeline);\n        };\n      })(this));\n    };\n\n    UserTimelineService.prototype._parseEventType = function(event_type) {\n      event_type = event_type.split(\".\");\n      return {\n        section: event_type[0],\n        obj: event_type[1],\n        type: event_type[2]\n      };\n    };\n\n    UserTimelineService.prototype._getTimelineObject = function(timeline, event) {\n      if (timeline.get('data').get(event.obj)) {\n        return timeline.get('data').get(event.obj);\n      }\n    };\n\n    UserTimelineService.prototype._attachExtraInfoToTimelineEntry = function(timeline, event, type) {\n      var title;\n      title = this.userTimelineItemTitle.getTitle(timeline, event, type);\n      timeline = timeline.set('title_html', title);\n      timeline = timeline.set('obj', this._getTimelineObject(timeline, event));\n      if (type.description) {\n        timeline = timeline.set('description', type.description(timeline));\n      }\n      if (type.member) {\n        timeline = timeline.set('member', type.member(timeline));\n      }\n      if (timeline.getIn(['data', 'value_diff', 'key']) === 'attachments' && timeline.hasIn(['data', 'value_diff', 'value', 'new'])) {\n        timeline = timeline.set('attachments', timeline.getIn(['data', 'value_diff', 'value', 'new']));\n      }\n      return timeline;\n    };\n\n    UserTimelineService.prototype._parseTimeline = function(response) {\n      var newdata;\n      newdata = Immutable.List();\n      response.get('data').forEach((function(_this) {\n        return function(item) {\n          var data, event, newItem, values_diff;\n          event = _this._parseEventType(item.get('event_type'));\n          data = item.get('data');\n          values_diff = data.get('values_diff');\n          if (values_diff && values_diff.count()) {\n            if (values_diff.has('is_blocked')) {\n              values_diff = Immutable.Map({\n                'blocked': values_diff\n              });\n            }\n            if (values_diff.has('milestone')) {\n              if (event.obj === 'userstory') {\n                values_diff = Immutable.Map({\n                  'moveInBacklog': values_diff\n                });\n              } else {\n                values_diff = values_diff.deleteIn(['values_diff', 'milestone']);\n              }\n            } else if (event.obj === 'milestone') {\n              values_diff = Immutable.Map({\n                'milestone': values_diff\n              });\n            }\n            return values_diff.forEach(function(value, key) {\n              var newItem, obj;\n              obj = Immutable.Map({\n                key: key,\n                value: value\n              });\n              newItem = item.setIn(['data', 'value_diff'], obj);\n              newItem = newItem.deleteIn(['data', 'values_diff']);\n              return newdata = newdata.push(newItem);\n            });\n          } else {\n            newItem = item.deleteIn(['data', 'values_diff']);\n            return newdata = newdata.push(newItem);\n          }\n        };\n      })(this));\n      return response.set('data', newdata);\n    };\n\n    UserTimelineService.prototype._addEntyAttributes = function(item) {\n      var event, type;\n      event = this._parseEventType(item.get('event_type'));\n      type = this.userTimelineItemType.getType(item, event);\n      return this._attachExtraInfoToTimelineEntry(item, event, type);\n    };\n\n    UserTimelineService.prototype.getProfileTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getProfileTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getUserTimeline = function(userId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.users.getUserTimeline(userId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    UserTimelineService.prototype.getProjectTimeline = function(projectId) {\n      var config;\n      config = {};\n      config.fetch = (function(_this) {\n        return function(page) {\n          return _this.rs.projects.getTimeline(projectId, page).then(function(response) {\n            return _this._parseTimeline(response);\n          });\n        };\n      })(this);\n      config.map = (function(_this) {\n        return function(obj) {\n          return _this._addEntyAttributes(obj);\n        };\n      })(this);\n      config.filter = (function(_this) {\n        return function(items) {\n          return items.filterNot(function(item) {\n            return _this._isInValidTimeline(item);\n          });\n        };\n      })(this);\n      return this.userTimelinePaginationSequenceService.generate(config);\n    };\n\n    return UserTimelineService;\n\n  })(taiga.Service);\n\n  angular.module(\"taigaUserTimeline\").service(\"tgUserTimelineService\", UserTimelineService);\n\n}).call(this);\n\n//# sourceMappingURL=maps/app.js.map\n"]}